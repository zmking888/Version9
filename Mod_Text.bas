Attribute VB_Name = "Module1"
' Author: George Karras, Preveza, Greece
' Some code are work of others, and included using info when possible.
' Licensed under the GNU GENERAL PUBLIC LICENSE,  Version 3, 29 June 2007
' Before loading the code in VB6 IDE, change editor's text to a Greek font.
' Also to run greek commands from IDE you have to turn support for Non Unicode Programs to Greek Language
' Local References: File idispatch.tlb
' First run this, and then you have to execute M2000.exe to call it, using a second IDE with the mexe.vbp, or just run M2000.exe
' In 9.3 rev >2 Asc() and Chr$() in M2000 use Locale. In previous versions these functions works for greek ascii.

Option Explicit
Global OsInfo As New clsOSInfo
Dim HaltLevel As Long
Global startaddress As Long, stacksize As Long, findstack As Long
Const a123 = "={-"
Private Const myArray = "mArray"
Const thislabel$ = "[!" + vbCr + "'\]"
Dim ObjectCatalog As FastCollection, loadcatalog As New FastCollection
Public rndbase As rndvars, GDILines As Boolean
Public LastUse As Long, cdecimaldot$
Private funcno As Long, ua As Double, UB As Double
Private simplestack1 As rndvars
Private Declare Function ShellExecute Lib "shell32.dll" Alias "ShellExecuteW" (ByVal hWND As Long, ByVal lpszOp As Long, ByVal lpszFile As Long, ByVal lpszParams As Long, ByVal LpszDir As String, ByVal FsShowCmd As Long) As Long
Private Declare Function ShowCursor Lib "user32" (ByVal bShow As Long) As Long
Private Declare Sub GetMem1 Lib "msvbvm60" (ByVal addr As Long, retval As Byte)
Private Declare Sub GetMem2 Lib "msvbvm60" (ByVal addr As Long, retval As Integer)
Private Declare Sub GetMem4 Lib "msvbvm60" (ByVal addr As Long, retval As Long)
Private Declare Sub GetMemS Lib "msvbvm60" Alias "GetMem4" (ByVal addr As Long, retval As Single)
Private Declare Sub GetMem8 Lib "msvbvm60" (ByVal addr As Long, retval As Double)
Private Declare Sub PutMem1 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Byte)
Private Declare Sub PutMem2 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Integer)
Private Declare Sub PutMem4 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Long)
Private Declare Sub PutMemS Lib "msvbvm60" Alias "PutMem4" (ByVal addr As Long, ByVal NewVal As Single)
Private Declare Sub PutMem8 Lib "msvbvm60" (ByVal addr As Long, ByVal NewVal As Double)
Private Declare Function CopyBytes Lib "msvbvm60.dll" Alias "__vbaCopyBytes" (ByVal ByteLen As Long, ByVal Destination As Long, ByVal Source As Long) As Long
Private Declare Function ObjSetAddRef Lib "msvbvm60.dll" Alias "__vbaObjSetAddref" (ByRef objDest As Object, ByVal pObject As Long) As Long
Private Declare Function IsBadCodePtr Lib "KERNEL32" (ByVal lpfn As Long) As Long
Private Declare Function CompareString Lib "KERNEL32" Alias "CompareStringW" (ByVal Locale As Long, ByVal dwCmpFlags As Long, ByVal lpString1 As Long, ByVal cchCount1 As Long, ByVal lpString2 As Long, ByVal cchCount2 As Long) As Long
Private Declare Function CallWindowProc _
 Lib "user32.dll" Alias "CallWindowProcW" ( _
 ByVal lpPrevWndFunc As Long, _
 ByVal hWND As Long, _
 ByVal Msg As Long, _
 ByVal wParam As Long, _
 ByVal lParam As Long) As Long

Public Okk As Boolean
Private Declare Sub DisableProcessWindowsGhosting Lib "user32" ()
Public Interrupted As Boolean
Dim NoOptimum As Boolean
Dim Zero As basket
 Public Type GenItem
 Key As String
 ndx As String
 firsthash As Long
 lastpos As Long
 Pleft As Long  ' a list
 End Type
Public Declare Function SelectClipRgn Lib "gdi32" (ByVal hDC As Long, ByVal hRgn As Long) As Long
Public UseEsc As Boolean
' 1 to 32 for layers
' 0 for DIS
Public NowDec$, NowThou$, DefaultDec$
Public ShowBooleanAsString As Boolean, DefBooleanString As String
Public ForLikeBasic As Boolean, DimLikeBasic As Boolean, SecureNames As Boolean, wide As Boolean
Public priorityOr As Boolean, NoUseDec As Boolean, mNoUseDec As Boolean, UseIntDiv As Boolean
Public mTextCompare As Boolean
Public csvsep$, csvDec$, csvuseescape As Boolean, cleanstrings As Boolean
Public inpcsvsep$, inpcsvDec$, inpcsvuseescape As Boolean, inpcleanstrings As Boolean
Public Const DisForm = 0
Public Const BackForm = -1
Public Const PrinterPage = -2
Public players(-2 To 132) As basket  ' tag number not actual number of dsprite()
Public Prefresh(-2 To 132) As Counters

Private Declare Function GdiFlush Lib "gdi32" () As Long
Public m_bInIDE As Boolean
Public UKEY$
Public TestShowCode As Boolean, TestShowSub As String, TestShowStart As Long, WaitShow As Long
Public feedback$, FeedbackExec$, feednow$ ' for about$
Global Const VerMajor = 9
Global Const VerMinor = 4
Global Const Revision = 19
Private Const doc = "Document"
Public UserCodePage As Long
Public cLine As String  ' it was public in form1
Public casesensitive As Boolean  ' for files
Public userfiles As String
Public TweakLang As Long
Public notweak As Boolean
Public extreme As Boolean
Public taskmainonly As Boolean
Public TaskMain As Boolean
Global Const gintMAX_SIZE& = 255                        'Maximum buffer size
Global Const gstrSEP_DIR$ = "\"
Global DIALOGSHOW As Boolean
' Directory separator character
Public HelpStack As New basetask ' from 6.5.1
Public Const gstrSEP_URLDIR$ = "/"
Public REFRESHRATE As Double
Public RRCOUNTER As Double
Public BLOCKkey As Boolean
Public Const novalidstr = "+-/*!?_()[]&$#@;" & """"

Public tempList2delete As String
Public nnn$, basickey$, homepage$
Private Const LOCALE_SENGLANGUAGE& = 4097&
Private Const LOCALE_SLANGUAGE& = &H2& '  localized name of language
Public shortlang As Boolean
Public LEVCOLMENU As Long
 Declare Function ExpandEnvironmentStrings _
   Lib "KERNEL32" Alias "ExpandEnvironmentStringsW" _
   (ByVal lpSrc As Long, ByVal lpDst As Long, _
   ByVal nsize As Long) As Long
Private Declare Function GetTempFileNameW Lib "KERNEL32" _
    (ByVal lpszPath As Long, ByVal lpPrefixString As Long, _
     ByVal wUnique As Long, ByVal lpTempFileName As Long) _
     As Long
     
Private Const UNIQUE_NAME = &H0&
Public taskid As Long, kill2$, para$
Private Declare Function timeGetTime Lib "winmm.dll" () As Long
Public sRec As Object
Public defFontname As String
Private pnum As Long
Public my_system As Enum_OperatingPlatform
Public Declare Function Beeper Lib "KERNEL32" Alias "Beep" _
  (ByVal dwFreq As Long, ByVal dwDuration As Long) As Long
Private oprinter As New cDIBSection
Public Const MAX_FILENAME_LEN As Long = 260 * 2 - 1
Public beeperBEAT As Long
Public funcdeep As Variant
Private deep As Variant
Private mys As String
Private Declare Function WinExec Lib "KERNEL32" (ByVal lpCmdLine As String, ByVal nCmdShow As Long) As Long
Public needset As Boolean
Public cnt As Boolean
Public exWnd As Long

Public Declare Function GetForegroundWindow Lib "user32" () As Long
Public Declare Function FindExecutable Lib "shell32.dll" Alias "FindExecutableW" (ByVal lpFile As Long, ByVal lpDirectory As Long, ByVal lpResult As Long) As Long
Public expl As Long

Public l_complete As Boolean
Public s_complete As Boolean
Public ThereIsAPrinter As Boolean
Public MOUT As Boolean
Public DXP As Long
Public DYP As Long
Public SLOW As Boolean
Public pname As String
Public port As String
Global elevatestatus As Long
Global elevatestatus2 As Long
Public FKey As Long
Public FK$(1 To 13)
Public strTemp As String
Public STEXIT As Boolean
Public STbyST As Boolean
Public STq As Boolean, bypassST As Boolean
Public pagio$, pagiohtml$
Public subHash As New sbHash
Public varhash As New Hash
Public comhash As New sbHash, numid As New idHash, numidbackup As New idHash, funid As New idHash, funidbackup As New idHash
Public strid  As New idHash, stridbackup As New idHash, strfunid As New idHash, strfunidbackup As New idHash
Public cLid As Long 'current id for app id
Public lastAboutHTitle As String, LastAboutText As String
''
Public basestack1 As New basetask ' this is the global stack
Public EventStaticCollection As New FastCollection
Public sb2used As Long
Public Type modfun
    sb As String
    sbc As Long
    sbgroup As String
    subs As FastCollection
    locked As Boolean
    goodname As String
    Changed As Boolean
End Type
Private sbf() As modfun
Public var2used As Long
Public var() As Variant
Public uni(512) As Boolean
Public globalstack As New mStiva

Public IERUN As Boolean
Public IEX As Long
Public IEY As Long
Public IESizeX As Long
Public IESizeY As Long
Public AVIRUN As Boolean
Public AVIUP As Boolean
Public aviX As Long
Public aviY As Long
Public UseAviXY As Boolean
Public UseAviSize As Boolean
Public AviSizeX As Long
Public AviSizeY As Long
Public mycoder As New coder
' play music
Public voices$(0 To 15), BEATS(0 To 15) As Double



Const GFSR_SYSTEMRESOURCES = 0
Const GFSR_GDIRESOURCES = 1
Const GFSR_USERRESOURCES = 2
Declare Function MessageBeep Lib "user32" (ByVal wType As Long) As Long


Declare Function SetLocaleInfo Lib "KERNEL32" Alias "SetLocaleInfoA" (ByVal Locale As Long, ByVal LCType As Long, ByVal lpLCData As String) As Long
Declare Function GetLocaleInfo Lib "KERNEL32" Alias "GetLocaleInfoA" (ByVal Locale As Long, ByVal LCType As Long, lpLCData As String, ByVal cchData As Long) As Long
Declare Function GetTempPath Lib "KERNEL32" Alias "GetTempPathW" (ByVal nBufferLength As Long, ByVal lpBuffer As Long) As Long
Public Declare Function GetWindowsDirectory Lib "KERNEL32" Alias "GetWindowsDirectoryA" (ByVal lpBuffer As String, ByVal nsize As Long) As Long


Private Const LOCALE_USER_DEFAULT = 0&


Public trace As Boolean, tracecounter As Long, bypasstrace As Boolean
Const CSIDL_DESKTOP = &H0&
Const CSIDL_PROGRAMS = &H2&
Const CSIDL_CONTROLS = &H3&
Const CSIDL_PRINTERS = &H4&
Const CSIDL_PERSONAL = &H5&
Const CSIDL_FAVORITES = &H6&
Const CSIDL_STARTUP = &H7&
Const CSIDL_RECENT = &H8&
Const CSIDL_SENDTO = &H9&
Const CSIDL_BITBUCKET = &HA&
Const CSIDL_STARTMENU = &HB&
Const CSIDL_DESKTOPDIRECTORY = &H10&
Const CSIDL_DRIVES = &H11&
Const CSIDL_NETWORK = &H12&
Const CSIDL_NETHOOD = &H13&
Public Const CSIDL_FONTS = &H14&

Const CSIDL_TEMPLATES = &H15&
Const MAX_PATH = 260
Private Type SHITEMID
    cb As Long
    abID As Byte
End Type
Private Type ITEMIDLIST
    mkid As SHITEMID
End Type
Private Declare Function SHGetSpecialFolderLocation Lib "shell32.dll" (ByVal hWndOwner As Long, ByVal nFolder As Long, pidl As ITEMIDLIST) As Long
Private Declare Function SHGetPathFromIDList Lib "shell32.dll" Alias "SHGetPathFromIDListA" (ByVal pidl As Long, ByVal pszPath As String) As Long

Public Declare Sub Sleep Lib "KERNEL32" (ByVal dwMilliseconds As Long)

Public Declare Function SetTimer Lib "user32" _
       (ByVal hWND As Long, ByVal nIDEvent As Long, _
        ByVal uElapse As Long, ByVal lpTimerFunc As Long) As Long

Public Declare Sub KillTimer Lib "user32" _
       (ByVal hWND As Long, ByVal nIDEvent As Long)
'Public Type tagInitCommonControlsEx
 ' lngSize As Long
  ' lngICC As Long
'End Type
'Public Declare Function InitCommonControlsEx Lib "comctl32.dll" (iccex As tagInitCommonControlsEx) As Boolean
'Public Const ICC_USEREX_CLASSES = &H200
' APPLICATION TASK MASTER
Public MasterTimer As Double, tickTimer As Double
Public TaskMaster As TaskMaster
Public Declare Function midiOutClose Lib "winmm.dll" (ByVal hMidiOut As Long) As Long
Public Declare Function midiOutOpen Lib "winmm.dll" (lphMidiOut As Long, ByVal uDeviceID As Long, ByVal dwCallback As Long, ByVal dwInstance As Long, ByVal dwFlags As Long) As Long
Public Declare Function midiOutShortMsg Lib "winmm.dll" (ByVal hMidiOut As Long, ByVal dwMsg As Long) As Long
Public hmidi As Long
Public mute As Boolean
Public beat As Long
Public baseNote As Long
Public prof As New clsProfiler
Public Declare Function GetACP Lib "KERNEL32" () As Long  ' 1253 in my computer

Public Declare Function GetLocaleInfoW Lib "KERNEL32" (ByVal Locale As Long, ByVal LCType As Long, ByVal lpLCData As Long, ByVal cchData As Long) As Long
Private Declare Function GetKeyboardLayout& Lib "user32" (ByVal dwLayout&) ' not NT?
Private Const DWL_ANYTHREAD& = 0
Const LOCALE_ILANGUAGE = 1
Public OverideDec As Boolean
'Valid dwCmpFlags
Private Declare Function LCMapStringW Lib "kernel32.dll" (ByVal Locale As Long, ByVal dwMapFlags As Long, ByVal lpSrcStr As Long, ByVal cchSrc As Long, Optional ByVal lpDestStr As Long, Optional ByVal cchDest As Long) As Long
Private Declare Function SysReAllocStringLen Lib "OleAut32.dll" (ByVal pBSTR As Long, Optional ByVal pszStrPtr As Long, Optional ByVal Length As Long) As Long
Public Modalid As Double

Function ChangeValuesArray(bstack As basetask, rest$) As Boolean
Dim aa As mHandler, p As Variant, pppp As mArray, w As Long, s$, ah As String, stiva As mStiva
Dim bs As Long
Set aa = bstack.lastobj
Dim anything As Object
Set anything = aa
If CheckIsmArray(anything) Then
    Set pppp = anything
    Set anything = Nothing
    If Not pppp.Arr Then
        NotArray
        Exit Function
    End If
    bs = pppp.myarrbase
    FastSymbol rest$, ","
    Do
    If IsExp(bstack, rest$, p) Then
    On Error Resume Next
    w = CLng(Fix(p)) + bs
    If Err Then
        Err.Clear
        OutOfLimit
        Exit Function
    End If
    On Error GoTo 0
    If w < 0 Then w = pppp.count - w + bs
    If w > (pppp.count + bs) Then GoTo outlimit
    If w < 0 Then
outlimit:
    MyEr "Index out of limits", "Ο δείκτης είναι εκτός ορίων"
    Exit Function
    End If
    
    If FastSymbol(rest$, ":=", , 2) Then
            
            ah = aheadstatus(rest$, False) + " "
            If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                If Not IsExp(bstack, rest$, p) Then
                    ChangeValuesArray = False
                    GoTo there
                End If
                ChangeValuesArray = True
                If Not bstack.lastobj Is Nothing Then
                    Set pppp.item(w) = bstack.lastobj
                    Set bstack.lastobj = Nothing
                Else
                    pppp.item(w) = p
                End If
                
            ElseIf Left$(ah, 1) = "S" Then
                If Not IsStrExp(bstack, rest$, s$) Then
                    ChangeValuesArray = False
                    GoTo there
                End If
                ChangeValuesArray = True
                If Not bstack.lastobj Is Nothing Then
                    Set pppp.item(w) = bstack.lastobj
                    Set bstack.lastobj = Nothing
                Else
                    pppp.item(w) = s$
                End If
            Else
                    MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                    ChangeValuesArray = False
            End If
    End If
    End If
    Loop Until Not FastSymbol(rest$, ",")
Else
Set bstack.lastobj = aa
If CheckStackObj(bstack, anything) Then
    Set stiva = anything
    Set anything = Nothing
    FastSymbol rest$, ","
    Do
    If IsExp(bstack, rest$, p) Then
    On Error Resume Next
    w = CLng(Fix(p))
    If Err Then
        Err.Clear
        OutOfLimit
        Exit Function
    End If
    On Error GoTo 0
    If w < 0 Then w = stiva.count - w + 1
    If w > stiva.count Then GoTo outlimit
    If w < 0 Then GoTo outlimit
   
    If FastSymbol(rest$, ":=", , 2) Then
            
            ah = aheadstatus(rest$, False) + " "
            If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                If Not IsExp(bstack, rest$, p) Then
                    ChangeValuesArray = False
                    GoTo there
                End If
                ChangeValuesArray = True
                If Not bstack.lastobj Is Nothing Then
                    stiva.MakeTopItem w
                    stiva.drop 1
                    stiva.PushObj bstack.lastobj
                    stiva.MakeTopItemBack w
                    Set bstack.lastobj = Nothing
                Else
                    stiva.MakeTopItem w
                    stiva.drop 1
                    stiva.PushVal p
                    stiva.MakeTopItemBack w
                End If
                
            ElseIf Left$(ah, 1) = "S" Then
                If Not IsStrExp(bstack, rest$, s$) Then
                    ChangeValuesArray = False
                    GoTo there
                End If
                ChangeValuesArray = True
                If Not bstack.lastobj Is Nothing Then
                    stiva.MakeTopItem w
                    stiva.drop 1
                    stiva.PushObj bstack.lastobj
                    stiva.MakeTopItemBack w
                    Set bstack.lastobj = Nothing
                Else
                    stiva.MakeTopItem w
                    stiva.drop 1
                    stiva.PushStr s$
                    stiva.MakeTopItemBack w
                End If
            Else
                    MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                    ChangeValuesArray = False
            End If
    End If
    End If
    Loop Until Not FastSymbol(rest$, ",")
End If
'CheckStackObj
End If
there:
Set anything = Nothing
Set aa = Nothing
End Function

Function ChangeValues(bstack As basetask, rest$) As Boolean
Dim aa As mHandler, bb As FastCollection, ah As String, p As Variant, s$, lastindex As Long
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
Set bb = aa.objref
If bb.StructLen > 0 Then
MyEr "Structure members are ReadOnly", "Τα μέλη της δομής είναι μόνο για ανάγνωση"
Exit Function
End If
If bb.Done And FastSymbol(rest$, ":=", , 2) Then
        ' change one value
        ah = aheadstatus(rest$, False) + " "
        If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
            If Not IsExp(bstack, rest$, p) Then
                ChangeValues = False
                GoTo there
            End If
            ChangeValues = True
            If Not bstack.lastobj Is Nothing Then
                Set bb.ValueObj = bstack.lastobj
                Set bstack.lastobj = Nothing
            Else
                bb.Value = p
            End If
            
        ElseIf Left$(ah, 1) = "S" Then
            If Not IsStrExp(bstack, rest$, s$) Then
                ChangeValues = False
                GoTo there
            End If
            ChangeValues = True
            If Not bstack.lastobj Is Nothing Then
                Set bb.ValueObj = bstack.lastobj
                Set bstack.lastobj = Nothing
            Else
                bb.Value = s$
            End If
        Else
                MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                ChangeValues = False
        End If
        GoTo there

ElseIf MaybeIsSymbol(rest$, ",") Then
    Do While FastSymbol(rest$, ",")
        ChangeValues = True
        ah = aheadstatus(rest$, False) + " "
        If InStr(ah, "l") Then
                MyEr "Found logical expression", "Βρήκα λογική έκφραση"
                ChangeValues = False
        Else
                If Left$(ah, 1) = "N" Then
                    If Not IsExp(bstack, rest$, p) Then
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bb.Find(p) Then
                         MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    
                ElseIf Left$(ah, 1) = "S" Then
                    If Not IsStrExp(bstack, rest$, s$) Then
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                    If Not bb.Find(s$) Then
                          MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                    End If
                Else
                        MyEr "No Key found", "Δεν βρέθηκε κλειδί"
                        ChangeValues = False
                        GoTo there
                
                End If
lastindex = bb.index
                
                If FastSymbol(rest$, ":=", , 2) Then
                    ah = aheadstatus(rest$, False) + " "
                    If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                        If Not IsExp(bstack, rest$, p) Then
                            ChangeValues = False
                            GoTo there
                        End If
                        ChangeValues = True
                        bb.index = lastindex
                        If Not bstack.lastobj Is Nothing Then
                            Set bb.ValueObj = bstack.lastobj
                            Set bstack.lastobj = Nothing
                        Else
                            bb.Value = p
                        End If
                ElseIf Left$(ah, 1) = "S" Then
                        If Not IsStrExp(bstack, rest$, s$) Then
                            ChangeValues = False
                            GoTo there
                        End If
                        ChangeValues = True
                        bb.index = lastindex
                        If Not bstack.lastobj Is Nothing Then
                            Set bb.ValueObj = bstack.lastobj
                            Set bstack.lastobj = Nothing
                        Else
                            bb.Value = s$
                        End If
                Else
                        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                        ChangeValues = False
                End If
                End If
        End If
    Loop
ElseIf bb.Done Then
If Not bstack.soros.IsEmpty Then
With bstack.soros
If .StackItemTypeIsObject(1) Then
Set bb.ValueObj = .PopObj

Else
bb.Value = .StackItem(1)
.drop 1
End If
End With
ChangeValues = True
Else

End If
Set bstack.lastobj = Nothing
End If


there:
Set bb = Nothing
Set aa = Nothing
End Function


Function ChangeValuesMem(bstack As basetask, rest$, Lang As Long) As Boolean
Dim aa As mHandler, ah As String, p As Variant, s$, addr As Long, PP As Variant, what$, r As Double
Dim bb1 As MemBlock, w2 As Variant, rs As Single, itissingle As Boolean
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
Set bb1 = aa.objref

    Do While FastSymbol(rest$, ",")
    
        ChangeValuesMem = False
        PP = bb1.ItemSize
        ah = aheadstatus(rest$, False) + " "
        If InStr(ah, "l") Then
                MyEr "Found logical expression", "Βρήκα λογική έκφραση"
        Else
                If Left$(ah, 1) = "N" Then
                    If Not IsExp(bstack, rest$, p) Then
                        GoTo there
                    End If
                    If Not bstack.lastobj Is Nothing Then
                         MyEr "Οffset Null for buffer", "Διεύθυνση 0 για Διάρθρωση"
                        GoTo there
                    End If
                    If FastSymbol(rest$, "!") Then
                    
                    If IsLabelOnly(rest$, what$) Then
                        If bb1.UseStruct Then
                                If bb1.structref.Find(myUcase(what$, True)) Then
                                    PP = bb1.structref.sValue
                                    itissingle = bb1.structref.KeyTypeValue = vbSingle
                                    If FastSymbol(rest$, "!") Then
                                        If Not IsExp(bstack, rest$, r) Then
                                                 GoTo there
                                        ElseIf r >= 0 Then
                                                 p = bb1.GetPtr(p) + bb1.structref.Value + Int(r) * Abs(PP)
                                        Else
                                                 MyEr "negative index", "αρνητικός δείκτη"
                                                GoTo there
                                        End If
                                    Else
                                    
                                    p = bb1.GetPtr(p) + bb1.structref.Value
                                    End If
                                    
                                Else
                                rest$ = what$ + rest$
                                If IsExp(bstack, rest$, r) Then
                                        p = bb1.GetPtr(p) + r
                                        
                                    Else
                                    MyErMacro rest$, "Unknown Offset " & what$, "’γνωστη Μετάθεση " & what$
                                    GoTo there
                                End If
                           End If
                        Else
                                If IsExp(bstack, what$, r) Then
                                    p = bb1.GetPtr(p) + r
                                Else
                                    GoTo there
                                End If
                        End If
                        Else
                        p = bb1.GetBytePtr(p)
                        End If
                        
          
                    Else
                                                
                        p = bb1.GetPtr(p)
                        itissingle = bb1.WhatAreBasicItem = vbSingle
                    End If
                    If p = 0 Then
                        MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                          GoTo there
                    End If
                    addr = CLng(Fix(p))
                
                    
                Else

                        MyEr "No Offset found", "Δεν βρέθηκε Διεύθυνση"
                          GoTo there
                
                End If
                If FastSymbol(rest$, ":=", , 2) Then
                    ah = aheadstatus(rest$, False) + " "
                    If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
                        If Not IsExp(bstack, rest$, p) Then
                            GoTo there
                        End If
                        
                        If Not bstack.lastobj Is Nothing Then
                            MyEr "No objects for buffer", "Όχι αντικείμενα για Διάρθρωση"
                            GoTo there
                  
                        Else
                                If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                        
                                    GoTo there
                                Else
                                ' this ia a part to poke some data to buffer
                                 If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                        
                                    GoTo there
                                Else
                            ' here is the part where we copy a string to memblock
                            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, , , , False) Then
                                If IsLabelSymbolNew(rest$, "ΨΗΦΙΟ", "BYTE", Lang, , , , False) Then
                                    PP = 1
                                ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                                    PP = 2
                                ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                                    PP = 4
                                ElseIf IsLabelSymbolNew(rest$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                                    PP = 4
                                    itissingle = True
                                ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                                    PP = 8
                                Else
                                    SyntaxError
                 
                                   GoTo there
                                End If
                                                          
                            End If
                            Err.Clear
                            On Error Resume Next
                           Select Case PP
                           Case 1
                           ChangeValuesMem = True
                           PutMem1 addr, CByte(LowWord(signlong(p)) And &HFF)
                           Case 2
                           If bb1.ValidArea(addr, 2) Then
                           ChangeValuesMem = True
                            PutMem2 addr, CInt(LowWord(signlong(p)))
                           Else
                            MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                            GoTo there
                           End If
                           Case 4
                           If bb1.ValidArea(addr, 4) Then
                           ChangeValuesMem = True
                                If itissingle Then
                                    rs = CSng(p)
                                    PutMemS addr, rs
                                Else
                                    PutMem4 addr, signlong(p)
                                End If
                           Else
                                MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                                GoTo there
                           End If
                           Case 8
                           If bb1.ValidArea(addr, 8) Then
                           ChangeValuesMem = True
                                PutMem8 addr, p
                           Else
                                MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                                GoTo there
                           End If
                           Case Else
                           End Select
                           If Err <> 0 Then
                           MyEr "Overflow. Problem in Buffer", "Υπερχείλιση. Πρόβλημα στη Διάρθρωση"
                           GoTo there
                           End If
                            
                            End If
                                End If
                           End If
                    ElseIf Left$(ah, 1) = "S" Then
                        If Not IsStrExp(bstack, rest$, s$) Then
                            GoTo there
                        End If
                        If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, , , , False) Then
                                If IsLabelSymbolNew(rest$, "ΓΡΑΜΜΑ", "STRING", Lang, , , , False) Then
                                    PP = -4
                                Else
                                    SyntaxError
                 
                                   GoTo there
                                End If
                                                          
                            End If
                        
                        If Not bstack.lastobj Is Nothing Then
                        
                         MyEr "No objects for buffer", "Όχι αντικείμενα για Διάρθρωση"
                            GoTo there
                            
                        Else
                                If addr = 0 Then
                                    MyEr "Οffset Null or not for buffer", "Διεύθυνση 0 ή εκτός Διάρθρωσης"
                                    GoTo there
                                Else
                            ' here is the part where we copy a string to memblock
                            Err.Clear
                            On Error Resume Next
                          If PP < 0 Or bb1.WhatAreBasicItem = vbString Then
                          If bb1.ValidArea(addr, 4) Then
                          ChangeValuesMem = True
                            PutMem4 addr, CLng(bb1.PutStringAtOffset(addr, s$))
                          End If
                          Else
                      
                           If bb1.ValidArea(addr, LenB(s$)) Then
                           ChangeValuesMem = True
                           CopyBytes LenB(s$), addr, StrPtr(s$)
                     
                           Else
                            MyEr "Buffer is small", "Η Διάρθρωση είναι μικρή"
                            GoTo there
                           End If
                        End If
                           If Err <> 0 Then
                           ChangeValuesMem = False
                           MyEr "Overflow. Problem in Buffer", "Υπερχείλιση. Πρόβλημα στη Διάρθρωση"
                           GoTo there
                           End If
                            
                            End If
                        
                        End If
                Else
                        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
                       GoTo there
                End If
                End If
        End If
    Loop


there:

Set bb1 = Nothing
Set aa = Nothing
End Function


Private Function CopyArray(a As Object) As Variant
 Dim pppp1 As mArray
     Set pppp1 = New mArray
     a.CopyArray pppp1
     Set a = Nothing
     Set CopyArray = pppp1
     Set pppp1 = Nothing
End Function



Public Function kUpper(a$, p As Variant) As String
'idea from Bonnie West, FROM VBFORUMS
Dim nsize As Long
    nsize = Len(a$)
    If nsize Then SysReAllocStringLen VarPtr(kUpper), , nsize Else Exit Function
    Const LCMAP_UPPERCASE = &H200&
Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
If p = 1032 Then
If osnum >= System_Windows_Vista Then a$ = Replace(a$, "ς", "Σ")
Dim i As Long
For i = 1 To Len(a$)
Select Case AscW(Mid$(a$, i, 1))
Case 902
Mid$(a$, i, 1) = ChrW(913)
Case 904
Mid$(a$, i, 1) = ChrW(917)
Case 906
Mid$(a$, i, 1) = ChrW(921)
Case 912
Mid$(a$, i, 1) = ChrW(921)
Case 905
Mid$(a$, i, 1) = ChrW(919)
Case 908
Mid$(a$, i, 1) = ChrW(927)
Case 911
Mid$(a$, i, 1) = ChrW(937)
Case 910
Mid$(a$, i, 1) = ChrW(933)
Case 940
Mid$(a$, i, 1) = ChrW(913)
Case 941
Mid$(a$, i, 1) = ChrW(917)
Case 943
Mid$(a$, i, 1) = ChrW(921)
Case 942
Mid$(a$, i, 1) = ChrW(919)
Case 972
Mid$(a$, i, 1) = ChrW(927)
Case 974
Mid$(a$, i, 1) = ChrW(937)
Case 973
Mid$(a$, i, 1) = ChrW(933)
Case 962
If osnum >= System_Windows_Vista Then
Mid$(a$, i, 1) = ChrW(963)
Else
Mid$(a$, i, 1) = ChrW(931)
End If
End Select

Next i
End If
    nsize = LCMapStringW(mLid, LCMAP_UPPERCASE, StrPtr(a$), nsize, StrPtr(kUpper), nsize)
End Function

Public Function kUpper2(a$, p As Variant) As String
'idea from Bonnie West, FROM VBFORUMS
Dim nsize As Long
    nsize = Len(a$)
    If nsize Then SysReAllocStringLen VarPtr(kUpper2), , nsize Else Exit Function
    Const LCMAP_UPPERCASE = &H200&
Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
If p = 1032 Then
''If osnum >= System_Windows_Vista Then a$ = Replace(a$, "ς", "Σ")
Dim i As Long
For i = 1 To Len(a$)
 Select Case AscW(Mid$(a$, i, 1))
Case 902
Mid$(a$, i, 1) = ChrW(913)
Case 904
Mid$(a$, i, 1) = ChrW(917)
Case 906
Mid$(a$, i, 1) = ChrW(921)
Case 912
Mid$(a$, i, 1) = ChrW(921)
Case 905
Mid$(a$, i, 1) = ChrW(919)
Case 908
Mid$(a$, i, 1) = ChrW(927)
Case 911
Mid$(a$, i, 1) = ChrW(937)
Case 910
Mid$(a$, i, 1) = ChrW(933)
Case 940
Mid$(a$, i, 1) = ChrW(913)
Case 941
Mid$(a$, i, 1) = ChrW(917)
Case 943
Mid$(a$, i, 1) = ChrW(921)
Case 942
Mid$(a$, i, 1) = ChrW(919)
Case 972
Mid$(a$, i, 1) = ChrW(927)
Case 974
Mid$(a$, i, 1) = ChrW(937)
Case 973
Mid$(a$, i, 1) = ChrW(933)
Case 962
Mid$(a$, i, 1) = ChrW(931)
End Select
Next i


End If
    nsize = LCMapStringW(mLid, LCMAP_UPPERCASE, StrPtr(a$), nsize, StrPtr(kUpper2), nsize)
End Function
Public Function klower(a$, p As Variant) As String
Const LCMAP_LOWERCASE As Long = &H100
Dim nsize As Long
    nsize = Len(a$)
    If nsize Then SysReAllocStringLen VarPtr(klower), , nsize Else Exit Function

Dim mLid As Long
If p = 0 Then
mLid = cLid
Else
mLid = p
End If
nsize = LCMapStringW(mLid, LCMAP_LOWERCASE, StrPtr(a$), nsize, StrPtr(klower), nsize)
If p = 1032 Then
a$ = a$ & Chr(0)
a$ = Replace(a$, "σ" & Chr(0), "ς")
a$ = Replace(a$, Chr(0), "")
a$ = Replace(a$, "σ ", "ς ")
a$ = Replace(a$, "σ$", "ς$")
a$ = Replace(a$, "σ&", "ς&")
a$ = Replace(a$, "σ.", "ς.")
a$ = Replace(a$, "σ(", "ς(")
a$ = Replace(a$, "σ_", "ς_")
a$ = Replace(a$, "σ/", "ς/")
a$ = Replace(a$, "σ\", "ς\")
a$ = Replace(a$, "σ-", "ς-")
a$ = Replace(a$, "σ+", "ς+")
a$ = Replace(a$, "σ*", "ς*")
a$ = Replace(a$, "σ" & vbCr, "ς" & vbCr)
a$ = Replace(a$, "σ" & vbLf, "ς" & vbLf)


End If
klower = a$
End Function



Public Function GetSpecialfolder(CSIDL As Long) As String
    Dim r As Long
    Dim IDL As ITEMIDLIST, NoError As Long, path$
    'Get the special folder
    r = SHGetSpecialFolderLocation(100, CSIDL, IDL)
    If r = NoError Then
        'Create a buffer
        path$ = Space$(512)
        'Get the path from the IDList
        r = SHGetPathFromIDList(ByVal IDL.mkid.cb, ByVal path$)
        'Remove the unnecessary chr$(0)'s
        GetSpecialfolder = mylcasefILE(Left$(path, InStr(path, Chr$(0)) - 1))
        Exit Function
    End If
    GetSpecialfolder = vbNullString
End Function
Sub MakeArray(basestack As basetask, frm$, o As Long, rest$, pppp As mArray, Optional lcl As Boolean = False, Optional globalonly As Boolean = False) 'global
Dim p As Variant, x As Variant, i As Long, F As Long, s$
If MaybeIsSymbol(rest$, ")") Then rest$ = "0" + rest$
    Select Case o
    Case 5, 6, 7
    If lcl Then
    
      GlobalArr basestack, here$ & "." + basestack.GroupName & frm$, rest$, i, F, True
    Else
    GlobalArr basestack, basestack.GroupName & frm$, rest$, i, F, True, , globalonly
    End If
    p = i
    If i < 0 Then o = 0
    Case Else
    o = 0
    End Select

    
    Select Case o
    Case 5
        x = 0
      If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
    
    If neoGetArray(basestack, frm$, pppp, , globalonly, Not lcl) Then   '' basestack.GroupName & f
         If Not basestack.lastobj Is Nothing Then
                                If Typename(basestack.lastobj) = "Group" Then
                                    If basestack.lastobj.IamSuperClass Then
                                Set pppp.GroupRef = basestack.lastobj.SuperClassList
                            Else
                                Set pppp.GroupRef = basestack.lastobj
                                End If
                                 pppp.IHaveClass = True
                                Set basestack.lastobj = Nothing
                                pppp.SerialItem 0, 0, 3
                                End If
     Else
            pppp.SerialItem x, 0, 3
    End If
    End If
    Else
    o = 0
    End If
    End If

    Case 7
    x = 0
    If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
   If neoGetArray(basestack, frm$, pppp, , Not lcl) Then  '' basestack.GroupName &
    pppp.SerialItem Int(x), 0, 3
    End If
    Else
    o = 0
    End If
    End If
    Case 6
        s$ = vbNullString
    If FastSymbol(rest$, "=") Then
    If IsStrExp(basestack, rest$, s$) Then
   If neoGetArray(basestack, frm$, pppp, , Not lcl) Then ''basestack.GroupName &
    pppp.SerialItem s$, 0, 3
    End If
    Else
    o = 0
    End If
    End If
    End Select
    If o = 0 Then
      MyEr "Array dimensions missing ", "Ο πίνακας δεν έχει διαστάσεις "
    rest$ = basestack.GroupName & frm$ & rest$
    End If
End Sub


Sub MyMode(Scr As Object)
Dim x1 As Long, y1 As Long
On Error Resume Next
With players(GetCode(Scr))
    x1 = Scr.Width
    y1 = Scr.Height
    If Typename(Scr) Like "Gui*" Then
    Else
    If Scr.name = "Form1" Then
    DisableTargets q(), -1
    
    ElseIf Scr.name = "DIS" Then
    DisableTargets q(), 0
    
    ElseIf Scr.name = "dSprite" Then
    DisableTargets q(), val(Scr.index)
    End If
    End If
    If .SZ < 4 Then .SZ = 4
        Err.Clear
        Scr.Font.Size = .SZ
        If Err.Number > 0 Then
                MYFONT = "ARIAL"
                Scr.Font.name = MYFONT
                Scr.Font.charset = .charset
                Scr.Font.name = MYFONT
                Scr.Font.charset = .charset
        End If
        .uMineLineSpace = .MineLineSpace
        FrameText Scr, .SZ, x1, y1, .Paper
    .currow = 0
    .curpos = 0
    .XGRAPH = 0
    .YGRAPH = 0
End With
End Sub

Function ProcSave(basestack As basetask, rest$, Lang As Long) As Boolean
Dim pa$, w$, s$, col As Long, prg$, x1 As Long, par As Boolean, i As Long, noUse As Long, lcl As Boolean
On Error Resume Next
If lckfrm <> 0 Then MyEr "Save is locked", "Η αποθήκευση είναι κλειδωμένη": rest$ = vbNullString: Exit Function
lcl = IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", Lang) Or basestack.IamChild Or basestack.IamAnEvent
x1 = Abs(IsLabelFileName(basestack, rest, pa$, , s$))

If x1 <> 1 Then
rest$ = pa$ + rest$: x1 = IsStrExp(basestack, rest$, pa$)
Else
pa$ = s$: s$ = vbNullString
End If

If x1 <> 0 Then
        If subHash.count = 0 Or pa$ = vbNullString Then MyEr "Nothing to save", "Δεν υπάρχει κάτι να σώσω":              Exit Function
        If ExtractType(pa$) = "gsb" Then pa$ = ExtractPath(pa$) + ExtractNameOnly(pa$)
        If ExtractPath(pa$) <> "" Then
                If InStr(ExtractPath(pa$), mcd) <> 1 Then pa$ = pa$ & ".gsb" Else pa$ = pa$ & ".gsb"
        Else
                pa$ = mcd + pa$ & ".gsb"
        End If
        If Not WeCanWrite(pa$) Then Exit Function
        
      
           For i = subHash.count - 1 To 0 Step -1
       subHash.ReadVar i, s$, col
                If Right$(s$, 2) = "()" Then
                If Not InStr(s$, ChrW(&H1FFF)) > 0 Then
                s$ = Left$(s$, Len(s$) - 2)
                
                If Right$(sbf(col).sb, 2) <> vbCrLf Then sbf(col).sb = sbf(col).sb + vbCrLf
                If Lang Then
                
                        If Not blockCheck(sbf(col).sb, DialogLang, noUse, "Function " & s$ + "()" + vbCrLf) Then Exit Function
                                prg$ = s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                                If lcl Then
                                    prg$ = "FUNCTION " + prg$
                                Else
                                    prg$ = "FUNCTION GLOBAL " + prg$
                                End If
                        Else
                                If Not blockCheck(sbf(col).sb, DialogLang, noUse, "Συνάρτηση " & s$ + "()" + vbCrLf) Then Exit Function
                                prg$ = s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                                If lcl Then
                                    prg$ = "ΣΥΝΑΡΤΗΣΗ " + prg$
                                Else
                                    prg$ = "ΣΥΝΑΡΤΗΣΗ ΓΕΝΙΚΗ " + prg$
                                End If
                        End If
                End If
                Else
                        If Right$(sbf(col).sb, 2) <> vbCrLf Then sbf(col).sb = sbf(col).sb + vbCrLf
                        If Lang Then
                                If Not blockCheck(sbf(col).sb, DialogLang, noUse, "Module " & s$ + vbCrLf) Then Exit Function
                                prg$ = s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                                If lcl Then
                                    prg$ = "MODULE " + prg$
                                Else
                                    prg$ = "MODULE GLOBAL " + prg$
                                End If
                        Else
                                If Not blockCheck(sbf(col).sb, DialogLang, noUse, "Τμήμα " & s$ + vbCrLf) Then Exit Function
                                prg$ = s$ & " {" & sbf(col).sb & "}" & vbCrLf + prg$
                                If lcl Then
                                    prg$ = "ΤΜΗΜΑ " + prg$
                                Else
                                    prg$ = "ΤΜΗΜΑ ΓΕΝΙΚΟ " + prg$
                                End If
                        End If
                End If
        Next i
        w$ = vbNullString
        If FastSymbol(rest$, "@@", , 2) Then
            ' default password  - one space only - coder use default internal password
                If Not IsStrExp(basestack, rest$, w$) Then w$ = " "
        ElseIf FastSymbol(rest$, "@") Then
                ' One space only
                w$ = " "
        End If
        par = False
        If FastSymbol(rest$, ",") Then
                If Abs(IsLabel(basestack, rest$, s$)) = 1 Then
                        prg$ = prg$ & s$
                ElseIf FastSymbol(rest$, "{") Then
                        prg$ = prg$ & block(rest$)
                        If Not FastSymbol(rest$, "}") Then Exit Function
                End If
        End If
        ' reuse s$, col$
        If Len(w$) > 1 Then  'scrable col by George
                s$ = vbNullString: For col = 1 To Int((33 * Rnd) + 1): s$ = s$ & Chr(65 + Int((23 * Rnd) + 1)): Next col
                ' insert a variable length label......to make a variable length file
                prg$ = s$ & ":" & vbCrLf + prg$
                prg$ = mycoder.encryptline(prg$, w$, Len(prg$) Mod 33)
                par = True
        ElseIf Len(w$) = 1 Then   ' I have to check that...
                s$ = vbNullString:   For col = 1 To Int((33 * Rnd) + 1): s$ = s$ & Chr(65 + Int((23 * Rnd) + 1)): Next col
                prg$ = s$ & ":" & vbCrLf + prg$
                prg$ = mycoder.must1(prg$)
                par = True
        End If
        s$ = vbNullString
        If CFname(pa$) <> "" Then
                If Lang = 1 Then
                        If MsgBoxN("Replace " + ExtractNameOnly(pa$), vbOKCancel, MesTitle$) <> vbOK Then
                        MyEr "File not saved -1005", "Δεν σώθηκε το αρχείο -1005"
                        ProcSave = True
                        Exit Function
                        End If
                Else
                        If MsgBoxN("Αλλαγή " + ExtractNameOnly(pa$), vbOKCancel, MesTitle$) <> vbOK Then
                        MyEr "File not saved -1005", "Δεν σώθηκε το αρχείο -1005"
                        ProcSave = True
                        Exit Function
                        End If
                End If
                s$ = "*"
        End If
        If Not WeCanWrite(pa$) Then Exit Function
        If par Then
                If s$ = "*" Then
                       '' If CFname(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck") <> "" Then killfile GetDosPath(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"): Sleep 30
                        MakeACopy pa$, ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"
                End If
                If Not SaveUnicode(pa$, prg$, 0) Then BadFilename
                Else
                If s$ <> "" Then
                        ''If CFname(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck") <> "" Then killfile GetDosPath(ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"):  Sleep 30
                        MakeACopy pa$, ExtractPath(pa$) & ExtractNameOnly(pa$) & ".bck"
                End If
                ProcSave = SaveUnicode(pa$, prg$, 2)  ' 2 = utf-8 standard save mode for version 7
                If here$ = vbNullString Then LASTPROG$ = pa$
        End If
 ProcSave = True
Else
MyEr "A name please or use Ctrl+A to perform SAVE COMMAND$  (the last loading)", "Ένα όνομα παρακαλώ, ή πάτα το ctrl+Α για να αποθηκεύσεις με το όνομα του προγράμματος που φορτώθηκε τελευταία"
End If

End Function

Function MySwap(bstack As basetask, rest$, Lang As Long) As Boolean
Dim s$, ss$, F As Long, col As Long, x1 As Long, i As Long, pppp As mArray, pppp1 As mArray
    F = Abs(IsLabel(bstack, rest$, s$))
    MySwap = True
    If F = 1 Or F = 4 Then col = 1
    If F = 5 Or F = 7 Then col = 2
    If F = 0 Then MissingnumVar:  Exit Function
    If (F = 3 Or F = 6) And col > 0 Then SyntaxError: MySwap = False:    Exit Function
    If col = 1 Then
        If GetVar(bstack, s$, F) Then
                If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
              If i = 1 Or i = 4 Then
                If GetVar(bstack, ss$, x1) Then
         If MyIsObject(var(F)) Then
            If TypeOf var(F) Is Constant Then
            CantAssignValue
            MySwap = False: Exit Function
            End If
        End If
        If MyIsObject(var(x1)) Then
            If TypeOf var(x1) Is Constant Then
            CantAssignValue
            MySwap = False: Exit Function
            End If
        End If
                    SwapVariant var(F), var(x1)
                    
                    
                Exit Function
                Else
                    Nosuchvariable ss$
                    MySwap = False
                    Exit Function
                End If
            ElseIf i = 5 Or i = 7 Then
                If neoGetArray(bstack, ss$, pppp) Then
                If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, ss$, x1, rest$, True) Then Exit Function
                        If MyIsObject(var(F)) Then
                            If TypeOf var(F) Is Constant Then
                            CantAssignValue
                            MySwap = False: Exit Function
                            End If
                        End If
                    SwapVariant2 var(F), pppp, x1
                    
                    
                Else
                
                    NoSwap ss$
                    MySwap = False
                    Exit Function
                End If
            Else
                MissingnumVar
                MySwap = False
                Exit Function
            End If
        Else
            Nosuchvariable s$
            
            Exit Function
        End If
    ElseIf col = 2 Then
        If neoGetArray(bstack, s$, pppp) Then
        If Not pppp.Arr Then NotArray: Exit Function
        If Not NeoGetArrayItem(pppp, bstack, s$, F, rest$) Then Exit Function
            If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
                  
            If i = 1 Or i = 4 Then
                    If GetVar(bstack, ss$, x1) Then
                    If pppp.IHaveClass Then
                            NoSwap ""
                    Else
                             If MyIsObject(var(x1)) Then
                                If TypeOf var(x1) Is Constant Then
                                CantAssignValue
                                MySwap = False: Exit Function
                                End If
                            End If
                    
                    
                         SwapVariant2 var(x1), pppp, F
                     End If
                        
                    Else
                        MissingnumVar
                        MySwap = False
                        Exit Function
                    End If
            ElseIf i = 5 Or i = 7 Then
                    If neoGetArray(bstack, ss$, pppp1) Then
                    If Not pppp1.Arr Then NotArray: Exit Function
                        If Not NeoGetArrayItem(pppp1, bstack, ss$, x1, rest$) Then Exit Function
                   If pppp.IHaveClass Xor Not pppp1.IHaveClass Then
                            
                        SwapVariant3 pppp, F, pppp1, x1
                        If pppp.IHaveClass Then
                            Set pppp.item(F).LinkRef = pppp1.GroupRef
                            Set pppp1.item(x1).LinkRef = pppp.GroupRef
                            End If
                        Else
                        NoSwap ""
                        Exit Function
                        End If
                        
                    Else
                        MissingnumVar
                        
                        Exit Function
                    End If
            Else
                MissingnumVar
                
                Exit Function
            End If
        Else
            MissingnumVar
            
            Exit Function
        End If
    ElseIf F = 3 Then
            If GetVar(bstack, s$, F) Then
            If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
                 If i = 6 Then
                    If Not neoGetArray(bstack, ss$, pppp) Then MissingStrVar:  Exit Function
                    If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, ss$, x1, rest$) Then Exit Function
                     If MyIsObject(var(F)) Then
                        If TypeOf var(F) Is Constant Then
                        CantAssignValue
                        MySwap = False: Exit Function
                        End If
                    End If
                    SwapVariant2 var(F), pppp, x1

                ElseIf i = 3 Then
                    If Not GetVar(bstack, ss$, x1) Then: Exit Function
                     If MyIsObject(var(F)) Then
                        If TypeOf var(F) Is Constant Then
                        CantAssignValue
                        MySwap = False: Exit Function
                        End If
                    End If
                   SwapVariant var(F), var(x1)
                Else
                MissFuncParameterStringVar
                MySwap = False
                End If
                
                
            Else
                    
                    MissFuncParameterStringVar
                    MySwap = False
            End If
    ElseIf F = 6 Then
            If neoGetArray(bstack, s$, pppp) Then
            If Not pppp.Arr Then NotArray: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, s$, x1, rest$) Then Exit Function
                If Not FastSymbol(rest$, ",") Then MissingnumVar:  Exit Function
                i = Abs(IsLabel(bstack, rest$, ss$))
     
                If i = 6 Then
                    If Not neoGetArray(bstack, ss$, pppp1) Then MissingStrVar:  Exit Function
                    If Not pppp.Arr Then NotArray: Exit Function
                    If Not NeoGetArrayItem(pppp1, bstack, ss$, i, rest$) Then Exit Function

                   SwapVariant3 pppp, x1, pppp1, i
 
                ElseIf i = 3 Then
                    If Not GetVar(bstack, ss$, i) Then: Exit Function
                    If MyIsObject(var(i)) Then
                        If TypeOf var(i) Is Constant Then
                        CantAssignValue
                        MySwap = False: Exit Function
                        End If
                    End If


                  SwapVariant2 var(i), pppp, x1
                    Else
                MissFuncParameterStringVar
                MySwap = False
                End If
                
                
            Else
                
                MissPar
                MySwap = False
                
            End If
    Else
                 
                MissPar
                MySwap = False
    End If
    Exit Function

End Function

Public Sub PushStage(basestack As basetask, dummy As Boolean)
        With basestack.RetStack
               basestack.SubLevel = basestack.SubLevel + 1

                If dummy Then
                        .PushVal 0
                        .PushVal 0
                        .PushVal 0
                        .PushVal 0
                        .PushVal -2
                Else
                        .PushVal CDbl(subHash.count)
                        .PushVal CDbl(varhash.count)
                        .PushVal CDbl(sb2used)
                        .PushVal CDbl(var2used)
                        .PushVal -1
End If
        End With
       
End Sub
Public Sub PopStage(basestack As basetask)
        With basestack.RetStack
        If .LookTopVal = -1 Then
        basestack.SubLevel = basestack.SubLevel - 1
       .drop 1
            var2used = CLng(.PopVal)
            sb2used = CLng(.PopVal)
            varhash.ReduceHash CLng(.PopVal), var()
            subHash.ReduceHash CLng(.PopVal), sbf()
        ElseIf .LookTopVal = -2 Then
        basestack.SubLevel = basestack.SubLevel - 1
        .drop 5
        End If
        End With
End Sub

Private Sub ProcessOperFlat(bstack As basetask, Second As Object, oper$, r As Variant, Lang As Long)
Dim it As Long, ok As Boolean


End Sub

Private Sub ProcessOper(bstack As basetask, first As Object, oper$, r As Variant, Lang As Long)
Dim where As Long, w$, ok As Boolean
Dim soroslen As Long, flag As Boolean, backup As Object
flag = Not first Is Nothing
PushStage bstack, False

soroslen = bstack.soros.Total
If soroslen < 0 Then SyntaxError: Exit Sub
' if flag Then bstack.soros.PushObj first
' change in Version 9.2 revision 3
 If flag Then
 Set backup = bstack.lastobj
 bstack.soros.PushObj bstack.lastobj
 Set bstack.lastobj = first
 End If
where = AllocVar()  '' var(where)
w$ = ChrW(&H1FFF) + CStr(where)
If here$ <> "" Then
varhash.ItemCreator here$ + "." + bstack.GroupName + w$, where
UnFloatGroup bstack, w$, where, bstack.lastobj
Else
varhash.ItemCreator w$, where
UnFloatGroup bstack, w$, where, bstack.lastobj, True
End If
var(where).FloatGroupName = w$
NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + oper$ + "()", ok
If soroslen < bstack.soros.Total Then
    If soroslen + 1 = bstack.soros.Total And flag Then
    r = bstack.soros.PopVal
   If ok Then
   Set bstack.lastobj = Nothing
   ElseIf flag Then
   ' when we add two groups which we don't define operator now set result as the last group
       Set bstack.lastobj = backup
   End If
    bstack.DropNdot 2
    PopStage bstack
    Exit Sub
    End If
End If
If ok Then Set bstack.lastobj = CopyGroupObj(var(where)) Else Set bstack.lastobj = Nothing
bstack.DropNdot 2
PopStage bstack
End Sub

Sub scrMove00(Scr As Object, Optional ByVal w As Variant, Optional ByVal h As Variant)
If TypeOf Scr Is Form Then
If IsMissing(w) And IsMissing(h) Then
Scr.Move ScrInfo(Console).Left, ScrInfo(Console).Top
Else
Scr.Move ScrInfo(Console).Left, ScrInfo(Console).Top, w, h
End If
Else
 If IsMissing(w) And IsMissing(h) Then
Scr.Move 0, 0
Else
Scr.Move 0, 0, w, h
End If
End If
End Sub

Function SizeY(bstack As basetask, SG, a$, s$, s1$, r As Variant) As Boolean
Dim r2 As Variant, r3 As Variant
    If IsStrExp(bstack, a$, s$) Then
    If Not FastSymbol(a$, ",") Then: MissParam a$: SizeY = False: Exit Function
    If Not IsStrExp(bstack, a$, s1$) Then: MissParam a$: SizeY = False: Exit Function
    If Not FastSymbol(a$, ",") Then: MissParam a$: SizeY = False: Exit Function
    If Not IsExp(bstack, a$, r2) Then: MissParam a$: SizeY = False: Exit Function
    r3 = 0
    If FastSymbol(a$, ",") Then
    If Not IsExp(bstack, a$, r3) Then
         MissParam a$: SizeY = False: Exit Function
    End If

    End If
    On Error Resume Next
    r = nTextY(bstack, s$, s1$, CSng(r2), r3)
    If Err.Number > 0 Then r = 0
    On Error GoTo 0
    If SG < 0 Then r = -r
    
 
    
    SizeY = FastSymbol(a$, ")", True)
    End If
End Function

Function SizeX(bstack As basetask, SG, a$, s$, s1$, r As Variant) As Boolean
Dim r2 As Variant, r3 As Variant
    If IsStrExp(bstack, a$, s$) Then
    If Not FastSymbol(a$, ",") Then SizeX = False: Exit Function
    If Not IsStrExp(bstack, a$, s1$) Then SizeX = False: Exit Function
    If Not FastSymbol(a$, ",") Then SizeX = False: Exit Function
    If Not IsExp(bstack, a$, r2) Then SizeX = False: Exit Function
    r3 = 0
    If FastSymbol(a$, ",") Then If Not IsExp(bstack, a$, r3) Then SizeX = False: Exit Function
    On Error Resume Next
    r = nText(bstack, s$, s1$, CSng(r2), r3)
    If Err.Number > 0 Then r = 0
    On Error GoTo 0
    If SG < 0 Then r = -r
    
    
    SizeX = FastSymbol(a$, ")", True)
    End If

End Function

Private Function SpeedGroup(bstack As basetask, pppp As mArray, Prefix$, ByVal w$, b$, v As Long) As Long
Dim Vars As Long, VName As Long, y1 As Long, subs As Long, snames As Long, i As Long, ec$, ohere$, p As Variant
Dim depth As Long, loopthis As Boolean, subspoint As Boolean, RetStackSize As Long, S3 As Long, Rest1$, vvv As Long
Dim safegroup As Group
Dim kolpo As Boolean, bb$, once As Boolean, dd As Variant, subsfc As FastCollection
Vars = var2used: VName = varhash.count
subs = sb2used: snames = subHash.count
Dim mm As mStiva, tempRef As Object
If Prefix = "VAL" Then
' we stand as right value...
If pppp Is Nothing Then Exit Function

ec$ = w$ + ")"
If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))

        
       
        
        If Not MyIsObject(pppp.item(v)) Then
            GoTo fastexit
        End If
        
         
        Set safegroup = pppp.item(v)
        If safegroup Is Nothing Then GoTo fastexit
        If safegroup.IamApointer Then
        
        
        
        If safegroup.lasthere <> vbNullString And safegroup.GroupName <> "" Then
            w$ = safegroup.lasthere + "." + safegroup.GroupName
            b$ = w$ + b$
            If Not IsNumber(bstack, b$, p) Then
                SpeedGroup = 0
                GoTo fastexit
                    End If
                    
            bstack.LastValue = p
            
            'here$ = ohere$
            SpeedGroup = 1
            Exit Function
        End If
        ' check for iamglobal ??
If safegroup.LastOpen <> vbNullString Then
        If GetVar(bstack, (safegroup.LastOpen), y1, True) Then
        If safegroup.lasthere$ = here$ Then
        w$ = safegroup.LastOpen
        Else
        If safegroup.lasthere$ = vbNullString Then
        w$ = safegroup.LastOpen
        Else
        w$ = safegroup.lasthere$ + "." + safegroup.LastOpen
        End If
        End If

       ' w$ = safegroup.LastOpen
        Set safegroup = safegroup.link
            GoTo cont3030
    
        Else
        safegroup.LastOpen = vbNullString
        End If
        End If
        y1 = globalvar(w$, 0#, , here$ = vbNullString)
          Set safegroup = safegroup.link
        UnFloatGroup bstack, w$, y1, safegroup, , True
        globalvar w$, y1, True, True
cont3030:
        Else
         y1 = globalvar(w$, 0#, , here$ = vbNullString)
        If Not safegroup.IamFloatGroup Then
         Set safegroup = CopyGroupObj(safegroup)
        ElseIf safegroup.IamApointer Then
         Set safegroup = CopyGroupObj(safegroup.link)
        End If
        
        UnFloatGroup bstack, w$, y1, safegroup, , True
         var(y1).FloatGroupName = ec$
        globalvar w$, y1, True, True
        End If
        
        
        Set safegroup = pppp.item(v)
        
        
       
        
       Dim r As Variant
       If Left$(b$, 1) <> "." And Left$(b$, 1) <> "(" And var(y1).HasParameters Then
       b$ = w$ + "(" + b$
       Else
        b$ = w$ + b$
        End If
       If IsNumber(bstack, b$, r) Then
         
            SpeedGroup = 1
            If pppp.Arr Then
                If safegroup.IamApointer Then
                    Set tempRef = pppp.GroupRef   'pppp.item(v).Link
                    Set safegroup.LinkRef = CopyGroupObj(var(y1))
                    Set safegroup.link.LinkRef = pppp.GroupRef
                Else
                    Set tempRef = pppp.GroupRef   'pppp.item(v).Link
                    Set pppp.item(v) = CopyGroupObj(var(y1))
                    If TypeOf pppp.item(v) Is Group Then Set pppp.item(v).LinkRef = pppp.GroupRef
                End If
            Else
                CopyGroup1 var(y1), safegroup
            End If
            
               If bstack.lastobj Is Nothing Then
                        bstack.LastValue = r
                Else
                        bstack.LastValue = CDbl(0)
                    GoTo fastexit
                End If
        End If
     Set bstack.lastobj = Nothing
         GoTo fastexit

ElseIf Prefix = "VAL$" Then
    ec$ = w$ + ")"
    If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))
    y1 = globalvar(w$, 0#)
    i = globalvar(w$ + "$", y1, True)
    If Not MyIsObject(pppp.item(v)) Then
        GoTo fastexit
    End If
    Set safegroup = pppp.item(v)
    If safegroup Is Nothing Then GoTo fastexit
    If safegroup.IamApointer Then
        If safegroup.lasthere <> vbNullString And safegroup.GroupName <> "" Then
            w$ = safegroup.lasthere + "." + safegroup.GroupName
            b$ = w$ + b$
             If Not IsStrExp(bstack, b$, bb$) Then SpeedGroup = 0: GoTo fastexit
            bstack.LastValue = bb$
            SpeedGroup = 1
            Exit Function
        End If
    ' check for iamglobal ??
            If safegroup.LastOpen <> vbNullString Then
        If GetVar(bstack, (safegroup.LastOpen), y1, True) Then
'        w$ = safegroup.LastOpen
                If safegroup.lasthere$ = here$ Then
        w$ = safegroup.LastOpen
        Else
        
         If safegroup.lasthere$ = vbNullString Then
        w$ = safegroup.LastOpen
        Else
        w$ = safegroup.lasthere$ + "." + safegroup.LastOpen
        End If
        End If

            GoTo cont5050
        Else
        safegroup.LastOpen = vbNullString
        End If
        End If
        y1 = globalvar(w$, 0#, , True, here$ = vbNullString)
        Set safegroup = safegroup.link
        UnFloatGroup bstack, w$, y1, safegroup, , True
        var(y1).FloatGroupName = w$
        globalvar w$, y1, True, True
cont5050:
    Else
        y1 = globalvar(w$, 0#, , here$ = vbNullString)
        If Not safegroup.IamFloatGroup Then
            Set safegroup = CopyGroupObj(safegroup)
        ElseIf safegroup.IamApointer Then
            Set safegroup = CopyGroupObj(safegroup.link)
        End If
        UnFloatGroup bstack, w$, y1, safegroup, , True
        var(y1).FloatGroupName = ec$
        globalvar w$, y1, True, True
    End If
    Set safegroup = pppp.item(v)
    If safegroup Is Nothing Then GoTo fastexit
    If Left$(b$, 1) = "." Then
        b$ = w$ + b$
        Set bstack.lastpointer = Nothing
        If IsStrExp(bstack, b$, bb$) Then GoTo conthere
    ElseIf var(y1).HasValue Then
        If var(y1).HasParameters Then
            If pppp.Arr Then
                If Left$(b$, 1) = "(" Then
                    b$ = w$ + "$" + b$
                Else
                    b$ = w$ + "$(" + b$
                End If
                 Set bstack.lastpointer = Nothing
                If IsStrExp(bstack, b$, bb$) Then GoTo conthere
            ElseIf FastSymbol(b$, ")(", , 2) Then
                b$ = w$ + "(" + b$
                 Set bstack.lastpointer = Nothing
                If IsStrExp(bstack, b$, bb$) Then GoTo conthere
            Else
                ec$ = w$ + "(" + BlockParam(b$) + ")"
                b$ = Mid$(b$, 2)
                If IsNumber(bstack, ec$, p) Then GoTo conthere
            End If
        Else
            If IsStrExp(bstack, w$ + "$", bb$) Then
            End If
        End If
conthere:
        If pppp.Arr Then
            If safegroup.IamApointer Then
                Set tempRef = pppp.GroupRef   'pppp.item(v).Link
                Set safegroup.LinkRef = CopyGroupObj(var(y1))
                Set safegroup.link.LinkRef = pppp.GroupRef
            Else
                Set tempRef = pppp.GroupRef   'pppp.item(v).Link
                Set pppp.item(v) = CopyGroupObj(var(y1))
                If TypeOf pppp.item(v) Is Group Then Set pppp.item(v).LinkRef = pppp.GroupRef
            End If
        Else
        CopyGroup1 var(y1), safegroup
    End If

 
          End If
 SpeedGroup = 1
          
Set bstack.lastobj = Nothing
    If bstack.lastobj Is Nothing Then
        bstack.LastValue = bb$
    Else
        bstack.LastValue = vbNullString
    End If
GoTo fastexit
    
    
ElseIf Prefix = "FOR" Then
RetStackSize = bstack.RetStackTotal
    If v = -1 Then
    w$ = myUcase(w$)
        y1 = 0
        If w$ = "THIS" Or w$ = "ΑΥΤΟ" Then
        If bstack.UseGroupname <> "" Then
        'w$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
        Else
        
        End If
        w$ = "THIS"  ' look this other time..
        ElseIf Len(w$) > 5 Then
        If bstack.UseGroupname <> "" Then
        If w$ = "SUPERCLASS" Or w$ = "ΥΠΕΡΚΛΑΣΗ" Then
        Set pppp = New mArray: pppp.PushDim (1): pppp.PushEnd: pppp.Arr = True
        v = 0
        w$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
      If Right$(here$, 2) = "()" Then
      If Right$(here$, 3) = ";()" Then
      If GetVar3(bstack, bstack.fHere + "." + w$, y1) Then
                      If TypeOf var(y1) Is Group Then
                    If Not var(y1).SuperClassList Is Nothing Then
                            Set pppp.item(v) = var(y1).SuperClassList
                            subspoint = True
                            GoTo CONT104010
                    End If
                End If
      End If
            ElseIf GetVar(bstack, bstack.Parent.OriginalName + "." + w$, y1) Then
                If TypeOf var(y1) Is Group Then
                    If Not var(y1).SuperClassList Is Nothing Then
                            Set pppp.item(v) = var(y1).SuperClassList
                            subspoint = True
                            GoTo CONT104010
                    End If
                End If
            End If
        End If
        If GetVar3(bstack, w$, y1) Then
        If TypeOf var(y1) Is Group Then
        If Not var(y1).SuperClassList Is Nothing Then
                Set pppp.item(v) = var(y1).SuperClassList
                subspoint = True
        GoTo CONT104010
        End If
        End If
        ElseIf GetVar(bstack, bstack.OriginalName + "." + w$, y1) Then
        If TypeOf var(y1) Is Group Then
        If Not var(y1).SuperClassList Is Nothing Then
                Set pppp.item(v) = var(y1).SuperClassList
                subspoint = True
        GoTo CONT104010
        End If
        End If
        Else
        
            MyEr "Double use of SuperClass", "Διπλή χρήση της Υπερκλάσης"
            GoTo fastexit
        End If
        End If
        End If
        End If
        If GetVar3(bstack, w$, y1) Then
        
        If TypeOf var(y1) Is Group Then
                If var(y1).IamApointer Then
                If var(y1).link.IamFloatGroup Then
                Set pppp = BoxGroupVar(var(y1).link)
                Set pppp.refgroup = var(y1)
                v = 0
                GoTo CONT104010
                Else
                bstack.MoveNameDot var(y1).lasthere + "." + var(y1).GroupName
                v = -1
                End If
                Else
            bstack.MoveNameDot w$
            
            End If
            Else
            
            MissingGroup
            GoTo fastexit
        End If
        Else
        If w$ = "THIS" Then
        
        
        bstack.MoveNameDot w$
        Else
        MissingGroup
        GoTo fastexit
        End If
        
        End If
        
       
    Else
CONT104010:
If pppp.refgroup Is Nothing Then
        If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))
        Else
        If pppp.refgroup.LastOpen = vbNullString Then
        w$ = pppp.CodeName + CStr(v)
        pppp.refgroup.LastOpen = w$
        pppp.refgroup.lasthere$ = here$
        Else
        If pppp.refgroup.lasthere$ = here$ Then
        w$ = pppp.refgroup.LastOpen
        Else
        w$ = pppp.refgroup.lasthere$ + "." + pppp.refgroup.LastOpen
        End If
        
        End If
        End If
        
 
       
        
         
         If Not MyIsObject(pppp.item(v)) Then
            GoTo fastexit
        End If

        Set safegroup = pppp.item(v)
        If safegroup Is Nothing Then GoTo fastexit
        If safegroup.IamApointer Then
                If safegroup.link.IamFloatGroup Then
                Set pppp = BoxGroupVar(safegroup.link)
                Set pppp.refgroup = safegroup
                safegroup.LastOpen = w$
                 safegroup.lasthere = here$
                Set safegroup = Nothing
                v = 0
                Else
                bstack.MoveNameDot safegroup.lasthere + "." + safegroup.GroupName
                v = -1
                GoTo contheretoo1
                End If
        
        End If
        On Error Resume Next
               ' check for iamglobal ??
    If Not GetVar3(bstack, w$, y1) Then
                Set dd = New Group
        y1 = globalvar(w$, dd)
        UnFloatGroup bstack, w$, y1, pppp.item(v), , True
        globalvar w$, y1, True, True
        
        End If
        
If Err.Number > 0 Then
mer123:
MyEr "This For can't be done", " Αυτή η Για δεν μπορεί να γίνει"

        Err.Clear
        Exit Function
        End If
        
conthere145:
        
        bstack.MoveNameDot myUcase(w$)
    End If
contheretoo1:
Set mm = New mStiva
mm.DataVal CDbl(y1)
If subspoint Then v = -100: subspoint = False
mm.DataVal CDbl(v)
mm.DataObj pppp
Do While FastSymbol(b$, ",")
y1 = 0


         If Len(b$) < 129 Then
        i = IsLabelDot("", b$, w$)
    Else
        Rest1$ = Left$(b$, 128)
        i = IsLabelDot("", Rest1$, w$)
        If Len(Rest1$) = 0 Then
            i = IsLabelDot("", b$, w$)
        Else
            b$ = Mid$(b$, 129 - Len(Rest1$))
        End If
    End If




If i = 5 Then
w$ = myUcase(w$)
                    If neoGetArray(bstack, w$, pppp) Then

                            If NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
                                    If Typename(pppp.item(v)) = "Group" Then
contheretoo:
                                             w$ = pppp.CodeName + CStr(v)
                                             If pppp.item(v).IamApointer Then
                                             If pppp.item(v).link.IamFloatGroup Then
                                             Set safegroup = pppp.item(v)
                                             
                                             Set pppp = BoxGroupObj(pppp.item(v).link)
                                             Set pppp.refgroup = safegroup
                                             
                                             v = 0
                                             Else
                                          
                                                         w$ = pppp.item(v).lasthere + "." + pppp.item(v).GroupName
                                                         GoTo conthere3
                                             End If
                                             End If
                                             If Not safegroup Is Nothing Then
                                             If safegroup.LastOpen <> vbNullString Then
                                                
                                             If GetVar(bstack, safegroup.LastOpen, y1, , , True) Then
                                                    w$ = safegroup.LastOpen
                                                 y1 = globalvar(w$, (y1), True)
                                                 GoTo cont1010
                                                 Else
                                                 safegroup.LastOpen = vbNullString
                                             End If
                                             End If
                                             End If
                                                Set dd = New Group
                                                 y1 = globalvar(w$, dd)
                                                 
                                                
                                                        ' check for iamglobal ??
                                                UnFloatGroup bstack, w$, y1, pppp.item(v), , True
                                                globalvar w$, y1, True, True
cont1010:
                                                bstack.MoveNameDot myUcase(w$)
                                                depth = depth + 1
                                                mm.DataVal CDbl(y1)
                                                If subspoint Then v = -100: subspoint = False
                                                mm.DataVal CDbl(v)
                                                
                                                
                                                mm.DataObj pppp
                                    Else
                                                MissingGroup
                                                GoTo normalexit
                                    End If
                            Else
                                SyntaxError
                                GoTo normalexit
                            End If
                    Else
                            NotExistArray
                            GoTo normalexit
                    End If
ElseIf i = 1 Then
'y1 = 0
w$ = myUcase(w$)
        If w$ = "THIS" Or w$ = "ΑΥΤΟ" Then
            w$ = "THIS"
            If bstack.GroupName = vbNullString Then w$ = vbNullString
        Else 'If Len(w$) > 5 Then
        If bstack.UseGroupname <> "" Then
        If w$ = "SUPERCLASS" Or w$ = "ΥΠΕΡΚΛΑΣΗ" Then
        Set pppp = New mArray: pppp.PushDim (1): pppp.PushEnd: pppp.Arr = True
        v = 0
        w$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
JUMPTHERE:
y1 = 0
        If GetVar3(bstack, (w$), y1, , , , w$) Then
        
            If TypeOf var(y1) Is Group Then
            If var(y1).IamApointer Then GoTo contpointer
            If Not var(y1).SuperClassList Is Nothing Then
                    Set pppp.item(v) = var(y1).SuperClassList
                     subspoint = True
            GoTo contheretoo
            End If
            End If
                Else
            MyEr "Double use of SuperClass", "Διπλή χρήση της Υπερκλάσης"
            GoTo fastexit
        
        End If
        Else
        If Left$(w$, 1) = "." Then w$ = "THIS" + w$
      GoTo JUMPTHERE
       
        End If
        Else
        If Left$(w$, 1) = "." Then w$ = "THIS" + w$
        End If
        If y1 = 0 Then
contpointer:
        If GetPointer(bstack, (w$)) Then
        
       
        
            If bstack.lastpointer.link.IamFloatGroup Then
            ' 2nd,...
            Set pppp = BoxGroupObj(bstack.lastpointer)
                i = 5
            v = 0
            Set bstack.lastobj = Nothing
            Set bstack.lastpointer = Nothing
            GoTo contheretoo
            Else
            w$ = bstack.lastpointer.lasthere + "." + bstack.lastpointer.GroupName
            Set bstack.lastobj = Nothing
            Set bstack.lastpointer = Nothing
            End If
            
           End If
        End If
       
        
        
        
        End If
conthere3:

mm.DataVal CDbl(0)
mm.DataVal CDbl(-1)
mm.DataObj pppp

bstack.MoveNameDot myUcase(w$)
        depth = depth + 1
ElseIf i = 3 Then
If IsStrExp(bstack, (w$), w$) Then

End If

ElseIf i = 6 Then
b$ = w$ + b$
If IsStrExp(bstack, b$, w$) Then

End If

Else
        SyntaxError
        GoTo normalexit
End If
Loop
' now subspoint used for subs.
subspoint = False
If FastSymbol(b$, "{") Then
    
     ec$ = vbCrLf + NLtrim$(block(b$))
  
        If Len(ec$) > 2 Then
                SpeedGroup = 1
                kolpo = False
                once = True
                i = 1
                ohere$ = here$
                Do
                    bb$ = Mid$(ec$, i)
subsentry10:
                    kolpo = False
                    Select Case Execute(bstack, bb$, kolpo, False, loopthis)   ' this is a major point
                    Case 0
faultback:
                            b$ = bb$ & b$
                            SpeedGroup = 0
                            Set bstack.lastobj = Nothing
                            GoTo normalexit
                    Case 1
                        If LastErNum <> 0 Then
                   b$ = vbNullString
                    End If

                                  If FastSymbol(b$, "}") Then
                                   If once Then Exit Do
                                   Else
                                   b$ = Right$(ec$, Len(bb$)) + b$
                                ''   MyDoEvents
                                   End If
                                    here$ = ohere$
                                   Exit Do
                      Case 2
                            If Not kolpo Then
                                      i = 1
                    If bb$ <> "" Then
                            If bb$ = Chr$(0) Then
                                       If RetStackSize = bstack.RetStackTotal And bstack.RetStack.LookTopVal < 0 Then
                                        ' this is a return form other block
                                         SpeedGroup = 2
                                        b$ = bb$
                                        GoTo fastexit
                                        End If
                                    If bstack.IsInRetStackNumber(p) Then
                                                       If LastErNum = -1 Then
                                                                bstack.RetStack.PushVal p
                                                                SpeedGroup = 0
                                                                GoTo fastexit
                                                        End If
                                                        If p < -1 Then
                                                    
                                                               ' subspoint = True  ' ????
                                                                vvv = Abs(p + 2)
                                                                bstack.IsInRetStackNumber p
                                                        If vvv <> bstack.OriginalCode And vvv <> 0 Then
                                                            i = Len(sbf(vvv).sb) - CLng(p) + 1
                                                                       bb$ = Mid$(sbf(vvv).sb, i)
                                                                       S3 = bstack.OriginalCode  ' ?? maybe negative???
                                                                       PopStage bstack
                                                                   GoTo subsentry10
                                                                   Else
                                                                bb$ = Mid$(sbf(Abs(bstack.Parent.OriginalCode)).sb, Len(sbf(Abs(bstack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                                End If
                                                        ElseIf p < 0 Then
                                                                subspoint = False
                                                                bstack.IsInRetStackNumber p
                                                        If bstack.RetStackTotal - RetStackSize <= 5 Then
                                                        i = Len(ec$) - CLng(p) + 1
     
                                                       bb$ = Mid$(ec$, i)
                                       

                                                        Else
                                                          If bstack.OriginalCode = 0 Then
                                                               bb$ = Mid$(sbf(Abs(bstack.Parent.OriginalCode)).sb, Len(sbf(Abs(bstack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                          Else
                                                               bb$ = Mid$(sbf(Abs(bstack.OriginalCode)).sb, Len(sbf(Abs(bstack.OriginalCode)).sb) - CLng(p) + 1)
                                                               End If
                                                               End If
                                                              
                                                              
                                                        End If
                                                
                                               PopStage bstack
                                       GoTo subsentry10
                                       
                                       
                                    ElseIf bstack.IsInRetStackString(bb$) Then
                                                                 If InStr(bb$, " ") > 0 Then
                                                                       If subspoint Then bstack.RetStack.PushVal -2 - S3 Else bstack.RetStack.PushVal -1
                                                                        S3 = bstack.OriginalCode
                                                                        If searchsub(S3, bb$, i, S3) Then
                                                                          subspoint = False
                                                                            If bb$ <> "" Then
                                                                                 If Not MyRead(7, bstack, bb$, 1) Then
                                                                                GoTo faultback
                                                                               End If
                                                                             End If
                                                                            bb$ = Mid$(sbf(S3).sb, i)
                                                                            subspoint = S3 <> bstack.OriginalCode
                                                       
                                                                            kolpo = False
                                                                            GoTo subsentry10
                                                                        ElseIf bstack.IamChild Then
                                                                        If searchsub(FindPrevOriginal(bstack), bb$, i, S3) Then
                                                                         subspoint = True
                                                                          If bb$ <> "" Then
                                                                                 If Not MyRead(7, bstack, bb$, 1) Then
                                                                                GoTo faultback
                                                                               End If
                                                                             End If
                                                                            bb$ = Mid$(sbf(S3).sb, i)
                                                                            kolpo = False
                                                                            GoTo subsentry10
                                                                            
                                                                                   Else
                                                                        bstack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                                        Else
                                                                        bstack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                        End If
                                    End If
                             Else
                                If subsfc Is Nothing Then
                                        Set subsfc = New FastCollection
                                End If
                                If subsfc.ExistKey(bb$) Then
                                        i = subsfc.Value
                                        GoTo jump1234
                                Else
                                i = PosLabel(bb$, ec$)
                                subsfc.AddKey bb$, i
jump1234:
                                If i = 0 Or i > Len(ec$) Then
                                    b$ = bb$
                                    SpeedGroup = 2
                                    Exit Do
                                Else
                                    bb$ = Mid$(ec$, i)
                                    GoTo subsentry10
                                End If
                               End If
                            End If
                            Else
                            loopthis = False
                            End If
                                               Else
                                               If kolpo Then b$ = "BREAK"
                                  once = kolpo
                                
                                SpeedGroup = 2: Set bstack.lastobj = Nothing
                                  GoTo breakexit
                    End If

                            Case Else
                                    If FastSymbol(b$, "}") Then
      
                                   If once Then Exit Do
                                     Else
                                   b$ = Right$(ec$, Len(bb$)) + b$
                                   End If
                                    here$ = ohere$
                                   Exit Do
                            
                            End Select
                            here$ = ohere$
                              If myexit(bstack) Then SpeedGroup = 1: Exit Do
                            Loop
            Else
              SpeedGroup = Abs(FastSymbol(b$, "}"))
            End If
  End If
breakexit:
' maybe is always nothing here, i have to check
        Set bstack.lastobj = Nothing
        While mm.Total > 0
        y1 = mm.PopVal
        v = mm.PopVal
        Set pppp = mm.PopObj
        If v <> -1 Then
            If v <> -100 Then
            If Not MyIsObject(pppp.item(v)) Then
                Set pppp.item(v) = CopyGroupObj(var(y1), pppp.IHaveClass)
            Else
                If Not pppp.refgroup Is Nothing Then
                Set safegroup = pppp.refgroup
                Set safegroup.LinkRef = CopyGroupObj(var(y1))
                Set safegroup = Nothing
                
                Else
                Set pppp.item(v) = CopyGroupObj(var(y1), Not pppp.item(v).link Is Nothing)
                End If
                End If
            Else
                If pppp.Arr Then
                    v = 0
                    If Not MyIsObject(pppp.item(v)) Then
                    Set pppp.item(v) = CopyGroupObj(var(y1))
                    Else
                    Set pppp.item(v) = CopyGroup1(var(y1), pppp.item(v))
                    End If
                Else
                    Set pppp.item(v) = CopyGroupObj(var(y1))
                End If
            End If
            Set tempRef = pppp.GroupRef  '  pppp.item(v).Link
            If Not pppp.IsEmpty Then
            
            If TypeOf pppp.item(v) Is Group Then Set pppp.item(v).LinkRef = tempRef
        
            End If
        End If
    Wend
normalexit:
                bstack.DropNdot depth + 1
Else

i = w$ = "."
If v >= 0 Then w$ = pppp.CodeName + CStr(v) Else w$ = pppp.CodeName + "_" + CStr(Abs(v))



        Set dd = New Group
         y1 = globalvar(w$, dd)
        
       ' check for iamglobal ??
              Set safegroup = pppp.item(v)
              If safegroup Is Nothing Then GoTo fastexit
        If safegroup.IamApointer Then

                If safegroup.link.IamFloatGroup Then
                Set pppp = BoxGroupVar(safegroup.link)
          
                v = 0
                Else
                bstack.MoveNameDot safegroup.lasthere + "." + safegroup.GroupName
                v = 0
                GoTo contheretoo1
                End If
        
        End If
        If safegroup.LastOpen <> vbNullString Then
        If GetVar(bstack, (safegroup.LastOpen), y1, True) Then
            If safegroup.lasthere$ = here$ Then
                w$ = safegroup.LastOpen
            Else
                 If safegroup.lasthere$ = vbNullString Then
        w$ = safegroup.LastOpen
        Else
        w$ = safegroup.lasthere$ + "." + safegroup.LastOpen
        End If
            End If
            GoTo cont2020
        Else
        If safegroup.link.IamFloatGroup Then
                safegroup.LastOpen = vbNullString
                safegroup.lasthere$ = vbNullString
                End If
        End If
        Else
'                safegroup.LastOpen = w$
 '               safegroup.lasthere$ = here$
        End If
        
        UnFloatGroup bstack, w$, y1, pppp.item(v), , True
        'Set bstack.lastpointer = Nothing

  globalvar w$, y1, True, True
cont2020:
        If Prefix <> "" Then
        If Prefix = "@READ2" Then
                          
            Dim Lang As Long, ok As Boolean
          NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ":=()", ok
          SpeedGroup = Abs(ok)
          GoTo CONTlastEtnum
        ElseIf Prefix = "@READ" Then
           If i Then
         b$ = w$ + "." + b$
        Else
        If var(y1).HasStrValue Then
        b$ = w$ + "$ " + b$
        Else
         b$ = w$ + " " + b$
         End If
         End If
        SpeedGroup = Abs(MyRead(1, bstack, b$, 1))
         GoTo CONTlastEtnum
        Else
        If i Then
         b$ = vbCrLf + Prefix + " " + w$ + "." + b$
        Else
        If var(y1).HasStrValue Then
        b$ = vbCrLf + Prefix + " " + w$ + "$ " + b$
        Else
         b$ = vbCrLf + Prefix + " " + w$ + " " + b$
         End If
         End If
         End If
         
         Else
        b$ = vbCrLf + w$ + "." + b$
        End If
        SpeedGroup = Execute(bstack, b$, True)
        
CONTlastEtnum:
If LastErNum <> 0 Then

If FK$(13) = vbNullString Then FK$(13) = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb))
    End If
If safegroup.IamApointer Then
                    If safegroup.LastOpen = vbNullString Then
                    Set tempRef = pppp.GroupRef
                    Set safegroup.LinkRef = CopyGroupObj(var(y1))
                    Set safegroup.link.LinkRef = pppp.GroupRef
                    End If
Else
                       Set safegroup.LinkRef = Nothing
                        Set tempRef = pppp.GroupRef
                        Set pppp.item(v) = CopyGroupObj(var(y1))
                        Set safegroup.LinkRef = tempRef
                        'Set var(y1) = New Group
                        var(y1) = 0&
                        End If
End If

fastexit:

var2used = Vars
varhash.ReduceHash VName, var()

 sb2used = subs
 subHash.ReduceHash snames, sbf()
    

End Function

Public Sub Thing(w$, v$)
'' from w$ input this value V$...
'' general input
On Error Resume Next
Dim it As Long, pppp As mArray
If Len(w$) < 2 Then Exit Sub

If AscW(w$) = 65 Then
On Error Resume Next
Err.Clear
Set pppp = var(Split(Mid$(w$, 2))(0)) ''  "A...16charRef....ItemNo"
If Err.Number > 0 Then Exit Sub
it = val(Split(Mid$(w$, 2))(1))
If Typename(pppp.item(it)) = doc Then
pppp.item(it).textDoc = v$  ' no checked yet
Else
pppp.item(it) = pppp.item(it) + v$
End If
ElseIf AscW(w$) = 86 Then
it = val("0" & Mid$(w$, 2))          ''"VItemNo"
If Typename(var(it)) = doc Then
var(it).textDoc = v$    ' no checked yet
Else
var(it) = var(it) + v$
End If
Else
' CAN'T READ
End If
End Sub
Public Function MyTitle$(basestack As basetask)
Static PREVT$

' On Error GoTo t1
If exWnd = 0 Then
PREVT$ = vbNullString
MyTitle$ = vbNullString
Exit Function
End If
If PREVT$ <> nnn$ Then
PREVT$ = nnn$

Form1.view1_StatusTextChange11 basestack, Trim$(nnn$)

End If
MyTitle$ = Trim$(PREVT$)

Exit Function
t1:
MyTitle$ = "???"
End Function
Function rinstr(a As String, b As String, Optional ByVal fr As Long) As Long
Dim i
i = Len(a)
fr = i - fr
If fr < 0 Or fr > i Then fr = i + 1

If i > 0 Then rinstr = InStrRev(a, b, fr)
End Function
Function rinstrb(a As String, b As String, Optional ByVal fr As Long) As Long
'
Dim i As Long, j As Long
fr = fr - LenB(b) + 1
If fr < 0 Then fr = LenB(a) + 1
Do
j = i
i = InStrB(j + 1, a, b)

Loop Until i = 0 Or i > fr

rinstrb = j
End Function

Public Function Originalusername()

Dim ss$
                 ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
                    
If ss$ = vbNullString Then
Originalusername = username
Else
ss$ = Right$(userfiles, Len(ss$))
Originalusername = GetStrUntil("\", ss$)
End If
End Function

Public Function username()
Dim a$, b$, c$
a$ = GetSpecialfolder(0)
While a$ <> ""
c$ = b$
b$ = GetStrUntil("\", a$)
Wend
username = c$
End Function
Public Function ScanTarget(j() As target, ByVal x As Long, ByVal y As Long, ByVal MyL As Long) As Long
Dim iu&, Id&, i&, XX&, YY&

iu& = LBound(j())
Id& = UBound(j())
ScanTarget = -1
For i& = iu& To Id&
With j(i&)
If .Enable And .layer = MyL Then
XX& = x \ .Xt
YY& = y \ .Yt
If .Lx <= XX& And .tx >= XX& And .ly <= YY& And .ty >= YY& Then
ScanTarget = i&
Exit For
End If
End If
End With
Next i&
End Function
Public Sub DisableTargets(j() As target, ByVal MyL As Long)
Dim iu&, Id&, i&
iu& = LBound(j())
Id& = UBound(j())
For i& = iu& To Id&
 If j(i&).layer = MyL Then j(i&).Enable = False
Next i&
End Sub

Function RMAX(ByVal q As Single, ByVal w As Single) As Single
If q > w Then
RMAX = q
Else
RMAX = w
End If
End Function

Function RMIN(ByVal q As Single, ByVal w As Single) As Single
If q < w Then
RMIN = q
Else
RMIN = w
End If
End Function


Function BoxTarget(DSTACK As basetask, ByVal xl&, ByVal yl&, ByVal b As Long, ByVal F As Long, ByVal Tag$, ByVal Id&, ByVal COM$, XXT&, YYT&, Linespace&) As target
Dim x&, y&, d As Object
Set d = DSTACK.Owner
Dim prive As basket
prive = players(GetCode(d))
With prive

x& = .curpos
y& = .currow
xl& = xl& + x&
yl& = yl& + y& - 1
With BoxTarget
.SZ = prive.SZ
.Comm = COM$
.Id = Id&
.Tag = Tag$
.Lx = x&
.ly = y&
.tx = xl& - 1
.ty = yl&
.back = b
.fore = F
.Enable = True
.pen = prive.mypen
.Xt = XXT&
.Yt = YYT&
.sUAddTwipsTop = prive.uMineLineSpace
If d.name = "DIS" Then
.layer = 0
ElseIf d.name = "Form1" Then
.layer = -1
ElseIf d.name = "dSprite" Then
.layer = d.index
End If
End With
If F <> -1 Then BoxBigNew d, prive, xl& - 1, yl&, F
If b <> -1 Then BoxColorNew d, prive, xl& - 1, yl&, b
If Id& < 100 Then
    Tag$ = Left$(Tag$, xl& - x&)
    If Tag$ <> "" Then
    
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    Select Case Id& Mod 10
    Case 2, 5, 8
    x& = (xl& + x& - Len(Tag$)) \ 2
    Case 3, 6, 9
    x& = xl& - Len(Tag$)
    Case Else
    End Select
    If (Id& Mod 10) > 0 Then
    LCTbasket d, prive, y&, x&
    d.FontTransparent = True
    PlainBaSket d, prive, Tag$, True, True
    LCTbasket d, prive, BoxTarget.ly, BoxTarget.Lx
    End If
    End If
Else
    If Tag$ <> "" Then
    Id& = Id& Mod 100
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    F = 3
    Select Case Id& Mod 10
    Case 2, 5, 8
    F = 2
    Case 3, 6, 9
    F = 1
    Case Else
    End Select
    
    If (Id& Mod 10) > 0 Then
    LCTbasket d, prive, y&, x&
    d.FontTransparent = True
    d.CurrentX = d.CurrentX - dv15 * 2
    wwPlain DSTACK, prive, Tag$, xl& - x&, 10000, , True, F, , , True
    LCTbasket d, prive, BoxTarget.ly, BoxTarget.Lx
    End If
End If
    
End If
End With
End Function
Public Function GetTaskId() As Long
taskid = taskid + 1
If taskid = 10000 Then taskid = 1
GetTaskId = taskid

End Function
Sub Dispose()
'use strtemp
On Error Resume Next
Dim r$
While ISSTRINGA(kill2$, r$)
KillFile strTemp + r$
Wend
End Sub
'' this is from Trick (VbForums)
Sub Proto1(ByVal addr As Long, basestack As basetask, rest$, Lang As Long, resp As Boolean)
End Sub

Sub Main()
'' If App.StartMode = vbSModeStandalone Then NeoSubMain
Dim m As New Callback

m.Run "start"
If m.Status = 0 Then
m.Cli Form1.commandW, ">"
m.Reset
End If
m.ShowGui = False
Debug.Print "ok"
ResetTokenFinal
End Sub
Public Sub NeoSubMain()
' need to read registry form sub main
On Error Resume Next
'' ADDITION
SetUp64 ' for Encoder64/Decoder64
AskCancelGR = "ΑΚΥΡΟ"
AskOkGR = "ΕΝΤΑΞΕΙ"
LoadFileCaptionGR = "Φόρτωσε Αρχείο"
SaveFileCaptionGR = "Σώσε Αρχείο"
SelectFolderCaptionGR = "Επιλογή Φακέλου"
SelectFolderButtonGR = "*σύρε δεξιά για επιλογή*"
FontSelectorGr = "Γραμματοσειρά"
ColorSelectorGr = "Χρωματολόγιο"
SetUpGR = "Ρυθμίσεις"
AskCancelEn = "CANCEL"
AskOkEn = "OK"
SetUpEn = "Set Up"
LoadFileCaptionEn = "Load File"
SaveFileCaptionEn = "Save File"
SelectFolderCaptionEn = "Select Folder"
SelectFolderButtonEn = "*slide right to select*"
FontSelectorEn = "Font Selector"
ColorSelectorEn = "Color Selector"

BigPi = CDec("31415926535897932384626433832") * 1E-28
INK$ = vbNullString
'UINK$ = VbNullString
MINK$ = vbNullString
MKEY$ = vbNullString
RandomizeIt rndbase, 0
Set ObjectCatalog = New FastCollection
SetLibHdls
LCID_DEF = LCID_def1()
ShowBooleanAsString = True
DefBooleanString = ";T\r\u\e;F\a\l\s\e"
If dv15 <> 0 Then
l_complete = False
s_complete = False
DisableProcessWindowsGhosting
Set HelpStack = New basetask
Set oprinter = New cDIBSection
Set basestack1.Sorosref = globalstack
Set subHash = New sbHash
Set varhash = New Hash
Set comhash = New sbHash
Set numid = New idHash
Set funid = New idHash
Set strid = New idHash
Set strfunid = New idHash
GoTo there
End If
dv15 = 1440 / DpiScrX
GetMonitorsNow
DisableProcessWindowsGhosting
With ScrInfo(Console)
If IsWine Then
players(0).MAXXGRAPH = .Width - 1
players(0).MAXYGRAPH = .Height - 1
End If
End With
'' BY DEAFULT IS FALSE
priorityOr = False  '  TRUE OR FALSE AND FALSE GIVE -1 BECAUSE OR AND XOR PROCESS LEFT FIRST TRUE OR ( FALSE AND FALSE)
'' WITH priorityOr = FALSE WE HAVE FLAT SYSTEM.........TRUE OR FALSE AND FALSE GIVE 0
OperatingSystem
 dv20 = 24.5
Randomize CDbl(timeGetTime)
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
JetPostfix = JetPostfixHelp
JetPrefix = JetPrefixHelp
 
basickey = "Software\m2000v5\"
' by default
'AddTwipsTop = 4 * Screen.TwipsPerPixelY
casesensitive = False
pagio$ = "LATIN"
pagiohtml$ = "DARK"
REFRESHRATE = 40
SizeDialog = 1
helpSizeDialog = 1
Settings = "time,normal,push"
With ScrInfo(Console)
selectorLastX = .Height / 4 + .Left
selectorLastY = .Width / 4 + .Top
AskLastX = .Height / 4 + .Left
AskLastY = .Width / 4 + .Top
End With
sb2used = 0
ReDim sbf(500) As modfun
var2used = 0
ReDim var(3000) As Variant
   StartingRes
   'Dim iccex As tagInitCommonControlsEx
   'With iccex
     ' .lngSize = LenB(iccex)
    '  .lngICC = ICC_USEREX_CLASSES
   'End With
   'InitCommonControlsEx iccex

clickMe2 = -1


''Dim soros As New mStiva
Dim t As Long
ReDim q(0) As target

Set basestack1.Sorosref = globalstack

taskid = 999
DisableMidi
beat = 400 ' beat of 1/16
baseNote = 23
octava = 4
NOTA = 0
ENTASI = 127   '' volume
voices(0) = "CC#"
there:
Randomize
allcommands comhash
NumberId numid, funid, numidbackup, funidbackup
StringId strid, strfunid, stridbackup, strfunidbackup

Set TaskMaster = New TaskMaster
TaskMaster.Interval = 5
beeperBEAT = 300
MediaPlayer1.FileName = vbNullString
defFontname = "Verdana"
my_system = OperatingPlatform
vol = 50
MediaPlayer1.setLeftVolume vol * 10
MediaPlayer1.setRightVolume vol * 10
deep = 10000
' funcdeep set in something
' step one we show the first form
'Form1.Show , Form5
ReDim MyDM(1 To 1) As Byte
DXP = Screen.TwipsPerPixelX
DYP = Screen.TwipsPerPixelY
Load Form5
' Load Form1
' Form1.Hide
If Not l_complete Then
'MsgBox "Loading of Form1 not complete"
Exit Sub
'End
Else
Form1.something
'If Not App.StartMode = vbSModeStandalone Then Exit Sub

'terminatefinal
End If

End Sub
Sub TerminateM2000()
NoAction = False
DelTemp
'Set DisStack.Owner = Nothing

Set basestack1.Owner = Nothing
Set LastGlist = Nothing
Set LastGlist2 = Nothing
If form5iamloaded Then
   If IsWine Then
   Form5.BackPort
   Else
   Unload Form5
   End If
End If
End Sub
Public Sub terminatefinal()
Set globalstack = Nothing
Set basestack1 = Nothing
CloseAllConnections  ' new for ADO we keep objects not the connections
CleanupLibHandles
Set globalstack = Nothing
Set mycoder = Nothing
Set subHash = Nothing
Set comhash = Nothing
Set numid = Nothing
Set funid = Nothing
Set strid = Nothing
Set strfunid = Nothing
Set prof = Nothing
Set MediaPlayer1 = Nothing
Set MediaBack1 = Nothing
Erase sbf()
Erase var()
s_complete = False
l_complete = False
ResetTokenFinal  ' sure for GDI release token
End Sub
Function GetArr(bstack As basetask, b$, p As Variant, s$, skip As Long) As Boolean
Dim pppp As mArray, x1 As Long
x1 = 1
Set pppp = New mArray: pppp.myarrbase = 0: pppp.PushDim (1): pppp.PushEnd: pppp.Arr = True
If skip = 1 Then GoTo firstexp Else If skip = 2 Then GoTo firststr
If IsStrExp(bstack, b$, s$) Then
firststr:
            pppp.SerialItem 0#, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = s$
            Else
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            x1 = x1 + 1
ElseIf IsExp(bstack, b$, p) Then
firstexp:
            pppp.SerialItem 0, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = p
            Else
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            x1 = x1 + 1
End If
Do While MaybeIsSymbol(b$, ",)")
IsSymbol b$, ","
If IsStrExp(bstack, b$, s$) Then
            pppp.SerialItem 0, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = s$
            Else
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            x1 = x1 + 1
ElseIf IsExp(bstack, b$, p) Then
            pppp.SerialItem 0, x1, 9
            If bstack.lastobj Is Nothing Then
                pppp.item(x1 - 1) = p
            Else
                Set pppp.item(x1 - 1) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            x1 = x1 + 1
ElseIf IsSymbol(b$, ")") Then pppp.SerialItem 0, x1, 9: Exit Do
End If
Loop
p = 0
Set bstack.lastobj = New mHandler
bstack.lastobj.t1 = 3
Set bstack.lastobj.objref = pppp
GetArr = True
End Function
Function IsExp(basestack As basetask, a$, r As Variant, Optional ByVal noand1 As Boolean = True, Optional flatobject As Boolean = False) As Boolean
Dim par As Long
If LastErNum = -2 Then LastErNum = 0
If a$ = vbNullString Or a$ = vbCrLf Then Exit Function
IsExp = IsExpA(basestack, a$, r, par, noand1)
again:
If par > 0 Then
If MaybeIsSymbol(a$, ",") Then
IsExp = GetArr(basestack, a$, r, "", 1)
If LastErNum = -2 Then IsExp = False
If IsExp Then par = par - 1: If par > 0 Then GoTo again

End If
End If
If Not IsExp Then
If basestack.usestack Then
IsExp = IsNumber(basestack, a$, r)
End If
End If
If LastErNum = -2 Then IsExp = False
If par > 0 Then IsExp = False
If flatobject Then Set basestack.lastobj = Nothing
End Function
Function rightoperator(bstack As basetask, aa$, po As Variant) As Boolean
Dim r As Variant, ac As Variant, MUL As Long, r1 As Variant
r1 = 1
MUL = 0
''second  loop Logic...
Do
    If Fast2Symbol(aa$, "**", 2, "^", 1) Then
            ' get from right number or expression
            If IsNumber(bstack, aa$, r) Then
                po = po ^ r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    po = po ^ r
                    If Not FastSymbol(aa$, ")") Then ' Την οποία την ψάχνουμε  εμείς και την πετάμε
                        rightoperator = False
                        Exit Function
                    End If
                Else
                    rightoperator = False
                    Exit Function
                End If
            Else
                rightoperator = False
                Exit Function
            End If
    ElseIf MUL > 0 Then
            ' do it before we find next / or *
            Select Case MUL
            Case 500
            bstack.soros.DataVal r1
             r1 = 1
            Case 1
                po = r1 * po
            
            Case 2
                If po = 0 Then
                    'DIVISION BY ZERO
                
                    MyErMacro aa$, "division by zero", "διαίρεση με το μηδέν"
                
                    rightoperator = False
                    Exit Function
                Else
                    po = r1 / po
                End If
            End Select
            r1 = po
            MUL = 0
    ElseIf FastSymbol(aa$, "*") Then
            If logical(bstack, aa$, r) Then
                MUL = 1
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 1
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        rightoperator = False
                        Exit Function
                    End If
                Else
                    rightoperator = False
                    Exit Function
                End If
            Else
                rightoperator = False
                Exit Function
            End If
    ElseIf FastSymbol(aa$, "/") Then
            If logical(bstack, aa$, r) Then
                MUL = 2
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 2
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        rightoperator = False
                        Exit Function
                    End If
                Else
                    rightoperator = False
                    Exit Function
                End If
            Else
                rightoperator = False
                Exit Function
            End If
    
        Else
    rightoperator = True
         Exit Do
        End If
Loop
End Function
Function IsExpA(bstack As basetask, aa$, rr As Variant, parenthesis As Long, Optional ByVal noand As Boolean = True) As Boolean
Dim r As Variant, ac As Variant, po As Variant, MUL As Long, r1 As Variant, ut$
Dim logic As Boolean, l As Boolean, park As Object, objlist As mStiva, rightlevel As Long
On Error Resume Next
IsExpA = False
If aa$ = vbNullString Then Exit Function
rr = 0
Do While FastOperator(aa$, "(", 1)
parenthesis = parenthesis + 1
Loop
po = CDbl(1)
ac = CDbl(0)
' sign

Do
' first loop remove sign(s)

    Do
        If FastSymbol(aa$, "-") Then
            po = -po
        ElseIf Not FastSymbol(aa$, "+") Then
            Exit Do
        End If
    Loop
again:
    If logical(bstack, aa$, r, parenthesis) Then
again2:
      If Not bstack.lastobj Is Nothing Then
        If TypeOf bstack.lastobj Is mHandler Then
       ' If MaybeIsSymbol(aa$, "=<>") Then
        '    r = 0&
        If bstack.lastobj.t1 = 4 Then
        r = bstack.lastobj.index_cursor: Set bstack.LastEnum = bstack.lastobj.objref
        If po < 0 Then r = -r: po = -po
        End If
         '   GoTo LeaveIt
       ' Else
           GoTo cont111333
       ' End If
        ElseIf MaybeIsSymbol(aa$, "/*-+=~^&|<>?") Then
        
                '' get operator
                Dim ss$, ss1$
                If TypeOf bstack.lastobj Is Group Then
                
                If Not bstack.lastpointer Is Nothing Then
                If bstack.lastpointer.IamFloatGroup Then
                Set bstack.lastobj = bstack.lastpointer
                Else
                With bstack.lastobj
                    ut$ = "Group(" + .lasthere + "." + .GroupName + ")"
                End With
                 IsNumber bstack, ut$, r
                End If
                Set bstack.lastpointer = Nothing
                End If
                
                MUL = MyTrimL(aa$)
                
            If Mid$(aa$, MUL, 1) Like "[<>]" Then
                If MaybeIsSymbol(Mid$(aa$, MUL + 1, 1), "=>") Then
                    ss$ = Mid$(aa$, MUL, 2)
                    Mid$(aa$, 1, MUL + 1) = Space(MUL + 1)
                Else
                    ss$ = Mid$(aa$, MUL, 1)
                    Mid$(aa$, 1, MUL) = Space(MUL)
                End If
            Else
                If MaybeIsSymbol(Mid$(aa$, MUL + 1, 1), "[^|!~=*/]") Then
                    ss$ = Mid$(aa$, MUL, 2)
                    Mid$(aa$, 1, MUL + 1) = Space(MUL + 1)
                Else
                
                    If Mid$(aa$, MUL, 2) = "->" Then GoTo LeaveIt
                    ss$ = Mid$(aa$, MUL, 1)
                    Mid$(aa$, 1, MUL) = Space(MUL)
                    End If
            End If
               If po = -1 Then
                    'Set park = Nothing
                    If bstack.lastobj.HasUnary Then ProcessOper bstack, Nothing, "-:", r, (0)
                    po = -po
                End If
                Set park = bstack.lastobj
                Set bstack.lastobj = Nothing
                
againoper:
                If ss$ Like "[<>=]*" Then
                If IsExp(bstack, aa$, r, False) Then
                        If (TypeOf bstack.lastobj Is Group) And (TypeOf park Is Group) Then
                            ProcessOper bstack, park, ss$, r, 1
                                MUL = 1  ' why
                                GoTo cont4567
                        Else
                        MissingGroup
                        
                        End If
                    Else
                        MissNumExpr
                    
                    End If
                        IsExpA = False
                        Exit Function
                End If
               
                Do While MaybeIsSymbol(aa$, "+-") 'FastSymbol(a$, "-")
                    If FastSymbol(aa$, "-") Then po = -po
                    FastSymbol aa$, "+"
                Loop
               
                If Not IsSymbol(aa$, "(") Then
getnextnum:
                If IsNumber(bstack, aa$, r) Then
                ' check if we have group
                If bstack.lastobj Is Nothing Then MissingGroup: IsExpA = False: Exit Function
                If Not TypeOf bstack.lastobj Is Group Then MissingGroup: IsExpA = False: Exit Function
                If Not bstack.lastpointer Is Nothing Then
                    If bstack.lastpointer.IamFloatGroup Then
                Set bstack.lastobj = bstack.lastpointer
                Else
                With bstack.lastobj
                    ut$ = "Group(" + .lasthere + "." + .GroupName + ")"
                End With
                 IsNumber bstack, ut$, r
                End If
                Set bstack.lastpointer = Nothing
                End If
                ' process unary if we have one
                If po = -1 Then
                    If bstack.lastobj.HasUnary Then ProcessOper bstack, Nothing, "-:", r, (0)
                    po = -po
                End If
                
processobjlist:
                
                If Not bstack.lastobj Is Nothing Then
                    If TypeOf bstack.lastobj Is Group Then
                If Not bstack.lastpointer Is Nothing Then
                If bstack.lastpointer.IamFloatGroup Then
                Set bstack.lastobj = bstack.lastpointer
                Else
                With bstack.lastobj
                    ut$ = "Group(" + .lasthere + "." + .GroupName + ")"
                End With
                 IsNumber bstack, ut$, r
                End If
                Set bstack.lastpointer = Nothing
                End If
                    
                    MUL = MyTrimL(aa$)

                If MaybeIsSymbol(Mid$(aa$, MUL, 1), "/*-+=~^&|<>?") Then
                
                                    
                
                If MaybeIsSymbol(Mid$(aa$, MUL, 2), ">=") Then
                            GoTo groupoperation
                            ElseIf InStr(bstack.lastobj.highpriorityoper, "[R" + Mid$(aa$, MUL, 2) + "]") Then
                            ss1$ = Mid$(aa$, MUL, 2)
                             Mid$(aa$, 1, MUL + Len(ss1$) - 1) = Space(MUL + Len(ss1$) - 1)
                            If objlist Is Nothing Then Set objlist = New mStiva
                                objlist.PushObj park
                                objlist.PushStr ss$
                                Set park = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                ss$ = ss1$
                                rightlevel = rightlevel + 1
                                GoTo againoper
                            Else
                            If rightlevel > 0 Then
                            rightlevel = rightlevel - 1
                            GoTo comehere
                            
                             
                            End If
                    ss1$ = Mid$(aa$, MUL, 1)
                    End If
                    If Mid$(aa$, MUL, 2) = "->" Then GoTo groupoperation
                    If InStr(bstack.lastobj.highpriorityoper, "[" + ss1$ + "]") Then
                    Mid$(aa$, 1, MUL + Len(ss1$) - 1) = Space(MUL + Len(ss1$) - 1)
                    If InStr(bstack.lastobj.highpriorityoper, "[" + ss$ + "]") Then
                    ProcessOper bstack, park, ss$, r, 1
                    
                    MUL = 1
                    If objlist Is Nothing Then Set objlist = New mStiva
                    Set park = bstack.lastobj
                    Set bstack.lastobj = Nothing
                    ss$ = ss1$
                    GoTo againoper
                  
                    Else

                     If objlist Is Nothing Then Set objlist = New mStiva
                    objlist.PushObj park
                    objlist.PushStr ss$
                    Set park = bstack.lastobj
                    Set bstack.lastobj = Nothing
                    ss$ = ss1$
                    GoTo againoper
                    
                    End If
                    Else
                    
                      ' why

                    If objlist Is Nothing Then Set objlist = New mStiva
                    If objlist.IsEmpty Then
                    ProcessOper bstack, park, ss$, r, 1
                    
                    MUL = 1
                    GoTo again2
                    Else
comehere:
                    ProcessOper bstack, park, ss$, r, 1
                    MUL = 1
                    Set park = bstack.lastobj
                            If Not objlist Is Nothing Then
                                If Not objlist.IsEmpty Then
                                    ss$ = objlist.PopStr
                                    Set park = objlist.PopObj
                                    ProcessOper bstack, park, ss$, r, 1
                                    GoTo again2
                                End If
                            End If
                    GoTo again2
                    End If
                    End If
                    Else
                    
                    
                    If objlist Is Nothing Then
                                    
                                        ProcessOper bstack, park, ss$, r, 1
                                        Set objlist = New mStiva
                                        If ss1$ <> "" Then
                                    objlist.PushObj park
                    objlist.PushStr ss$
                    Set park = bstack.lastobj
                    ss$ = ss1$
                    GoTo againoper
                    MUL = 1
                    End If
                    GoTo again2
                    Else
                    '
                    If objlist.IsEmpty Then
                    ProcessOper bstack, park, ss$, r, 1
                    MUL = 1
                    GoTo again2
                    Else
                    
                     ProcessOper bstack, park, ss$, r, 1
                    MUL = 1
                    ss$ = objlist.PopStr
                    Set park = objlist.PopObj
                    GoTo groupoperation

                    End If
                    'End If
                    End If
                    
                    
                    End If
                    End If
                     If InStr(bstack.lastobj.highpriorityoper, "[" + ss$ + "]") Then
                     ProcessOper bstack, park, ss$, r, 1
                     ss$ = ss1$
                    MUL = 1
                    Set park = bstack.lastobj
                     GoTo getnextnum
                     Else
                    If objlist Is Nothing Then Set objlist = New mStiva
                    
                    objlist.PushObj park
                    objlist.PushStr ss$
                    Set park = bstack.lastobj
                    ss$ = ss1$
                    ss1 = vbNullString
                    GoTo getnextnum
                   End If
                    
                End If
                    GoTo groupoperation
                Else
                        IsExpA = False
                        Exit Function
                End If
                ElseIf IsExp(bstack, aa$, r, False) Then
                If Not ss$ Like "[<>=]*" Then FastSymbol aa$, ")"
groupoperation:
                    If Not (bstack.lastobj Is Nothing) And Not (park Is Nothing) Then
                        If (TypeOf bstack.lastobj Is Group) And (TypeOf park Is Group) Then
                            ProcessOper bstack, park, ss$, r, 1
                            MUL = 1  ' why
                            If Not objlist Is Nothing Then
                                If Not objlist.IsEmpty Then
                                    ss$ = objlist.PopStr
                                    Set park = objlist.PopObj
                                    GoTo processobjlist
                                
                                Else
                                Set park = bstack.lastobj
                                End If
                            Else
                            Set park = bstack.lastobj
                            End If
                            
cont4567:
                            
                            If MaybeIsSymbol(aa$, ")") Then
                                
                        
                                If parenthesis > 0 Then
                                FastSymbol aa$, ")"
                                    parenthesis = parenthesis - 1
                                    If ac <> 0 Then po = ac + po: ac = 0
                                    ac = 0
                                Else
                                    If po = 1 Then
                                        po = r
                                    ElseIf po = -1 Then
                                        po = -r
                                    Else
                                    po = po * r
                                    End If
                                    If ac = 0 Then rr = po Else rr = ac + po
                                    IsExpA = True
                                     Set park = Nothing
                                    Exit Function
                                End If
                                
                            End If
                            po = 1
                            If Not bstack.lastobj Is Nothing Then GoTo again2
                            'Set park = Nothing
                        Else
                             MyEr "Wrong Operator", "Λάθος Τελεστής"
                             IsExpA = False
                             Exit Function
                        End If
                        
                    Else
                        Set park = Nothing
                        If (MUL + Len(ss$) - 1) > 0 Then
                            If aa$ = vbNullString Then
                                aa$ = ss$
                            Else
                             '   Mid$(aa$, 1, MUL + Len(ss$) - 1) = ss$
                            End If
                        End If
                        MUL = 0
                    End If
                End If
                Else
                ' maybe is an error or not ???
                End If
            ElseIf po = -1 And TypeOf bstack.lastobj Is Group Then
                If Not bstack.lastpointer Is Nothing Then
                    If bstack.lastpointer.IamFloatGroup Then
                Set bstack.lastobj = bstack.lastpointer
                Else
                With bstack.lastobj
                    ss$ = "Group(" + .lasthere + "." + .GroupName + ")"
                End With
                 IsNumber bstack, ss$, r
                End If
                Set bstack.lastpointer = Nothing
                End If
                    po = -po
                    Set park = Nothing
                    If bstack.lastobj.HasUnary Then ProcessOper bstack, park, "-:", r, (0)
again3:

                    If Not objlist Is Nothing Then
                    If Not objlist.IsEmpty Then
                    Set park = objlist.PopObj
                    ss$ = objlist.PopStr
                    ProcessOper bstack, park, ss$, r, 1
                    MUL = 1
                    End If
                    Else
                '    ProcessOper bstack, park, ss$, r, 1
                 '   MUL = 1
                    End If

                        If MaybeIsSymbol(aa$, ")") Then
                     
                                If parenthesis > 0 Then
                                FastSymbol aa$, ")"
                                    parenthesis = parenthesis - 1
                                    If ac <> 0 Then po = ac + po: ac = 0
                                    ac = 0
                                    GoTo again2
                                Else
                                    If po = 1 Then
                                        po = r
                                    ElseIf po = -1 Then
                                        po = -r
                                    Else
                                    po = po * r
                                    End If
                                    If ac = 0 Then rr = po Else rr = ac + po
                                    IsExpA = True
                                     Set park = Nothing
                                    Exit Function
                                End If
                                
                            End If
                      '      bstack.lastobj.lasthere$ = here$
            Else
            If TypeOf bstack.lastobj Is Group Then GoTo again3
           
            End If
cont111333:
         If MaybeIsSymbol(aa$, "IiΕε") Then
             If Fast2Label(aa$, "IS", 2, "ΕΙΝΑΙ", 5, 5) Then
    Set r1 = bstack.lastobj
    If r1 Is Nothing Then
        MyEr "No object found", "Δεν βρήκα αντικείμενο"
        IsExpA = False
        Exit Function
    Else
        If TypeOf r1 Is Group Then
            If r1.IamApointer Then
            If r1.link.IamFloatGroup Then
                Set r1 = r1.link
            Else
            If GetVar(bstack, r1.lasthere + "." + r1.GroupName, rightlevel) Then
            Set r1 = var(rightlevel)
                rightlevel = 0
            Else
            Set r1 = New Group
            End If
            
            End If
            End If
        End If
        Set bstack.lastobj = Nothing
        Set bstack.lastpointer = Nothing
        If TypeOf r1 Is Group Then
            If GetPointer(bstack, aa$) Then
                Set r = bstack.lastpointer
                Set bstack.lastpointer = Nothing
                Set bstack.lastobj = Nothing
            Else
                Set bstack.lastobj = Nothing
                    MyEr "No object found", "Δεν βρήκα αντικείμενο"
                IsExpA = False
                Exit Function
            End If
            If TypeOf r Is Group Then
                If r.IamApointer Then
                If r.link.IamFloatGroup Then
                    Set r = r.link
                    Else
                        If GetVar(bstack, r.lasthere + "." + r.GroupName, rightlevel) Then
                            Set r = var(rightlevel)
                            rightlevel = 0
                        Else
                            Set r1 = New Group
                        End If
                    End If
                End If
            End If
        ElseIf IsSymbol(aa$, "NOTHING", 7) Then
            If TypeOf r1 Is mHandler Then
            If CheckLastHandlerVariant(r1) Then
            If r1.indirect > 0 Then
            Set r1 = var(r1.indirect)
            Else
            Set r1 = r1.objref
            End If
            End If
            End If
            Set r = Nothing
         ElseIf IsSymbol(aa$, "ΤΙΠΟΤΑ", 6) Then
            If TypeOf r1 Is mHandler Then
            If CheckLastHandlerVariant(r1) Then
            If r1.indirect > 0 Then
            Set r1 = var(r1.indirect)
            Else
            Set r1 = r1.objref
            End If
            End If
            End If
            Set r = Nothing
        ElseIf IsNumber(bstack, aa$, r) Then
            Set bstack.lastpointer = Nothing
            If bstack.lastobj Is Nothing Then
                MyEr "No object found", "Δεν βρήκα αντικείμενο"
                IsExpA = False
                Exit Function
                
            End If
            Set r = bstack.lastobj
            Set bstack.lastobj = Nothing
            If TypeOf r1 Is mHandler Then
            If CheckLastHandlerVariant(r1) Then
            If r1.indirect > 0 Then
            Set r1 = var(r1.indirect)
            Else
            Set r1 = r1.objref
            End If
            End If
            End If
            If TypeOf r Is mHandler Then
            If CheckLastHandlerVariant(r) Then
            If r.indirect > 0 Then
            Set r = var(r.indirect)
            Else
            Set r = r.objref
            End If
            End If
            
            End If
        
        End If
            IsExpA = True
            ac = 0
            r = CBool(r1 Is r)
            r1 = 1
        End If
    End If

End If
        End If
LeaveIt:
       
        IsExpA = True
        If po = 1 Then
            po = r
        ElseIf po = -1 Then
            po = -r
        Else
        po = po * r
        End If
       
    ElseIf parenthesis = 1 Then
    Dim s$
    If IsStrExp(bstack, aa$, s$) Then
    
    IsExpA = GetArr(bstack, aa$, r, s$, 2)
    If IsExpA Then parenthesis = 0
    po = 0
    End If
    ElseIf FastSymbol(aa$, "(") Then
                            If IsExp(bstack, aa$, r) Then
                                IsExpA = True
                                
                                If po = 1 Then
                                    po = r
                                ElseIf po = -1 Then
                                If Not bstack.lastobj Is Nothing Then
                                    If Typename(bstack.lastobj) = "Group" Then
                                        po = r
                                        Set park = Nothing
                                        ProcessOper bstack, park, "-:", r, (0)
                                        
                                    End If
                                
                                Else
                                
                                
                                    po = -r
                                End If
                                Else
                                    po = po * r
                                End If
                                
                                If Not FastSymbol(aa$, ")") Then
                                    IsExpA = False
                                    Exit Function
                                End If
                            Else
                                IsExpA = False
                                Exit Function
                            End If
    Else
    
    IsExpA = False
    Exit Function

   End If

r1 = 1
MUL = 0
''second  loop Logic...
secodlooplogic:
Do
  If Fast2Symbol(aa$, "**", 2, "^", 1) Then
            ' get from right number or expression
            If IsNumber(bstack, aa$, r) Then ' κοιτάμε αν είναι αριθμός ή μεταβλητή
                po = po ^ r
            ElseIf FastSymbol(aa$, "(") Then  ' πρώτα ανοίγει την παρένθεση ώστε να μην προχωρήσει όταν η IsExp βρεί την παρένθεση )
                If IsExp(bstack, aa$, r) Then
                    po = po ^ r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                Else
                    IsExpA = False
                    Exit Function
                End If
            Else
                IsExpA = False
                Exit Function
            End If
    
    ElseIf MUL > 0 Then
            ' do it before we find next / or *
            Select Case MUL
            Case 500
            bstack.soros.DataVal r1
             r1 = 1
            Case 1
                po = r1 * po
            If Err.Number = 6 Then
            
            po = CDbl(r) * CDbl(po)
            End If
            Case 2
                If po = 0 Then
                    'DIVISION BY ZERO
                
                    DevZeroMacro aa$
                
                    IsExpA = False
                    Exit Function
                Else
                    po = r1 / po
                End If
            Case 3
               ' po = r1 * po
                po = CBool(CBool(r1) And CBool(po))
            Case 4, 44
            '' check for **, ^, /, *
                If Round(po, 13) = 0 Then
                    'DIVISION BY ZERO
                    DevZeroMacro aa$
                    IsExpA = False
                    Exit Function
                ElseIf MUL = 4 Then
                    po = Fix(r1 / po)
                Else
                   If po < 0 Then

                    po = Int((r1 - Abs(r1 - Abs(po) * Int(r1 / Abs(po)))) / po)
   
                   Else
                    po = Int(r1 / po)
                    End If
                   End If
            Case 40 ' Old version use switches "+DIV"
                If Round(po, 13) = 0 Then
                    'DIVISION BY ZERO
                    DevZeroMacro aa$
                    IsExpA = False
                    Exit Function
                Else
                    po = Int(r1 / po)
                End If
            Case 5, 55
                If Round(po, 13) = 0 Then
                    'DIVISION BY ZERO
                    DevZeroMacro aa$
                    IsExpA = False
                    Exit Function
                ElseIf MUL = 5 Then
                         po = r1 - Fix(r1 / po) * po
                Else
                        po = Abs(r1 - Abs(po) * Int(r1 / Abs(po)))
                  End If
            Case 50 ' Old version use switches "+DIV"
              If Round(po, 13) = 0 Then
                    'DIVISION BY ZERO
                    DevZeroMacro aa$
            
                    IsExpA = False
                    Exit Function
                Else
                   ' po = Sgn(r1) * (Int(Abs(r1)) - Int(Int(Abs(r1) / Abs(Int(po))) * Abs(Int(po))))
                   po = r1 - Int(r1 / po) * po
                End If
            End Select
            r1 = 1
            MUL = 0
             
    ElseIf FastSymbol(aa$, "*") Then
            If logical(bstack, aa$, r, , True) Then
                MUL = 1
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r, , True) Then
                    MUL = 1
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                Else
                    IsExpA = False
                    Exit Function
                End If
            Else
                IsExpA = False
                Exit Function
            End If
    ElseIf FastSymbol(aa$, "/") Then
            If logical(bstack, aa$, r, , True) Then
                MUL = 2
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r, , True) Then
                    MUL = 2
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                Else
                    IsExpA = False
                    Exit Function
                End If
            Else
                IsExpA = False
                Exit Function
            End If
     ElseIf MaybeIsSymbol(aa$, "DMΔΥdmδυ") Then
              If Fast2Label(aa$, "DIV", 3, "ΔΙΑ", 3, 4) Then
                    If logical(bstack, aa$, r) Then
                        If UseIntDiv Then  ' also 10 DIV 2*3 now is (10 DIV 2)*3
                            MUL = 40
                            r1 = po
                            po = r
                        Else
                            MUL = 4
                            ' right operator * / ^ **
                            r1 = po
                            If Not rightoperator(bstack, aa$, r) Then ' 10 DIV 2*3 now is 10 DIV (2*3)
                                IsExpA = False
                                Exit Function
                            End If
                            po = r
                        End If
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r) Then
                            If UseIntDiv Then MUL = 40 Else MUL = 4
                            r1 = po
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                            po = r
                        Else
                            IsExpA = False
                            Exit Function
                        End If
                    Else
                            IsExpA = False
                            Exit Function
                    End If
                ElseIf Fast2Label(aa$, "DIV#", 4, "ΔΙΑ#", 4, 5) Then
                    If logical(bstack, aa$, r, , True) Then
                        MUL = 44
                        r1 = po
                        If Not rightoperator(bstack, aa$, r) Then
                            IsExpA = False
                            Exit Function
                        End If
                        po = r
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r, , True) Then
                            MUL = 44
                            r1 = po
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                            po = r
                        Else
                            IsExpA = False
                            Exit Function
                        End If
                    Else
                            IsExpA = False
                            Exit Function
                    End If
                ElseIf Fast3Label(aa$, "MOD", 3, "ΥΠΟΛΟΙΠΟ", 8, "ΥΠΟΛ", 4, 9) Then
        
                    If logical(bstack, aa$, r, , True) Then
                        If UseIntDiv Then
                            MUL = 50
                            r1 = po
                            po = r
                        Else
                        MUL = 5
                        r1 = po
                        If Not rightoperator(bstack, aa$, r) Then
                            IsExpA = False
                            Exit Function
                        End If
                        po = r
                        End If
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r, , True) Then
                        If UseIntDiv Then MUL = 50 Else MUL = 5
                            r1 = po
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                            If Not rightoperator(bstack, aa$, r) Then
                                IsExpA = False
                                Exit Function
                            End If
                            po = r

                        Else
                            IsExpA = False
                            Exit Function
                        End If
                    Else
                        IsExpA = False
                        Exit Function
                    End If

                    ElseIf Fast3Label(aa$, "MOD#", 4, "ΥΠΟΛ#", 5, "ΥΠΟΛΟΙΠΟ#", 9, 10) Then
        
                    If logical(bstack, aa$, r, , True) Then
                        MUL = 55
                        r1 = po
                        If Not rightoperator(bstack, aa$, r) Then
                            IsExpA = False
                            Exit Function
                        End If
                        po = r
                    ElseIf FastSymbol(aa$, "(") Then
                        If IsExp(bstack, aa$, r, , True) Then
                            MUL = 55
                            r1 = po
                            If Not FastSymbol(aa$, ")") Then
                                IsExpA = False
                                Exit Function
                            End If
                            If Not rightoperator(bstack, aa$, r) Then
                                IsExpA = False
                                Exit Function
                            End If
                            po = r

                        Else
                            IsExpA = False
                            Exit Function
                        End If
                    Else
                        IsExpA = False
                        Exit Function
                    End If
        Else
         logic = True
         Exit Do
        End If
ElseIf MaybeIsSymbol(aa$, "AΑXΚΗOαaxκηoήΉ") And noand Then
If Fast2Label(aa$, "XOR", 3, "ΑΠΟ", 3, 4) Then
'  good
  MUL = 3
    If priorityOr Then
       If IsExp(bstack, aa$, r, , True) Then
            If ac <> 0 Then po = (ac + po)
            If po <> 0 Then po = -1
            If r <> 0 Then r = -1
            po = po Xor r
            ac = 0
        End If
    Else
        If FastSymbol(aa$, "(") Then
            If IsExp(bstack, aa$, r, , True) Then
                If ac <> 0 Then po = (ac + po)
                If po <> 0 Then po = -1
                If r <> 0 Then r = -1
                po = po Xor r
                ac = 0
                If Not FastSymbol(aa$, ")") Then
                    IsExpA = False: Exit Function
                End If
           Else
                IsExpA = False: Exit Function
            End If
        ElseIf IsExp(bstack, aa$, r, False, True) Then
            If ac <> 0 Then po = (ac + po)
            If po <> 0 Then po = -1
            If r <> 0 Then r = -1
            po = po Xor r
            ac = 0
        Else
            IsExpA = False
            Exit Function
        End If
    End If

ElseIf Fast2Label(aa$, "OR", 2, "Η", 1, 2) Then
'  good
  MUL = 3
If priorityOr Then
    If IsExp(bstack, aa$, r, , True) Then
    If ac <> 0 Then po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
    End If
Else
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    If ac <> 0 Then po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
     
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
     If ac <> 0 Then po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po Or r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
End If

ElseIf Fast2Label(aa$, "AND", 3, "ΚΑΙ", 3, 3) Then
'  good
  MUL = 3
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    If ac <> 0 Then po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po And r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
     If ac <> 0 Then po = (ac + po)
    If po <> 0 Then po = -1
    If r <> 0 Then r = -1
  po = po And r
     ac = 0
 End If
Else
logic = True
Exit Do
 End If
ElseIf FastSymbol(aa$, ")") Then
            If parenthesis > 0 Then
                parenthesis = parenthesis - 1
                If ac <> 0 Then po = ac + po: ac = 0
            Else
                aa$ = ")" & aa$
                If ac = 0 Then rr = po Else rr = ac + po
                Exit Function
            End If
ElseIf FastSymbol(aa$, "<>", , 2) Then
'  good
  MUL = 3
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
  po = (ac + po) <> r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
  po = (ac + po) <> r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf FastSymbol(aa$, "<=>", , 3) Then
'  good
  MUL = 1  ' from 3
If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    Select Case ac + po
    Case Is < r
    po = -1
    Case Is = r
    po = 0
    Case Else
    po = 1
    End Select
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
    Select Case ac + po
    Case Is < r
    po = -1
    Case Is = r
    po = 0
    Case Else
    po = 1
    End Select
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
 
ElseIf FastSymbol(aa$, "<=", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
  po = (ac + po) <= r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
  po = (ac + po) <= r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If

ElseIf FastSymbol(aa$, ">=", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
  po = (ac + po) >= r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
  po = (ac + po) >= r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf FastSymbol(aa$, "<<", , 2) Then
If logical(bstack, aa$, r) Then
                MUL = 500
               
                r1 = po
                po = r
            ElseIf FastSymbol(aa$, "(") Then
                If IsExp(bstack, aa$, r) Then
                    MUL = 1
                    r1 = po
                    po = r
                    If Not FastSymbol(aa$, ")") Then
                        IsExpA = False
                        Exit Function
                    End If
                End If
            Else
                IsExpA = False
                Exit Function
            End If
ElseIf FastSymbol(aa$, ">") Then
'  good
  MUL = 3
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
  po = (ac + po) > r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
        
ElseIf IsExp(bstack, aa$, r, False, True) Then
  po = (ac + po) > r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
    
ElseIf FastSymbol(aa$, "<") Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
  po = (ac + po) < r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
  po = (ac + po) < r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf FastSymbol(aa$, "==", , 2) Then
'  good
  MUL = 3
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    If r = 0 Then
            If ac <> 0 Then po = (ac + po)
            If po = 0 Then
                po = True
            Else
            Select Case VarType(r)
            Case vbDouble
                po = MyRound(po, 13) = 0
            Case vbSingle
                po = MyRound(po, 4) = 0
            Case Else
                po = po = 0
            End Select
            
            End If
    Else
    Select Case VarType(r)
    Case vbDouble
      po = MyRound((((ac + po) - r) / r), 10) = 0
    Case vbSingle
          po = (MyRound(ac + po, 4) - MyRound(r, 4)) = 0
    Case Else
              po = ((ac + po) - r) = 0
    End Select
  
  End If
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
    If r = 0 Then
            If ac <> 0 Then po = (ac + po)
            If po = 0 Then
                po = True
            Else
                po = MyRound(po, 13) = 0
            End If
    Else
  po = MyRound((((ac + po) - r) / r), 10) = 0
  
  End If
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If


ElseIf FastSymbol(aa$, "=") Then
'  good
  MUL = 3
 
   
    

If FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
      Set bstack.lastobj = Nothing
  po = (ac + po) = r
     ac = 0
        If Not FastSymbol(aa$, ")") Then
        IsExpA = False: Exit Function
        End If
   Else
   IsExpA = False: Exit Function
        End If
  ElseIf IsExp(bstack, aa$, r, False, True) Then
    po = (ac + po) = r
     ac = 0
     Else
    IsExpA = False
    Exit Function
 End If
ElseIf MaybeIsTwoSymbol(aa$, "->", 2) Then
logic = True
Exit Do
ElseIf FastSymbol(aa$, "-") Then
  ' second parameter push old value to ac
  ' get new one to r
  ' check if we have string logical
  ' or we have parenthesis (....
  ' or just a perform a -1*
If logical(bstack, aa$, r, , True) Then
    r1 = -r1
    MUL = 1 ' from 3
    If ac = 0 Then ac = po Else ac = ac + po
    po = r
    
 ElseIf FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    r1 = -r1
    MUL = 1 ' from 3
    If ac = 0 Then ac = po Else ac = ac + po
    po = r
    If Not FastSymbol(aa$, ")") Then
    IsExpA = False
    Exit Function
    End If
    End If
  Else
 '   r1 = -r1
    
   
    MissNumExpr
    IsExpA = False
    Exit Function
  End If
ElseIf FastSymbol(aa$, "+") Then
If logical(bstack, aa$, r, , True) Then
    MUL = 1 ' from 3
    
    If ac = 0 Then ac = po Else ac = ac + po
    
    If Err.Number = 6 Then
    Err.Clear
    ac = CDbl(ac) + CDbl(po)
    
    End If
    po = r
    ElseIf FastSymbol(aa$, "(") Then
    If IsExp(bstack, aa$, r, , True) Then
    MUL = 1 ' from 3
    If ac = 0 Then ac = po Else ac = ac + po
    po = r
    If Not FastSymbol(aa$, ")") Then
    IsExpA = False
    Exit Function
    End If
    End If
Else
    MissNumExpr
    IsExpA = False
    Exit Function
End If

Else
logic = True
Exit Do
End If
Loop
If ac = 0 Then ac = po Else ac = ac + po
If Err.Number = 6 Then
Err.Clear
ac = CDbl(ac) + CDbl(po)
End If
po = 1
Loop Until logic

rr = ac

Do While parenthesis > 0
If FastSymbol(aa$, ")") Then
parenthesis = parenthesis - 1
Else
Exit Do
End If
Loop
 Set park = Nothing
End Function


Function IsNumber(bstack As basetask, a$, r As Variant, Optional flatobject As Boolean = False) As Boolean
Dim VR As Long, v$, v1&, w1 As Long, w2 As Long, p As Variant, s1$, dd As Long, dn As Long, w3 As Long
Dim PP As Variant, pppp As mArray, nbstack As basetask, useHandler As mHandler, usebackup As Boolean
Dim anything As Object, n$
r = CDbl(0)
If a$ = vbNullString Then IsNumber = False: Exit Function
'On Error Resume Next
Dim sng&, SG As Variant, ig$, DE$, sg1 As Boolean, ex$, s$
Dim par As Boolean
SG = CLng(1)
Set bstack.lastobj = Nothing
'compute the sign portion
againfordot:
If MaybeIsSymbol2(a$, "[#+-]", sng&) Then
sng& = sng& - 1
Do While sng& < Len(a$)
sng& = sng& + 1
Select Case Mid$(a$, sng&, 1)
Case "#"
    If Len(a$) > sng& Then
    If MaybeIsSymbolNoSpace(Mid$(a$, sng& + 1, 1), "[0-9A-Fa-f]") Then
    s$ = "0x00" + Mid$(a$, sng& + 1, 6)
    If Len(s$) < 10 Then Exit Function
        If IsNumberCheck(s$, r) Then
        If s$ <> "" Then
          
             
        Else
            s$ = Right$("00000000" & Mid$(a$, sng& + 1, 6), 8)
            a$ = Mid$(a$, sng& + 7)
   r = SG * -(CDbl(UNPACKLNG(Right$(s$, 2)) * 65536#) + CDbl(UNPACKLNG(Mid$(s$, 5, 2)) * 256#) + CDbl(UNPACKLNG(Mid$(s$, 3, 2))))
   If MaybeIsSymbolNoSpace(Mid$(a$, 1, 1), "[0-9]") Then
   MyEr "Too many digits", "Πολλά ψηφία"
   IsNumber = False
   Else
   IsNumber = True
   End If
   Exit Function
        End If
        End If
        Else
        
    End If
    Else

    '' out
    End If
    Exit Function
Case " ", "+", ChrW(160)
Case "-"
SG = -SG
Case Else
Exit Do
End Select
Loop
End If
If sng& > 1 Then Mid$(a$, 1, sng& - 1) = Space$(sng& - 1)
'A$ = Mid$(A$, sng&)
againpointer:
w2 = Len(a$)
sng& = 1
If Len(a$) < 129 Then
    v1& = IsLabelBig(bstack, a$, v$, par, s1$, True, , usebackup)
Else
    n$ = Left$(a$, 128)
    v1& = IsLabelBig(bstack, n$, v$, par, s1$, True, , usebackup)
    If Len(n$) = 0 Then
        v1& = IsLabelBig(bstack, a$, v$, par, s1$, True, , usebackup)
    Else
        a$ = Mid$(a$, 129 - Len(n$))
    End If
End If


If v1& = 0 Then GoTo zerohere

If par Then
par = False
removethis:
dn = dn + 1
If dn > 2 Then
' it is a var with name this or ΑΥΤΟ
v1& = IsLabelOnly((v$), v$)
VR = -1

End If
v1& = Abs(v1&)
 
 If v1& = 1 Then
 GoTo LOOKFORVARNUM
 ElseIf v1& = 4 Then
 GoTo LOOKFORVARNUM4
 ElseIf v1& = 5 Or v1& = 7 Then
 GoTo LOOKFORSUBNUM
 Else
 IsNumber = False
  a$ = v$ + a$
    Exit Function
 End If
 ''
End If

Select Case v1&
Case 1
If usebackup Then
    If Not numidbackup.Find(v$, w1) Then GoTo LOOKFORVARNUM
Else
    If Not numid.Find(v$, w1, bstack.numnum) Then GoTo LOOKFORVARNUM
    If w1 < 0 Then GoTo LOOKFORVARNUM
End If
On w1 GoTo num1, num2, num3, num4, num5, num6, num7, num8, num9, num10, num11, num12, num13, num14, num15, num16, num17, num18, num19, num20, num21, num22, num23, num24, num25, num26, num27, num28, num29, num30, num31, num32, num33, num34, num35, num36, num37, num38, num39, num40, num41, num42, num43, num44, num45, num46, num47, num48, num49, num50, num51, num52, num53, num54, num55, num56, num57, num58, num59, num60, num61, num62, num63, num64, num65, num66, num67, num68, num69, num70, num71, num72, num73, num74, num75, num76, num77, num78, num79, num80, num81, num82, num83, num84, num85, num86, num87, num88, num89, num90, num91, num92, num93, num94, num95
num82:
IsNumber = 0
InternalError
Exit Function
num93:
Set bstack.lastobj = New VarItem
bstack.lastobj.Typename = ">"
r = 0
IsNumber = True
FastSymbol a$, "?"
Exit Function
num90: ' "WINDOW","ΠΑΡΑΘΥΡΟ"
r = SG * FindFormSScreen(bstack.Owner)
IsNumber = True
Exit Function
num89: '"OSBIT"
If Is64bit Then
r = SG * 64
Else
r = SG * 32
End If
IsNumber = True
Exit Function
num88: ' "ΟΘΟΝΗ","SHOW"
    If Not Screen.ActiveForm Is Nothing Then
    If bstack.Owner Is Form1.DIS Then
    r = SG * Form1.hWND = Screen.ActiveForm.hWND
    Else
    r = SG * bstack.Owner.hWND = Screen.ActiveForm.hWND
    End If
    Else
    r = False
    End If
IsNumber = True
Exit Function
num87: ' "ISWINE"
r = SG * IsWine
IsNumber = True
Exit Function
' Select Case v$
num1: ' "THIS", "ΑΥΤΟ"   ' 1
IsNumber = This1(bstack, v$, r)
Exit Function

num2: ' "RND", "ΤΥΧΑΙΟΣ"
r = SG * RndM(rndbase)
IsNumber = True
Exit Function

num3: ' "PEN", "ΠΕΝΑ"

With players(GetCode(bstack.Owner))
For w1 = 0 To 15
If QBColor(w1) = .mypen Then
r = SG * w1
IsNumber = True
Exit Function
End If
Next w1
r = SG * -.mypen
IsNumber = True
End With
Exit Function
num4: ' "HWND", "ΠΑΡΑΘΥΡΟ"
r = SG * myHwnd(bstack)

IsNumber = True
Exit Function
num5: ' Case "LOCALE", "ΤΟΠΙΚΟ"
r = SG * cLid
    
    IsNumber = True
    Exit Function

num6: ' "CODEPAGE", "ΚΩΔΙΚΟΣΕΛΙΔΑ"
r = SG * UserCodePage
    
    IsNumber = True
    Exit Function
num7: ' "SPEECH", "ΛΟΓΟΣ"
  r = SG * NumVoices

    
    IsNumber = True
    Exit Function
num8: ' "ERROR", "ΛΑΘΟΣ"
    If LastErNum2 <> 0 Then
        r = SG * LastErNum2
    Else
        r = SG * LastErNum1
    End If
    LastErNum2 = 0
    LastErNum1 = 0  'reset when readed
    IsNumber = True
    Exit Function
num9: ' "SCREEN.Y", "ΑΝΑΛΥΣΗ.Υ"
  r = SG * ScrInfo(Console).Height
    
    IsNumber = True
    Exit Function
num10: ' "SCREEN.X", "ΑΝΑΛΥΣΗ.Χ"
  r = SG * ScrInfo(Console).Width
     
    IsNumber = True
    Exit Function
num11: ' "TWIPSY", "ΥΨΟΣ.ΣΗΜΕΙΟΥ"
  r = SG * Screen.TwipsPerPixelY

    
    IsNumber = True
    Exit Function
num12: ' "TWIPSX", "ΠΛΑΤΟΣ.ΣΗΜΕΙΟΥ"
  r = SG * Screen.TwipsPerPixelX
    
    IsNumber = True
    Exit Function
num13: ' "REPORTLINES", "ΓΡΑΜΜΕΣΑΝΑΦΟΡΑΣ"
  r = SG * players(GetCode(bstack.Owner)).LastReportLines
    
    IsNumber = True
    Exit Function
num14: ' "LINESPACE", "ΔΙΑΣΤΙΧΟ"
    r = SG * players(GetCode(bstack.Owner)).uMineLineSpace '' bstack.linespace
    
    IsNumber = True
    Exit Function
num15: ' "MODE", "ΤΥΠΟΣ"
With players(GetCode(bstack.Owner))
If bstack.toprinter Then
    If .uMineLineSpace > .MineLineSpace Then
        r = SG * .SZ / szFactor / 2
    Else
         r = SG * .SZ / szFactor
    End If
    Else
    If .uMineLineSpace > .MineLineSpace Then
        r = SG * .SZ / 2
    Else
         r = SG * .SZ
    End If
    
    
    End If
    End With
    
    IsNumber = True
    Exit Function
num16: ' "MEMORY", "ΜΝΗΜΗ"
    r = SG * check_mem
    
    IsNumber = True
    Exit Function
num17: ' "CHARSET", "ΧΑΡΑΚΤΗΡΕΣ"   ' charset of the object to display
  r = SG * players(GetCode(bstack.Owner)).charset
    
    IsNumber = True
    Exit Function
num18: ' "ITALIC", "ΠΛΑΓΙΑ"  ' charset of the object to display
    
    r = SG * players(GetCode(bstack.Owner)).italics
    
    IsNumber = True
    Exit Function
num19: ' "BOLD", "ΦΑΡΔΙΑ"  ' charset of the object to display

    r = SG * players(GetCode(bstack.Owner)).bold
    
    IsNumber = True
    Exit Function

num20: ' "COLORS", "ΧΡΩΜΑΤΑ"
    r = SG * 2# ^ bitsPerPixel
    
    IsNumber = True
    Exit Function
num21: ' "ΑΥΞΟΥΣΑ", "ASCENDING"
    r = 0
    
    IsNumber = True
    Exit Function
num22: ' "ΦΘΙΝΟΥΣΑ", "DESCENDING"
    r = SG
    
    IsNumber = True
    Exit Function

num23: ' "BOOLEAN", "ΛΟΓΙΚΟΣ"
    r = SG * 1
        
    IsNumber = True
    Exit Function
num24: ' "BYTE", "ΨΗΦΙΟ"
    r = SG * 2
        
    IsNumber = True
    Exit Function
num25: ' "INTEGER", "ΑΚΕΡΑΙΟΣ"
    r = SG * 3
        
    IsNumber = True
    Exit Function
num26: ' "LONG", "ΜΑΚΡΥΣ"
    r = SG * 4
        
    IsNumber = True
    Exit Function
num27: ' "CURRENCY", "ΛΟΓΙΣΤΙΚΟ"
    r = SG * 5
        
    IsNumber = True
    Exit Function
num28: ' "SINGLE", "ΑΠΛΟΣ"
    r = SG * 6
        
    IsNumber = True
    Exit Function
num29: ' "DOUBLE", "ΔΙΠΛΟΣ"
    r = SG * 7
        
    IsNumber = True
    Exit Function
num30: ' "DATEFIELD", "ΗΜΕΡΟΜΗΝΙΑ"
    r = SG * 8
        
    IsNumber = True
    Exit Function
num31: ' "BINARY", "ΔΥΑΔΙΚΟ"
    r = SG * 9
        
    IsNumber = True
    Exit Function
num32: ' "TEXT", "ΚΕΙΜΕΝΟ"
    r = SG * 10
        
    IsNumber = True
    Exit Function
num33: ' "OLE"
    r = SG * 11
        
    IsNumber = True
    Exit Function
num34: ' "MEMO", "ΥΠΟΜΝΗΜΑ"
    r = SG * 12
        
    IsNumber = True
    Exit Function
num35: ' "REVISION", "ΑΝΑΘΕΩΡΗΣΗ"
    r = SG * Revision
    
    IsNumber = True
    Exit Function
num36: ' "BROWSER", "ΑΝΑΛΟΓΙΟ"
        
        r = SG * (Trim(LCase(Form1.view1.LocationURL)) = "about:blank" Or Form1.view1.Visible = False)
    
    IsNumber = True
    Exit Function
num37: ' "VERSION", "ΕΚΔΟΣΗ"
    r = SG * val(CStr(VerMajor) & "." & CStr(VerMinor))
    
    IsNumber = True
    Exit Function
num38: ' "MOTION.X", "ΚΙΝΗΣΗ.Χ"
With bstack
If .toprinter Then
    r = 0
Else
    r = SG * bstack.Owner.Left
    End If
    End With
    
    IsNumber = True
    Exit Function
num39: ' Case "MOTION.Y", "ΚΙΝΗΣΗ.Υ"
With bstack
If .toprinter Then
    r = 0
Else
    r = SG * .Owner.Top
    End If
    
    End With
    
    IsNumber = True

    Exit Function
num40: ' "MOTION.XW", "ΚΙΝΗΣΗ.ΧΠ", "MOTION.WX", "ΚΙΝΗΣΗ.ΠΧ"
    r = SG * Form1.Left
    
    IsNumber = True
    Exit Function
num41: ' "MOTION.YW", "ΚΙΝΗΣΗ.ΥΠ", "MOTION.WY", "ΚΙΝΗΣΗ.ΠΥ"
    r = SG * Form1.Top
    
    IsNumber = True
    Exit Function
num42: ' "FIELD", "ΠΕΔΙΟ"
    r = SG * Result
    
    
    IsNumber = True
    Exit Function
num43: ' "MOUSE.KEY", "ΔΕΙΚΤΗΣ.ΚΟΜ"
  
    r = SG * mouse


       
    IsNumber = True
    Exit Function
num44: ' "MOUSE", "ΔΕΙΚΤΗΣ"

If Not releasemouse Then
If Not Form1.Visible Then newshow basestack1
End If
r = SG * mouse
If r = 0 Then
MyDoEvents
     r = SG * mouse ' MOUB
End If
    


    IsNumber = True
    Exit Function
num45: ' "MOUSE.X", "ΔΕΙΚΤΗΣ.Χ"

With bstack
If .toprinter Then
'mouyb = Printer.CurrentY
r = Form1.PrinterDocument1.CurrentX
ElseIf .toback Then
'mouyb = mouy
r = MOUSEX(Form1.Left)
Else
'mouyb = mouy - di.top
r = MOUSEX(Form1.Left + bstack.Owner.Left)
End If
End With
      
    IsNumber = True
    Exit Function
num46: ' "MOUSE.Y", "ΔΕΙΚΤΗΣ.Υ"
With bstack
If .toprinter Then

r = Form1.PrinterDocument1.CurrentY
ElseIf .toback Then
'mouyb = mouy
r = MOUSEY(Form1.Top)
Else
'mouyb = mouy - di.top
r = MOUSEY(Form1.Top + bstack.Owner.Top)
End If
End With
       
    IsNumber = True
    Exit Function
num47: ' "MOUSEA.X", "ΔΕΙΚΤΗΣΑ.Χ"
  
    r = SG * MOUSEX(Form1.Left)
    
      
    IsNumber = True
    Exit Function
num48: ' "MOUSEA.Y", "ΔΕΙΚΤΗΣΑ.Υ"
 
    r = SG * MOUSEY(Form1.Top)
   
       
    IsNumber = True
    Exit Function

num49: ' "TRUE", "ΑΛΗΘΕΣ", "ΑΛΗΘΗΣ"
    r = CDbl(SG * -1)
    'r = CBool(sg * -1)
    IsNumber = True
    Exit Function
num50: ' "FALSE", "ΨΕΥΔΕΣ", "ΨΕΥΔΗΣ"
    r = CBool(0)
    r = CDbl(0)
    IsNumber = True
    Exit Function
num51: ' "STACK.SIZE", "ΜΕΓΕΘΟΣ.ΣΩΡΟΥ"
    IsNumber = True
    r = SG * bstack.soros.Total
    
    Exit Function
num52: ' "ISNUM", "ΕΙΝΑΡ"
    IsNumber = True
      If bstack.soros.Total > 0 Then
    If bstack.soros.PopType = "N" Then r = SG * True Else r = 0
    Else
    r = 0
    End If
    
    Exit Function
num53: ' "PI", "ΠΙ"
     r = BigPi
    If SG < 0 Then r = -r
    
    IsNumber = True
    Exit Function
num54: ' "NOT", "ΟΧΙ", "ΔΕΝ"
   ' r = SG * -1
    If FastSymbol(a$, "(") Then
    If IsExp(bstack, a$, r) Then
   
        r = CBool(r = 0)
        If SG < 0 Then r = -r
           IsNumber = FastSymbol(a$, ")")
           Exit Function
    Else
       NotAfter a$
    End If
    ElseIf IsExp(bstack, a$, r, False) Then
        r = CBool(r = 0)
        If SG < 0 Then r = -r
    Else
       NotAfter a$
    End If
    'a$ = "-" & a$
    IsNumber = True
    Exit Function
num55: ' "ISLET", "ΕΙΝΓΡ"
    IsNumber = True
    If bstack.soros.Total > 0 Then
    If bstack.soros.PopType = "S" Then r = SG * True Else r = 0
    End If
    
    Exit Function
num56: ' Case "WIDTH", "ΠΛΑΤΟΣ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).mx
    
    Exit Function
num57: ' "POINT", "ΣΗΜΕΙΟ"
'  dsprite ??
    IsNumber = True
    
    With players(GetCode(bstack.Owner))
       r = SG * -(GetPixel(bstack.Owner.hDC, .XGRAPH \ dv15, .YGRAPH \ dv15) And &HFFFFFF)
    End With
    
    Exit Function
num58: ' "POS.X", "ΘΕΣΗ.Χ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).XGRAPH
    
    Exit Function
num59: ' "POS.Y", "ΘΕΣΗ.Υ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).YGRAPH
    
    Exit Function
num60: ' "SCALE.X", "ΚΛΙΜΑΞ.Χ", "Χ.ΣΗΜΕΙΑ", "X.TWIPS"
    IsNumber = True
    If bstack.toprinter Then
    r = SG * Form1.PrinterDocument1.ScaleWidth
    Else
    r = SG * players(GetCode(bstack.Owner)).MAXXGRAPH
    End If
    
    Exit Function
num61: ' "SCALE.Y", "ΚΛΙΜΑΞ.Υ", "Υ.ΣΗΜΕΙΑ", "Y.TWIPS"
    IsNumber = True
    If bstack.toprinter Then
    r = SG * Form1.PrinterDocument1.ScaleHeight
    Else
    r = SG * players(GetCode(bstack.Owner)).MAXYGRAPH
    End If
    
    Exit Function
num62: ' "EMPTY", "ΚΕΝΟ"
    IsNumber = True
    r = SG * (bstack.soros.Total = 0)
    
    Exit Function
num63: ' "MOVIE.COUNTER", "MEDIA.COUNTER", "MUSIC.COUNTER", "ΤΑΙΝΙΑ.ΜΕΤΡΗΤΗΣ", "ΜΟΥΣΙΚΗ.ΜΕΤΡΗΤΗΣ"
    IsNumber = True
    r = SG * MediaPlayer1.getPositionInSec
    If MediaPlayer1.error > 0 Then
    r = SG * -1
    End If
    
    Exit Function
num64: ' "PLAYSCORE", "ΠΑΙΖΕΙΦΩΝΗ"
    IsNumber = True
    
       r = SG * TaskMaster.PlayMusic
    
    Exit Function
num65: ' "MOVIE", "MEDIA", "MUSIC", "ΤΑΙΝΙΑ", "ΜΟΥΣΙΚΗ"
    IsNumber = True
    AVIRUN = MediaPlayer1.isMoviePlaying
    r = SG * AVIRUN
    
    Exit Function
num66: ' "DURATION", "ΔΙΑΡΚΕΙΑ"
    IsNumber = True
    r = SG * MediaPlayer1.getLengthInMS / 1000
   
    
    Exit Function
num67: ' "VOLUME", "ΕΝΤΑΣΗ"
    IsNumber = True
    r = SG * CDbl(CLng(vol))
    
    Exit Function
num68: ' "TAB", "ΣΤΗΛΗ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).Column + 1  'CHANGED FROM Ver 7.1
    
    Exit Function
num69: ' "HEIGHT", "ΥΨΟΣ"
    IsNumber = True
    r = SG * players(GetCode(bstack.Owner)).My
    
    Exit Function
num70: ' "POS", "ΘΕΣΗ"
    IsNumber = True
    
    
    
    r = SG * GetRealPos(bstack.Owner)
    
    Exit Function
num71: ' "ROW", "ΓΡΑΜΜΗ"
    IsNumber = True
    r = SG * GetRealRow(bstack.Owner)
    
    Exit Function
num72: ' "TIMECOUNT", "ΦΟΡΤΟΣ" ' ****************************
  IsNumber = True
    r = SG * prof.MARKTWO
    
    Exit Function

num73: ' "TICK", "ΤΙΚ" ' ****************************
  IsNumber = True
  If TaskMaster Is Nothing Then
  r = 0
  ElseIf TaskMaster.QueueCount = 0 Then
  r = 0
  Else
    r = SG * tickTimer
  End If
    
    Exit Function
num74: ' "TODAY", "ΣΗΜΕΡΑ"
    IsNumber = True
    r = SG * CDbl(Date)
    
    Exit Function
num75: ' "NOW", "ΤΩΡΑ"
    IsNumber = True
    r = SG * CDbl(CDate(Time))
    
     Exit Function
num76: ' "MENU.VISIBLE", "ΕΠΙΛΟΓΕΣ.ΦΑΝΕΡΕΣ"  ' NEW 6.5 REV 8
    IsNumber = True
    r = SG * Form1.List1.Visible
    
    Exit Function
num77: ' "MENUITEMS", "ΕΠΙΛΟΓΕΣ"
    IsNumber = True
    r = SG * Form1.List1.listcount
    
    Exit Function
num78: ' "MENU", "ΕΠΙΛΟΓΗ"
    IsNumber = True
    r = 0
    With Form1.List1
    If .listcount > 0 Then
 
     r = SG * CDbl(.ListIndex + 1)
    End If
    End With
    
    Exit Function
num85: ' "[]"
 Set useHandler = New mHandler
    useHandler.t1 = 3
    Set useHandler.objref = New mStiva
     useHandler.objref.MergeBottom bstack.soros
    '  Set bstack.Sorosref = New mStiva
    Set bstack.lastobj = useHandler
    r = 0
    IsNumber = True
    Exit Function

num84: ' "ARRAY", "ΠΙΝΑΚΑΣ"
If bstack.soros.Total = 0 Then
    
           EmptyStack a$
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.StackItemTypeObjectType(1) = "*[mArray]" Then
        Set bstack.lastobj = bstack.soros.PopObj
        r = 0
        IsNumber = True
        Exit Function
    Else
   StackTopNotArray a$
  
    IsNumber = False
    End If
Exit Function
num95:
w1 = 1
GoTo num941
num94: '"BUFFER", "ΔΙΑΡΘΡΩΣΗ"
w1 = 2
num941:
If bstack.soros.Total = 0 Then
    
            EmptyStack a$
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.StackItemType(1) = "*" Then
        Set bstack.lastobj = bstack.soros.PopObj
        If bstack.lastobj.t1 <> w1 Then
            bstack.soros.PushObj bstack.lastobj
            Set bstack.lastobj = Nothing
            MyEr "No Proper Object", "Λάθος Αντικείμενο"
            IsNumber = False
            Exit Function
        End If
        If w1 = 1 Then
        Set useHandler = New mHandler
            useHandler.t1 = 3
            Set useHandler.objref = bstack.lastobj
            Set bstack.lastobj = useHandler
            Set useHandler = Nothing
        End If
        r = 0
        IsNumber = True
        Exit Function
    Else
    MyErMacro a$, "Stack top isn't " + v$, "Η κορυφή του σωρού δεν είναι " + v$

  
    IsNumber = False
    End If
    Exit Function
num83: ' "GROUP", "ΟΜΑΔΑ"
If bstack.soros.Total = 0 Then
    
            EmptyStack a$
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.StackItemTypeObjectType(1) = "Group" Then
        Set bstack.lastobj = bstack.soros.PopObj
        r = 0
        IsNumber = True
        Exit Function
    Else
    StackTopNotGroup a$
  
    IsNumber = False
    End If
    Exit Function
num79: ' "NUMBER", "ΑΡΙΘΜΟΣ", "ΤΙΜΗ"
    If bstack.soros.Total = 0 Then
    
            EmptyStack a$
  
        IsNumber = False: Exit Function

    ElseIf bstack.soros.PopType = "N" Then
    If SG = 1 Then
    r = bstack.soros.PopVal
    Else
    r = -bstack.soros.PopVal
    End If
    
    IsNumber = True
    Exit Function
    ElseIf bstack.soros.PopType = "L" Then
    r = SG * bstack.soros.PopVal
    
    IsNumber = True
    Exit Function
    Else
     
            StackTopNotNumber a$
  
    IsNumber = False
    End If
    Exit Function
num81: ' "ΛΑΜΔΑ"
    Set bstack.lastobj = ProcLambda(bstack, a$, 0)
    r = 0
   If FastSymbol(a$, "(") Then
    If Not CallLambdaASAP(bstack, a$, r) Then IsNumber = False: Exit Function
    If SG < 0 Then r = -r
    IsNumber = True
    Else
    IsNumber = Not bstack.lastobj Is Nothing
    End If
Exit Function
num80: ' "LAMBDA"
    Set bstack.lastobj = ProcLambda(bstack, a$, 1)
    r = 0
    If FastSymbol(a$, "(") Then
    If Not CallLambdaASAP(bstack, a$, r) Then IsNumber = False: Exit Function
    If SG < 0 Then r = -r
    IsNumber = True
    Else
    IsNumber = Not bstack.lastobj Is Nothing
    End If
Exit Function
num86: ' Case "STACK", "ΣΩΡΟΣ"
IsNumber = IsStackObj(v$, bstack, a$, r, SG)
    Exit Function
num91: 'MONITOR.STACK - ΕΛΕΓΧΟΣ.ΣΩΡΟΥ
    r = SG * CurrentStackSize()
    IsNumber = True
    Exit Function
Exit Function
num92: 'MONITOR.STACK.SIZE - ΕΛΕΓΧΟΣ.ΜΕΓΕΘΟΣ.ΣΩΡΟΥ
    r = SG * stacksize
    IsNumber = True
    Exit Function
Exit Function
LOOKFORVARNUM:
If GetVar(bstack, v$, VR) Then
    If MyIsObject(var(VR)) Then
    n$ = v$
        v$ = Typename(var(VR))
        If v$ Like "Pro*" Then
            If MyIsObject(var(VR).Value) Then
               Set bstack.lastobj = var(VR).Value
                r = 0
            Else

                r = var(VR).Value
                If SG < 0 Then r = -r
            End If
        ElseIf v$ Like "Gr*" Then
            If var(VR).HasValue And Not IsOperator(a$, "::", 2) Then
                s1$ = n$ + "." + ChrW(&H1FFF) + ";()"
                If GetSub(s1$, v1&) Then
foundprivate:
                    Set nbstack = New basetask
                    nbstack.reflimit = varhash.count
                    Set nbstack.Parent = bstack
                    If bstack.IamThread Then Set nbstack.Process = bstack.Process
                    Set nbstack.Owner = bstack.Owner
                    nbstack.OriginalCode = v1&
                    nbstack.UseGroupname = sbf(v1&).sbgroup
                    If GoFunc(nbstack, s1$, ")", p) Then
                        If Not nbstack.StaticCollection Is Nothing Then
                            bstack.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                        End If
                        'Set bstack.lastobj = nBstack.lastobj
                 If IsOperator(a$, "(") Then
                            Set pppp = New mArray
                            Set pppp.GroupRef = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            pppp.Arr = False
                            w2 = -2
                        Set nbstack = Nothing
                         v$ = vbNullString
                            GoTo contrightpar
                        End If
                       Set nbstack = Nothing
                       
                       r = p
                       If SG < 0 Then r = -r
                        IsNumber = True
                    Else
                        IsNumber = False
                    End If
                Else
                    If var(VR).HasStrValue Then
                        r = 0
                        Set bstack.lastobj = CopyGroupObj(var(VR))
                    Else
                        r = 0
                        w3 = Len(n$) - rinstr(n$, ".") + 1
                        s1$ = Left$(n$, w3) + ChrW(&HFFBF) + Mid$(n$, w3 + 1) + "." + ChrW(&H1FFF) + ";()"
                        If GetSub(s1$, v1&) Then GoTo foundprivate
                        InternalEror
                        IsNumber = False
                    End If
                End If
            Else
             
                r = 0
                If var(VR).IamApointer Then  ' ???
                If Mid(a$, 1, 2) = "=>" Then
                If var(VR).link.IamFloatGroup Then
                Set pppp = BoxGroupVar(var(VR))
                Mid$(a$, 1, 2) = "." + Chr(3)
                IsNumber = SpeedGroup(bstack, pppp, "VAL", "", a$, (0)) = 1
                r = bstack.LastValue
                
                If SG < 0 Then r = -r
                Else
                Mid(a$, 1, 2) = Chr$(0) + "."
                Set bstack.lastpointer = var(VR)
                
                GoTo againpointer
                End If
                
                Else
                Set bstack.lastpointer = var(VR).link
                Set bstack.lastobj = var(VR)
                End If
                Else
                CopyGroup2 var(VR), bstack
                Set bstack.lastpointer = Nothing
      
              
                End If
            End If
        ElseIf v$ Like "mE*" Then
            CopyEvent var(VR), bstack
            r = 0
        ElseIf v$ = "lambda" Then
            
            CopyLambda var(VR), bstack
            r = 0
        ElseIf v$ = "mHandler" Then
        ' this is ok for both buffer and inventory
          If var(VR).t1 = 2 Then
            CopyHandler var(VR), bstack
            r = 0
            Else
            If Not var(VR).UseIterator Then
            If flatobject Then
            If var(VR).t1 = 4 Then
            r = var(VR).index_cursor
            If SG < 0 Then r = -r
            Else
            r = 0
            End If
            
            Else
            CopyHandler var(VR), bstack
            r = 0
            End If
            ElseIf FastSymbol(a$, "^") Then
                   
                    r = var(VR).index_cursor
                   If SG < 0 Then r = -r
              Else
               Set bstack.lastobj = var(VR)
                r = 0
            End If
        End If
        ElseIf v$ = "Constant" Then
            r = var(VR)
        Else
                Set bstack.lastobj = MakeitObjectGeneric(VR)
                r = 0
        End If
    
Else
If IsNumeric(var(VR)) Then

        r = var(VR)
        If SG < 0 Then r = -r
   Else
   r = 0
  
    End If
End If

IsNumber = True
ElseIf VR = -1 Then

r = ReadVarDouble(bstack, v$)
If SG < 0 Then r = -r

IsNumber = True
Exit Function
Else
If Len(v$) > 5 Then
If Left$(v$, 5) = "THIS." Or Left$(v$, 5) = "ΑΥΤΟ." Then
v$ = Mid$(v$, 5)
v1& = IsLabel(bstack, (v$), v$)
If v$ <> "" Then GoTo removethis
End If
End If
IsNumber = False  ''         " " + & String$(w2 - Len(a$), " ")
If IsObject(bstack.LastEnum) Then
  r = bstack.LastEnum.SearchSimple(v$, par)
  If par Then
  If SG < 0 Then r = -r
  IsNumber = True
  Exit Function
  End If
 End If

 ''If w2 >= Len(a$) Then a$ = " " & String$(w2 - Len(a$), " ") + a$ Else
  If w2 >= Len(a$) Then
  If v$ = myUcase(s1$, True) Then
  a$ = s1$ + a$
  Else
  a$ = v$ + a$
  End If
  End If
   
 If FindNameForGroup(bstack, v$) Then
  UnknownProperty1 a$, v$
 Else

 If v$ = "" Then v$ = s1$
  
 UnknownVariable1 a$, v$
End If
End If
Exit Function

Case 4
LOOKFORVARNUM4:
If GetVar(bstack, v$, VR) Then
If Typename(var(VR)) = "lambda" Then
CopyLambda var(VR), bstack
Else
If SG < 0 Then r = -r
r = var(VR)

End If

IsNumber = True
Else
If VR = -1 Then
If SG < 0 Then r = -r
r = ReadVarInt(bstack, v$)

IsNumber = True
Exit Function
End If
IsNumber = False
    If w2 >= Len(a$) Then a$ = Left$(v$ + Space$(Len(v$)), w2 - Len(a$)) + a$ Else
        If FindNameForGroup(bstack, v$) Then
            UnknownProperty1 a$, v$
        Else
            UnknownVariable1 a$, v$
        End If
    End If


Exit Function
Case 7
 GoTo LOOKFORSUBNUM
Case 5
'On Error Resume Next
If usebackup Then
        If Not funidbackup.Find(v$, w1) Then GoTo LOOKFORSUBNUM
Else
    If Not funid.Find(v$, w1, bstack.numfunnum) Then GoTo LOOKFORSUBNUM
    If w1 < 0 Then GoTo LOOKFORSUBNUM
End If
'Select Case v$


On w1 GoTo fun1, fun2, fun3, fun4, fun5, fun6, fun7, fun8, fun9, fun10, fun11, fun12, fun13, fun14, fun15, fun16, fun17, fun18, fun19, fun20, fun21, fun22, fun23, fun24, fun25, fun26, fun27, fun28, fun29, fun30, fun31, fun32, fun33, fun34, fun35, fun36, fun37, fun38, fun39, fun40, fun41, fun42, fun43, fun44, fun45, fun46, fun47, fun48, fun49, fun50, fun51, fun52, fun53, fun54, fun55, fun56, fun57, fun58, fun59, fun60, fun61, fun62, fun63, fun64, fun65, fun66, fun67, fun68, fun69, fun70, fun71, fun72, fun73, fun74, fun75, fun76, fun77, fun78, fun79, fun80, fun81, fun82, fun83, fun84, fun85, fun86, fun87, fun88, fun89, fun90, fun91, fun92, fun93, fun94, fun95, fun96, fun97, fun98, fun99, fun100, fun101, fun102, fun103, fun104, fun105, fun106, fun107
IsNumber = False
Exit Function
fun101: ' "BANK(", "ΤΡΑΠ("
IsNumber = False
If IsExp(bstack, a$, r) Then
    If FastSymbol(a$, ",") Then
        If IsExp(bstack, a$, p) Then
            r = Round(r, CLng(p))
            IsNumber = FastSymbol(a$, ")", True)
            Else
                MissParam a$
        End If
    Else
    r = Round(r)
    IsNumber = FastSymbol(a$, ")", True)
End If
    Else
                    
                MissParam a$
    End If

Exit Function

fun99: ' case "IF(","ΑΝ("
IsNumber = False
If IsExp(bstack, a$, p) Then IsNumber = ProcessIf(p, bstack, a$, r)
Exit Function
fun97: ' "READY(", "ΕΤΟΙΜΟ("
IsNumber = False
    w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * Not var(w1).busy
                Else
                    r = SG * True
                End If
                
                IsNumber = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * Not pppp.item(w2).busy
                      Else
                      r = SG * True
                      End If
                Else
                
                End If
                    
                IsNumber = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    End If
    Exit Function
fun100: ' "ORDER(","ΤΑΞΗ("
' this is same as sort numbers inside strings
If IsStrExp(bstack, a$, s1$) Then
If FastSymbol(a$, ",") Then
If IsStrExp(bstack, a$, s$) Then
If FastSymbol(a$, ")") Then
IsNumber = True
r = SG * -compareStr4(s$, s1$)
Exit Function
Else
SyntaxError
Exit Function
End If
End If
End If
End If
MissStringExpr
IsNumber = False
Exit Function
fun1: ' "PARAM(", "ΠΑΡΑΜ("
v$ = vbNullString
If IsStrExp(bstack, a$, s1$) Then

Do
w1 = Len(s1$)
      If IsNumberD2(s1$, p) Then
      If v$ = vbNullString Then
      r = p
      If SG < 0 Then r = -r
      
        v$ = " "
      Else
      Select Case VarType(p)
        Case vbLong
        v$ = v$ + "," + Str(p) + "&"
        Case vbDecimal
        v$ = v$ + "," + Str(p) + "@"
        Case vbSingle
        v$ = v$ + "," + Str(p) + "~"
        Case vbCurrency
        v$ = v$ + "," + Str(p) + "#"
        Case vbInteger
        v$ = v$ + "," + Str(p) + "%"
        Case Else
        v$ = v$ + "," + Str(p)
        End Select
      End If
      Else
             ISSTRINGA s1$, s$
        If v$ = vbNullString Then Exit Do Else v$ = v$ + ",{" + s$ + "}"
    End If
    FastSymbol s1$, ","
Loop Until Trim$(s1) = vbNullString Or w1 = Len(s1$)
ElseIf IsExp(bstack, a$, p) Then
    If bstack.lastobj Is Nothing Then
        ExpectedObjInline a$
    ElseIf TypeOf bstack.lastobj Is mHandler Then
        Set useHandler = bstack.lastobj
        Set bstack.lastobj = Nothing
        If useHandler.indirect >= 0 Then
            If MyIsObject(var(useHandler.indirect)) Then
                Set bstack.lastobj = New mHandler
                On Error Resume Next
                'Err.Clear
                ' maybe we want the typelib
                If FastSymbol(a$, ",") Then
                
                End If
                Set bstack.lastobj.objref = MakeATypeLib(var(useHandler.indirect))

                If Err Then
                   Set bstack.lastobj = Nothing
                   cantreadlib a$
                   Else
                   bstack.lastobj.t1 = 1
                End If
                On Error GoTo 0
                Set useHandler = Nothing
            Else
            ExpectedObjInline a$
            End If
            Else
            If useHandler.IamEnum Then Set anything = useHandler.objref: GoTo contparamhere
        End If
    ElseIf TypeOf bstack.lastobj Is PropReference Then
        If bstack.lastobj.IsObj Then
            Set anything = bstack.lastobj.Value
contparamhere:
            Set bstack.lastobj = New mHandler
                On Error Resume Next
                'Err.Clear
                ' maybe we want the typelib
                If FastSymbol(a$, ",") Then
                
                End If
                Set bstack.lastobj.objref = MakeATypeLib(anything)

                If Err Then
                   Set bstack.lastobj = Nothing
                   cantreadlib a$
                   Else
                   bstack.lastobj.t1 = 1
                End If
                On Error GoTo 0
                Set useHandler = Nothing
         Else
            ExpectedObjInline a$
        End If
    Else
     
            Set anything = bstack.lastobj
            Set bstack.lastobj = New mHandler
                On Error Resume Next
                'Err.Clear
                ' maybe we want the typelib
                If FastSymbol(a$, ",") Then
                
                End If
                Set bstack.lastobj.objref = MakeATypeLib(anything)

                If Err Then
                   Set bstack.lastobj = Nothing
                   cantreadlib a$
                   Else
                   bstack.lastobj.t1 = 1
                End If
                On Error GoTo 0
                Set useHandler = Nothing

    End If

End If
    IsNumber = FastSymbol(a$, ")", True)
    a$ = Mid$(v$, 2) + a$
    Exit Function
fun73: ' "EACH("
If iter(bstack, a$, 1) Then
    r = 0
    IsNumber = FastSymbol(a$, ")", True)
Else
        IsNumber = False
End If
 Exit Function
fun72: ' "ΚΑΘΕ("
If iter(bstack, a$, 0) Then
    r = 0
    IsNumber = FastSymbol(a$, ")", True)
Else
        IsNumber = False
End If
 Exit Function
fun2: ' "STACKITEM(", "ΤΙΜΗΣΩΡΟΥ("
IsNumber = StackItem(bstack, a$, SG, r)
Exit Function
fun3: ' "SGN(", "ΣΗΜ("
If IsExp(bstack, a$, p) Then
r = Sgn(MyRound(p, 28))
If SG < 0 Then r = -r


 IsNumber = FastSymbol(a$, ")", True)
 Else
 MissParam a$: IsNumber = False
End If
Exit Function

fun4: ' "FRAC(", "ΔΕΚ("
If IsExp(bstack, a$, p) Then
r = SG * MyRound(Abs(Abs(p) - Int(Abs(p))), 13)


 IsNumber = FastSymbol(a$, ")", True)
 Else
: MissParam a$: IsNumber = False
End If
Exit Function
fun5: ' "MATCH(", "ΤΑΥΤΙΣΗ("
If IsStrExp(bstack, a$, s1$) Then
If s1$ = vbNullString Then
r = 0

               IsNumber = FastSymbol(a$, ")", True)
ElseIf VALIDATEmStiva(bstack, UCase$(s1$), s$) Then   ' Only S and N
                If s$ = vbNullString Then
                    r = 0
                Else
                   r = -SG
               End If
               Else
               r = 0
               End If
               
               IsNumber = FastSymbol(a$, ")", True)
Else
MissParam a$
End If
Exit Function
fun6: ' "LOCALE(", "ΤΟΠΙΚΟ("
If IsStrExp(bstack, a$, s1$) Then
If FastSymbol(a$, ",") Then
If IsExp(bstack, a$, p) Then
r = SG * FoundSpecificLocaleId(s1$, CLng(Fix(p)))
Else
MissParam a$: IsNumber = False: Exit Function
End If
Else
r = SG * FoundLocaleId(s1$)
End If
   

    IsNumber = FastSymbol(a$, ")", True)
End If
Exit Function
fun7: ' "FILELEN(", "ΑΡΧΕΙΟΥ.ΜΗΚΟΣ("
If IsStrExp(bstack, a$, s1$) Then
If s1$ = vbNullString Then
r = 0

               IsNumber = FastSymbol(a$, ")", True)
Else
If ExtractPath(s1$) = vbNullString Then
                If CFname(s1$) <> "" Then
                    s1$ = CFname(s1$)
                ElseIf mylcasefILE(s1$) = ExtractName(s1$) Then
                    s1$ = mcd + s1$
                End If
End If
       r = SG * FileLen(GetDosPath(s1$))
               
               IsNumber = FastSymbol(a$, ")", True)
End If
Else
: MissParam a$
End If
Exit Function
fun8: ' "TAB(", "ΣΤΗΛΗ("
If IsExp(bstack, a$, p) Then

r = SG * p * (players(GetCode(bstack.Owner)).Column + 1)
   
    IsNumber = FastSymbol(a$, ")", True)
End If
Exit Function
fun9: ' "KEYPRESS(", "ΠΑΤΗΜΕΝΟ("
If Not IsExp(bstack, a$, p) Then
MissNumExpr
IsNumber = False
Exit Function
Else
r = SG * CLng(KeyPressed(CLng(Fix(p))))

End If
 

    IsNumber = FastSymbol(a$, ")", True)
    Exit Function
fun10: ' "INKEY(", "ΕΝΚΟΜ("

BLOCKkey = True
If Not IsExp(bstack, a$, p) Then p = 50: dn = 1
If p < 50 Then p = 50
p = p / 2
    p = uintnew(p + timeGetTime)
   If dn = 1 Then r = 0 Else r = clickMe

If Not (bstack.IamThread And dn = 1) Then clickMe2 = -2
               w1 = -1
                    Do While p > uintnew(timeGetTime)
                  
                  
                 If Not bstack.IamThread Then
                    MyDoEvents
                    mywait bstack, 1
                    Else
                    
                    p = 0
                    ''If (dn = 0) Then
                    If r = clickMe2 Then Exit Do
                    
                    r = -3
                      clickMe2 = clickMe
                      
                      
                    End If
                    If clickMe2 = r Then clickMe2 = -2
                    If w1 = -1 Then
                    If clickMe2 <> -2 Then
             
              
                    w1 = clickMe2
              
                    If w1 = 19 Or w1 = 131139 Then
                    'this IS A BREAK
                    BLOCKkey = False
                  
                   Form1.GiveASoftBreak (w1 = 19)
                    End If
                    p = 0
                    End If
                    End If
                     
                Loop
                If bstack.IamThread Then
        If bstack.LastClick = w1 Then
            w1 = -1
        Else
            bstack.LastClick = w1
        End If
End If
  r = SG * w1
    
  clickMe2 = -1



IsNumber = FastSymbol(a$, ")", True)
BLOCKkey = False
Exit Function
fun11: ' "ΤΜΗΜΑ(", "MODULE("
      MakeThisSub bstack, a$
    If IsLabel(bstack, a$, s$) Then
        r = SG * True
        If Right$(s$, 1) = "(" Then
            FastSymbol a$, ")"
            s$ = s$ + ")"
        End If
        If GetlocalSub(s$, w1) Then
            ElseIf Not GetSub(s$, w1) Then
            If Not GetSub2(bstack, s$, w1) Then
                r = False
                End If
        End If
        IsNumber = True
    End If

    IsNumber = FastSymbol(a$, ")", True)
Exit Function
fun12: ' "ΒΑΣΗ(", "MDB("
If IsStrExp(bstack, a$, s$) Then
If ExtractType(s$) = vbNullString Then s$ = s$ & ".MDB"
s$ = CFname(s$)
If s$ <> "" Then
r = CheckMine(s$)
Else
r = 0
End If
   
    IsNumber = FastSymbol(a$, ")", True)
End If
Exit Function
fun13: ' "ASK(", "ΡΩΤΑ("
If IsStrExp(bstack, a$, AskText$) Then
If Not CallAsk(bstack, a$, v$) Then IsNumber = False: Exit Function

r = SG * Form3.NeoASK(bstack)
AskInput = False
    IsNumber = FastSymbol(a$, ")", True)
End If
Exit Function
fun14: ' "ΣΥΓΚΡΟΥΣΗ(", "COLLIDE("
    IsNumber = IsCollide(bstack, a$, r, SG)
    Exit Function
fun15: ' "ΜΕΓΕΘΟΣ.Υ(", "SIZE.Y("

    IsNumber = SizeY(bstack, SG, a$, s$, s1$, r)
    Exit Function
fun16: ' "ΜΕΓΕΘΟΣ.Χ(", "SIZE.X("
    IsNumber = SizeX(bstack, SG, a$, s$, s1$, r)
    Exit Function
fun17: ' "WRITABLE(", "ΕΓΓΡΑΨΙΜΟ("  ' αν μπορώ να γράψω στο φάκελο
    If IsStrExp(bstack, a$, s$) Then
      r = SG * WeCanWrite(s$)
   
    
    
    IsNumber = FastSymbol(a$, ")", True)
    Exit Function
    End If
    IsNumber = False
    Exit Function
fun18: ' "COLOR(", "COLOUR(", "ΧΡΩΜΑ("
    
            
    If Not ColorRGB(bstack, a$, r) Then Exit Function
     
    r = SG * -r

        IsNumber = FastSymbol(a$, ")", True)
        Exit Function
fun19: ' "DIMENSION(", "ΔΙΑΣΤΑΣΗ("
IsNumber = IsDimension(bstack, a$, r, SG)

    Exit Function
fun20: ' "ARRAY(", "ΠΙΝΑΚΑΣ("
    IsNumber = IsArrayFun(bstack, a$, r, SG)
    Exit Function
fun21: ' "FUNCTION(", "ΣΥΝΑΡΤΗΣΗ("
IsNumber = False
    If IsStrExp(bstack, a$, s$) Then
    If IsSymbolBracket(s$) Then
            PushStage bstack, False
            s1$ = block(s$)
            FastSymbol s$, "}"
            GlobalSub "A_()", s1$, Trim$(s$)
            IsSymbol3 a$, ","
              a$ = "A_(@" & a$
            IsNumber = IsExp(bstack, a$, p)
            r = SG * p
            PopStage bstack
Else
If MaybeIsSymbol(a$, ".") Then
dd = 1
      s1$ = aheadstatus(a$, , dd)
s$ = s$ + Left$(a$, dd - 1)
a$ = Mid$(a$, dd)
End If
    If FastSymbol(a$, ",") Then
    End If
     If Right$(s$, 1) = ")" Then
        a$ = Left$(s$, Len(s$) - 1) & a$
    ElseIf InStr(s$, ").") > 0 Then
    If Not FastSymbol(a$, ")") Then
        a$ = s$ & "(@" & a$
    Else
        a$ = s$ & a$
        End If
     Else
      a$ = s$ & "(@" & a$
      End If
    IsNumber = IsExp(bstack, a$, p)
    r = SG * p
  End If
    Else
        MissParam a$
    
    End If
    Exit Function
fun22: ' "DRIVE.SERIAL(", "ΣΕΙΡΙΑΚΟΣ.ΔΙΣΚΟΥ("
IsNumber = DriveSerial1(bstack, a$, r, SG)
Exit Function
fun23: ' "FILE.STAMP(", "ΑΡΧΕΙΟΥ.ΣΤΑΜΠΑ("
IsNumber = False
    If IsStrExp(bstack, a$, s$) Then
    PP = 1
    If IsSymbol(a$, ",") Then
        If Not IsExp(bstack, a$, PP) Then
        
         MissNumExpr
        Exit Function
        End If
    End If
    If CFname(s$, p, PP) <> vbNullString Then
    If p = 0 Then
    CantReadFileTimeStap a$
    Else
     r = SG * p
     End If
     Else
        BadFilename
        Exit Function
     
     End If
     
    
    IsNumber = FastSymbol(a$, ")", True)
    Else
 MissParam a$
    End If
    Exit Function
fun25: ' "EXIST.DIR(", "ΥΠΑΡΧΕΙ.ΚΑΤΑΛΟΓΟΣ("
IsNumber = False
    If IsStrExp(bstack, a$, s$) Then
    r = SG * isdir(s$)
     
    
    IsNumber = FastSymbol(a$, ")", True)
    Else
: MissParam a$
    End If
    Exit Function
fun26: ' "EXIST(", "ΥΠΑΡΧΕΙ("
IsNumber = False
    If IsExp(bstack, a$, p) Then
    If Typename(bstack.lastobj) = "mHandler" Then
    Set anything = bstack.lastobj
    Set bstack.lastobj = Nothing
       If Not CheckLastHandler(anything) Then
        InternalError
        IsNumber = False
        Exit Function
        End If
    With anything
        If anything.indirect >= 0 Then
                dd = anything.indirect
                dn = 0
                Do While (TypeOf var(dd) Is mHandler) And dn < 20
                    If var(dd).indirect >= 0 Then dd = var(dd).indirect Else Exit Do
                    dn = dn + 1
                Loop
                If dn = 20 Then
                InternalError
                Exit Function
                End If
                Select Case dd
                Case 1 To var2used
                    r = SG * MyIsObject(var(dd))
                Case Else
                    r = 0
                End Select
                
                IsNumber = FastSymbol(a$, ")", True)
                
                Set anything = Nothing
                Exit Function
        ElseIf TypeOf .objref Is FastCollection Then
            If FastSymbol(a$, ",") Then
                If IsExp(bstack, a$, p) Then
                    r = SG * .objref.Find(p)
                ElseIf IsStrExp(bstack, a$, s$) Then
                    r = SG * .objref.Find(s$)
                End If
                
                
                IsNumber = FastSymbol(a$, ")", True)
                
                Set anything = Nothing
                Exit Function
            End If
        End If
    End With
      
    End If
    Set anything = Nothing
    
    MissParam a$
    Set bstack.lastobj = Nothing
    ElseIf IsStrExp(bstack, a$, s$) Then
    s$ = CFname(s$)
    If s$ <> "" Then
      r = SG * (InStr(s$, "*") = 0 And InStr(s$, "?") = 0)
      Else
  
    r = 0
    End If
   
    
    
    IsNumber = FastSymbol(a$, ")", True)
    Else
        MissParam a$
    End If
    Exit Function
    
fun27: ' "JOYPAD(", "ΛΑΒΗ("
  IsNumber = False
    If IsExp(bstack, a$, r) Then
        
    r = SG * Int(r)
    
    
    If r < 0 Or r > 15 Then
    
    WrongJoypadNumber a$

    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
    IsNumber = False
        joypader a$, r
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        joypader a$, r
        
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).lngButton
IsNumber = FastSymbol(a$, ")", True)
       Else
       IsNumber = False
  MissParam a$
         ' IsNumber = FastSymbol(a$, ")")
  End If
  Exit Function
fun28: ' "JOYPAD.DIRECTION(", "ΛΑΒΗ.ΚΑΤΕΥΘΥΝΣΗ("
  IsNumber = False
    If IsExp(bstack, a$, r) Then
    r = SG * Int(r)
    
    If r < 0 Or r > 15 Then
    
    WrongJoypadNumber a$
    
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        joypader a$, r
    
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        joypader a$, r
    
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).joyPaD
    IsNumber = FastSymbol(a$, ")", True)
       Else
        MissParam a$
  End If
  Exit Function
fun29: ' "JOYPAD.ANALOG.X(", "ΛΑΒΗ.ΑΝΑΛΟΓΙΚΟ.Χ("
  IsNumber = False
    If IsExp(bstack, a$, r) Then
    r = SG * Int(r)
    
    If r < 0 Or r > 15 Then
    
    WrongJoypadNumber a$
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        joypader a$, r
            Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        joypader a$, r
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).AnalogX
    IsNumber = FastSymbol(a$, ")", True)
       Else
        MissParam a$
  End If
  Exit Function
fun30: ' "JOYPAD.ANALOG.Y(", "ΛΑΒΗ.ΑΝΑΛΟΓΙΚΟ.Υ("
  IsNumber = False
    If IsExp(bstack, a$, r) Then
    r = SG * Int(r)
    
    If r < 0 Or r > 15 Then
    
    WrongJoypadNumber a$
    Exit Function
    End If
    If Not MYJOYSTAT(r).enabled Then
        joypader a$, r
    Exit Function
    End If
    If Not MYJOYSTAT(r).Wait2Read Then
    PollJoypadk  ' να το δω άμεσα
    
    If Not MYJOYSTAT(r).Wait2Read Then
        joypader a$, r
    Exit Function
    End If
    End If
    r = SG * MYJOYSTAT(r).AnalogY
    IsNumber = FastSymbol(a$, ")", True)
       Else
            MissParam a$
  End If
  Exit Function
fun104: ' "BUFFER(", "ΔΙΑΡΘΡΩΣΗ("
IsNumber = False
    If IsStrExp(bstack, a$, s$) Then
    If Not bstack.lastobj Is Nothing Then GoTo contbuf1
     w1 = Abs(Asc(v$) < 128)
    If IsLabelSymbolNew(a$, "ΩΣ", "AS", w1) Then
    If IsSymbol(a$, "DECODE64", 8) Then
    Else
    MyEr "Only Decode64 supported", "Μόνο το Decode64 υποστηρίζεται"
    Exit Function
    End If
        Set useHandler = New mHandler
        useHandler.t1 = 2
        
        Set useHandler.objref = Decode64toMemBloc(s$, par)
        If par Then

            Set bstack.lastobj = useHandler
            
            
            IsNumber = FastSymbol(a$, ")", True)
            Exit Function
        Else
            MyEr "Can't Decode String", "Δεν μπορώ να αποκωδικοποιήσω το αλφαριθμητικό"
            IsNumber = False
            Exit Function
        End If
    ElseIf CFname(s$) <> "" Then
        Set useHandler = New mHandler
        useHandler.t1 = 2
        If FastSymbol(a$, ",") Then
            If Not IsExp(bstack, a$, p) Then
            MissNumExpr
            Exit Function
            End If
            End If
        Set useHandler.objref = File2newMemblock(s$, r, p)
        If r = 0# Then

            Set bstack.lastobj = useHandler
            
            
            IsNumber = FastSymbol(a$, ")", True)
            Exit Function
        End If
        Else
            MissFile
        End If
    ElseIf IsExp(bstack, a$, r) Then
contbuf1:
        r = 0#
        p = 0#
        If Not bstack.lastobj Is Nothing Then
            If TypeOf bstack.lastobj Is mHandler Then
            Set useHandler = bstack.lastobj
            Set bstack.lastobj = Nothing
            If useHandler.t1 = 2 Then
            If FastSymbol(a$, ",") Then
            IsExp bstack, a$, r
            If FastSymbol(a$, ",") Then
            If Not IsExp(bstack, a$, p) Then
            
            MissNumExpr
            Exit Function
            End If
            End If
            End If
            
                 Set useHandler.objref = useHandler.objref.Copy(r, p)
                Set bstack.lastobj = useHandler
                IsNumber = FastSymbol(a$, ")", True)
            End If
            End If
            
            
        End If
    Else
    IsNumber = FastSymbol(a$, ")", True)
    End If
    Set bstack.lastobj = Nothing
    Exit Function
fun103: ' "IMAGE(", "ΕΙΚΟΝΑ("
IsNumber = False
    If IsStrExp(bstack, a$, s$) Then
        If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
            Set useHandler = New mHandler
            useHandler.t1 = 2
        
            Set useHandler.objref = SaveStr2MemBlock(s$, r)
            If r = 0 Then
                Set bstack.lastobj = useHandler
                IsNumber = FastSymbol(a$, ")", True)
                Exit Function
            End If
        Else
                noImage a$
        End If
            
            
    ElseIf IsExp(bstack, a$, s$) Then
      IsNumber = FastSymbol(a$, ")", True)
        If Not bstack.lastobj Is Nothing Then
           If TypeOf bstack.lastobj Is mHandler Then
              Set useHandler = bstack.lastobj
              Set bstack.lastobj = Nothing
              If useHandler.t1 = 2 Then
                  If useHandler.objref.ReadImageSizeX(r) Then
                  r = SG * bstack.Owner.ScaleX(r, 3, 1)
                          Set useHandler = Nothing
                      Exit Function
                  End If
              End If
           End If
        End If
            noImageInBuffer a$
            IsNumber = False
            r = 0#
    Else
        MissParam a$
    End If
    Exit Function

fun31: ' "IMAGE.X(", "ΕΙΚΟΝΑ.Χ("
IsNumber = GetImageX(bstack, a$, r, SG)
    Exit Function
fun32: ' "IMAGE.Y(", "ΕΙΚΟΝΑ.Υ("
    IsNumber = GetImageY(bstack, a$, r, SG)
   
    Exit Function
fun33: ' "IMAGE.X.PIXELS(", "ΕΙΚΟΝΑ.Χ.ΣΗΜΕΙΑ("
IsNumber = GetImageXpixels(bstack, a$, r, SG)
    Exit Function
fun34: ' "IMAGE.Y.PIXELS(", "ΕΙΚΟΝΑ.Υ.ΣΗΜΕΙΑ("
IsNumber = GetImageYpixels(bstack, a$, r, SG)

    Exit Function
fun35: ' "VALID(", "ΕΓΚΥΡΟ("
If FastSymbol(a$, "@") Then
    If IsLabel(bstack, a$, s$) Then
    IsNumber = True
     If Right$(s$, 1) = "(" Then FastSymbol a$, ")"
    If GetVar(bstack, s$, VR) Then
    r = SG * True
 w1 = Abs(Asc(v$) < 128)
If IsLabelSymbolNew(a$, "ΩΣ", "AS", w1) Then
If IsLabel(bstack, a$, s$) Then
If Right$(s$, 1) = "(" Then FastSymbol a$, ")"
If GetVar(bstack, s$, v1&) Then

r = SG * CheckTwo(VR, v1&)
Else
r = 0
End If

Else

MissVarName
IsNumber = False

End If
End If
'   If Right$(s$, 1) = "(" Then IsNumber = FastSymbol(a$, ")")
    End If
    End If
    IsNumber = FastSymbol(a$, ")")
Else
    IsNumber = True
    Dim OLD1$, OLD2$
    OLD1$ = LastErName
    OLD2$ = LastErNameGR
    MyEr "", ""
    w1 = 1
    s$ = aheadstatus(a$, True, w1) & "   "  ' version 6.5(11)
    n$ = Left$(a$, w1 - 1)
    If w1 > 1 Then Mid$(a$, 1, w1 - 1) = Space$(w1 - 1)
    If Left$(s$, 1) = "S" And Not Left$(s$, 3) = "SoN" Then
        If IsStrExp(bstack, n$, s$) Then
            a$ = Mid$(a$, w1)
            r = SG * (FastSymbol(a$, ")") And NLtrim$(n$) = vbNullString)
        ElseIf LastErNum <> 0 Then
            GoTo jumphere
        Else  ' for MyErMacro
            r = 1
            If Len(a$) + w1 > Len(n$) Then
                'false
                r = 0
            End If

            r = r * SG * FastSymbol(a$, ")", True)
        End If
    
    ElseIf IsExp(bstack, n$, p) Then
    
    a$ = Mid$(a$, w1)
              r = SG * (FastSymbol(a$, ")") And NLtrim$(n$) = vbNullString)
    ElseIf LastErNum = 0 Then ' ' for MyErMacro
            r = 1
            If Len(a$) + w1 > Len(n$) Then
                'false
                r = 0
            End If

            r = r * SG * FastSymbol(a$, ")", True)
    
    Else
jumphere:
    LastErNum = 0
    LastErNum1 = 0
    LastErNameGR = vbNullString
    LastErName = vbNullString
    a$ = Mid$(a$, w1)
      IsNumber = FastSymbol(a$, ")")
          r = 0
        End If
       If "" <> LastErName Then r = 0
    If "" <> LastErNameGR Then r = 0
       LastErNameGR = vbNullString
    LastErName = vbNullString
        LastErNum = 0
        LastErNum1 = 0
        End If
        Set bstack.lastobj = Nothing
    Exit Function
    
fun36: ' "EVAL(", "ΕΚΦΡ(", "ΕΚΦΡΑΣΗ("
    IsNumber = IsEval(v$, bstack, a$, r, SG)
    
    Exit Function
fun37: ' "POINT(", "ΣΗΜΕΙΟ("
    IsNumber = IsPoint(bstack, a$, r, SG)
    Exit Function
fun38: ' "CTIME(", "ΥΠΩΡΑ("
    IsNumber = IsCtime(bstack, a$, r, SG)
    Exit Function
fun39: ' "CDATE(", "ΥΠΜΕΡ("
    IsNumber = IsCdate(bstack, a$, r, SG)
    Exit Function
fun40: ' "TIME(", "ΧΡΟΝΟΣ("
    IsNumber = IsTimeVal(bstack, a$, r, SG)
    Exit Function
fun41: ' "DATE(", "ΗΜΕΡΑ("
    IsNumber = IsDataVal(bstack, a$, r, SG)
    Exit Function
fun42: ' "VAL(", "ΤΙΜΗ(", "ΑΞΙΑ("
    IsNumber = IsVal(bstack, a$, r, SG, Left$(v$, 1) = "V")
    Exit Function
fun43: ' "RINSTR(", "ΘΕΣΗΔΕΞΙΑ("
    IsNumber = IsRinstr(bstack, a$, r, SG, 0)
    Exit Function
fun107: ' "RINSTR(", "ΘΕΣΗΔΕΞΙΑ("
    IsNumber = IsRinstr(bstack, a$, r, SG, 1)
    Exit Function
fun44: ' "INSTR(", "ΘΕΣΗ("
    IsNumber = IsInstr(bstack, a$, r, SG, 0)
    Exit Function
fun106:
    IsNumber = IsInstr(bstack, a$, r, SG, 1)
    Exit Function
fun45: ' "RECORDS(", "ΕΓΓΡΑΦΕΣ("
    IsNumber = IsRecords(bstack, a$, r, SG)
    Exit Function
fun46: ' "GROUP.COUNT(", "ΟΜΑΔΑ.ΣΥΝΟΛΟ("
    IsNumber = IsGroupCount(bstack, a$, r, SG)
    Exit Function
fun47: ' "PARAGRAPH(", "ΠΑΡΑΓΡΑΦΟΣ("
    IsNumber = IsParagr(bstack, a$, r, SG)
    Exit Function
fun48: ' "PARAGRAPH.INDEX(", "ΑΡΙΘΜΟΣ.ΠΑΡΑΓΡΑΦΟΥ("
 IsNumber = IsParIndex(bstack, a$, r, SG)
    Exit Function
fun49: ' "BACKWARD(", "ΠΙΣΩ("
    IsNumber = IsForwBack(1, bstack, a$, r, SG)
    Exit Function
fun50: ' "FORWARD(", "ΜΠΡΟΣΤΑ("
    IsNumber = IsForwBack(0, bstack, a$, r, SG)
    Exit Function
fun51: ' "DOC.PAR(", "ΕΓΓΡΑΦΟΥ.ΠΑΡ("
    IsNumber = IsDocPar(bstack, a$, r, SG)
    Exit Function
fun52: ' "MAX.DATA(", "ΜΕΓΑΛΟ.ΣΕΙΡΑΣ("
    IsNumber = IsMaxData(bstack, a$, r, SG)
    Exit Function
fun53: ' "MIN.DATA(", "ΜΙΚΡΟ.ΣΕΙΡΑΣ("
    IsNumber = IsMinData(bstack, a$, r, SG)
    Exit Function
fun54: ' "MAX(", "ΜΕΓΑΛΟ("
    IsNumber = IsCompMinMax(2, bstack, a$, r, SG)
    Exit Function
fun55: ' "MIN(", "ΜΙΚΡΟ("
    IsNumber = IsCompMinMax(1, bstack, a$, r, SG)
    Exit Function
fun56: ' "COMPARE(", "ΣΥΓΚΡΙΝΕ("
    IsNumber = IsCompMinMax(0, bstack, a$, r, SG)
    Exit Function
fun57: ' "DOC.UNIQUE.WORDS(", "ΕΓΓΡΑΦΟΥ.ΜΟΝΑΔΙΚΕΣ.ΛΕΞΕΙΣ("
    IsNumber = IsDocUniqueWords(bstack, a$, r, SG)
    Exit Function
fun58: ' "DOC.WORDS(", "ΕΓΓΡΑΦΟΥ.ΛΕΞΕΙΣ("
    IsNumber = IsDocWords(bstack, a$, r, SG)
    Exit Function
fun59: ' "DOC.LEN(", "ΕΓΓΡΑΦΟΥ.ΜΗΚΟΣ("
    IsNumber = IsDocLen(bstack, a$, r, SG)
    Exit Function
fun60: ' "LEN.DISP(", "ΜΗΚΟΣ.ΕΜΦ("
    IsNumber = IsLenDisp(bstack, a$, r, SG)
    Exit Function
fun61: ' "LEN(", "ΜΗΚΟΣ("
 IsNumber = IsLen(bstack, a$, r, SG)
    Exit Function
fun62: ' "SQRT(", "ΡΙΖΑ("
    IsNumber = IsSqrt(bstack, a$, r, SG)
    Exit Function
fun63: ' "FREQUENCY(", "ΣΥΧΝΟΤΗΤΑ("
    IsNumber = IsFreq(bstack, a$, r, SG)
    Exit Function
fun64: ' "LOG(", "ΛΟΓ("
    IsNumber = IsLog(bstack, a$, r, SG)
    Exit Function
fun65:  ' "LN(", "ΛΦ("
    IsNumber = IsLn(bstack, a$, r, SG)
    Exit Function
fun66: ' "ATN(", "ΤΟΞ.ΕΦ("
    IsNumber = IsAtan(bstack, a$, r, SG)
    Exit Function
fun67:  ' "TAN(", "ΕΦΑΠ("
  IsNumber = IsTan(bstack, a$, r, SG)
    Exit Function
fun68:  ' "COS(", "ΣΥΝ("
    IsNumber = IsCos(bstack, a$, r, SG)
    Exit Function
fun69:  ' "SIN(", "ΗΜ("
    IsNumber = IsSin(bstack, a$, r, SG)
    Exit Function
fun70:  ' "ABS(", "ΑΠΟΛ("
IsNumber = IsAbs(bstack, a$, r, SG)
Exit Function
fun71: ' "LOWORD(", "LOWWORD(", "ΚΑΤΩΜΙΣΟ("
    IsNumber = IsLOWORD(bstack, a$, r, SG)
    Exit Function
fun74: ' "HIWORD(", "HIGHWORD(", "ΠΑΝΩΜΙΣΟ("
   IsNumber = IsHIWORD(bstack, a$, r, SG)
    Exit Function
fun75: ' "BINARY.NEG(", "ΔΥΑΔΙΚΟ.ΑΝΤΙ(", "ΔΥΑΔΙΚΟ.ΑΝΤΙΣΤΡΟΦΟ("
    IsNumber = IsBinaryNeg(bstack, a$, r, SG)
    Exit Function
fun76: ' "BINARY.OR(", "ΔΥΑΔΙΚΟ.Η("
    IsNumber = IsBinaryOr(bstack, a$, r, SG)
    Exit Function
fun105: ' "BINARY.NOT(", "ΔΥΑΔΙΚΟ.ΟΧΙ("
    IsNumber = IsBinaryNot(bstack, a$, r, SG)
    Exit Function
fun77: ' "BINARY.AND(", "ΔΥΑΔΙΚΟ.ΚΑΙ("
    IsNumber = IsBinaryAnd(bstack, a$, r, SG)
    Exit Function
fun78: ' "BINARY.XOR(", "ΔΥΑΔΙΚΟ.ΑΠΟ("
    IsNumber = IsBinaryXor(bstack, a$, r, SG)
    Exit Function
fun79: ' "HILOWWORD(", "ΔΥΟΜΙΣΑ("
    IsNumber = IsHILOWWORD(bstack, a$, r, SG)
    Exit Function
fun80: ' "BINARY.SHIFT(", "ΔΥΑΔΙΚΟ.ΟΛΙΣΘΗΣΗ("
    IsNumber = IsBinaryShift(bstack, a$, r, SG)
    Exit Function
fun81: ' "BINARY.ROTATE(", "ΔΥΑΔΙΚΗ.ΠΕΡΙΣΤΡΟΦΗ("
    IsNumber = IsBinaryRotate(bstack, a$, r, SG)
    Exit Function
fun82: ' "SINT(", "ΑΚΕΡΑΙΟ.ΔΥΑΔΙΚΟ("
' GET AN UNSIGN AND GIVES A SIGN...AS READING BITS
    IsNumber = IsSint(bstack, a$, r, SG)
    Exit Function
fun83: ' "USGN(", "ΔΥΑΔΙΚΟ("
    IsNumber = IsUsgn(bstack, a$, r, SG)
    Exit Function
fun84: ' "UINT(", "ΔΥΑΔΙΚΟ.ΑΚΕΡΑΙΟ("
' READING BITS OF A SIGN AND GIVE AN UNSIGN OF SAME BITS
    IsNumber = IsUint(bstack, a$, r, SG)
    Exit Function
fun102: ' "CEIL(","ΟΡΟΦ("
    IsNumber = IsCeil(bstack, a$, r, SG)
    Exit Function
fun85:  ' "ROUND(", "ΣΤΡΟΓΓ("
    IsNumber = IsRound(bstack, a$, r, SG)
    Exit Function
fun86:  ' "INT(", "ΑΚ(", "FLOOR(","ΔΑΠΕΔ("
    IsNumber = IsInt(bstack, a$, r, SG)
    Exit Function
fun87: ' "SEEK(", "ΜΕΤΑΘΕΣΗ("
    IsNumber = IsSeek(bstack, a$, r, SG)
    Exit Function
fun88:  ' "EOF(", "ΤΕΛΟΣ("
    IsNumber = IsEof(bstack, a$, r, SG)
    Exit Function
fun89: ' "RANDOM(", "ΤΥΧΑΙΟΣ("
    IsNumber = IsRandom(bstack, a$, r, SG)
    Exit Function
fun24: ' "STACK(", "ΣΩΡΟΣ("
    IsNumber = IsStack(bstack, a$, r, SG)
    Exit Function
fun92: ' "GROUP(", "ΟΜΑΔΑ("
    IsNumber = IsGroup(bstack, a$, r)
    Exit Function
fun98: ' "PROPERTY(", "ΙΔΙΟΤΗΤΑ("
    IsNumber = IsProperty(bstack, a$, r, SG)
    Exit Function
fun90: ' "CHRCODE(", "ΧΑΡΚΩΔ("
    IsNumber = IsChrCode(bstack, a$, r, SG)
    Exit Function
fun91: ' "ASC(", "ΚΩΔ("
    IsNumber = IsAsc(bstack, a$, r, SG)
    Exit Function
fun94: ' "CONS(", "ΕΝΩΣΗ("
    IsNumber = IsCons(bstack, a$, r, SG)
    Exit Function
fun95: ' "CAR(", "ΠΡΩΤΟ("
    IsNumber = IsCar(bstack, a$, r)
    Exit Function
fun96: ' "CDR(", "ΕΠΟΜΕΝΑ("
    IsNumber = IsCdr(bstack, a$, r)
    Exit Function
fun93: ' "TEST(", "ΔΟΚΙΜΗ("
    IsNumber = IsTest(bstack, a$, r, SG)
    Exit Function

LOOKFORSUBNUM:
''On Error Resume Next
If Len(s1$) = 1 Then
If s1$ = Chr(0) Then
If bstack.lastpointer Is Nothing Then GoTo skiperror
Set pppp = bstack.lastpointer
Set bstack.lastpointer = Nothing
w2 = 0
GoTo contAr22
Else
SyntaxError
Exit Function
End If
Else
s1$ = v$ & ")" ' ANY CHAR HERE
End If
MakeThisSubNum bstack, s1$
If IsSymbol(a$, "@") Then
'is a function allways...
If GetlocalSub(s1$, v1&) Then
    GoTo contAr1
ElseIf GetSub(s1$, v1&) Then
GoTo contAr1
ElseIf GetSub2(bstack, s1$, v1&) Then
GoTo contAr1

Else
GoTo skiphere
End If

Else
If neoGetArray(bstack, v$, pppp, , , True) Then

    GoTo contAr2
ElseIf LastErNum <> 0 Then
Exit Function
ElseIf GetlocalSub(s1$, v1&) Then
    GoTo contAr1
ElseIf neoGetArray(bstack, v$, pppp, , True) Then
GoTo contAr2
ElseIf GetSub2(bstack, s1$, v1&) Then
GoTo contAr1

ElseIf GetSub(s1$, v1&) Then
GoTo contAr1
Else
skiphere:
If bstack.UseGroupname <> "" Then
If InStr(s1$, bstack.UseGroupname) = 1 Then

s1$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(s1$, Len(bstack.UseGroupname) + 1)
If GetSub(s1$, v1&) Then GoTo contAr1
End If
End If
If Right$(s1$, 1) = ")" Then
    If here$ Like "*." + s1$ Then
        subHash.ItemCreator s1$, bstack.OriginalCode, True
        GoTo contAr1
    ElseIf s1$ = "LAMBDA()" Then
        If bstack.IamLambda Then
            s1$ = bstack.FuncRec
        Else
           s1$ = Mid$(here$, rinstr(here$, "].") + 2)
           If Right$(here$, 2) = "()" And bstack.UseGroupname = vbNullString Then

            s1$ = sbf(bstack.OriginalCode).goodname
            v1& = bstack.OriginalCode
           ElseIf Not GetSub(s1$, v1&) Then
               If here$ Like "*." + s1$ Then
                   subHash.ItemCreator s1$, bstack.OriginalCode, True
               Else
                   GoTo skiperror
               End If
           End If
        End If
        GoTo contAr1
    ElseIf s1$ = "ΛΑΜΔΑ()" Then
        If bstack.IamLambda Then
            s1$ = bstack.FuncRec
        Else
           s1$ = Mid$(here$, rinstr(here$, "].") + 2)
       If Right$(here$, 2) = "()" And bstack.UseGroupname = vbNullString Then

            s1$ = sbf(bstack.OriginalCode).goodname
            v1& = bstack.OriginalCode
           ElseIf Not GetSub(s1$, v1&) Then
               If here$ Like "*." + s1$ Then
                   subHash.ItemCreator s1$, bstack.OriginalCode, True
               Else
                   GoTo skiperror
               End If
           End If
        End If
        GoTo contAr1
Else
             If Right$(s1$, 3) <> "$()" Then
        
              If neoGetArray(bstack, Left$(s1$, Len(s1$) - 2) + "$(", pppp) Then GoTo contAr2
               End If
               
End If
End If
GoTo skiperror
End If
End If
'''ver 18
If GetSub(s1$, v1&) Then
GoTo contAr1
ElseIf neoGetArray(bstack, v$, pppp) Then
GoTo contAr2
Else
GoTo skiperror
End If
If GetSub(s1$, v1&) Then
contAr1:
s1$ = Trim$(s1$)
    If bstack.NoFuncError Then
    
    CallNext bstack, a$, par, p, v$
    If par Then
    r = SG * p
        IsNumber = True
    Else
    r = 0
        IsNumber = False
    End If
                
            
Else
    Set nbstack = New basetask
    nbstack.reflimit = varhash.count
    Set nbstack.Parent = bstack
    If bstack.IamThread Then Set nbstack.Process = bstack.Process
    Set nbstack.Owner = bstack.Owner
    nbstack.OriginalCode = v1&
    nbstack.UseGroupname = sbf(v1&).sbgroup
    If GoFunc(nbstack, s1$, a$, p) Then
        If Not nbstack.StaticCollection Is Nothing Then
      bstack.Parent.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
        End If
   ' Set bstack.lastobj = nBstack.lastobj
    'Set nBstack = Nothing
        If InStr(v$, "%") > 0 Then
            If SG = 1 Then
                r = MyRound(p)
            Else
                r = -MyRound(p)
            End If
        Else
            If SG = 1 Then
                r = p
            Else
                r = -p
            End If
        End If
            
            IsNumber = True
    Else
  ''
     IsNumber = False
    End If
End If
Exit Function

ElseIf neoGetArray(bstack, v$, pppp) Then
contAr2:

If MaybeIsSymbol2(a$, ")", w3) Then
    IsNumber = True
    If Not pppp.Arr Then
        If Typename(pppp.GroupRef) = "Group" Then
            If pppp.GroupRef.HasParameters Then
                GoTo conthere102030
            Else
            MyErMacro a$, "No parameter list for this group", "Δεν υπάρχει λίστα παραμέτρων για αυτήν την ομάδα"
            End If
        ElseIf Typename(pppp.GroupRef) = "mHandler" Then
            '' here the poke as alfa(3).value or Αλφα(3).τιμή
            a$ = Mid$(a$, w3 + 1)
            If pppp.GroupRef.indirect >= 0 Then
                MyErMacro a$, "Not implemented yet", "Δεν εχει ακόμα υλοποιηθεί αυτό"
                
                Exit Function
            End If
            If Left$(a$, 1) = "." Then
            ' LOOK FOR GROUP
            
                w2 = -pppp.GroupRef.objref.index - 2
                GoTo contgroup
            ElseIf FastSymbol(a$, "(") Then
                w2 = -pppp.GroupRef.objref.index - 2
                GoTo contlambdahere
            Else
                Set bstack.lastobj = pppp
                If pppp.GroupRef.t1 = 2 Then
                    r = SG * pppp.GroupRef.objref.GetPtr(0)
                Else
                    r = SG * pppp.GroupRef.objref.Done
                End If
            End If
        ElseIf Typename(pppp.GroupRef) = "PropReference" Then
        Set bstack.lastobj = pppp
         a$ = Mid$(a$, w3 + 1)
        Else
                a$ = Mid$(a$, w3 + 1)
                ' what object we have here????
        End If
    Else
        a$ = Mid$(a$, w3 + 1)
        r = 0
        Set bstack.lastobj = pppp
    End If
    
    Exit Function
End If

If pppp.Arr Then
dn = 0

pppp.SerialItem (0), dd, 5
dd = dd - 1
If dd < 0 Then
            If Typename(pppp.GroupRef) = "PropReference" Then
            
            GoTo contreadprop
            End If
            End If
p = 0
PP = 0
    IsNumber = True
    w2 = 0
                    Do While dn <= dd
                   ' pppp.SerialItem w3, dn, 6
                    pppp.GetDnum dn, w3, v1&
                        If IsExp(bstack, a$, p) Then
                        If dn < dd Then
                            If Not FastSymbol(a$, ",") Then: MyErMacro a$, "need index for " & v$ & ")", "χρειάζομαι δείκτη για το πίνακα " & v$ & ")": IsNumber = False: Exit Function
                           
                            Else
                         If FastSymbol(a$, ",") Then
                        IsNumber = False
                        MyErMacro a$, "too many indexes for array " & v$ & ")", "πολλοί δείκτες για το πίνακα " & v$ & ")"
                        Exit Function
                         
                         End If
                            If Not FastSymbol(a$, ")") Then: MissSymbol ")": IsNumber = False: Exit Function
                            
                         
                        End If
                            On Error Resume Next
                            If p < -v1& Then
                            IsNumber = False
                              MyErMacro a$, "index too low for array " & v$ & ")", "αρνητικός δείκτης στο πίνακα " & v$ & ")"
                            Exit Function
                            End If
                            
                        If Not pppp.PushOffset(w2, dn, CLng(Fix(p))) Then
                                IsNumber = False
                                MyErMacro a$, "index too high for array " & v$ & ")", "δείκτης υψηλός για το πίνακα " & v$ & ")"
                                IsNumber = False
                            Exit Function
                            End If
                            On Error GoTo 0
                        Else
                        
                         IsNumber = False
                        If LastErNum = -2 Then
                        Else
                        
                        MyErMacro a$, "missing index for array " & v$ & ")", "χάθηκε δείκτης για το πίνακα " & v$ & ")"
                        End If
                        Exit Function
                        End If
                    dn = dn + 1
                    Loop
                    ' here here here
contAr22:
    If Typename(pppp.item(w2)) = "Group" Then
            
            If Left$(a$, 1) = "." Then
contgroup:
                               
                              IsNumber = SpeedGroup(bstack, pppp, "VAL", v$, a$, w2) = 1
                                If SG = 1 Then
                                 r = bstack.LastValue
                                 Else
                                 r = -bstack.LastValue
                                 End If
            ElseIf Left$(a$, 1) = "(" Then
contgroup3:
                            IsNumber = SpeedGroup(bstack, pppp, "VAL", v$, a$, w2) = 1
                                 If SG = 1 Then
                                 r = bstack.LastValue
                                 Else
                                 r = -bstack.LastValue
                                 End If
            
            
            Else
contgroup2:
                         If pppp.item(w2).IamApointer Then
                         If Left$(a$, 2) = "=>" Then Mid$(a$, 1, 2) = "." + Chr(3): GoTo contgroup
                         
                         Set bstack.lastpointer = pppp.item(w2).link
                         Set bstack.lastobj = pppp.item(w2)
                          r = 0
                          
                        ElseIf pppp.item(w2).HasValue Then
                       If pppp.item(w2).HasParameters Then
                        MakeGroupPointer bstack, pppp.item(w2)
                        r = 0
                        Set bstack.lastobj = pppp.item(w2)
                        Exit Function
                       Else
                        IsNumber = SpeedGroup(bstack, pppp, "VAL", v$, "", w2) = 1
                                 If SG = 1 Then
                                 r = bstack.LastValue
                                 Else
                                 r = -bstack.LastValue
                                 End If
                       End If
                        Else
                            If pppp.item(w2).IamApointer Then
                            
                            If Mid(a$, 1, 2) = "=>" Then
                                Mid(a$, 1, 2) = Chr$(0) + "."
                                Set bstack.lastpointer = pppp.item(w2)
                                
                                GoTo againpointer
                                Else
                                Set bstack.lastobj = pppp.item(w2)
                                End If
                            Else
                            bstack.soros.CopyGroupObj pppp.item(w2), anything
                            Set bstack.lastobj = anything
                            'Set bstack.lastpointer = pppp.item(w2)
                            End If
                             
                        End If
            End If
              
            Exit Function
    ElseIf MyIsObject(pppp.item(w2)) Then
    If FastSymbol(a$, "(") Then
contlambdahere:
                If Typename(pppp.item(w2)) = "lambda" Then
                        PushStage bstack, False
                        
                    
                         w1 = globalvar("A_" + CStr(Abs(w2)), 0#)
                       
                         Set var(w1) = pppp.item(w2)
                         
                                    If here$ = vbNullString Then
                                            GlobalSub "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & Str(w1)
                                        Else
                                            GlobalSub here$ & "." & bstack.GroupName & "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & Str(w1)
                                    End If
againlambda:
                                    a$ = "A_" + CStr(Abs(w2)) + "(" + a$
                                 IsNumber = IsNumber(bstack, a$, p)
                                 If Not bstack.lastobj Is Nothing Then
                                 If TypeOf bstack.lastobj Is lambda Then
                                 If IsOperator(a$, "(") Then
                                 Set var(w1) = bstack.lastobj
                                 GoTo againlambda
                                 End If
                                 ElseIf IsOperator(a$, "(") Then
                                 If TypeOf bstack.lastobj Is mArray Then
                                 PopStage bstack
                                           PopStage bstack
                                        Set pppp = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        GoTo contAr2
                                 ElseIf TypeOf bstack.lastobj Is mHandler Then
                                 PopStage bstack
                                 If bstack.lastobj.t1 = 3 Then
                                        Set anything = bstack.lastobj
                                        If CheckIsmArray(anything) Then
                                        Set pppp = anything
                                        Else
                                        Set pppp = New mArray
                                        pppp.Arr = False
                                        Set pppp.GroupRef = bstack.lastobj
                                        End If
                                        Set anything = Nothing
                                ElseIf bstack.lastobj.t1 = 1 Then
                                     Set pppp = New mArray
                                        pppp.Arr = False
                                        Set pppp.GroupRef = bstack.lastobj
                                        w2 = -2
                                      '  Mid$(b$, 1, 1) = " "
                                        GoTo contrightpar
                                    Else
                                        Set pppp = New mArray
                                        pppp.Arr = False
                                        Set pppp.GroupRef = bstack.lastobj
                                    End If
                                      ElseIf TypeOf bstack.lastobj Is mArray Then
                       
                                
                                    ElseIf TypeOf bstack.lastobj Is Group Then
                                             Set pppp = New mArray
                                        pppp.Arr = False
                                        Set pppp.GroupRef = bstack.lastobj
                                        w2 = -2
                                        GoTo contgroup3
                                                     End If

                                ElseIf TypeOf bstack.lastobj Is mArray Then
                                    PopStage bstack
                                        Set pppp = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        GoTo contAr2
                                ElseIf TypeOf bstack.lastobj Is Group Then
                               PopStage bstack
                                                  Set pppp = New mArray
                                        pppp.Arr = False
                                        Set pppp.GroupRef = bstack.lastobj
                                        w2 = -2
                                If Left$(a$, 1) = "." Then
             
                                GoTo contgroup
                                Else
                                 GoTo contgroup2
                                End If
                                End If
                                End If
                                 Set var(w1) = Nothing
                                 If Right$(pppp.arrname, 2) = "%(" Then
                                 r = SG * MyRound(p)
                                 Else
                                 r = SG * p
                                 End If
                        PopStage bstack
                        IsNumber = True
                        Exit Function
                        
                ElseIf Typename(pppp.item(w2)) = myArray Then
                Set pppp = pppp.item(w2)
                GoTo contAr2
                ElseIf Typename(pppp.item(w2)) = "mHandler" Then
                Set bstack.lastobj = pppp.item(w2)
                If bstack.lastobj.t1 = 3 Then
                        Set anything = bstack.lastobj
                       If CheckIsmArray(anything) Then
                       Set pppp = anything
                       Else
                        Set pppp = New mArray
                        pppp.Arr = False
                        Set pppp.GroupRef = bstack.lastobj
                       End If
                       Set anything = Nothing
                
                Else
                Set pppp = New mArray
                pppp.Arr = False
                Set pppp.GroupRef = bstack.lastobj
                End If
                End If
                Set bstack.lastobj = Nothing
                
                GoTo contAr2
                
    Else
    ' here is the fault

     
               r = SG * rValue(bstack, pppp.item(w2))
            End If
                 
                        Exit Function
            
    End If
    
    On Error Resume Next
    r = pppp.itemnumeric(w2)
    If SG < 0 Then r = -r
    If Err Then r = 0: Err.Clear
    On Error GoTo 0
    Else
contrightpar:
     If Typename(pppp.GroupRef) = "mHandler" Then
     
                If IsExp(bstack, a$, p) Then
                
                
                If pppp.GroupRef.t1 = 2 Then ' OK for Buffer

                 With pppp.GroupRef.objref
                 If FastSymbol(a$, "!") Then
                 If SG Then
                 r = .GetBytePtr(p)
                 Else
                 r = -.GetBytePtr(p)
                 End If
                 Else
                    If FastSymbol(a$, ",") Then
                        If IsStrExp(bstack, a$, s$) Then
                        ElseIf IsLabelOnly(a$, s$) <> 1 Then
syntax1:
                            SyntaxError
                            Exit Function
                        End If
                        If .structref.Find(myUcase(s$, True)) Then
                        If FastSymbol(a$, ",") Then
                       
                                   If IsExp(bstack, a$, r) Then
                        
                                   r = .GetPtr(p) + .structref.Value + r
                        
                                   Else
                                   GoTo syntax1
                                   End If
                        Else
                        
                         r = .GetPtr(p) + .structref.Value
                        
                         End If
                                    If FastSymbol(a$, "!") Then
                                    If SG Then
                                    r = r - .GetPtr(0)
                                    Else
                                    r = -r - .GetPtr(0)
                                    End If
                                    End If
                                   
                        Else
                        GoTo syntax1
                        End If
                    Else
                 
                         r = .GetPtr(p)
                        If SG < 0 Then r = -r
                End If
                 End If
                 If .Status = 4 Then MyErMacro a$, "Buffer locked, wrong use of pointer", "Η Διάρθρωση κλειδώθηκε, κακή χρήση δείκτη"
                IsNumber = FastSymbol(a$, ")") And .Status = 0
                    End With
                Exit Function
                ElseIf pppp.GroupRef.t1 = 3 Then
                MyEr "???", "???"
                Exit Function
                End If
                If Not FastSymbol(a$, "!") Then s$ = CStr(p): GoTo contlabel
                 With pppp.GroupRef.objref
                    
                    p = MyRound(p)
                    
                    If Abs(p) < .count Then
                        If p < 0 Then
                          .index = .count + MyRound(p)
                        Else
                          .index = MyRound(p)
                        End If
                       .Done = True
                       '' what??? here here here
                       IsNumber = FastSymbol(a$, ")")
                       If Left$(a$, 1) = "." Then
                       If Fast2NoSpace(a$, ".ΑΞΙΑ", 5, ".VALUE", 6, 6) Then
                       w2 = -100
                       Else
                       w2 = -MyRound(p) - 100
                       End If
                       GoTo contgroup
                       ElseIf FastSymbol(a$, "(") Then
                       If .IsObj Then
                       If TypeOf .ValueObj Is mHandler Then
                       
                        Set pppp.GroupRef = .ValueObj
                        GoTo contAr2
                       End If
                       w2 = -.index - 100
                       If TypeOf .ValueObj Is lambda Then GoTo contlambdahere
                       If TypeOf .ValueObj Is mArray Then
                        Set pppp = .ValueObj
                        GoTo contAr2
                       End If
                       Else
                       MyErMacro a$, "No Object found", "Δεν βρήκα αντικείμενο"
                       End If
                       End If
                       
                          If Not .IsObj Then
                     If .ValueType(0, r, s$) Then
                                    If SG < 0 Then r = -r
                                     
                                  Else
                                      r = 0
                                 End If
                        Else
                               
                        Set bstack.lastobj = pppp.GroupRef.objref.ValueObj
                 
                       r = 0
                       End If
                       
                        
                        Exit Function
                    Else
                       indexout a$
                    End If
                       
                    End With
                
                        Exit Function
                ElseIf IsStrExp(bstack, a$, s$) Then
contlabel:
                 With pppp.GroupRef.objref
                If .StructLen > 0 Then s$ = myUcase(s$)
                    If .Find(s$) Then
                       
                       IsNumber = FastSymbol(a$, ")")
                       If Left$(a$, 1) = "." Then
                       
                       w2 = -.index - 100
                       GoTo contgroup
                       ElseIf FastSymbol(a$, "(") Then
                       If .IsObj Then
                       
                       w2 = -.index - 100
                       If TypeOf .ValueObj Is lambda Then GoTo contlambdahere
                       If TypeOf .ValueObj Is mArray Then
                        Set pppp = .ValueObj
                        GoTo contAr2
                    ElseIf TypeOf .ValueObj Is mHandler Then
                       
                        Set pppp.GroupRef = .ValueObj
                        GoTo contAr2
                       End If
                       Else
                       MyErMacro a$, "No Object found", "Δεν βρήκα αντικείμενο"
                       End If
                       End If
                        If Not .IsObj Then
                           If .ValueType(0, r, s$) Then
                                     If SG < 0 Then r = -r
                                  Else
                                      r = 0
                                 End If
                        Else
                      
                      
                       If Typename(pppp.GroupRef.objref.ValueObj) = "Group" Then
                                           
                       
                       'w2 = -p - 2
                       w2 = -.index - 100
                       GoTo contgroup
                    Else
                    
                     r = rValue(bstack, pppp.GroupRef.objref.ValueObj)
                    If SG < 0 Then r = -r
                       End If
                       End If
                       
                       
                        
                        Exit Function
                    Else
                       indexout a$
                    End If
                       
                    End With
                
                        Exit Function
            End If
    ElseIf Typename(pppp.GroupRef) = "Group" Then
conthere102030:
    If Len(v$) > Len(pppp.GroupRef.GroupName) Then
        s1$ = Left$(v$, Len(v$) - 1) + "." + ChrW(&H1FFF) + ";()"
    Else
            s1$ = pppp.GroupRef.GroupName + ChrW(&H1FFF) + ";()"
    End If
conthereGroupValue:
                If GetSub(s1$, v1&) Then
                    Set nbstack = New basetask
                    nbstack.reflimit = varhash.count
                    Set nbstack.Parent = bstack
                    If bstack.IamThread Then Set nbstack.Process = bstack.Process
                    Set nbstack.Owner = bstack.Owner
                    nbstack.OriginalCode = v1&
                    nbstack.UseGroupname = sbf(v1&).sbgroup
                    If GoFunc(nbstack, s1$, a$, p, , , , True) Then
                        If Not nbstack.StaticCollection Is Nothing Then
                            bstack.Parent.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                        End If
                        If IsOperator(a$, "(") Then
                            Set pppp = New mArray
                            Set pppp.GroupRef = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            pppp.Arr = False
                            w2 = -2
                        Set nbstack = Nothing
                         v$ = vbNullString
                            GoTo contrightpar
                        ElseIf Left$(a$, 1) = "." Then
                                                    Set pppp = New mArray
                            Set pppp.GroupRef = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            pppp.Arr = False
                            w2 = -2
                        Set nbstack = Nothing
                         v$ = vbNullString
                        GoTo contgroup
                        End If
                        'Set bstack.lastobj = nBstack.lastobj
                        Set nbstack = Nothing
                        r = p
                        If SG < 0 Then r = -r
                        IsNumber = True
                    Else
                        IsNumber = False
                    End If
                    
                Else
                    If Typename(var(VR)) = "Group" Then
                    
                    If var(VR).HasStrValue Then
                        r = 0
                        Set bstack.lastobj = CopyGroupObj(var(VR))
                    Else
                        r = 0
                        InternalEror
                        IsNumber = False
                    End If
                    Else
                    r = 0
                        InternalEror
                        IsNumber = False
                    End If
                End If
                Exit Function
    
     Else
contreadprop:
            If IsExp(bstack, a$, p) Then
                pppp.GroupRef.index = p
                ElseIf IsStrExp(bstack, a$, s$) Then
                pppp.GroupRef.index = s$  '' this is for propreference class
            End If
        End If
        If TypeOf pppp.GroupRef Is mHandler Then
        MyEr "Not for this kind of object", "Όχι για αυτό το αντικείμενο"
        r = 0
        Exit Function
        Else
        r = pppp.GroupRef.Value
        If SG < 0 Then r = -r
        End If
        
        IsNumber = FastSymbol(a$, ")")
       
        End If
    
    Exit Function
    Else
skiperror:
 IsNumber = False
         If FindNameForGroup(bstack, v$) Then
        UnknownMethod1 a$, v$
 Else
    UnknownFunction1 a$, v$

End If

    
    Exit Function
    End If
    
End Select
'' Else
'' THESE THREE STATEMENDS NOT USED ANY MORE
     IsNumber = False
    a$ = v$ + a$
    Exit Function
''End Select
zerohere:
' mid$(a$,sng&,1) like "[123456789.]"
'If val("0" & Mid$(a$, sng&, 1)) = 0 And Left(Mid$(a$, sng&, 1), sng&) <> "0" And Left(Mid$(a$, sng&, 1), sng&) <> "." Then
If Not Mid$(a$, sng&, 1) Like "[0-9.]" Then

IsNumber = False
Else

    If Mid$(a$, sng&, 1) = "." Then

    ig$ = "0"
    DE$ = "."
    ElseIf LCase(Mid$(a$, sng&, 2)) Like "0[xχ]" Then
    ig$ = "0"
    DE$ = "0x"
  sng& = sng& + 1
Else
    Do While sng& <= Len(a$)
        
        Select Case Mid$(a$, sng&, 1)
        Case "0" To "9"
        ig$ = ig$ & Mid$(a$, sng&, 1)
        Case "."
        DE$ = "."
        Exit Do
        Case Else
        Exit Do
        End Select
       sng& = sng& + 1
    Loop
    End If
    ' compute decimal part
    If DE$ <> "" Then
      sng& = sng& + 1
        Do While sng& <= Len(a$)
       
        Select Case Mid$(a$, sng&, 1)
        Case " ", ChrW(160)
        If Not (sg1 And Len(ex$) = 1) Then
        Exit Do
        End If
        Case "A" To "D", "a" To "d", "F", "f"
        If Left$(DE$, 2) = "0x" Then
        DE$ = DE$ & Mid$(a$, sng&, 1)
        End If
        Case "0" To "9"
        If sg1 Then
        ex$ = ex$ & Mid$(a$, sng&, 1)
        Else
        DE$ = DE$ & Mid$(a$, sng&, 1)
        End If
        Case "E", "e"
         If Left$(DE$, 2) = "0x" Then
         DE$ = DE$ & Mid$(a$, sng&, 1)
         Else
              If ex$ = vbNullString Then
               sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        End If
        Case "Ε", "ε"
         If ex$ = vbNullString Then
         sg1 = True
        ex$ = "E"
        Else
        Exit Do
        End If
        ex$ = "E"
        
        Case "+", "-"
        If sg1 And Len(ex$) = 1 Then
         ex$ = ex$ & Mid$(a$, sng&, 1)
         
        Else
        Exit Do
        End If
        Case Else
        Exit Do
        End Select
         sng& = sng& + 1
        Loop
       If sg1 Then sng = sng - Len(ex$)
    End If
    If ig$ = vbNullString Then
    IsNumber = False
    Else
  
    If Left$(DE$, 2) = "0x" Then
  
   If Mid$(DE$, 3) = vbNullString Then
   r = 0
   Else
   If Mid$(a$, sng&, 1) = "&" Then
   If Len(DE$) > 10 Then
    MyEr "Too many digits", "Πολλά ψηφία"
   IsNumber = False
   Exit Function
   End If
   sng& = sng& + 1
   Mid$(DE$, 1, 2) = "&H"
   r = CLng(DE$)
   ElseIf Mid$(a$, sng&, 1) = "%" Then
   sng& = sng& + 1
        If Len(DE$) > 6 Then
         MyEr "Too many digits", "Πολλά ψηφία"
        IsNumber = False
        Exit Function
        End If
   Mid$(DE$, 1, 2) = "&H"
    r = CInt(DE$)
   Else
   If Len(DE$) > 10 Then
    MyEr "Too many digits", "Πολλά ψηφία"
   IsNumber = False
   Exit Function
   End If
   DE$ = Right$("00000000" & Mid$(DE$, 3), 8)
   r = CDbl(UNPACKLNG(Left$(DE$, 4)) * 65536#) + CDbl(UNPACKLNG(Right$(DE$, 4)))
   End If
   End If
    Else
 If SG < 0 Then ig$ = "-" & ig$

            On Error Resume Next
            
            If ex$ <> "" Then
                If Len(ex$) < 3 Then
                If ex$ = "E" Then
                ex$ = "0"
               ' sng = sng + 1
                ElseIf ex$ = "E-" Or ex$ = "E+" Then
                'ex$ = "00"
                sng = sng + 2
                End If
                End If
                    
            
                If val(Mid$(ex$, 2)) > 308 Or val(Mid$(ex$, 2)) < -324 Then
                    r = 0 ' val(ig$ & DE$)
                    sng = sng - Len(ex$)
                    ex$ = vbNullString
                    MyEr "Exponet Overflow", "Υπερχείλιση Εκθέτη)"
                    IsNumber = False
                    Exit Function
                    Else
                    sng = sng + Len(ex$)
                    If sng <= Len(a$) Then
                        If Asc(Mid$(a$, sng, 1)) = 126 Then
                        Mid$(a$, sng, 1) = " "
                        If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = cdecimaldot$
                        r = CSng(ig$ & DE$ & ex$)
                        If Err.Number = 6 Then
                        If val(Mid$(ex$, 2)) > 38 Or val(Mid$(ex$, 2)) < -45 Then
                            MyEr "Exponet Overflow", "Υπερχείλιση Εκθέτη)"
                        Else
                            MyEr "Overflow single", "Υπερχείλιση απλού"
                            End If
                            Err.Clear
                        End If
                        Else
                            r = val(ig$ & DE$ & ex$)
                        End If
                    Else
                        r = val(ig$ & DE$ & ex$)
                        If Err.Number = 6 Then
                        Overflow
                        
                        End If
                    End If
                    
                    
                 
                End If
            Else
            If sng <= Len(a$) Then
            Select Case Asc(Mid$(a$, sng, 1))
            Case 64
                Mid$(a$, sng, 1) = " "
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = cdecimaldot$
                r = CDec(ig$ & DE$)
                If Err.Number = 6 Then
                Err.Clear
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = "."
                r = val(ig$ & DE$)
                End If
            Case 35
            Mid$(a$, sng, 1) = " "
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = cdecimaldot$
                r = CCur(ig$ + DE$)
                If Err.Number = 6 Then
                Err.Clear
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = "."
                r = val(ig$ & DE$)
                End If
            Case 38
            Mid$(a$, sng, 1) = " "
                    r = CLng(ig$)
                    If Err.Number = 6 Then
                        Err.Clear
                        r = val(ig$)
                    End If
           Case 37
                Mid$(a$, sng, 1) = " "
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = cdecimaldot$
                r = CInt(ig$)
                If Err.Number = 6 Then
                Err.Clear
                r = val(ig$)
                End If
           Case 126
                Mid$(a$, sng, 1) = " "
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = cdecimaldot$
                r = CSng(ig$ & DE$)
                If Err.Number = 6 Then
                Err.Clear
                If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = "."
                r = val(ig$ & DE$)
                End If
            Case Else
                r = val(ig$ & DE$)
            End Select
            Else
            r = val(ig$ & DE$)
            End If
            End If
            If Err.Number = 6 Then
                If Len(ex$) > 2 Then
                    ex$ = Left$(ex$, Len(ex$) - 1)
                    sng = sng - 1
                    Err.Clear
                    r = val(ig$ & DE$ & ex$)
                    If Err.Number = 6 Then
                        sng = sng - Len(ex$)
                        If DE$ <> vbNullString Then Mid$(DE$, 1, 1) = "."
                         r = val(ig$ & DE$)
                    End If
                End If
                
           ErrInExponet a$
          IsNumber = False
            Exit Function
            End If
    On Error GoTo 0
  End If
  If sng& > 1 Then Mid$(a$, 1, sng& - 1) = Space$(sng& - 1)
  
    IsNumber = True
    End If
End If
End Function
Function ProcLambda(bstack As basetask, rest$, Lang As Long) As Object
' no named functio- object
Dim body As New lambda, k As Long, n$, dummy As Variant, er As Boolean, pos1 As Long, p As Variant, s$
Dim pppp As mArray, pppp2 As mArray, frm$, Find As basetask, Rest1$
' need fixed param...with &
again1:
If Not FastSymbol(rest$, "->", , 2) Then
' put here description for error
If er Then Exit Function
Do




If Len(rest$) < 129 Then
        k = IsPureLabel(rest$, n$)
    Else
        Rest1$ = Left$(rest$, 128)
        k = IsPureLabel(Rest1$, n$)
        If Len(Rest1$) = 0 Then
            k = IsPureLabel(rest$, n$)
        Else
            rest$ = Mid$(rest$, 129 - Len(Rest1$))
        End If
    End If

If k = 0 Then

        If frm$ <> "" Then Exit Function
                    If FastSymbol(rest$, "(") Then
                                er = True
                                frm$ = BlockParam(rest$)
                            If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                    If Not FastSymbol(rest$, ")") Then
                       
                            
                            End If
                           frm$ = Trim$(frm$)
                           GoTo again1
                    Else
                    MyEr "Symbol -> for Lmabda needed", "Χρειάζεται το σύμβολο -> για την λάμδα συνάρτηση"
                    Exit Function
                End If
End If
If k > 4 Then If Not FastSymbol(rest$, ")") Then Exit Function
n$ = myUcase(n$, True)


If FastSymbol(rest$, "=") Then
Select Case k
Case 1, 4
If IsExp(bstack, rest$, p) Then
If Not bstack.lastobj Is Nothing Then
    Set dummy = bstack.lastobj
    Set bstack.lastobj = Nothing
   body.FeedNonLocal n$, dummy, var()
   Set dummy = Nothing
    Else
       dummy = p
    body.FeedNonLocal n$, dummy, var()
    End If
dummy = Empty
End If
Case 3
If IsStrExp(bstack, rest$, s$) Then
If Not bstack.lastobj Is Nothing Then
    Set dummy = bstack.lastobj
    Set bstack.lastobj = Nothing
   body.FeedNonLocal n$, dummy, var()
   Set dummy = Nothing
    Else
       dummy = s$
    body.FeedNonLocal n$, dummy, var()
    End If
dummy = Empty
End If
Case 5, 7

 If IsExp(bstack, rest$, p) Then
 If Not bstack.lastobj Is Nothing Then
      If Typename(bstack.lastobj) = myArray Then
      Set pppp = bstack.lastobj
        pppp.arrname = n$
        Set dummy = pppp
        body.FeedNonLocal n$, dummy, var()
        Set dummy = Nothing
        Set pppp = Nothing
        Else
        Exit Function
      End If
      Else
        Exit Function
      End If
      Else
        Exit Function
     End If
Case 6
If IsStrExp(bstack, rest$, s$) Then
If Not bstack.lastobj Is Nothing Then
      If Typename(bstack.lastobj) = myArray Then
      Set pppp = bstack.lastobj
        pppp.arrname = n$
        Set dummy = pppp
        body.FeedNonLocal n$, dummy, var()
        Set dummy = Nothing
        Set pppp = Nothing
        Else
        Exit Function
      End If
      Else
        Exit Function
      End If
      Else
        Exit Function
End If
End Select
ElseIf k < 5 Then
        If GetVar(bstack, n$, pos1, , , True) Then
            If Typename(var(pos1)) = "lambda" Then
            Dim aaa As lambda
            var(pos1).CopyTo aaa, var()
            Set dummy = aaa
                body.FeedNonLocal n$, dummy, var()
                Set dummy = Nothing
                dummy = Empty
                Set aaa = Nothing
            ElseIf Typename(var(pos1)) = "Group" Then
                Set dummy = CopyGroupObj(var(pos1))
                body.FeedNonLocal n$, dummy, var()
                Set bstack.lastobj = dummy
                Set dummy = Nothing
            Else
                body.FeedNonLocal n$, var(pos1), var()
            End If
        Else
            body.FeedNonLocal n$, dummy, var()
        End If
Else
       
        If neoGetArray(bstack, n$, pppp) Then
        Set pppp2 = New mArray
        pppp.CopyArray pppp2
  
        Set dummy = pppp2
        Set pppp2 = Nothing
        Set pppp = Nothing
        body.FeedNonLocal n$, dummy, var()
        Else
        End If
    End If
Loop Until Not FastSymbol(rest$, ",")

If frm$ <> "" Then Exit Function
If FastSymbol(rest$, "(") Then
                                frm$ = BlockParam(rest$)
                            If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                           If Not FastSymbol(rest$, ")", True) Then
                            
                           
                             frm$ = Trim$(frm$)
                           GoTo again1
                           
                            End If
                          
'Else
'Exit Function
 End If

er = True
GoTo again1

ElseIf FastSymbol(rest$, "{") Then
' get block
getfunc:
If frm$ <> "" Then
                                If Lang = 1 Then
                                frm$ = "Read " + frm$ + vbCrLf
                                Else
                                frm$ = "Διάβασε " + frm$ + vbCrLf
                                End If
body.code = frm$ + vbCrLf + block(rest$)
Else
body.code = block(rest$)
End If
If Trim$(body.code) = vbNullString Then Exit Function
k = Len(rest$)
If Not FastSymbol(rest$, "}") Then Exit Function
Else
GetLine:
' get one line only
 pos1 = 1
body.code = aheadstatus(rest$, False, pos1)
If pos1 = 1 Then Exit Function
If frm$ <> "" Then
                                If Lang = 1 Then
                                frm$ = "Read " + frm$ + vbCrLf
                                Else
                                frm$ = "Διάβασε " + frm$ + vbCrLf
                                End If
body.code = frm$ + ": =" + Left$(rest$, pos1 - 1)
Else
body.code = "=" + Left$(rest$, pos1 - 1)
End If
k = Len(rest$)
rest$ = Mid$(rest$, pos1)
End If
If bstack.OriginalCode < 0 Then
    Set Find = bstack
    
    
    Do While Find.IamChild
    If Find.OriginalCode > -1 Then Exit Do
    k = k + var(-Find.OriginalCode).lastlen
    body.OriginalCode = var(-Find.OriginalCode).OriginalCode
    Set Find = Find.Parent
    
    Loop
    'body.OriginalCode = find.OriginalCode
    body.lastlen = k
Else
    body.OriginalCode = bstack.OriginalCode
    'body.OriginalCode = find.OriginalCode
    body.lastlen = k
End If

Set ProcLambda = body
End Function
Function IsPureLabel(a$, r$) As Long 'ok
Dim rr&, one As Boolean, c$
r$ = vbNullString
If a$ = vbNullString Then IsPureLabel = 0: Exit Function

a$ = NLtrim$(a$)
    Do While Len(a$) > 0
    c$ = myUcase(Left$(a$, 1))
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 46 '"."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            Else
            IsPureLabel = 0
            Exit Function
            End If
        Case 65 To 90, 913 To 937, 902, 904, 906, 908, 905, 911, 910, 962 '"A" To "Z", "Α" To "Ω", "’", "Έ", "Ί", "Ό", "Ή", "Ώ", "Ύ", "ς"
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 48 To 57, 95 '"0" To "9", "_"
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
            
        Case 36 ' "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                            If Mid$(a$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 a$ = Mid$(a$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(a$, 1)
                                       a$ = Mid$(a$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
    IsPureLabel = rr&
   a$ = NLtrim$(a$)

End Function


Function IsLabelBig(bstack As basetask, a$, rrr$, Optional nocommand As Boolean, Optional r$, Optional noconvert As Boolean = False, Optional StrPointer As Boolean, Optional iscommand As Boolean) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, skipcase As Boolean, cc As Long, isstrparam As Boolean, ascwc As Integer
r$ = vbNullString
If a$ = vbNullString Then IsLabelBig = 0: Exit Function  'ok
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
     c$ = Left$(a$, 1) 'ANYCHAR HERE
     ascwc = AscW(c$)
     If ascwc < 10 And ascwc >= 0 Then
     Select Case ascwc
     Case 8 '
     If Len(r$) > 0 Then Exit Do
     a$ = Mid$(a$, 2)
     ' get a name from bstack tempstr
     nocommand = True
     a$ = bstack.tmpstr + a$
     bstack.tmpstr = vbNullString
         
    Case 2 To 7
        a$ = Mid$(a$, 2)
        Case 1
        isstrparam = True
        GoTo conthere1
        Case 0 ' for group pointers
conthere1:
        If r$ = "" Then
        If Not bstack.lastpointer Is Nothing Then
        With bstack.lastpointer
        If .lasthere = vbNullString Then
                    If .GroupName <> "" Then
                If isstrparam Then
                    r$ = .GroupName + "$"
                    rr& = 3
                Else
                    r$ = .GroupName
                    rr& = 1
                End If
            Else
            ' why ?
               Exit Function
            End If

       Else
            If .GroupName <> "" Then
                If isstrparam Then
                    r$ = .lasthere + "." + .GroupName + "$"
                    rr& = 3
                Else
                    r$ = .lasthere + "." + .GroupName
                    rr& = 1
                End If
            Else
                If isstrparam Then
                    r$ = .lasthere + "$"
                    rr& = 3
                Else
                    r$ = .lasthere
                    rr& = 1
                End If
            End If
        End If
        End With
        Set bstack.lastpointer = Nothing
        
       
        If Mid$(a$, 2, 1) = "." Then
            a$ = Mid$(a$, 2)
        Else
            If Mid$(a$, 2, 2) = "$'" Then
            rr& = 3
           ' r$ = r$ + "$"
            a$ = Mid$(a$, 2)
        ElseIf Mid$(a$, 2, 1) = "'" Then
            a$ = Mid$(a$, 2)
        Else
            Mid$(a$, 1, 1) = "("  ' parameter for value for pointers for groups using in Eval() and Eval$()
            
        End If
         End If
         nocommand = True
        Else
         Mid$(a$, 1, 2) = "=>"
            Exit Function
        
        End If
        Else
        a$ = Mid$(a$, 2)
        End If
      Case Else
        Exit Do
     End Select
     
     
        ElseIf ascwc < 256 And ascwc > 0 Then
        Select Case ascwc
          
        Case 64  '"@"
           If r$ = vbNullString Then
              a$ = Mid$(a$, 2)
              iscommand = True
              ElseIf Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              a$ = Mid$(a$, 2)
              Else
                 IsLabelBig = 0: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString Then
        rrr$ = "?"
        
        IsLabelBig = 1
        Exit Function
        End If
        a$ = Mid$(a$, 2)
        
        Case 46 '"."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(a$, 1)
                       a$ = Mid$(a$, 2)
           ''
           ElseIf Not Mid$(a$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(a$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         a$ = Mid$(a$, 2)
                        
                        
            Else
                         If r$ = vbNullString And dot& > 0 Then
                                  nocommand = True
                                 rrr$ = String$(dot& + 1, ".")     ' i want this only in right position for "dir .. "
                                 r$ = rrr$
                                  a$ = Mid$(a$, 2)
                                 IsLabelBig = 1
                         Else
                              IsLabelBig = 0
                        End If
                    
            Exit Function
            End If
        Case 94, 123 To 126  '"{" To "~", "^"
            Exit Do
                
        Case 48 To 57, 95 '"0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
             nocommand = True
            rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then
            a$ = "." + a$: dot& = 0
            End If
            
            Exit Do
            End If
        Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 38 ' "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
                'ERROR
                rr& = 0
                '' r$ = VbNullString
                rrr$ = vbNullString
                Exit Function
            Else
           nocommand = True
                
                If noconvert Then
                IsLabelBig = 0
                Exit Function
                Else
                a$ = Mid$(a$, 2)

                Dim rrrr$
                rrrr$ = vbNullString
                
again1947:
                rr& = Abs(IsLabelBig(bstack, a$, r$))
                If Left$(a$, 2) = ")." Then
                rrrr$ = rrrr$ + r$ + ")."
                Mid$(a$, 1, 2) = "  "
                GoTo again1947
                Else
                rrrr$ = rrrr$ + r$
                End If
                r$ = rrrr$
                End If
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                       ' a$ = Chr(34) + here$ & "." & r$ & Chr(34) + a$
                        rrr$ = here$ & "." & r$
                        IsLabelBig = -50
                        Exit Function
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid$(r$, 6) Else c$ = here$ & "." & r$
                         End If
        
                      rrr$ = c$
                        IsLabelBig = -50
                        Exit Function
                  ElseIf varhash.Find(r$, cc) Then
        
                         rrr$ = r$
                        IsLabelBig = -50
                        Exit Function
                    Else
        
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                    rrr$ = r$
                   IsLabelBig = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                 If Not bstack.NoError Then MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(a$, ")") Then
        
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid$(r$, 6)) Then
                       
        
                                        rrr$ = bstack.UseGroupname & Mid$(r$, 6, Len(r$) - 6)
                                        IsLabelBig = -50
                                        Exit Function
                                    Else
                                    rr& = 2
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                               
                                       
                                            rrr$ = here$ & "." & r$
                                        IsLabelBig = -50
                                        Exit Function
                                ElseIf varhash.ExistKey(r$) Then
                                  
                                        rrr$ = r$
                                        IsLabelBig = -50
                                        Exit Function
                                Else
                                
                                   rr& = 3
                                End If
                                 If rr& > 0 Then
                                 If rr& = 2 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 End If
                                 End If
                                 rr& = 1
                                 If GetSub(r$ + ")", rr&) Then
                            r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    If Not bstack.NoError Then MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = vbNullString
                                Exit Do
                            End If
                    End If
                    
                    r$ = vbNullString
                    rr& = 0
                    Exit Do
            End If
            
        Case 36 ' "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            nocommand = True
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 58 '":"
        If one Then Exit Do
        If Mid$(a$, 2, 1) <> "\" Then Exit Do
        If InStr(r$, ":") > 1 Then Exit Do
        r$ = r$ & Left$(a$, 2)
                a$ = Mid$(a$, 3)
        Case 40 ' "("
            If r$ <> "" Then
                If Mid$(a$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              a$ = Mid$(a$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If skipcase Then
    rrr$ = r$
    Else
    rrr$ = myUcase(r$, gr)
    End If
   If dot& Then
   nocommand = True
                           If r$ <> "" Then
     
                        rr& = bstack.GetDotNew(rrr$, dot&) * rr&

                        nocommand = rr&
                           Else
                          If dot& > 1 Then
                          rrr$ = String$(dot&, ".") + rrr$: If rr& = 0 Then rr& = 1
                          Else
                          '' PUT THE DOT BACK
                          If dot& = 1 Then a$ = "." + a$
                          End If
                          
                          End If
    
    
   End If
   If StrPointer Then
   If Abs(rr&) = 3 Then
   cc = LastErNum1
    If IsStr1(bstack, (rrr$), rrr$) Then
        a$ = rrr$ + a$
        StrPointer = False
        IsLabelBig = Abs(IsLabelBig(bstack, a$, rrr$, , r$)) * Sgn(rr&)
        
    End If
    LastErNum1 = cc
    nocommand = True
    Exit Function
    
    ElseIf Abs(rr&) = 6 Then
        a$ = rrr$ + a$
        cc = LastErNum1
        If IsStr1(bstack, a$, rrr$) Then
        a$ = rrr$ + a$
        IsLabelBig = Abs(IsLabelBig(bstack, a$, rrr$, , r$)) * Sgn(rr&)
        LastErNum1 = cc
        Else
        LastErNum1 = cc
        cc = InStr(rrr$, "(")
        If cc > 0 Then
        a$ = Mid$(rrr$, cc + 1) + a$
        rrr$ = Left$(rrr$, cc)
        IsLabelBig = 4 * Sgn(rr&)
        Else
        IsLabelBig = Sgn(rr&)
        End If
        
        End If
        StrPointer = False
      
        nocommand = True
        
        
    Exit Function
    
    Else
    IsLabelBig = rr&
   End If
    
   Else
    IsLabelBig = rr&
    End If
    nocommand = IsLabelBig And (Len(r$) = 1 Or nocommand)
 '' a$ = LTrim(a$)

End Function
Function IsLabelFileName(bstack As basetask, a$, rrr$, Optional nocommand As Boolean, Optional r$, Optional noconvert As Boolean = False) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, skipcase As Boolean, cc As Long
r$ = vbNullString
If a$ = vbNullString Then IsLabelFileName = 0: Exit Function  'ok
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
     c$ = Left$(a$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 0 To 7
         a$ = Mid$(a$, 2)
        Case 64 '"@"
           If r$ = vbNullString Then
              a$ = Mid$(a$, 2)
              ElseIf Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              a$ = Mid$(a$, 2)
              Else
                 IsLabelFileName = 0: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString Then
        rrr$ = "?"
        
        IsLabelFileName = 1
        Exit Function
        End If
        a$ = Mid$(a$, 2)
        Case 58 ' ":"
            If one Then
  
            Exit Do
           
             ElseIf r$ <> "" Then
            If Len(a$) > 1 Then
             
            If Mid$(a$, 2, 1) <> "\" Then
            Exit Do
            ElseIf Mid$(a$, 2, 2) = vbCrLf Then
                Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                IsLabelFileName = 0
            Exit Function
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            End If
            Else
            IsLabelFileName = 0
            Exit Function
            End If
        Case 46 ' "."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(a$, 1)
                       a$ = Mid$(a$, 2)
           ''
           ElseIf Not Mid$(a$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(a$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         a$ = Mid$(a$, 2)
                        
                        
            Else
                         If r$ = vbNullString And dot& > 0 Then
                                  nocommand = True
                                 rrr$ = String$(dot& + 1, ".")     ' i want this only in right position for "dir .. "
                                 r$ = rrr$
                                  a$ = Mid$(a$, 2)
                                 IsLabelFileName = 1
                         Else
                              IsLabelFileName = 0
                        End If
                    
            Exit Function
            End If
        Case 94, 123 To 126  '"{" To "~", "^"
            Exit Do
        
        Case 92 '"\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case 48 To 57, 95  ' "0" To "9", "_"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
             nocommand = True
            rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then a$ = "." + a$: dot& = 0
            
            Exit Do
            End If
Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 38 '"&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
                'ERROR
                rr& = 0
                '' r$ = VbNullString
                rrr$ = vbNullString
                Exit Function
            Else
           nocommand = True
                
                If noconvert Then
                IsLabelFileName = 0
                Exit Function
                Else
                a$ = Mid$(a$, 2)
                rr& = Abs(IsLabelFileName(bstack, a$, r$))
                End If
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        a$ = Chr(34) + here$ & "." & r$ & Chr(34) + a$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid$(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    a$ = Chr(34) + c$ + Chr(34) + a$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         a$ = Chr(34) + r$ & Chr(34) + a$
                    Else
                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                    rrr$ = r$
                   IsLabelFileName = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                 If Not bstack.NoError Then MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(a$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid$(r$, 6)) Then
                       
                                    a$ = Chr(34) + bstack.UseGroupname & Mid$(r$, 6, Len(r$) - 6) + Chr(34) + a$
                                    Else
                                    rr& = 2
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                               a$ = Chr(34) + here$ & "." & r$ + Chr(34) + a$
  
                                ElseIf varhash.ExistKey(r$) Then
                                    a$ = Chr(34) + r$ + Chr(34) + a$
                                Else
                                   rr& = 3
                                End If
                                 If rr& > 0 Then
                                 If rr& = 2 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 End If
                                 End If
                                 rr& = 1
                                 If GetSub(r$ + ")", rr&) Then
                            r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    If Not bstack.NoError Then MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = vbNullString
                                Exit Do
                            End If
                    End If
                    
                    r$ = vbNullString
                    rr& = 0
                    Exit Do
            End If
            
        Case 36 '"$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 '"%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            nocommand = True
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 '"("
            If r$ <> "" Then
                If Mid$(a$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              a$ = Mid$(a$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If skipcase Then
    rrr$ = r$
    Else
    rrr$ = myUcase(r$, gr)
    End If
   If dot& Then
   nocommand = True
                           If r$ <> "" Then
     If Left$(rrr$, 1) = "\" Then
                     r$ = String$(dot&, ".") + rrr$
                          rrr$ = r$
                          rr& = 1
     Else
                        rr& = bstack.GetDotNew(rrr$, dot&) * rr&
                        End If

                        nocommand = rr&
                           Else
                           
                         
                          'rrr$ = String$(dot&, ".") + rrr$: If rr& = 0 Then rr& = 1
                          r$ = String$(dot&, ".") + rrr$
                          rrr$ = r$
                          rr& = 1
                          
                          End If
    
    
   End If
   
    IsLabelFileName = rr&
    nocommand = IsLabelFileName And (Len(r$) = 1 Or nocommand)
 '' a$ = LTrim(a$)

End Function
Function IsLabel(bstack As basetask, a$, rrr$, Optional skipdot As Boolean) As Long
Dim buf$
If Len(a$) < 129 Then IsLabel = innerIsLabel(bstack, a$, rrr$, , , skipdot): Exit Function

   
    buf$ = Left$(a$, 128)
    IsLabel = innerIsLabel(bstack, buf$, rrr$, , , skipdot)
    If buf$ = vbNullString Then
        IsLabel = innerIsLabel(bstack, a$, rrr$, , , skipdot)
    Else
        a$ = Mid$(a$, 129 - Len(buf$))
    End If

    
    

End Function
'
Function innerIsLabel(bstack As basetask, a$, rrr$, Optional NoSpace As Boolean = False, Optional skipcase As Boolean = False, Optional skipdot As Boolean) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, r$, cc As Long
'r$ = VbNullString
If a$ = vbNullString Then innerIsLabel = 0: Exit Function   ' ok
If Not NoSpace Then a$ = NLtrim$(a$) Else If AscW(a$) = 32 Then Exit Function
    Do While Len(a$) > 0
     c$ = Left$(a$, 1) 'ANYCHAR HERE
    
    
    
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 64  '"@"
           If r$ = vbNullString Then
              a$ = Mid$(a$, 2)
              ElseIf Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              a$ = Mid$(a$, 2)
              Else
                 innerIsLabel = 0: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString Then
        rrr$ = "?"
        
        innerIsLabel = 1
        Exit Function
        End If
        a$ = Mid$(a$, 2)
        Case 58 '":"
            If one Then
  
            Exit Do
           
            ElseIf r$ <> "" Then
            If Len(a$) > 1 Then
            If Mid$(a$, 2, 1) <> "\" Then
            Exit Do
            ElseIf Mid$(a$, 2, 2) = vbCrLf Then
                Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                innerIsLabel = 0
            Exit Function
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
'        Exit Do
            End If
            Else
            innerIsLabel = 0
            Exit Function
            End If
        Case 46 '"."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(a$, 1)
                       a$ = Mid$(a$, 2)
           ''
           ElseIf Not Mid$(a$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(a$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         a$ = Mid$(a$, 2)
                        
                        
            Else
                         If r$ = vbNullString And dot& > 0 Then
                                 rrr$ = String$(dot& + 1, ".")     ' i want this only in right position for "dir .. "
                                 r$ = rrr$
                                  a$ = Mid$(a$, 2)
                                 innerIsLabel = 1
                         Else
                              innerIsLabel = 0
                        End If
                    
            Exit Function
            End If
        Case 94, 123 To 126  '"{" To "~", "^"
            Exit Do
        
        Case 92 '"\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case 48 To 57, 95 '"0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then a$ = "." + a$: dot& = 0
            
            Exit Do
            End If
Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 38 ' "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
                'ERROR
                rr& = 0
                '' r$ = VbNullString
                rrr$ = vbNullString
                Exit Function
            Else
                a$ = Mid$(a$, 2)
                rr& = Abs(innerIsLabel(bstack, a$, r$, True))
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        a$ = Chr(34) + here$ & "." & r$ & Chr(34) + a$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid$(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    a$ = Chr(34) + c$ + Chr(34) + a$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         a$ = Chr(34) + r$ & Chr(34) + a$

                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                    rrr$ = r$
                   innerIsLabel = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                    If cc > 0 Then
                    
                    ElseIf Not bstack.NoError Then
                    MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(a$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid$(r$, 6)) > 0 Then
                                    a$ = Chr(34) + bstack.UseGroupname & Mid$(r$, 6, Len(r$) - 6) + Chr(34) + a$
                                    Else
                                    rr& = 2
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                                     a$ = Chr(34) + here$ & "." & r$ + Chr(34) + a$
                                ElseIf varhash.ExistKey(r$) Then
                                    a$ = Chr(34) + r$ + Chr(34) + a$
                                Else
                                   rr& = 3
                                End If
                                If rr& > 0 Then
                                 If rr& = 2 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 End If
                                 End If
                                 rr& = 1
                                 If GetSub(r$ + ")", rr&) Then
                                                                  r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    If Not bstack.NoError Then MyErMacro a$, "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = vbNullString
                                Exit Do
                            End If
                    End If
                    
                    r$ = vbNullString
                    rr& = 0
                    Exit Do
            End If
            
        Case 36 ' "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                If Mid$(a$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              a$ = Mid$(a$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If skipcase Then
    rrr$ = r$
    Else
    rrr$ = myUcase(r$, gr)
    End If
   If dot& Then
                           If r$ <> "" Then
     If skipdot And dot& = 1 Then
     rrr$ = "THIS." + rrr$
     
     Else

                        rr& = bstack.GetDotNew(rrr$, dot&) * rr&

                        End If
                           Else
                          If dot& > 1 Then rrr$ = String$(dot&, ".") + rrr$: If rr& = 0 Then rr& = 1
                          End If
    
    
   End If
   
    innerIsLabel = rr&

 '' a$ = LTrim(a$)

End Function
Function IsLabelDIM(bstack As basetask, a$, r$) As Long
Dim rr&, one As Boolean, c$, dot&, gr As Boolean, skipcase As Boolean, cc As Long
r$ = vbNullString
If a$ = vbNullString Then IsLabelDIM = 0: Exit Function ' ok
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
     c$ = Left$(a$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 64  '"@"
           If r$ = vbNullString Then
              a$ = Mid$(a$, 2)
              ElseIf Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              a$ = Mid$(a$, 2)
              Else
                 IsLabelDIM = 0: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString Then
        r$ = "?"
        IsLabelDIM = 1
        Exit Function
        End If
        a$ = Mid$(a$, 2)
        Case 58 '":"
            If one Then
  
            Exit Do
           
            ElseIf r$ <> "" Then
            If Len(a$) > 1 Then
            If Mid$(a$, 2, 1) <> "\" Then
            Exit Do
            ElseIf Mid$(a$, 2, 2) = vbCrLf Then
                Exit Do
            End If
            End If
            
            If InStr(r$, ":") > 0 Then
                IsLabelDIM = 0
            Exit Function
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            End If
            Else
            IsLabelDIM = 0
            Exit Function
            End If
        Case 46 '"."
            
            If one Then
  
            Exit Do
           ElseIf r$ <> "" Then
           
                    r$ = r$ & Left$(a$, 1)
                       a$ = Mid$(a$, 2)
           ''
           ElseIf Not Mid$(a$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(a$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         a$ = Mid$(a$, 2)
                        
                        
            Else
                         If r$ = vbNullString And dot& > 0 Then
                     
                             
                                 r$ = String$(dot& + 1, ".")
                                  a$ = Mid$(a$, 2)
                                 IsLabelDIM = 1
                         Else
                              IsLabelDIM = 0
                        End If
                    
            Exit Function
            End If
        Case 94, 123 To 126  '"{" To "~", "^"
            Exit Do
        
        Case 92 '"\"
           If one Then
            Exit Do
            ElseIf r$ <> "" Or dot& Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
              Exit Do
            End If
        Case 48 To 57, 95 '"0" To "9", "_"  ' old ,"\"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
             rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then a$ = "." + a$: dot& = 0
            
            Exit Do
            End If
Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 38 ' "&"
        
            If one Then Exit Do
            
            If r$ <> "" Then
            
                rr& = 0
     
              r$ = vbNullString
                Exit Function
            Else
                a$ = Mid$(a$, 2)
                rr& = Abs(IsLabelDIM(bstack, a$, r$))
                skipcase = True
                If rr& < 5 Then
            Dim i As Long
         
                    If GetlocalVar(r$, i) Then
                        a$ = Chr(34) + here$ & "." & r$ & Chr(34) + a$
                    ElseIf Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                        If bstack.UseGroupname <> "" Then
                                 c$ = bstack.UseGroupname + Mid$(r$, 6)
                                 
                         Else
                             c$ = StripThis2(here$)
                             If c$ <> "" Then c$ = c$ & "." & Mid$(r$, 6) Else c$ = here$ & "." & r$
                         End If
                    a$ = Chr(34) + c$ + Chr(34) + a$
                    
                  ElseIf varhash.Find(r$, cc) Then
                         a$ = Chr(34) + r$ & Chr(34) + a$
                    Else
                    '' r$ = myUcase(r$, gr)
                    
                    If r$ = "THIS" Or r$ = "ΑΥΤΟ" Then
                
                   IsLabelDIM = -100
                   
                   Exit Function
                    Else
                If GetSub(r$ + ")", rr&) Then
                
                                 r$ = "{" + sbf(rr&).sb + "} " + sbf(rr&).sbgroup
                                 
                    rr& = 2
                    Exit Do
                    Else
                    If Not bstack.NoError Then MyEr "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
                    End If
                    End If
                Else
                    If FastSymbol(a$, ")") Then
                           '' r$ = myUcase(r$, gr)
                            rr& = 0
                            If Left$(r$, 5) = "ΑΥΤΟ." Or Left$(r$, 5) = "THIS." Then
                            If varhash.ExistKey(bstack.UseGroupname & Mid$(r$, 6)) Then
                                    a$ = Chr(34) + bstack.UseGroupname & Mid$(r$, 6, Len(r$) - 6) + Chr(34) + a$
                                    Else
                                    rr& = 1
                                    End If
                                ElseIf varhash.ExistKey(here$ & "." & r$) Then
                                     a$ = Chr(34) + here$ & "." & r$ + Chr(34) + a$
                                ElseIf varhash.ExistKey(r$) Then
                                    a$ = Chr(34) + r$ + Chr(34) + a$
                                Else
                                   rr& = 1
                                End If
                                 If rr& = 1 Then
                                 If bstack.UseGroupname <> "" Then
                                 r$ = bstack.UseGroupname + Mid$(r$, 6)
                                 Else
                                 End If
                                 If GetSub(r$ + ")", rr&) Then
                                                                  r$ = "{" + sbf(rr&).sb + "}" + sbf(rr&).sbgroup
                                 
                    rr& = 2
     
                    Exit Do
                    
                    Else
                    If Not bstack.NoError Then MyEr "can't pass reference", "δεν μπορώ να βάλω αναφορά"
                    End If
               
                                 
                                 End If
                                 rr& = 0
                                 r$ = vbNullString
                                Exit Do
                            End If
                    End If
                    
                    r$ = vbNullString
                    rr& = 0
                    Exit Do
            End If
            
        Case 36 ' "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                If Mid$(a$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              a$ = Mid$(a$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    If Not skipcase Then r$ = myUcase(r$, gr)
   If dot& Then
                           If r$ <> "" Then
                           If dot& = 1 Then
                           r$ = "THIS." + r$
                           rr& = -rr&
                           Else
                        rr& = bstack.GetDotNew(r$, dot&) * rr&
                        End If
                           Else
                          If dot& > 1 Then r$ = String$(dot&, ".") + r$: If rr& = 0 Then rr& = 1
                          End If
    
    
   End If
    IsLabelDIM = rr&
End Function
Function IsLabelOnly(a$, r$) As Long
Dim n$
If Len(a$) < 129 Then
    IsLabelOnly = IsLabelOnlyInner(a$, r$)
Else
    n$ = Left$(a$, 128)
    IsLabelOnly = IsLabelOnlyInner(n$, r$)
    If Len(n$) = 0 Then
        IsLabelOnly = IsLabelOnlyInner(a$, r$)
    Else
        a$ = Mid$(a$, 129 - Len(n$))
    End If
End If
End Function

Function IsLabelOnlyInner(a$, r$) As Long  ' ok

Dim rr&, one As Boolean, c$, dot&
r$ = vbNullString
If a$ = vbNullString Then IsLabelOnlyInner = 0: Exit Function
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
     c$ = Left$(a$, 1) 'ANYCHAR HERE
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 64  '"@"
           If r$ = vbNullString Then
              a$ = Mid$(a$, 2)
              ElseIf Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
            r$ = r$ & "."
              a$ = Mid$(a$, 2)
              Else
                 IsLabelOnlyInner = 0: Exit Function
            End If
        Case 46 '"."
            If one Then
            Exit Do
           ElseIf r$ <> "" Then
                    r$ = r$ & Left$(a$, 1)
                       a$ = Mid$(a$, 2)
                    
           ElseIf Not Mid$(a$, 2, 1) Like "[0-9]" Then
            
                       If r$ <> "" Then
                       r$ = r$ & Left$(a$, 1)
                      rr& = 1
                                      
                            Else
                            
                            dot& = dot& + 1
                    
                            End If
                         
                         a$ = Mid$(a$, 2)
                        
                        
            Else
            If r$ = vbNullString And dot& > 0 Then

            r$ = String$(dot& + 1, ".")
            a$ = Mid$(a$, 2)
           IsLabelOnlyInner = 1
            Else
          
            IsLabelOnlyInner = 0
           End If
            Exit Function
            End If
     Case 92, 94, 123 To 126 '"\","^", "{" To "~"
Exit Do
        
        Case 48 To 57, 95 '"0" To "9", "_"
       
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
               rr& = 1 'is an identifier or floating point variable
            Else
            If dot& > 0 Then a$ = "." + a$: dot& = 0
            
            Exit Do
            End If
Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
      Case 38 ' "&"
            If r$ = vbNullString Then rr& = 2:    a$ = Mid$(a$, 2)
            Exit Do
       Case 36 ' "$"
       If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
        
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                If Mid$(a$, 2, 2) = ")@" Then
                 r$ = r$ & "()."
              a$ = Mid$(a$, 4)
                Else
                Select Case rr&
                Case 1
                rr& = 5 ' float array or function
                Case 3
                rr& = 6 'string array or function
                Case 4
                rr& = 7 ' long array
                Case Else
                Exit Do
                End Select
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
               Exit Do
            
            End If
           Else
           Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
             r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If
    Loop
    IsLabelOnlyInner = rr&
   
End Function
Function IsLabelSYMB3(a$, r$) As Boolean ' ok
Dim rr&, c$, LB As Long, mb As Long, LLB As Long
a$ = NLtrim$(a$)
LLB = Len(a$)
r$ = vbNullString
If LLB = 0 Then IsLabelSYMB3 = 0: Exit Function
mb = 0   'INDICATE LEFT SPACES
LB = 1
    Do While LB <= LLB
     c$ = Mid$(a$, LB, 1)
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 32, 160
        If LB - mb > 1 Then
        LB = LB - 1
        Exit Do
        Else
        mb = LB
        End If
        Case 36, 37, 40 ' "$", "%", "("
            IsLabelSYMB3 = 0
            Exit Function
        Case 46 '"."
         If LB > mb Then
            rr& = 1
            Else
            IsLabelSYMB3 = 0
            Exit Function
            End If
        Case 65 To 90, 97 To 122 ' "A" To "Z", "a" To "z"
     
            rr& = 1 'is an identifier or floating point variable
        Case Else
        LB = LB - 1
        Exit Do
        End Select
                Else
  
           rr& = 1 'is an identifier or floating point variable
   
        
        End If
        LB = LB + 1
    Loop
    r$ = Mid$(a$, mb + 1, LB - mb)
    IsLabelSYMB3 = rr&
  If LB > 0 Then a$ = Mid$(a$, LB + 1)

End Function
Function IsLabelSYMB33(a$, r$, chars As Long) As Boolean ' ok
Dim rr&, c$, LB As Long, mb As Long, LLB As Long

LLB = Len(a$)
r$ = vbNullString
If LLB = 0 Then IsLabelSYMB33 = 0: Exit Function
mb = 0
LB = 1
    Do While LB <= LLB
     c$ = Mid$(a$, LB, 1)
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 32, 160
        If LB - mb > 1 Then
        LB = LB - 1
        Exit Do
        Else
        mb = LB
        End If
        Case 46 '"."
         If LB > mb Then
            rr& = 1
            Else
            IsLabelSYMB33 = 0
            Exit Function
            End If
         Case 65 To 90, 97 To 122 ' "A" To "Z", "a" To "z"
     
            rr& = 1 'is an identifier or floating point variable
        Case Else
        LB = LB - 1
        Exit Do
        End Select
                Else
  
           rr& = 1 'is an identifier or floating point variable
   
        
        End If
        LB = LB + 1
    Loop
    r$ = Mid$(a$, mb + 1, LB - mb)
    IsLabelSYMB33 = rr&
   If rr& <> 0 Then
   chars = LB + 1
  
 End If
End Function
Function IsLabelF(a$, rrr$) As Long
Dim buf$
If Len(a$) < 129 Then IsLabelF = IsLabelF1(a$, rrr$): Exit Function

   
    buf$ = Left$(a$, 128)
    IsLabelF = IsLabelF1(buf$, rrr$)
    If buf$ = vbNullString Then
        IsLabelF = IsLabelF1(a$, rrr$)
    Else
        a$ = Mid$(a$, 129 - Len(buf$))
    End If
End Function

Function IsLabelF1(a$, r$) As Long  'ok
' for left side...no &

Dim rr&, one As Boolean, c$, gr As Boolean
r$ = vbNullString
If a$ = vbNullString Then IsLabelF1 = 0: Exit Function
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
    c$ = Left$(a$, 1)
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 46 '"."
            If one Then
            Exit Do
            ElseIf r$ <> "" And Len(a$) > 1 Then
            If Mid$(a$, 2, 2) = ". " Or Mid$(a$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            Else
            IsLabelF1 = 0
            Exit Function
            End If
      Case 92, 94, 123 To 126 '"\","^", "{" To "~"
        Exit Do
        Case 48 To 57, 95 '"0" To "9", "_"
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 36 ' "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
                one = True
                rr& = 4 ' is long variable
                r$ = r$ & Left$(a$, 1)
                a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
    r$ = myUcase(r$, gr)
    IsLabelF1 = rr&


End Function
Function IsLabelA(where$, a$, r$) As Long
Dim n$
If Len(a$) < 65 Then
    IsLabelA = IsLabelA1(where$, a$, r$)
Else
    n$ = Left$(a$, 64)
    IsLabelA = IsLabelA1(where$, n$, r$)
    If Len(n$) = 0 Then
        IsLabelA = IsLabelA1(where$, a$, r$)
    Else
        a$ = Mid$(a$, 65 - Len(n$))
    End If
End If
End Function
Function IsLabelA1(where$, a$, r$) As Long 'ok
' for left side...no &

Dim rr&, one As Boolean, c$, gr As Boolean
r$ = vbNullString
If a$ = vbNullString Then IsLabelA1 = 0: Exit Function
a$ = NLtrim$(a$)
    Do While Len(a$) > 0
    c$ = Left$(a$, 1)
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 64  '"@"
            If Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
              where$ = r$
            r$ = vbNullString
            a$ = Mid$(a$, 2)
            Else
              IsLabelA1 = 0: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString Then
        r$ = "?"
        a$ = Mid$(a$, 2)
        IsLabelA1 = 1
        Exit Function
        Else
        IsLabelA1 = 1
        Exit Function
        End If
        Case 46 '"."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" And Len(a$) > 1 Then
            If Mid$(a$, 2, 2) = ". " Or Mid$(a$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            Else
            IsLabelA1 = 0
            Exit Function
            End If
      Case 38 ' "&"
            If r$ = vbNullString Then rr& = 2:    a$ = Mid$(a$, 2)
            Exit Do
    Case 92, 94, 123 To 126 '"\","^", "{" To "~"
        Exit Do
        
        Case 48 To 57, 95 '"0" To "9", "_"
           If one Then
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 36 ' "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                            If Mid$(a$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 a$ = Mid$(a$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(a$, 1)
                                       a$ = Mid$(a$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
r$ = myUcase(r$, gr)

    IsLabelA1 = rr&
   'a$ = LTrim(a$)

End Function

Function IsLabelDot(where$, a$, r$) As Long  'ok
' for left side...no &

Dim rr&, one As Boolean, c$, firstdot$, gr As Boolean
r$ = vbNullString
If a$ = vbNullString Then IsLabelDot = 0: Exit Function

a$ = NLtrim$(a$)
    Do While Len(a$) > 0
    c$ = Left$(a$, 1)
    If AscW(c$) < 256 Then
        Select Case AscW(c$)
        Case 64  '"@"
            If Mid$(a$, 2, 1) <> "(" And r$ <> "" Then
              where$ = r$
            r$ = vbNullString
            a$ = Mid$(a$, 2)
            Else
              IsLabelDot = 0: a$ = firstdot$ + a$: Exit Function
            End If
        Case 63 '"?"
        If r$ = vbNullString And firstdot$ = vbNullString Then
        r$ = "?"
        a$ = Mid$(a$, 2)
        IsLabelDot = 1
        Exit Function
    
        ElseIf firstdot$ = vbNullString Then
        IsLabelDot = 1
        Exit Function
        Else
        IsLabelDot = 0
        Exit Function
        End If
        Case 46 '"."
            If one Then
            Exit Do
            Exit Do
            ElseIf r$ <> "" And Len(a$) > 1 Then
            If Mid$(a$, 2, 2) = ". " Or Mid$(a$, 2, 1) = " " Then Exit Do
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1
            Else
            firstdot$ = firstdot$ + "."
            a$ = Mid$(a$, 2)
            End If
       Case 92, 94, 123 To 126 '"\","^", "{" To "~"
        Exit Do

        Case 48 To 57, 95 '"0" To "9", "_"
           If one Then
            If firstdot$ <> "" Then a$ = firstdot$ + a$
            Exit Do
            ElseIf r$ <> "" Then
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            Else
            Exit Do
            End If
        Case Is < 0, Is > 64 ' >=A and negative
            If one Then
            Exit Do
            Else
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        Case 36 ' "$"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 3 ' is string variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 37 ' "%"
            If one Then Exit Do
            If r$ <> "" Then
            one = True
            rr& = 4 ' is long variable
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            Else
            Exit Do
            End If
        Case 40 ' "("
            If r$ <> "" Then
                            If Mid$(a$, 2, 2) = ")@" Then
                                    r$ = r$ & "()."
                                  
                                 a$ = Mid$(a$, 4)
                               Else
                                       Select Case rr&
                                       Case 1
                                       rr& = 5 ' float array or function
                                       Case 3
                                       rr& = 6 'string array or function
                                       Case 4
                                       rr& = 7 ' long array
                                       Case Else
                                       Exit Do
                                       End Select
                                       r$ = r$ & Left$(a$, 1)
                                       a$ = Mid$(a$, 2)
                                   Exit Do
                            
                          End If
               Else
                        Exit Do
            
            End If
        Case Else
        Exit Do
        End Select
        Else
            If one Then
            Exit Do
            Else
            gr = True
            r$ = r$ & Left$(a$, 1)
            a$ = Mid$(a$, 2)
            rr& = 1 'is an identifier or floating point variable
            End If
        End If

    Loop
       r$ = firstdot$ + myUcase(r$, gr)
    IsLabelDot = rr&
   'a$ = LTrim(a$)

End Function
Function IsStrExp(basestack As basetask, aa$, rr$) As Boolean
If Left$(aheadstatus(aa$, False), 1) <> "S" Then IsStrExp = False: Exit Function
If LastErNum = -2 Then LastErNum = 0 ': LastErNum1 = 0
Dim ac$, fault As Boolean
' uink$ = VbNullString 'MINK$
again:
fault = False
IsStrExp = False
'' FastSymbol aa$, "+"   '' maybe but not sure if it is ok.
Do While IsString(basestack, aa$, rr$)
fault = False
IsStrExp = True
ac$ = ac$ & rr$
If Not FastSymbol(aa$, "+") Then Exit Do
fault = True
Loop
If fault Then
Set basestack.lastobj = Nothing
If LastErNum = -2 Then
Exit Function
Else
aa$ = "+" & aa$
End If
End If
If FastSymbol(aa$, "<<", , 2) Then
basestack.soros.DataStr ac$
ac$ = vbNullString
GoTo again
End If
If Not IsStrExp Then Set basestack.lastobj = Nothing
rr$ = ac$
 End Function
Function GrabFrame() As String
Dim p As New cDIBSection
p.CreateFromPicture hDCToPicture(GetDC(0), (AVI.Left) / DXP, (AVI.Top) / DYP, AVI.Width / DXP, AVI.Height / DYP - DYP)
If p.Height > 0 Then

GrabFrame = DIBtoSTR(p)
End If
End Function
Function ReadVarDouble(bstack As basetask, what$) As Variant
Dim vvv As Variant
bstack.ReadVar what$, vvv
If MyIsObject(vvv) Then
Set bstack.lastobj = vvv
Else
ReadVarDouble = vvv
End If
End Function

Function ReadVarInt(bstack As basetask, what$) As Variant
Dim vvv As Variant
bstack.ReadVar what$, vvv
ReadVarInt = Int(vvv)
End Function
Function ReadVarStr(bstack As basetask, what$) As String
Dim vvv As Variant
bstack.ReadVar what$, vvv
ReadVarStr = vvv
End Function
Function IsString(bstackstr As basetask, a$, r$) As Boolean
r$ = vbNullString
Dim i As Long, q
i = MyTrimL(a$)
q = AscW(Mid$(a$, i, 1))
Select Case q
Case 123
        r$ = blockString(a$, 125, i + 1)
        IsString = FastSymbol(a$, "}")
        If Not IsString Then GoTo err1111
        Exit Function
Case 34
        r$ = blockString(a$, 34, i + 1)
        IsString = FastSymbol(a$, Chr$(34))
   
        If r$ = vbNullString Then
        Dim rr$
        Do While a$ <> ""
            Oldway a$, rr$
            r$ = r$ + rr$
            If Len(a$) > 0 Then
            If AscW(a$) = 34 Then
                a$ = Mid$(a$, 2)
                r$ = r$ + Chr$(34) + blockString(a$, 34)
                IsString = FastSymbol(a$, Chr$(34))
            Else
            Exit Do
            End If
            Else
            Exit Do
            End If
        Loop
        End If
        If Not IsString Then GoTo err1111
        Exit Function
Case 1, 2
        IsString = ISSTRINGA(a$, r$)
Case Else
    IsString = IsStr1(bstackstr, a$, r$)
  End Select
Exit Function
err1111:
MyErMacroStr a$, "No closed string, open with " & ChrW(q), "Ανοιχτό αλφαριθμητικό, με " & ChrW(q)

End Function
Private Sub Oldway(a$, r$)
Dim w As Long
        w = 1
        If Mid$(a$, w, 2) = Chr(34) + Chr$(34) Then
            Do
            r$ = r$ + Chr$(34)
            w = w + 2
            Loop Until Not Mid$(a$, w, 2) = Chr(34) + Chr$(34)
            a$ = NLtrim$(Mid$(a$, w))
    End If
End Sub
Function IsStr1(bstackstr As basetask, a$, r$) As Boolean
Dim nbstack As basetask
Dim p As Variant, PP As Variant, pppp As mArray, mS As mStiva
Dim q$, w As Long, w1&, w2 As Long, s$, par As Boolean, usebackup As Boolean
Dim q1$, q2$, w3 As Long, dn As Long, dd As Long, bs As basetask
Dim anything As Object
againpointer:
Set bstackstr.lastobj = Nothing

w2 = Len(a$)
Dim n$
If Len(a$) < 129 Then
w1& = IsLabelBig(bstackstr, a$, q$, par, , , , usebackup)
Else
    n$ = Left$(a$, 128)
    w1& = IsLabelBig(bstackstr, n$, q$, par, , , , usebackup)
     If Len(n$) > 0 Then
        a$ = Mid$(a$, 129 - Len(n$))
    Else
        w1& = IsLabelBig(bstackstr, a$, q$, par, , , , usebackup)
    End If
End If
''''''''If NoOptimum Then If w1& > 0 Then par = False
If w1& <= 0 Or par Then
If w1& = 0 Then Exit Function  ' not found
If w1& = -50 Then
r$ = q$
IsStr1 = True
Exit Function
End If
If w1& = -100 Then
    w1& = 0
      r$ = ""
      If bstackstr.GetDotNew(r$, 1) Then
      If r$ = "THIS." Then
      r$ = Left$(bstackstr.UseGroupname, Len(bstackstr.UseGroupname) - 1)
       ElseIf bstackstr.UseGroupname <> "" Then
           If Len(r$) = 0 Then IsStr1 = False: Exit Function
           r$ = Left$(r$, Len(r$) - 1)
           If r$ + "." = bstackstr.UseGroupname Then
           ElseIf InStr(r$, ".") = 0 Then
            If here$ <> "" Then r$ = here$ + "." + r$
           End If
           
       Else
       If Len(r$) = 1 Then
       Set bs = bstackstr.Parent
       Do While Not (bs Is Nothing)
        If bs.GetDotNew(r$, 1) Then
                     If Len(r$) = 1 Then
                     Set bs = bs.Parent
                     Else
                     r$ = here$ + "." + Left$(r$, Len(r$) - 1)
                     Set bs = Nothing
                     Exit Do
                     End If
Else
r$ = vbNullString
Exit Do
        End If
       Loop
       Else
  r$ = here$ + "." + Left$(r$, Len(r$) - 1)
  End If
  End If
           IsStr1 = True
  
        Exit Function
    ElseIf bstackstr.UseGroupname <> "" Then
        r$ = Left$(bstackstr.UseGroupname, Len(bstackstr.UseGroupname) - 1)
         IsStr1 = True
         Exit Function

    End If
    r$ = vbNullString
End If
w1& = Abs(w1&)
Select Case w1&
Case 2
r$ = q$
IsStr1 = True
Exit Function
Case 3
GoTo itisavar
Case 5
GoTo rvalObjectstring
Case 6
GoTo itisarrayorfunction
Case Else
checkpointer:
If w1& = 1 Then
If GetVar(bstackstr, q$, w1&) Then
    If MyIsObject(var(w1&)) Then
        If TypeOf var(w1&) Is Group Then
            If var(w1&).IamApointer Then
                Set bstackstr.lastpointer = var(w1&)
                If var(w1&).link.IamFloatGroup Then
                 Set pppp = BoxGroupVar(var(w1))
                Mid$(a$, 1, 2) = "." + Chr(3)
                IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", "", a$, (0)) = 1
                r$ = bstackstr.LastValue
                Exit Function
                Else
                Mid$(a$, 1, 2) = Chr(0) + "."
                GoTo againpointer
                End If
            End If
        End If
    End If
End If
End If
         IsStr1 = False
        Exit Function

End Select
End If
Select Case w1&
Case 1
GoTo checkpointer
Case 5
            ' check again
rvalObjectstring:
    If Left$(aheadstatus(q$ + Split(a$, Chr$(13))(0), False), 1) = "S" Then
        If neoGetArray(bstackstr, q$, pppp) Then
            If NeoGetArrayItem(pppp, bstackstr, q$, w, a$) Then
                If Not pppp.Arr And FastSymbol(a$, ")") Then
                ' need an object
                    If IsNumber(bstackstr, q$ + ")", p) Then
                        If Not bstackstr.lastobj Is Nothing Then
                            Set pppp.GroupRef = bstackstr.lastobj
                            Set bstackstr.lastobj = Nothing
                            w = -2
                            If FastSymbol(a$, "(") Then
                                If NeoGetArrayItem(pppp, bstackstr, q$, w, a$) Then
                                End If
                            End If
                        End If
                    End If
                Else
                    If Typename(pppp.item(w)) = "Group" Then
                    If pppp.item(w).IamFloatGroup Then
                    'MyEr "no proper group", "Μη κατάλληλη ομάδα"
                    'IsStr1 = False
                    'Exit Function
                    If pppp.item(w).IamApointer Then
                    If Mid$(a$, 1, 2) = "=>" Then Mid$(a$, 1, 2) = "." + ChrW(3)
                    End If
                    GoTo groupstrvalue
                    End If
                    If pppp.GroupRef Is Nothing Then
                   ' Stop
                   GoTo groupstrvalue
                    Else
                        If Len(q$) > Len(pppp.GroupRef.GroupName) Then
                            q1$ = Left$(q$, Len(q$) - 1) + "." + ChrW(&H1FFF) + ";()"
                        Else
                            q1$ = pppp.GroupRef.GroupName + ChrW(&H1FFF) + ";()"
                        End If
                    End If
                        q$ = BlockParam(a$)
                        a$ = Mid$(a$, Len(q$) + 2)
                        If GetSub(q1$, w1) Then
                            Set nbstack = New basetask
                            nbstack.reflimit = varhash.count
                            Set nbstack.Parent = bstackstr
                            If bstackstr.IamThread Then Set nbstack.Process = bstackstr.Process
                            Set nbstack.Owner = bstackstr.Owner
                            nbstack.OriginalCode = w1
                            nbstack.UseGroupname = sbf(w1).sbgroup
                            If GoFunc(nbstack, q1$, q$ + ")", r$) Then
                                If Not nbstack.StaticCollection Is Nothing Then
                                    bstackstr.Parent.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                                End If
                                'Set bstackstr.lastobj = nBstack.lastobj
                                If IsOperator(a$, "(") Then
                                    Set pppp = New mArray
                                    Set pppp.GroupRef = bstackstr.lastobj
                                    Set bstackstr.lastobj = Nothing
                                    pppp.Arr = False
                                    w2 = -2
                                    Set nbstack = Nothing
                                    GoTo contrightstrpar
                                ElseIf Left$(a$, 1) = "." Then
                                     Set pppp = New mArray
                                     Set pppp.GroupRef = bstackstr.lastobj
                                     Set bstackstr.lastobj = Nothing
                                     pppp.Arr = False
                                     w2 = -2
                                     Set nbstack = Nothing
                                     GoTo groupstrvalue
                                End If
                            End If
                                Set nbstack = Nothing
                                IsStr1 = True
                            Else
                                IsStr1 = False
                            End If
                        Else
                            IsStr1 = False
                        End If
                        Exit Function
                    End If
groupstrvalue:
                    If Typename(pppp.item(w)) = "Group" Then
                        IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", q$, a$, w) = 1
                        r$ = bstackstr.LastValue
                        Exit Function
                    End If
                End If
            End If
        Else
            IsStr1 = False
            Exit Function
        End If
    Case 3
        IsStr1 = False
        If usebackup Then
            If Not stridbackup.Find(q$, w1) Then GoTo itisavar
        Else
            If Not strid.Find(q$, w1, bstackstr.strnum) Then GoTo itisavar
            If w1 < 0 Then GoTo itisavar
        End If
    'Select Case q$
    ' "ABOUT$", "ΠΕΡΙ$"
        On w1 GoTo lit1, lit2, lit3, lit4, lit5, lit6, lit7, lit8, lit9, lit10, lit11, lit12, lit13, lit14, lit15, lit16, lit17, lit18, lit19, lit20, lit21, lit22, lit23, lit24, lit25, lit26, lit27, lit28, lit29, lit30, lit31, lit32, lit33, lit34, lit35, lit36

lit1:
            r$ = feedback$
            feedback$ = vbNullString
             IsStr1 = True
              Exit Function
lit2: '    Case "CONTROL$"
                  On Error Resume Next
                  If Screen.ActiveForm Is Nothing Then
                  r$ = vbNullString
                  Else
                  Select Case Screen.ActiveForm.name
                  Case "AVI"
                  r$ = "AVI"
                  Case "Form1"
                    r$ = "MAIN"
                  Case "Form4"
                  r$ = "HELP"
                  Case Else
                   GetGuiM2000 r$
                  End Select
                  End If
                      IsStr1 = True
                      On Error GoTo 0
                              Exit Function
lit32:   ' Case "ΦΟΡΜΑ$"
                  On Error Resume Next
                  If Screen.ActiveForm Is Nothing Then
                  r$ = vbNullString
                  Else
                  Select Case Screen.ActiveForm.name
                  Case "AVI"
                  r$ = "ΤΑΙΝΙΑ"
                  Case "Form1"
                    r$ = "ΚΥΡΙΟ"
                  Case "Form4"
                  r$ = "ΒΟΗΘΕΙΑ"
                  Case Else
                     GetGuiM2000 r$
                     End Select
                  End If
                 IsStr1 = True
                 On Error GoTo 0
                              Exit Function
                           
lit3: '   Case "THREADS$"
                               r$ = bstackstr.Parent.ThreadsStr(1)
                               IsStr1 = True
                              Exit Function
lit33: '  Case "ΝΗΜΑΤΑ$"
                               r$ = bstackstr.Parent.ThreadsStr
                               IsStr1 = True
                              Exit Function
lit4: '   Case "LAN$", "ΔΙΚΤΥΟ$"
    r$ = getIP
      IsStr1 = True
     Exit Function
lit5: '    Case "GRABFRAME$", "ΠΑΡΕΚΑΡΕ$"
                              If AVIUP Then
                              If MediaPlayer1.MovieHeight > 0 Then
                              r$ = GrabFrame
                              End If
                              End If
                             IsStr1 = True
                            Exit Function
lit6: '    Case "ΕΝΑΟΝΟΜΑ$", "TEMPNAME$"
                             r$ = GetTempFileName
                            IsStr1 = True
                            Exit Function
lit7: ' "TEMPORARY$", "ΠΡΟΣΩΡΙΝΟ$"  ' ΒΡΈΘΗΚΕ ΔΥΟ ΦΟΡΕΣ ΤΟ ΠΡΟΣΩΡΙΝΟ$
                            r$ = strTemp  'ΑΥΤΟΣ ΕΙΝΑΙ Ο ΦΑΚΕΛΟΣ
                            IsStr1 = True
                            Exit Function
lit8: '    Case "USER.NAME$", "ΟΝΟΜΑ.ΧΡΗΣΤΗ$"
                             r$ = Originalusername
                            IsStr1 = True
                            Exit Function
lit9: '    Case "COMPUTER$", "ΥΠΟΛΟΓΙΣΤΗΣ$"
                             r$ = strMachineName
                            IsStr1 = True
                            Exit Function
lit10: '    Case "CLIPBOARD$", "ΠΡΟΧΕΙΡΟ$"
                            r$ = GetTextData(CF_UNICODETEXT)
                            If r$ = vbNullString Then r$ = Clipboard.GetText
                            IsStr1 = True
                            Exit Function
lit11: '    Case "CLIPBOARD.IMAGE$", "ΠΡΟΧΕΙΡΟ.ΕΙΚΟΝΑ$"
                        r$ = GetImage()
                         IsStr1 = True
                         Exit Function

lit12: '    Case "ΠΑΡΑΜΕΤΡΟΙ$", "PARAMETERS$"
                        r$ = para$
                        IsStr1 = True
                        Exit Function
lit13: '    Case "OS$", "ΛΣ$"
                        r$ = os
                        IsStr1 = True
                        Exit Function
lit14: '    Case "ΕΝΤΟΛΗ$", "COMMAND$"
                        r$ = LASTPROG$
                    IsStr1 = True
                    Exit Function
lit15: '   Case "ΛΑΘΟΣ$"
        If Left$(LastErNameGR, 1) = Chr(0) Then LastErNameGR = Mid$(LastErNameGR, 2)
                     r$ = LastErNameGR
                      LastErNum1 = 0
                        LastErNameGR = vbNullString
                     LastErName = vbNullString
                    IsStr1 = True
                    Exit Function
lit34: '    Case "ERROR$"
    If Left$(LastErName, 1) = Chr(0) Then LastErName = Mid$(LastErName, 2)
                     r$ = LastErName
                      LastErNum1 = 0
                     LastErNameGR = vbNullString
                     LastErName = vbNullString
                    IsStr1 = True
                    Exit Function
lit36: ' case "MODULE.NAME$", "ΟΝΟΜΑ.ΤΜΗΜΑΤΟΣ$"
            If SecureNames Then
             r$ = GetName(here$)
             If AscW(r$) = 8191 Then
             If InStr(here$, r$) > 0 Then
             r$ = GetName(Left$(here$, Len(here$) - Len(r$)))
             r$ = Left$(r$, Len(r$) - 1)
             Else
             r$ = sbf(val(Mid$(here$, rinstr(here$, "[") + 1))).sbgroup
             If r$ <> "" Then
             r$ = Mid$(r$, rinstr(r$, ".", 2) + 1)
             r$ = Left$(r$, Len(r$) - 1)
             End If
             End If
             End If
             If InStr(r$, "[") > 0 Then r$ = GetName(r$)
             If InStr(r$, ").") Then r$ = Mid$(r$, InStr(r$, ").") + 2)
             
             
             IsStr1 = True
            Exit Function
            End If
 
lit16: '    Case "MODULE$", "ΤΜΗΜΑ$"
                    r$ = here$
                    IsStr1 = True
                    Exit Function

lit17: '    Case "PRINTERNAME$", "ΕΚΤΥΠΩΤΗΣ$"  ' δεν παίζει ρόλο πια η πόρτα
                    r$ = pname & " (" & port & ")"
                    IsStr1 = True
                    Exit Function
lit18: '    Case "PROPERTIES$", "ΙΔΙΟΤΗΤΕΣ$"
                If ThereIsAPrinter Then
                If UBound(MyDM) = 1 Then
                    PrinterDim pw, ph, psw, psh, pwox, phoy
                End If
                r$ = ARRAYtoStr(MyDM())
                Else
                r$ = vbNullString
                End If
                    IsStr1 = True
                    Exit Function
lit19: '    Case "MOVIE.STATUS$", "ΚΑΤΑΣΤΑΣΗ.ΤΑΙΝΙΑΣ$"
                   r$ = MediaPlayer1.getStatus
                IsStr1 = True
                Exit Function
lit20: '    Case "MOVIE.DEVICE$", "ΣΥΣΚΕΥΗ.ΠΡΟΒΟΛΗΣ$"
                   r$ = MediaPlayer1.getDeviceName
                IsStr1 = True
                Exit Function
lit21: '    Case "MOVIE.ERROR$", "ΛΑΘΟΣ.ΤΑΙΝΙΑΣ$"
                   r$ = MediaPlayer1.checkError
                IsStr1 = True
                Exit Function
lit22: '    Case "PLATFORM$", "ΠΛΑΤΦΟΡΜΑ$"
                r$ = Platform
                IsStr1 = True
                Exit Function

lit23: '    Case "FONTNAME$", "ΓΡΑΜΜΑΤΟΣΕΙΡΑ$"
    With bstackstr
                 If .tolayer > 0 And .tolayer < 32 Then
                 r$ = Form1.dSprite(.tolayer).Font.name
                 ElseIf .tolayer >= 32 Then
                 r$ = players(.tolayer).FontName
                 ElseIf .toback Then
                 r$ = Form1.Font.name
                 ElseIf .toprinter Then
                 r$ = Form1.PrinterDocument1.Font.name
                 Else
                r$ = Form1.DIS.Font.name
                End If
                End With
                 IsStr1 = True
                 Exit Function
lit24: '    Case "BROWSER$", "ΑΝΑΛΟΓΙΟ$"
                r$ = Form1.view1.LocationURL
                IsStr1 = True
                Exit Function

lit25: '    Case "SPRITE$", "ΔΙΑΦΑΝΕΙΑ$"
                r$ = BACKSPRITE
                BACKSPRITE = vbNullString
                IsStr1 = True
                Exit Function
lit26: '    Case "APPDIR$", "ΕΦΑΡΜΟΓΗ.ΚΑΤ$"
                r$ = GetLongName(App.path)
                If Right(r$, 1) <> "\" Then r$ = r$ + "\"
                IsStr1 = True
                Exit Function
lit27: '    Case "DIR$", "ΚΑΤ$"
    
                r$ = UserPath
    
                IsStr1 = True
                Exit Function
lit28: '    Case "KEY$", "ΚΟΜ$"
                ' this is because w1 do a pretty new functionality...form1 can minimized..without own titlebar or controls.

                    If Not Form1.Visible Then newshow basestack1: MyDoEvents
                  ''  If Not bstackstr.toprinter Then bstackstr.Owner.refresh
                ' so if we need a keystroke to read then we go ton non minimized status.
                r$ = UINKEY$  ' look if we have some keys here
                If r$ = vbNullString Or r$ = Chr(0) + Chr(0) Then
                Do
               ProcTask2 bstackstr
               If Not Form1.KeyPreview Then Form1.KeyPreview = True
                  MyRefresh bstackstr
                r$ = INKEY$  ' (inkey$ has autorepeat...)
                Loop Until r$ <> "" Or LastErNum <> 0
              ''  UINK$ = UINK$ & r$   ' so we send it there
              If LastErNum <> 0 And r$ = "" Then r$ = Chr$(0)
                End If
                IsStr1 = True
                Exit Function
lit29: '    Case "INKEY$", "ΕΝΚΟΜ$"
     If Not releasemouse Then
If Not Form1.Visible Then newshow basestack1
 MyDoEvents2 bstackstr.Owner
Else

         MyRefresh bstackstr
    If Not bstackstr.IamThread Then MyDoEvents
End If
                r$ = UINKEY$

                If r$ = vbNullString Then
           '     Sleep 10
              ''MyDoEvents
          
                    r$ = INKEY$
                    ' If r$ = VbNullString Then
                    ' UINK$ = UINK$ & Chr(0) + Chr(0)
                    ' Else
                    ' UINK$ = UINK$ & r$
                    ' End If
                'ElseIf r$ = Chr(0) + Chr(0) Then
                'r$ = VbNullString
                End If
                IsStr1 = True
                Exit Function
lit30: '    Case "LETTER$", "ΓΡΑΜΜΑ$"
                If bstackstr.soros.Total = 0 Then
                IsStr1 = False
                ElseIf bstackstr.soros.PopType = "S" Then
                r$ = bstackstr.soros.PopStr
                IsStr1 = True
                End If
                Exit Function
lit35: '    Case "ΛΑΜΔΑ$"
        Set bstackstr.lastobj = ProcLambda(bstackstr, a$, 0)
        r$ = vbNullString
           If FastSymbol(a$, "(") Then
    If Not CallLambdaASAP(bstackstr, a$, p, True) Then IsStr1 = False: Exit Function
    r$ = CStr(p)
    IsStr1 = True
    Else
    IsStr1 = Not bstackstr.lastobj Is Nothing
    End If
    
    Exit Function
lit31: ' "LAMBDA$"
        Set bstackstr.lastobj = ProcLambda(bstackstr, a$, 1)
        r$ = vbNullString
           If FastSymbol(a$, "(") Then
        p = vbNullString
    If Not CallLambdaASAP(bstackstr, a$, p, True) Then IsStr1 = False: Exit Function
    r$ = CStr(p)
    IsStr1 = True
    Else
    IsStr1 = Not bstackstr.lastobj Is Nothing
    End If
    
    Exit Function
    Exit Function
    
itisavar:
                If GetVar(bstackstr, q$, w) Then
                If MyIsObject(var(w)) Then
                    If TypeOf var(w) Is lambda Then
                        Dim aaa As lambda
                        r$ = vbNullString
                        var(w).CopyTo aaa, var()
                        Set bstackstr.lastobj = aaa
                        Set aaa = Nothing
                    ElseIf TypeOf var(w) Is PropReference Then
                    On Error Resume Next
                        r$ = var(w).Value
                        If Err Then r$ = ""
                    ElseIf TypeOf var(w) Is Group Then
                        If var(w).HasValue And Not IsOperator(a$, "::", 2) Then
                            q1$ = Left$(q$, Len(q$) - 1) + "." + ChrW(&H1FFF) + "$()"
                             If GetSub(q1$, w1) Then
foundprivate:
                                Set nbstack = New basetask
                                nbstack.reflimit = varhash.count
                                Set nbstack.Parent = bstackstr
                                If bstackstr.IamThread Then Set nbstack.Process = bstackstr.Process
                                Set nbstack.Owner = bstackstr.Owner
                                nbstack.OriginalCode = w1
                                nbstack.UseGroupname = sbf(w1).sbgroup
                                If GoFunc(nbstack, q1$, ")", r$) Then
                                    If Not nbstack.StaticCollection Is Nothing Then
                                        bstackstr.Parent.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                                    End If
                                    'Set bstackstr.lastobj = nBstack.lastobj
                                    Set nbstack = Nothing
                                    IsStr1 = True
                                Else
                                    IsStr1 = False
                                End If
                            Else
                                w3 = rinstr(q$, ".")
                                s$ = Left$(q$, Len(q$) - 1)
                                
                                'q1$ = Left$(s$, Len(q$) - W3 + 1) + ChrW(&HFFBF) + Mid$(s$, Len(q$) - W3 + 2, W3 - 2) + "." + ChrW(&H1FFF) + "$()"
                                q1$ = Left$(s$, w3) + ChrW(&HFFBF) + Mid$(s$, w3 + 1) + "." + ChrW(&H1FFF) + "$()"
                                  If GetSub(q1$, w1) Then GoTo foundprivate
                                InternalEror
                                IsStr1 = False
                            End If
                        Else
                            r$ = vbNullString
                            Set bstackstr.lastobj = CopyGroupObj(var(w))
                        End If
                    ElseIf TypeOf var(w) Is Document Then
                        r$ = var(w)
                    Else
                        On Error Resume Next
                        r$ = var(w).Value
                        If Err > 0 Then
                        Err.Clear
                        r$ = var(w)
                        If Err > 0 Then
                            MyEr "can't read value", "δεν μπορώ να διαβάσω τιμή"
                            End If
                        End If
                        On Error GoTo 0
                    End If
                Else
                    r$ = var(w)
                End If
                IsStr1 = True
                
                Else
                  If w = -1 Then
                      r$ = ReadVarStr(bstackstr, q$)
                      IsStr1 = True
                      Exit Function
                End If
                     IsStr1 = False
                     ' MAKE LENGTH EQUAL...
                     If w2 >= Len(a$) Then a$ = Left$(q$ + Space$(Len(q$)), w2 - Len(a$)) + a$
                    
                             If FindNameForGroup(bstackstr, q$) Then
                             MyErMacroStr a$, "Unknown property  " & q$, "’γνωστη ιδιότητα " & q$
                             Else
                                'MyErMacroStr A$, "Unknown variable " & q$, "’γνωστη μεταβλητή " & q$
                            UnknownVariable1 a$, q$
                            End If
                    End If
                
                Exit Function
    'End Select
    '' no used any more ???
                a$ = q$ & a$
                               
    Exit Function
    
Case 6
    IsStr1 = False
    If usebackup Then
        If Not strfunidbackup.Find(q$, w2) Then GoTo itisarrayorfunction
    Else
        If Not strfunid.Find(q$, w2, bstackstr.strfunnum) Then GoTo itisarrayorfunction
        If w2 < 0 Then GoTo itisarrayorfunction
    End If
    On w2 GoTo fstr1, fstr2, fstr3, fstr4, fstr5, fstr6, fstr7, fstr8, fstr9, fstr10, fstr11, fstr12, fstr13, fstr14, fstr15, fstr16, fstr17, fstr18, fstr19, fstr20, fstr21, fstr22, fstr23, fstr24, fstr25, fstr26, fstr27, fstr28, fstr29, fstr30, fstr31, fstr32, fstr33, fstr34, fstr35, fstr36, fstr37, fstr38, fstr39, fstr40, fstr41, fstr42, fstr43, fstr44, fstr45, fstr46, fstr47, fstr48, fstr49, fstr50, fstr51, fstr52, fstr53, fstr54, fstr55, fstr56, fstr57, fstr58, fstr59, fstr60, fstr61, fstr62, fstr63, fstr64, fstr65, fstr66, fstr67

fstr67: '"ΜΕΡΟΣ$(", "PIECE$("
If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") Then
        If IsStrExp(bstackstr, a$, r$) Then
            If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, p) Then
                    p = Abs(Fix(p))
                    Set anything = GETarrayFROMstr(q$, r$)
                    Set pppp = anything.objref
                    r$ = pppp.item(CLng(p - 1))
                    Set pppp = Nothing
                Else
                    MissNumExpr
                    Set anything = Nothing
                    Exit Function
                End If
            Else
            Set anything = GETarrayFROMstr(q$, r$)
            
            
            If FastSymbol(a$, ")(", , 2) Then
                If IsExp(bstackstr, a$, p) Then
                    p = Abs(Fix(p))
                    Set pppp = anything.objref
                    r$ = pppp.item(CLng(p))
                    Set pppp = Nothing
                Else
                    Set bstackstr.lastobj = anything
                    Set anything = Nothing
                End If
            Else
                Set bstackstr.lastobj = anything
                Set anything = Nothing
                
                
            r$ = vbNullString
            End If
            ' RETURN ARRAY
            End If
        Else
            MissStringExpr
            Exit Function
        End If
    Else
        MissPar
        Exit Function
    End If
Else
    MissStringExpr
    Exit Function
End If
    IsStr1 = FastSymbol(a$, ")", True)
    Exit Function
fstr66: '"IF$(","ΑΝ("
IsStr1 = False
If IsExp(bstackstr, a$, p) Then IsStr1 = ProcessIfStr(p, bstackstr, a$, r$)
Exit Function
fstr1: '"FORMAT$(", "ΜΟΡΦΗ$("
    r$ = enthesi(bstackstr, a$)
    IsStr1 = FastSymbol(a$, ")", True)
    Exit Function
fstr2: '"EVAL$(", "ΕΚΦΡ$(", "ΕΚΦΡΑΣΗ$("

    If IsExp(bstackstr, a$, p) Then
    If bstackstr.lastobj Is Nothing Then Exit Function
    If TypeOf bstackstr.lastobj Is mHandler Then
    
        Set anything = bstackstr.lastobj
             If bstackstr.lastobj.IamEnum Then
        r$ = bstackstr.lastobj.index_cursor
        
        Set bstackstr.lastobj = Nothing
         IsStr1 = FastSymbol(a$, ")", True)
        Exit Function
        ElseIf Not CheckLastHandlerOrIterator(anything, w) Then
        InternalError
        IsStr1 = False
        Exit Function
        End If
        With anything
            If .t1 = 1 Then
            If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, p) Then
                p = MyRound(p)
               If Abs(p) < .objref.count Then
              If p < 0 Then
                .objref.index = .objref.count + MyRound(p)
              Else
                .objref.index = MyRound(p)
                End If
             
                .objref.Done = True
                r$ = .objref.KeyToString
                  Else
         
                  MyErMacroStr a$, "Index out of limits", "Δείκτης εκτός ορίων"
                    IsStr1 = False
                  Exit Function
                End If
                Else
                MissPar
                End If
                ElseIf .objref.Done Or w >= 0 Then
                    If w >= 0 Then
                        .objref.index = w
                        .objref.Done = True
                    End If
                    If FastSymbol(a$, "!") Then
                     r$ = .objref.KeyToString
                     Set bstackstr.lastobj = Nothing
                    Else
                    If .objref.IsObj Then
                        'If TypeOf .objref.ValueObj Is lambda Then CopyLambda .objref.ValueObj, bstackstr
                        rValue bstackstr, .objref.ValueObj
                           r$ = vbNullString
                        Else
                        Set bstackstr.lastobj = Nothing
                            r$ = CStr(.objref.Value)
                        End If
                    End If
                    End If
            ElseIf .t1 = 4 Then
            
            If w = -1 Then anything.objref.index = anything.index_start
            r$ = anything.objref.KeyToString()
            Set bstackstr.lastobj = Nothing
            Else ' IS A MEMBLOCK
                Set bstackstr.lastobj = Nothing
                If FastSymbol(a$, ",") Then
                    If IsExp(bstackstr, a$, p) Then
                    PP = p
                    
                        If FastSymbol(a$, "!") Then
                        
                         If IsLabelOnly(a$, s$) Then
                            If .objref.UseStruct Then
                                If .objref.structref.Find(myUcase(s$, True)) Then
                                PP = .objref.structref.sValue
                                    w2 = cUlng(uintnew(.objref.GetPtr(p)) + .objref.structref.Value)
                                    If FastSymbol(a$, "!") Then
                                     If IsExp(bstackstr, a$, p) Then
                                      ' w2 = w2 + Int(p) * PP
                                     w2 = cUlng(uintnew(w2) + MyRound(p) * Abs(PP))
                                     End If
                                    End If
                                Else
                                
                                    MyErMacroStr a$, "Unknown variable " & s$, "’γνωστη μεταβλητή " & s$
                                    Exit Function
                                
                                End If
                            Else
                                    MyErMacroStr a$, "no structure exist", "δεν υπάρχει δομή"
                                    Exit Function
                            
                        End If
                        Else
                        w2 = .objref.GetBytePtr(p)
                        End If
                        
                            
                        Else
                            
                        
                            w2 = .objref.GetPtr(p)
                        End If
                        If .objref.Status = 4 Then MyErMacroStr a$, "Buffer locked, wrong use of pointer", "Η Διάρθρωση κλειδώθηκε, κακή χρήση δείκτη": Exit Function
                        dd = 2 + (AscW(q$) < 128)
                        If FastSymbol(a$, ",") Then
                            If IsExp(bstackstr, a$, p) Then
                            ' NOW WE KNOW HOW MANY BYTES WE TAKE (ALWAYS BYTES)
                                p = MyRound(p)
                                If .objref.ValidArea(w2, p) Then
                                If p Mod 2 = 1 Then
                                r$ = StrConv(String(p, Chr(0)), vbFromUnicode)
                                Else
                                r$ = String$((p + 1) \ 2, Chr(0))
                                End If
                                    
                                    CopyBytes CLng(p), StrPtr(r$), w2
                                Else
                                    MyErMacroStr a$, "Buffer is small, can't get so many bytes", "Η Διάρθρωση είναι μικρή, δεν μπορώ να πάρω τόσα ψηφία"
                                End If
                            Else
                                MissPar
                                IsStr1 = False
                                Exit Function
                            End If
                        ElseIf IsLabelSymbolNew(a$, "ΩΣ", "AS", dd) Then
                        w2 = .objref.GetBytePtr(p)
                        If IsLabelSymbolNew(a$, "ΓΡΑΜΜΑ", "STRING", dd, , , , False) Then
                            CopyBytes 4, VarPtr(w3), w2
                             dd = .objref.GetStringFromOffset(w2, r$)
                            If w3 <> dd Then
                                    MyEr "Invalid Pointer for BSTR at Buffer", "Μη έγκυρος δείκτης για BSTR στη Διάθρωση"
                                    IsStr1 = False
                                    Exit Function
                            End If

                        ElseIf IsLabelSymbolNew(a$, "ΧΑΡΑΚΤΗΡΕΣ", "UNICODE", dd, , , , False) Then
                        w2 = .objref.GetBytePtr(p)
                        CopyBytes 4, VarPtr(w3), w2
                        If w3 > &H100000 Then
                        r$ = GetBStrFromBstrPtr(w3)
                        Else
                            MyEr "Invalid Pointer for BSTR at Buffer", "Μη έγκυρος δείκτης για BSTR στη Διάθρωση"
                            IsStr1 = False
                            Exit Function
                        End If
                        ElseIf IsLabelSymbolNew(a$, "ΤΟΠΙΚΟ", "LOCALE", dd, , , , False) Then
                        w2 = .objref.GetBytePtr(p)
                        CopyBytes 4, VarPtr(w3), w2
                        If w3 > &H100000 Then
                        If IsExp(bstackstr, a$, p) Then
                            r$ = Convert3(Convert2(GetBStrFromPtr(w3, True), LCID_DEF), CLng(Fix(p)))
                        Else
                            r$ = Convert3(Convert2(GetBStrFromPtr(w3, True), LCID_DEF), cLid)
                            End If
                        Else
                            MyEr "Invalid Pointer for BSTR at Buffer", "Μη έγκυρος δείκτης για BSTR στη Διάθρωση"
                            IsStr1 = False
                            Exit Function
                        End If
                        End If
                        
                        Else
                        '
                        If .objref.WhatAreBasicItem = vbString Or PP < 0 Then
                        
                            CopyBytes 4, VarPtr(w3), w2
                             dd = .objref.GetStringFromOffset(w2, r$)
                            If w3 <> dd Then
                            If dd = 0 Then
                                 
                                       r$ = ""
                                 
                            Else
                            ' extreme change with Fast ! in console or in code using Set Fast !
                                If extreme Then
                             ' unsafe may crash
                                    r$ = GetBStrFromBstrPtr(w3)
                                Else
                                    MyEr "Invalid Pointer for BSTR at Buffer", "Μη έγκυρος δείκτης για BSTR στη Διάθρωση"
                                    IsStr1 = False
                                    Exit Function
                                End If
                            End If
                         
                            End If
                        Else
                                    p = .objref.SizeByte - PP * 2
                                    If .objref.SizeByte Mod 2 = 1 Then
                                    r$ = StrConv(String$(.objref.SizeByte - PP * 2, Chr(0)), vbFromUnicode)
                                    Else
                                     r$ = String$((.objref.SizeByte - PP * 2 + 1) \ 2, Chr(0))
                                     End If
                                    CopyBytes CLng(p), StrPtr(r$), w2
                        End If
                        End If
                        IsStr1 = FastSymbol(a$, ")") And .objref.Status = 0
                        Exit Function
                    Else
                        MissPar
                        IsStr1 = False
                        Exit Function
                    End If
                    
                Else  ' elval$(alfa)  'copy entire block to r$
                    If .objref.SizeByte > 0 And .objref.Status = 0 Then
                        'r$ = String$((.objref.SizeByte + 1) \ 2, Chr(0))
                        r$ = StrConv(String$(.objref.SizeByte, Chr(32)), vbFromUnicode)
                        CopyBytes .objref.SizeByte, StrPtr(r$), .objref.GetPtr(0)
                    Else
                        r$ = vbNullString
                    End If
                End If
           
            
            End If
               IsStr1 = FastSymbol(a$, ")", True)
                Set anything = Nothing
                Exit Function
        End With
        Set anything = Nothing
    ElseIf Typename(bstackstr.lastobj) = "VarItem" Then
                   IsStr1 = FastSymbol(a$, ")", True)
                Exit Function
ElseIf Not bstackstr.lastpointer Is Nothing Then
getgroup:
If TypeOf bstackstr.lastobj Is Group Then
            If Not bstackstr.lastpointer.IamApointer Then Set bstackstr.lastpointer = bstackstr.lastobj
            Set bstackstr.lastobj = Nothing
            If bstackstr.lastpointer.link.IamFloatGroup Then
            Set pppp = New mArray
            pppp.PushDim 1
            pppp.PushEnd
            pppp.Arr = True
            Set pppp.item(0) = bstackstr.lastpointer
            Set bstackstr.lastpointer = Nothing
            If pppp.item(0).link.HasParameters Then Mid$(a$, 1, 1) = "("
            IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", "", a$, 0) = 1
            r$ = bstackstr.LastValue
            If Not pppp.item(0).link.HasParameters Then IsStr1 = FastSymbol(a$, ")", True)
                Exit Function
            Else
            If MaybeIsSymbol(a$, ",") Then
            Mid$(a$, 1, 1) = Chr(1)
            If IsStr1(bstackstr, a$, r$) Then
              IsStr1 = True
                
                Exit Function
            End If
            ElseIf IsStr1(bstackstr, Chr$(0) + "$'", r$) Then
                IsStr1 = FastSymbol(a$, ")", True)
                Set anything = Nothing
                Exit Function
            End If
            End If
            End If
    End If
    MissParam a$
Else
dd = 1
q$ = aheadstatus(a$, False, dd)
q$ = Left$(a$, dd)
Dim mygroup As Group
    If CheckGroupOrPointer(bstackstr, q$, mygroup, Nothing, (0)) Then
            If mygroup Is Nothing Then
            
            ElseIf Not mygroup.IamApointer Then
                MakeGroupPointer bstackstr, mygroup
            End If
            a$ = Mid$(a$, dd + 1 - Len(q$))
            GoTo getgroup
    Else
conthere1111:
        If IsStrExp(bstackstr, a$, q$) Then
    
            If FastSymbol(a$, ".") Then
                If MaybeIsSymbol(a$, ")") Then
                    a$ = q$ + a$
                Else
                    a$ = q$ + "." + a$
                End If
                If Not IsStrExp(bstackstr, a$, r$) Then
                    IsStr1 = False: Exit Function
                End If
            End If
            
    
        Else
            r$ = vbNullString
        End If
    End If
End If
IsStr1 = FastSymbol(a$, ")", True)
Exit Function
fstr3: ' "STACKTYPE$(", "ΣΩΡΟΥΤΥΠΟΣ$("
w3 = 1
If IsExp(bstackstr, a$, p) Then
If bstackstr.lastobj Is Nothing Then
    Set anything = bstackstr.soros
    w3 = Abs(CLng(Fix(p)))
ElseIf Not CheckStackObj(bstackstr, anything, w3) Then
    MyEr "Not a stack object", "Δεν είναι αντικείμενο σωρού"
    Exit Function
ElseIf FastSymbol(a$, ",") Then
If IsExp(bstackstr, a$, p) Then
    w3 = Abs(CLng(Fix(p)))
End If
End If
backitem1:
    If anything.Total < w3 Then
 
            MyErMacroStr a$, "Stack item not found at position " & CStr(w3), "Δεν υπάρχει στοιχείο σωρού στη θέση " & CStr(w3)
  
        IsStr1 = False: Exit Function

    ElseIf anything.StackItemType(w3) = "*" Then
    Set bstackstr.lastobj = anything.StackItem(w3)
    Set anything = bstackstr.lastobj
    Set bstackstr.lastobj = Nothing
    CheckDeepAny anything
    r$ = Typename$(anything)
    If r$ = "mHandler" Then
                Select Case anything.t1
                Case 1
                    r$ = "Inventory"
                Case 2
                    r$ = "Buffer"
                Case 3
                        w3 = anything.indirect
                        If w3 > -1 And w3 <= var2used Then
                        r$ = Typename(var(w3))
                        Else
                        r$ = Typename(anything.objref)
                        End If
                Case Else
                    r$ = Typename(anything.objref)
            End Select
    End If
    IsStr1 = FastSymbol(a$, ")", True)
    ElseIf anything.StackItemType(w3) = "?" Then
    r$ = "(?)"
    ElseIf anything.StackItemType(w3) = "S" Then
    s$ = CStr(anything.StackItem(w3))
    r$ = vbNullString
    Select Case Abs(IsLabel(bstackstr, s$, q2$))
    Case 1, 3, 4
    
    If varhash.ExistKey(q2$) Then
    r$ = "ReferVar"
    ElseIf varhash.ExistKey(q2$ + "(") Then
    r$ = "ReferArray"
    End If
    
    Case 5, 6, 7
   
    End Select
    If r$ = vbNullString Then r$ = "String"
            IsStr1 = FastSymbol(a$, ")", True)
    ElseIf anything.StackItemType(w3) = "N" Then
    
    r$ = "Number"
        IsStr1 = FastSymbol(a$, ")", True)
    ElseIf anything.StackItemType(w3) = "L" Then
    r$ = "Long"
        IsStr1 = FastSymbol(a$, ")", True)
    Else
            MyErMacroStr a$, "Stack item isn't known object at position " & CStr(w3), "To στοιχείο του σωρού δεν είναι γνωστό αντικείμενο στη θέση " & CStr(w3)
  
    IsStr1 = False
    End If
    Exit Function
Else
w3 = 1
Set anything = bstackstr.soros
GoTo backitem1
End If
Exit Function
fstr4: 'STACKITEM$(", "ΤΙΜΗΣΩΡΟΥ$("
w3 = 1
If IsExp(bstackstr, a$, p) Then
If bstackstr.lastobj Is Nothing Then
    Set anything = bstackstr.soros
    w3 = Abs(CLng(Fix(p)))
ElseIf Not CheckStackObj(bstackstr, anything, w3) Then
    MyEr "Not a stack object", "Δεν είναι αντικείμενο σωρού"
    Exit Function
ElseIf FastSymbol(a$, ",") Then
If IsExp(bstackstr, a$, p) Then
    w3 = Abs(CLng(Fix(p)))
End If
End If
backitem2:
    If anything.Total < w3 Then
 
            MyErMacroStr a$, "Stack item not found at position " & CStr(w3), "Δεν υπάρχει τιμή σωρού στη θέση " & CStr(w3)
  
        IsStr1 = False: Exit Function

    ElseIf anything.StackItemType(w3) = "S" Then
    r$ = anything.StackItem(w3)
    IsStr1 = FastSymbol(a$, ")", True)
    Exit Function
    ElseIf anything.StackItemType(w3) = "*" Then
    r = 0
    Set bstackstr.lastobj = anything.StackPickRef(w3).ObjectRef
    IsStr1 = FastSymbol(a$, ")", True)
    Exit Function
    Else
            MyErMacroStr a$, "Stack item isn't string at position " & CStr(w3), "Η τιμή του σωρού δεν είναι γράμμα στη θέση " & CStr(w3)
  
    IsStr1 = False
    End If
    Exit Function
Else
w3 = 1
Set anything = bstackstr.soros
GoTo backitem2
End If
fstr5: ' "ΙΣΧΝΗ$(", "WEAK$("
                r$ = Funcweak(bstackstr, a$)

                 IsStr1 = FastSymbol(a$, ")") And r$ <> ""
             If Not IsStr1 Then
             MyErMacroStr a$, "No variable found or is static", "Δεν υπάρχει μεταβλητή ή είναι στατική"
             End If
                Exit Function
fstr6: '"ΛΟΓΟΣ$(", "SPEECH$("
           If IsExp(bstackstr, a$, p) Then
                       
                        r$ = VoiceName(p)
                       
                        End If
                        IsStr1 = FastSymbol(a$, ")")
             
                Exit Function
fstr7: ' "ASK$(", "ΡΩΤΑ$("
If IsStrExp(bstackstr, a$, AskText$) Then
If UCase(q$) = "ASK$(" Then
DialogSetupLang 1
Else
DialogSetupLang 0
End If
If AskText$ = vbNullString Then ZeroParam a$: IsStr1 = False: Exit Function
If FastSymbol(a$, ",") Then IsStrExp bstackstr, a$, AskTitle$
If FastSymbol(a$, ",") Then IsStrExp bstackstr, a$, AskOk$
If FastSymbol(a$, ",") Then IsStrExp bstackstr, a$, AskCancel$
If FastSymbol(a$, ",") Then IsStrExp bstackstr, a$, AskDIB$
If FastSymbol(a$, ",") Then IsStrExp bstackstr, a$, AskStrInput$: AskInput = True

olamazi

If Form3.NeoASK(bstackstr) Then
r$ = AskResponse$
Else
r$ = AskResponse$
End If
AskInput = False
    IsStr1 = FastSymbol(a$, ")", True)
End If
Exit Function
fstr8: ' "LOCALE$(", "ΤΟΠΙΚΟ$("
         If IsExp(bstackstr, a$, p) Then

    r$ = GetlocaleString(CLng(Fix(p)))
     IsStr1 = FastSymbol(a$, ")")
       End If
       
        Exit Function
 
fstr9: ' "SHORTDIR$(", "ΜΙΚΡΟΣ.ΚΑΤΑΛΟΓΟΣ$("
         If IsStrExp(bstackstr, a$, q$) Then
      

    r$ = GetDosPath(q$)
     IsStr1 = FastSymbol(a$, ")")
       End If
       
        Exit Function
 
fstr10: '"FILTER$(", "ΦΙΛΤΡΟ$("
     If IsStrExp(bstackstr, a$, q$) Then
       If FastSymbol(a$, ",") And IsStrExp(bstackstr, a$, q1$) Then
       
     IsStr1 = True
    r$ = CleanStr(q$, q1$)
    
       End If
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr11: '"ΛΟΓΟΣ$(", "SPEECH$("
           If IsExp(bstackstr, a$, p) Then
                       
                        r$ = VoiceName(p)
                       
                        End If
                        IsStr1 = FastSymbol(a$, ")")
             
                Exit Function
   
    
fstr12: ' "ΑΡΧΕΙΟ$(", "FILE$("
     If Left$(UCase(q$), 1) = "F" Then
DialogSetupLang 1

Else
DialogSetupLang 0

End If
        If IsStrExp(bstackstr, a$, r$) Then
                       If IsSelectorInUse Then
 IsStr1 = False
MyErMacroStr a$, "File/Folder Selector in Use", "Ο επιλογέας αρχείων/φακέλων είναι σε χρήση"
Exit Function
End If

If r$ = vbNullString Then
r$ = LoadFileCaption
End If
If FastSymbol(a$, ",") Then
If IsStrExp(bstackstr, a$, q1$) Then
' ok
Else
 IsStr1 = False
MissParam a$
Exit Function
End If
Else
q1$ = "GSB"
End If
                        r$ = mylcasefILE(GetFile(bstackstr, r$, mcd, q1$))
                       Else
                       
                        r$ = mylcasefILE(GetFile(bstackstr, r$, mcd, "GSB"))
                        End If
                        IsStr1 = FastSymbol(a$, ")")
             
                Exit Function
fstr13: ' "PARAM$(", "ΠΑΡΑΜ$("
q1$ = vbNullString
If IsStrExp(bstackstr, a$, q2$) Then

Do
w1 = Len(q2$)
      If IsNumberD2(q2$, p) Then
      If q1$ = vbNullString Then Exit Do Else q1$ = q1$ + "," + Str(p)
      
      Else
             ISSTRINGA q2$, s$
        If q1$ = vbNullString Then
                r$ = s$
        q1$ = ","
        Else
        q1$ = q1$ + ",{" + s$ + "}"
        End If
    End If
    FastSymbol q2$, ","
Loop Until Trim$(q2$) = vbNullString Or w1 = Len(q2$)
End If
    IsStr1 = FastSymbol(a$, ")", True)
    a$ = Mid$(q1$, 2) + a$
    Exit Function
fstr14: ' "LAZY$(", "ΟΚΝ$("
   If FastSymbol(a$, "&") Then
            If Abs(IsLabelBig(bstackstr, a$, q2$, par)) < 5 Then    ''IsLabelDot(HERE$, A$, q2$)

            Exit Function
            End If
          
            par = False
         '   MakeThisSubNum bstackstr, q2$
             If GetSub(q2$ + ")", w1) Then
             If sbf(w1).sbgroup = vbNullString Then
             r$ = sbf(w1).sb + "}"
             Else
                    r$ = sbf(w1).sb + "}" + sbf(w1).sbgroup
                    
                    par = True
                    End If
                    End If
                
            If Not FastSymbol(a$, ")") Then
                    IsStr1 = False
                    MyErMacroStr a$, "No parameters allowed here ()", "Δεν επιτρέπονται παράμετροι εδώ ()"
                    Exit Function
            End If
            If Left$(r$, 10) = "'11001EDIT" Then
                s$ = GetNextLine(r$) + vbCrLf
            Else
                s$ = vbNullString
            End If
            q2$ = vbNullString
    Else
    par = False
         w = 1
         q1$ = aheadstatus(a$, , w)
         If w > 0 Then q2$ = Left$(a$, w - 1) Else q2$ = "0"
         a$ = Mid$(a$, w)
         While FastSymbol(a$, ",")
            w = 1
            q1$ = aheadstatus(a$, , w)
            If w > 0 Then q2$ = q2$ + "," + Left$(a$, w - 1) Else q2$ = q2$ + ",0"
            a$ = Mid$(a$, w)
         Wend
         
         r$ = "=" + q2$: q2$ = "}" + bstackstr.UseGroupname
         s$ = vbNullString
   End If
 
If Trim$(r$ + q2$) <> "" Then
   ' r$ = "{ΤΜΗΜΑ " + Chr(34) + HERE$ & Chr(34) + vbCrLf + r$ + q2$
          If par Then
    
            r$ = "{" + s$ + r$ + q2$
    
       Else
   If q$ = "ΟΚΝ$(" Then

   If here$ = vbNullString Then
    r$ = "{" + s$ + "ΤΜΗΜΑ {}" + vbCrLf + r$ + q2$
   Else
    r$ = "{" + s$ + "ΤΜΗΜΑ " + here$ + vbCrLf + r$ + q2$
    End If
    Else
    If here$ = vbNullString Then
    r$ = "{" + s$ + "MODULE {}" + vbCrLf + r$ + q2$
   Else
    r$ = "{" + s$ + "MODULE " + here$ + vbCrLf + r$ + q2$
    End If
    End If
    End If
    Else
    r$ = "{}"
    End If
     IsStr1 = FastSymbol(a$, ")")
       
       
        Exit Function
fstr15: ' "INPUT$(", "ΕΙΣΑΓΩΓΗ$("
      IsSymbol3 a$, "#"  ' drop it
    If IsExp(bstackstr, a$, p) Then
    p = CLng(MyMod(Abs(p), 512))
     If FKIND(p) = FnoUse Or FKIND(p) = Foutput Or FKIND(p) = Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": IsStr1 = False: Exit Function
    PP = FLEN(p)
    If uni(p) And PP = 1 Then PP = 2
    
    If FastSymbol(a$, ",") Then
    If Not IsExp(bstackstr, a$, PP) Then
    MyErMacroStr a$, "missing parameter for length in chars", "λείπει παράμετρος για μήκος σε χαρακτήρες"
    IsStr1 = False: Exit Function
    End If
    End If
    
    r$ = Space$(PP)
    On Error Resume Next
    If uni(p) Then
        getUniString CLng(p), r$
    'If Not getUniStringNoUTF8(CLng(p), r$) Then Exit Function
    Else
    r$ = StrConv(r$, vbFromUnicode)
    Get #p, , r$   ' reading aS ansi
    End If
    End If
    If Err.Number = 0 Then
    IsStr1 = FastSymbol(a$, ")")
    End If
    On Error GoTo 0
     Exit Function
fstr16: '"MEMBER.TYPE$(", "ΜΕΛΟΥΣ.ΤΥΠΟΣ$("
     If Abs(IsLabel(bstackstr, a$, s$)) = 1 Then
            If GetVar(bstackstr, s$, w1) Then
                If Typename(var(w1)) = "Group" Then
                If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, p) Then
                p = Fix(p)
                Set mS = var(w1).PrepareSoros(var(), "")
                If p < 1 Or p > mS.Total Then
                OutOfLimit
                Exit Function
                
                End If
                s$ = mS.StackItem(CLng(p))
                If Left$(s$, 1) = "*" Then s$ = Mid$(s$, 2)
                q1$ = Split(s$)(1)
                s$ = Split(s$)(0)
                If Right$(s$, 1) = "(" Then
                    If here$ = vbNullString Or var(w1).IamGlobal Then
                    If varhash.ExistKey(s$) Then
                        If Right$(s$, 3) = "$()" Then
                            r$ = "Array String"
                        ElseIf Right$(s$, 3) = "%()" Then
                            r$ = "Array Integer"
                        Else
                             r$ = "Array Double"
                            
                        End If
                    End If
                    Else
                    If varhash.ExistKey(here$ + "." + s$) Then
                        If Right$(s$, 3) = "$()" Then
                            r$ = "Array String"
                        ElseIf Right$(s$, 3) = "%()" Then
                            r$ = "Array Integer"
                        Else
                             r$ = "Array Double"
                            
                        End If
                    End If
                    End If
                Else
                w3 = val(q1$)
                
                    r$ = Typename(var(w3))
                If r$ = "mHandler" Then
                       Select Case var(w3).t1
                       Case 1
                           r$ = "Inventory"
                       Case 2
                           r$ = "Buffer"
                       Case Else
                         r$ = Typename(var(w3).objref)
                       End Select
                     End If
                    End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else

                MissingGroup
                Exit Function
                End If
 
                IsStr1 = FastSymbol(a$, ")", True)
                Exit Function
            Else
        
            Nosuchvariable s$
            End If
        Else
         MissingGroup
       End If
       Exit Function
fstr17: ' "MEMBER$(", "ΜΕΛΟΣ$("
     If Abs(IsLabel(bstackstr, a$, s$)) = 1 Then
            If getvar2(bstackstr, s$, w1) Then   '' we need s$ if this is a "THIS"
                  If Typename(var(w1)) = "Group" Then
                If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, p) Then
                p = Fix(p)
                If var(w1).IamGlobal Then
                Set mS = var(w1).PrepareSoros(var(), Left$(s$, Len(s$) - Len(var(w1).GroupName) + 1))
                ElseIf here$ <> "" Then
                
                Set mS = var(w1).PrepareSoros(var(), here$ + "." + Left$(s$, Len(s$) - Len(var(w1).GroupName) + 1))
                Else
                Set mS = var(w1).PrepareSoros(var(), Left$(s$, Len(s$) - Len(var(w1).GroupName) + 1))
                End If
                If p < 1 Or p > mS.Total Then
                OutOfLimit
                Exit Function
                
                End If
                 s$ = mS.StackItem(CLng(p))
                If Left$(s$, 1) = "*" Then s$ = Mid$(s$, 2)
                         r$ = Split(s$)(0)
                 If InStr(r$, ChrW(&HFFBF)) > 0 Then r$ = Replace$(r$, ChrW(&HFFBF), "")
                Else
                MissNumExpr
                Exit Function
                End If
                Else
                MissNumExpr
                Exit Function
                End If
                Else

                MissingGroup
                Exit Function
                End If
 
                IsStr1 = FastSymbol(a$, ")", True)
                Exit Function
            Else
        
            Nosuchvariable s$
            End If
        Else
         MissingGroup
       End If
       Exit Function
    
    
fstr18: '"PIPENAME$(", "ΑΥΛΟΣ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = validpipename(r$)
                        IsStr1 = True
                ElseIf IsExp(bstackstr, a$, p) Then  ' χρήση του p, από εδώ αρχίζουν οι απανωτές κλήσεις
                                                    ' μπορούν να κληθούν συναρτήσεις αλλά όχι τμήματα!
                                                    '
                        r$ = validpipename("M" & Trim$(Str$(p)))
                        IsStr1 = True
                End If
                If Not FastSymbol(a$, ")") Then IsStr1 = False
                Exit Function
fstr19: '"DRIVE$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = DriveTypee(Left$(r$, 3))
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr20: '"FILE.TYPE$(", "ΤΥΠΟΣ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = ExtractType(r$)
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr21: ' "FILE.NAME.ONLY$(", "ΟΝΟΜΑ.ΑΡΧΕΙΟΥ.ΜΟΝΟ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = ExtractNameOnly(r$)
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr22: ' "FILE.NAME$(", "ΟΝΟΜΑ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = ExtractName(r$)
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr23: ' "FILE.PATH$(", "ΤΟΠΟΣ.ΑΡΧΕΙΟΥ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = ExtractPath(r$)  ' δίνει χωρίς να κοιτάει αν υπάρχει!
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr24: ' "ΟΔΗΓΟΣ$("
                If IsStrExp(bstackstr, a$, r$) Then
                        r$ = DriveType(Left$(r$, 3))  'greek response
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
                Exit Function
fstr25: '"ΤΙΤΛΟΣ.ΑΡΧΕΙΟΥ$(", "FILE.TITLE$("
                If IsStrExp(bstackstr, a$, r$) Then
                        If r$ <> "" Then r$ = FileNameType(r$)
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
fstr26: '"ΕΦΑΡΜΟΓΗ.ΑΡΧΕΙΟΥ$(", "FILE.APP$("
                If IsStrExp(bstackstr, a$, r$) Then
                        If r$ <> "" Then r$ = myRegister(r$)
                        IsStr1 = True
                        If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                End If
fstr27: '"HIDE$(", "ΚΡΥΦΟ$("
                If IsStrExp(bstackstr, a$, r$) Then
                    If FastSymbol(a$, ",") Then
                        If IsStrExp(bstackstr, a$, q$) Then
                            If FastSymbol(a$, ",") Then
                                If IsExp(bstackstr, a$, p) Then
                                    r$ = mycoder.encryptline(r$, q$, CLng(Fix(p)))
                                    IsStr1 = True
                                    If Not FastSymbol(a$, ")") Then IsStr1 = False
                                    Exit Function
                                End If
                            End If
                        End If
                    End If
                End If
                Exit Function
fstr28: ' "LEFTPART$(", "ΑΡΙΣΤΕΡΟΜΕΡΟΣ$("
     IsStr1 = False
    If IsStrExp(bstackstr, a$, s$) Then
    If FastSymbol(a$, ",") Then
    If IsStrExp(bstackstr, a$, q$) Then
    r$ = GetStrUntil(q$, s$)
   
    IsStr1 = FastSymbol(a$, ")")
    ElseIf IsExp(bstackstr, a$, p) Then
    r$ = GetStrUntil(ChrW$(Abs(p) And &HFFFF&), s$)
    IsStr1 = FastSymbol(a$, ")")
    
    End If
    End If
    End If

    Exit Function
fstr29: '"RIGHTPART$(", "ΔΕΞΙΜΕΡΟΣ$("
     IsStr1 = False
    If IsStrExp(bstackstr, a$, s$) Then
    If FastSymbol(a$, ",") Then
    If IsStrExp(bstackstr, a$, q$) Then
    DropLeft q$, s$
    r$ = s$
        IsStr1 = FastSymbol(a$, ")")
    ElseIf IsExp(bstackstr, a$, p) Then
    DropLeft ChrW$(Abs(p) And &HFFFF&), s$
    r$ = s$
        IsStr1 = FastSymbol(a$, ")")
    
    End If
    End If
    End If

    Exit Function
fstr30: ' "ARRAY$(", "ΠΙΝΑΚΑΣ$("
    
    If IsStrExp(bstackstr, a$, s$) Then
        If bstackstr.lastobj Is Nothing Then
            If Right$("!!" & s$, 2) = "()" Then
                Mid$(s$, Len(s$), 1) = " "
                s$ = RTrim(s$)
            Else
                w = InStr("!" & s$, "(") - 1
                If w > 0 And w <= Len(s$) Then
                    s$ = Left$(s$, w)
                ElseIf neoGetArray(bstackstr, s$, pppp) Then
                GoTo check1236789
                Else
                s$ = s$ + "("
                End If
                                
            End If
            If neoGetArray(bstackstr, s$, pppp) Then
check1236789:
                If Not pppp.Arr Then NotArray: Exit Function
                If FastSymbol(a$, ",") Then
                    IsStr1 = NeoGetArrayItem(pppp, bstackstr, s$, w, a$)
                Else
                    IsStr1 = FastSymbol(a$, ")", True)
                    w = 0
                    'w = pppp.index
                End If
check999100:
                If Not pppp.IsEmpty Then
                    If MyIsObject(pppp.item(w)) Then
                        If TypeOf pppp.item(w) Is Document Then
                            r$ = pppp.item(w)
                            Set bstackstr.lastobj = Nothing
                        Else
                            Set bstackstr.lastobj = pppp.item(w)
                           r$ = vbNullString
                        End If
                        
                    Else
                        r$ = CStr(pppp.item(w))
                        Set bstackstr.lastobj = Nothing
                    End If
                    
                Else
                    Set bstackstr.lastobj = Nothing
                    MyEr "Empty Array", "’δειος Πίνακας"
                End If
                
            Else
                Set bstackstr.lastobj = Nothing
                NotArray
            End If
            
            Exit Function
        ElseIf TypeOf bstackstr.lastobj Is mArray Then
                Set pppp = bstackstr.lastobj
                GoTo check1236789
        Else
            SyntaxError
            Set bstackstr.lastobj = Nothing
        End If
    ElseIf IsExp(bstackstr, a$, p) Then
        If Not bstackstr.lastobj Is Nothing Then
            If TypeOf bstackstr.lastobj Is mHandler Then
                If bstackstr.lastobj.indirect >= 0 Then
                    Set pppp = var(bstackstr.lastobj.indirect)
                    GoTo check1236789
                ElseIf TypeOf bstackstr.lastobj.objref Is mArray Then
                
                
                    Set pppp = bstackstr.lastobj.objref
                    If bstackstr.lastobj.UseIterator Then
                        If Not pppp.Arr Then NotArray: Exit Function
                        If FastSymbol(a$, ",") Then
                            IsStr1 = IsExp(bstackstr, a$, r)
                            IsStr1 = FastSymbol(a$, ")", True)
                            w = r
                        Else
                            IsStr1 = FastSymbol(a$, ")", True)
                            w = pppp.index
                        End If
                        If Not IsStr1 Then Exit Function
                    GoTo check999100
                    Else
                    GoTo check1236789
                    End If
                ElseIf TypeOf bstackstr.lastobj.objref Is mStiva Then
                Set anything = bstackstr.lastobj.objref
                Set bstackstr.lastobj = Nothing
                    If FastSymbol(a$, ",") Then
                    If IsExp(bstackstr, a$, p) Then
                    Set bstackstr.lastobj = anything.ExportArray(CLng(MyRound(p)))
                    
                    End If
                    Else
                        Set bstackstr.lastobj = anything.ExportArray(anything.count)
                        
                    End If
                    Set anything = Nothing
                    IsStr1 = FastSymbol(a$, ")", True)
                    
                    Exit Function
                Else
                 Set bstackstr.lastobj = Nothing
                NotArray
                End If
            ElseIf TypeOf bstackstr.lastobj Is mArray Then
                Set pppp = bstackstr.lastobj
                GoTo check1236789
            End If
        End If
    Else
      SyntaxError
    Set bstackstr.lastobj = Nothing
      IsStr1 = False
    End If
    Exit Function
fstr31: '"TYPE$(", "ΤΥΠΟΣ$("
    w1 = Abs(IsLabel(bstackstr, a$, s$))
    If w1 > 4 Then
    If neoGetArray(bstackstr, s$, pppp) Then
    w2 = 0
                    If Not NeoGetArrayItem(pppp, bstackstr, s$, w2, a$) Then
                    If Not pppp.Arr Then
                    If Typename(pppp.GroupRef) = "mHandler" Then
                    
                    End If
                    End If
                    Exit Function
                    End If
                    If pppp.Arr Then
                        r$ = Typename(pppp.item(w2))
                        If r$ = "mHandler" Then
                        
                            Select Case pppp.item(w2).t1
                                 Case 1
                                     r$ = "Inventory"
                                 Case 2
                                     r$ = "Buffer"
                                 Case 3
                                w1 = pppp.item(w2).indirect
                                If w1 > -1 And w1 <= var2used Then
                                r$ = Typename(var(w1))
                                Else
                                r$ = Typename(pppp.item(w2).objref)
                                End If
                                 Case Else
                                     r$ = Typename(pppp.item(w2).objref)
                             End Select
                         End If
                    Else
                    If Typename(pppp.GroupRef) = "mHandler" Then
                    
                        Set bstackstr.lastobj = pppp.GroupRef.objref
                        With bstackstr.lastobj
                        If pppp.GroupRef.t1 = 1 Then
                        If .IsObj Then
                            r$ = Typename(.ValueObj)
                            If r$ = "mHandler" Then
                                Select Case .ValueObj.t1
                                    Case 1
                                        r$ = "Inventory"
                                    Case 2
                                        r$ = "Buffer"
                                    Case 3
                                     w1 = .ValueObj.indirect
                                        If w1 > -1 And w1 <= var2used Then
                                        r$ = Typename(var(w1))
                                        Else
                                        r$ = Typename(.ValueObj.objref)
                                        End If
                                    Case Else
                                        r$ = Typename(.ValueObj.objref)
                                End Select
                             End If
                        Else
                        If .StructLen > 0 Then
                        Select Case .sValue
                        Case Is < 0
                            r$ = "String"
                        Case 1
                            r$ = "Byte"
                        Case 2
                            r$ = "Integer"
                        Case 4
                            r$ = "Long"
                        Case Else
                            r$ = "Structure"
                        End Select
                        Else
                            r$ = Typename(.Value)
                            End If
                        End If
                        Else ' assume t1=2 ' may change if we introduce new object for mhandler
                        Select Case .ItemSize
                        Case 1
                            r$ = "Byte"
                        Case 2
                            r$ = "Integer"
                        Case 4
                            r$ = "Long"
                        Case Else
                            r$ = "Fault"
                        End Select
                        End If
                        End With
                        Set bstackstr.lastobj = Nothing
                    
                    Else
                    r$ = Typename(pppp.GroupRef)
                   
                    End If
                    
                     
                    End If
                  If r$ = "VarItem" Then r$ = "Optional"
                    IsStr1 = FastSymbol(a$, ")")
    Else
    Nosuchvariable s$
    End If
    ElseIf w1 > 0 Then
    If GetVar(bstackstr, s$, w1) Then
                    r$ = Typename(var(w1))
                    If r$ = "mHandler" Then
                    Select Case var(w1).t1
                        Case 1
                        r$ = "Inventory"
                        Case 2
                        r$ = "Buffer"
                        Case 3
                        w2 = w1
                                     w1 = var(w1).indirect
                                        If w1 > -1 And w1 <= var2used Then
                                        r$ = Typename(var(w1))
                                        Else
                                        r$ = Typename(var(w2).objref)
                                        End If
                                    Case 4
                                        r$ = var(w1).objref.EnumName
                        Case Else
                        
                        r$ = Typename(var(w1).objref)
                     End Select
                     ElseIf Typename(var(w1)) = "PropReference" Then
                     
                                r$ = Typename$(var(w1).Value)
                    

                     End If
                   
                    IsStr1 = FastSymbol(a$, ")")
    ElseIf bstackstr.ExistVar2(s$) Then
                    bstackstr.ReadVar s$, p
                    If MyIsObject(p) Then
                    If TypeOf p Is mHandler Then
                    If p.t1 = 1 Then
                    
                            r$ = "Inventory"
                    ElseIf p.t1 = 2 Then
                            r$ = "Buffer"
                    Else
                        r$ = Typename(p.objref)
                        End If
                        Else
                                r$ = Typename$(p)
                        End If
                        Else
                                r$ = Typename$(p)
                    End If
                                IsStr1 = FastSymbol(a$, ")")
                                Exit Function
    Else
    Nosuchvariable s$
    End If
    ElseIf IsStrExp(bstackstr, a$, s$) Then
                r$ = strProgIDfromSrting(s$)
                    IsStr1 = FastSymbol(a$, ")")
    
    Else
    
    SyntaxError
    End If
    Exit Function
fstr32: ' "PARAGRAPH$(", "ΠΑΡΑΓΡΑΦΟΣ$("
 
        w1 = Abs(IsLabel(bstackstr, a$, s$))
        If w1 = 3 Then
            If GetVar(bstackstr, s$, w1) Then
                    ' GET PARAGRAPH ORDER NUMBER
                    If Not FastSymbol(a$, ",") Then
                        MissParam a$
                        Exit Function
                    End If
                    If FastSymbol(a$, "(") Then
                    
                    w3 = Abs(IsLabel(bstackstr, a$, s$))
                    If w3 = 1 Or w3 = 4 Then
                    If Not GetVar(bstackstr, s$, w3) Then Nosuchvariable s$: Exit Function
                    If Not FastSymbol(a$, ")") Then SyntaxError: Exit Function
                    dd = 1
                    Else
                    MissingnumVar
                     Exit Function
                    End If
                    ElseIf Not IsExp(bstackstr, a$, p) Then
                      MissNumExpr
                      Exit Function
                    End If
                        If Typename(var(w1)) = doc Then
                        r$ = var(w1).TextParagraphOrder(CLng(Fix(p)))
                        If FastSymbol(a$, ",") Then
                            If Not IsExp(bstackstr, a$, PP) Then MissNumExpr: Exit Function
                            If PP < 0 Then
                                If dd = 1 Then
                                        dd = var(w3)
                                        p = dd
                                             If var(w1).InvalidPara(CLng(p)) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                         If var(w1).BackMove Then
                                        var(w3) = var(w1).BackStep(dd)
                                        Else
                                        var(w3) = var(w1).Advance(dd)
                                        End If
                                 
                                        
                                        r$ = var(w1).RemoveDocParaIndex(CLng(p))
                                Else
                                        r$ = var(w1).TextParagraphOrderRemove(CLng(p))
                                End If
                            Else
                                 If dd = 1 Then
                                    dd = var(w3)
                                            p = dd
                                      If var(w1).InvalidPara(dd) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                            If var(w1).BackMove Then
                                            var(w3) = var(w1).BackStep(dd)
                                            Else
                                            var(w3) = var(w1).Advance(dd)
                                            End If
                                            
                                                r$ = Mid$(var(w1).TextParagraph(CLng(p)), CLng(PP))
                                    Else
                                
                                r$ = Mid$(var(w1).TextParagraphOrder(CLng(Fix(p))), CLng(PP))
                                End If
                            End If
                        Else
                                        If dd = 1 Then
                                    dd = var(w3)
                                            p = dd
                                               If var(w1).InvalidPara(dd) Then
                                        MissingDocRef
                                        Exit Function
                                        End If
                                            If var(w1).BackMove Then
                                            var(w3) = var(w1).BackStep(dd)
                                            Else
                                            var(w3) = var(w1).Advance(dd)
                                            End If
                                                r$ = var(w1).TextParagraph(CLng(p))
                                    Else
                        
                        r$ = var(w1).TextParagraphOrder(CLng(Fix(p)))
                        End If
                        End If
                        Else
                            MissingDoc
                            Exit Function
                        End If
                    
                    IsStr1 = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    Exit Function
            End If
        ElseIf w1 = 6 Then
            If neoGetArray(bstackstr, s$, pppp) Then
                    If Not NeoGetArrayItem(pppp, bstackstr, s$, w2, a$) Then Exit Function
                    If Not FastSymbol(a$, ",") Then
                    MissParam a$
                    Exit Function
                    End If
                    
                    If FastSymbol(a$, "(") Then
                    
                    w3 = Abs(IsLabel(bstackstr, a$, s$))
                    If w3 = 1 Or w3 = 4 Then
                    If Not GetVar(bstackstr, s$, w3) Then Nosuchvariable s$: Exit Function
                     If Not FastSymbol(a$, ")") Then SyntaxError: Exit Function
                    dd = 1
                    Else
                    MissingnumVar
                     Exit Function
                    End If
                    ElseIf Not IsExp(bstackstr, a$, p) Then
                      MissNumExpr
                      Exit Function
                    End If
                        If Typename(pppp.item(w2)) = doc Then
                         If FastSymbol(a$, ",") Then
                            If Not IsExp(bstackstr, a$, PP) Then MissNumExpr: Exit Function
                                If PP < 0 Then
                                        If dd = 1 Then
                                                dd = var(w3)
                                                p = dd
                                                   If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                                If pppp.item(w2).BackMove Then
                                                var(w3) = pppp.item(w2).BackStep(dd)
                                                Else
                                                var(w3) = pppp.item(w2).Advance(dd)
                                                End If
                                                r$ = pppp.item(w2).RemoveDocParaIndex(CLng(p))
                                        Else
                                                r$ = pppp.item(w2).TextParagraphOrderRemove(CLng(Fix(p)))
                                        End If
                                Else
                                   If dd = 1 Then
                                    dd = var(w3)
                                            p = dd
                                                 If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                            If pppp.item(w2).BackMove Then
                                            var(w3) = pppp.item(w2).BackStep(dd)
                                            Else
                                            var(w3) = pppp.item(w2).Advance(dd)
                                            End If
                                        r$ = Mid$(pppp.item(w2).TextParagraph(CLng(p)), CLng(PP))
                                    Else
                                r$ = Mid$(pppp.item(w2).TextParagraphOrder(CLng(Fix(p))), CLng(PP))
                                End If
                                End If
                            Else
                            If dd = 1 Then
                                    dd = var(w3)
                                            p = dd
                                                 If pppp.item(w2).InvalidPara(dd) Then
                                                    MissingDocRef
                                                    Exit Function
                                                    End If
                                            If pppp.item(w2).BackMove Then
                                            var(w3) = pppp.item(w2).BackStep(dd)
                                            Else
                                            var(w3) = pppp.item(w2).Advance(dd)
                                            End If
                                r$ = pppp.item(w2).TextParagraph(CLng(p))
                                            Else
                                r$ = pppp.item(w2).TextParagraphOrder(CLng(Fix(p)))
                                End If
                            End If
                        Else
                            MissingDoc
                            Exit Function
                        End If
                    
                    IsStr1 = FastSymbol(a$, ")", True)
            Else
                    MissParam a$
            End If
        End If
    Exit Function
fstr33: '"UNION.DATA$(", "ΕΝΩΣΗ.ΣΕΙΡΑΣ$("


  
  Do
  If IsStrExp(bstackstr, a$, s) Then
  
  ElseIf IsExp(bstackstr, a$, p) Then
  s = ChrW(p)
  Else
  s = ChrW(0)
  End If
  r$ = r$ + s
  
  Loop Until Not FastSymbol(a$, ",") Or a$ = vbNullString

    IsStr1 = FastSymbol(a$, ")", True)

    Exit Function
fstr34: ' "MAX.DATA$(", "ΜΕΓΑΛΟ.ΣΕΙΡΑΣ$("

  If IsStrExp(bstackstr, a$, r$) Then
  
  Do While FastSymbol(a$, ",")
  If Not IsStrExp(bstackstr, a$, s) Then MissStringExpr: Exit Function
  If r$ < s Then r$ = s
  
  Loop

    IsStr1 = FastSymbol(a$, ")", True)
        Else
      MissStringExpr
        End If
    Exit Function
fstr35: ' "MIN.DATA$(", "ΜΙΚΡΟ.ΣΕΙΡΑΣ$("
 IsStr1 = False
  If IsStrExp(bstackstr, a$, r$) Then
  
  Do While FastSymbol(a$, ",")
  If Not IsStrExp(bstackstr, a$, s) Then MissStringExpr: Exit Function
  If r$ > s Then r$ = s
  
  Loop

    IsStr1 = FastSymbol(a$, ")", True)
        Else
      MissStringExpr
        End If
    Exit Function
fstr36: ' "FUNCTION$(", "ΣΥΝΑΡΤΗΣΗ$("
    If IsStrExp(bstackstr, a$, s$) Then
        If IsSymbolBracket(s$) Then
            PushStage bstackstr, False
            GlobalSub "A$()", block(s$)
            IsSymbol3 a$, ","
              a$ = "A$(@" & a$
            IsStr1 = IsStrExp(bstackstr, a$, r$)
            
            PopStage bstackstr
            Else
            If MaybeIsSymbol(a$, ".") Then
                dd = 1
                      q1$ = aheadstatus(a$, , dd)
                s$ = s$ + Left$(a$, dd - 1)
                a$ = Mid$(a$, dd)
            End If
                 If FastSymbol(a$, ",") Then
                End If
                
              
                    If Right$(s$, 1) = ")" Then
                        a$ = Left$(s$, Len(s$) - 1) & a$
                   ElseIf InStr(s$, ").") > 0 Then     ''''''Or A$ Like ".*"
                   FastSymbol a$, ")"
                     a$ = s$ & a$
                    Else
               If Right$("!" & s$, 1) = "$" Then
                    a$ = s$ & "(@" & a$  '' w1 put a @ from 102
                Else
                 a$ = s$ & "$(" & a$
                    End If
                End If
        IsStr1 = IsStrExp(bstackstr, a$, r$)
     End If
     End If
    Exit Function
fstr37: '"HEX$(", "ΔΕΚΑΕΞ$("
    If IsExp(bstackstr, a$, p) Then
    r$ = PACKLNG$(p)
    If FastSymbol(a$, ",") Then
    If Not IsExp(bstackstr, a$, p) Then
      MyErMacroStr a$, "missing parameter 1 to 4 (bytes)", "λείπει παράμετρος 1 έως 4"
        IsStr1 = False: Exit Function
    ElseIf MyRound(p) < 1 Or MyRound(p) > 4 Then
         MyErMacroStr a$, "parameter from 1 to 4 (bytes)", "παράμετρος από 1 έως 4 δυαδικά ψηφία (bytes)"
        IsStr1 = False: Exit Function
Else
    r$ = Right$(r$, p * 2)
    End If
    End If
     IsStr1 = True
                         If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
    End If
fstr38: '"SHOW$(", "ΦΑΝΕΡΟ$("
    If IsStrExp(bstackstr, a$, r$) Then
        If FastSymbol(a$, ",") Then
            If IsStrExp(bstackstr, a$, q$) Then
                If FastSymbol(a$, ",") Then
                    If IsExp(bstackstr, a$, p) Then
                        r$ = mycoder.decryptline(r$, q$, CLng(Fix(p)))
                        IsStr1 = True
                         If Not FastSymbol(a$, ")") Then IsStr1 = False
                        Exit Function
                    End If
                End If
            End If
        End If
    End If
    Exit Function
fstr39: '"MENU$(", "ΕΠΙΛΟΓΗ$(", "ΕΠΙΛΟΓΕΣ$("
    If IsExp(bstackstr, a$, p) Then
    p = Abs(CLng(Fix(p)))
    With Form1.List1
        If p > 0 And .listcount >= p Then
            r$ = .list(CLng(p) - 1)
            IsStr1 = True
            Else
            MyErMacroStr a$, "index out of limits", "ο δείκτης είναι εκτός ορίων"
        End If
    End With
    Else
    ' return a copy
    Set pppp = New mArray: pppp.PushDim (Form1.List1.listcount): pppp.PushEnd: pppp.Arr = True
    For w2 = 0 To Form1.List1.listcount - 1
    pppp.item(w2) = Form1.List1.list(w2)
    Next w2
               Set anything = New mHandler
                anything.t1 = 3
                Set anything.objref = pppp
                Set bstackstr.lastobj = anything
                Set pppp = Nothing
                Set anything = Nothing
                r$ = ""
                IsStr1 = True
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr40: '"REPLACE$(", "ΑΛΛΑΓΗ$("
    
    If IsStrExp(bstackstr, a$, q$) Then
       If FastSymbol(a$, ",") And IsStrExp(bstackstr, a$, q1$) Then
            If FastSymbol(a$, ",") And IsStrExp(bstackstr, a$, q2$) Then
     IsStr1 = True
      If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
        If FastSymbol(a$, ",") And IsExp(bstackstr, a$, PP) Then
        r$ = Replace$(q2$, q$, q1$, p, PP)
        Else
      r$ = Replace$(q2$, q$, q1$, p)
      End If
      Else
    r$ = Replace$(q2$, q$, q1$)    'ReplaceStr(Q$, q1$, Q2$)
    End If
       End If
       End If
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr41: '"PATH$(", "ΤΟΠΟΣ$("
      If IsExp(bstackstr, a$, p) Then
    IsStr1 = True
    r$ = GetSpecialfolder(CLng(Fix(p)))
    AddDirSep r$
    ElseIf IsStrExp(bstackstr, a$, q$) Then
     IsStr1 = True
     
    r$ = ExtractPath$(q$)
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr42: '"UCASE$(", "ΚΕΦ$("
    If IsStrExp(bstackstr, a$, q$) Then
      IsStr1 = True
      If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
            If Fix(p) <> 0 Then
            r$ = kUpper(Convert3(q$, CLng(Fix(p))), Fix(p))
            Else
            r$ = kUpper(Convert3(q$, CLng(cLid)), CDbl(cLid))
            End If
      Else
     r$ = myUcase$(q$)
     
     End If
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr43: '"LCASE$(", "ΠΕΖ$("
     If IsStrExp(bstackstr, a$, q$) Then
   IsStr1 = True
      If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
      If Fix(p) <> 0 Then
      r$ = klower(Convert3(q$, CLng(Fix(p))), Fix(p))
      Else
      r$ = klower(Convert3(q$, CLng(cLid)), CDbl(cLid))
      End If
      Else
     r$ = myLcase$(q$)
     
     End If
    
    End If
    
    
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
fstr44: '"STRING$(", "ΕΠΑΝ$("
        dd = 2 + (AscW(q$) < 128)
    If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") Then
        If IsExp(bstackstr, a$, p) Then
        p = Int(Abs(p))
        If LenB(q$) > 0 Then
            On Error Resume Next
            If LenB(q$) Mod 2 = 0 Then
                dd = Len(q$)
                    r$ = Space$(p * dd)
                    
                    While p > 0
                        p = p - 1
                        Mid$(r$, p * dd + 1, dd) = q$
                    Wend

            Else
                While p > 0
                r$ = r$ & q$
                p = p - 1
                Wend
            End If
            End If
            IsStr1 = True
        End If
     Else
        If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd) Then
            If IsSymbol(a$, "JSON", 4) Then
                r$ = StringToEscapeStr(q$, True)
            ElseIf IsSymbol(a$, "ENCODE64", 8) Then
                If FastSymbol(a$, ",") Then
                    If IsExp(bstackstr, a$, p) Then
                        p = Int(Abs(p))
                        If p = 0 Then
                        If FastSymbol(a$, ",") Then
                            If IsExp(bstackstr, a$, p) Then
                                r$ = Encode64(q$, False, CLng(p))
                            Else
                                MissParam a$
                                Exit Function
                            End If
                        Else
                        r$ = Encode64(q$, CBool(p))
                        End If
                        Else
                        r$ = Encode64(q$, CBool(p))
                        End If
                    Else
                    MissParam a$
                    Exit Function
                    End If
                Else
                r$ = Encode64(q$)
                End If
            ElseIf IsSymbol(a$, "DECODE64", 8) Then

                While FastSymbol(q$, vbCrLf, , 2)
                Wend
                r$ = Decode64(q$, par)
                If Not par Then MyEr "No base 64 encoding string", "Το αλφαριθμητικό δεν έχει δεδομένα σε βάση 64": IsStr1 = False: Exit Function
            ElseIf IsSymbol(a$, "UTF8DEC", 7) Then
              r$ = utf8decode(q$)
            ElseIf IsSymbol(a$, "UTF8ENC", 7) Then
             r$ = utf8encode(q$)
            Else
                SyntaxError
                IsStr1 = False
                Exit Function
            End If
        Else
        
         r$ = StringToEscapeStr(q$)
         End If
         IsStr1 = True
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
     Exit Function
    End If
       IsStr1 = False
    Exit Function
fstr45: ' "MID$(", "ΜΕΣ$("
    dd = 2 + (AscW(q$) < 128)
    If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
    p = Abs(p)
    If p = 0 Then
        MyErMacroStr a$, "Zero pos in mid$ not allowed", "Μηδενική θέση στην ΜΕΣ$ δεν επιτρέπεται)"
        IsStr1 = False
        Exit Function
    Else
      If FastSymbol(a$, ",") And IsExp(bstackstr, a$, PP) Then
        PP = Abs(PP)
            If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd, , , , False) Then
            If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", dd, , , , False) Then
                r$ = MidB$(q$, p, PP)
            Else
                SyntaxError
                Exit Function
            End If
        Else
        r$ = Mid$(q$, p, PP)
        End If
    Else
        If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd, , , , False) Then
            If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", dd, , , , False) Then
            r$ = MidB$(q$, p)
            Else
                SyntaxError
                Exit Function
            End If
        Else
        r$ = Mid$(q$, p)
        End If
    End If
    IsStr1 = True
    End If
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    End If
    IsStr1 = True
    Exit Function
    
fstr46: ' "LEFT$(", "ΑΡΙΣ$("
    dd = 2 + (AscW(q$) < 128)
    If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
    p = Abs(p)
    If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd, , , , False) Then
        If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", dd, , , , False) Then
            r$ = LeftB$(q$, p)
        Else
        SyntaxError
        Exit Function
        End If
    Else
        r$ = Left$(q$, p)
    End If
    IsStr1 = True
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    End If
    Exit Function
fstr47: ' "RIGHT$(", "ΔΕΞΙ$("
    dd = 2 + (AscW(q$) < 128)
    If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") And IsExp(bstackstr, a$, p) Then
    p = Abs(p)
    If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd, , , , False) Then
        If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", dd, , , , False) Then
           r$ = RightB$(q$, p)
        Else
           SyntaxError
            Exit Function
        End If
    Else
        r$ = Right$(q$, p)
    End If
    IsStr1 = True
    End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False
    End If
    Exit Function
fstr48: ' "SND$(", "ΗΧΟ$("
     If IsStrExp(bstackstr, a$, q$) Then
        r$ = CFname(q$ & ".WAV")
         If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
    Else
        IsStr1 = False
    Exit Function
    End If
fstr49: ' "BMP$(", "ΕΙΚ$("
     If IsStrExp(bstackstr, a$, q$) Then
        r$ = CFname(q$ & ".BMP")
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
    Else
        IsStr1 = False
    Exit Function
    End If
fstr50: '"JPG$(", "ΦΩΤΟ$("
     If IsStrExp(bstackstr, a$, q$) Then
        r$ = CFname(q$ & ".JPG")
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
    Else
        IsStr1 = False
    Exit Function
    End If
fstr51: '"TRIM$(", "ΑΠΟΚ$("
    dd = 2 + (AscW(q$) < 128)
    If IsStrExp(bstackstr, a$, q$) Then
        If IsLabelSymbolNew(a$, "ΩΣ", "AS", dd, , , , False) Then
        If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", dd, , , , False) Then
           r$ = MyTrimB$(q$)
        Else
           SyntaxError
            Exit Function
        End If
    Else
        r$ = MyTrim$(q$)
    End If
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
    Else

        IsStr1 = False
    Exit Function
    End If
fstr52: '"QUOTE$(", "ΠΑΡΑΘΕΣΗ$("
r$ = vbNullString
q1$ = vbNullString
Do
If IsStrExp(bstackstr, a$, q$) Then
' make q$ as json string
 r$ = r$ & q1$ & Chr(34) + q$ + Chr(34)
ElseIf IsExp(bstackstr, a$, p) Then
        r$ = r$ & q1$ & Trim(Str$(p))
        Else
        IsStr1 = False: Exit Function
        End If
        If Not FastSymbol(a$, ",") Then Exit Do
        q1$ = ","
        Loop
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
 
fstr53: '"ΣΩΡΟΣ$(", "STACK$("
r$ = vbNullString
Do
If IsStrExp(bstackstr, a$, q$) Then
 r$ = r$ & Sput(q$)
ElseIf IsExp(bstackstr, a$, p) Then
        If Not bstackstr.lastobj Is Nothing Then
        MyEr "Number or and string allowed", "επιτρέπονται Αριθμοί ή και Γράμματα "
        Set bstackstr.lastobj = Nothing
        IsStr1 = False: Exit Function
        End If
        Select Case VarType(p)
        Case vbLong
        r$ = r$ & " " & Trim$(Str$(p)) + "&"
        Case vbDecimal
        r$ = r$ & " " & Trim$(Str$(p)) + "@"
        Case vbSingle
        r$ = r$ & " " & Trim$(Str$(p)) + "~"
        Case vbCurrency
        r$ = r$ & " " & Trim$(Str$(p)) + "#"
        Case vbInteger
        r$ = r$ & " " & Trim$(Str$(p)) + "%"
        Case Else
        r$ = r$ & " " & Trim$(Str$(p))
        End Select
        End If
        If Not IsSymbol3(a$, ",") Then Exit Do
        Loop
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
fstr54: '"ADD.LICENCE$(", "ΒΑΛΕ.ΑΔΕΙΑ$("
If IsStrExp(bstackstr, a$, q$) Then
If FastSymbol(a$, ",") Then
If IsStrExp(bstackstr, a$, q1$) Then
Err.Clear
On Error Resume Next
        If q1$ = vbNullString Then
        r$ = Licenses.Add(q$)
        Else
        r$ = Licenses.Add(q$, q1$)
        End If
        If Err.Number > 0 And Err.Number <> 732 Then MissLicence
        Err.Clear
        On Error GoTo 0
       If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
End If
Else
Err.Clear
On Error Resume Next
        r$ = Licenses.Add(q$)
        If Err > 0 And Err.Number <> 732 Then MissLicence
        Err.Clear
        On Error GoTo 0
       If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True


End If
End If

        Exit Function
fstr55: '"ENVELOPE$(", "ΦΑΚΕΛΟΣ$("
If IsStrExp(bstackstr, a$, q$) Then
    If FastSymbol(a$, ",") Then
            If Not IsStrExp(bstackstr, a$, q1$) Then IsStr1 = False: Exit Function
            Else
            q1$ = vbNullString
            End If
            If VALIDATE(q$, UCase$(q1$), q2$) Then ' Only S and N
               r$ = q2$
               Else
               r$ = vbNullString
               End If
    Else
' STACK$(BSTACKSTR)
                If FastSymbol(a$, ",") Then
                If Not IsStrExp(bstackstr, a$, q1$) Then IsStr1 = False: Exit Function
                Else
                q1$ = vbNullString
                End If

                If VALIDATEmStiva(bstackstr, UCase$(q1$), q2$) Then
                   r$ = q2$
                   Else
                   r$ = vbNullString
                   End If

    End If
         If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
        Exit Function
fstr56: '"FIELD$(", "ΠΕΔΙΟ$("
    If IsStrExp(bstackstr, a$, q$) Then
        If FastSymbol(a$, ",") Then
           If Not IsExp(bstackstr, a$, p) Then
           IsStr1 = False
           Exit Function
           End If
           p = Abs(p)
        Else
           IsStr1 = False
           Exit Function
        End If
        r$ = Left$(Trim$(q$), p)
        r$ = r$ & Space$(p - Len(r$))
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
      
    Else

        IsStr1 = False
   
    End If
    Exit Function
fstr57: '"DRW$(", "ΣΧΔ$("
    If IsStrExp(bstackstr, a$, q$) Then
        r$ = CFname(q$ & ".WMF")
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True

    Else
        IsStr1 = False
    End If
    Exit Function
fstr58: '"TIME$(", "ΧΡΟΝΟΣ$("
    If IsExp(bstackstr, a$, p) Then
       r$ = Format(p, "SHORT TIME")
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
    Else
        IsStr1 = False
    End If
    Exit Function
fstr59: ' "DATE$(", "ΗΜΕΡΑ$("
    If IsExp(bstackstr, a$, p) Then

        r$ = Format(CDbl(CDate(p)), "SHORT DATE")
        
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
        IsStr1 = True
    Else
        IsStr1 = False
    End If
    Exit Function
fstr60: '"STR$(", "ΓΡΑΦΗ$("
    If IsExp(bstackstr, a$, p) Then
    If Not bstackstr.lastobj Is Nothing Then
        If TypeOf bstackstr.lastobj Is Group Then
            If bstackstr.lastobj.HasValue Then
            
            Else
            MyErMacro a$, "Group has no value", "Η ομάδα δεν έχει αξία"
            Exit Function
            End If
        ElseIf TypeOf bstackstr.lastobj Is mHandler Then
        p = 0
        If bstackstr.lastobj.t1 = 4 Then p = bstackstr.lastobj.index_cursor
        Set bstackstr.lastobj = Nothing
        End If
        End If
        If FastSymbol(a$, ",") Then
            If IsExp(bstackstr, a$, PP) Then
            If PP = 0 Then
                If VarType(p) = vbBoolean Then
                If cLid = 1032 Then
                    r$ = Format$(p, ";\Α\λ\η\θ\έ\ς;\Ψ\ε\υ\δ\έ\ς")
                ElseIf cLid = 1033 Then
                r$ = Format$(p, ";\T\r\u\e;\F\a\l\s\e")
                Else
                r$ = Format$(p, DefBooleanString)
                End If
                    
                Else
                    r$ = CStr(p)
                End If
            Else
                q$ = GetlocaleString2(14, PP)
                If VarType(p) = vbBoolean Then
                If PP = 1032 Then
                    r$ = Format$(p, ";\Α\λ\η\θ\έ\ς;\Ψ\ε\υ\δ\έ\ς")
                ElseIf PP = 1033 Then
                r$ = Format$(p, ";\T\r\u\e;\F\a\l\s\e")
                Else
                r$ = Format$(p, DefBooleanString)
                End If
                Else
                r$ = LTrim(Str$(p))
                If Left$(r$, 1) = "." Then
                    r$ = "0" + r$
                ElseIf Left$(r$, 2) = "-." Then
                    r$ = "-0" + Mid$(r$, 2)
                End If
                r$ = Replace(r$, ".", q$)
            End If
                End If
                

            GoTo contstrhere
            ElseIf IsStrExp(bstackstr, a$, q$) Then
            On Error Resume Next
                r$ = Format(p, q$)
                If Err.Number = 6 Then Overflow
                Err.Clear
                If Not NoUseDec Then
                    If OverideDec Then
                        r$ = Replace$(r$, GetDeflocaleString(LOCALE_SDECIMAL), Chr(2))
                        r$ = Replace$(r$, GetDeflocaleString(LOCALE_STHOUSAND), Chr(3))
                        r$ = Replace$(r$, Chr(2), NowDec$)
                        r$ = Replace$(r$, Chr(3), NowThou$)
                        
                    ElseIf InStr(r$, NowDec$) > 0 Then
                        r$ = Replace$(r$, NowDec$, Chr(2))
                        r$ = Replace$(r$, NowThou$, ",")
                        r$ = Replace$(r$, Chr(2), ".")
        
                End If
                    End If
contstrhere:
            If FastSymbol(a$, ",") Then
            If IsExp(bstackstr, a$, PP) Then
            If PP > 0 Then
            r$ = Left$(r$ + Space$(PP), PP)
            Else
            r$ = Right$(Space$(Abs(PP)) + r$, Abs(PP))
            End If
            Else
            IsStr1 = False
            Exit Function
            End If
            End If
            
            ElseIf IsExp(bstackstr, a$, PP) Then
            
            If PP > 0 Then
            r$ = Left$(Trim$(Str(p)) + Space$(PP), PP)
            Else
            r$ = Right$(Space$(Abs(PP)) + Trim$(Str(p)), Abs(PP))
            End If
            Else
            IsStr1 = False
            Exit Function
            End If
        Else
            If VarType(p) = vbBoolean Then
                r$ = Format$(p, ";\T\r\u\e;\F\a\l\s\e")
            Else
                r$ = Str(p)
            End If
        End If
        
        If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
    IsStr1 = True
    Exit Function
    ElseIf IsStrExp(bstackstr, a$, r$) Then
        If FastSymbol(a$, ",") Then
            If IsStrExp(bstackstr, a$, q$) Then
            r$ = Format(r$, q$)
                        ElseIf IsExp(bstackstr, a$, PP) Then
                        If Fix(PP) = 0 Then
                        r$ = Convert2(r$, cLid)
                        Else
            r$ = Convert2(r$, CLng(Fix(PP)))
            End If
            Else
            IsStr1 = False
            Exit Function
            End If
        Else
        r$ = StrConv(r$, vbFromUnicode, cLid)
        End If
            If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
    IsStr1 = True
    Else
    IsStr1 = False
    End If
    Exit Function
   
fstr61: '"CHRCODE$(", "ΧΑΡΚΩΔ$("
    If IsExp(bstackstr, a$, p) Then
    r$ = ChrW$(cUint(p))
    If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
    IsStr1 = True
    Else
    IsStr1 = False
    End If
    Exit Function
    
fstr62: ' "CHR$(", "ΧΑΡ$("
    If IsExp(bstackstr, a$, p) Then
        If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, PP) Then
                If PP = 0 Then PP = LCID_DEF
                     r$ = ChrW$(AscW(StrConv(ChrW$(p Mod 256), 64, CLng(Fix(PP)))))
                Else
                        IsStr1 = False: Exit Function
                End If
        Else

                 r$ = ChrW$(AscW(StrConv(ChrW$(Fix(p) Mod 256), 64, cLid)))

        End If
        If InStr(r$, ChrW(&HFFFFF8FB)) > 0 Then r$ = Replace(r$, ChrW(&HFFFFF8FB), ChrW(&H2007))
    If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
    IsStr1 = True
    Exit Function
    ElseIf IsStrExp(bstackstr, a$, q$) Then 'CONVERT TO ASCII
            If FastSymbol(a$, ",") Then
                If IsExp(bstackstr, a$, PP) Then
                If Fix(PP) = 0 Then
                   r$ = Convert3(q$, LCID_DEF)
                ElseIf LCID_DEF = 1032 Then
                     r$ = Convert3(q$, CLng(Fix(PP)))
                Else
                  r$ = Convert3(Convert2(q$, LCID_DEF), CLng(Fix(PP)))
     
                   
                     End If
                Else
                        IsStr1 = False: Exit Function
                End If
        Else
        r$ = StrConv(q$, vbUnicode, cLid)
        End If
    If Not FastSymbol(a$, ")") Then IsStr1 = False: Exit Function
    IsStr1 = True
    Else
    IsStr1 = False
    End If
    Exit Function
fstr63: ' "GROUP$(", "ΟΜΑΔΑ$("
        
r$ = vbNullString
 IsStr1 = IsGroup(bstackstr, a$, p)
        
        
Exit Function
fstr64: ' "PROPERTY$(", "ΙΔΙΟΤΗΤΑ$("
        w1 = Abs(IsLabel(bstackstr, a$, s$))
        If w1 = 1 Or w1 = 3 Then
        If Not GetVar(bstackstr, s$, w1) Then GoTo jmp147811
        If Not Typename(var(w1)) = "PropReference" Then GoTo jmp147811
        ''CopyGroup2 var(w1), bstackstr
        Set bstackstr.lastobj = var(w1)
             r$ = vbNullString
            IsStr1 = FastSymbol(a$, ")", True)
            Exit Function
                
        Else
jmp147811:
        MyErMacro a$, "Expected a property name", "Περίμενα όνομα ιδιότητας"
        End If
Exit Function
fstr65:
    If IsStrExp(bstackstr, a$, q$) Then
        IsStr1 = True
        r$ = Tcase(q$)
    End If
        If Not FastSymbol(a$, ")") Then IsStr1 = False
    Exit Function
    
itisarrayorfunction:
    MakeThisSubNum bstackstr, q$
    q1$ = q$
    
    If Right$(q1$, 1) <> ")" Then q1$ = q1$ + ")"
    
            If IsSymbol(a$, "@") Then
            'is a function allways...
            If GetlocalSub(q1$, w1&) Then
                GoTo contStrFun
            ElseIf GetSub(q1$, w1&) Then
                GoTo contStrFun
            ElseIf GetSub2(bstackstr, q1$, w1&) Then
                GoTo contStrFun
            Else
                GoTo skiperrorStr
            End If
            
            Else
            If neoGetArray(bstackstr, q$, pppp, , , True) Then
                GoTo contStrArr
            ElseIf GetlocalSub(q1$, w1&) Then
                GoTo contStrFun
            ElseIf neoGetArray(bstackstr, q$, pppp, , True) Then
                GoTo contStrArr
            ElseIf GetSub2(bstackstr, q1$, w1&) Then
                GoTo contStrFun
            ElseIf GetSub(q1$, w1&) Then
                GoTo contStrFun
            Else
            If bstackstr.UseGroupname <> "" Then
            If InStr(q1$, bstackstr.UseGroupname) = 1 Then
            
            
            If neoGetArray(bstackstr, "THIS." + ChrW(&HFFBF) + Mid$(q$, Len(bstackstr.UseGroupname) + 1), pppp, , True) Then
                GoTo contStrArr
            Else
            q1$ = bstackstr.UseGroupname + ChrW(&HFFBF) + Mid$(q1$, Len(bstackstr.UseGroupname) + 1)
            If GetSub(q1$, w1&) Then GoTo contStrFun
            End If
            End If
            End If

            
                GoTo skiperrorStr
            End If
            End If

    
        If GetSub(q1$, w1&) Then
contStrFun:
    If bstackstr.NoFuncError Then
    r$ = q$
                CallNext bstackstr, a$, par, p, r$
                    If par Then
                        IsStr1 = True
                    Else
                        r$ = vbNullString
                        IsStr1 = False
                    End If
                Else
                Set nbstack = New basetask
                nbstack.reflimit = varhash.count
                Set nbstack.Parent = bstackstr
                Set nbstack.Owner = bstackstr.Owner
                nbstack.UseGroupname = sbf(w1&).sbgroup
                nbstack.OriginalCode = w1&
                If GoFunc(nbstack, q1$, a$, s$, , , True) Then
                    If Not nbstack.StaticCollection Is Nothing Then
                        bstackstr.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                    End If
                    Set bstackstr.lastobj = nbstack.lastobj
                    r$ = s$
                    IsStr1 = True
                Else
                    IsStr1 = False
                End If
                End If
            Exit Function
        ElseIf neoGetArray(bstackstr, q$, pppp) Then
contStrArr:
            
            If pppp.Arr Then
            If FastSymbol(a$, ")") Then
                IsStr1 = True
                p = 0
                Set bstackstr.lastobj = pppp
                Exit Function
            End If
            dn = 0
            
            dd = pppp.bDnum - 1
            If dd < 0 Then
            If Typename(pppp.GroupRef) = "PropReference" Then
            
            GoTo contreadprop
            End If
            End If
            p = 0
            PP = 0
        IsStr1 = True
        w2 = 0
        Do While dn <= dd
        pppp.GetDnum dn, w3, w1&
        If IsExp(bstackstr, a$, p) Then
        If dn < dd Then
            If Not FastSymbol(a$, ",") Then MyErMacroStr a$, "need index for " & q$ & ")", "χρειάζομαι δείκτη για το πίνακα " & q$ & ")": IsStr1 = False: Exit Do
            Else
            If FastSymbol(a$, ",") Then
            IsStr1 = False
            MyErMacroStr a$, "too many indexes for array " & q$ & ")", "πολλοί δείκτες για το πίνακα " & q$ & ")"
        Exit Function
        End If
            If Not FastSymbol(a$, ")") Then MissSymbol ")": IsStr1 = False: Exit Function
        End If
              If p < -w1& Then
                 MyErMacroStr a$, "index too low for array " & q & ")", "αρνητικός δείκτης στο πίνακα " & q$ & ")": Exit Function
    
                End If
            On Error Resume Next
        If Not pppp.PushOffset(w2, dn, CLng(Fix(p))) Then
        
            MyErMacroStr a$, "index too high for array " & q$ & ")", "δείκτης υψηλός για το πίνακα " & q$ & ")"
            IsStr1 = False: Exit Function
            End If
            On Error GoTo 0
              Else
        IsStr1 = False
        
          MyErMacroStr a$, "missing index for array " & q$ & ")", "χάθηκε δείκτης για το πίνακα " & q$ & ")"
        Exit Function
    
        End If
        dn = dn + 1
        Loop
        If MyIsObject(pppp.item(w2)) Then
    If FastSymbol(a$, "(") Then
    
    If Typename(pppp.item(w2)) = "lambda" Then
    Set anything = pppp.item(w2)
contlambdastr:
    PushStage bstackstr, False
     w1 = globalvar("A_" + CStr(Abs(w2)), 0#)
     Set var(w1) = anything
                If here$ = vbNullString Then
                        dd = ModuleSub("A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & Str(w1))
                    Else
                        dd = ModuleSub(here$ & "." & bstackstr.GroupName & "A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & Str(w1))
                End If
             
                a$ = "A_" + CStr(Abs(w2)) + "$(" + a$
             IsStr1 = IsStr1(bstackstr, a$, r$)
             Set var(w1) = Nothing
         
    PopStage bstackstr
    ElseIf Typename(pppp.item(w2)) = "mHandler" Then
       Set bstackstr.lastobj = pppp.item(w2)
               Set pppp = New mArray
                pppp.Arr = False
                Set pppp.GroupRef = bstackstr.lastobj
                Set bstackstr.lastobj = Nothing
                GoTo contStrArr
         ElseIf Typename(pppp.item(w2)) = myArray Then
           Set pppp = pppp.item(w2)
          
                    GoTo contStrArr
        ElseIf Typename(pppp.item(w2)) = "Group" Then
        IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", q$, a$, w2) = 1
                            r$ = bstackstr.LastValue
                            Exit Function
                    
        End If
    ElseIf Typename(pppp.item(w2)) = "Group" Then
    IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", q$, "", w2) = 1
                        r$ = bstackstr.LastValue
                        Exit Function
    ElseIf MyIsObject(pppp.item(w2)) Then
            p = rValue(bstackstr, pppp.item(w2))
    If bstackstr.lastobj Is Nothing Then
    If TypeOf pppp.item(w2) Is Document Then
    r$ = pppp.item(w2)
    Else
    On Error Resume Next
        r$ = pppp.item(w2)
        If Err > 0 Then
        Err.Clear
            r$ = CStr(pppp.item(w2).Value)
            If Err Then
            MyEr "Can't fing value in this object", "Δεν μπορώ να βρω τιμή σε αυτό το αντικείμενο"
            IsStr1 = False
                        Exit Function
            End If
        End If
    End If
    End If
            IsStr1 = True
                        Exit Function
    Else
    r$ = pppp.item(w2)
    End If
    Else
    
    
                r$ = pppp.item(w2)
                End If
            IsStr1 = True
        Exit Function
        Else
contrightstrpar:
        If Typename(pppp.GroupRef) = "mHandler" Then
            If pppp.GroupRef.t1 <> 1 Then
            If pppp.GroupRef.t1 = 3 Then
            Set pppp = pppp.GroupRef.objref
            GoTo contStrArr
            Else
                SyntaxError
                IsStr1 = False
                Exit Function
                End If
            End If
            ' only for Inventory
            
            If Not TypeOf pppp.GroupRef.objref Is FastCollection Then
            Set pppp.GroupRef = pppp.GroupRef.objref
            GoTo contrightstrpar
            End If
            With pppp.GroupRef.objref
               If IsExp(bstackstr, a$, p) Then
               If FastSymbol(a$, "!") Then
                 If Abs(p) < .count Then
                 If p < 0 Then
                   .index = .count + MyRound(p)
                 Else
                   .index = MyRound(p)
                   End If
                   Else
               
                   MyErMacroStr a$, "Index out of limits", "Δείκτης εκτός ορίων"
                   IsStr1 = False
                   Exit Function
                   End If
               Else
                   .Find p
                   End If
               ElseIf IsStrExp(bstackstr, a$, r$) Then
                   .Find r$
               End If
               If .Done Then
               If .IsObj Then
               If TypeOf .ValueObj Is lambda Then
               'w2 = -.index - 1
               
               
               If FastSymbol(a$, ")(", , 2) Then
               Set anything = .ValueObj
               GoTo contlambdastr
               Else
               Set bstackstr.lastobj = .ValueObj
               End If
               ElseIf TypeOf .ValueObj Is mArray Then
               Set pppp = .ValueObj
                If FastSymbol(a$, ")(", , 2) Then GoTo contStrArr
               ElseIf TypeOf .ValueObj Is mHandler Then
                           Set pppp.GroupRef = .ValueObj
               If FastSymbol(a$, ")(", , 2) Then GoTo contStrArr
               ElseIf TypeOf .ValueObj Is Document Then
               r$ = .ValueObj.textDoc
               ElseIf TypeOf .ValueObj Is Group Then
                Set anything = pppp.GroupRef.objref
                dd = anything.index
               Set pppp = New mArray: pppp.PushDim (1): pppp.PushEnd: pppp.Arr = True
               Set pppp.item(0) = .ValueObj
              w2 = 0
               IsStr1 = IsStr1 And FastSymbol(a$, ")")
               'r$ = bstackstr.GroupName
               'bstackstr.GroupName = VbNullString
                IsStr1 = SpeedGroup(bstackstr, pppp, "VAL$", q$, a$, w2) = 1
                'bstackstr.GroupName = r$
                        r$ = bstackstr.LastValue
                       anything.index = dd
                        Set .ValueObj = pppp.item(0)
                        Set pppp.item(0) = Nothing
                        Exit Function
                ElseIf TypeOf .ValueObj Is PropReference Then
               ' r$ = VbNullString
               .ValueObj.index = p
               r$ = .ValueObj.Value
               
                 IsStr1 = IsStr1 And FastSymbol(a$, ")")
               Else
               MyErMacroStr a$, "This kind of object not supported", "Αυτού του είδους το αντικείμενο δεν υποστηρίζεται"
               End If
               Else
               Call .ValueType(2, p, r$)
                                  
                                     
            '   r$ = .Value
               End If
               Else
               MyErMacroStr a$, "Key Not Found", "Δεν βρέθηκε το κλειδί"
               End If
            End With
        ElseIf Typename(pppp.GroupRef) = "Group" Then
          If Len(q$) > Len(pppp.GroupRef.GroupName) Then
        
         q1$ = Left$(q$, Len(q$) - 2) + "." + ChrW(&H1FFF) + "$()"
    Else
       q1$ = pppp.GroupRef.GroupName + ChrW(&H1FFF) + "$()"
    End If
               
                             If GetSub(q1$, w1) Then
                                Set nbstack = New basetask
                                nbstack.reflimit = varhash.count
                                Set nbstack.Parent = bstackstr
                                If bstackstr.IamThread Then Set nbstack.Process = bstackstr.Process
                                Set nbstack.Owner = bstackstr.Owner
                                nbstack.OriginalCode = w1
                                nbstack.UseGroupname = sbf(w1).sbgroup
                                If GoFunc(nbstack, q1$, a$, r$) Then
                                    If Not nbstack.StaticCollection Is Nothing Then
                                        bstackstr.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                                    End If
                                    'Set bstackstr.lastobj = nBstack.lastobj
                                    Set nbstack = Nothing
                                    IsStr1 = True
                                
                                Else
                                    IsStr1 = False
                                End If
                            Else
                                InternalEror
                                IsStr1 = False
                            End If
        
            Exit Function
        Else
contreadprop:
            If IsExp(bstackstr, a$, p) Then
                pppp.GroupRef.index = p
                r$ = pppp.GroupRef.Value
            ElseIf IsStrExp(bstackstr, a$, r$) Then
                pppp.GroupRef.index = r$
                r$ = pppp.GroupRef.Value
            ElseIf Typename(pppp.GroupRef) = "PropReference" Then
                Set bstackstr.lastobj = pppp '.GroupRef
                r$ = vbNullString
            End If
        End If
          IsStr1 = FastSymbol(a$, ")")
        Exit Function
        
        End If
            Else  '......
            
skiperrorStr:
            If Right$(q1$, 1) = ")" Then
            If here$ Like "*." + q1$ Then
            subHash.ItemCreator q1$, bstackstr.OriginalCode, True
            
 GoTo contStrFun
        ElseIf q1$ = "LAMBDA$()" Then
            If bstackstr.IamLambda Then
             q1$ = bstackstr.FuncRec
             Else
                q1$ = Mid$(here$, rinstr(here$, "].") + 2)
                If Right$(here$, 2) = "()" And bstackstr.UseGroupname = vbNullString Then

            q1$ = sbf(bstackstr.OriginalCode).goodname
            w1& = bstackstr.OriginalCode
           ElseIf Not GetSub(q1$, w1&) Then
                If here$ Like "*." + q1$ Then
                subHash.ItemCreator q1$, bstackstr.OriginalCode, True
                Else
                GoTo skiperrorStr
                End If
                End If
             End If
             GoTo contStrFun
        ElseIf q1$ = "ΛΑΜΔΑ$()" Then
            If bstackstr.IamLambda Then
             q1$ = bstackstr.FuncRec
             Else
             q1$ = Mid$(here$, rinstr(here$, "].") + 2)
                    If Right$(here$, 2) = "()" And bstackstr.UseGroupname = vbNullString Then

            q1$ = sbf(bstackstr.OriginalCode).goodname
            w1& = bstackstr.OriginalCode
           ElseIf Not GetSub(q1$, w1&) Then
                    If here$ Like "*." + q1$ Then
                    subHash.ItemCreator q1$, bstackstr.OriginalCode, True
                    Else
                    GoTo skiperrorStr
                    End If
                    End If
             End If
             GoTo contStrFun
        End If
End If

         If FindNameForGroup(bstackstr, q$) Then
 MyErMacroStr a$, "unknown method/array  " & q$, "’γνωστη μέθοδος/πίνακας " & q$
 Else
     MyErMacroStr a$, "unknown function/array " & q$, "’γνωστη συνάρτηση/πίνακας " & q$

End If
    Exit Function
    End If
            
    
End Select
If a$ = vbNullString Then IsStr1 = False: Exit Function


IsStr1 = True

End Function


Function ISSTRINGA(bb$, r$) As Boolean
'
Dim q$, w As Long, a$
a$ = NLtrim$(bb$)
r$ = vbNullString
If a$ = vbNullString Then Exit Function
Select Case AscW(a$)
Case 1
q$ = Chr(1)
Case 2
r$ = Mid$(a$, 2, 8)
r$ = Mid$(a$, 10, UNPACKLNG(r$))
bb$ = Mid$(a$, Len(r$) + 10)
ISSTRINGA = True
Exit Function
Case 34
q$ = Chr(34)
End Select
If q$ = vbNullString Or Len(a$) < 2 Then ISSTRINGA = False: Exit Function
If q$ = Chr(34) Then
    w = 1
    Do
    w = w + 1
    w = InStr(w, a$, q$)
    If w > 0 Then
    If Mid$(a$, w - 1, 1) <> "\" Then Exit Do
    ElseIf w = 0 Then
    Exit Do
    End If
    Loop

Else
w = InStr(2, a$, q$, vbBinaryCompare)
End If
If w = 0 Then ISSTRINGA = False: Exit Function
r$ = Mid$(a$, 2, w - 2)
bb$ = NLtrim$(Mid$(a$, w + 1))

ISSTRINGA = True

End Function
Function IsOperator(a$, c$, Optional cl As Long = 1) As Boolean
If Len(a$) > 0 Then
If Left$(a$, cl) = c$ Then
    a$ = NLtrim$(Mid$(a$, cl + 1))
    IsOperator = True
End If
End If
End Function
Function IsOperator0(a$, c$, Optional cl As Long = 1) As Boolean
Dim n$
If Len(a) > 0 Then
If Left$(a$, cl) = c$ Then  ' no letters in operator so no UCASE
' check next character
n$ = Left$(Mid$(a$, cl + 1, 1) & " ", 1)
    If Not InStr(novalidstr, n$) > 0 Then
    
    a$ = NLtrim$(Mid$(a$, cl + 1))
    IsOperator0 = True
    End If
End If
End If
End Function
Function IsOperatorNoRemove(a$, c$, Optional cl As Long = 1) As Boolean
Dim n$
If Len(a) > 0 Then
If Left$(a$, cl) = c$ Then  ' no letters in operator so no UCASE
' check next character
n$ = Left$(Mid$(a$, cl + 1, 1) & " ", 1)
    If Not InStr(novalidstr, n$) > 0 Then
    
    
    IsOperatorNoRemove = True
    End If
End If
End If
End Function
Function codeW(a$) As Long
If a$ <> "" Then
If AscW(a$) < 128 Then codeW = 1
End If
End Function
Function placeme$(gre$, Eng$, code As Long)
If code = 1 Then placeme$ = Eng$ Else placeme$ = gre$
End Function

Function IsSymbol(a$, c$, Optional l As Long = 1, Optional mis As Boolean = False) As Boolean
Dim i As Long, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i <= j Then

If myUcase(Mid$(a$, i, l)) = c$ Then
a$ = NLtrim$(Mid$(a$, l + i))
IsSymbol = True

 Else
 If mis Then
 MyEr "missing " & c$, "λείπει " & c$
 ElseIf i > 1 Then
 a$ = Mid$(a$, i)
 End If
IsSymbol = False
End If
Else
 If mis Then
 MyEr "missing " & c$, "λείπει " & c$
 Else
 a$ = vbNullString
 End If
IsSymbol = False
End If
End Function

Function IsSymbolBracket(a$) As Boolean
Dim i As Long, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then Exit Function
If Mid$(a$, i, 1) = "{" Then
a$ = Mid$(a$, i + 1)
IsSymbolBracket = True
End If
End Function


Function IsSymbol3(a$, c$, Optional mis As Boolean = False, Optional l As Long = 1) As Boolean
' SAME AS FASTSYMB WITHOUT
Dim i As Long, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then Exit Function
If j - i >= l - 1 Then
If InStr(c$, Mid$(a$, i, l)) > 0 Then
a$ = Mid$(a$, i + l)
IsSymbol3 = True
ElseIf mis Then
MyEr "missing " & c$, "λείπει " & c$
End If
End If
End Function
'
Function Fast2NoSpace(a$, c$, cl As Long, d$, dl As Long, ahead&) As Boolean
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
Pad$ = myUcase(Left$(a$, ahead&))
If c$ = Left$(Pad$, cl) Then
a$ = Mid$(a$, MyTrimLi(a$, cl + 1))
Fast2NoSpace = True
Exit Function
End If
If d$ = Left$(Pad$, dl) Then
a$ = Mid$(a$, MyTrimLi(a$, dl + 1))
Fast2NoSpace = True
End If
End Function
Function Fast3NoSpace(a$, c$, cl As Long, d$, dl As Long, e$, el As Long, ahead&) As Boolean
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
Pad$ = myUcase(Left$(a$, ahead&))
If c$ = Left$(Pad$, cl) Then
a$ = Mid$(a$, MyTrimLi(a$, cl + 1))
Fast3NoSpace = True
Exit Function
End If
If d$ = Left$(Pad$, dl) Then
a$ = Mid$(a$, MyTrimLi(a$, dl + 1))
Fast3NoSpace = True
Exit Function
End If
If e$ = Left$(Pad$, el) Then
a$ = Mid$(a$, MyTrimLi(a$, el + 1))
Fast3NoSpace = True
End If

End Function
Function Fast3Label(a$, c$, cl As Long, d$, dl As Long, e$, el As Long, ahead&) As Boolean
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then Exit Function
Pad$ = myUcase(Mid$(a$, i, ahead&)) + " "
If j - i >= cl - 1 Then
If InStr(c$, Left$(Pad$, cl)) > 0 Then
If Mid$(Pad$, cl + 1, 1) Like "[0-9+.\( @-]" Then
a$ = Mid$(a$, MyTrimLi(a$, i + cl))
Fast3Label = True
End If
Exit Function
End If
End If
If j - i >= dl - 1 Then
If InStr(d$, Left$(Pad$, dl)) > 0 Then
If Mid$(Pad$, dl + 1, 1) Like "[0-9+.\( @-]" Then
a$ = Mid$(a$, MyTrimLi(a$, i + dl))
Fast3Label = True
End If
Exit Function
End If
End If
If j - i >= el - 1 Then
If InStr(e$, Left$(Pad$, el)) > 0 Then
If Mid$(Pad$, el + 1, 1) Like "[0-9+.\( @-]" Then
a$ = Mid$(a$, MyTrimLi(a$, i + el))
Fast3Label = True
End If
End If
End If
End Function
Function Fast2VarNoTrim(a$, c$, cl As Long, d$, dl As Long, ahead&, pos As Long) As Boolean
' need space
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then Exit Function
Pad$ = myUcase(Mid$(a$, i, ahead&)) + " "
If j - i >= cl - 1 Then
If InStr(c$, Left$(Pad$, cl)) > 0 Then
If Mid$(Pad$, cl + 1, 1) = " " Then
Mid$(a$, i) = Space$(cl)
pos = 1
Fast2VarNoTrim = True
Exit Function
End If
End If
End If
If dl = 0 Then Exit Function
If j - i >= dl - 1 Then
If InStr(d$, Left$(Pad$, dl)) > 0 Then
If Mid$(Pad$, dl + 1, 1) = " " Then
Mid$(a$, i) = Space$(dl)
pos = 2
Fast2VarNoTrim = True
End If
End If
End If
End Function
Function Fast2Varl(a$, c$, cl As Long, d$, dl As Long, ahead&, ByVal F As Long) As Boolean
' use F if dl>0
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then a$ = vbNullString: Exit Function
Pad$ = myUcase(Mid$(a$, i, ahead&))
If F = 2 Then GoTo there
If j - i >= cl - 1 Then
If Left$(Pad$, cl) = c$ Then
a$ = Mid$(a$, MyTrimLi(a$, i + cl))
Fast2Varl = True
Exit Function
End If
End If
If dl = 0 Or F = 1 Then Exit Function
there:
If j - i >= dl - 1 Then
If Left$(Pad$, dl) = d$ Then
a$ = Mid$(a$, MyTrimLi(a$, i + dl))
Fast2Varl = True
End If
End If
End Function
Function Fast2VarSpace(a$, c$, cl As Long, d$, dl As Long, ahead&) As Boolean
' need always space
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then a$ = vbNullString: Exit Function
Pad$ = myUcase(Mid$(a$, i, ahead&))
If j - i >= cl - 1 Then
If Left$(Pad$, cl) = c$ Then
If Mid$(Pad$, cl + 1, 1) = " " Then
a$ = Mid$(a$, MyTrimLi(a$, i + cl))
Fast2VarSpace = True
Exit Function
End If
End If
End If
If dl = 0 Then Exit Function
If j - i >= dl - 1 Then
If Left$(Pad$, dl) = d$ Then
If Mid$(Pad$, dl + 1, 1) = " " Then
a$ = Mid$(a$, MyTrimLi(a$, i + dl))
Fast2VarSpace = True
End If
End If
End If
End Function
Function Fast3Varl(a$, c$, cl As Long, d$, dl As Long, e$, el As Long, ahead&) As Boolean
Dim i As Long, Pad$, j As Long
j = Len(a$)
If j = 0 Then Exit Function
i = MyTrimL(a$)
If i > j Then a$ = vbNullString: Exit Function
Pad$ = myUcase(Mid$(a$, i, ahead&))
If j - i >= cl - 1 Then
If Left$(Pad$, cl) = c$ Then
a$ = Mid$(a$, MyTrimLi(a$, i + cl))
Fast3Varl = True
Exit Function
End If
End If
If dl = 0 Then Exit Function
If j - i >= dl - 1 Then
If Left$(Pad$, dl) = d$ Then
a$ = Mid$(a$, MyTrimLi(a$, i + dl))
Fast3Varl = True
End If
End If
If el = 0 Then Exit Function
If j - i >= el - 1 Then
If Left$(Pad$, el) = d$ Then
a$ = Mid$(a$, MyTrimLi(a$, i + el))
Fast3Varl = True
End If
End If
End Function

Function interpret(bstack As basetask, b$, Optional ByPass As Boolean) As Boolean
Dim di As Object, myobject As Object, i As Long, x1 As Long, ok As Boolean, sp As Variant
Set di = bstack.Owner
Dim prive As basket
'b$ = Trim$(b$)
Dim w$, ww#, LLL As Long, sss As Long, v As Long, p As Variant, ss$, sw$, ohere$
Dim pppp As mArray, i1 As Long, Lang As Long
Dim r1 As Long, r2 As Long
' uink$ = VbNullString
di.FontTransparent = True
ohere$ = here$
If Not ByPass Then here$ = vbNullString
bstack.LoadOnly = ByPass
sss = Len(b$)
Do While Len(b$) <> LLL
If LastErNum <> 0 Then Exit Do
LLL = Len(b$)


If FastSymbol(b$, "{") Then
If Not interpret(bstack, block(b$)) Then interpret = False: here$ = ohere$: GoTo there1
If FastSymbol(b$, "}") Then
sss = Len(b$)
GoTo loopcontinue1
'LLL = Len(b$)


Else
interpret = False: here$ = ohere$: GoTo there1
End If
End If
jumpforCR1:
If FastSymbol(b$, vbCrLf, , 2) Then
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
     ''   UINK$ = VbNullString
        sss = LLL
        End If

While MaybeIsSymbol(b$, "\'")
 SetNextLine b$
    sss = Len(b$)
    LLL = sss
Wend
If FastSymbol(b$, ":") Then
sss = LLL
''UINK$ = VbNullString
End If
If NOEXECUTION Then interpret = False: here$ = ohere$: GoTo there1

If NocharsInLine(b$) Then interpret = True: here$ = ohere$: GoTo there1
If IsSymbol(b$, "@") Then
i1 = IsLabelAnew("", b$, w$, Lang)  '' NO FORM AA@BBB ALLOWED HERE
w$ = "@" + w$
GoTo PROCESSCOMMAND   'IS A COMMAND
Else
i1 = IsLabelAnew("", b$, w$, Lang) '' NO FORM AA@BBB ALLOWED HERE
End If
  If trace And (bstack.Process Is Nothing) And Not bypasstrace Then
  If bstack.IamLambda Then
  If pagio$ = "GREEK" Then
  Form2.label1(0) = "ΛΑΜΔΑ()"
  Else
  Form2.label1(0) = "LAMBDA()"
  End If
  Else
    Form2.label1(0) = here$
    End If
    Form2.label1(1) = w$
    Form2.label1(2) = GetStrUntil(vbCrLf, b$ & vbCrLf, False)
 TestShowSub = vbNullString
 TestShowStart = 0
    Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
    Form1.Show , Form5   'OK
    End If

    If STbyST And bstack.IamChild Then
        STbyST = False
        If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        Do
        If di.Visible Then di.Refresh
        ProcTask2 bstack
        Loop Until STbyST Or STq Or STEXIT Or NOEXECUTION Or myexit(bstack)
            If Not STEXIT Then
        If Not STq Then
        Form2.gList4.ListIndex = 0
        End If
        End If
        STq = False
        If STEXIT Then
        NOEXECUTION = True
        trace = False
        STEXIT = False
        GoTo there1
        End If
    End If
'Sleep 5
   '' SleepWaitNO 5
    If STEXIT Then
    
    trace = False
    STEXIT = False
    GoTo there1
    Else
    
    End If
End If
Select Case i1
Case 1234
GoTo jumpforCR1
Case 2
NoRef2
interpret = False
GoTo there1
Case 1

    If sss = LLL Then
  If comhash.Find2(w$, i, v) Then
  If v <> 0 Then GoTo PROCESSCOMMAND
  End If
    ss$ = vbNullString
    If MaybeIsSymbol(b$, "/*-+=~^|<>") Then
        If FastOperator(b$, "<=", i, 2, False) Then
        ' LOOK GLOBAL
        If GetVar(bstack, w$, v, True) Then
        w$ = varhash.lastkey
            Mid$(b$, i, 2) = "  "
            
            GoTo assignvalue
        ElseIf GetlocalVar(w$, v) Then
            w$ = varhash.lastkey
            Mid$(b$, i, 2) = "  "
            GoTo assignvalue
        Else
            ' NO SUCH VARIABLE
            interpret = False
            GoTo there1
        End If
        ' do something here
        ElseIf varhash.Find(myUcase(w$), v) Then
        ' CHECK VAR
            If FastOperator(b$, "=", i) Then
assignvalue:
                If MyIsNumeric(var(v)) Then
assignvalue2:
                    If IsExp(bstack, b$, p) Then
assignvalue3:
                        If bstack.lastobj Is Nothing Then
                        If VarType(var(v)) = vbLong Then
                        On Error Resume Next
                            var(v) = CLng(Int(p))
                            If Err.Number > 0 Then OverflowLong: interpret = 0: GoTo there1
                            On Error GoTo 0
                        Else
                            var(v) = p
                        End If
                        Else
checkobject:
                        Set myobject = bstack.lastobj
                            If TypeOf bstack.lastobj Is Group Then ' oh is a group
                                Set bstack.lastobj = Nothing
                                UnFloatGroup bstack, w$, v, myobject, True ' global??
                                Set myobject = Nothing
                            ElseIf CheckIsmArray(myobject) Then
                                    Set var(v) = New mHandler
                                    var(v).t1 = 3
                                    Set var(v).objref = myobject
                                    If TypeOf bstack.lastobj Is mHandler Then
                                    With bstack.lastobj
                                        If .UseIterator Then
                                            var(v).UseIterator = True
                                            var(v).index_start = .index_start
                                            var(v).index_End = .index_End
                                            var(v).index_cursor = .index_cursor
                                        End If
                                        End With
                                    End If
                            ElseIf TypeOf myobject Is mHandler Then
                                
                                If myobject.indirect > -1 Then
                                    Set var(v) = var(myobject.indirect)
                                Else
                                    Set var(v) = myobject
                                End If
                                 With bstack.lastobj
                                        If .UseIterator Then
                                            var(v).UseIterator = True
                                            var(v).index_start = .index_start
                                            var(v).index_End = .index_End
                                            var(v).index_cursor = .index_cursor
                                        End If
                                    End With
                                
                                
                                Set bstack.lastobj = Nothing
                            ElseIf TypeOf myobject Is lambda Then
                                
                                        GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                   Set var(v) = myobject
                                Set bstack.lastobj = Nothing
                            ElseIf TypeOf myobject Is mEvent Then
                             Set var(v) = myobject
                            CopyEvent var(v), bstack
                            Set var(v) = bstack.lastobj
                            ElseIf TypeOf myobject Is VarItem Then
                                
                                var(v) = myobject.ItemVariant
                            Else
                                Set myobject = Nothing
                                Set bstack.lastobj = Nothing
                                If VarType(var(v)) = vbLong Then
                                    NoObjectpAssignTolong
                                Else
                                    NoObjectAssign
                                End If
                                interpret = False: GoTo there1
                            End If
                            Set bstack.lastobj = Nothing
                            Set myobject = Nothing
                        End If
                    ElseIf IsStrExp(bstack, b$, ss$) Then
                    If bstack.lastobj Is Nothing Then
                    If ss$ = vbNullString Then
                    var(v) = 0#
                    Else
                    If IsNumberCheck(ss$, p) Then
                    var(v) = p
                    End If
                    End If
                    Else
                    GoTo checkobject
                    End If
                    Else
                    ' if is string then what???
                    If Typename(bstack.lastobj) = "mHandler" Then
                    GoTo checkobject
                    End If
                        NoValueForVar w$
                        interpret = False
                        GoTo there1
                    End If
                    GoTo loopcontinue1
                    
                Else
                If Not MyIsObject(var(v)) Then
                
                If IsStrExp(bstack, b$, ss$) Then
                If ss$ = vbNullString Then
                    var(v) = CDbl(0)
                Else
                 If IsNumberCheck(ss$, p) Then
                    var(v) = p
                    End If
                End If
                GoTo loopcontinue1
                Else
                    MyEr "Expected String expression", "Περίμενα έκφραση Αλφαριθμητική"
                    
                    Exit Function
                End If
                    ElseIf var(v) Is Nothing Then
                        AssigntoNothing  ' Use Declare
                        interpret = False
                        GoTo there1
                    ElseIf TypeOf var(v) Is Group Then
                        If IsExp(bstack, b$, p) Then
                        
                            'If Not TypeOf var(v) Is Group Then
                            'GoTo assignvalue3
                            'Else
                            If var(v).HasSet Then
                                If bstack.lastobj Is Nothing Then
                                    bstack.soros.PushVal p
                                Else
                                    bstack.soros.PushObj bstack.lastobj
                                    Set bstack.lastobj = Nothing
                                End If
                                NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ":=()", ok
                            ElseIf bstack.lastobj Is Nothing Then
                                NeedAGroupInRightExpression
                                interpret = False
                                GoTo there1
                            ElseIf TypeOf bstack.lastobj Is Group Then
                                Set myobject = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                ss$ = bstack.GroupName
                                If var(v).HasValue Or var(v).HasSet Then
                                    PropCantChange
                                    interpret = 0
                                    GoTo there1
                                Else
                                If Len(var(v).GroupName) > Len(w$) Then
                                ' here$ is ""
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
                                Else
                                    bstack.GroupName = Left$(w$, Len(w$) - Len(var(v).GroupName) + 1)
                                    If Len(var(v).GroupName) > 0 Then
                                        w$ = Left$(var(v).GroupName, Len(var(v).GroupName) - 1)
                                        UnFloatGroupReWriteVars bstack, w$, v, myobject
                                    Else
                                        GroupWrongUse
                                        interpret = 0
                                        GoTo there1
                                    End If
                                End If
                                End If
                                Set myobject = Nothing
                                bstack.GroupName = ss$
                            Else
                                WrongObject
                                interpret = False
                                GoTo there1
                            End If
                            GoTo loopcontinue1
                        Else
noexpression:
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                            MissNumExpr
                            interpret = False
                            GoTo there1
                        End If
                    ElseIf TypeOf var(v) Is PropReference Then
                    If IsExp(bstack, b$, p) Then
                                If FastSymbol(b$, "@") Then
                                    If IsExp(bstack, b$, sp) Then
                                        var(v).index = p: sp = 0
                                    ElseIf IsStrExp(bstack, b$, ss$) Then
                                        var(v).index = ss$: ss$ = vbNullString
                                    End If
                                    var(v).UseIndex = True
                                End If
                            var(v).Value = p
                    
                    Else
                    GoTo noexpression
                    End If
                    GoTo loopcontinue1
                    ElseIf TypeOf var(v) Is Constant Then
                    CantAssignValue
                    interpret = False
                    GoTo there1
                    ElseIf TypeOf var(v) Is lambda Then
                        ' exist and take something else
                        If IsExp(bstack, b$, p) Then
                            If bstack.lastobj Is Nothing Then
                                Expected "lambda", "λάμδα"
                            ElseIf TypeOf bstack.lastobj Is lambda Then
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                GoTo loopcontinue1
                            Else
                                Expected "lambda", "λάμδα"
                            End If
                            interpret = False
                            GoTo there1

                        Else
                            MissNumExpr
                            interpret = False
                            GoTo there1
                        End If
                    ElseIf TypeOf var(v) Is mHandler Then  ' CHECK IF IT IS A HANDLER
                        If IsExp(bstack, b$, p) Then
                            If var(v).ReadOnly Then
                                ReadOnly
                                interpret = False: GoTo there1
                            End If
                            If bstack.lastobj Is Nothing Then
                                MissingObjReturn
                                interpret = False: GoTo there1
                            ElseIf Typename(bstack.lastobj) = "mHandler" Then
                                Set myobject = New mHandler
                                bstack.lastobj.CopyTo myobject
                                If bstack.lastobj.indirect > -0 Then
                                CheckDeepAny myobject
                                bstack.lastobj.indirect = -1
                                Set bstack.lastobj.objref = myobject
                                Set var(v) = bstack.lastobj
                                Set myobject = New mHandler
                                bstack.lastobj.CopyTo myobject
                                
                                End If
                                Set var(v) = myobject
                            ElseIf Typename(bstack.lastobj) = myArray Then
                                Set myobject = New mHandler
                                myobject.t1 = 3
                                Set myobject.objref = bstack.lastobj
                                Set var(v) = myobject
                                
                            Else
                                
                                Set myobject = var(v)
                                myobject.t1 = 0
                                Set myobject.objref = bstack.lastobj
                                
                            End If
                            Set myobject = Nothing
                        Else
                            MissNumExpr
                            interpret = False
                            GoTo there1
                        End If
                        Set bstack.lastobj = Nothing
                        Set myobject = Nothing
                    ElseIf TypeOf var(v) Is mEvent Then
                      If IsExp(bstack, b$, p) Then
                            Set var(v) = bstack.lastobj
                            CopyEvent var(v), bstack
                            Set var(v) = bstack.lastobj
                            Set bstack.lastobj = Nothing
                        Else
                            MissNumExpr
                            interpret = 0
                            GoTo there1
                        End If
                    Else
                        i = 1
                        GoTo somethingelse
                    End If
                End If
            Else
                ' or do something else
                
somethingelse:
                If InStr("/*-+=~^&|<>", Mid$(b$, i, 1)) > 0 Then
                    If InStr("/*-+=~^&|<>!", Mid$(b$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(b$, i, 2)
                        Mid$(b$, i, 2) = "  "
                    Else
                        ss$ = Mid$(b$, i, 1)
                        Mid$(b$, i, 1) = " "
                    End If
                Else
                    GoTo PROCESSCOMMAND
                End If
                On Error GoTo err123456
                If MyIsNumeric(var(v)) Then
                If VarType(var(v)) = vbLong Then
                On Error GoTo forlong
                Select Case ss$
                    Case "="
                        v = globalvar(w$, CLng(Int(p)), , True)
                        GoTo assignvalue2
                    Case "+="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "-="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(-Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "*="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(Int(p) * var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "/="
                        If IsExp(bstack, b$, p) Then
                            If Int(p) = 0 Then
                                DevZero
                                interpret = False
                                GoTo there1
                            End If
                            var(v) = CLng(var(v) / Int(p))
                        Else
                            GoTo noexpression
                        End If
                    Case "-!"
                        var(v) = CLng(-var(v))
                    Case "++"
                        var(v) = CLng(1 + var(v))
                    Case "--"
                        var(v) = CLng(var(v) - 1)
                    Case "~"
                        var(v) = CLng(-1 - (var(v) <> 0))
                    Case Else
                    GoTo PROCESSCOMMAND
                    
                End Select
                On Error GoTo 0
                
                Else
                Select Case ss$
                    Case "="
                        v = globalvar(w$, p, , True)
                        GoTo assignvalue2
                    Case "+="
                        If IsExp(bstack, b$, p) Then
                            var(v) = p + var(v)
                        Else
                            GoTo noexpression
                        End If
                    Case "-="
                        If IsExp(bstack, b$, p) Then
                            var(v) = -p + var(v)
                        Else
                            GoTo noexpression
                        End If
                    Case "*="
                        If IsExp(bstack, b$, p) Then
                            var(v) = p * var(v)
                        Else
                            GoTo noexpression
                        End If
                    Case "/="
                        If IsExp(bstack, b$, p) Then
                            If p = 0 Then
                                DevZero
                                interpret = False
                                GoTo there1
                            End If
                            var(v) = var(v) / p
                        Else
                            GoTo noexpression
                        End If
                    Case "-!"
                        var(v) = -var(v)
                    Case "++"
                        var(v) = 1 + var(v)
                    Case "--"
                        var(v) = var(v) - 1
                    Case "~"
                     
                         Select Case VarType(var(v))
                        Case vbBoolean
                            var(v) = Not CBool(var(v))
                        Case vbCurrency
                            var(v) = CCur(Not CBool(var(v)))
                        Case vbDecimal
                            var(v) = CDec(Not CBool(var(v)))
                        Case Else
                            var(v) = CDbl(Not CBool(var(v)))
                        End Select
                        
                        
                    Case Else
                    GoTo PROCESSCOMMAND
                End Select
                On Error Resume Next
                var(v) = MyRound(var(v), 13)
                End If
                ElseIf TypeOf var(v) Is Group Then
                    If IsExp(bstack, b$, p) Then
                        If bstack.lastobj Is Nothing Then
                            bstack.soros.PushVal p
                        Else
                            bstack.soros.PushObj bstack.lastobj
                            Set bstack.lastobj = Nothing
                        End If
                    End If
                    NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ss$ + "()", ok
                    If Not ok Then
                        If LastErNum = 0 Then
                            MisOperatror (ss$)
                        End If
                        interpret = False
                        GoTo there1
                    End If
                    
                Else
                    Set myobject = var(v)
                    
                    If CheckIsmArray(myobject) Then
                        If IsExp(bstack, b$, p) Then
                            If Not bstack.lastobj Is Nothing Then
                            If TypeOf bstack.lastobj Is mArray Then
                            Set var(v) = New mHandler
                            var(v).t1 = 3
                            Set var(v).objref = bstack.lastobj
                            Else
                                Set myobject = bstack.lastobj
                                If CheckIsmArray(myobject) Then
                                    Set var(v) = New mHandler
                                    var(v).t1 = 3
                                    Set var(v).objref = myobject
                                Else
                                NotArray
                                interpret = False
                                GoTo there1
                                End If
                                End If
                            Else
                                myobject.Compute2 p, ss$
                            End If
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                        Else
                            myobject.Compute3 ss$
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                        End If
                    ElseIf TypeOf myobject Is mHandler Then
                    If myobject.t1 = 4 Then
                        If myobject.ReadOnly Then
                                ReadOnly
                             interpret = False
                                GoTo there1
                        ElseIf ss$ = "++" Then
                        If myobject.index_start < myobject.objref.count Then
                            myobject.index_start = myobject.index_start + 1
                            myobject.objref.index = myobject.index_start
                            myobject.index_cursor = myobject.objref.Value
                        End If
                        ElseIf ss$ = "--" Then
                    If myobject.index_start > 0 Then
                            myobject.index_start = myobject.index_start - 1
                            myobject.objref.index = myobject.index_start
                            myobject.index_cursor = myobject.objref.Value
                        End If
                        Else
                        NoOperatorForThatObject ss$
                         interpret = False
                            GoTo there1
                        End If
                        End If
                    Else
                    MyEr "Object not support operator " + ss$, "Το αντικείμενο δεν υποστηρίζει το τελεστή " + ss$
                    interpret = False
                    GoTo there1
                    End If
                End If
            End If
            GoTo loopcontinue1
            

        ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
                If FastOperator(b$, "=", i) Then
                
                    If IsExp(bstack, b$, p) Then
checkobject1:
                        Set myobject = bstack.lastobj
                        If CheckIsmArray(myobject) Then
                            Set bstack.lastobj = New mHandler
                            bstack.lastobj.t1 = 3
                            Set bstack.lastobj = myobject
                            bstack.SetVarobJ w$, bstack.lastobj
                        Else
                            bstack.SetVar w$, p
                        End If
                        Set myobject = Nothing
                        Set bstack.lastobj = Nothing
                        GoTo loopcontinue1
                    ElseIf IsStrExp(bstack, b$, ss$) Then
                    If bstack.lastobj Is Nothing Then
                    If ss$ = vbNullString Then
                    p = 0
                    Else
                    p = val(ss$)
                    End If
                    End If
                    GoTo checkobject1
                    
                    Else
                        GoTo aproblem1
                    End If
                Else
                    If InStr("/*-+~", Mid$(b$, i, 1)) > 0 Then
                        If InStr("=+-!", Mid$(b$, i + 1, 1)) > 0 Then
                            ss$ = Mid$(b$, i, 2)
                            Mid$(b$, i, 2) = "  "
                        Else
                            ss$ = Mid$(b$, i, 1)
                            Mid$(b$, i, 1) = " "
                        End If
                    End If
                 If Not bstack.AlterVar(w$, p, ss$, False) Then interpret = False: GoTo there1
                GoTo loopcontinue1
                End If
                
                
            End If
            If FastOperator(b$, "=", i) Then ' MAKE A NEW ONE IF FOUND =
                v = globalvar(w$, p, , True)
                GoTo assignvalue
            ElseIf GetVar(bstack, w$, v, True) Then
                    GoTo somethingelse
            End If
        ElseIf FastOperator(b$, "=", i) Then ' MAKE A NEW ONE IF FOUND =
jumpiflocal:
            v = globalvar(w$, p, , True)
            GoTo assignvalue
        ElseIf GetVar(bstack, w$, v, True) Then
        ' CHECK FOR GLOBAL
            GoTo somethingelse
            Else
        GoTo PROCESSCOMMAND
        End If
        
Else


            
          '**********************************************************
PROCESSCOMMAND:
       
            If Trim(w$) <> "" Then
      
            Select Case w$
        Dim y1 As Long
        Dim x2 As Long, y2 As Long, SBR$, nd&
          Case "CALL", "ΚΑΛΕΣΕ"
        ' CHECK FOR NUMBER...
        If bstack.NoRun Then
            bstack.callx1 = 0
            bstack.callohere = ""
            b$ = NLtrim(b$)
            SetNextLineNL b$
        Else
        NeoCall ObjPtr(bstack), b$, Lang, ok
        If Not ok Then
            interpret = 0
            GoTo there1
        End If
        End If
            Case " ", ChrW(160)
            ' nothing
          '  SSS = Len(B$)
            Case "SLOW", "ΑΡΓΑ"
            extreme = False
            SLOW = True
            interpret = True
            here$ = ohere$
            GoTo there1
            Case "FAST", "ΓΡΗΓΟΡΑ"
            If FastSymbol(b$, "!") Then extreme = True Else extreme = False
            SLOW = False
            interpret = True
            here$ = ohere$
            GoTo there1
            Case "GLOBAL", "ΓΕΝΙΚΟ", "ΓΕΝΙΚΗ", "ΓΕΝΙΚΕΣ", "LOCAL", "ΤΟΠΙΚΑ", "ΤΟΠΙΚΗ", "ΤΟΠΙΚΕΣ"
           b$ = w$ + " " + b$
           interpret = Execute(bstack, b$, True) = 1
           GoTo there1
            
            Case "USER", "ΧΡΗΣΤΗΣ"
      
               ss$ = PurifyPath(GetStrUntil("\", Trim$(GetNextLine(b$) + "\")))
               
                 If ss$ <> "" Then
                    dset
                    
                    userfiles = GetSpecialfolder(CLng(26)) & "\M2000_USER\"
                    
                    If Not isdir(userfiles) Then MkDir userfiles
                
                    
                    ss$ = AddBackslash(userfiles + ss$)
                    
                    If PathMakeDirs(ss$) Or isdir(ss$) Then
                    userfiles = ss$
                    mcd = userfiles
                    original bstack, "CLS"
                    Else

                    PlainBaSket di, players(GetCode(di)), "Bad User Name"
                    End If
                    Else
                    ss$ = UCase(userfiles)
                    DropLeft "\M2000_USER\", ss$
                    If ss$ = vbNullString Then
                    
                    Else
                    
                    PlainBaSket di, players(GetCode(di)), GetStrUntil("\", Tcase(ss$))
                    End If
                    End If
                     interpret = True
            GoTo there1
            Case "TARGET", "ΣΤΟΧΟΣ"
           ' If di.name <> "DIS" And di.name <> "dSprite" Then interpret = False: here$ = OHERE$: goto there1
                If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                    If Not GetVar(bstack, w$, v) Then 'getvar
                     v = globalvar(w$, 0#, , True)
                  ''  x1 = GetVar(bstack, W$, v)
                      End If
                Else
                    interpret = False
                   here$ = ohere$: GoTo there1
                End If
                If Not FastSymbol(b$, ",") Then
                  interpret = False
                  Exit Do
                ElseIf IsStrExp(bstack, b$, ss$) Then  ' COMMAND
                If ss$ = vbNullString Then interpret = False: here$ = ohere$: GoTo there1
                x1 = 1
                y1 = 1
                x2 = -1
                y2 = -1
                nd& = 0
                SBR$ = vbNullString
                On Error GoTo err123456
                  With players(GetCode(di))
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x1 = Abs(p) Mod (.mx + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y1 = Abs(p) Mod (.My + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y2 = CLng(p)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then nd& = Abs(p)
                If FastSymbol(b$, ",") Then If Not IsStrExp(bstack, b$, SBR$) Then interpret = False: here$ = ohere$: GoTo there1
                
               
err123456:
                If Err.Number = 6 Then
                OverflowLong
                interpret = False: here$ = ohere$: GoTo there1
                
                End If
              Targets = False
                ReDim Preserve q(UBound(q()) + 1)
              
                q(UBound(q()) - 1) = BoxTarget(bstack, x1, y1, x2, y2, SBR$, nd&, ss$, .Xt, .Yt, .uMineLineSpace)
                End With
                var(v) = UBound(q()) - 1
                Targets = True
                ElseIf IsExp(bstack, b$, p) Then
                  q(var(v)).Enable = Not (p = 0)
                  RTarget bstack, q(var(v))
                Else
                interpret = False
                here$ = ohere$:             GoTo there1
                End If
                Case "ΔΙΑΚΟΠΤΕΣ", "SWITCHES"
                    If IsStrExp(bstack, b$, ss$) Then
                    Switches ss$, bstack.IamChild Or bstack.IamAnEvent  ' NON LOCAL FROM cli OR using SET SWITCHES
                End If
                Case "MONITOR", "ΕΛΕΓΧΟΣ"
                    If IsSupervisor Then
                    prive = players(GetCode(di))
                    
                    monitor bstack, prive, Lang
                    players(GetCode(di)) = prive
                    Else
                    BadCommand
                    End If
                Case "ΣΕΝΑΡΙΟ", "SCRIPT"
                If IsLabelOnly(b$, ss$) Then
                 If GetSub(myUcase(ss$, True), nd&) Then
                           b$ = vbCrLf + sbf(nd&).sb & b$
                   Else
                   b$ = ss$ + " " + b$
                   If IsStrExp(bstack, b$, w$) Then
                           b$ = vbCrLf + w$ + b$
                   Else
                   ' skip
                   End If
                   End If
                ElseIf IsStrExp(bstack, b$, w$) Then
                           b$ = vbCrLf + w$ + b$
                   End If
Case "RETURN", "ΕΠΙΣΤΡΟΦΗ"
    LastErNum = 0
       If IsExp(bstack, b$, p) Then
                If bstack.lastobj Is Nothing Then
                ElseIf Typename(bstack.lastobj) = "mHandler" Then
                        Select Case bstack.lastobj.t1
                           Case 1
                                  If ChangeValues(bstack, b$) Then GoTo loopcontinue1
                                  
                           Case 2
                                    If ChangeValuesMem(bstack, b$, Lang) Then GoTo loopcontinue1
                           Case 3
                                    If ChangeValuesArray(bstack, b$) Then GoTo loopcontinue1
                           End Select
                End If
            ElseIf IsStrExp(bstack, b$, ss$) Then
                    append_table bstack, ss$, b$, True, Lang
                GoTo loopcontinue1
                 End If
  BadUseofReturn
       interpret = False
       GoTo there1
            Case "CONTINUE", "ΣΥΝΕΧΙΣΕ"
            If HaltLevel > 0 Then
                     If NORUN1 Then NORUN1 = False: interpret = True: b$ = vbNullString: GoTo there1   ' send environment....to hell
                    If bstack.IamChild Or bstack.IamAnEvent Then NERR = True: NOEXECUTION = True
                    ExTarget = True: INK$ = Chr(27): UKEY$ = Chr$(27)  ': UINK$ = Chr(27)    ' send escape...for any good reason...
            Else
            GoTo contnoproper
            End If
            Case "CONST", "ΣΤΑΘΕΡΗ", "ΣΤΑΘΕΡΕΣ"
            ConstNew bstack, b$, w$, True, Lang
                    If LastErNum = -1 Then
                    interpret = False
                    GoTo there1
                    End If
                Case "ΤΕΛΟΣ", "END"

                    If NORUN1 Then NORUN1 = False: interpret = True: b$ = vbNullString: GoTo there1   ' send environment....to hell
                    If bstack.IamChild Or bstack.IamAnEvent Then NERR = True: NOEXECUTION = True
                    ExTarget = True: INK$ = Chr(27): UKEY$ = Chr$(27)  ': UINK$ = Chr(27)    ' send escape...for any good reason...
                Case Else
                    LastErNum = 0 ' LastErNum1 = 0
                    LastErName = vbNullString   ' every command from Query call identifier
                    LastErNameGR = vbNullString  ' interpret is like execute without if for repeat while select structures
                    If comhash.Find2(w$, i, v) Then
                        If v <> 0 Then
                            If v = 32 Then
                                If Not Identifier(bstack, w$, b$, True, Lang) Then
                                    If NOEXECUTION Then
                                            MyEr "", ""
                                            interpret = False
                                    End If
                                    here$ = ohere$: GoTo there1
                              Else
                              If bstack.callx1 > 0 Then
                              If bstack.NoRun Then
                              bstack.callx1 = 0
                              bstack.callohere = ""
                              b$ = NLtrim(b$)
                              SetNextLineNL b$
                              ElseIf Not ProcModuleEntry(bstack, "", 0, b$, Lang) Then
                                    If MOUT And b$ = vbNullString Then
                                    Else
                                        MyErMacro b$, "unknown identifier " & w$, "’γνωστο αναγνωριστικό " & w$
                                    End If
                                End If
                                bstack.RemoveOptionals
                                End If
                              GoTo loopcontinue1
                              End If
                           
                         '' ElseIf v = 2000 Then
                          
                          Else
contnoproper:
                            MyEr "No proper command for command line interpreter", "Δεν είναι η κατάλληλη εντολή για τον διερμηνευτή γραμμής"
                            interpret = False
                          
                            here$ = ohere$: GoTo there1
                          End If
                     End If
                    
                    If i <> 0 Then
                     If Not IsBadCodePtr(i) Then
                        If Not CallByPtr(i, bstack, b$, Lang) Then
                               If NOEXECUTION Then
                                    MyEr "", ""
                                    interpret = False
                                    End If
                                    here$ = ohere$: GoTo there1
                        End If
                        End If
                    Else
                            If Not Identifier(bstack, w$, b$, Not comhash.Find(w$, i1), Lang) Then
                            
                                    If NOEXECUTION Then
                                    MyEr "", ""
                                    interpret = False
                                    End If
                                    here$ = ohere$: GoTo there1
                            End If
                    End If
                    
                    ElseIf Not Identifier(bstack, w$, b$, Not comhash.Find(w$, i1), Lang) Then
                    
                            If NOEXECUTION Then
                            MyEr "", ""
                            interpret = False
                            End If
                            here$ = ohere$: GoTo there1
                            ElseIf bstack.callx1 > 0 Then
                             
                              If bstack.NoRun Then
                              bstack.callx1 = 0
                              bstack.callohere = ""
                              b$ = NLtrim(b$)
                              SetNextLineNL b$
                              ElseIf Not ProcModuleEntry(bstack, "", 0, b$, Lang) Then
                                          If MOUT And b$ = vbNullString Then
                                Else
                                    MyErMacro b$, "unknown identifier " & w$, "’γνωστο αναγνωριστικό " & w$
                                End If
                             End If
                       '''     funcno = funcno - 1
                    End If
                    
                End Select
                End If
            End If
        Else
        If w$ <> "" Then
        b$ = w$ & " " & b$
        If Abs(IsLabel(bstack, b$, w$)) Then
        b$ = w$ & " " & b$
         If FindNameForGroup(bstack, w$) Then
 MyEr "Unknown Property " & w$, "’γνωστη ιδιότητα " & w$
 Else
MyEr "Unknown Variable " & w$, "’γνωστη μεταβλητή " & w$
End If

        
        Else

       SyntaxError
        End If
        b$ = vbNullString
        interpret = False
        GoTo there1
        End If
    End If
Case 3

ss$ = vbNullString
        i = 1
        If Len(b$) > 1 Then
        If InStr("/*-+=~^&|<>", Mid$(b$, i, 1)) > 0 Then
        
                    If InStr("/*-+=~^&|<>!", Mid$(b$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(b$, i, 2)
                        Mid$(b$, i, 2) = "  "
                        If ss$ = "<=" Then ss$ = "g"
                    Else
                        ss$ = Mid$(b$, i, 1)
                        Mid$(b$, i, 1) = " "
                    End If
         End If
       End If

If ss$ <> "" Then
            If ss$ = "=" Then
                If GetVar(bstack, w$, v) Then
                sw$ = ss$
                    If IsStrExp(bstack, b$, ss$) Then
                    If Typename$(bstack.lastobj) = "lambda" Then
                                  GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                               Set var(v) = bstack.lastobj
                                                Set bstack.lastobj = Nothing
                    ElseIf Typename$(var(v)) = "Group" Then
                    
                    If sw$ = "g" Then
                           sw$ = ":="
                           If Not var(v).HasSet Then GroupCantSetValue: interpret = False: GoTo there1
                           End If
                           If bstack.lastobj Is Nothing Then
                                bstack.soros.PushStr ss$
                            Else
                                bstack.soros.PushObj bstack.lastobj
                                Set bstack.lastobj = Nothing
                            End If
                            NeoCall2 ObjPtr(bstack), Left$(w$, Len(w$) - 1) + "." + ChrW(&H1FFF) + sw$ + "()", ok
                    If Not ok Then
                        If LastErNum = 0 Then
                            MisOperatror (ss$)
                        End If
                        interpret = False
                        GoTo there1
                    End If
                    ElseIf TypeOf var(v) Is Constant Then
                    CantAssignValue
                    interpret = False
                    GoTo there1
                    Else
                         
                         If CheckVarOnlyNo(var(v), ss$) Then
                           ExpectedObj Typename(var(v))
                           GoTo there1
                         End If
                        End If
                    Else
aproblem1:
                       NoValueForVar w$
                    Exit Do  '???
                    End If
                ElseIf IsStrExp(bstack, b$, ss$) Then
                    
                                If bstack.lastobj Is Nothing Then
              globalvar w$, ss$, , True
            Else
            If Typename$(bstack.lastobj) = "lambda" Then
                       If Not GetVar(bstack, w$, x1, True) Then x1 = globalvar(w$, p, , True)
                             GlobalSub w$ + "()", "CALL EXTERN " & Str(x1)
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                          Set var(x1) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
            End If
            End If
                ElseIf LastErNum = 0 Then
                                    
                    SyntaxError
                    interpret = False
                    GoTo there1
                    Else
                   Exit Do  '???
                End If
          
            ElseIf ss$ = "+=" Then
                            If GetVar(bstack, w$, v) Then
                                If IsStrExp(bstack, b$, ss$) Then
                                    If MyIsObject(var(v)) Then

                                            NoOperatorForThatObject "+="
                                            
                                            interpret = False
                                            GoTo there1

                                    Else
                                var(v) = CStr(var(v)) + ss$
                                    End If
                                Else
                                    MissStringExpr
                                End If
                            Else
                                ExpectedVariable
                            End If
            Else
            ' one now option
                If GetVar(bstack, w$, v) Then
                        If IsStrExp(bstack, b$, ss$) Then
                             CheckVar var(v), ss$
                        Else
                            NoValueForVar w$
                        Exit Do
                        End If
                Else
                    Nosuchvariable w$
                End If
        End If
End If
          
Case 4
If FastSymbol(b$, "=") Then '................................
           
            If GetVar(bstack, w$, v) Then
                If IsExp(bstack, b$, p) Then
                
                
                If Not bstack.lastobj Is Nothing Then
                        If TypeOf bstack.lastobj Is lambda Then
                        If Typename(var(v)) = "lambda" Then
                                                Set var(v) = bstack.lastobj

                                                Else
                                    GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                               Set var(v) = bstack.lastobj
                                                
                                        End If
                           Set bstack.lastobj = Nothing
                         Else
                       SyntaxError
                        End If
                        ElseIf MyIsObject(var(v)) Then
                        If TypeOf var(v) Is Constant Then
                            CantAssignValue
                            interpret = False
                            GoTo there1
                        Else
                           ExpectedObj Typename(var(v))
                           GoTo there1
                           End If
                        Else
                        var(v) = MyRound(p)
                        End If
                Else
                  MissNumExpr
                Exit Do
                End If
            ElseIf IsExp(bstack, b$, p) Then
             If Not bstack.lastobj Is Nothing Then
                
                If Typename$(bstack.lastobj) = "lambda" Then
                    
                       If Not GetVar(bstack, w$, x1, True) Then x1 = globalvar(w$, p, , True)
                             GlobalSub w$ + "()", "CALL EXTERN " & Str(x1)
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If x1 <> 0 Then
                                        
                                          Set var(x1) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
                                        Else
                                SyntaxError
            End If
            Else
            globalvar w$, p, , True
            End If
                ElseIf LastErNum = 0 Then
                                
                SyntaxError
                interpret = False
                GoTo there1
                Else
               Exit Do
            End If
 Else
    If FastSymbol(b$, "+=", , 2) Then
    ss$ = "+"
    ElseIf FastSymbol(b$, "/=", , 2) Then
    ss$ = "/"
    ElseIf FastSymbol(b$, "-=", , 2) Then
    ss$ = "-"
    ElseIf FastSymbol(b$, "*=", , 2) Then
    ss$ = "*"
    ElseIf IsOperator0(b$, "++", 2) Then
    ss$ = "++"
    ElseIf IsOperator0(b$, "--", 2) Then
    ss$ = "--"
    ElseIf IsOperator0(b$, "-!", 2) Then
    ss$ = "-!"
         ElseIf IsOperator0(b$, "~") Then
        ss$ = "!!"
    ElseIf FastSymbol(b$, "<=", , 2) Then
    ss$ = "="
    End If
        If ss$ = vbNullString Then
                    NoValueForVar w$
                    interpret = False
                     GoTo there1
    End If
    If GetVar(bstack, w$, v) Then
        If Len(ss$) = 1 Then
                    If IsExp(bstack, b$, p) Then
                            On Error Resume Next
                            Select Case ss$
                            Case "="
                            var(v) = MyRound(p)
                                Case "+"
                                var(v) = MyRound(p) + var(v)
                                Case "*"
                                 var(v) = MyRound(MyRound(p) * var(v))
                                Case "-"
                                var(v) = var(v) - MyRound(p)
                                Case "/"
                                If MyRound(p) = 0 Then
                                   interpret = False
                                 GoTo there1
                                End If
                                 var(v) = MyRound(var(v) / MyRound(p))
                                 Case "!"
                                 var(v) = -1 - (var(v) <> 0)
                            End Select
                            If Err.Number = 6 Then
                            interpret = False
                            GoTo there1
                            End If
                If VarType(var(v)) <> vbLong Then var(v) = MyRound(var(v), 13)
                    Else
                                   interpret = False
                                 GoTo there1
                    End If
        Else
        If ss$ = "++" Then
        var(v) = 1 + var(v)
        ElseIf ss$ = "--" Then
        var(v) = var(v) - 1
        ElseIf ss$ = "-!" Then
        var(v) = -var(v)
        Else

                      var(v) = -1 - (var(v) <> 0)
        End If
        End If
    Else
                   interpret = False
        GoTo there1
    End If
End If
Case 5

If neoGetArray(bstack, w$, pppp) Then
againarray22:
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsExp(bstack, b$, p) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    pppp.final = False
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
            interpret = False
            GoTo there1
        End If
        End If
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: GoTo there1
On Error Resume Next
If MaybeIsSymbol(b$, ":+-*/~") Then
With pppp
        If IsOperator0(b$, "++", 2) Then
            .item(v) = .itemnumeric(v) + 1
            GoTo loopcontinue1
        ElseIf IsOperator0(b$, "--", 2) Then
            .item(v) = .itemnumeric(v) - 1
            GoTo loopcontinue1
        ElseIf IsOperator(b$, "+=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
            .item(v) = .itemnumeric(v) + p
        ElseIf IsOperator(b$, "-=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
            .item(v) = .itemnumeric(v) - p
        ElseIf IsOperator(b$, "*=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
            .item(v) = .itemnumeric(v) * p
        ElseIf IsOperator(b$, "/=", 2) Then
            If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
            If p = 0 Then
             DevZero
             Else
             .item(v) = pppp.itemnumeric(v) / p
            End If
        ElseIf IsOperator0(b$, "-!", 2) Then
            .item(v) = -.itemnumeric(v)
            GoTo loopcontinue1
        ElseIf IsOperator0(b$, "~") Then
            Select Case VarType(.itemnumeric(v))
            Case vbBoolean
                .item(v) = Not CBool(.itemnumeric(v))
            Case vbInteger
                .item(v) = CInt(Not CBool(.itemnumeric(v)))
            Case vbLong
                .item(v) = CLng(Not CBool(.itemnumeric(v)))
            Case vbCurrency
                .item(v) = CCur(Not CBool(.itemnumeric(v)))
            Case vbDecimal
                .item(v) = CDec(Not CBool(.itemnumeric(v)))
            Case Else
                .item(v) = CDbl(Not CBool(.itemnumeric(v)))
            End Select
            GoTo loopcontinue1
      ElseIf FastSymbol(b$, ":=", , 2) Then

    If IsExp(bstack, b$, p) Then
        .item(v) = p
    ElseIf IsStrExp(bstack, b$, ss$) Then
      If Not MyIsObject(.item(v)) Then
          .item(v) = ss$
          Else
        CheckVar .item(v), ss$
        
        End If

    Else
        Exit Do
    End If
    If FastSymbol(b$, ",") Then v = v + 1: GoTo contarr1
    GoTo loopcontinue1
        End If
.item(v) = MyRound(.itemnumeric(v), 13)
GoTo loopcontinue1
End With
End If


If IsOperator0(b$, ".") Then

If Typename(pppp.item(v)) = "Group" Then
interpret = SpeedGroup(bstack, pppp, "", w$, b$, v)
GoTo loopcontinue1
End If
ElseIf IsOperator(b$, "(") Then
If Typename(pppp.item(v)) = myArray Then
Set pppp = pppp.item(v)
GoTo againarray22
End If
ElseIf Not FastSymbol(b$, "=") Then
here$ = ohere$: GoTo there1
End If

If Not IsExp(bstack, b$, p) Then here$ = ohere$: GoTo there1

 If Not bstack.lastobj Is Nothing Then
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then

            Set pppp.item(v) = bstack.lastobj
            Set pppp.item(v).LinkRef = myobject
            With pppp.item(v)
                 .HasStrValue = myobject.HasStrValue
                .HasValue = myobject.HasValue
                .HasSet = myobject.HasSet
                .HasParameters = myobject.HasParameters
                .HasParametersSet = myobject.HasParametersSet
                
                Set .SuperClassList = myobject.SuperClassList
                Set .Events = myobject.Events
                .highpriorityoper = myobject.highpriorityoper
                .HasUnary = myobject.HasUnary
            End With
     Else
            If Typename(bstack.lastobj) = "mHandler" Then
                               Set pppp.item(v) = bstack.lastobj
     
            Else
                   If Not bstack.lastobj Is Nothing Then
                          If TypeOf bstack.lastobj Is mArray Then
                                 If bstack.lastobj.Arr Then
                                         Set pppp.item(v) = CopyArray(bstack.lastobj)

                                 Else
  
   
                                            Set pppp.item(v) = bstack.lastobj
                                            If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                                 End If
                          Else
                          
                                  Set pppp.item(v) = bstack.lastobj
                                  If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                          End If
                   Else
                  
                          Set pppp.item(v) = bstack.lastobj
                          If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                   End If
            End If
        End If
     
     Set bstack.lastobj = Nothing
     Else
     If pppp.Arr Then
     pppp.item(v) = p
     ElseIf Typename(pppp.GroupRef) Like "Pro*" Then
    
     pppp.GroupRef.Value = p
     End If
    End If
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then here$ = ohere$: GoTo there1
If Not bstack.lastobj Is Nothing Then
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then
         Set pppp.item(v) = bstack.lastobj
            
            With pppp.item(v)
                 .HasStrValue = myobject.HasStrValue
                .HasValue = myobject.HasValue
                .HasSet = myobject.HasSet
                .HasParameters = myobject.HasParameters
                .HasParametersSet = myobject.HasParametersSet
                 Set .SuperClassList = myobject.SuperClassList
                Set .Events = myobject.Events
                .highpriorityoper = myobject.highpriorityoper
                .HasUnary = myobject.HasUnary
            End With
        
        
     Else
        Set pppp.item(v) = bstack.lastobj
    End If
    Set pppp.item(v).LinkRef = myobject
    Set bstack.lastobj = Nothing
     Else
pppp.item(v) = p
End If
Else
Exit Do
End If
Loop
Else
interpret = False: here$ = ohere$: GoTo there1
End If
Case 6
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, ss$) Then
                If Not bstack.lastobj Is Nothing Then
                If TypeOf bstack.lastobj Is mHandler Then
                If bstack.lastobj.t1 = 3 Then
                If pppp.Arr Then
         
                        bstack.lastobj.objref.CopyArray pppp
                        pppp.final = False
            
                        Else
                        NotArray
                        End If
                        Else
                        NotArray
                        End If
                Else
                    bstack.lastobj.CopyArray pppp
                    End If
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
               interpret = False
            GoTo there1
        End If
        End If
againstrarr22:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: GoTo there1
On Error Resume Next
If Typename(pppp.item(v)) = myArray And pppp.Arr Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againstrarr22
End If
End If
If Not FastSymbol(b$, "=") Then
    If FastSymbol(b$, ":=", , 2) Then
contarr1:
    ss$ = Left$(aheadstatus(b$), 1)
        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: GoTo there1
        Else
        If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
        ss$ = Trim$(Str$(p))
        End If
             If Not MyIsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
          ss$ = Left$(aheadstatus(b$), 1)
                        If ss$ = "S" Then
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: GoTo there1
        Else
        If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
        ss$ = Trim$(Str$(p))
        End If
        
                If Not MyIsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
   
     
        
    Else
    interpret = False: here$ = ohere$: GoTo there1
    End If
Else
        If Not IsStrExp(bstack, b$, ss$) Then interpret = False: here$ = ohere$: GoTo there1
        
        
    If Not MyIsObject(pppp.item(v)) Then
    If pppp.Arr Then
    If bstack.lastobj Is Nothing Then
        pppp.item(v) = ss$
    
    Else
    If Typename(bstack.lastobj) = myArray Then
    If bstack.lastobj.Arr Then
        Set pppp.item(v) = CopyArray(bstack.lastobj)
    Else
         Set pppp.item(v) = bstack.lastobj.GroupRef
    End If
    Else
        Set pppp.item(v) = bstack.lastobj
        End If
        Set bstack.lastobj = Nothing
        End If
        Else
        pppp.GroupRef.Value = ss$
        End If
    Else
        CheckVar pppp.item(v), ss$
    End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
                If Not IsStrExp(bstack, b$, ss$) Then here$ = ohere$: GoTo there1
        
                If Not MyIsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
End If
Else
interpret = 0: here$ = ohere$: GoTo there1
End If
Case 7
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, ss$) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    GoTo loopcontinue1
                End If
            Else
                SyntaxError
            End If
              interpret = False
            GoTo there1
        End If
        End If
againintarr7:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then interpret = False: here$ = ohere$: GoTo there1
On Error Resume Next
If Typename(pppp.item(v)) = myArray And pppp.Arr Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againintarr7
End If
End If
If MaybeIsSymbol(b$, "+-*/~") Then
If IsOperator0(b$, "++", 2) Then
pppp.item(v) = pppp.itemnumeric(v) + 1
ElseIf IsOperator0(b$, "--", 2) Then
pppp.item(v) = pppp.itemnumeric(v) - 1
ElseIf IsOperator(b$, "+=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
pppp.item(v) = pppp.itemnumeric(v) + MyRound(p)
ElseIf IsOperator(b$, "-=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
pppp.item(v) = pppp.itemnumeric(v) - MyRound(p)
ElseIf IsOperator(b$, "*=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
pppp.item(v) = MyRound(pppp.itemnumeric(v) * MyRound(p))
ElseIf IsOperator(b$, "/=", 2) Then
If Not IsExp(bstack, b$, p) Then interpret = False: here$ = ohere$: GoTo there1
If MyRound(p) = 0 Then
 DevZero
 Else
 pppp.item(v) = MyRound(pppp.itemnumeric(v) / MyRound(p))
End If
ElseIf IsOperator0(b$, "-!", 2) Then
pppp.item(v) = -pppp.itemnumeric(v)
ElseIf IsOperator0(b$, "~") Then
        With pppp
        Select Case VarType(.itemnumeric(v))
            Case vbBoolean
                .item(v) = Not CBool(.itemnumeric(v))
            Case vbInteger
                .item(v) = CInt(Not CBool(.itemnumeric(v)))
            Case vbLong
                .item(v) = CLng(Not CBool(.itemnumeric(v)))
            Case vbCurrency
                .item(v) = CCur(Not CBool(.itemnumeric(v)))
            Case vbDecimal
                .item(v) = CDec(Not CBool(.itemnumeric(v)))
            Case Else
                .item(v) = CDbl(Not CBool(.itemnumeric(v)))
        End Select
        End With
End If

GoTo loopcontinue1
End If
If Not FastSymbol(b$, "=") Then here$ = ohere$: GoTo there1
If Not IsExp(bstack, b$, p) Then here$ = ohere$: GoTo there1
If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
                                 If bstack.lastobj.Arr Then
                                         Set pppp.item(v) = CopyArray(bstack.lastobj)

                                 Else
  
   
                                            Set pppp.item(v) = bstack.lastobj
                                            If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                                 End If
                          Else
                          
                                  Set pppp.item(v) = bstack.lastobj
                                  If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                          End If
Else
p = MyRound(p)

If Err.Number > 0 Then interpret = False: here$ = ohere$: GoTo there1
pppp.item(v) = p
End If
Do While FastSymbol(b$, ",")

If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then here$ = ohere$: GoTo there1
pppp.item(v) = MyRound(p)
Else
Exit Do
End If
Loop
Else
interpret = False: here$ = ohere$: GoTo there1
End If
Case Else
If MaybeIsSymbol(b$, ",-+*/_!@()[];<>|~`'\") Then
SyntaxError
End If
End Select
loopcontinue1:
Loop
here$ = ohere$
If LastErNum = -2 Then
sss = CLng(Execute(bstack, b$, True))
b$ = vbNullString
interpret = False

GoTo there1
forlong:
OverflowLong
interpret = False

GoTo there1


ElseIf LastErNum <> -0 Then
b$ = " "
End If
interpret = b$ = vbNullString
there1:
bstack.LoadOnly = False
End Function
Function StaticNew(bstack As basetask, b$, w$, Lang As Long) As Boolean
Dim p As Variant, ii As Long, ss$, aaa As mHandler

If bstack.StaticCollection Is Nothing Then

Set bstack.StaticCollection = New FastCollection
bstack.Parent.SetVarobJ "%_" + bstack.StaticInUse, bstack.StaticCollection
End If
Do
    Select Case IsLabel(bstack, b$, w$)
    Case 1
            If GetlocalVar(w$, ii) Then
        MyEr "Variable exist as local", "Η μεταβλητή υπάρχει ως τοπική"
        StaticNew = False
        Exit Function
        End If
        If Not bstack.ExistVar(w$) Then

            If FastSymbol(b$, "=") Then
                If Not IsExp(bstack, b$, p) Then SyntaxError: Exit Function
                Dim anything As Object
                Set anything = bstack.lastobj
                If CheckIsmArray(anything) Then
                        Set aaa = New mHandler
                        With aaa
                            .t1 = 3
                           Set .objref = anything
                           
                        End With
                  bstack.SetVarobJ w$, aaa
                ElseIf CheckLastHandler(anything) Then
                If anything.t1 = 2 Then
                     
                        'With aaa
                         '   .t1 = anything.t1
                          ' Set .objref = anything.objref
                           
                        'End With
                  bstack.SetVarobJ w$, anything
                  ElseIf anything.t1 = 1 Then
                    Set aaa = New mHandler
                        With aaa
                            .t1 = 1
                           Set .objref = anything
                           
                        End With
                  bstack.SetVarobJ w$, aaa
                ElseIf anything.t1 = 3 Then
                        bstack.SetVarobJ w$, anything

                  Else
                  GoTo conthere
                  
                  End If
                Else
                    bstack.SetVar w$, p
                End If
               
'                bstack.SetVarobJ w$, aaa
            ElseIf IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
    
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If

                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            bstack.SetVar w$, p
           Else
           bstack.SetVar w$, p
            End If
            
            
                Set bstack.lastobj = Nothing
        ElseIf FastSymbol(b$, "=") Then
  ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
        ElseIf Fast2VarNoTrim(b$, "ΩΣ", 2, "AS", 2, 2, ii) Then
         ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
        End If
        StaticNew = True
    Case 3
            If Not bstack.ExistVar(w$) Then
            If FastSymbol(b$, "=") Then If Not IsStrExp(bstack, b$, ss$) Then SyntaxError: Exit Function
                        

            bstack.SetVar w$, ss$
        ElseIf FastSymbol(b$, "=") Then
        ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
    End If
        StaticNew = True
    Case 4
        If Not bstack.ExistVar(w$) Then
            If FastSymbol(b$, "=") Then
            If Not IsExp(bstack, b$, p) Then SyntaxError: Exit Function
            ElseIf IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
    
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        p = 0
                    End If

                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            
            If Typename(p) <> "boolean" Then p = Int(p)
            End If
            bstack.SetVar w$, MyRound(p)
        ElseIf FastSymbol(b$, "=") Then
         ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
        ElseIf Fast2VarNoTrim(b$, "ΩΣ", 2, "AS", 2, 2, ii) Then
         ii = 1
            ss$ = aheadstatus(b$, False, ii)
        b$ = Mid$(b$, ii)
    End If
        StaticNew = True
        
    Case Else
conthere:
        MyErMacro b$, "No static for that type " + w$, "Όχι στατική για αυτό το τύπο " + w$
        Exit Function
    End Select
 Loop Until Not FastSymbol(b$, ",")
End Function
Function ConstNew(bstack As basetask, b$, w$, makeallglobal As Boolean, Lang As Long) As Boolean
Dim p As Variant, ii As Long, ss$, what As Long
    Dim cv As Constant
    Do
    what = IsLabel(bstack, b$, w$)
    Select Case what
    Case 1, 4
        If GetlocalVar(w$, ii) Then
        MyEr "Variable exist as local", "Η μεταβλητή υπάρχει ως τοπική"
        ConstNew = False
        Exit Function
        ElseIf GetVar(bstack, w$, ii, True) And makeallglobal Then
        If bstack.Vars < ii Then
        MyEr "Variable exist as global", "Η μεταβλητή υπάρχει ως γενική"
        ConstNew = False
        
        Exit Function
        End If
        End If
        p = 0
    If IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
    
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then
                    If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    Else
                        missNumber
                        Exit Function
                    End If

                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            If what = 4 Then
            If Typename(p) <> "boolean" Then p = Int(p)
            End If
            GoTo conthere
    ElseIf FastSymbol(b$, "=") Then
                If Not IsExp(bstack, b$, p) Then MissNumExpr: Exit Function
            ElseIf GetVar(bstack, w$, ii, True) Then
                p = var(ii)
            Else
                
                MyEr "No global const found", "Δεν βρέθηκε γενική σταθερή"
            Exit Function
            End If
conthere:
            Set bstack.lastobj = Nothing
            Set cv = New Constant
            If what = 4 Then cv.DefineOnce MyRound(p) Else cv.DefineOnce p
            ii = globalvar(w$, p, , makeallglobal)
            Set var(ii) = cv
            ConstNew = True
    Case 3
        If GetlocalVar(w$, ii) Then
        MyEr "Variable exist as local", "Η μεταβλητή υπάρχει ως τοπική"
        ConstNew = False
        Exit Function
        ElseIf GetVar(bstack, w$, ii, True) And makeallglobal Then
        If bstack.Vars < ii Then
        MyEr "Variable exist as global", "Η μεταβλητή υπάρχει ως γενική"
        ConstNew = False
        
        Exit Function
        End If
        End If
              If FastSymbol(b$, "=") Then
                If Not IsStrExp(bstack, b$, ss$) Then MissStringExpr: Exit Function
            ElseIf GetVar(bstack, w$, ii, True) Then
                ss$ = var(ii)
            Else
                
                MyEr "No global const found", "Δεν βρέθηκε γενική σταθερή"
            Exit Function
            End If
            Set bstack.lastobj = Nothing
            Set cv = New Constant
            cv.DefineOnce ss$
            ii = globalvar(w$, p, , makeallglobal)
            Set var(ii) = cv
            ConstNew = True
    Case Else
        MyErMacro b$, "No constant for that type " + w$, "Όχι σταθερή για αυτό το τύπο " + w$
        Exit Function
    End Select
 Loop Until Not FastSymbol(b$, ",")
End Function

Sub ConnectStatic(bstack As basetask, ByVal what$)
''what$ = "%_" + what$
Dim vvv As Variant, Parent As basetask, parent1 As basetask
Set Parent = bstack.Parent
Do While Not Parent Is Nothing
If Parent.StaticInUse$ = what$ Then

   Set bstack.StaticCollection = Parent.StaticCollection
    bstack.StaticInUse$ = what$
     bstack.OriginalCode = Parent.OriginalCode
    Exit Do
End If
Set Parent = Parent.Parent
Loop
Set Parent = Nothing
End Sub
Function Execute(bstack As basetask, b$, once As Boolean, Optional linebyline As Boolean, Optional loopthis As Boolean = False) As Long
' MsgBox CurrentStackSize()
 checkbreak bstack, b$, once
Dim di As Object, nchr As Integer
Set di = bstack.Owner
Dim myobject As Object
Dim pppp As mArray, bb$, Us$, ec$, i As Long, jump As Boolean, slct As Long, sp As Variant, sw$, ok As Boolean, IFCTRL As Long
If linebyline Then IFCTRL = bstack.IFCTRL: jump = bstack.jump
Dim w$, LLL As Long, sss As Long, v As Long, p As Variant, ss$, lbl As Boolean, st As Variant, bs As basetask
Dim y As Double, sX As Double, VarStat As Boolean, NewStat As Boolean
Dim x1 As Long, y1 As Long, x2 As Long, y2 As Long, SBB$, nd&, Lang As Long, kolpo As Boolean, iscom As Boolean
Dim temphere$

If loopthis Then Execute = 2 Else Execute = 1

sss = Len(b$): lbl = True

Do While Len(b$) <> LLL
        If NOEXECUTION Then
            MyEr "", ""
            k1 = 0
            REFRESHRATE = 40
            SLOW = False
            extreme = False
            If MOUT Then
                        TaskMaster.Dispose
                        NOEXECUTION = False
                        MOUT = False
                        
                        b$ = "@Start : error {}"
                        once = False
                        MyDoEvents0 bstack.Owner
                        MyEr "", ""
                        LLL = 0
                Else
                        myesc b$
                        If once Then
                                    b$ = vbCrLf + b$   ' this cause troubles...
                                    Execute = 0
                        Else
                                    once = True
                                    Execute = 1
                        End If
                        Exit Function
                End If
        End If


If trace Or SLOW Then
WaitShow = 0
refreshGui
If trace And Not bypasstrace Then
''Sleep 10
MyDoEvents0new di   ' change from simple to version 2\ change to mydoevents0


Else
MyDoEvents1 di
End If

End If
again1:
LLL = Len(b$)
i = 0
If MaybeIsSymbol2(b$, a123, i) Then
If Mid$(b$, i, 1) = "=" Then
    ' put in separete funcion
    b$ = Mid$(b$, MyTrimLi(b$, i + 1))
    If (InStr(bstack.OriginalName$, "(") > 1) Then   ' return from a function no error checking
    x1 = 0
    If GetReturnArray(bstack, x1, b$, p, ss$, pppp) Then Execute = 0: Exit Function
        If once Then Exit Function
    End If
    GoTo again1
ElseIf Mid$(b$, i, 1) = "-" Then
If Mid$(b$, i + 1, 1) = ">" Then
' return a group pointer from function
    ' put in separete funcion
    b$ = Mid$(b$, MyTrimLi(b$, i + 2))
    If (InStr(bstack.OriginalName$, "(") > 1) Then
    x1 = 0
    
    If Not GetPointer(bstack, b$) Then Execute = 0: Exit Function
        If bstack.lastpointer Is Nothing Then MissingGroup:   Execute = 0: Exit Function

    Set bstack.FuncObj = bstack.lastpointer
     bstack.FuncValue = CLng(0)
    Set bstack.lastpointer = Nothing
    Set bstack.lastobj = Nothing
        If once Then Exit Function
    End If
    GoTo again1
    Else
    SyntaxError
    Execute = 0
    Exit Function
    End If
Else
b$ = Mid$(b$, MyTrimLi(b$, i + 1))
i = 0
If MaybeIsSymbol2(b$, "}", i) Then
b$ = Mid$(b$, MyTrimLi(b$, i + 1))
sss = Len(b$)
GoTo again1

End If

If executeblock(Execute, bstack, b$, once, kolpo) Then Exit Function
If Execute = 4 Then b$ = "{" + b$: Exit Function
If kolpo Then ec$ = block(b$)
If Execute = 2 And b$ <> "" Then Exit Function

If Not FastSymbol(b$, "}") Then Execute = 0: Exit Function
If NocharsInLine(b$) Then Exit Function

sss = LLL  'basic...
If jump Or IFCTRL = 2 Then
               jump = False
       i = 1
            While FastOperator(b$, vbCrLf, i, 2)
            Wend

If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ.ΑΝ", "ELSE.IF", Lang) Then GoTo contElseIf
If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then GoTo ContElse
If i > 0 Then lbl = True
End If

    
    End If
 
    End If

contVarNew:
If MaybeIsSymbol(b$, "\'") Then
    NewStat = False
    VarStat = False
SetNextLine b$
 sss = Len(b$)
lbl = True
If jump Or IFCTRL = 2 Then
If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ.ΑΝ", "ELSE.IF", Lang) Then GoTo contElseIf
If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then GoTo ContElse
End If

If sss > 0 Then GoTo again1
GoTo jumphere

ElseIf FastSymbol(b$, ":") Then
    NewStat = False
    VarStat = False
 sss = Len(b$)
If sss > 0 Then GoTo again1
GoTo jumphere
End If
jumpforCR:
'if FastSymbol(b$, vbCrLf, , 2) Then
If ReplaceCRLFSPACE(b$) Then
   If Len(b$) = 0 Then GoTo jumphere
    NewStat = False
    VarStat = False
    sss = LLL: lbl = True: jump = False
    If IsNumberLabel(b$, w$) Then
    sss = Len(b$): sss = LLL: lbl = False: jump = False:  If sss = 0 Then sss = 2: b$ = vbCrLf
    End If

Else

    If lbl Then
    If IsNumberLabel(b$, w$) Then
    
    
     If IFCTRL = 2 Then
     
      once = False
                b$ = w$
                Execute = 2
                Exit Function
    Else
    sss = Len(b$): sss = LLL: jump = False: If sss = 0 Then sss = 2: b$ = vbCrLf

    End If
    End If
    End If
 
End If
If VarStat Or NewStat Then


If FastSymbol(b$, ",") Then
sss = LLL: lbl = False: jump = False
ElseIf FastOperator(b$, ":", 1) Then
entry1:
NewStat = False
VarStat = False
GoTo comeforVarstatOrNewStat
ElseIf NocharsInLine(b$) Then
SetNextLine b$
If b$ <> "" Then GoTo again1
Else
PlaceAcommaBefore
Execute = 0
Exit Function
End If
iscom = True
Select Case IsLabelDotSub(temphere$, b$, w$, ss$, Lang, nchr)
Case 1234, 0
VarStat = False
NewStat = False
GoTo contconthere
Case 1
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
End If
GoTo VarOnly
Case 2
NoRef
Execute = 0
Exit Function
Case 3
GoTo contcase3
Case 4
GoTo contcase4
Case 5
GoTo contcase5
Case 6
GoTo contcase6
Case 7
GoTo contcase7
Case Else
GoTo errstat
End Select
ElseIf FastSymbol(b$, ":") Then
comeforVarstatOrNewStat:
If linebyline Then Exit Do
contconthere:
NewStat = False: VarStat = False: sss = LLL: lbl = False: jump = False:  If sss = 0 Then sss = 2: b$ = vbCrLf
End If

again2:
If MaybeIsSymbol(b$, "@") Then w$ = vbNullString: GoTo parsecommand
again3:
x1 = IsLabelDotSub(temphere$, b$, w$, ss$, Lang, nchr)
again4:
Select Case x1
Case 1234
GoTo jumpforCR
Case 2
NoRef2
Execute = 0
Exit Function
Case 1

    If sss = LLL Then
If lbl Then
If IsOperator(b$, ":") Then
''If VarStat Or NewStat Then b$ = w$ + " :" + b$: sss = Len(b$): GoTo again1
    sw$ = GetNextLine(b$)
    If Trim$(sw$) <> "" Then
        If MaybeIsSymbol(sw$, "\'") Then
        LLL = Len(b$): sss = LLL: GoTo again1
    Else
        b$ = ": " + sw$ + vbCrLf + b$
    End If
    Else
    LLL = Len(b$): sss = LLL: GoTo again1
    End If
End If

End If

        If Trim(w$) = vbNullString Then
        Execute = 1
        Exit Function
        End If
      
If trace Then
' PROCEDURE TO LONG...SO THIS IS WHAT I CAN DO...
If Not bypasstrace Then
If Not TraceThis(bstack, di, b$, w$, SBB$) Then Execute = 0: Exit Function
End If
End If
iscom = False
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
iscom = True
lbl = False
GoTo VarOnly
ElseIf Len(temphere$) > 0 Then
iscom = True
lbl = False
VarStat = True
GoTo VarOnly
ElseIf Not NoOptimum Then
contherecom:
      '
      v = 0
    ' If Not comhash.Find(w$, i) Then
If MaybeIsSymbolNoSpace(b$, "[+/*~-]") Then
GoTo VarOnly
'
ElseIf MaybeIsSymbol(b$, "<=_") Then
GoTo VarOnly
ElseIf Not comhash.Find2(w$, i, v) Then
                iscom = True
                lbl = False
                GoTo VarOnly

          ElseIf i <> 0 Then
             If Not IsBadCodePtr(i) Then
             On Error GoTo myerr1
                        If CallByPtr(i, bstack, b$, Lang) Then
                            LLL = 0 ' maybe b$ changed inside the call if LLL=len(b$) then we exit from loop
                            GoTo conthere222
                        Else
myerr1:
If bstack Is Nothing Then Exit Function
                             If LastErNum1 = -1 And bstack.IamThread Then Execute = 1 Else Execute = 0
                             If Err Then GoTo errstat0 Else Exit Function
                         End If
                    On Error GoTo errstat0
               Else
              GoTo parsecommand
               End If
        ElseIf v <> 0 Then
       
                On v GoTo contif, ContElse, contElseIf, contSelect, ContTry, ForCont, contNext, contRefr, contWhile, ContRepeat, ContGoto, contSub, autogosub, ContOn, contLoop, contBreak, ContContinue, ContRestart, ContReturn, ContEnd, ContExit, ContInline, contUpdate, contThread, contAfter, contPart, contStatic, contEvery, contTask, ContScan, contTarg, BypassGlobalComm, BypassComm, contNegLocal, contNegGlobal, makeconst, VarOnly, contCall, contBinary, contHALT
                Execute = 0: Exit Function
                
BypassGlobalComm:
                iscom = True
                GoTo parsecommand
BypassComm:
                If bstack.commnum = 0 Then
                w$ = "@" + w$
                ElseIf bstack.commnum > comhash.index Then
                w$ = "@" + w$
                Else
                iscom = True
                End If
                GoTo parsecommand
             Else
               ' If lbl And MaybeIsSymbol(b$, "<=") Then GoTo varonly
                'If GetlocalVar(w$, nd&) Then GoTo varonly
                'If GetGlobalVar(w$, nd&) Then GoTo varonly
               GoTo parsecommand
             End If

             
End If

        Select Case w$
            Case "HALT", "ΑΛΤ"
contHALT:
                ss$ = here$
              '  here$ = ""
                HaltLevel = HaltLevel + 1
                Form1.MyPrompt "", ">>"
                HaltLevel = HaltLevel - 1
                If HaltLevel < 0 Then
                 b$ = "START"
                Execute = 1
                ok = True
                Exit Do
                Else
                here$ = ss$
                ExTarget = False
                MOUT = False
                End If
            
            Case "TARGET", "ΣΤΟΧΟΣ"
contTarg:
           ' If VarStat Or NewStat Then GoTo errstat
                  targetsMyExec Execute, b$, bb$, v, di, w$, bstack, VarStat, temphere$
                  If Execute = 0 Then Exit Function
          
        Case "SCAN", "ΣΑΡΩΣΕ"
ContScan:
             ClearJoyAll
             PollJoypadk
             
            If GetForegroundWindow <> Form1.hWND Or Not Targets Then
            If IsExp(bstack, b$, p) Then
            End If
            ' removed from rev 18, ver 9.3
            ' RRCOUNTER = 0
            MyDoEvents0 di
            If FKey > 0 Then
                If FK$(FKey) <> "" Then
                If bstack.IamChild And bstack.IamAnEvent And FKey = 13 And lastAboutHTitle <> "" Then
                        abt = True
                        FKey = 0
                        vHelp
                Else
                    ss$ = FK$(FKey)
                FKey = 0
                If Not interpret(basestack1, ss$) Then
                Execute = 0
                Exit Function
                End If
                End If
                End If
                FKey = 0
            End If
            
            Else
                If di.Visible = False Then di.Visible = True
                NoAction = False
                nomore = True
                If IsExp(bstack, b$, p) Then
                y = Timer + p
                x1 = Form1.lockme
                If x1 Then UnHook Form1.hWND
                Form1.lockme = False
                Do
                y1 = BLOCKkey
                 BLOCKkey = True
                MyDoEvents0 Form1
                BLOCKkey = y1
                If exWnd <> 0 Then
                ss$ = MyTitle$(bstack)
          
                
               
                End If
                If FKey > 0 Then
                If FK$(FKey) <> "" Then
                b$ = FK$(FKey) + b$
                FKey = 0
                Exit Do
                End If
                End If
                Loop Until NoAction Or Timer > y Or myexit(bstack) Or bstack.IamThread
                Form1.lockme = x1
                If x1 And GetForegroundWindow = Form1.hWND Then Form1.hookme Form1.TEXT1.glistN

                Else
                Do
                MyDoEvents0 Form1

                If exWnd <> 0 Then
                ss$ = MyTitle$(bstack)
                End If
                If FKey > 0 Then
                If FK$(FKey) <> "" Then
                b$ = FK$(FKey) + b$
                FKey = 0
                Exit Do
                End If
                End If
                Loop Until NoAction Or myexit(bstack)
                End If
                nomore = False
                End If
        Case "REFRESH", "ΑΝΑΝΕΩΣΗ"
contRefr:
        If IsLabelSymbolNew(b$, "ΔΟΚΙΜΗ", "TEST", Lang) Then
        MyDoEvents1 di
        ElseIf IsExp(bstack, b$, p) Then
                With Prefresh(GetCode(di))
                    If p = CDbl(0) Then
                        .k1 = uintnew(timeGetTime + REFRESHRATE)
                    Else
                   REFRESHRATE = uintnew(p)
                    .k1 = 0
                    bstack.RRCOUNTER = 0
                    MyDoEvents1 di
                    
                 End If
                 End With
            Else
                
  
                Prefresh(GetCode(di)).RRCOUNTER = 0
                MyDoEvents0 di
                bstack.RRCOUNTER = 0
            End If
       
                         If exWnd <> 0 Then
                    ss$ = MyTitle$(bstack)
                End If
       
                          If FKey > 0 Then
                    If FK$(FKey) <> "" Then
                    MKEY$ = MKEY$ & FK$(FKey)
                         ''   b$ = vbcrlf + "set " + FK$(FKey) + vbCrLf + b$
                    End If
                End If
                FKey = 0
Case "ΣΤΑΤΙΚΗ", "ΣΤΑΤΙΚΕΣ", "STATIC"
contStatic:
 StaticNew bstack, b$, w$, Lang
Case "ΝΗΜΑ", "THREAD"
contThread:
Us$ = vbNullString
If IsLabelSymbolNewExp(b$, "ΘΕΣΕ", "SET", Lang, Us$) Then
If bstack.Process Is Nothing Then GoTo dothesame
If Not StaticNew(bstack, b$, w$, Lang) Then Execute = 0: Exit Function
ElseIf IsLabelSymbolNewExp(b$, "ΑΥΤΟ", "THIS", Lang, Us$) Then
      If bstack.Process Is Nothing Then
dothesame:
                b$ = vbNullString
                NoThisInThread
                Execute = 0: Exit Function
                once = False
            ElseIf IsLabelSymbolNewExp(b$, "ΣΒΗΣΕ", "ERASE", Lang, Us$) Then
         Set bstack.Process.Process = Nothing

                b$ = vbNullString ' get lost now
            ElseIf IsLabelSymbolNewExp(b$, "ΚΡΑΤΑ", "HOLD", Lang, Us$) Then
                bstack.Process.busy = True
         
            ElseIf IsLabelSymbolNewExp(b$, "ΞΕΚΙΝΑ", "RESTART", Lang, Us$) Then
                bstack.Process.busy = False
                b$ = vbNullString
            ElseIf IsLabelSymbolNewExp(b$, "ΚΑΘΕ", "INTERVAL", Lang, Us$) Then
                                 If IsExp(bstack, b$, p) Then
                                     If p < 2 Then p = 2
                                     
                                     bstack.Process.Interval = p
                                     Else
                                     b$ = vbNullString
                                     MisInterval
                                     Execute = 0: Exit Function
                                End If
               Else
                                    b$ = vbNullString
                                    NoClauseInThread
                                    Execute = 0: Exit Function
            End If
            
   
            Else
                       If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, once, False)
         Exit Do
        End If
            If Not MyThread(bstack, b$, Lang) Then Execute = 0: Exit Function
               If Left$(here$ & "#", 1) = "!" Then here$ = Mid$(here$, 2)
            End If
        Case "LOOP", "ΚΥΚΛΙΚΑ"
contLoop:
    
        If once = True Then Execute = 0: Exit Function
            loopthis = True
            Execute = 2
        If myexit(bstack) Then Execute = 1: b$ = vbNullString: Exit Function
       Case "BREAK", "ΔΙΕΚΟΨΕ"
contBreak:
     
                  b$ = "BREAK"
           once = True
        Execute = 2
        Exit Function
     If myexit(bstack) Then Execute = 1: b$ = vbNullString
       Case "CONTINUE", "ΣΥΝΕΧΙΣΕ"
ContContinue:

           If Execute <> 2 Then
              b$ = "CONTINUE"
           once = True
           Execute = 3
         
           Else
           b$ = vbNullString
           
        End If
                If myexit(bstack) Then Execute = 1: b$ = vbNullString
          Exit Function
       Case "RESTART", "ΞΕΚΙΝΑ"
ContRestart:

         b$ = vbNullString
        
        Execute = 2
       If myexit(bstack) Then Execute = 1
       Exit Function

       Case "RETURN", "ΕΠΙΣΤΡΟΦΗ"
ContReturn:
       LastErNum = 0
       If IsExp(bstack, b$, p) Then
       If bstack.lastobj Is Nothing Then
          BadUseofReturn
       Execute = 0
       Exit Function
       ElseIf Typename(bstack.lastobj) = "mHandler" Then
                     Select Case bstack.lastobj.t1
                     Case 1
                            If ChangeValues(bstack, b$) Then GoTo loopcontinue
                            
                     Case 2
                              If ChangeValuesMem(bstack, b$, Lang) Then GoTo loopcontinue
                     Case 3
                              If ChangeValuesArray(bstack, b$) Then GoTo loopcontinue
                     Case 4
                        NoProperObject
                        Set bstack.lastobj = Nothing
                        Execute = 0
                        Exit Function
                     End Select
       
       End If
       BadUseofReturn
       Execute = 0
       Exit Function
       ElseIf IsStrExp(bstack, b$, ss$) Then
            append_table bstack, ss$, b$, True, Lang
        Else
        If LastErNum <> 0 Then
        
        LLL = Len(b$) - 1
        Else
             If bstack.RetStackTotal = 0 Then
                                                stackproblem
                                                Execute = 0
                                                Exit Function
                                                Else
                                               '
                                               ' If bstack.RetStack.StackItemType(1) = "S" Then
                                                
                                               ' End If
                                                'MyEr "Problem in return stack", "Πρόβλημα στον σωρό επιστροφής"
                                                'b$ = VbNullString
                                                'Execute = 0
                                                'Exit Function
                                                'End If
                                                
            End If
                once = False
                b$ = Chr$(0)
                Execute = 2
                
                Exit Function
                End If
    End If
       Case "END", "ΤΕΛΟΣ"
ContEnd:
    WaitShow = 0
                If IsLabelSymbolNew(b$, "ΡΟΥΤΙΝΑΣ", "SUB", Lang) Then
                once = False
                b$ = Chr$(0)
                Execute = 2
                Exit Function
                ElseIf IsLabelSymbolNew(b$, "ΕΠΙΛΟΓΗΣ", "SELECT", Lang) Then
               NoCommandOrBlock
                Execute = 1
                Exit Function
                Else
                b$ = vbNullString   ' no more syntax error
                Execute = 1
                
            
                 MOUT = True
                
                 'ProcTitle bstack, Chr$(34) + Chr$(34) + ",0", 0
'End If
                Exit Function
                End If
        Case "ΕΞΟΔΟΣ", "EXIT"
         ''\\"SUB", "ΡΟΥΤΙΝΑ"
ContExit:
        Us$ = vbNullString
        If IsLabelSymbolNewExp(b$, "ΡΟΥΤΙΝΑΣ", "SUB", Lang, Us$) Then
        WaitShow = 0
                once = False
                b$ = Chr$(0)
                Execute = 2
                Exit Function
        ElseIf IsLabelSymbolNewExp(b$, "ΓΙΑ", "FOR", Lang, Us$) Then
exitfor:
         once = False
                
            i = Abs(IsLabelOnly(b$, w$))
            If i = 0 Then
                    i = IsNumberLabel(b$, w$)
                    If i = 0 Then
        
                b$ = "NEXT"
                Execute = 2
                    Else
                        b$ = w$
                        Execute = 12
                    End If
            ElseIf i = 1 Then
                b$ = w$
                Execute = 12
               
                 
            Else
        
                b$ = "NEXT"
                Execute = 2
             End If
        
                Exit Function
        ElseIf IsLabelSymbolNewExp(b$, "ΕΚΤΥΠΩΣΗΣ", "PRINTING", Lang, Us$) Then
        If bstack.toprinter Then
                    pnum = 0
                    oprinter.ClearUp
                    Form1.PrinterDocument1.Picture = LoadPicture("")
                    Set bstack.Owner = Form1.DIS
                    bstack.toprinter = False
                    SetNormal bstack.Owner
        
        End If
                    b$ = vbNullString
           once = True
             Else
 If Execute <> 2 Then Execute = 1 Else Execute = 3
            b$ = vbNullString
           once = True
           Exit Function
           End If
           
           
        Case "FOR", "ΓΙΑ"
ForCont:
                  If linebyline Then
                  If AscW(b$) <> 32 Then
                
          b$ = w$ + " " + b$
          Else
          b$ = w$ + b$
          End If
        Execute = Execute(bstack, b$, once, False)
         Exit Do
        End If
        
               If once = True Then Execute = 0: Exit Function
            
               
     If Len(b$) < 129 Then
x1 = Abs(IsLabelBig(bstack, b$, w$, , SBB$, , True))
Else
    ss$ = Left$(b$, 128)
    ok = True
    x1 = Abs(IsLabelBig(bstack, ss$, w$, , SBB$, , ok))
  
     If Len(ss$) > 0 Then
     If ok Then
       b$ = Mid$(b$, 129 - Len(ss$))
       ElseIf Len(ss$) <= 128 Then
        Mid$(b$, 129 - Len(ss$), Len(ss$)) = ss$
        Mid$(b$, 1, 129 - Len(ss$)) = Space$(128 - Len(ss$))
       Else
        b$ = ss$ + Mid$(b$, 129)
       End If
    Else
        x1 = Abs(IsLabelBig(bstack, b$, w$, , SBB$, , True))
    End If
End If
          
againfor948:
        
nd& = x1
        Select Case x1
        Case 1, 4 'FLOATING POINT
        
        If MaybeIsSymbol(b$, "<=") Then
         If FastSymbol(b$, "=") Then
         If bstack.StaticCollection Is Nothing Then GoTo cont10456
         
        If bstack.ExistVar(w$) Then
            x2 = -1
            x1 = nd&
            If IsExp(bstack, b$, p) Then
            
                If nd& = 4 Then p = MyRound(p) Else p = MyRound(p, 28)
                bstack.SetVar w$, p
                GoTo eos
            Else
            Execute = 0
            Exit Function
            End If
            Else
cont10456:
            x1 = Abs(GetlocalVar(w$, x2)) * x1
        End If
         ElseIf FastSymbol(b$, "<=", , 2) Then
  x1 = Abs(GetVar(bstack, w$, x2, True)) * x1
         End If
         If x1 Then
            If VarType(var(x2)) = vbLong Then
            x1 = 8
             If IsExp(bstack, b$, p) Then
             On Error Resume Next
              If x2 < 0 Then
                bstack.SetVar w$, CLng(Int(p))
            Else
               var(x2) = CLng(Int(p))
            End If
          
             If Err.Number = 6 Then
                 Execute = 0
                OverflowLong
                Exit Function
                 End If
             End If
            ElseIf VarType(var(x2)) = vbInteger Then
            x1 = 16
             If IsExp(bstack, b$, p) Then
             On Error Resume Next
              If x2 < 0 Then
                bstack.SetVar w$, CLng(Int(p))
            Else
               var(x2) = CInt(Int(p))
            End If
          
             If Err.Number = 6 Then
                 Execute = 0
                OverflowLong True
                Exit Function
                 End If
             End If
            Else
             If IsExp(bstack, b$, p) Then
             If VarType(var(x2)) <> VarType(p) Then
             Select Case VarType(var(x2))
             Case vbInteger
             p = CInt(p)
             Case vbLong
             p = CLng(p)
             Case vbSingle
             p = CSng(p)
             Case vbCurrency
             p = CCur(p)
             Case vbDecimal
             p = CDec(p)
             End Select
             End If
             If x1 = 1 Then
             var(x2) = MyRound(p, 28)
             Else
             var(x2) = MyRound(p)
             End If
             End If
             End If
            ElseIf IsExp(bstack, b$, p) Then
            If nd& > 1 Then p = MyRound(p)
              x2 = globalvar(w$, p, , VarStat, temphere$)
                x1 = nd&
        Else
        
        Execute = 0
        Exit Function
        End If
eos:
        If IsLabelSymbolNew(b$, "ΕΩΣ", "TO", Lang) Then
        If IsExp(bstack, b$, sp) Then
        If nd& = 4 Then
        sp = MyRound(sp, 0)
        p = MyRound(p)
        ElseIf x1 > 1 Then
        sp = Int(sp)
        p = Int(p)
        ElseIf VarType(p) = vbDouble Then
        sp = MyRound(sp, 13)
        p = MyRound(p, 28)
        End If
            If x1 > 1 Then sp = Round(sp, 0)
            If ForLikeBasic Then
            st = 1
            Else
                st = Sgn(sp - p)
                End If
                
        If IsLabelSymbolNew(b$, "ΑΝΑ", "STEP", Lang) Then
        If VarType(p) = vbSingle Then
            st = CSng(1)
        End If
        If IsExp(bstack, b$, st) Then
          If VarType(p) = vbSingle Then
            st = CSng(st)
          End If
         If x1 > 1 Then
         If x1 >= 8 Then st = Fix(st) Else st = Round(st)
         End If
         If Sgn(sp - p) = 0 Or st = 0 Then
        
         Else
            If ForLikeBasic And Sgn(st) <> Sgn(sp - p) Then
st = 1
sp = p - 1

    Else
         st = Abs(st)
         If sp < p Then
         If Fix(st) = st Then
         If st <> 0 Then sp = sp - ((sp - p) Mod st) \ 2
        
         Else
              sX = Abs(((sp - p) / st))
               If sX = MyRound(sX) Then
                 sp = sp - MyRound(st / 2)
               ElseIf st < 1 Then
         sp = sp - 1 / EXP(18 - (Log(st + Abs(sp - p))) / Log(10))
         Else

         sp = p - Fix(sX) * st - st / 2
         End If
     
         End If
       Else

         If Fix(st) = st Then
         Else
         sX = Abs(((sp - p) / st))
         If sX = MyRound(sX) Then
         
         sp = sp + MyRound(st / 2)
         ElseIf st < 1 Then
         sp = sp + 1 / EXP(18 - (Log(st + Abs(sp - p))) / Log(10))
         Else
         sp = p + Fix(sX) * st + st / 2
         End If
         End If
        End If
       
       
         st = Sgn(sp - p) * st
        End If
         
         End If
     
        
     
        Else
        Execute = 0
        Exit Function
        End If
        End If
        If st = 0 Then sp = p
        If Not FastSymbol(b$, "{") Then
        '' this is the old like Basic For
        sw$ = b$
        ss$ = b$
          sX = p
    y1 = True
      bstack.RetStack.PushVal 0  ' RETURN LENGTH FROM END OF B$
      bstack.RetStack.PushStr w$   ' for check if is the right variable
  nd& = bstack.addlen
   slct = nd&
   If ForLikeBasic Then
   If st > 0 And sp < p Then
   ' exit for
                once = False
                ss$ = "NEXT"
                Execute = 2
                GoTo contbasicfor
   End If
    End If
      GoTo contfor:
        Else
        y1 = False
        ss$ = block(b$) + "}"
        sw$ = ss$
        TraceStore bstack, nd&, b$, 1, slct  ' reusing slct variable
      
        If FastSymbol(b$, "}") Then
        If ForLikeBasic Then
   If st > 0 And sp < p Then
   ss$ = "exit"
   End If
    End If
contfor:
        Execute = 1
        ok = False
        v = Len(b$)
        y2 = 0
If x1 = 1 Then
        Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, once, ok) Then
                    TraceRestore bstack, nd&
                    If Execute <> 1 Then
                   '     If Execute = 0 Then b$ = VbNullString: Exit Function
                   If Execute = 2 Then
                  
                        b$ = ss$
                        Exit Function
                   Else
                            b$ = ss$ + b$: Exit Function
                            End If
                    End If
            Else
                    TraceRestore bstack, nd&
                    If Execute = 2 And ss$ <> "" And Not ok Then
                        If y1 And ss$ = "NEXT" Then
                                    If sX = p Then
contbasicfor:
                                            If Lang Then ss$ = "NEXT " + SBB$ Else ss$ = "ΕΠΌΜΕΝΟ " + SBB$
                                            If search2KIND(b$, ss$, x1, True) Then
                                                          b$ = Mid$(b$, x1 + Len(w$))
                                                          bstack.RetStack.drop 2
                                                          sp = 0
                                                          y1 = 0
                                                          v = -1
                                              
                                                          GoTo again1
                                             ElseIf Not Lang Then ss$ = "ΕΠΟΜΕΝΟ " + SBB$
                                                    If search2KIND(b$, ss$, x1, True) Then
                                                          b$ = Mid$(b$, x1 + Len(w$))
                                                          bstack.RetStack.drop 2
                                                          sp = 0
                                                          y1 = 0
                                                          v = -1
                                                   
                                                          GoTo again1
                                                    Else
                                                            Execute = 0
                                                            CantFind w$
                                                            Exit Function
                                                    End If
                                            End If
                                    End If
                                    Execute = 1: Exit Do
                            End If
                            b$ = ss$
                            Exit Function
                    ElseIf Execute = 12 Then
                    bstack.RetStack.drop 2
                    Execute = 2
                    b$ = ss$
                    Exit Function
                    End If
            End If
        
        If Not (ok Or MOUT) Or Execute = 3 Then
        Execute = 1
        ss$ = sw$
        p = p + st
        Else
        Exit Do
        End If
        If myexit(bstack) Then Execute = 1: Exit Do
        If x2 < 0 Then
        bstack.SetVar w$, MyRound(p, 10)
        Else
        If VarType(var(x2)) <> VarType(p) Then
            
            Select Case VarType(var(x2))
             Case vbInteger
             var(x2) = CInt(MyRound(p))
             Case vbLong
             var(x2) = CLng(MyRound(p))
             Case vbSingle
             var(x2) = CSng(MyRound(p, 10))
             Case vbCurrency
             var(x2) = CCur(MyRound(p, 10))
             Case vbDecimal
             var(x2) = CDec(MyRound(p, 10))
             Case Else
             var(x2) = CDbl(MyRound(p, 10))
             End Select
            
        Else
        var(x2) = MyRound(p, 10)
        End If
        End If
        If st > 0 Then
        If p > sp Then Exit Do
        ElseIf st < 0 Then
        If p < sp Then Exit Do
        Else
        Exit Do
        End If
        Loop
ElseIf x1 > 4 Then
On Error GoTo LONGERR
y2 = p
x1 = sp
sss = st
sp = sss
Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, once, ok) Then
            TraceRestore bstack, nd&
            If Execute <> 1 Then
            
            b$ = ss$ + b$: Exit Function
            End If
            Else
            TraceRestore bstack, nd&
            If Execute = 2 And ss$ <> "" And Not ok Then
            If y1 And ss$ = "NEXT" Then
            If sX = p Then
            If Lang Then ss$ = "NEXT " + SBB$ Else ss$ = "ΕΠΟΜΕΝΟ " + SBB$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sss = sp
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo again1
            ElseIf Not Lang Then ss$ = "ΕΠΌΜΕΝΟ " + SBB$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sss = sp
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo again1
            Else
            Execute = 0
            CantFind w$
            Exit Function
            End If
            End If
            End If
            Execute = 1: Exit Do
            
            End If
            b$ = ss$
            
            Exit Function
            End If
            End If
            
            If Not (ok Or MOUT) Or Execute = 3 Then
            Execute = 1
            ss$ = sw$
            y2 = y2 + sss
        
            Else
            Exit Do
            End If
            If myexit(bstack) Then Execute = 1: Exit Do
            On Error Resume Next
            If VarType(var(x2)) = vbInteger Then
            
            var(x2) = CInt(y2)
            Else
            var(x2) = y2
            End If
            On Error GoTo 0
         If st > 0 Then
            If y2 > x1 Then Exit Do
            ElseIf st < 0 Then
            If y2 < x1 Then Exit Do
            Else
            Exit Do
            End If
            Loop
''On Error Resume Next
sss = sp
Else
Do
            TraceRestore bstack, slct
            If executeblock(Execute, bstack, ss$, once, ok) Then
            TraceRestore bstack, nd&
            If Execute <> 1 Then
            
            b$ = ss$ + b$: Exit Function
            End If
            Else
            TraceRestore bstack, nd&
            If Execute = 2 And ss$ <> "" And Not ok Then
            If y1 And ss$ = "NEXT" Then
            If sX = p Then
            If Lang Then ss$ = "NEXT " + SBB$ Else ss$ = "ΕΠΟΜΕΝΟ " + SBB$
            If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo again1
            ElseIf Not Lang Then ss$ = "ΕΠΌΜΕΝΟ " + SBB$
                        If search2KIND(b$, ss$, x1, True) Then
            b$ = Mid$(b$, x1 + Len(w$))
            bstack.RetStack.drop 2
            sp = 0
            y1 = 0
            v = -1
            '' Set pppp = Nothing
            GoTo again1
            Else
            Execute = 0
            CantFind w$
            Exit Function
            End If
            End If
            End If
            Execute = 1: Exit Do
            
            End If
            b$ = ss$
            
            Exit Function
            End If
            End If
            
            If Not (ok Or MOUT) Or Execute = 3 Then
            Execute = 1
            ss$ = sw$
            p = p + st
            Else
            Exit Do
            End If
            If myexit(bstack) Then Execute = 1: Exit Do
            If x2 < 0 Then
             bstack.SetVar w$, p
            Else
            var(x2) = p
            End If
            If st > 0 Then
            If p > sp Then Exit Do
            ElseIf st < 0 Then
            If p < sp Then Exit Do
            Else
            Exit Do
            End If
            Loop
End If
        
        If Execute = 1 And y1 Then
        bstack.RetStack.drop 1
        b$ = Right$(b$, bstack.RetStack.PopVal)
        ' now NEXT is responsible to get rid the stack (else stack is flushing with bstack)
        End If
        x2 = 0  ' need to erased - because reused
        y2 = 0
        
         If MOUT Then Execute = 0: Exit Function
        ok = True
        End If
        ''' ELSE MAKE AN OTHER FOR NEXT
        
        End If
        End If
        End If
      
        Else
        v = -1
        Set pppp = Nothing
        GoTo startwithgroup


        End If
        Case 5
  
againarraystring:
                    If neoGetArray(bstack, w$, pppp) Then

                            If NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
                             
                                    If Typename$(pppp.item(v)) = "Group" Then
                                    
startwithgroup:

                                      Execute = SpeedGroup(bstack, pppp, "FOR", w$, b$, v)
                                      If Execute = 0 Then
                                      Exit Function
                                      ElseIf Execute <> 1 And b$ <> "" Then
                                     once = False
                                      Exit Function
                                     End If
                                        sss = Len(b$)
                                        GoTo loopagain
                     
                                    End If
                                MissingGroup
                                Else
                                NotExistArray
                            End If
                                Execute = 0
                                Exit Function
                                Else
               ok = False
               If Right$(w$, 2) <> "$(" Then
               w$ = Left$(w$, Len(w$) - 1) + "$("
               GoTo againarraystring
               End If
                    End If
        Case 6
          If neoGetArray(bstack, w$, pppp) Then

                            If NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
                                
                                    If Typename$(pppp.item(v)) = "Group" Then
                                        GoTo startwithgroup
                                    ElseIf pppp.IsStringItem(v) Then
                                    
                                        ec$ = pppp.item(v)
                                        x1 = Abs(IsLabelBig(bstack, ec$, w$, , SBB$, , True))
                                        If Not ec$ = vbNullString Then b$ = ec$ + b$
                                        Set pppp = New mArray
                                        GoTo againfor948
                                        
                                    Else
                                        MissString
                                        Execute = 0
                                Exit Function
                                    End If
                            Else
                                    Execute = 0
                                Exit Function
                            End If
            Else
                NotExistArray
         End If
        End Select
        If Not ok Then
        Execute = 0
        Exit Function
        End If
        Case "NEXT", "ΕΠΟΜΕΝΟ"
contNext:
        If IsLabel(bstack, b$, w$) Then
        If bstack.RetStack.StackItemType(1) = "S" Then
        ss$ = bstack.RetStack.PopStr
        If ss$ <> w$ Then
         bstack.RetStack.PushStr ss$
        MissNext
        Execute = 0
        Exit Function
        Else
            With bstack.RetStack
                .drop 1
                .PushVal Len(b$)
                .PushStr ss$
            End With
         End If
               Exit Function
  
        End If
        Else
              nonext
        Execute = 0
        Exit Function
        End If
        Case "CALL", "ΚΑΛΕΣΕ"
        ' CHECK FOR NUMBER...
contCall:
On Error Resume Next
 Err.Clear
        NeoCall ObjPtr(bstack), b$, Lang, ok
        If Not ok Or Err <> 0 Then
        
        Execute = 0
        Exit Function
        End If
        
        Case "INLINE", "ΕΝΘΕΣΗ"
ContInline:
               If once = True Then Execute = 0: Exit Function
        If IsLabelSymbolNew(b$, "ΚΩΔΙΚΑ", "CODE", Lang) Then
        If IsLabelDot(here$, b$, sw$) = 1 Then
                If GetSub(myUcase(sw$, True), nd&) Then
                
                WaitShow = Len(b$)
                bstack.addlen = 0
                If IsSymbol(b$, ",") Then
                If Lang = 1 Then
                b$ = vbCrLf + "Inline code " + b$
                Else
                b$ = vbCrLf + "Ένθεση Κώδικα " + b$
                End If
                End If
                                b$ = vbCrLf + sbf(nd&).sb & b$
                                
                                 If trace Then TestShowSub = b$
                   sss = Len(b$)
                   GoTo again1
                    ElseIf GetSub(here$ + sw$, nd&) Then
                     WaitShow = Len(b$)
                    
                    b$ = vbCrLf + sbf(nd&).sb & b$
                     If trace Then TestShowSub = b$
                   sss = Len(b$)
                        GoTo again1
                    End If
            Else
            GoTo errstat1
            End If
        Else
        If IsStrExp(bstack, b$, ss$) Then
        WaitShow = Len(b$)
        bstack.addlen = 0
        b$ = vbCrLf + ss$ & b$
     If trace Then TestShowSub = b$
           sss = Len(b$)
                
                GoTo again1
        End If
        End If
        Case "UPDATE", "ΕΠΙΚΑΙΡΟ"
contUpdate:
        If bstack.UseGroupname <> "" Then
        
        b$ = ": set " + Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1) + "=" + Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1) + vbCrLf + b$
             sss = Len(b$)
             Else
             OnlyInAGroup
             Execute = 0
             Exit Function
                End If
                GoTo again1
        Case "AFTER", "ΜΕΤΑ"
contAfter:
                 If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, once, False)
         Exit Do
        End If
               If once = True Then Execute = 0: Exit Function
        If IsExp(bstack, b$, p) Then
        If FastSymbol(b$, "{") Then
        ss$ = block(b$) + vbCrLf & "thread this erase"
        sp = GetTaskId + 20000
        b$ = NLtrim$(Mid$(b$, 2))
            Set bs = New basetask
            bs.IamAnEvent = bstack.IamAnEvent
            bs.reflimit = bstack.reflimit
                        Set bs.Parent = bstack
         bstack.PushThread CLng(sp), "after"
        sThreadInternal bs, sp, 0, ss$, uintnew(p), here$, True
        Set bs = Nothing
       LLL = 0
       Execute = 1
       
        Else
        LLL = 0
        b$ = vbCrLf & "WAIT " & Str(p) & ": " & b$
        Execute = 1
        End If
        End If
Case "ΔΥΑΔΙΚΟ", "BINARY"
contBinary:
        If Not linebyline Then
            If once = True Then Execute = 0: Exit Function
        End If
        Execute = 0
        If FastSymbol(b$, "{") Then
        ss$ = block(b$)
        If Not FastSymbol(b$, "}", True) Then Exit Do
            If Not GetRes(bstack, b$, Lang, ss$) Then
                Execute = 0: Exit Function
            End If
            Execute = 1
        End If
        Case "ΜΕΡΟΣ", "PART"
contPart:
        If Not linebyline Then
            If once = True Then Execute = 0: Exit Function
        End If
        Execute = 0
        If FastSymbol(b$, "{") Then
        ss$ = block(b$)
        x2 = Len(b$)
        If Not FastSymbol(b$, "}", True) Then Exit Do
        If IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
          ' search for variable name only
            ok = False
            If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                If GetlocalVar(w$, v) Then ' exist...
                LLL = 0
                    If var(v) = 0 Then var(v) = True: ok = True
                ElseIf GetVar(bstack, w$, v) Then ' exist...
                LLL = 0
                    If var(v) = 0 Then var(v) = True: ok = True
                Else
                
                v = globalvar(w$, ok, , VarStat, temphere$)

                LLL = 0
                
            End If
                If ok Then
                ok = False
                TraceRestore bstack, y1
                x2 = x2 - Len(b$)
                Call executeblock(Execute, bstack, ss$, (once), ok)
                If Execute = 0 Then b$ = ss$ + Space$(x2) + b$: Exit Function
                TraceRestore bstack, x1
                var(v) = False
                ok = True
                
                If linebyline Then
                ClearStr b$
                Exit Do
                End If
                Else
  
                Execute = 1
                End If
                '
                
                Else
            Exit Function
            End If
            Else
                          SyntaxError
                          Execute = 0
             Exit Function
        End If
            Else
            Exit Function
        End If
'If linebyline Then Exit Do
        
        Case "DO", "REPEAT", "ΕΠΑΝΑΛΑΒΕ", "ΕΠΑΝΕΛΑΒΕ"
ContRepeat:
                   If linebyline Then
          b$ = w$ + " " + b$
          sw$ = here$
        Execute = Execute(bstack, b$, once, False)
        here$ = sw$
         Exit Do
        End If
               If once = True Then Execute = 0: Exit Function
               sw$ = here$
        If FastSymbol(b$, "{") Then
        v = Len(b$)
                  ss$ = block(b$) + "}"
                  TraceStore bstack, x1, b$, 1, y1
                  b$ = NLtrim$(Mid$(b$, 2))
                  ok = False
                      sss = Len(b$)
                    ec$ = ss$
                 ' FIND UNTIL
                 If IsLabelSymbolNew(b$, "ΜΕΧΡΙ", "UNTIL", Lang) Then
                      Execute = 1
                      TraceRestore bstack, y1
                        
           Call executeblock(Execute, bstack, ss$, once, ok)
           
           TraceRestore bstack, x1
                         If Execute = 0 Then
                            b$ = Space$(v - (Len(ec$) - Len(ss$)))
                            '
                            Execute = 0: Exit Function
                            ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                            
                            
                        End If
                        If Execute = 3 Then ok = False
                 If ok Or MOUT Then
                 If ok Then
                    ok = True
                    ss$ = GetNextLine(b$)  'FORGET ANY CODE TO THE RIGHT
                 Else
                     Exit Function
                 End If
                 Else
                 
                     
        sss = Len(b)
        
        w$ = b$
        If IsExp(bstack, b$, p) Then
                With bstack
            If Not .lastobj Is Nothing Then
            If TypeOf .lastobj Is mHandler Then
                
            p = .lastobj.index_start = .lastobj.index_End
            End If
            End If
        End With
         w$ = Left$(w$, Len(w$) - Len(b$))
        If Not p Then
        bb$ = w$
        ok = False
       
              Do
                 ss$ = ec$
                 w$ = bb$
                 
                      Call executeblock(Execute, bstack, ss$, once, ok)
                    
                         If Execute = 0 Then
                    b$ = Space$(v - (Len(ec$) - Len(ss$)))
                      here$ = sw$
                 Execute = 0: Exit Function
                                      ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                                        here$ = sw$
                            b$ = ss$: Exit Function
                            
                 End If
                  If Execute = 3 Then ok = False
                 If ok Or MOUT Then Exit Do
                 
                          IsExp bstack, w$, p
    
          Loop Until p
          here$ = sw$
        End If
              End If
              End If
                 Else
                 ' play always
                 If IsLabelSymbolNew(b$, "ΠΑΝΤΑ", "ALWAYS", Lang) Then
                      Do
                 ss$ = ec$
                 
                        Call executeblock(Execute, bstack, ss$, once, ok)
                         If Execute = 0 Then
                    b$ = Space$(v - (Len(ec$) - Len(ss$)))
                 Execute = 0: Exit Function
                                             ElseIf Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                 End If
                 If ok Or MOUT Then Exit Do
                  Loop
 
                 
                 
                 
                 Else
                 
                 Execute = 0
                 Exit Function
                 End If
                 End If
            End If
            
        Case "ΕΝΩ", "WHILE"
contWhile:
                   If linebyline Then
          b$ = w$ + " " + b$
          sw$ = here$
        Execute = Execute(bstack, b$, once, False)
        here$ = sw$
         Exit Do
        End If
               If once = True Then Execute = 0: Exit Function
        w$ = b$
        If IsExp(bstack, b$, p) Then
st = True
ss$ = ""
getanother:
        With bstack
            If Not .lastobj Is Nothing Then
            'here

            If TypeOf .lastobj Is mHandler Then
                
                If .lastobj.UseIterator Then
                    i = .lastobj.indirect
                    If i < 0 Then
                        Set myobject = .lastobj.objref
                        If TypeOf myobject Is mHandler Then
                            Set myobject = myobject.objref
                        End If
                    Else
                        InternalEror
                        b$ = ""
                    Exit Function
                End If
                p = .lastobj.index_End <> -1 And Not myobject.IsEmpty
                If p Then
                    myobject.index = .lastobj.index_start
                    .lastobj.index_cursor = .lastobj.index_start
                    If .lastobj.index_start <= .lastobj.index_End Then v = 1 Else v = -1
                End If
            ElseIf .lastobj.IamEnum Then
            
                p = .lastobj.index_End <> -1
                If p Then
                If .lastobj.index_End <> 0 Then
                p = .lastobj.Iterate()
                End If
                End If
                
                
            End If
            Set bstack.lastobj = Nothing
            End If
            End If
        End With
        st = st And p
                
         If FastSymbol(b$, ",") Then
         If IsExp(bstack, b$, p) Then
            If Not bstack.lastobj Is Nothing Then GoTo getanother
            
         Else
         MissNumExpr
         Execute = 0
         Exit Function
         End If
         End If
         w$ = Left$(w$, Len(w$) - Len(b$))
                If p = CDbl(0) Then
                 If FastSymbol(b$, "{") Then
                 w$ = block(b$)
                 b$ = NLtrim$(b$)
           If FastSymbol(b$, "}") Then
                b$ = NLtrim(b$)
                 If b$ = vbNullString Then Exit Function
                 GoTo again1
                 Else
                 b$ = NLtrim$(b$)
                 If b$ = vbNullString Then Exit Function
                 GoTo again1
                 End If
                 Else
                 Exit Do
                 End If
                Else
                 If FastSymbol(b$, "{") Then
                 ss$ = block(b$) + "}"
                 TraceStore bstack, x1, b$, 1, y1
                 
                 ec$ = ss$
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
                 bb$ = w$
                         Execute = 1
                         ok = False
                         sw$ = here$
                         
                 Do
                 st = True
                 ss$ = ec$
                 w$ = bb$

                 TraceRestore bstack, y1
                 
           If executeblock(Execute, bstack, ss$, once, ok) Then
           here$ = sw$
              TraceRestore bstack, x1
            b$ = ss$ & b$
           Exit Function
           Else
           here$ = sw$
           TraceRestore bstack, x1
            If Execute = 2 And ss$ <> "" And Not ok Then
                            b$ = ss$: Exit Function
                            End If
           End If
                 If Execute = 3 Then ok = False
                 If ok Or MOUT Then Exit Do
another1:
                 IsExp bstack, w$, p
                 With bstack
            If Not .lastobj Is Nothing Then
            If TypeOf .lastobj Is mHandler Then
            If .lastobj.UseIterator Then
                i = .lastobj.indirect
                If i < 0 Then
                
                Set myobject = .lastobj.objref
                If TypeOf myobject Is mHandler Then
                Set myobject = myobject.objref
                End If
                Else
                InternalEror
                b$ = ""
                Exit Function
                End If
            p = .lastobj.index_End <> -1 And Not myobject.IsEmpty
            If p Then
                If .lastobj.index_start <= .lastobj.index_End Then v = 1 Else v = -1
                
                If v >= 0 Then
                p = .lastobj.index_cursor < .lastobj.index_End
                Else
                p = .lastobj.index_cursor > .lastobj.index_End
                End If
                If p Then myobject.index = .lastobj.index_cursor + v: .lastobj.index_cursor = .lastobj.index_cursor + v
            End If
            ElseIf .lastobj.IamEnum Then
                p = .lastobj.Iterate()
            End If
            End If
            End If
        End With
                
            st = st And p
                If FastSymbol(w$, ",") Then GoTo another1
                 Loop Until st = 0 Or NOEXECUTION
                 ' addition in 8.9 rev 33
                Set bstack.lastobj = Nothing
                 If MOUT Then Execute = 0: Exit Function
                 Else
                 sss = Len(b$)
                 End If
                 
                End If
        End If
        Case "ΚΑΘΕ", "EVERY"
contEvery:
        If once = True Then Execute = 0: Exit Function
                   If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, once, False)
         Exit Do
        End If
        If IsExp(bstack, b$, p) Then
              If p <= 0 Then
                 If FastSymbol(b$, "{") Then
                 w$ = block(b$)
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
                 Else
                 Exit Do
                 End If
                Else
                 If FastSymbol(b$, "{") Then
                 ss$ = block(b$) + "}"
                 ec$ = ss$
                 b$ = NLtrim$(Mid$(b$, 2))
                 sss = Len(b$)
      
                         Execute = 1
                         ok = False
                ' GET A TICK HERE
                sX = p
                 p = p + uintnew(timeGetTime)
                 Do
                 ss$ = ec$
               ''''''''''  w$ = bb$
                 Call executeblock(Execute, bstack, ss$, once, ok)
                 If Execute = 0 Then   '''Execute(bstack, ss$, ok) = 0
                            If NOEXECUTION Then
                                            b$ = "START"
                                            Execute = 1
                                            ok = True
                                            Exit Do
                            End If
                              b$ = ss$ & b$
                            Execute = 0: Exit Function
                 End If
                 If ok Or MOUT Then Exit Do
                 If p < timeGetTime Then
                 p = (sX - (uintnew(timeGetTime) - p) \ sX) + uintnew(timeGetTime)
                 End If
 
            If bstack.IamThread Then SkipRefresh bstack
                If p > uintnew(timeGetTime) Then


             ProcTask2 bstack
                   While p > uintnew(timeGetTime)
         ProcTask2 bstack
                    Wend
                    End If
                   p = sX + uintnew(timeGetTime)
                 Loop
                  If NOEXECUTION Then
                b$ = "START"
                Execute = 1
                ok = True
                Exit Do
                End If
                 If MOUT Then Execute = 0: Exit Function
                 Else
                 sss = Len(b$)
                 End If
                 
                End If
        End If
        Case "ΚΥΡΙΟ.ΕΡΓΟ", "MAIN.TASK", "TASK.MAIN"
contTask:
               If once = True Then Execute = 0: Exit Function
              If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, once, False)
         Exit Do
        End If
        ' only one task main
        If taskmainonly = True Then Execute = 0: Exit Function
        taskmainonly = True
        w$ = b$
        Execute = 1
         If IsExp(bstack, b$, p) Then
         If FastSymbol(b$, "{") Then
         ss$ = block(b$)
         sp = GetTaskId + 20000
            Set bs = New basetask
            bs.reflimit = bstack.reflimit
                        Set bs.Parent = bstack
              bstack.PushThread CLng(sp), "_multi"
         sThreadInternal bs, sp, 10, ss$, uintnew(-1), here$, True
         TaskMaster.Message CLng(sp), 3, CLng(uintnew(p))
      On Error Resume Next
        bstack.TaskMain = True
                Do
                
             If TaskMaster Is Nothing Then Execute = 0: Exit Function
             If TaskMaster.Processing Then TaskMaster.TimerTick
               MyDoEvents0 di
                 bstack.TaskMain = bstack.Exist(CLng(sp), "_multi") = False
                
               
               
             Loop Until MOUT Or bstack.TaskMain Or NOEXECUTION Or TaskMaster.QueueCount < 2
           On Error GoTo 0
     bstack.TaskMain = False
   If TaskMaster.PlayMusic Then mute = True
         End If
         If FastSymbol(b$, "}") Then
         End If
         End If
         taskmainonly = False
        If MOUT Then Execute = 0: Exit Function
        
        Case "ELSE", "ΑΛΛΙΩΣ"
ContElse:
    
        If once = True Then Execute = 0: Exit Function
        If IFCTRL = 0 Then
        SyntaxError
        Execute = 0
        Exit Function
        Else
                If (Not jump) Or IFCTRL = 2 Then
                 If FastSymbol(b$, "{") Then
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
                SetNextLine b$
                lbl = True
                End If
                jump = False
                Else
                If IsNumberLabel(b$, w$) Then
                  once = False
                b$ = w$
                Execute = 2
                Exit Function
                End If
                lbl = False
                End If
                End If
                   IFCTRL = 0 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
                            
                sss = Len(b$)
                
        Case "TRY", "ΔΕΣ"
ContTry:
                If IsLabelSymbolNew(b$, "ΡΕΥΜΑ", "STREAM", Lang) Then
 'Debug.Print bstack.CallW
 'Debug.Print bstack.fHere
    If bstack.CallW <> "" Then
        ss$ = here$
        i = bstack.soros.Total
         here$ = bstack.fHere
        If bstack.strg Then
            If IsStrExp(bstack, (bstack.CallW), ec$) Then
                 bstack.soros.DataStr ec$
            End If
        Else
       
            If IsExp(bstack, (bstack.CallW), p) Then
               bstack.soros.DataVal p
            End If
        End If
        
        here$ = ss$
        End If
      GoTo loopagain
      
      
                End If
               
               
               
               If once = True Then Execute = 0: Exit Function
                 If linebyline Then
          b$ = w$ + " " + b$
        Execute = Execute(bstack, b$, once, False)
        bstack.nokillvars = False
         Exit Do
        End If
        ' ΜΕΤΑΒΛΗΤΗ
        i = Abs(IsLabel(bstack, b$, w$))
        
        Select Case i
        Case 0  ' new
          If FastSymbol(b$, "{") Then
  
         Execute = 1
         ss$ = "{" + block(b$) + "}"
        
            
            
       TraceStore bstack, x1, b$, 1
         
         b$ = NLtrim$(Mid$(b$, 2))
                'On Error Resume Next
                     Call executeblock(Execute, bstack, ss$, once, ok)
          TraceRestore bstack, x1
   bstack.nokillvars = False
         once = False
         MOUT = False
         NOEXECUTION = False
         NERR = False
         LastErNum = 0
         LastErNum1 = 0
         If LastErName <> "" Then LastErName = Chr(0) + LastErName
         If LastErNameGR <> "" Then LastErNameGR = Chr(0) + LastErNameGR
            Execute = 1
         End If
            Case 1, 4
        If FastSymbol(b$, "{") Then
        p = CDbl(0)
         If Not GetlocalVar(w$, v) Then
         If Not GetVar(bstack, w$, v) Then
         v = globalvar(w$, p, , VarStat, temphere$) '': GetlocalVar W$, v
         End If
         End If
         Execute = 1
         ss$ = "{" & block(b$) & "}"
          b$ = NLtrim$(Mid$(b$, 2))
          LastErNum2 = 0
                     Call executeblock(Execute, bstack, ss$, once, ok)
     var(v) = CDbl(Execute = 1)
        MOUT = False
         NOEXECUTION = False
         NERR = False
         LastErNum = 0
         LastErNum2 = LastErNum1
         LastErNum1 = 0
         End If
         Execute = 1
        End Select
        If MOUT Then Execute = 0: Exit Function
        Execute = 1
         Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
contElseIf:
        
        If once = True Then Execute = 0: Exit Function
        If IFCTRL = 0 Then
        SyntaxError
        Else
        
         If (Not jump) Or IFCTRL = 2 Then
         ' LOOK AHEAD...DO NOT PLAY THE LOGICAL EXPRESSION
         IFCTRL = 1
         ss$ = aheadstatus(b$, False, IFCTRL)
         b$ = Mid$(b$, IFCTRL)
            If FastSymbol(b$, "{") Then
               w$ = block(b$)
             b$ = NLtrim$(Mid$(b$, 2))
             IFCTRL = 1
            
              Else
             
                    If FastSymbol(b$, "{") Then
               w$ = block(b$)
             b$ = NLtrim$(Mid$(b$, 2))
             IFCTRL = 1
             Else
                SetNextLine b$
                
                lbl = True
                End If
                End If
                IFCTRL = 1
               jump = False
       i = 1
            While FastOperator(b$, vbCrLf, i, 2)
            Wend
            
            If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ.ΑΝ", "ELSE.IF", Lang) Then GoTo contElseIf
            If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then GoTo ContElse
            
          
        Else   ' ONLY FOR NOT JUMP
        If IsExp(bstack, b$, p) Then
        IFCTRL = 1
        jump = (p = CDbl(0))
        Select Case Abs(IsLabel(bstack, b$, w$))  ' now w$ is Ucase
            Case 1
            Select Case w$
                Case "THEN", "ΤΟΤΕ"
                'If VarStat Or NewStat Then GoTo errstat
              
                       If once = True Then Execute = 0: Exit Function
                             If jump Then
                       
            
                    If FastSymbol(b$, "{") Then
                    w$ = block(b$)
                    b$ = NLtrim$(Mid$(b$, 2))
                    
                    Else
                    
                    SetNextLine b$  ' drop line
                    lbl = True
                    End If
                    Else
                    IFCTRL = 2 ' NONEED ANYTHING BUT NOT ERROR FOR ELSE.IF AND ELSE
            End If
            
                     
   
               Case "ELSE", "ΑΛΛΙΩΣ"
              ' If VarStat Or NewStat Then GoTo errstat
                 
                      If once = True Then Execute = 0: Exit Function
                   '  IFCTRL = 1
                If Not jump Then      ' JUMP FALSE SKIP ELSE
                
                If FastSymbol(b$, "{") Then
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
             
                 SetNextLine b$
                lbl = True
                End If
                jump = True
                IFCTRL = 1 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
                End If
                sss = Len(b$)
                            Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
                            
                          
                                   If once = True Then Execute = 0: Exit Function
                   '  IFCTRL = 1
                b$ = w$ & b$
                     
            Case Else
           
           Execute = 0
           Exit Function
            End Select
            If jump Or IFCTRL = 2 Then
                                  i = 1
            While FastOperator(b$, vbCrLf, i, 2)
            Wend
        If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ.ΑΝ", "ELSE.IF", Lang) Then GoTo contElseIf
        If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then GoTo ContElse
        End If
           Case Else
           Execute = 0
           Exit Function
        End Select
        Else
        ' error
        Execute = 0
         Exit Function
        End If
                End If
                End If
        sss = Len(b$)
        
        Case "IF", "ΑΝ"
        
        
contif:
        
        
        If IsExp(bstack, b$, p) Then
          IFCTRL = 1           ' NEED THEN OR ELSE OR ELSE.IF
        jump = (p = CDbl(0))                    ' JUMP TRUE GOTO ELSE
        
        Select Case Abs(IsLabel(bstack, b$, w$))
            Case 1
            Select Case w$
                Case "THEN", "ΤΟΤΕ"
         
                If jump Then
                    
                    If FastSymbol(b$, "{") Then
                     If once = True Then Execute = 0: Exit Function
                    w$ = block(b$)
                    b$ = NLtrim$(Mid$(b$, 2))
                    
                    Else
                    If once Then
                    w$ = GetStrUntil(vbCrLf, b$, False)
                    Exit Function
                    Else
                    SetNextLine b$
                    lbl = True
                    End If
                   
                    End If
                    
                    Else
If MaybeIsSymbol(b$, "0123456789") Then
GoTo ContGoto
End If
                     
         
                    IFCTRL = 2 ' NONEED ANYTHING BUT NOT ERROR FOR IF.ELSE AND ELSE
                    If once Then
                    sss = Len(b$): GoTo again1
           
                    End If
              End If
        
                
                Case "ELSE", "ΑΛΛΙΩΣ"
                
               ' If VarStat Or NewStat Then GoTo errstat
                   '  IFCTRL = 1
                If Not jump Then      ' JUMP FALSE SKIP ELSE
                If FastSymbol(b$, "{") Then
                 If once = True Then Execute = 0: Exit Function
                w$ = block(b$)
                b$ = NLtrim$(Mid$(b$, 2))
                Else
                 SetNextLine b$
                lbl = True
                End If
                IFCTRL = 0 ' NONEED ANYTHING AND ERROR FOR IF.ELSE AND ELSE
                End If
                sss = Len(b$)
                            Case "ELSE.IF", "ΑΛΛΙΩΣ.ΑΝ"
                          
                          
                   '  IFCTRL = 1
                b$ = w$ & b$
                
           Case Else
           
           Execute = 0
           Exit Function
            End Select
           Case Else
           Execute = 0
           Exit Function
        End Select
  
            If jump Or IFCTRL = 2 Then
                      i = 1
            While FastOperator(b$, vbCrLf, i, 2)
            Wend
            If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ.ΑΝ", "ELSE.IF", Lang) Then GoTo contElseIf
            If IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then GoTo ContElse
            If MaybeIsSymbol(b$, "0123456789") Then
                        GoTo ContGoto
            End If
            End If
        Else
        ' error
        If LastErNum = -2 Then
        Execute bstack, b$, True

        Else
        MissNumExpr
       
         End If
          Execute = 0
         Exit Function
        End If
        sss = Len(b$)
        Case "SELECT", "ΕΠΕΛΕΞΕ", "ΕΠΙΛΕΞΕ"  '*************************************** SELECT CASE
contSelect:
        Us$ = vbNullString
        If once = True Then Execute = 0: Exit Function
        If exeSelect(Execute, once, bstack, b$, v, Lang) Then Exit Function
        
         sss = Len(b$)
        Case "ΑΠΟ", "ON"                 '************************************* ON NUMBER GOTO LABELS
ContOn:
        If IsExp(bstack, b$, p) Then
        y1 = IsLabelSymbolNew(b$, "ΠΡΟΣ", "GOTO", Lang)
        y2 = False
        If Not y1 Then
        y1 = IsLabelSymbolNew(b$, "ΔΙΑΜΕΣΟΥ", "GOSUB", Lang, True)
        y2 = True
        End If
            If y1 Then
            On Error Resume Next
                p = CLng(Int(p))
                        If Err.Number = 6 Then
                                OverflowLong
                                Execute = 0
                                Exit Function
                                End If
                                On Error GoTo 0
                If p <= 0 Then ' no exit
                SetNextLine b$
                If Execute <> 2 Then Execute = 1 Else Execute = 3
            b$ = vbNullString
           once = True
           Exit Function
          '' SetNextLine B$
                '' sss = Len(B$)
               ''  lbl = True
                
                Else
                w$ = vbNullString
                i = 0
                Do
                i = 1
                 x1 = Abs(IsLabelOnly(b$, w$))
                    If x1 = 0 Then
                    If Not IsNumberLabel(b$, w$) Then p = 1000: Exit Do
                    
                    ElseIf x1 > 1 Then
                        p = 1000
                        Exit Do
                    End If
                    i = 0
                    p = p - 1
                    If Not FastSymbol(b$, ",") Then Exit Do
                    
                Loop Until p = CDbl(0)
                If p <> 0 Then
                
                If i = 0 Then
                Execute = 1: w$ = GetNextLine$(b$): sss = Len(b$):
                End If
                w$ = vbNullString
                'Exit Do
                Else
                If i > 0 Then
                MissingLabel
                sss = LLL
                  Execute = 0
                Exit Function
                Else
                If y2 Then
                If bstack.SubLevel > deep And deep <> 0 Then
' GO BACK TO FIRST CALL
If bstack.RetStackTotal >= 9 * deep Then
             NoMoreDeep deep

             Execute = 0
             Exit Function

            
Else
bstack.RetStack.drop bstack.RetStackTotal
 End If
  InternalEror
 NOEXECUTION = True
 Execute = 0
Exit Function
 
End If
               
               If p = 1000 Then Exit Function
                SetNextLine b$
               If x1 = 1 Then
               i = 1
               GoTo contHereFromOn
               Else
               GoTo contHere2FromOn
               End If
               
                
                End If
                b$ = w$
                Execute = 2
                Exit Function
                End If
                End If
                End If
            Else
              sss = LLL
            End If
        Else
            MissParam b$
            Execute = 0
            Exit Function
        End If
          
        Case "SUB", "ΡΟΥΤΙΝΑ"
contSub:
           If once = True Then Execute = 0: Exit Function
   If Execute <> 2 Then
              b$ = w$
           once = True
           Execute = 3
         
           Else
           b$ = vbNullString
           
        End If
           Exit Function
        Case "GOSUB", "ΔΙΑΜΕΣΟΥ"
autogosub:

If myexit(bstack) Then Execute = 1: Exit Function

If bstack.SubLevel > deep And deep <> 0 Then
' GO BACK TO FIRST CALL
If bstack.RetStackTotal >= 9 * deep Then
             NoMoreDeep deep

             Execute = 0
             Exit Function

            
Else
bstack.RetStack.drop bstack.RetStackTotal
 End If
  InternalEror
 NOEXECUTION = True
 Execute = 0
Exit Function
 
End If
        i = Abs(IsLabelOnly(b$, w$))
contHereFromOn:
                If i = 5 Then
                once = False
                
                PushParamGeneral bstack, b$
                If FastSymbol(b$, ")") Then
                 PushStage bstack, False
                bstack.RetStack.PushVal Len(b$)
                If Lang Then
                bstack.RetStack.PushStr "SUB " + w$
                Else
                bstack.RetStack.PushStr "ΡΟΥΤΙΝΑ " + w$
                End If
                    b$ = Chr$(0)
                    '' here is the fault...execute 2 means loop...
                    '' it is known only here...
                    loopthis = Execute = 2
                    Execute = 2
                  Exit Function
                Else
                MissSymbol ")"
                Execute = 0
                Exit Function
                End If
                ElseIf i = 1 Then
                once = False
        
                PushStage bstack, True
                bstack.RetStack.PushVal Len(b$)
                bstack.RetStack.PushStr "S " + w$
                b$ = Chr$(0)

                Execute = 2
                Exit Function
                ElseIf i = 0 Then
                
                If IsNumberLabel(b$, w$) Then
contHere2FromOn:
                      once = False
                              PushStage bstack, True  ' CORRECT FROM REV 45 - VER 8
                      bstack.RetStack.PushVal Len(b$)
                     bstack.RetStack.PushStr "* " + w$
                b$ = Chr$(0)
                
                Execute = 2
                Exit Function
                Else
                 b$ = w$ & b$
                End If
                Else
                b$ = w$ & b$
                
                Exit Do
                End If
        Case "GOTO", "ΠΡΟΣ"               '**************************************** This is the GOTO statement
ContGoto:
        If myexit(bstack) Then Execute = 1: Exit Function
        If Trim$(b$) = vbNullString Or FastSymbol(b$, ":") Then
                Execute = 0
                MissingLabel
                Exit Function
        Else
        ' GET OUT FOR NEXT
    
        
        i = Abs(IsLabelOnly(b$, w$))

                If i = 1 Then
                
                once = False
                b$ = w$
                Execute = 2
                Exit Function
                ElseIf i = 0 Then
                If IsNumberLabel(b$, w$) Then
                      once = False
                b$ = w$
                Execute = 2
                Exit Function
                Else
                 b$ = w$ & b$
                End If
                Else
                b$ = w$ & b$
                
                Exit Do
                End If
              End If
              Case "LOCAL", "ΤΟΠΙΚΑ", "ΤΟΠΙΚΗ", "ΤΟΠΙΚΕΣ"
contNegLocal:
                    NewStat = True
                    sss = Len(b$)
                    LLL = sss
                iscom = True
                    Select Case IsLabelDotSub(temphere$, b$, w$, ss$, Lang, nchr)
                    Case 1234, 0
                    GoTo errstat
                    Case 1
                    If Left$(w$, 1) = "." Then
                     ss$ = w$
                    IsLabel bstack, ss$, w$
                    End If
                    GoTo VarOnly
                    Case 2
                    NoRef
                    Execute = 0
                    Exit Function
                    Case 3
                    GoTo contcase3
                    Case 4
                    GoTo contcase4
                    Case 5
                    GoTo contcase5
                    Case 6
                    GoTo contcase6
                    Case 7
                    GoTo contcase7
                    End Select
                  GoTo errstat
                Case "GLOBAL", "ΓΕΝΙΚΟ", "ΓΕΝΙΚΗ", "ΓΕΝΙΚΕΣ"
contNegGlobal:
                If NewStat Then LocaleAndGlobal: Execute = 0: Exit Function
                If Not VarStat Then
                If IsLabelSymbolNew(b$, "ΟΜΑΔΑ", "GROUP", Lang) Then
                    ' group can't used as variable because exist read only variable
                    ' which pop group from stack
               If Not ProcGroup(1, bstack, b$, Lang) Then Execute = 0: Exit Function
               ElseIf IsLabelSymbolNew(b$, "ΓΕΓΟΝΟΣ", "EVENT", Lang) Then
                If MaybeIsSymbol(b$, "=") Then
                
                VarStat = True
                    If Lang = 0 Then
                    w$ = "ΓΕΓΟΝΟΣ"
                       Else
                    w$ = "EVENT"
                    End If
                    sss = Len(b$)
                    GoTo VarOnly
                End If
                If Not GlobalEVENT(bstack, b$, Lang) Then Execute = 0: Exit Function
                ElseIf IsLabelSymbolNew(b$, "ΚΑΤΑΣΤΑΣΗ", "INVENTORY", Lang) Then
                If MaybeIsSymbol(b$, "=") Then
                
                VarStat = True
                    If Lang = 0 Then
                    w$ = "ΚΑΤΑΣΤΑΣΗ"
                       Else
                    w$ = "INVENTORY"
                    End If
                    sss = Len(b$)
                    GoTo VarOnly
                End If
                If IsLabelSymbolNew(b$, "ΟΥΡΑ", "QUEUE", Lang) Then
                    If Not GlobalHandler(bstack, b$, Lang, 3) Then Execute = 0: Exit Function
                Else
                    If Not GlobalHandler(bstack, b$, Lang, 1) Then Execute = 0: Exit Function
                End If
                ElseIf IsLabelSymbolNew(b$, "ΔΙΑΡΘΡΩΣΗ", "BUFFER", Lang) Then
                           If MaybeIsSymbol(b$, "=") Then
                
                VarStat = True
                    If Lang = 0 Then
                    w$ = "ΔΙΑΡΘΡΩΣΗ"
                       Else
                    w$ = "BUFFER"
                    End If
                    sss = Len(b$)
                    GoTo VarOnly
                End If
                If Not GlobalHandler(bstack, b$, Lang, 2) Then Execute = 0: Exit Function
            
                ElseIf IsLabelSymbolNew(b$, "ΑΠΑΡ", "ENUM", Lang) Then

                If Not ProcEnum(bstack, b$, True) Then Execute = 0: Exit Function
                GoTo loopcontinue
                ElseIf IsLabelSymbolNew(b$, "ΑΠΑΡΙΘΜΗΣΗ", "ENUMERATION", Lang) Then

                If Not ProcEnum(bstack, b$, True) Then Execute = 0: Exit Function

                GoTo loopcontinue
                Else
                GoTo CONT12212
               End If
                VarStat = True
                sss = Len(b$)
               
                Else
CONT12212:
                VarStat = True
                sss = Len(b$)
                
                    LLL = sss
                iscom = True
                    Select Case IsLabelDotSub(temphere$, b$, w$, ss$, Lang, nchr)
                    Case 1234, 0
                    GoTo errstat
                    Case 1
                    If Left$(w$, 1) = "." Then
                     ss$ = w$
                    IsLabel bstack, ss$, w$
                    ElseIf comhash.Find2(w$, i, v) Then
                    If i = 0 And v = 36 Then
                    ConstNew bstack, b$, w$, True, Lang
                    
                    If LastErNum = -1 Then
                    Execute = 0
                    Exit Function
                    End If
                    sss = Len(b$)
                    GoTo loopcontinue
                    End If
                    
                    End If
                    GoTo VarOnly
                    Case 2
                    NoRef
                    Execute = 0
                    Exit Function
                    Case 3
                    GoTo contcase3
                    Case 4
                    GoTo contcase4
                    Case 5
                    GoTo contcase5
                    Case 6
                    GoTo contcase6
                    Case 7
                    GoTo contcase7
                    End Select
                  GoTo errstat
                  End If
        Case "CONST", "ΣΤΑΘΕΡΗ", "ΣΤΑΘΕΡΕΣ"
makeconst:
        ConstNew bstack, b$, w$, here$ = vbNullString, Lang
         If LastErNum = -1 Then
                    Execute = 0
                    Exit Function
                    End If
       ' sss = Len(b$)
        'GoTo AGAIN1
        Case Else
If Not NoOptimum Then
    If Not iscom Then GoTo parsecommand
Else
iscom = False
End If
VarOnly:

On ExecuteVar(Execute, 1, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers

If NoOptimum Then
If GetSub(w$, v) Then
    iscom = True
End If
End If
parsecommand:
                'If VarStat Or NewStat Then GoTo errstat

If Not Identifier(bstack, w$, b$, iscom, Lang) Then


conthere111:
    If LastErNum1 = -1 And bstack.IamThread Then Execute = 1 Else Execute = 0
    Exit Function
    ' just happy here
exitdo:
Exit Do
exitfunc:
Set bstack.lastpointer = Nothing
Exit Function
Else
    If bstack.callx1 > 0 Then
    If Not ProcModuleEntry(bstack, "", 0, b$, Lang) Then
                  If MOUT And b$ = vbNullString Then
        Else
            unknownid b$, w$
        End If
    End If
    bstack.RemoveOptionals
   ''' funcno = funcno - 1
    End If
    iscom = False
conthere222:
    If bstack.connectnow Then
        bstack.connectnow = False
    End If
    If NocharsInLine(b$) Then Exit Do Else lbl = MaybeIsSymbol(b$, Chr(13))
End If




        End Select
      '  End If
    Else
   b$ = w$ & b$
    Execute = 0
         If FindNameForGroup(bstack, w$) Then
                UnknownProperty w$
        Else
                UnknownVariable w$
        End If

    Exit Function
    End If

Case 2
If Not lbl Then b$ = w$ & b$: Exit Do
b$ = Mid$(b$, 2)
lbl = False
sss = Len(b$)
Case 3
contcase3:
On ExecuteVar(Execute, 3, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers
Case 4
contcase4:
On ExecuteVar(Execute, 4, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers
Case 5
contcase5:
On ExecuteVar(Execute, 5, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers
Case 6
contcase6:
On ExecuteVar(Execute, 6, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers
Case 7
contcase7:
On ExecuteVar(Execute, 7, bstack, w$, b$, v, Lang, VarStat, NewStat, nchr, ss$, sss, temphere$) GoTo exitdo, autogosub, loopagain, contVarNew, again3, parsecommand, loopcontinue, exitfunc, forpointers, forfloatpointers
Case Else
If MaybeIsSymbol(b$, ".") Then
b$ = NLtrim$(b$)
        nd& = Len(b$)
        If bstack.GetDot(b$, (1)) Then
           sss = (Len(b$) - nd&) + sss
           LLL = (Len(b$) - nd&) + LLL
        End If
        GoTo again2
End If
If MaybeIsSymbol(b$, ",+*/_!@()[];<>|~`0123456789") Then
SyntaxError
Execute = 0
Exit Function
End If
End Select
loopcontinue:
If once And Not jump Then Exit Do
loopagain:
If linebyline Then Exit Do
Loop
jumphere:
If linebyline Then
With bstack
.IFCTRL = IFCTRL
.jump = jump
End With
End If
Exit Function
errstat0:
MyEr Err.Description, Err.Description
Err.Clear
     Execute = 0: Exit Function
errstat1:
MissModuleName
     Execute = 0: Exit Function
errstat:
MissVarName
     Execute = 0: Exit Function
LONGERR:
    If Err.Number = 6 Then
            Execute = 0
            OverflowLong
    ElseIf Err.Number = 450 Then
            Execute = 0
            WrongOperator
            End If
Exit Function
forfloatpointers:
Set pppp = BoxGroupObj(bstack.lastpointer)

v = 0
 Set bstack.lastpointer = Nothing
 Execute = SpeedGroup(bstack, pppp, "", w$, b$, v)
                                      If Execute = 0 Then
                                      Exit Function
                                      ElseIf Execute <> 1 And b$ <> "" Then
                                     once = False
                                      Exit Function
                                     End If
                                        sss = Len(b$)
                                        GoTo loopagain
forpointers:

If Len(b$) > 1 Then

        If Not bstack.lastpointer Is Nothing Then
          '  Mid$(b$, 1, 1) = " "
            nchr = 0
            x1 = IsLabelDotSub(temphere$, b$, w$, ss$, Lang, nchr)
            With bstack.lastpointer
           If x1 = 0 Then
           
           Select Case nchr
           Case 40
            w$ = .lasthere + "." + .GroupName
             
            x1 = 5
            sss = Len(b$)
            GoTo contcase5
            Case 61, 60
            w$ = .lasthere + "." + .GroupName
            x1 = 1
           
            End Select
             GoTo VarOnly
            Else
            If .lasthere = vbNullString Then
                w$ = .GroupName + "." + w$
            Else
                w$ = .lasthere + "." + .GroupName + "." + w$
                End If
                If MaybeIsSymbol2(b$, "=", i) Then
                If i = 1 Then
                Mid$(b$, 1, 1) = "_"
                Else
                Mid$(b$, i - 1, 1) = "<"
                End If
                
                End If
            End If
            End With
            Set bstack.lastpointer = Nothing
        Else
            InternalError
            Execute = 0
            Exit Function
        End If
'    x1 = IsLabelDotSub(temphere$, b$, w$, ss$, lang, nchr)

End If
GoTo again4


End Function
Function GoFunc(mystack As basetask, what$, rest$, vl As Variant, Optional recursive As Long, Optional ByVal choosethis As Long = -1, Optional ByVal strg As Boolean = False, Optional skiplastpar As Boolean = False) As Boolean
Dim p As Variant, i As Long, F As Long, it As Long, pa$
Dim x1 As Long, frm$, par As Boolean, ohere$, w$, bb$, loopthis As Boolean, S3 As Long, ec$
Dim Vars As Long, VName As Long, subs As Long, snames As Long, once As Boolean, RetStackSize As Long, subspoint As Boolean, subsfc As FastCollection
Dim threads As Long, vvv As Variant

Dim basestack As basetask
' get a reference to Parent task



Set basestack = mystack.Parent
If basestack Is Nothing Then Set basestack = mystack
ohere$ = here$
'if iRVAL(here$, 1) > funcdeep Then
If CurrentStackSize > stacksize Then
    MyEr "Function's Stack is Full - 15", "Η στοίβα των συναρτήσεων έχει γεμίσει - 15"
    Set basestack = Nothing
    GoFunc = False: Exit Function
End If
pa$ = mystack.UseGroupname
mystack.UseGroupname = basestack.UseGroupname
mystack.Look2Parent = True
mystack.strg = strg
mystack.fHere = here$
VName = varhash.count
Vars = var2used
If Not PushParamGeneralV7(mystack, rest$, "." + what$) Then
    mystack.Look2Parent = False
    Exit Function
End If

'''funcno = funcno + 1

mystack.Look2Parent = False
mystack.UseGroupname = pa$
If choosethis >= 0 Then
    x1 = choosethis
    If what$ = vbNullString Then
       If SecureNames Then
       If Left$(here$, 1) <> "_" Then If basestack.IamThread Then here$ = "_" + LTrim$(Str$(basestack.Process.Id)) + here$
            here$ = RVAL33(here$, x1)
       Else
            here$ = RVAL(here$, 1) + mystack.OriginalName
       End If
       ElseIf recursive Then
        here$ = RVAL(here$, 1) & "." & Trim$(what$)
        If SecureNames Then If basestack.IamThread Then If Left$(here$, 1) <> "_" Then here$ = "_" + LTrim$(basestack.Process.Id) + here$: basestack.StaticInUse = LTrim$(basestack.Process.Id)
        Else
        If SecureNames Then If basestack.IamThread Then If basestack.StaticInUse = vbNullString Then basestack.StaticInUse = LTrim$(basestack.Process.Id)
       End If
Else
    If InStr(what$, "(") > 0 Then
        If GetSub(what$, x1) Then
            If here$ = vbNullString Then
                If ohere$ = vbNullString Then here$ = what$
            Else
                here$ = RVAL(here$, 1) & "." & Trim$(what$)
                    If SecureNames Then If basestack.IamThread Then If Left$(here$, 1) <> "_" Then here$ = "_" + LTrim$(basestack.Process.Id) + here$: basestack.StaticInUse = LTrim$(basestack.Process.Id)
            End If
        ElseIf GetSub2(basestack, what$, x1) Then
            If here$ = vbNullString Then
                If ohere$ = vbNullString Then here$ = what$
            Else
                here$ = RVAL(here$, 1) & "." & Trim$(what$)
            End If
        End If
    Else
        If here$ = vbNullString Then
            If GetSub(what$, x1) Then
                here$ = RVAL(here$, 1)
            End If
        ElseIf GetlocalSub(what$, x1) Then
            here$ = RVAL(here$, 1)
        ElseIf GetSub(what$, x1) Then
            here$ = RVAL(here$, 1)
        ElseIf recursive > 0 Then
            here$ = RVAL(here$, 1)
            x1 = recursive
        End If
    End If
End If
 ' prepare function for static variables
If iRVAL(basestack.StaticInUse, 0) = 0 Then
    mystack.StaticInUse = RVAL(basestack.StaticInUse, 1) + "." + what$ + mystack.StaticInUse
    If Not basestack.Parent Is Nothing Then
        If Not basestack.Parent.StaticCollection Is Nothing Then
            If basestack.Parent.ExistVar("%_" + mystack.StaticInUse$) Then
                basestack.Parent.ReadVar "%_" + mystack.StaticInUse$, vvv
                If MyIsObject(vvv) Then Set mystack.StaticCollection = vvv
                Set vvv = Nothing
            End If
        End If
    End If
ElseIf basestack.OriginalCode = mystack.OriginalCode Then
    mystack.StaticInUse = basestack.StaticInUse
    Set mystack.StaticCollection = basestack.StaticCollection
Else
    mystack.StaticInUse = RVAL(basestack.StaticInUse, 1) + "." + what$ + mystack.StaticInUse
    If Not basestack.Parent Is Nothing Then
        If Not basestack.Parent.StaticCollection Is Nothing Then
            If basestack.Parent.ExistVar("%_" + mystack.StaticInUse$) Then
                basestack.Parent.ReadVar "%_" + mystack.StaticInUse$, vvv
                If MyIsObject(vvv) Then Set mystack.StaticCollection = vvv
                Set vvv = Nothing
            End If
        End If
    End If
End If

If here$ <> ohere$ Or mystack.IamChild Or basestack.IamAnEvent Then      ' so now we check that we are in an new namespace...
' this system must change.. and become member of a basetask
' these are for safety

'VName = varhash.count
'Vars = var2used
subs = sb2used: snames = subHash.count
With mystack
     .commnum = comhash.count
        .strfunnum = strfunid.count
        .numfunnum = funid.count
        .strnum = strid.count
        .numnum = numid.count
        End With
i = 1: FK$(13) = vbNullString


Dim ok As Boolean, nokillvars As Boolean
nokillvars = basestack.nokillvars: basestack.nokillvars = False

If Mid$(sbf(x1).sb, i) = vbNullString Then
GoFunc = True
GoTo emptyfunc
End If
   mystack.OriginalName$ = here$
If skiplastpar Or FastSymbol(rest$, ")") Then GoFunc = True
    If FastSymbol(rest$, "<<", , 2) Then
     F = 1
         w$ = aheadstatus(rest$, True, F)
         w$ = Left$(rest$, F - 1)
                rest$ = Mid$(rest$, F)
                F = 1
        While FastSymbol(rest$, "<<", , 2)
         pa$ = aheadstatus(rest$, True, F)
         w$ = w$ + " << " + Left$(rest$, F - 1)
                rest$ = Mid$(rest$, F)
                F = 1
        Wend
      mystack.CallW = w$
     mystack.NoFuncError = True
par = True
End If
Do
If choosethis >= 0 Then
 mystack.UseGroupname = pa$
Else
    mystack.UseGroupname = sbf(x1).sbgroup
    End If
    frm$ = Mid$(sbf(x1).sb, i)
    it = 1
    RetStackSize = mystack.RetStackTotal
againstream:




' Call executeblock(it, mystack, frm$, False, ok)

'ec$ = vbCrLf + frm$
  ec$ = frm$
        If Len(ec$) > 0 Then
                it = 1
                ok = False
                once = True
                i = 1
                Do
                    bb$ = Mid$(ec$, i)
subsentry10:
                    ok = False
                    Select Case Execute(mystack, bb$, ok, False, loopthis)   ' this is a major point
                    Case 0
                            frm$ = bb$
                            it = 0
                            Set mystack.lastobj = Nothing
                            GoTo normalexit
                    Case 1
                        If LastErNum <> 0 Then
                   frm$ = vbNullString
                    End If

                                  
                                   If once Then Exit Do
                                   
                                    here$ = ohere$
                                   Exit Do
                      Case 2
                            If Not ok Then
                                      i = 1
                    If bb$ <> "" Then
                            If bb$ = Chr$(0) Then
                                       If RetStackSize = mystack.RetStackTotal And mystack.RetStack.LookTopVal < 0 Then
                                        ' this is a return form other block
                                         it = 2
                                        frm$ = bb$
                                        GoTo fastexit
                                        End If
                                    If mystack.IsInRetStackNumber(p) Then
                                                       If LastErNum = -1 Then
                                                                mystack.RetStack.PushVal p
                                                                it = 0
                                                                GoTo fastexit
                                                        End If
                                                        If p < -1 Then
                                                              vvv = Abs(p + 2)
                                                              'subspoint = True
                                                              mystack.IsInRetStackNumber p
                                                               If vvv <> mystack.OriginalCode And vvv <> 0 Then
                                                                  i = Len(sbf(vvv).sb) - CLng(p) + 1
                                                                       bb$ = Mid$(sbf(vvv).sb, i)
                                                                       S3 = mystack.OriginalCode  ' ?? maybe negative???
                                                                       PopStage mystack
                                                                   GoTo subsentry10
                                                               Else
                                                              bb$ = Mid$(sbf(Abs(mystack.Parent.OriginalCode)).sb, Len(sbf(Abs(mystack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                              End If
                                                        ElseIf p < 0 Then
                                                                subspoint = False
                                                        
                                                                mystack.IsInRetStackNumber p
                                                        If mystack.RetStackTotal - RetStackSize <= 5 Then
                                                        i = Len(ec$) - CLng(p) + 1
     
                                                       bb$ = Mid$(ec$, i)
                                       

                                                        Else
                                                          If mystack.OriginalCode = 0 Then
                                                            
                                                                   bb$ = Mid$(sbf(Abs(mystack.Parent.OriginalCode)).sb, Len(sbf(Abs(mystack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                          Else
                                                            
                                                                 bb$ = Mid$(sbf(Abs(mystack.OriginalCode)).sb, Len(sbf(Abs(mystack.OriginalCode)).sb) - CLng(p) + 1)
                                                               End If
                                                               End If
                                                              
                                                              
                                                        End If
                                                
                                               
                                                              PopStage mystack
                                       GoTo subsentry10
                                       
                                       
                                    
                                                                ElseIf mystack.IsInRetStackString(bb$) Then
                                    
                                                                 If InStr(bb$, " ") > 0 Then
                                                                       
                                                              If subspoint Then mystack.RetStack.PushVal -2 - S3 Else mystack.RetStack.PushVal -1
                                                              
                                                               S3 = mystack.OriginalCode
                                                                        If searchsub(S3, bb$, i, S3) Then
                                                                          subspoint = False
                                                                            If bb$ <> "" Then
                                                                                    bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(S3).sb, i)
                                                                            Else
                                                                                    bb$ = Mid$(sbf(S3).sb, i)
                                                                            End If
                                                                            subspoint = S3 <> mystack.OriginalCode
                                                                            ok = False
                                                                            GoTo subsentry10
                                                                        ElseIf mystack.IamChild Then
                                                                        If searchsub(FindPrevOriginal(mystack), bb$, i, S3) Then
                                                                         subspoint = True
                                                                            If bb$ <> "" Then
                                                                                    bb$ = "Read NEW " + bb$ + vbCrLf + Mid$(sbf(S3).sb, i)
                                                                            Else
                                                                                    bb$ = Mid$(sbf(S3).sb, i)
                                                                            End If
                                                       
                                                                            ok = False
                                                                            GoTo subsentry10
                                                                            
                                                                                   Else
                                                              
                                                              mystack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                                        Else
                                                              
                                                              mystack.RetStack.drop 6
                                                                                    Exit Do
                                                                        End If
                                                        End If
                                    End If
                             Else
                                If subsfc Is Nothing Then
                                        Set subsfc = New FastCollection
                                End If
                                If subsfc.ExistKey(bb$) Then
                                        i = subsfc.Value
                                        GoTo jump1234
                                Else
                                i = PosLabel(bb$, ec$)
                                subsfc.AddKey bb$, i
jump1234:
                                If i = 0 Or i > Len(ec$) Then
                                    frm$ = bb$
                                    it = 2
                                    Exit Do
                                Else
                                    bb$ = Mid$(ec$, i)
                                    GoTo subsentry10
                                End If
                               End If
                            End If
                            Else
                            loopthis = False
                            End If
                                               Else
                                               If ok Then frm$ = "BREAK"
                                  once = ok
                                
                                it = 2: Set mystack.lastobj = Nothing
                                  GoTo breakexit
                    End If

                            Case Else
                                    
      
                                   If once Then Exit Do
                                    
                                    here$ = ohere$
                                   Exit Do
                            
                            End Select
                            here$ = ohere$
                              If myexit(mystack) Then it = 1: Exit Do
                            Loop
            Else
              it = 1
            End If
breakexit:
normalexit:
fastexit:
    Select Case it ''Execute(mystack, frm$, False)
    Case 0
    Set mystack.lastobj = Nothing
Set mystack.FuncObj = Nothing
        mystack.ThrowThreads  ' always throw threads
    If Not NERR Then   ' Nerr = true from command ERROR 0 means Fatal Error, shows a message and act as a crash!
            If mystack.UseGroupname <> "" Then
If InStr(mystack.UseGroupname, ChrW(&H1FFF)) > 0 Then
pa$ = GetNextLine((sbf(Abs(mystack.OriginalCode)).sb))
If InStr(pa$, ",") = 0 Then
pa$ = "'11001EDIT " + GetModuleName(mystack, here$) + "," + Mid$(pa$, 11)
End If
FK$(13) = Mid$(pa$, 7) + "-" + LTrim(Str(Len(NLtrim$(frm$))))
If Right$(GetName(sbf(x1).goodname), 2) = "()" Then
MyErMacro rest$, "Problem in class in function " + Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), ""), "Πρόβλημα στη κλάση στη συνάρτηση " + Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), "")
Else
MyErMacro rest$, "Problem in class in module " + Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), ""), "Πρόβλημα στη κλάση στο τμήμα " + Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), "")
End If
GoFunc = True
GoTo there1234
End If

        End If
        pa$ = "EDIT " & GetModuleName(mystack, here$) & ", " + CStr(Len(sbf(x1).sb))
        If Left$(sbf(x1).sb, 10) = "'11001EDIT" Then
          pa$ = Mid$(GetNextLine(sbf(x1).sb), 7) ''+ "+1"
             sbf(x1).sb = Mid$(sbf(x1).sb, 3) ' needed because we measure length...look the preparation of Shift F1 below
             Set sbf(x1).subs = Nothing
            If what$ <> "" Then
            If InStrRev(here$, ".") > 0 Then
            ' any fucntion defined inside module or function has this direction
                MyEr "in function " & Mid$(what$, InStrRev(what$, ".") + 1), "στη συνάρτηση " & Mid$(what$, InStrRev(what$, ".") + 1)
            Else
                MyEr "in function " & what$, "στη συνάρτηση " & what$
            End If
            Else
            If Right$(GetName(sbf(x1).goodname), 2) = "()" Then
                MyEr "in function ", "στη συνάρτηση "
            Else
                MyEr "in module ", "στο τμήμα "
            End If
            End If
        Else
        If Right$(here$, 1) = ")" Then
        If what$ <> "" Then
            MyEr "in function " & Left$(what$, Len(what$) - 1), "στη συνάρτηση " & Left$(what$, Len(what$) - 1)
        Else
                MyEr "in function ", "στη συνάρτηση "
        End If
        Else
        MyEr "in module " & GetName(here$), "στο τμήμα " & GetName(here$)
        End If
        
        End If
        If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then ' Maybe in a galaxy far away
            FK$(13) = pa$
        Else  ' Or in Earth
            If pa$ = vbNullString Then
            ' no we have nothing....??? when??

            Else
                ' prepare Shift F1 for a jump to the point of interest..the faulty one
                '
             
                If InStr(FK$(13), ",") > 0 Then
                 GoTo there1234
                    If Left$(pa$, InStr(pa$, ",")) = Left$(FK$(13), InStr(FK$(13), ",")) Then GoTo there1234
                 ''pa$ = pa$ + "+2"
                 ''''DropLeft ",", FK$(13)
                   '' If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                    
                End If

                    If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then
                    FK$(13) = pa$
                    Else
                    DropLeft ",", FK$(13)
                    If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                              
                    FK$(13) = pa$ & "-" & LTrim(Str(Len(frm$))) + FK$(13)
                    
                   
                    End If
 
 
            End If
        End If
there1234:
       If LastErNum = 0 Then MyErMacro rest$, "", ""
    End If
    GoFunc = False
    here$ = ohere$
    With mystack
     If .commnum <> comhash.count Then comhash.ReduceHash .commnum, sbf()
    If .numfunnum <> funid.count Then funid.ReduceHash .numfunnum
    If .strfunnum <> strfunid.count Then strfunid.ReduceHash .strfunnum
    If .numnum <> numid.count Then numid.ReduceHash .numnum
    If .strnum <> strid.count Then strid.ReduceHash .strnum
    End With
    var2used = Vars
         varhash.ReduceHash VName, var()
If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
On Error Resume Next
    
    ReDim Preserve var(UBound(var()) / 2 + 1) As Variant
Err.Clear
On Error GoTo 0
End If
 sb2used = subs
 subHash.ReduceHash snames, sbf()
   If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
            ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
    End If
  
   If Not basestack.soros Is mystack.soros Then
   End If
    basestack.soros.MergeTop mystack.soros


    Exit Do
Case 1, 3
If Len(w$) > 0 Then
pa$ = block(frm$)
If FastSymbol(frm$, "}") Then GoTo againstream
End If
emptyfunc:
here$ = mystack.OriginalName$
  mystack.ThrowThreads
''''  If Not mystack.FuncObj Is Nothing Then
Set mystack.lastobj = mystack.FuncObj
Set mystack.FuncObj = Nothing
''End If
    If MyIsObject(mystack.lastobj) Then
                 If mystack.lastobj Is Nothing Then
                 vl = mystack.FuncValue
                 Else
                Set basestack.lastobj = mystack.lastobj
                 End If
    Else
              vl = mystack.FuncValue
    End If

    here$ = ohere$
    With mystack
        If .commnum <> comhash.count Then comhash.ReduceHash .commnum, sbf()
        If .numfunnum <> funid.count Then funid.ReduceHash .numfunnum
        If .strfunnum <> strfunid.count Then strfunid.ReduceHash .strfunnum
        If .numnum <> numid.count Then numid.ReduceHash .numnum
        If .strnum <> strid.count Then strid.ReduceHash .strnum
    End With
    If Not nokillvars Then
        var2used = Vars
        varhash.ReduceHash VName, var()
        If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
            On Error Resume Next
            ReDim Preserve var(UBound(var()) / 2 + 1) As Variant
            Err.Clear
            On Error GoTo 0
        End If
        sb2used = subs
        subHash.ReduceHash snames, sbf()
        If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
        On Error Resume Next
  ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
  Err.Clear
  On Error GoTo 0
    End If
    End If
    Exit Do
Case 2
  mystack.ThrowThreads  ' for safety...
    i = 1

                        If frm$ <> "" Then
                             If frm$ = Chr$(0) Then
                                     If basestack.IsInRetStackNumber(p) Then i = Len(sbf(x1).sb) - CLng(p) + 1
                             Else
                                 If InStr(frm$, vbCr) > 0 Then
                                         i = rinstr(sbf(x1).sb, frm$)
                                         If i = 0 Then i = Len(sbf(x1).sb) + 1
                                          Else
                                          i = PosLabel(frm$, sbf(x1).sb)
                                         End If
                             End If
                             Else
                             GoTo emptyfunc
                     End If
 
Case 12
MyEr "Exit for out of for next loop", "Έξοδος για έξω από Για Επόμενο"
GoFunc = False
Exit Do

End Select

Loop
Else
rest$ = what$ & " " & rest$
GoFunc = False
End If
''''funcno = funcno - 1
End Function
Function MyCStr(p) As String
    Select Case VarType(p)
            Case vbBoolean
            MyCStr = Format$(p, ";\T\r\u\e;\F\a\l\s\e")
        Case vbLong
        MyCStr = LTrim(Str(p)) & "&"
        Case vbInteger
        MyCStr = LTrim(Str(p)) & "%"
        Case vbDecimal
        MyCStr = LTrim(Str(p)) & "@"
        Case vbSingle
        MyCStr = LTrim(Str(p)) & "~"
        Case vbCurrency
        MyCStr = LTrim(Str(p)) & "#"
        Case Else
    MyCStr = LTrim(Str(p))
    
        End Select
End Function
Sub stackshow(b As basetask)
Static OldPagio$
Dim p As Variant, r$, AL$, s$, dl$, dl2$
Static once As Boolean, ok As Boolean
If once Then Exit Sub
once = True
If TestShowCode Then
With Form2.testpad
.enabled = True
.SelectionColor = rgb(255, 64, 128)
.nowrap = True
.Text = TestShowSub
If Len(Form2.label1(1)) > 0 Then
If AscW(Form2.label1(1)) = 8191 Then
.SelStartSilent = TestShowStart - 1
.SelLength = Len(Mid$(Form2.label1(1), 7))
Else
.SelStartSilent = TestShowStart - Len(Form2.label1(1)) - 1
.SelLength = Len(Form2.label1(1))
End If


.enabled = False
If .SelLength > 1 And Not AscW(Form2.label1(1)) = 8191 Then
If Not myUcase(.SelText, True) = Form2.label1(1) Then
End If
End If
Else
.enabled = False
End If
''Debug.Print b.addlen
'MyDoEvents
End With

once = False
Exit Sub
Else
Form2.testpad.nowrap = False
End If

If pagio$ <> OldPagio$ Then
Form2.FillAgainLabels
OldPagio$ = pagio$
End If


Dim stack As mStiva
Set stack = b.soros

If Form2.Compute <> "" Then
If Form2.Compute.Prompt = "? " Then dl$ = Form2.Compute
With Form2.testpad
.enabled = True
.ResetSelColors
''
.nowrap = False
''
End With
Do
dl2 = dl$
ok = False
stackshowonly = True
If FastSymbol(dl$, ")") Then
ok = True
ElseIf IsExp(b, dl$, p) Then
    If AL$ = vbNullString Then
        If pagio$ = "GREEK" Then
        AL$ = "? " & Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & MyCStr(p)
        Else
        AL$ = "? " & Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & MyCStr(p)
        End If
            
    Else
        AL$ = AL$ & "," & Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & MyCStr(p)
    End If
    ok = True
    ElseIf IsStrExp(b, dl$, s$) Then
    If Len(dl2$) - Len(dl$) >= 0 Then
    
    
    If AL$ = vbNullString Then
        AL$ = Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & Chr(34) + s$ & Chr(34)
    Else
        AL$ = AL$ + "," + Left$(dl2$, Len(dl2$) - Len(dl$)) & "=" & Chr(34) + s$ & Chr(34)
    End If
    ok = True
    End If
    ElseIf InStr(dl$, ",") > 0 Then
       If InStr(dl$, Chr(2)) > 0 Then
     r$ = GetStrUntil(Chr(2), dl$, False)
     s$ = "<"
If ISSTRINGA(dl$, r$) Then If pagio$ <> "GREEK" Then s$ = s$ & r$
If ISSTRINGA(dl$, r$) Then If pagio$ = "GREEK" Then s$ = s$ & r$
AL$ = s$ & ">" & AL$
ok = True
Else
AL$ = AL$ & " " & GetStrUntil(",", dl$)
    
     dl$ = vbNullString
  
End If
    
    ok = True
    ElseIf dl$ <> "" Then
      If InStr(dl$, Chr(2)) > 0 Then
     r$ = GetStrUntil(Chr(2), dl$, False)
     s$ = "<"
If ISSTRINGA(dl$, r$) Then If pagio$ <> "GREEK" Then s$ = s$ & r$
If ISSTRINGA(dl$, r$) Then If pagio$ = "GREEK" Then s$ = s$ & r$
AL$ = s$ & ">" & AL$
ok = True
Else
     AL$ = AL$ & " " & dl$
     dl$ = vbNullString
  
End If

    End If
    
DropLeft ",", dl$

Loop Until Not ok
End If
stackshowonly = False
If AL$ <> "" Then AL$ = AL$ & vbCrLf
    If pagio$ = "GREEK" Then
    AL$ = AL$ & "Σωρός "
    Else
    AL$ = AL$ & "Stack "
    End If
If stack.Total = 0 Then
    If pagio$ = "GREEK" Then
    AL$ = AL$ & "Αδειος"
    Else
    AL$ = AL$ & "Empty"
    End If
Else
    If pagio$ = "GREEK" Then
    AL$ = AL$ & "Κορυφή "
    Else
    AL$ = AL$ & "Top "
    End If

End If
Dim i As Long

Do
i = i + 1
If stack.Total < i Or Len(AL$) > 400 Then Exit Do

If stack.StackItemType(i) = "N" Or stack.StackItemType(i) = "L" Then
AL$ = AL$ & MyCStr(stack.StackItem(i)) & " "
ElseIf stack.StackItemType(i) = "S" Then
r$ = stack.StackItem(i)
    If Len(r$) > 78 Then
    AL$ = AL$ & Chr(34) + Left$(r$, 75) & "..." & Chr(34)
    Else
    AL$ = AL$ & Chr(34) + r$ & Chr(34)
    End If
 ElseIf stack.StackItemType(i) = ">" Then
   If pagio$ = "LATIN" Then
    AL$ = AL$ & "[Optional] "
    Else
    AL$ = AL$ & "[Προαιρετικό] "
    End If
ElseIf stack.StackItemType(i) = "*" Then

AL$ = AL$ & stack.StackItemTypeObjectType(i) & " "
Else  '??
AL$ = AL$ & stack.StackItemTypeObjectType(i) & " "
End If

Loop
With Form2
    .gList1.backcolor = &H3B3B3B
        .label1(2) = .label1(2)
    
        .testpad.enabled = True
        .testpad.Text = AL$
        .testpad.SetRowColumn 1, 1
        .testpad.enabled = False
End With
once = False
End Sub
Function RepPara(basestack As basetask, rest$) As Boolean
Dim x1 As Long, y1 As Long, i As Long, j As Long
Dim x As Double, y As Double, ss$, s$, what$
Dim pppp As mArray, aa() As String, p As Variant
RepPara = True
        If Not IsExp(basestack, rest$, y) Then
            ' new mode
            x1 = Abs(IsLabel(basestack, rest$, what$))
            If x1 = 3 Then
                    If GetVar(basestack, what$, i) Then
                        If FastSymbol(rest$, ",") Then
                            If IsStrExp(basestack, rest$, ss$) Then
                                  aa = Split(var(i), ss$)
                                    Do While FastSymbol(rest$, ",")
                                        RepPara = True
                                        If IsExp(basestack, rest$, p) Then
                                            p = Abs(p)
                                            If FastSymbol(rest$, ":=", , 2) Then
                                                If IsStrExp(basestack, rest$, s$) Then
                                                ' HERE PLACE PART TO ARRAY, MAKE IT BIGGER IF NEEDED
                                                    If UBound(aa) < p Then
                                                        ReDim Preserve aa(p)
                                                        aa(p) = s$
                                                        Else
                                                        aa(p) = s$
                                                        
                                                    End If
                                                
                                                Else
                                                     RepPara = False
                                                End If
                                            Else
                                                RepPara = False
                                            End If
                                        Else
                                            RepPara = False
                                            Exit Do
                                        End If
                                    Loop
                                If IsObject(var(i)) Then
                                var(i).EmptyDoc
                                var(i).textDoc = Join(aa, ss$)
                                Else
                                var(i) = Join(aa, ss$)
                                End If
                                Else
                                MissStringExpr
                            End If
                        Else
                        MissPar
                        End If
                    End If
            ElseIf x1 = 6 Then
                    If neoGetArray(basestack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, basestack, what$, i, rest$) Then RepPara = False: Exit Function
                        If FastSymbol(rest$, ",") Then
                            If IsStrExp(basestack, rest$, ss$) Then
                                  aa = Split(pppp.item(i), ss$)
                                    Do While FastSymbol(rest$, ",")
                                        RepPara = True
                                        If IsExp(basestack, rest$, p) Then
                                            p = Abs(p)
                                            If FastSymbol(rest$, ":=", , 2) Then
                                                If IsStrExp(basestack, rest$, s$) Then
                                                ' HERE PLACE PART TO ARRAY, MAKE IT BIGGER IF NEEDED
                                                    If UBound(aa) < p Then
                                                        ReDim Preserve aa(p)
                                                        aa(p) = s$
                                                        Else
                                                        aa(p) = s$
                                                        
                                                    End If
                                                
                                                Else
                                                     RepPara = False
                                                End If
                                            Else
                                                RepPara = False
                                            End If
                                        Else
                                            RepPara = False
                                            Exit Do
                                        End If
                                    Loop
                                If IsObject(pppp.item(i)) Then
                                    pppp.item(i).EmptyDoc
                                    pppp.item(i).textDoc = Join(aa, ss$)
                                Else
                                    pppp.item(i) = Join(aa, ss$)
                                End If
                                Else
                                MissStringExpr
                            End If
                        Else
                        MissPar
                        End If
                        
                    End If
            Else
                MyEr "Need a string/document as variable/array item or a numeric expression, look help", "Χρειάζομαι αλφαριθμητικό ή έγγραφο σε μεταβλητή ή σε στοιχείο πίνακα ή μια έκφραση αριθμητική, δες βοήθεια"
                RepPara = False
            End If
            Exit Function
            
        Else
         If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then
                        x = Int(x)
                        If x < 1 Then
                        MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
                        Exit Function
                        End If
                     
                    End If
            Else
                x = 0
            End If
        
           
            x1 = Abs(IsLabel(basestack, rest$, what$))
            If x1 = 3 Then
                    If GetVar(basestack, what$, i) Then
                            If Typename(var(i)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                        MissSymbolMyEr "="
                                        RepPara = False
                                        Exit Function
                                    Else
                                            If Not IsStrExp(basestack, rest$, what$) Then
                                                MissStringExpr
                                                RepPara = False
                                                Exit Function
                                            Else
                                            
                                            s$ = GetNextLine(what$)
                                                 j = var(i).ParagraphFromOrder(y)
                                                 If j = -1 Then
                                                        
                                                           MyErMacro rest$, "no such paragraph" & Str(y), "δεν υπάρχει τέτοια παράγραφος" & Str(y)
                                                         Exit Function
                                                Else
                                                If x > 1 Then
                                                If what$ = vbNullString Then
                                                
                                                ss$ = var(i).TextParagraph(j)
                                                
                                                s$ = Left(ss$ + Space$(x - 1), x - 1) + s$ + Mid$(ss$, Len(s$) + x)
                                                Else
                                                
                                                s$ = Left(var(i).TextParagraph(j) + Space$(x - 1), x - 1) + s$
                                                
                                                End If
                                            
                                                End If
                                                ''var(i).ReWritePara j, s$
                                                var(i).TextParagraph(j) = s$
                                                SetNextLine what$
                                                While what$ <> ""
                                                    s$ = GetNextLine(what$)
                                                    y = y + 1
                                                    j = var(i).ParagraphFromOrder(y)
                                                    If j = -1 Then
                                                        var(i).AppendParagraph s$
                                                    Else
                                                        If what$ = vbNullString Then s$ = s$ + Mid$(var(i).TextParagraph(j), Len(s$) + 1)
                                                        ''var(i).ReWritePara j, s$
                                                        var(i).TextParagraph(j) = s$
                                                    End If
                                                    SetNextLine what$
                                                Wend
                                                
                                                End If
                                            End If
                                    End If
                            Else
                                 MissingDoc   ' only doc not string var
                                 RepPara = False
                                Exit Function
                            End If
                    Else
                        Nosuchvariable what$
                        RepPara = False
                        Exit Function
                    End If
            ElseIf x1 = 6 Then
                    If neoGetArray(basestack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, basestack, what$, i, rest$) Then RepPara = False: Exit Function
                        If Typename(pppp.item(i)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                            MissSymbolMyEr "="
                                            RepPara = False
                                            Exit Function
                                            Else
                                If IsStrExp(basestack, rest$, what$) Then
                                            s$ = GetNextLine(what$)
                                                 j = pppp.item(i).ParagraphFromOrder(y)
                                                 
                                                If j = -1 Then
                                            
                                               MyErMacro rest$, "no such paragraph" & Str(y), "δεν υπάρχει τέτοια παράγραφος" & Str(y)
                                             Exit Function
                                             Else
                                                If x > 1 Then
                                                    If what$ = vbNullString Then
                                                        ss$ = pppp.item(i).TextParagraph(j)
                                                        s$ = Left(ss$ + Space$(x - 1), x - 1) + s$ + Mid$(ss$, Len(s$) + x)
                                                    Else
                                                        s$ = Left(pppp.item(i).TextParagraph(j) + Space$(x - 1), x - 1) + s$
                                                    End If
                                                End If
                                                ''pppp.item(i).ReWritePara j, s$
                                                pppp.item(i).TextParagraph(j) = s$
                                                SetNextLine what$
                                                While what$ <> ""
                                                    s$ = GetNextLine(what$)
                                                    
                                                    y = y + 1
                                                    j = pppp.item(i).ParagraphFromOrder(y)
                                                    If j = -1 Then
                                                    
                                                    pppp.item(i).AppendParagraph s$
                                                    Else
                                                    
                                                    If what$ = vbNullString Then s$ = s$ + Mid$(pppp.item(i).TextParagraph(j), Len(s$) + 1)
                                                    
                                                   '' pppp.item(i).ReWritePara j, s$
                                                     pppp.item(i).TextParagraph(j) = s$
                                                    End If
                                                    SetNextLine what$
                                                Wend
                                                
                                              End If
                                Else
                                    MissStringExpr
                                    RepPara = False
                                    Exit Function
                                
                                End If

                            End If
                        Else
                             MissingDoc   ' only doc not string var
                             RepPara = False
                            Exit Function
                        End If
                    End If
            Else
                MissingDoc   ' only doc not string var
                RepPara = False
                Exit Function
            End If
        End If
End Function
Function IdPara(basestack As basetask, rest$, Lang As Long) As Boolean
Dim x1 As Long, y1 As Long, i As Long, it As Long, vvl As Variant
Dim x As Double, y As Double, s$, what$, w3 As Long, W4 As Long
Dim xa As Long, ya As Long
Dim pppp As mArray


IdPara = True
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
        If Not IsExp(basestack, rest$, y) Then
            MissNumExpr
            IdPara = False
            Exit Function
        Else
        
          y = y - 1
                     If y < 0 Then y = -1
         If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then
                        x = Int(x)
                        If x < 1 Then
                        MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
                        ' not needed to change idpara must be true because macro embed an ERROR command
                        Exit Function
                        End If
                   
                    End If
                    
            Else
                x = 0
            End If
        
            x1 = Abs(IsLabel(basestack, rest$, what$))
            If x1 = 3 Then
                    If GetVar(basestack, what$, i) Then
                        If Typename(var(i)) = doc Then
                                If Not FastSymbol(rest$, "=") Then
                                    MissSymbolMyEr "="
                                    IdPara = False
                                    Exit Function
                                Else
                                    If Not IsStrExp(basestack, rest$, s$) Then
                                        MissStringExpr
                                        IdPara = False
                                        Exit Function
                                    Else
                                    If y = -1 Then
                                    y = var(i).DocParagraphs
                                    End If
                                   If var(i).ParagraphFromOrder(y + 1) = -1 Then
                                   CheckVar var(i), s$
                                    ElseIf y < 1 Then
                        
                                    var(i).InsertDoc var(i).ParagraphFromOrder(1), CLng(x), s$
                                    Else
                                    var(i).InsertDoc var(i).ParagraphFromOrder(y + 1), CLng(x), s$
                                    End If
                                    End If
                                End If
                        Else
                             MissingDoc   ' only doc not string var
                             IdPara = False
                            Exit Function
                        End If
                    Else
                        Nosuchvariable what$
                        IdPara = False
                        Exit Function
                    End If
            ElseIf x1 = 6 Then
                    If neoGetArray(basestack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then IdPara = False: Exit Function
                        If Typename(pppp.item(it)) = doc Then
                                    If Not FastSymbol(rest$, "=") Then
                                            MissSymbolMyEr "="
                                            IdPara = False
                                            Exit Function
                                            Else
                                If IsStrExp(basestack, rest$, s$) Then
                                
                                
                                    If pppp.item(it).ParagraphFromOrder(y + 1) = -1 Then
                                       CheckVar pppp.item(it), s$
                                        ElseIf y < 1 Then
                                      
                                        pppp.item(it).InsertDoc pppp.item(it).ParagraphFromOrder(1), CLng(x), s$
                                        Else
                                        pppp.item(it).InsertDoc pppp.item(it).ParagraphFromOrder(y + 1), CLng(x), s$
                                        End If
                                
                                
                                
                                Else
                                    MissStringExpr
                                    IdPara = False
                                    Exit Function
                                
                                End If

                            End If
                        Else
                             MissingDoc   ' only doc not string var
                             IdPara = False
                            Exit Function
                        End If
                    End If
            Else
                MissingDoc   ' only doc not string var
                IdPara = False
                Exit Function
            End If
        End If
 ElseIf IsExp(basestack, rest$, x) Then
    x = Int(x)
    If x < 1 Then
    MyErMacro rest$, "the index base must be >=1", "η βάση δείκτη πρέπει να είναι >=1"
    ' not needed to change idpara must be true because macro embed an ERROR command
    Exit Function
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, y) Then
        MissNumExpr
        IdPara = False
        Exit Function
        End If
        y = Int(y)
        If y < 0 Then
            MyErMacro rest$, "number to delete chars must positive or zero", "ο αριθμός για να διαγράψω πρέπει να είναι θετικός ή μηδέν"
            Exit Function
        End If
    Else
    y = 0  ' only insert
    End If

     x1 = Abs(IsLabel(basestack, rest$, what$))
        If x1 = 3 Then
            If GetVar(basestack, what$, i) Then
        
                If Typename(var(i)) = doc Then
                    If Not FastSymbol(rest$, "=") Then
                    MissSymbolMyEr "="
                    IdPara = False
                    Exit Function
                    Else
                            If Not IsStrExp(basestack, rest$, s$) Then
                                MissStringExpr
                                IdPara = False
                                Exit Function
                            Else
                                    If y = 0 Then
                                           var(i).FindPos 1, 0, CLng(x), x1, y1, w3, W4
                                           If W4 = 0 Then
                                          ' ' merge to previous
                                           End If
       
                                    Else
                                             var(i).FindPos 1, 0, x + y, x1, y1, w3, W4
                                            ' so now we now the paragraph w3 and the position w4
                                            var(i).BackSpaceNchars w3, W4, y
                                    End If
                                    If s$ <> "" Then var(i).InsertDoc w3, W4, s$
                            End If
                     End If
                ElseIf Typename(var(i)) = "Constant" Then
                CantAssignValue
                    IdPara = False
            Exit Function
                
                Else
                    If Not FastSymbol(rest$, "=") Then
                    MissSymbolMyEr "="
                    IdPara = False
                    Exit Function
                    Else
                    If Not IsStrExp(basestack, rest$, s$) Then
                                MissStringExpr
                                IdPara = False
                                Exit Function
                            Else
                                    If y = 0 Then
                                        var(i) = Left$(var(i), x - 1) & s$ & Mid$(var(i), x)
                                    Else
                                        If s$ = vbNullString Then
                                        var(i) = Left$(var(i), x - 1) & Mid$(var(i), x + y)
                                        Else
                                        If Len(s$) = y Then
                                        Mid$(var(i), x, y) = s$
                                        ElseIf Len(s$) < y Then
                                        Mid$(var(i), x, y) = s$ + Space$(y - Len(s$))
                                        Else
                                        var(i) = Left$(var(i), x - 1) & s$ & Mid$(var(i), x + y)
                                        End If
                                        End If
                                    End If
                            End If
                    End If
                
                End If
            Else
            Nosuchvariable what$
            IdPara = False
            Exit Function
            
            End If
        ElseIf x1 = 6 Then
        
        
        If neoGetArray(basestack, what$, pppp) Then
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then IdPara = False: Exit Function
                If Typename(pppp.item(it)) = doc Then
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                      If y = 0 Then
                                     pppp.item(it).FindPos 1, 0, CLng(x), xa, ya, w3, W4
                                           If W4 = 0 Then
                                          ' ' merge to previous
                                           End If

                      Else
                                     pppp.item(it).FindPos 1, 0, x + y, xa, ya, w3, W4
                                            ' so now we now the paragraph w3 and the position w4
                                            pppp.item(it).BackSpaceNchars w3, W4, y
                      End If
                       If s$ <> "" Then pppp.item(it).InsertDoc w3, W4, s$
                        Else
                            MissStringExpr
                            IdPara = False
                        End If
                    End If
                Else
                If FastSymbol(rest$, "=") Then
                If IsStrExp(basestack, rest$, s$) Then
                If y = 0 Then
                    pppp.item(it) = Left$(pppp.item(it), x - 1) & s$ & Mid$(var(i), x)
                Else
                                                        If s$ = vbNullString Then
                                        pppp.item(it) = Left$(pppp.item(it), x - 1) & Mid$(pppp.item(it), x + y)
                                        Else
                                      vvl = pppp.item(it)
                                       If Len(vvl) = y Then
                                      
                                        Mid$(vvl, x, y) = s$
                                        ElseIf Len(s$) < y Then
                                            Mid$(vvl, x, y) = s$ + Space$(y - Len(s$))
                                        Else
                                        vvl = Left$(vvl, x - 1) & s$ & Mid$(vvl, x + y)
                                        End If
                                        pppp.item(it) = vvl
                                        End If
                End If
                Else
                     MissStringExpr
                            IdPara = False
                End If
                End If
                End If
        Else
            IdPara = True
        End If
        
        
        
        Else
        MissingStrVar
        IdPara = False
        ' wrong parameter
        End If


 
 
End If

End Function
Function IdentifierGroup(basestack As basetask, what$, rest$, Lang As Long) As Boolean
    IdentifierGroup = True
    Select Case what$
    Case "&"
       IdentifierGroup = MyFunction(2, basestack, rest$, Lang)
        Exit Function
    Case "FUNCTION", "ΣΥΝΑΡΤΗΣΗ"
        IdentifierGroup = MyFunction(0, basestack, rest$, Lang, True)
        Exit Function
    Case "MODULE", "ΤΜΗΜΑ"
        IdentifierGroup = MyModule(basestack, rest$, Lang, True)
        Exit Function
    Case "SUPERCLASS", "ΥΠΕΡΚΛΑΣΗ"
        IdentifierGroup = ProcClass(basestack, rest$, Lang, True)
    Exit Function
    Case "GROUP", "ΟΜΑΔΑ"
      IdentifierGroup = ProcGroup(0, basestack, rest$, Lang)
      Exit Function
    Case "CLASS", "ΚΛΑΣΗ"
        IdentifierGroup = ProcClass(basestack, rest$, Lang, False)
    Exit Function
    Case "DIM", "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ"
        IdentifierGroup = MyDim(basestack, rest$, Lang)
        Exit Function
    Case "ΚΑΤΑΣΤΑΣΗ", "INVENTORY"
        IdentifierGroup = ProcInventory(basestack, rest$, Lang)
        Exit Function
    Case "ΔΙΑΡΘΡΩΣΗ", "BUFFER"
        IdentifierGroup = ProcBuffer(basestack, rest$, Lang)
        Exit Function
    Case "EVENT", "ΓΕΓΟΝΟΣ"
     IdentifierGroup = myEvent(basestack, rest$, Lang)
     Exit Function
    Case "DOCUMENT", "ΕΓΓΡΑΦΟ"
      IdentifierGroup = MyDocument(basestack, rest$, Lang)
    Case "LONG", "ΜΑΚΡΥΣ"
        IdentifierGroup = MyLong(basestack, rest$, Lang)
    Case "ΑΠΑΡΙΘΜΗΣΗ", "ΑΠΑΡ", "ENUMERATION", "ENUM"

    IdentifierGroup = ProcEnumGroup(basestack, rest$, here$ = "")
    
    Exit Function
    End Select
End Function
Function Identifier(basestack As basetask, what$, rest$, Optional nocom As Boolean = False, Optional Lang As Long = 1) As Boolean
Dim x1 As Long, y1 As Long, it As Long, ohere$, s$, par As Boolean, p As Variant
If Not TaskMaster Is Nothing Then
If TaskMaster.PlayMusic Then
    TaskMaster.OnlyMusic = True
    TaskMaster.TimerTick
    TaskMaster.OnlyMusic = False
End If
End If
''Debug.Print what$
'On Error GoTo NERR


If what$ = vbNullString Then
    Identifier = IsLabel(basestack, rest$, what$)
     
    If Not Identifier Then Exit Function
    what$ = myUcase(what$)
    Lang = codeW(what$)
Else
    Identifier = True
    x1 = Len(rest$)
    If Left$(what$, 1) <> "@" Then
        If nocom Then GoTo JUMPHEREFORMODULESFAST
    Else
        what$ = Mid$(what$, 2)
    End If
End If
Select Case what$
Case "&"
   Identifier = MyFunction(2, basestack, rest$, Lang)
    Exit Function
Case "ΑΝΑΛΥΤΗΣ", "PROFILER"  ' no Neo...
Identifier = True
prof.MARKONE
Exit Function
Case "FUNCTION", "ΣΥΝΑΡΤΗΣΗ"
    Identifier = MyFunction(0, basestack, rest$, Lang)
    Exit Function
Case "MODULE", "ΤΜΗΜΑ"
    Identifier = MyModule(basestack, rest$, Lang)
    Exit Function
Case "SUPERCLASS", "ΥΠΕΡΚΛΑΣΗ"
    Identifier = ProcClass(basestack, rest$, Lang, True)
Exit Function
Case "EVENT", "ΓΕΓΟΝΟΣ"
 Identifier = myEvent(basestack, rest$, Lang)
 Exit Function
Case "GROUP", "ΟΜΑΔΑ"
  Identifier = ProcGroup(0, basestack, rest$, Lang)
  Exit Function
Case "CLASS", "ΚΛΑΣΗ"
    Identifier = ProcClass(basestack, rest$, Lang, False)
Exit Function
Case "DIM", "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ"
    Identifier = MyDim(basestack, rest$, Lang)
    Exit Function
Case "ΚΑΤΑΣΤΑΣΗ", "INVENTORY"
    Identifier = ProcInventory(basestack, rest$, Lang)
    Exit Function
Case "ΔΙΑΡΘΡΩΣΗ", "BUFFER"
    Identifier = ProcBuffer(basestack, rest$, Lang)
    Exit Function
Case "WAIT", "ΑΝΑΜΟΝΗ"  '' copy to NeoWait
Identifier = MyDelay(basestack, rest$)
Exit Function
Case "REPORT", "ΑΝΑΦΟΡΑ"
Identifier = MyReport(basestack, rest$, Lang)
Exit Function
Case "LET", "ΣΤΗ", "ΣΤΗΝ", "ΣΤΟ"  'ok
Identifier = MyLet(basestack, rest$, Lang)
Exit Function
Case "COMMIT", "ΑΝΕΘΕΣΕ"
Identifier = MyRead(3, basestack, rest$, Lang)
Exit Function
Case "ICON", "ΕΙΚΟΝΙΔΙΟ"
Identifier = MyIcon(basestack, rest$)
Exit Function
Case "TITLE", "ΤΙΤΛΟΣ"
Identifier = ProcTitle(basestack, rest$, Lang)
Exit Function
Case "ESCAPE", "ΔΙΑΦΥΓΗ"
Identifier = MyEscape(rest$, Lang)
Case "HIDE", "ΣΒΗΣΕ"
newHide basestack
Exit Function
Case "SHOW", "ΑΝΑΨΕ"
newshow basestack
Exit Function
Case "WRITE", "ΓΡΑΨΕ"
Identifier = MyWrite(basestack, rest$, Lang)
Exit Function
Case "TEXT", "ΚΕΙΜΕΝΟ", "HTML"  'ok
Identifier = ProcText(basestack, what$ = "HTML", rest$)
Exit Function
Case "STRUCTURE", "ΔΟΜΗ"  ' ok
Identifier = myStructure(basestack, rest$, Lang)
Exit Function
Case "ΒΑΣΗ", "BASE"   'ok
' ΝΕΑ ΒΑΣΗ
NewBase basestack, rest$
Exit Function
Case "ΑΡΧΕΙΟ", "TABLE"   'ok
NewTable basestack, rest$
' ΝΕΟΣ ΠΙΝΑΚΑΣ ΣΤΗΝ ΒΑΣΗ
Exit Function
Case "ΕΚΤΕΛΕΣΗ", "EXECUTE"   'ok
 If IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", Lang) Then
Identifier = ExecCode(basestack, rest$)
 Else
    CommExecAndTimeOut basestack, rest$
    Identifier = True
End If
' ΝΕΑ ΛΙΣΤΑ
Case "ΑΝΑΚΤΗΣΗ", "RETRIEVE"  'ok
getrow basestack, rest$, , , Lang
Exit Function
Case "ΑΝΑΖΗΤΗΣΗ", "SEARCH"  'ok
getrow basestack, rest$, , "", Lang
Exit Function
Case "ΠΡΟΣΘΗΚΗ", "APPEND"  'ok
' ΒΑΣΗ,ΠΙΝΑΚΑΣ,ΣΤΟΙΧΕΙΑ
par = Appfields(basestack, rest$)
Exit Function
Case "ΑΦΑΙΡΕΣΗ", "DELETE"  'ok
' ΒΑΣΗ, ΠΙΝΑΚΑΣ,ΠΟΙΟ , ΤΙ
par = DELfields(basestack, rest$)
Exit Function
Case "ΤΑΞΗ", "ORDER"  'ok
MyOrder basestack, rest$
Exit Function
Case "ΕΠΙΣΤΡΟΦΗ", "RETURN"  ' no need here
' ΒΑΣΗ,"SELECT ΠΙΝΑΚΑΣ",ΣΤΟΙΧΕΙΑ
If IsStrExp(basestack, rest$, s$) Then
append_table basestack, s$, rest$, True, Lang
End If
Exit Function
Case "ΣΥΜΠΙΕΣΗ", "COMPRESS"  'ok
BaseCompact basestack, rest$
Exit Function
Case "LAYER", "ΕΠΙΠΕΔΟ" ' ok
Identifier = ProcLayer(basestack, rest$)
Exit Function
Case "PRINTER", "ΕΚΤΥΠΩΤΗΣ"  ' ok
Identifier = ProcPrinter(basestack, rest$)
Exit Function
Case "MOTION", "ΚΙΝΗΣΗ"
Identifier = ProcMotion(basestack, rest$, Lang)
Exit Function
Case "PAGE", "ΣΕΛΙΔΑ" 'ok
ProcPage basestack, rest$, Lang
Exit Function
Case "PRINTING", "ΕΚΤΥΠΩΣΗ"
 Identifier = ProcPrinting(basestack, rest$, Lang)
 Exit Function
Case "FORMLABEL", "ΕΤΙΚΕΤΑ.ΦΟΡΜΑΣ"
Identifier = ProcLabel(basestack, rest$)
Exit Function
Case "LEGEND", "ΕΠΙΓΡΑΦΗ"
' NEW JUSTIFY...1 RIGHT,2 CENTER ,3 LEFT
Identifier = ProcLegend(basestack, rest$)
Exit Function
Case "MEDIA", "MOVIE", "ΤΑΙΝΙΑ", "MUSIC", "ΜΟΥΣΙΚΗ"  ' μόνο ένα και μπορεί να περιμένει ή να το διώξει για άλλο
Identifier = ProcMedia(basestack, rest$, Lang)
Exit Function
Case "PUT", "ΔΩΣΕ"
Identifier = MyPut(basestack, rest$)
Exit Function
Case "ΦΟΡΜΑ", "FORM"
Kform = True
Identifier = MakeForm(basestack, rest$)
Exit Function
Case "SUBDIR", "ΥΠΟΚΑΤΑΛΟΓΟΣ"
    Identifier = ProcSubDir(basestack, rest$, Lang)
Exit Function
Case "DIR", "ΚΑΤΑΛΟΓΟΣ"
    Identifier = ProcDir(basestack, rest$, Lang)
Exit Function
Case "START", "ΑΡΧΗ"
    
    Identifier = newStart(basestack, rest$)
    Exit Function
Case "REMOVE", "ΔΙΑΓΡΑΦΗ"
    Identifier = ProcRemove(basestack, rest$, Lang)
Exit Function
Case "DEF", "ΚΑΝΕ"
    Identifier = ProcDef(basestack, rest$, Lang)
    Exit Function
Case "LOAD", "ΦΟΡΤΩΣΕ" '
Identifier = ProcLoad(basestack, rest$, Lang)
Exit Function
Case "SAVE", "ΣΩΣΕ"
Identifier = ProcSave(basestack, rest$, Lang)
Exit Function
Case "OVERWRITE", "ΚΑΤΑΧΩΡΗΣΗ"
Identifier = RepPara(basestack, rest$)
Exit Function
Case "INSERT", "ΠΑΡΕΜΒΟΛΗ"
Identifier = IdPara(basestack, rest$, Lang)
Exit Function
Case "LONG", "ΜΑΚΡΥΣ"
Identifier = MyLong(basestack, rest$, Lang)
Exit Function
Case "DOCUMENT", "ΕΓΓΡΑΦΟ"
Identifier = MyDocument(basestack, rest$, Lang)
Exit Function
Case "STOCK", "ΣΤΟΚ"
Identifier = StockValues(basestack, rest$, Lang)
Exit Function
Case "LINK", "ΕΝΩΣΕ"
Identifier = MyLink(basestack, rest$, Lang)
Exit Function
Case "REFER", "ΑΠΕΔΩΣΕ"
Identifier = MyRead(2, basestack, rest$, Lang)
Exit Function
Case "READ", "ΔΙΑΒΑΣΕ"
Identifier = MyRead(1, basestack, rest$, Lang)
Exit Function
Case "DOUBLE", "ΔΙΠΛΑ"
SetDouble basestack.Owner
Exit Function
Case "NORMAL", "ΚΑΝΟΝΙΚΑ"
SetNormal basestack.Owner
Exit Function
Case "ERROR", "ΛΑΘΟΣ"
Identifier = MyError(basestack, rest$, Lang)
Exit Function
Case "SET", "ΘΕΣΕ"
    Identifier = interpret(basestack, GetNextLine(rest$))
    Exit Function
Case "NEW", "ΝΕΟ"
    Identifier = MyNew(basestack, rest$, Lang)
    Exit Function
Case "EDIT", "ΣΥΓΓΡΑΦΗ", "Σ"
    Identifier = ProcEdit(basestack, rest$, Lang)
    Exit Function
Case "SCAN", "ΣΑΡΩΣΕ"
    Identifier = MyScan(basestack, rest$)
    Exit Function
Case "ΠΕΝΑ", "PEN"
    Identifier = ProcPen(basestack, rest$)
    Exit Function
Case "ΟΘΟΝΗ", "CLS"
    Identifier = ProcCls(basestack, rest$)
    Exit Function
Case "HEX", "ΔΕΚΑΕΞ"
    Identifier = RevisionPrint(basestack, rest$, 1, Lang)
    Exit Function
Case "PRINT", "ΤΥΠΩΣΕ", "?"
    Identifier = RevisionPrint(basestack, rest$, 0, Lang)
    Exit Function
Case "BACK", "BACKGROUND", "ΠΕΡΙΘΩΡΙΟ"
    ProcBackGround basestack, rest$, Lang, Identifier
    Exit Function
Case "PUSH", "ΒΑΛΕ"
    par = MyPush(basestack, rest$)
    Exit Function
Case "DATA", "ΣΕΙΡΑ"
    par = MyData(basestack, rest$)
    Exit Function
Case "SWAP", "ΑΛΛΑΞΕ"
    Identifier = MySwap(basestack, rest$, Lang)
    Exit Function
Case "CLOSE", "ΚΛΕΙΣΕ"
    Identifier = MyClose(basestack, rest$, Lang)
    Exit Function
Case "SEEK", "ΜΕΤΑΘΕΣΗ"
    Identifier = MySeek(basestack, rest$)
    Exit Function
Case "APPEND.DOC", "ΠΡΟΣΘΕΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcSaveDoc(1, basestack, rest$)
    Exit Function
Case "SAVE.DOC", "ΣΩΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcSaveDoc(0, basestack, rest$)
    Exit Function
Case "MERGE.DOC", "ΣΥΓΧΩΝΕΥΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcLoadDoc(1, basestack, rest$)
    Exit Function
Case "LOAD.DOC", "ΦΟΡΤΩΣΕ.ΕΓΓΡΑΦΟ"
    Identifier = ProcLoadDoc(0, basestack, rest$)
    Exit Function
Case "FIND", "ΕΥΡΕΣΗ"
    Identifier = ProcFind(basestack, rest$)
    Exit Function
Case "WORDS", "ΛΕΞΕΙΣ"
    Identifier = ProcWords(basestack, rest$)
    Exit Function
Case "SORT", "ΤΑΞΙΝΟΜΗΣΗ"
    Identifier = ProcSort(basestack, rest$, Lang)
    Exit Function
Case "OVER", "ΠΑΝΩ"  'ΑΝΤΙΓΡΑΦΕΙ ΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcOver(basestack, rest$)
    Exit Function
Case "SHIFTBACK", "ΦΕΡΕΠΙΣΩ"  'ΜΕΤΑΚΙΝΕΙ ΑΠΟ ΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcShiftBack(basestack, rest$)
    Exit Function
Case "SHIFT", "ΦΕΡΕ"  'ΜΕΤΑΚΙΝΕΙ ΣΤΗΝ ΚΟΡΥΦΗ
    Identifier = ProcShift(basestack, rest$)
    Exit Function
Case "DROP", "ΠΕΤΑ"
    Identifier = ProcDrop(basestack, rest$, Lang)
    Exit Function
Case "SCREEN.PIXELS", "ΑΝΑΛΥΣΗ.ΟΘΟΝΗΣ"
    Identifier = ProcScreenRes(basestack, rest$)
    Exit Function
Case "SOUNDREC", "ΗΧΟΓΡΑΦΗΣΗ"
    Identifier = ProcSoundRec(basestack, rest$, Lang)
    Exit Function
Case "KEYBOARD", "ΠΛΗΚΤΡΟΛΟΓΙΟ"
    Identifier = ProcKeyboard(basestack, rest$)
    Exit Function
Case "JOYPAD", "ΛΑΒΗ"
    Identifier = ProcJoypad(basestack, rest$)
    Exit Function
Case "PIPE", "ΑΥΛΟΣ"
    Identifier = ProcPipe(basestack, rest$)
    Exit Function
Case "GET", "ΠΑΡΕ"
    Identifier = ProcGet(basestack, rest$)
    Exit Function
Case "ΝΗΜΑ", "THREAD"
    Identifier = MyThread(basestack, rest$, Lang)
    Exit Function
Case "HOLD", "ΚΡΑΤΗΣΕ"
    Identifier = ProcHold(basestack)
    Exit Function
Case "RELEASE", "ΑΦΗΣΕ"
    Identifier = ProcRelease(basestack)
    Exit Function
Case "USE", "ΧΡΗΣΗ"
    Identifier = ProcUSE(basestack, rest$, Lang)
    Exit Function
Case "OPEN.FILE", "ΑΝΟΙΓΜΑ.ΑΡΧΕΙΟΥ"
    Identifier = ProcOpenFile(basestack, rest$, Lang)
    Exit Function
Case "OPEN.IMAGE", "ΑΝΟΙΓΜΑ.ΕΙΚΟΝΑΣ"
    Identifier = ProcOpenImage(basestack, rest$, Lang)
    Exit Function
Case "FLUSH", "ΑΔΕΙΑΣΕ"
    Identifier = ProcFlush(basestack, rest$, Lang)
    Exit Function
Case "PROPERTIES", "ΙΔΙΟΤΗΤΕΣ"  ''for printer
    Identifier = ProcPropeties(basestack, rest$)
    Exit Function
Case "SPEECH", "ΛΟΓΟΣ"
    Identifier = ProcSpeech(basestack, rest$)
    Exit Function
Case "DOS", "ΚΟΝΣΟΛΑ"
    Identifier = ProcDos(basestack, rest$)
    Exit Function
Case "WIN", "ΣΥΣ", "ΣΥΣΤΗΜΑ"
    Identifier = ProcWin(basestack, rest$)
    Exit Function
Case "WINDOW", "ΠΑΡΑΘΥΡΟ"
    Kform = True
    ProcWindow basestack, rest$, basestack.Owner, Identifier
    Exit Function
Case "FIELD", "ΠΕΔΙΟ"
    Identifier = ProcField(basestack, rest$, Lang)
    Exit Function
Case "TEST", "ΔΟΚΙΜΗ"
    Identifier = procTestMe(basestack, rest$, what$)
    Exit Function
Case "MOUSE.ICON", "ΔΕΙΚΤΗ.ΜΟΡΦΗ"
    i3MouseIcon basestack, rest$, Lang
    Exit Function
Case "MOTION.W", "ΚΙΝΗΣΗ.Π"
    Identifier = procMotionW(basestack, rest$)
    Exit Function
Case "CLIPBOARD", "ΠΡΟΧΕΙΡΟ"
    Identifier = MyClipboard(basestack, rest$)
    Exit Function
Case "ΒΟΗΘΕΙΑ", "HELP"
    Identifier = MyHelp(basestack, rest$, Lang)
    Exit Function
Case "CLEAR", "ΚΑΘΑΡΟ"
    Identifier = MyClear(basestack, rest$)
    Exit Function
Case "DECLARE", "ΟΡΙΣΕ"  'OBJECT
    Identifier = MyDeclare(basestack, rest$, Lang)
    Exit Function
Case "REM", "ΣΗΜ"
    NeoRem 0, rest$, 0, Identifier
    Exit Function
Case "VOLUME", "ΕΝΤΑΣΗ"
    Identifier = MyVol(basestack, rest$)
    Exit Function
Case "ABOUT", "ΠΕΡΙ"
    ProcAbout basestack, rest$, Lang
    Exit Function
Case "SMOOTH", "ΟΜΑΛΑ"
        If IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", Lang) Then
        GDILines = False
        ElseIf IsLabelSymbolNew(rest$, "ΝΑΙ", "ON", Lang) Then
        GDILines = True
        End If
    Exit Function
Case "OPTIMIZATION", "ΒΕΛΤΙΣΤΟΠΟΙΗΣΗ"  '' not a
        If IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", Lang) Then
        NoOptimum = True
        ElseIf IsLabelSymbolNew(rest$, "ΝΑΙ", "ON", Lang) Then
        NoOptimum = False
        End If
    Exit Function
Case "LINESPACE", "ΔΙΑΣΤΙΧΟ"  'ok
    Identifier = procLineSpace(basestack, rest$)
    Exit Function
Case "BOLD", "ΦΑΡΔΙΑ"      'ok
    ProcBold basestack, rest$
    Exit Function
Case "MODE", "ΤΥΠΟΣ"
    Identifier = ProcMode(basestack, rest$)
    Exit Function
Case "GRADIENT", "ΦΟΝΤΟ"
    Identifier = ProcGradient(basestack, rest$)
    Exit Function
Case "CHOOSE.OBJECT", "ΕΠΕΛΕΞΕ.ΑΝΤΙΚΕΙΜΕΝΟ", "ΕΠΙΛΕΞΕ.ΑΝΤΙΚΕΙΜΕΝΟ"
    ProcChooseObj basestack, rest$, Lang
    Exit Function
Case "CHOOSE.FONT", "ΕΠΕΛΕΞΕ.ΓΡΑΜΜΑΤΟΣΕΙΡΑ", "ΕΠΙΛΕΞΕ.ΓΡΑΜΜΑΤΟΣΕΙΡΑ"
    ProcChooseFont basestack, Lang
    Exit Function
Case "INPUT", "ΕΙΣΑΓΩΓΗ"   ' ok
    Identifier = MyInput(basestack, rest$, Lang)
    Exit Function
Case "ΝΗΜΑΤΑ", "THREADS"
    procthreads basestack.Owner, basestack, rest$, Lang
    Exit Function
Case "ΟΡΙΟ.ΑΝΑΔΡΟΜΗΣ", "RECURSION.LIMIT"
    Identifier = ProcRecursionLimit(basestack, rest$, Lang)
    Exit Function
Case "LOCALE", "ΤΟΠΙΚΟ"
    Identifier = ProcSalata(3, basestack, rest$)
    Exit Function
Case "CODEPAGE", "ΚΩΔΙΚΟΣΕΛΙΔΑ"
    Identifier = ProcSalata(2, basestack, rest$)
    Exit Function
Case "CHARSET", "ΧΑΡΑΚΤΗΡΕΣ"
    Identifier = ProcSalata(1, basestack, rest$)
    Exit Function
Case "STEP", "ΒΗΜΑ"
    Identifier = ProcStep(basestack, rest$, Lang)
    Exit Function
Case "MOVE", "ΘΕΣΗ"
    Identifier = ProcMove(basestack, rest$)
    Exit Function
Case "ΠΟΛΥΓΩΝΟ", "POLYGON"
    Identifier = ProcPoly(basestack, rest$, Lang)
    Exit Function
Case "CIRCLE", "ΚΥΚΛΟΣ"
    Identifier = ProcCircle(basestack, rest$, Lang)
    Exit Function
Case "PLAYER", "ΠΑΙΚΤΗΣ"
    Identifier = ProcPlayer(basestack, rest$, Lang)
    Exit Function
Case "IMAGE", "ΕΙΚΟΝΑ"
    Identifier = ProcImage(basestack, rest$, Lang)
    Exit Function
Case "SPRITE", "ΔΙΑΦΑΝΟ", "ΔΙΑΦΑΝΕΙΑ"
    ' ok NeoSprite exist
    If IsStrExp(basestack, rest$, s$) Then
        sprite basestack, s$, rest$
    ElseIf IsExp(basestack, rest$, p) Then
        spriteGDI basestack, rest$
    End If
    If LastErNum1 <> 0 Then Identifier = False
    Exit Function
Case "COPY", "ΑΝΤΕΓΡΑΨΕ", "ΑΝΤΙΓΡΑΨΕ"
    Identifier = MyCopy(basestack, rest$, Lang)
    Exit Function
Case "ΠΑΙΞΕ", "PLAY"
    Identifier = MyPlayScore(basestack, rest$)
    Exit Function
Case "SCORE", "ΦΩΝΗ"
    Identifier = MyScore(basestack, rest$)
    Exit Function
Case "TARGETS", "ΣΤΟΧΟΙ"
    Identifier = ProcTargets(basestack, rest$, Lang)
    Exit Function
Case "LATIN", "ΛΑΤΙΝΙΚΑ"
    LATIN basestack '****************************************************************
    Exit Function
Case "GREEK", "ΕΛΛΗΝΙΚΑ"
    GREEK basestack
    Exit Function
Case "MODULES", "ΤΜΗΜΑΤΑ"
    Identifier = MyModules(basestack, rest$, Lang)
    Exit Function
Case "FILES", "ΑΡΧΕΙΑ"
    Identifier = ProcFiles(basestack, rest$, Lang)
    Exit Function
Case "CAT", "ΚΑΤΑΛΟΓΟΙ", "ΚΑΤ"
    Identifier = ProcCat(basestack, rest$, Lang)
    Exit Function
Case "DRAWINGS", "ΣΧΕΔΙΑ"
    Identifier = MyDrawings(basestack, rest$, Lang)
    Exit Function
Case "BITMAPS", "ΕΙΚΟΝΕΣ"
    Identifier = MyBitmaps(basestack, rest$, Lang)
    Exit Function
Case "MOVIES", "ΤΑΙΝΙΕΣ"
    Identifier = MyMovies(basestack, rest$, Lang)
    Exit Function
Case "SOUNDS", "ΗΧΟΙ"
    Identifier = MySounds(basestack, rest$, Lang)
    Exit Function
Case "WRITER", "ΣΥΓΓΡΑΦΕΑΣ"
    Identifier = ProcWriter(basestack, rest$, Lang)
    Exit Function
Case "LIST", "ΛΙΣΤΑ"
    Identifier = ProcList(basestack, rest$, Lang)
    Exit Function
Case "FRAME", "ΠΛΑΙΣΙΟ" ' BOX X1,Y1,COL,BOX
    Identifier = MyFrame(basestack, rest$)
    Exit Function
Case "MARK", "ΣΗΜΑΔΙ"
    Identifier = MyMark(basestack, rest$)
    Exit Function
Case "LINE", "ΓΡΑΜΜΗ"
    Identifier = MyLineInput(basestack, rest$, Lang)
    Exit Function
Case "CURSOR", "ΔΡΟΜΕΑΣ" ' CURSOR X,Y
    Identifier = MyCursor(basestack, rest$)
    Exit Function
Case "FILL", "ΒΑΨΕ"
    Identifier = ProcFill(basestack, rest$)
    Exit Function
Case "FLOODFILL", "ΓΕΜΙΣΕ"
    Identifier = ProcFLOODFILL(basestack, rest$, Lang)
    Exit Function
Case "ΧΑΡΑΞΕ", "DRAW"   ' LINE X1,Y1,COL
    Identifier = ProcDraw(basestack, rest$, Lang)
    Exit Function
Case "WIDTH", "ΠΑΧΟΣ"
    Identifier = ProcDrawWidth(basestack, rest$)
    Exit Function
Case "ΚΑΜΠΥΛΗ", "CURVE"
    Identifier = ProcCurve(basestack, rest$, Lang)
    Exit Function
Case "PATH", "COLOR", "ΧΡΩΜΑ", "ΙΧΝΟΣ"
    Identifier = ProcPath(basestack, rest$, Lang)
    Exit Function
Case "DESKTOP", "ΕΠΙΦΑΝΕΙΑ"
    Identifier = ProcDesktop(basestack, rest$, Lang)
    Exit Function
Case "CHOOSE.COLOR", "ΕΠΕΛΕΞΕ.ΧΡΩΜΑ", "ΕΠΙΛΕΞΕ.ΧΡΩΜΑ"
    Identifier = ProcChooseColor(basestack, rest$, Lang)
    Exit Function
Case "SAVE.AS", "ΑΠΟΘΗΚΕΥΣΗ.ΩΣ"
    Identifier = ProcSaveAs(basestack, rest$, Lang)
    Exit Function
Case "ΑΛΛΑΓΗ", "CHANGE"
    Identifier = ProcCHANGE(basestack, rest$, Lang)
    Exit Function
Case "STACK", "ΣΩΡΟΣ"
    Identifier = ProcStack(basestack, rest$, Lang)
    Exit Function
Case "ΕΚΔΟΣΗ", "VERSION"
    Identifier = ProcVersion(basestack)
    Exit Function
Case "FONT", "ΓΡΑΜΜΑΤΟΣΕΙΡΑ"
    Identifier = ProcFont(basestack, rest$)
    Exit Function
Case "SCROLL", "ΚΥΛΙΣΗ"
    Identifier = ProcSrcoll(basestack, rest$, Lang)
    Exit Function
Case "EDIT.DOC", "ΔΙΟΡΘΩΣΕ"
    Identifier = ProcEditDoc(basestack, rest$, Lang)
    Exit Function
Case "ITALIC", "ΠΛΑΓΙΑ"   '.......................
    Identifier = ProcItalic(basestack, rest$)
    Exit Function
Case "ΚΛΕΙΔΙ", "FKEY"
    Identifier = ProcFKey(basestack, rest$, Lang)
    Exit Function
Case "OPEN", "ΑΝΟΙΞΕ"
    Identifier = ProcOpen(basestack, rest$, Lang)
    Exit Function
Case "NAME", "ΟΝΟΜΑ"
    Identifier = ProcName(basestack, rest$, Lang)
    Exit Function
Case "WITH", "ΜΕ"
    Identifier = MyWith(basestack, rest$, Lang)
    Exit Function
Case "METHOD", "ΜΕΘΟΔΟΣ"
    Identifier = MyMethod(basestack, rest$, Lang)
    Exit Function
Case "TUNE", "ΜΕΛΩΔΙΑ"
    Identifier = ProcTune(basestack, rest$)
    Exit Function
Case "ΗΧΟΣ", "SOUND"
    Identifier = ProcSound(basestack, rest$)
    Exit Function
Case "DB.USER", "ΒΑΣΗ.ΧΡΗΣΤΗΣ"
    Identifier = ProcDBUSER(basestack, rest$, Lang)
    Exit Function
Case "DB.PROVIDER", "ΒΑΣΗ.ΠΑΡΟΧΟΣ"
    Identifier = ProcDBprovider(basestack, rest$, Lang)
    Exit Function
Case "TONE", "ΤΟΝΟΣ"
    Identifier = ProcTone(basestack, rest$)
    Exit Function
Case "VIEW", "ΔΕΙΞΕ"
    Identifier = ProcView(basestack, rest$, Lang)
    Exit Function
Case "CHOOSE.ORGAN", "ΕΠΕΛΕΞΕ.ΟΡΓΑΝΟ", "ΕΠΙΛΕΞΕ.ΟΡΓΑΝΟ"
    Identifier = ProcChooseOrgan(basestack, rest$, Lang)
    Exit Function
Case "BROWSER", "ΑΝΑΛΟΓΙΟ"
    Identifier = ProcBrowser(basestack, rest$, Lang)
    Exit Function
Case "ΜΠΙΠ", "BEEP"
    Identifier = ProcBeep(basestack, rest$)
    Exit Function
Case "MENU", "ΕΠΙΛΟΓΗ"
    Identifier = MyMenu(0, basestack, rest$, Lang)
    Exit Function
Case "THREAD.PLAN", "ΣΧΕΔΙΟ.ΝΗΜΑΤΩΝ"
    Identifier = ProcThreadPlan(basestack, rest$, Lang)
    Exit Function
Case "ΡΥΘΜΙΣΕΙΣ", "SETTINGS"
    Identifier = ProcSettings(basestack, rest$, Lang)
    Exit Function
Case "PROTOTYPE", "ΠΡΩΤΟΤΥΠΟ"
    Identifier = ProcProto(basestack, rest$, Lang)
    Exit Function
Case "ΑΠΑΡΙΘΜΗΣΗ", "ΑΠΑΡ", "ENUMERATION", "ENUM"
    Identifier = ProcEnum(basestack, rest$, here$ = "")
    Exit Function
Case Else
    x1 = Len(rest$)
    Identifier = True
JUMPHEREFORMODULESFAST:
            MakeThisSub basestack, what$
          If GetSub(what$, y1) Then
               it = 0
            ElseIf GetSub(here$ & "." & what$, y1) Then
                    it = 1
            ElseIf basestack.UseGroupname <> "" Then
            ' If what$ Like basestack.UseGroupname + "*" Then
            If InStr(what$, basestack.UseGroupname) = 1 Then
            what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
            If GetSub(what$, y1) Then
                it = 0
            ElseIf GetSub(here$ & "." & what$, y1) Then
            it = 1
            Else
            GoTo conthereplease
            End If
            Else
            GoTo conthereplease
            End If
            Else
conthereplease:
                rest$ = what$ + rest$
                   MyEr "unknown module " & what$, "’γνωστο τμήμα " & what$
                   
                   Identifier = False
                   Exit Function
            End If
            If NORUN1 Then rest$ = vbNullString: Exit Function


            x1 = y1
            If Len(what$) = 0 Then Identifier = False: Exit Function
            '''funcno = funcno + 1
            what$ = myUcase(what$):   MakeThisSub basestack, what$
            ohere$ = here$
            If it = 0 Then
            If SecureNames Then
            
                If here$ = vbNullString Then
                s$ = what$
                Else
                s$ = RVAL33(here$, x1)
                End If
            Else
                s$ = what$
            End If
            
            Else
                s$ = ohere$ + "." & what$
            End If
            y1 = var2used
            par = PushParamGeneral(basestack, rest$, s$)
            y1 = y1 - var2used
            If LastErNum = -2 Then
                If Left$(rest$, 12) <> " : ERROR -2" Then rest$ = vbNullString
                    Identifier = True
                    Exit Function
                    Else
                If Not par Then Identifier = False: Exit Function
            End If
            here$ = s$
            With basestack
                 If .OriginalCode <> x1 And x1 <> 0 Then
                    .callohere = ohere$
                    .callx1 = x1
                    .ByName = y1
                    Identifier = True
                Else
                MyErMacro rest$, "Use Call command to call recuirsive in module", "Χρησιμοποίησε την Κάλεσε για αναδρομική κλήση τμήματος"
                If here$ <> ohere$ Then here$ = ohere$
                Identifier = True
                End If
            End With
            Exit Function
NERR:

                        If MOUT And rest$ = vbNullString Then
                        Else
                                MyErMacro rest$, "unknown identifier " & what$, "’γνωστο αναγνωριστικό " & what$
                        End If
                        Identifier = True
            
End Select


End Function

Sub SpaceForVar(j As Long)
var2used = var2used + 1
If UBound(var()) <= var2used + 20 Then
On Error Resume Next
    ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
    If Err.Number > 0 Then
    If UBound(var()) <= var2used Then
    ' space for 20 variables because maybe sometimne we have locked the array,
    ' so we do the preserve another time
    Err.Clear
    Else
    NOEXECUTION = True
    MyEr Err.Description, Err.Description
    Err.Clear
    Exit Sub
    End If
    End If
End If
j = var2used
End Sub
Function ReboundArr(bstack As basetask, name$, arrcode As Long) As Boolean
On Error GoTo 0
Dim ss$
name$ = myUcase(name$)
If Left$(name$, 5) = "ΑΥΤΟ." Or Left$(name$, 5) = "THIS." Then
    ss$ = bstack.UseGroupname & Mid$(name$, 6)
Else
    If here$ = vbNullString Then
        ss$ = name$
    Else
        ss$ = here$ & "." & name$
    End If
End If

ReboundArr = varhash.findRebound(ss$, arrcode, var())

End Function
Function ReboundVar(bstack As basetask, name$, q As Long) As Boolean
On Error GoTo 0
Dim ss$
name$ = myUcase(name$)
If Left$(name$, 5) = "ΑΥΤΟ." Or Left$(name$, 5) = "THIS." Then
    ss$ = bstack.UseGroupname & Mid$(name$, 6)
Else
    If here$ = vbNullString Then
        ss$ = name$
    Else
        ss$ = here$ & "." & name$
    End If
End If

ReboundVar = varhash.findRebound(ss$, q, var())

End Function
Function globalvar(name$, q As Variant, Optional link As Boolean = False, Optional makeitglobal As Boolean = False, Optional ohere$ = vbNullString) As Long
On Error GoTo 0
Dim j As Long, m As Long

If Not link Then
If ohere$ <> vbNullString Then
If varhash.Find2(ohere$ + "." + myUcase(name$), m, makeitglobal) And Not link Then
If Not makeitglobal Then
    j = m
    Else
    j = AllocVar()
    varhash.ItemCreator ohere$ + "." + myUcase(name$), j, link, False, True
    End If
    
Else
    j = AllocVar()
    varhash.ItemCreator ohere$ + "." + myUcase(name$), j, link, False, False
End If
ohere$ = vbNullString

    If MyIsObject(q) Then
        Set var(j) = q
    Else
     If Right$(name$, 1) = "%" Then
                On Error Resume Next
                q = MyRound(q)
                If Err.Number = 6 Then q = 0
                On Error GoTo 0
            End If
    
    
        var(j) = q
    End If
globalvar = j
Exit Function
End If
j = AllocVar()

    If MyIsObject(q) Then
        Set var(j) = q
    Else
                If Right$(name$, 1) = "%" Then
                On Error Resume Next
                q = MyRound(q)
                If Err.Number = 6 Then q = 0
                On Error GoTo 0
            End If
        var(j) = q
    End If

Else
If CStr(q) = vbNullString Then
j = 0
Else
    j = CLng(q)
End If
End If
If here$ = vbNullString Or makeitglobal Then
varhash.ItemCreator myUcase(name$), j, link, makeitglobal, True
Else
varhash.ItemCreator here$ & "." & myUcase(name$), j, link, , True
End If
globalvar = j
End Function
Function GlobalVarRefOnly(name$, Optional gl As Boolean = False) As Long
On Error GoTo 0
Dim j As Long
j = AllocVar() ' var2used
 var(j) = CLng(0)  ' like an empty...
If here$ = vbNullString Or gl Then
varhash.ItemCreator myUcase(name$), j, , gl
Else
varhash.ItemCreator here$ & "." & myUcase(name$), j, , gl

End If
GlobalVarRefOnly = j
End Function
Sub GlobalVarRefLink(name$, j As Long, Optional gl As Boolean = False)
On Error GoTo 0
If here$ = vbNullString Or gl Then
varhash.ItemCreator myUcase(name$), j, True, gl
Else
varhash.ItemCreator here$ & "." & myUcase(name$), j, gl

End If
End Sub


Function LinkGroup(bstack As basetask, ByVal name$, q As Variant, Optional usefinal As Boolean = False) As Boolean
Dim i As Long, Vlist As Boolean, FList, F$, aa$, v As Long
Dim s() As String, ThisGroup As Group, OtherGoup As Group
If Typename(q) <> "Group" Then Exit Function
'Debug.Print "link to ", name$

Dim OLD1 As String
OLD1 = bstack.UseGroupname
If q.IamApointer Then
Exit Function
If q.link.IamFloatGroup Then Exit Function

End If

If Not usefinal Then
If here$ = vbNullString Then
name$ = myUcase(name$) + "."
Else
If bstack.UseGroupname <> "" Then
If q.IamFloatGroup Then
    name$ = myUcase(name$) + "."
Else
    bstack.UseGroupname = here$
       name$ = myUcase(name$) + "."
    GoTo cont1
End If
Else
 name$ = here$ & "." & myUcase(name$) + "."
 End If
End If
Else

End If


bstack.UseGroupname = vbNullString
cont1:
With q


FList = .FuncList
With q.soros
For i = 1 To .Total
aa$ = .StackItem(i)

v = Split(aa$)(1)
Vlist = True
Select Case Typename(var(v))
Case "Group"
    Set ThisGroup = var(v)
    If Left$(Split(aa$)(0), 1) = "*" Then
       varhash.ItemCreator name$ + Mid$(Split(aa$)(0), 2), CLng(val(v)), True
       If ThisGroup.HasStrValue Then
       varhash.ItemCreator name$ + Mid$(Split(aa$)(0), 2) + "$", CLng(val(v)), True
       End If
   LinkGroup bstack, name$ + Mid$(Split(aa$)(0), 2) + ".", var(val(Split(aa$)(1))), True
        
    Else
    
    varhash.ItemCreator name$ + Split(aa$)(0), CLng(val(v)), True
          
            
                ThisGroup.edittag = .edittag
                ThisGroup.FuncList = .FuncList
                ThisGroup.GroupName = myUcase(name$) + "."
                Set ThisGroup.Sorosref = .soros.Copy
                ThisGroup.HasValue = .HasValue
                ThisGroup.HasSet = .HasSet
                ThisGroup.HasStrValue = .HasStrValue
                ThisGroup.HasParameters = .HasParameters
                ThisGroup.HasParametersSet = .HasParametersSet
                 Set ThisGroup.SuperClassList = .SuperClassList
                Set ThisGroup.Events = .Events
                ThisGroup.highpriorityoper = .highpriorityoper
                ThisGroup.HasUnary = .HasUnary
          
             ThisGroup.IamRef = Len(bstack.UseGroupname) > 0
    If ThisGroup.HasStrValue Then
    varhash.ItemCreator name$ + Split(aa$)(0) + "$", CLng(val(v)), True
    End If
    
    LinkGroup bstack, name$ + Split(aa$)(0) + ".", var(val(Split(aa$)(1))), True
    End If

Case Else

    varhash.ItemCreator name$ + Split(aa$)(0), CLng(val(v)), True
End Select

Next
End With


Dim mm As Long
Dim als As Long
Dim subname$
If FList <> "" Then
subname$ = Replace(Replace(FList, Chr$(3), name$), Chr$(2), name$)
s() = Split(subname$, Chr$(1))
For i = LBound(s$()) + 1 To UBound(s$())
If s(i) <> "" Then
mm = val(Split(s(i))(1))
als = AllocSub()
sbf(als) = sbf(mm)
 subHash.ItemCreator CStr(Split(s(i))(0)), als, True
 
 ''sbf(als).sbgroup = name$
 
 End If
Next i

End If

LinkGroup = Vlist Or FList <> ""
End With

bstack.UseGroupname = OLD1
End Function

Sub GlobalArr(bstack As basetask, name$, rst$, items As Long, q As Long, Optional useglobalname As Boolean = False, Optional Reverse As Boolean = False, Optional declareglobal As Boolean = False)
' new mArray..
Dim afto As New mArray, NewKey As Long
If rst$ = vbNullString And q = -1 Then
' Make an empty array
GoTo dummyarray
End If


Dim j As Long, i As Long, p As Variant, aa As Boolean, onemore As Long, pbase As Variant
If DimLikeBasic And ArrBase = 0 Then onemore = 1: Reverse = True
items = 1
i = 0
Do
If IsExp(bstack, rst$, p) Then
pbase = afto.myarrbase
If Fast2Label(rst$, "TO", 2, "ΕΩΣ", 3, 3) Then
    pbase = -p
    onemore = 0
    If IsExp(bstack, rst$, p) Then
        If p < -pbase Then
         j = -p
        p = -pbase
        pbase = j
        End If
        p = p + pbase + 1
    Else
        missNumber
        Exit Sub
    End If
End If

i = i + 1
If onemore Then If p > 0 Then p = p + onemore
items = items * Int(Abs(p))
afto.PushDim CLng(p), pbase
aa = True
Else
GoTo dummyarray
End If
If i > 9 Then Exit Do
Loop Until Not FastSymbol(rst$, ",")

If aa And FastSymbol(rst$, ")") Then
afto.RevOrder = Reverse
 afto.PushEnd

   
dummyarray:
    NewKey = AllocVar()  ' version 8.1
    ' check if is already in ucase
    name$ = myUcase(name$)
    If here$ = vbNullString Or useglobalname Then
    
        varhash.ItemCreator bstack.GroupName + name$, NewKey, , declareglobal
        afto.arrname = name$
    Else
        varhash.ItemCreator here$ + "." + bstack.GroupName + name$, NewKey
        afto.arrname = here$ & "." & name$
    End If
    If q = -1 Then
            q = NewKey
    End If
    Set var(NewKey) = afto
    
Else
If FastSymbol(rst$, ",") Then
items = 0
MyEr "No more 10 dimensions allowed", "Μέχρι 10 διαστάσεις επιτρέπονται"
Else

    items = -1
    rst$ = ":?" & rst$
    End If
End If
End Sub
Sub GlobalArrResize(afto As mArray, bstack As basetask, name$, rst$, items As Long)
' new mArray..

Dim j As Long, i As Long, p As Variant, aa As Boolean, onemore As Long, pbase As Variant
If DimLikeBasic And afto.myarrbase = 0 Then onemore = 1
items = 1
i = 0
afto.StartResize
Do
If IsExp(bstack, rst$, p) Then
If afto.IHaveGui And p <> 0 Then GoTo noredim
pbase = afto.myarrbase
If Fast2Label(rst$, "TO", 2, "ΕΩΣ", 3, 3) Then
    pbase = -p
    onemore = 0
    If IsExp(bstack, rst$, p) Then
        If p < -pbase Then
        j = -p
        p = -pbase
        pbase = j
        
        End If
        p = p + pbase + 1
        
    Else
        missNumber
        Exit Sub
    End If
End If
i = i + 1
If onemore Then If p > 0 Then p = p + onemore
items = items * Int(Abs(p))
afto.PushDim CLng(p), pbase
aa = True
Else
GoTo fault
End If
If i > 9 Then Exit Do
Loop Until Not FastSymbol(rst$, ",")
afto.PushEnd
fault:
If aa And FastSymbol(rst$, ")") Then
    

Else
     If FastSymbol(rst$, ",") Then
items = 0
MyEr "No more 10 dimensions allowed", "Μέχρι 10 διαστάσεις επιτρέπονται"
Else
    items = -1
    rst$ = ":?" & rst$
    End If
End If
Exit Sub
noredim:
MyEr "No Redim allowed, use Declare Over/Under ", "Δεν επιτρέπονται αλλαγές, χρησιμοποίησε την ΟΡΙΣΕ ΠΑΝΩ/ΥΠΟ"
End Sub


Function neoGetArray(bstack As basetask, ByVal nm$, ga As mArray, Optional searchonly As Boolean = False, Optional ByVal useglobalname As Boolean = False, Optional useLocalOnly As Boolean = False, Optional rightexpression As Boolean, Optional feedback As Boolean) As Boolean
Dim k As Long, myobject As Object
Dim n$
nm$ = myUcase(nm$)
If useglobalname Or here$ = vbNullString Then
n$ = bstack.GroupName + nm$
ElseIf Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
GoTo here12
Else
n$ = here$ & "." + bstack.GroupName + nm$
End If


If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
here12:
    If useLocalOnly Then Exit Function
    If bstack.UseGroupname <> "" Then
    n$ = bstack.UseGroupname + Mid$(nm$, 6)
     If Not varhash.Find3(n$, k, feedback) Then
     n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
     varhash.Find3 n$, k, feedback
     End If
     If k = 0 Then
     ' check for inventory
     n$ = bstack.UseGroupname + Mid$(nm$, 6)
      If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find3(n$, k, feedback) Then
            If TypeOf var(k) Is mHandler Then
                
                If var(k).t1 < 3 Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
                Exit Function
                Else
                k = 0
                End If
            End If
            
        End If
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
              If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find3(n$, k, feedback) Then
            If TypeOf var(k) Is mHandler Then
            If var(k).t1 < 3 Then
                Set ga = New mArray
                Set ga.GroupRef = var(k)
                ga.Arr = False
                neoGetArray = True
                 Exit Function
                End If
            End If
            k = -1
        End If
     
     End If
    Else
    n$ = Mid$(nm$, 5)
      If bstack.GetDot(n$, 1) Then varhash.Find3 here$ + "." + n$, k, feedback Else Exit Function
    End If

ElseIf varhash.Find(n$, k) = False Then
If useLocalOnly Then
If bstack.UseGroupname <> "" Then
        If InStr(nm$, bstack.UseGroupname) = 1 Then
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, Len(bstack.UseGroupname) + 1)
        varhash.Find3 n$, k, feedback
        Else
        If n$ Like "*[$%](" Then
        n$ = Mid$(n$, 1, Len(n$) - 2)
        Else
        n$ = Mid$(n$, 1, Len(n$) - 1)
        End If
        If varhash.Find3(n$, k, feedback) Then
        GoTo conthandler
        End If
        
        End If
Else
If n$ Like "*[$%](" Then
n$ = Mid$(n$, 1, Len(n$) - 2)
Else
n$ = Mid$(n$, 1, Len(n$) - 1)
End If
If varhash.Find3(n$, k, feedback) Then
conthandler:
    If TypeOf var(k) Is mHandler Then
        If var(k).t1 < 3 Then
            Set ga = New mArray
            Set ga.GroupRef = var(k)
            ga.Arr = False
            neoGetArray = True
            Exit Function
        End If
    ElseIf TypeOf var(k) Is Group Then
    If rightexpression Then
        If var(k).HasParametersSet Then
             Set ga = New mArray
                    Set ga.GroupRef = var(k)
                    ga.Arr = False
                    neoGetArray = True
                    Exit Function
            Else
        
            Exit Function
            End If
    ElseIf var(k).HasParameters Then
            Set ga = New mArray
                   Set ga.GroupRef = var(k)
                   ga.Arr = False
                   neoGetArray = True
                   Exit Function
            Else
            
            Exit Function
    End If

    End If
    k = -1
End If
End If
Else
            If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find3(n$, k, feedback) Then
            If TypeOf var(k) Is mHandler Then
                If var(k).t1 < 3 Then
                        Set ga = New mArray
                        Set ga.GroupRef = var(k)
                        ga.Arr = False
                        
                        neoGetArray = True
                        Exit Function
                        Else
                        
                    End If
            Else
                If Typename(var(k)) = "Group" Then
                    If var(k).HasParametersSet Then
                    Set ga = New mArray
                    Set ga.GroupRef = var(k)
                    ga.Arr = False
                    neoGetArray = True
                    ElseIf var(k).HasParameters Then  ' this is for inventories
                     Set ga = New mArray
                    Set ga.GroupRef = var(k)
                    ga.Arr = False
                    neoGetArray = True
                    End If
                    Exit Function
                Else
                   ' MyEr "Group has no parameters", "Η ομάδα δεν έχει παραμέτρους"
                    Exit Function
                    End If
            End If
                
                k = -1
                n$ = bstack.GroupName + nm$
                ' not a mhandler
            
           
        End If

End If
End If
If k <= 0 Then

            If searchonly Then Exit Function
            If Not useLocalOnly Then
                        n$ = nm$
                        varhash.Find3 n$, k, feedback
        Else
    If bstack.StaticCollection Is Nothing Then Exit Function
    If bstack.ExistVar(Left$(nm$, Len(nm$) - 1)) Then
    bstack.ReadVar Left$(nm$, Len(nm$) - 1), var(0)
    If Typename(var(0)) = "mHandler" Then
                Set ga = New mArray
                If var(0).t1 = 2 Then
                Set ga.GroupRef = var(0)
                Else
                Set ga.GroupRef = var(0).objref
                End If
                ga.Arr = False
                neoGetArray = True
                var(0) = 0&
                Exit Function
    End If
    var(0) = 0&
                Exit Function
    End If
     Exit Function
        
            End If
End If


If k > 0 Then
If Typename(var(k)) = "Empty" Then
Set ga = New mArray: neoGetArray = True
Else
If TypeOf var(k) Is mArray Then
    Set ga = var(k)
Else
    Set myobject = var(k)
    If CheckIsmArray(myobject) Then
        Set ga = myobject
    Else
        NotArray
        Set myobject = Nothing
    Exit Function
    End If
    Set myobject = Nothing
End If

End If
  neoGetArray = True
           
ElseIf k = 0 Then
 If n$ Like "*[$%](" Then
            n$ = Mid$(n$, 1, Len(n$) - 2)
            Else
            n$ = Mid$(n$, 1, Len(n$) - 1)
            End If
        If varhash.Find(n$, k) Then
            If TypeOf var(k) Is mHandler Then
                If var(k).t1 < 3 Then
                    Set ga = New mArray
                    Set ga.GroupRef = var(k)
                    ga.Arr = False
                    neoGetArray = True
                    Exit Function
                End If
            End If
            k = -1
        End If


If n$ = vbNullString Then Exit Function
        nm$ = Mid$(n$, 1, Len(n$) - 1)
        If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
    If useLocalOnly Then Exit Function
    If bstack.UseGroupname <> "" Then
    n$ = bstack.UseGroupname + Mid$(nm$, 6)
     If Not varhash.Find(n$, k) Then
     n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
     varhash.Find n$, k
     End If
    Else
    n$ = Mid$(nm$, 5)
      If bstack.GetDot(n$, 1) Then varhash.Find here$ + "." + n$, k Else Exit Function
    End If
End If
        If varhash.Find(n$, k) Then
        If TypeOf var(k) Is mHandler Then
        
        Set ga = New mArray
        Set ga.GroupRef = var(k)
        ga.Arr = False
        neoGetArray = True
        Exit Function
        End If
        End If
End If


End Function
Function neoGetArrayLinkOnly(bstack As basetask, ByVal nm$, link As Long, Optional useglobalname As Boolean = False, Optional useLocalOnly As Boolean = False) As Boolean
Dim k As Long
Dim n$
nm$ = myUcase(nm$)
If Len(nm$) > 5 And False Then
           ' not used any more
                If Left$(nm$, 5) = "THIS." Then
               
                    n$ = StripThis2(here$)
                    If n$ <> "" Then n$ = n$ & "." & bstack.GroupName & Mid$(nm$, 6) Else n$ = here$ & "." & nm$
                ElseIf Left$(nm$, 5) = "ΑΥΤΟ." Then
           
                    n$ = StripThis2(here$)
                    If n$ <> "" Then n$ = n$ & "." & bstack.GroupName & Mid$(nm$, 6) Else n$ = here$ & "." & nm$
                Else
                If useglobalname Then
                    n$ = nm$
                    Else
                    'n$ = here$ & "." & nm$
                    n$ = here$ & "." & bstack.GroupName & nm$
                    End If
                End If

Else
If useglobalname Then
'n$ = bstack.GroupName + nm$
n$ = nm$
Else
If here$ = vbNullString Then
n$ = nm$
Else
'n$ = here$ & "." & nm$
n$ = here$ & "." & bstack.GroupName & nm$
End If
End If
End If

If varhash.Find(n$, k) = False And bstack.UseGroupname <> "" Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Or Left$(nm$, 5) = "THIS." Then
        If useLocalOnly Then Exit Function
        If StripThis2(bstack.UseGroupname) = vbNullString Then
            n$ = bstack.UseGroupname + Mid$(nm$, 6)
        Else
            n$ = StripThis2(bstack.UseGroupname) + "." + Mid$(nm$, 6)
        End If
        varhash.Find n$, k
    End If
End If
If k = 0 Then
    If Not useLocalOnly Then
        n$ = myUcase(nm$)
        varhash.Find n$, k
    End If
End If
If k > 0 Then
    link = k
    neoGetArrayLinkOnly = True
    
End If

End Function

Function CopyArrayItems(bstack As basetask, nm$) As String
Dim k As Long
If neoGetArrayLinkOnly(bstack, nm$, k) Then CopyArrayItems = CStr(k)

End Function

Function CopyArrayItemsNoFormated(bstack As basetask, nm$) As Long
Dim k As Long
If varhash.Find(nm$, k) Then
CopyArrayItemsNoFormated = k
ElseIf varhash.Find(nm$, k) Then
If TypeOf var(k) Is mHandler Then
CopyArrayItemsNoFormated = -k
End If
End If
End Function
Function ModuleSub(name$, q As String, Optional sbgroupname As String = vbNullString) As Long
Dim j As Long, n$, where As Long
n$ = myUcase(name$, True)

j = AllocSub()
With sbf(j)
    .sb = q
    .sbc = 0
    .sbgroup = sbgroupname
    Set .subs = Nothing
    .goodname = name$
    .Changed = False
End With
subHash.ItemCreator n$, j
ModuleSub = j
End Function
Function GlobalSub(name$, q As String, Optional sbgroupname As String = vbNullString, Optional ByVal nameonly$ = vbNullString) As Long
Dim j As Long, n$, where As Long
n$ = myUcase(name$, True)

j = AllocSub()
With sbf(j)
    .sb = q
    .sbc = 0
    .sbgroup = sbgroupname
    Set .subs = Nothing
    .goodname = name$
    .Changed = False
End With
If Not nameonly$ = vbNullString Then
If sbgroupname = vbNullString Then
    nameonly$ = myUcase(nameonly$, True)
    If comhash.Find(nameonly$, where) Then
    If n$ = nameonly$ Then
    comhash.ItemCreator2 nameonly$, 0, 32
    Else
    comhash.ItemCreator2 nameonly$, 0, 33
    End If
    End If
    End If
End If
subHash.ItemCreator n$, j

GlobalSub = j
End Function

Function GetGlobalVar(nm$, i As Long) As Boolean

If varhash.Find(myUcase(nm$), i) Then
GetGlobalVar = True
End If
End Function

Function StripThis(ByVal n$) As String

Dim a$, b$, i&
a$ = n$
DropLeft "].", a$


'Exit Function
a$ = StripRVAL(a$)  ' we need that

If a$ = n$ Then
StripThis = vbNullString
Exit Function
Else
b$ = a$
End If
i& = InStr(n$, ".")
If i& > 0 Then

DropLeft ".", n$
i& = InStrRev(n$, ".") - 1
If i& > 0 Then
StripThis = b$ & "." & Left$(n$, i&)
Else
StripThis = b$
End If
Else
StripThis = b$
End If
End Function
Function StripThis2(ByVal n$) As String

Dim a$, b$, i&

If StripRVAL2(n$, a$) Then
StripThis2 = a$
Exit Function
End If
If a$ = n$ Then
StripThis2 = vbNullString
Exit Function
Else
b$ = a$
End If
i& = InStr(n$, ".")
If i& > 0 Then

DropLeft ".", n$
i& = InStrRev(n$, ".") - 1
If i& > 0 Then
StripThis2 = b$ & "." & Left$(n$, i&)
Else
StripThis2 = b$
End If
Else
StripThis2 = b$
End If
End Function

Function GetVar1(bstack As basetask, ByVal nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False, Optional finalname As String, Optional checktype As Boolean = 0) As Boolean
If skip Then Exit Function
' called from unfloat
If varhash.Find2(nm$, i, checktype) Then GetVar1 = True
End Function
Function GetVar3(bstack As basetask, ByVal nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False, Optional finalname As String, Optional checktype As Boolean = 0, Optional feedback As Boolean, Optional nosearch As Boolean) As Boolean
If skip Then Exit Function
If Not bstack.StaticCollection Is Nothing Then
    If bstack.ExistVar(nm$) Then i = -1: Exit Function
End If
Dim n$, cc As Long
  
cc = Len(nm$)
If cc > 5 Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Then
    GoTo cont1
    ElseIf Left$(nm$, 5) = "THIS." Then
cont1:
        If bstack.UseGroupname <> "" Then
            feedback = False
            n$ = bstack.UseGroupname + Mid$(nm$, 6)
            If varhash.Find2(n$, cc, checktype) Then finalname = n$: GoTo there12
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
            If varhash.Find2(n$, cc, checktype) Then finalname = n$: GoTo there12
        Else
            n$ = StripThis2(here$)
            If n$ <> vbNullString Then
                n$ = n$ & "." & Mid$(nm$, 6)
            Else
                If IsLabel(bstack, Mid$(nm$, 6), n$) Then
                    n$ = here$ & "." & n$
                Else
                    n$ = here$ & "." & nm$
                End If
            End If
        End If
        
    Else
        If lookglobalonly Then
            n$ = nm$
        Else

           
            n$ = here$ + "." + nm$
        End If
    End If
ElseIf cc = 4 Then
    If nm$ = "ΑΥΤΟ" Then
    GoTo cont2
    ElseIf nm$ = "THIS" Then
cont2:

        n$ = ""
         If bstack.GetDotNew(n$, 1) Then
           If Len(n$) = 0 Then GetVar3 = False: Exit Function
            nm$ = Left$(n$, Len(n$) - 1)
            finalname = nm$
        End If
    End If
    If lookglobalonly Then
        n$ = nm$
    Else
        n$ = here$ + "." + nm$
    End If
Else
    If lookglobalonly Then
        n$ = nm$
    Else
        'n$ = here$ & "." & bstack.GroupName & nm$
        n$ = here$ + "." + nm$
    End If

End If

If varhash.Find2(n$, cc, checktype, feedback) Then
there12:
    GetVar3 = True
    i = cc
ElseIf Not looklocalonly Then
    n$ = nm$
    If bstack.UseGroupname <> "" Then
        If InStr(n$, bstack.UseGroupname) = 1 Then
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(n$, Len(bstack.UseGroupname) + 1)
            If varhash.Find(n$, cc) Then
                checktype = True
                i = cc
                GetVar3 = True
                nm$ = n$
            End If
        ElseIf InStr(bstack.UseGroupname, n$) = 1 Then
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(n$, Len(bstack.UseGroupname) + 1)
            If varhash.Find2(n$, cc, checktype, feedback) Then
                i = cc
                GetVar3 = True
                nm$ = n$
            End If
        End If
    End If
    If Not GetVar3 Then
        If varhash.Find2(nm$, cc, checktype, feedback) Then
            i = cc
            GetVar3 = True
        ElseIf nosearch Then
            Exit Function
        ElseIf bstack.UseGroupname <> vbNullString Then
            Exit Function
        ElseIf wide Then
            If SecureNames Then
                If bstack.IamChild Then
                cc = InStr(n$, ".")
                If cc = 0 Then
                            nm$ = sbf(iRVAL22(here$)).goodname
                            cc = InStr(nm$, ".")
                            nm$ = Mid$(nm$, cc + 1)
                            If cc > 0 Then
                            If varhash.Find2(nm$ + "." + n$, i, checktype, feedback) Then
                                GetVar3 = True
                                Exit Function
                                End If
                                End If
                ElseIf cc > 1 Then
                    n$ = Left$(n$, cc - 1): nm$ = Mid$(nm$, cc + 1)
                    End If
                    Dim m As Long
                    m = Abs(iRVAL22(here$))
                    i = 0
                    For cc = m - 1 To 1 Step -1
                        i = i - 1
                        If sbf(cc).goodname Like "*[.]" + n$ Then Exit For
                        If sbf(cc).goodname Like "*[.]" + ChrW(-65) + n$ Then Exit For
                    Next cc
                    If cc > 0 Then
                    
                        If cc > m + i Then i = 1
                            If varhash.Find2(StripThis2(here$) + "[" + CStr(m + i) + "][" + CStr(cc) + "]" + "." + nm$, i, checktype, feedback) Then
                                GetVar3 = True
                           ElseIf varhash.Find2(StripThis2(here$) + "[" + CStr(m + i) + "][" + CStr(cc) + "]" + "." + ChrW(-65) + nm$, i, checktype, feedback) Then
                                GetVar3 = True
                        Else
                            If Not Right$(sbf(cc).goodname, 1) <> "]" Then m = cc
                            Do While m > 1
                                m = m - 1
                                If varhash.Find2(StripThis2(here$) + "[" + CStr(m) + "][" + CStr(cc) + "]" + "." + nm$, i, checktype, feedback) Then
                                    GetVar3 = True
                                    Exit Do
                                ElseIf varhash.Find2(StripThis2(here$) + "[" + CStr(m) + "][" + CStr(cc) + "]" + "." + ChrW(-65) + nm$, i, checktype, feedback) Then
                                    GetVar3 = True
                                    Exit Do
                                End If
                            Loop
                        End If
                        Else
                       
                    End If
    
                    If Not GetVar3 Then i = 0
                End If
            End If
        End If
    End If
End If
'***********************

End Function
Function GetVar(bstack As basetask, ByVal nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False, Optional finalname As String, Optional checktype As Boolean = 0, Optional feedback As Boolean, Optional nosearch As Boolean) As Boolean
If skip Then Exit Function
If Not bstack.StaticCollection Is Nothing Then
    If bstack.ExistVar(nm$) Then i = -1: Exit Function
End If
Dim n$, cc As Long
  
cc = Len(nm$)
If cc > 5 And i >= 0 Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Then
    GoTo cont1
    ElseIf Left$(nm$, 5) = "THIS." Then
cont1:
        If bstack.UseGroupname <> "" Then
            feedback = False
            n$ = bstack.UseGroupname + Mid$(nm$, 6)
            If varhash.Find2(n$, cc, checktype) Then finalname = n$: GoTo there12
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
            If varhash.Find2(n$, cc, checktype) Then finalname = n$: GoTo there12
        Else
            n$ = StripThis2(here$)
            If n$ <> vbNullString Then
                n$ = n$ & "." & Mid$(nm$, 6)
            Else
                If IsLabel(bstack, Mid$(nm$, 6), n$) Then
                    n$ = here$ & "." & n$
                Else
                    n$ = here$ & "." & nm$
                End If
            End If
        End If
        
    Else
        If lookglobalonly Then
            n$ = nm$
        Else

           
            n$ = here$ + "." + nm$
        End If
    End If
Else
    If lookglobalonly Then
        n$ = nm$
    Else
        'n$ = here$ & "." & bstack.GroupName & nm$
        n$ = here$ + "." + nm$
    End If

End If

If varhash.Find2(n$, cc, checktype, feedback) Then
there12:
    GetVar = True
    i = cc
ElseIf Not looklocalonly Then
    n$ = nm$
    If bstack.UseGroupname <> "" Then
        If InStr(n$, bstack.UseGroupname) = 1 Then
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(n$, Len(bstack.UseGroupname) + 1)
            If varhash.Find(n$, cc) Then
                checktype = True
                i = cc
                GetVar = True
                nm$ = n$
            End If
        ElseIf InStr(bstack.UseGroupname, n$) = 1 Then
            n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(n$, Len(bstack.UseGroupname) + 1)
            If varhash.Find2(n$, cc, checktype, feedback) Then
                i = cc
                GetVar = True
                nm$ = n$
            End If
        End If
    End If
    If Not GetVar Then
        If varhash.Find2(nm$, cc, checktype, feedback) Then
            i = cc
            GetVar = True
       ElseIf varhash.Find2(here$ + "." + nm$, cc, checktype, feedback) Then
            i = cc
            GetVar = True
        ElseIf nosearch Then
            Exit Function
        ElseIf bstack.UseGroupname <> vbNullString Then
            Exit Function
        ElseIf wide Then
            If SecureNames Then
                If bstack.IamChild Then
                cc = InStr(n$, ".")
                If cc = 0 Then
                            nm$ = sbf(iRVAL22(here$)).goodname
                            cc = InStr(nm$, ".")
                            nm$ = Mid$(nm$, cc + 1)
                            If cc > 0 Then
                            If varhash.Find2(nm$ + "." + n$, i, checktype, feedback) Then
                                GetVar = True
                                Exit Function
                                End If
                                End If
                ElseIf cc > 1 Then
                    n$ = Left$(n$, cc - 1): nm$ = Mid$(nm$, cc + 1)
                    End If
                    Dim m As Long
                    m = Abs(iRVAL22(here$))
                    i = 0
                    For cc = m - 1 To 1 Step -1
                        i = i - 1
                        If sbf(cc).goodname Like "*[.]" + n$ Then Exit For
                        If sbf(cc).goodname Like "*[.]" + ChrW(-65) + n$ Then Exit For
                    Next cc
                    If cc > 0 Then
                    
                        If cc > m + i Then i = 1
                            If varhash.Find2(StripThis2(here$) + "[" + CStr(m + i) + "][" + CStr(cc) + "]" + "." + nm$, i, checktype, feedback) Then
                                GetVar = True
                           ElseIf varhash.Find2(StripThis2(here$) + "[" + CStr(m + i) + "][" + CStr(cc) + "]" + "." + ChrW(-65) + nm$, i, checktype, feedback) Then
                                GetVar = True
                        Else
                            If Not Right$(sbf(cc).goodname, 1) <> "]" Then m = cc
                            Do While m > 1
                                m = m - 1
                                If varhash.Find2(StripThis2(here$) + "[" + CStr(m) + "][" + CStr(cc) + "]" + "." + nm$, i, checktype, feedback) Then
                                    GetVar = True
                                    Exit Do
                                ElseIf varhash.Find2(StripThis2(here$) + "[" + CStr(m) + "][" + CStr(cc) + "]" + "." + ChrW(-65) + nm$, i, checktype, feedback) Then
                                    GetVar = True
                                    Exit Do
                                End If
                            Loop
                        End If
                        Else
                       
                    End If
    
                    If Not GetVar Then i = 0
                End If
            End If
        End If
    End If
End If
'***********************

End Function

Function getvar2(bstack As basetask, nm$, i As Long, Optional lookglobalonly As Boolean = False, Optional skip As Boolean, Optional looklocalonly As Boolean = False) As Boolean
If skip Then Exit Function
If Not bstack.StaticCollection Is Nothing Then
If bstack.ExistVar(nm$) Then i = -1: Exit Function
End If
Dim n$, cc As Long
cc = Len(nm$)
If cc > 5 Then
    If Left$(nm$, 5) = "ΑΥΤΟ." Then
    GoTo cont1
    ElseIf Left$(nm$, 5) = "THIS." Then
cont1:
        If bstack.UseGroupname <> "" Then
                  n$ = bstack.UseGroupname + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
                
                    n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, 6)
                If varhash.Find(n$, cc) Then GoTo there12
        Else
        
            n$ = StripThis2(here$)
            If n$ <> "" Then
                n$ = n$ & "." & Mid$(nm$, 6)
            
            Else
            If IsLabel(bstack, Mid$(nm$, 6), n$) Then ' NO NEED DOT ANY MORE..(WE USE DOTNEW)
                    n$ = here$ & "." & n$
            Else
                    n$ = here$ & "." & nm$
            End If
            End If
        End If
    Else
    If lookglobalonly Then
     n$ = nm$
    Else
        n$ = here$ & "." & nm$
        End If
    End If
ElseIf cc = 4 Then
    If nm$ = "ΑΥΤΟ" Then
    GoTo cont2
    ElseIf nm$ = "THIS" Then
cont2:

       n$ = ""

        If bstack.GetDotNew(n$, 1) Then
            If Len(n$) = 0 Then getvar2 = False: Exit Function
           nm$ = Left$(n$, Len(n$) - 1)
        End If
    End If
    If lookglobalonly Then
         n$ = nm$
        Else
    n$ = here$ & "." & nm$


    End If
Else
    If lookglobalonly Then
        n$ = nm$
    Else
        n$ = here$ + "." + nm$
    End If

End If

If varhash.Find(n$, cc) Then
there12:
    getvar2 = True
    i = cc
ElseIf Not looklocalonly Then
    If varhash.Find(nm$, cc) Then
    i = cc
    getvar2 = True
    ElseIf bstack.UseGroupname <> "" Then
        If InStr(nm$, bstack.UseGroupname) = 1 Then
        n$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(nm$, Len(bstack.UseGroupname) + 1)
        If varhash.Find(n$, cc) Then
        i = cc
        getvar2 = True
    End If
    End If
    End If
End If



End Function
Function GetlocalVar(nm$, i As Long) As Boolean
If varhash.Find(here$ & "." & myUcase(nm$), i) Then GetlocalVar = True
End Function
Function RVAL3(ByVal what$, ByVal s$, v As Long) As String
Dim ss$, n As Long

n = InStrRev(s$, "[")

If n = 0 Then
If what$ <> "" Then what$ = "." + what$ + "[1]"
RVAL3 = s$ + ChrW$(127) + CStr(v) + "[1]" + what$
Else
    ss$ = Left$(s$, n - 1&)
    what$ = Mid$(s$, InStr(s$, "].") + 1)
    If Len(what$) = Len(s$) Then what$ = vbNullString
    
    RVAL3 = ss$ & "[" & CStr(val(Mid$(s$, n + 1&)) + 1&) & "]" + what$
End If
End Function
Function RVAL33(ByVal s$, v As Long) As String
Dim ss$, n As Long, what$

n = InStrRev(s$, "[")

If n = 0 Then
RVAL33 = s$ + "[" + CStr(v) + "][" + CStr(v) + "]"
Else
    ss$ = Left$(s$, n - 1&)
   ' what$ = Mid$(s$, InStr(s$, "][") + 1)
    'If Len(what$) = Len(s$) Then what$ = "[0]"
    
    RVAL33 = RVAL(ss$, 1) & "[" + CStr(v) + "]"
End If
End Function
Function RVAL2(ByVal s$, v As Long) As String
Dim ss$
If InStr(s$, "[") = 0 Then
RVAL2 = s$
Else
ss$ = GetStrUntil("[", s$)
If val(s$) + v <= 0 Then
RVAL2 = ss$ + "."
Else
RVAL2 = ss$ & "[" & CStr(val(s$) + v) & "]."
End If
End If
End Function
Function iRVAL22(ByVal s$) As Long
    Dim n As Long
    
    
    
    iRVAL22 = val(Mid$(s$, InStrRev(s$, "[") + 1))
End Function
Function RVAL(ByVal s$, v As Long) As String
Dim ss$
If InStr(s$, "[") = 0 Then
RVAL = s$ & "[" & CStr(v) & "]"
Else
ss$ = GetStrUntil("[", s$)

RVAL = ss$ & "[" & CStr(val(s$) + v) & "]"
End If
End Function
Function TheSame(ByVal s$, ByVal q$) As Boolean
Dim part1 As String
part1 = StripRVAL(s$)
If part1 <> "" Then
    If InStr(part1, ".") > 0 Then
    ' all in part1
    Else
    DropLeft ".", s$
    part1 = part1 & "." & s$
    End If
    End If
TheSame = part1 = q$
End Function
Function StripRVAL2(s$, Result$) As Boolean
' return s$ number as string
' return function name...
'
Dim bb$, varname$
bb$ = s$
If InStr(s$, "[") = 0 Then
' look varlist to find group
Dim i As Long
i = InStrRev(s$, ".")
If i > 1 Then s$ = Left$(s$, i - 1)
If InStrRev(varname$, "." + s$ + " ") < 1 Then Exit Function
s$ = Mid$(varname$, InStrRev(varname$, Chr$(1), InStrRev(varname$, "." + s$ + " ")) + 1)
Result$ = GetStrUntil(" ", s$)
StripRVAL2 = True
If Not Typename(var(val(s$))) = "Group" Then StripRVAL2 = False: s$ = bb$: Result$ = vbNullString
Else
Result$ = GetStrUntil("[", s$)
End If

End Function
Function StripRVAL(ByVal s$) As String
If InStr(s$, "[") = 0 Then
' do not delete this.....
StripRVAL = s$
Else
StripRVAL = GetStrUntilR("[", s$)
End If
End Function
Function iRVAL(ByVal s$, v As Long) As Long
If InStr(s$, "[") = 0 Then
iRVAL = v
Else
DropLeft "[", s$
iRVAL = val(s$) + v
End If
End Function
Function LookFastForModule(w$) As Boolean
Dim a As Long
If Len(here$) = 0 Then
LookFastForModule = subHash.Find(w$, a)
Else
LookFastForModule = subHash.Find(here$ + w$, a)
End If
End Function
Function GetSubFullName(nm$, fullname$) As Boolean

If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
            GetSubFullName = subHash.ExistKey(nm$)
          fullname = nm$: Exit Function
        End If
    End If
End If

If here$ <> "" Then
     GetSubFullName = subHash.ExistKey(here$ & "." & nm$)
  If GetSubFullName Then fullname$ = here$ & "." & nm$: Exit Function
End If

    GetSubFullName = subHash.ExistKey(nm$)
 If GetSubFullName Then fullname$ = nm$





End Function
Function GetSubFullName2(nm$, fullname$, retnum As Long) As Boolean
Dim dummy As Long
If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
            GetSubFullName2 = subHash.Find2(nm$, retnum, dummy)
          fullname = nm$: Exit Function
        End If
    End If
End If

If here$ <> "" Then
     GetSubFullName2 = subHash.Find2(here$ & "." & nm$, retnum, dummy)
  If GetSubFullName2 Then fullname$ = here$ & "." & nm$: Exit Function
End If

    GetSubFullName2 = subHash.Find2(nm$, retnum, dummy)
 If GetSubFullName2 Then fullname$ = nm$





End Function


Function GetSubFullNameB(nm$, fullname$) As Boolean
Dim i&, n$
Dim subname$  '
subname$ = subHash.Show
If Len(here$) > 0 Then
If Len(here$) > Len(nm$) Then
If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
n$ = "." & nm$ & " "
i& = InStr(subname$, n$)
Dim j&
If i& > 0 Then
j& = InStrRev(subname$, Chr$(1), i&)
nm$ = Mid$(subname$, j& + 1, Len(nm$) + i& - j&)
n$ = Mid$(subname$, j&, Len(nm$) + 1)
i& = j&
 
End If
End If

End If
End If

If i& = 0 Then
n$ = Chr(1) + here$ & "." & nm$ & " "
i& = InStr(subname$, n$)
End If
If i& = 0 Then
n$ = Chr(1) + nm$ & " "
i& = InStr(subname$, n$)
End If

If i& > 0 Then
GetSubFullNameB = True
fullname$ = RTrim$(Mid$(n$, 2))


Else
GetSubFullNameB = False

End If

End Function
Function GetSub2(bstack As basetask, nm$, i&) As Boolean
i& = 0
If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
               '
                i& = bstack.OriginalCode
                If bstack.IamLambda Then
                    GetSub2 = subHash.Find(bstack.FuncRec, i&)
                    If GetSub2 Then nm$ = bstack.FuncRec
                Else
                ' If SecureNames Then
                    nm$ = sbf(i&).goodname
                 '   Else
                    'nm$ = StripRVAL(here$) + "." + nm$
                 '  End If
                    GetSub2 = True
                End If
        End If
   ElseIf Right$(here$, 1) = "]" Then
   'GetSub2 = subHash.Find(StripRVAL(here$) + "." + nm$, i&)
   GetSub2 = subHash.Find(here$ + "." + nm$, i&)
    End If
End If

If i& = 0 And here$ <> "" Then
     GetSub2 = subHash.Find(here$ & "." & nm$, i&)
ElseIf i& <> 0 Then
    Exit Function
End If
If i& = 0 Then
    GetSub2 = subHash.Find(nm$, i&)
Else
    Exit Function
End If
If i& = 0 Then
   
Else
    Exit Function
End If

End Function

Function GetSub(nm$, i&) As Boolean
'If Right$(nm$, 1) = "(" Then Stop
i& = 0
If Len(here$) > 0 Then
    If Len(here$) > Len(nm$) Then
        If Mid$(here$, Len(here$) - Len(nm$)) = "." + nm$ Then
               
            GetSub = subHash.Find(StripRVAL(here$) + "." + nm$, i&)
            
        End If
   ElseIf Right$(here$, 1) = "]" Then
  ' If Not subHash.Find(here$ + "." + nm$, i&) Then
   'GetSub = subHash.Find(StripRVAL(here$) + "." + nm$, i&)
   'Else
   'GetSub = True
   'End If
   GetSub = subHash.Find(here$ + "." + nm$, i&)
    End If
End If
If GetSub Then Exit Function
If i& = 0 And here$ <> "" Then
     GetSub = subHash.Find(here$ & "." & nm$, i&)
ElseIf i& <> 0 Then
    Exit Function
End If
If i& = 0 Then
    GetSub = subHash.Find(nm$, i&)
Else
    Exit Function
End If
If i& = 0 Then
   
Else
    Exit Function
End If

End Function

Function GetlocalSub(nm$, i&) As Boolean
'If Right$(nm$, 1) = "(" Then Stop
If subHash.Find(here$ & "." & nm$, i&) Then GetlocalSub = True

End Function
Function GetGlobalSubAfterHere(basestack As basetask, nm$, i&) As Boolean
Dim j&
If Not subHash.Find(here$, j&) Then

If basestack.OriginalName <> "" Then
If Not subHash.Find(basestack.OriginalName + "." + nm$, j&) Then Exit Function
End If

End If
If Not subHash.Find(nm$, i&) Then
Exit Function
End If


GetGlobalSubAfterHere = i& > j&
End Function

Function GetlocalSubExtra(nm$, i&) As Boolean
Dim n$
Dim subname$
subname$ = subHash.Show
n$ = "." & nm$ & " "
i& = InStr(subname$, n$)
If i& > 0 Then

GetlocalSubExtra = True
i& = val(Mid$(subname$, i& + Len(n$)))
Else
GetlocalSubExtra = False
End If
End Function
Function PosLabel(ByVal w$, ByVal b$) As Long
Dim i As Long, j As Long, jmp As Boolean
On Error Resume Next
If val(Left$(w$, 1)) = 0 Then w$ = w$ & ":": jmp = True
PosLabel = Len(b$) + 1
If Left$(b$, Len(w$)) = w$ Then
    i = 1
Else
i = InStr(b$, Chr(10) + w$)
If i = 0 Then
Dim w1$, w2$
w1$ = " " & w$
w2$ = "0" & w$
    Do
    i = InStr(i + 1, b$, w1$)
    If i = 0 Then Exit Do
    j = Len(RTrim(Left$(b$, i)))
    If j = 0 Then Exit Do
    If Mid$(b$, j, 1) = Chr(10) Then Exit Do
    Loop
    If i = 0 Then
    Do
    i = InStr(i + 1, b$, w2$)
    If i = 0 Then Exit Do

    j = Len(RTrim(Left$(b$, i)))
    If j = 0 Then Exit Do
    
    While j > 1 And Mid$(b$, j, 1) = "0"
            j = j - 1
    Wend
    
    If Mid$(b$, j, 1) = Chr(10) Then Exit Do
    Loop
    End If
End If


End If
If jmp Then

If i > 0 Then
While Mid$(b$, MyTrimLi(b$, i + Len(w$) + 1), 1) Like thislabel$ And i > 0
    i = InStr(i + Len(w$) + 1, b$, Chr(10) + w$)
Wend
If i > 0 Then PosLabel = i + 1

End If

Else
If i > 1 Then PosLabel = i + 1 '' Else PosLabel = 1
End If
End Function

Function logical(basestack As basetask, s$, d As Variant, Optional par As Long = 0, Optional flatobject As Boolean = False) As Boolean
Dim b$, s2$, S3$ ' , OSTAC$
Dim ah As String

ah = aheadstatus(s$, False)    '
If InStr(ah, "l") = 0 Then
If InStr(ah, "N") > 0 Then

If Not IsNumber(basestack, s$, d, flatobject) Then
    Set basestack.lastobj = Nothing
Else
    logical = True
End If
Else
If par > 0 Then
If Not GetArr(basestack, s$, d, s2$, 0) Then
    Set basestack.lastobj = Nothing
Else
    logical = True
End If

If logical Then
par = par - 1
End If
Exit Function
Else
logical = False
End If
End If
s$ = NLtrim$(s$)
Exit Function
End If
On Error Resume Next

If Err.Number > 0 Then Exit Function
s2$ = s$

If Left$(ah, 1) <> "N" Then
 IsStrExp basestack, s$, b$
logical = False
If Not mTextCompare Then
If FastSymbol(s$, "=") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ = s2$
    Exit Function
    Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<>", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ <> s2$
    Exit Function
        Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<=>", , 3) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    Select Case b$
    Case Is < s2$
    d = -1
    Case Is = s2$
    d = 0
    Case Else
    d = 1
    End Select
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ <= s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ < s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ >= s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ > s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "~") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ Like s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
End If
Else
If FastSymbol(s$, "=") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) = 0
    Exit Function
    Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<>", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) <> 0
    Exit Function
        Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<=>", , 3) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$)
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) < 1
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "<") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) = -1
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">=", , 2) Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) > -1
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, ">") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = CompareStr2(b$, s2$) = 1
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
ElseIf FastSymbol(s$, "~") Then
    logical = False
    If IsStrExp(basestack, s$, s2$) Then
    logical = True
    d = b$ Like s2$
    Exit Function
            Else
    If LastErNum = -2 Then logical = True
    Exit Function
    End If
End If

End If
If LastErNum <> -2 Then s$ = s2$

Else

s$ = s2$
cont145:
If IsNumber(basestack, s$, d, flatobject) Then
logical = True
Else

End If
End If
End Function

Function BlockParam(s$) As String
' need to be open
Dim i As Long, j As Long
j = 1
For i = 1 To Len(s$)
Select Case AscW(Mid$(s$, i, 1))
Case 0
Exit For
Case 34
i = InStr(i + 1, s$, Chr(34))
If i = 0 Then Exit Function
Case 40
j = j + 1
Case 41
j = j - 1
If j = 0 Then Exit For
Case 123
i = InStr(i + 1, s$, Chr$(125))
If i = 0 Then Exit Function
End Select
Next i
If j = 0 Then
BlockParam = Left$(s$, i - 1)
End If
End Function
Function block(s$) As String
Dim i As Long, j As Long, c As Long
Dim a1 As Boolean
Dim jump As Boolean
If Trim(s$) = vbNullString Then Exit Function
c = Len(s$)
a1 = True
i = 1
Do
Select Case AscW(Mid$(s$, i, 1))
Case 32
' nothing
Case 34
Do While i < c
i = i + 1
If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
Loop
Case 39, 92
Do While i < c
i = i + 1
If Mid$(s$, i, 2) = vbCrLf Then Exit Do
Loop
Case 61
jump = True
Case 123


If jump Then
jump = False
' we have a multiline text
Dim target As Long
target = j
    Do
    Select Case AscW(Mid$(s$, i, 1))
    Case 34
    Do While i < c
    i = i + 1
    If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
    Loop
    Case 123
    j = j - 1
    Case 125
    j = j + 1: If j = target Then Exit Do
    End Select
    i = i + 1
    Loop Until i > c
    If j <> target Then Exit Do
    Else
j = j - 1
End If


Case 125
j = j + 1: If j = 1 Then Exit Do
Case Else
jump = False

End Select
i = i + 1
Loop Until i > c
If j = 1 Then
block = Left$(s$, i - 1)
s$ = Mid$(s$, i)
Else
block = vbNullString '' "Error " & chr(34) & "missing }" & chr(34)
End If



End Function

Function block2(s$) As String
Dim i As Long, j As Long, c As Long
Dim a1 As Boolean
Dim jump As Boolean
Dim alter As Boolean
If Trim(s$) = vbNullString Then Exit Function

c = Len(s$)
a1 = True
i = 1
Do
Select Case AscW(Mid$(s$, i, 1))
Case 32
' nothing
Case 34
Do While i < c
i = i + 1
If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
Loop
Case 39, 92
Do While i < c
i = i + 1
If Mid$(s$, i, 2) = vbCrLf Then Exit Do
Loop
Case 61
jump = True
Case 123


If jump Then
jump = False
' we have a multiline text
Dim target As Long
target = j
    Do
    Select Case AscW(Mid$(s$, i, 1))
    Case 34
    Do While i < c
    i = i + 1
    If AscW(Mid$(s$, i, 1)) = 34 Then Exit Do
    Loop
    Case 123
    j = j - 1
    Case 125
    j = j + 1: If j = target Then Exit Do
    End Select
    i = i + 1
    Loop Until i > c
    If j <> target Then Exit Do
    Else
j = j - 1
End If


Case 125
j = j + 1: If j = 1 Then Exit Do
Case Else
jump = False

End Select
i = i + 1
Loop Until i > c
If j = 1 Then
block2 = Left$(s$, i - 1)
s$ = Mid$(s$, i)
'DoEvents
Else
block2 = vbNullString '' "Error " & chr(34) & "missing }" & chr(34)
End If



End Function
Function blockString(s$, endstr As Long, Optional i As Long = 1) As String
' endstr 34 or 125
Dim j As Long, c As Long, Start As Long
Start = i
Dim a1 As Boolean
c = Len(s$)
If c < 1 Then Exit Function
a1 = True
Do
Select Case AscW(Mid$(s$, i, 1))
Case 13
If endstr = 34 Then blockString = vbNullString: Exit Function
Case 34
If endstr = 34 Then
If i = 1 Then i = 2
j = 1: Exit Do
End If
Case 123
j = j - 1
Case 125
j = j + 1: If j = 1 And endstr = 125 Then Exit Do
End Select
i = i + 1
Loop Until i > c
If j = 1 Then
blockString = Mid$(s$, Start, i - Start)
s$ = Mid$(s$, i)
Else
blockString = "Error " & Chr(34) & "missing }" & Chr(34)
End If
If endstr = 125 Then
If Right$(blockString, 1) = " " Then
i = Len(blockString) - Len(RTrim(blockString))
If i > 0 Then blockString = ReplaceStr(Chr$(10) + Space(i), Chr$(10), blockString)
End If
End If

End Function
Sub SetNextLine(c$)
Dim i
i = InStr(c$, vbCrLf)
If i = 0 Then c$ = vbNullString Else c$ = Mid$(c$, i + 2)
End Sub
Sub SetNextLineNL(c$)
Dim i
i = InStr(c$, vbCrLf)
If i = 0 Then c$ = vbNullString Else c$ = Mid$(c$, i)
End Sub
Function GetNextLine(c$) As String
Dim i, j$
i = InStr(c$, vbCrLf)
If i = 0 Then GetNextLine = NLtrim$(c$): c$ = vbNullString Else GetNextLine$ = NLtrim$(Left$(c$, i - 1)): c$ = Mid$(c$, i)
End Function
Sub NoLines(c$)
Dim i
c$ = Trim(c$)
Do While Left$(c$, 2) = vbCrLf
c$ = Trim$(Mid$(c$, 3))
Loop
End Sub

Sub RTarget(ddd As Object, tar As target)
' RENDER TARGET
Dim xl&, yl&, b As Long, F As Long, Tag$, Id&
Dim x&, y&, ox&, oy&
Dim prive As basket, d As Object
Set d = ddd.Owner
prive = players(GetCode(d))
With tar
Id& = .Id
Tag$ = .Tag
x& = .Lx
y& = .ly
xl& = .tx + 1
yl& = .ty
b = .back
F = .fore
prive.mypen = .pen

Dim dd As Object
If .layer = 0 Then
Set dd = Form1.DIS
ElseIf .layer = -1 Then
Set dd = Form1
ElseIf .layer > 0 Then
Set dd = Form1.dSprite(.layer)
End If

prive.Xt = .Xt
prive.Yt = .Yt
prive.uMineLineSpace = .sUAddTwipsTop
prive.mx = 100
prive.My = 100
prive.SZ = .SZ
End With
dd.FontSize = prive.SZ
LCTbasket dd, prive, y&, x&
If F <> -1 Then BoxBigNew dd, prive, xl& - 1, yl&, F
If b <> -1 Then BoxColorNew dd, prive, xl& - 1, yl&, b
If Id& < 100 Then

    Tag$ = Left$(Tag$, xl& - x&)
    If Tag$ <> "" Then
    '1
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    
    Select Case Id& Mod 10
    Case 2, 5, 8
   
    x& = (xl& + x& - Len(Tag$)) \ 2
    Case 3, 6, 9
    x& = xl& - Len(Tag$)
    
    Case Else
    End Select
    If (Id& Mod 10) > 0 Then
    LCTbasket dd, prive, y&, x&
    dd.FontTransparent = True
    dd.ForeColor = mycolor(prive.mypen)
    ' Εδώ πρέπει να δώ σε ποιο basetask θα τυπώνει ο στόχος...
       PlainBaSket dd, prive, Tag$, True, True
    End If
    End If
Else
        If Tag$ <> "" Then
    Id& = Id& Mod 100
    Select Case Id& Mod 10
    Case 4, 5, 6
    y& = (yl& + y&) \ 2
    Case 7, 8, 9
    y& = yl&
    Case Else
    End Select
    F = 3
    Select Case Id& Mod 10
    Case 2, 5, 8
    F = 2
    Case 3, 6, 9
    F = 1
    Case Else
    End Select
    
    If (Id& Mod 10) > 0 Then
    LCTbasket dd, prive, y&, x&
    dd.FontTransparent = True
    dd.CurrentX = dd.CurrentX - dv15 * 2
    wwPlain ddd, prive, Tag$, xl& - x&, 10000, , True, F, , , True
  
    End If
End If
    

End If
PlaceBasket dd, players(GetCode(dd))
End Sub
Private Function textDel(ByVal ThisFile As String) As Boolean
Dim chk As String
ThisFile = strTemp + ThisFile
chk = CFname(ThisFile)
textDel = (chk <> "")
If chk <> "" Then KillFile chk
End Function
Private Function textPUT(bstack As basetask, ByVal ThisFile As String, THISBODY As String, c$, mode2save As Long) As Boolean
Dim chk As String, b$, j As Long, PREPARE$, VR$, s$, v As Double, buf$, i As Long
ThisFile = strTemp + ThisFile
chk = GetDosPath(ThisFile)
If chk <> "" And c$ = "new" Then KillFile GetDosPath(chk)
On Error GoTo HM
textPUT = True
Do
j = InStr(THISBODY, "##")
If j = 0 Then PREPARE$ = PREPARE$ & THISBODY: Exit Do
If j > 1 Then PREPARE$ = PREPARE$ & Mid$(THISBODY, 1, InStr(THISBODY, "##") - 1)
THISBODY = Mid$(THISBODY, j + 2)
j = InStr(THISBODY, "##")
If j = 0 Then PREPARE$ = PREPARE$ & THISBODY: Exit Do
If j > 1 Then VR$ = Mid$(THISBODY, 1, InStr(THISBODY, "##") - 1)
THISBODY = Mid$(THISBODY, j + 2)
'
If IsExp(bstack, VR$, v) Then
buf$ = Trim$(Str$(v))
ElseIf IsStrExp(bstack, VR$, s$) Then
buf$ = s$
Else
buf$ = VR$
End If
PREPARE$ = PREPARE$ & buf$
Loop
           If Not WeCanWrite(ThisFile) Then GoTo HM

textPUT = SaveUnicode(ThisFile, PREPARE$, mode2save, Not (c$ = "new"))
Exit Function
HM:
textPUT = False
End Function
Public Sub DropLeft(ByVal uStr As String, fromStr As String)
Dim i As Long
i = InStr(fromStr, uStr)
If i > 0 Then
fromStr = Mid$(fromStr, i + Len(uStr))
Else
fromStr = vbNullString
End If
End Sub
Public Function GetStrUntil(ByVal sStr As String, fromStr As String, Optional RemoveSstr As Boolean = True) As String
Dim i As Long

If fromStr = vbNullString Then GetStrUntil = vbNullString: Exit Function
i = InStr(fromStr, sStr)
If i < 2 Then
GetStrUntil = vbNullString
fromStr = vbNullString
Else
GetStrUntil = Left$(fromStr, i - 1)
If RemoveSstr Then
fromStr = Mid$(fromStr, Len(sStr) + i)
Else
fromStr = Mid$(fromStr, i)
End If
End If
End Function
Public Function GetStrUntilR(ByVal sStr As String, fromStr As String, Optional RemoveSstr As Boolean = True) As String
Dim i As Long

If fromStr = vbNullString Then GetStrUntilR = vbNullString: Exit Function
i = InStrRev(fromStr, sStr)
If i < 2 Then
GetStrUntilR = vbNullString
fromStr = vbNullString
Else
GetStrUntilR = Left$(fromStr, i - 1)
If RemoveSstr Then
fromStr = Mid$(fromStr, Len(sStr) + i)
Else
fromStr = Mid$(fromStr, i)
End If
End If
End Function
Function RESOURCES() As String
'ON ERROR GoTo r1
 '   r1 = GetFreeResources(GFSR_GDIRESOURCES)
  '  r2 = GetFreeResources(GFSR_SYSTEMRESOURCES)
   ' r3 = GetFreeResources(GFSR_USERRESOURCES)
    'If r1 < 12 Or r2 < 12 Or r3 < 12 Then
'    If r1 < 12 Then
'    RESOURCES = "!!GDI!!"
'    ElseIf r2 < 12 Then
'    RESOURCES = "!!SYSTEM!!"
'    Else
'    RESOURCES = "!!USER!!"
'    End If
'    Else
'    RESOURCES = Left$(Format$((r1 + r2 + r3) / 3#, "#0.0"), 2)
'    End If
'    Exit Function
'r1:
    RESOURCES = vbNullString
End Function
Public Function myRegister(tp$) As String
    strTemp = String(MAX_FILENAME_LEN, Chr$(0))
    GetTempPath MAX_FILENAME_LEN, StrPtr(strTemp)
    strTemp = mylcasefILE(Left$(strTemp, InStr(strTemp, Chr(0)) - 1))
Dim i As Long
i = FreeFile
Open strTemp & "tmp." & tp$ For Output As i
Print #i, "test"
Close i
' found me
Dim rl$
rl$ = PCall(strTemp & "tmp." & tp$)
If rl$ <> "" Then
rl$ = GetStrUntil(Chr(34), rl$)
End If
Sleep 10
KillFile strTemp & "tmp." & tp$
myRegister = Trim$(rl$)
End Function
Public Function PCall(ByVal sFile As String, Optional param As String) As String
Dim s2 As String, i As Long, bsfile As String, rfile As String, MYNULL$
bsfile = mylcasefILE(sFile)
   s2 = String(MAX_FILENAME_LEN, 32)
   'Retrieve the name and handle of the executable, associated with this file
   i = FindExecutable(StrPtr(sFile), StrPtr(MYNULL$), StrPtr(s2))
   If i > 32 Then
   rfile = mylcasefILE(Left$(s2, InStr(s2, Chr$(0)) - 1))
   If ExtractName(bsfile) = ExtractName(rfile) Then
   ' it is an executable
   PCall = mylcasefILE(bsfile)
   Else
   If param <> "" Then
   PCall = rfile & " " & param & " " & Chr(34) + bsfile + Chr(34)
   Else
      PCall = rfile & " " & Chr(34) + bsfile + Chr(34)
      End If
      End If
      Else
      PCall = vbNullString
End If
End Function
Function PathFromApp(ByVal nap$) As String
Dim ap$
nap$ = nap$ & " "
ap$ = GetStrUntil(" ", nap$)
If ExtractType(ap$) = vbNullString Then ap$ = ap$ & ".exe"
Dim cc As New cRegistry
cc.ClassKey = HKEY_CURRENT_USER
cc.SectionKey = "SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\" & ap$
cc.ValueKey = vbNullString
cc.ValueType = REG_SZ
On Error GoTo 1111
If IsEmpty(cc.Value) Then
cc.ClassKey = HKEY_LOCAL_MACHINE
If IsEmpty(cc.Value) Then

PathFromApp = vbNullString
Else
PathFromApp = Trim$(mylcasefILE(cc.Value & " " & nap$))

End If
Else
PathFromApp = Trim$(mylcasefILE(cc.Value & " " & nap$))
End If
Exit Function
1111:
PathFromApp = vbNullString
End Function
Public Function MyShell(ww$, Optional way As VbAppWinStyle = vbNormalFocus, Optional param As String = vbNullString) As Long
Dim frm$, exst As Boolean, pexist As Boolean, PP$, EXE$
' logic

On Error GoTo 11111
If Is64bit Then Wow64EnableWow64FsRedirection False
again:
If ExtractType(ww$) <> "" Then

frm$ = ExtractPath(ww$) + ExtractName(ww$)
param = RTrim$(Mid$(ww$, Len(frm$) + 1) + " " + param)
ww$ = frm$
ElseIf ExtractPath(ww$) = vbNullString Then
Dim i As Long, j As Long
i = InStr(ww$, Chr(34))
j = InStrRev(ww$, Chr(34))
If j > i Then
param = Mid$(ww$, i, j - i + 1)
ww$ = Left$(ww$, i - 1)
End If

End If
If ww$ = vbNullString Then
If param <> "" Then
MyShell = Shell(Trim$(param), way)
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
End If
End If
If ExtractPath(ww$) = mylcasefILE(ww$) Then
' it is a path
ww$ = "a.@@@ " & ww$
Else
frm$ = CFname(ww$)
If ExtractName(frm$) <> ExtractName(ww$) Then
On Error Resume Next

'MyShell = Shell(Trim$(ww$ & " " & param), way)
EXE$ = Trim$(ww$)
MyShell = ShellExecute(0, 0, StrPtr(EXE$), StrPtr(param), 0, way)
'If Is64bit Then Wow64EnableWow64FsRedirection True
If Err.Number > 0 Then

Err.Clear
ww$ = PathFromApp(ww$)
If ww$ <> "" Then
'ww$ = ReplaceStr(Chr(34), "", ww$) & " " & param
'MyShell = Shell(Trim$(ww$), way)
EXE$ = Trim$(ww$)
MyShell = ShellExecute(0, 0, StrPtr(EXE$), StrPtr(param), 0, way)
End If
End If
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
End If
If CFname(ww$) <> "" Then ww$ = frm$: exst = True

PP$ = ExtractPath(ww$)
End If
If PP$ <> "" Then
pexist = True
ww$ = Mid$(ww$, Len(PP$) + 1)
End If
ww$ = ww$ & " "
EXE$ = vbNullString
If InStr(ww$, ".") > InStr(ww$, " ") Then
EXE$ = Left$(ww$, InStr(ww$, "."))
ww$ = Mid$(ww$, Len(EXE$) + 1)
End If
ww$ = ww$ & " "
EXE$ = EXE$ & Trim$(GetStrUntil(" ", ww$))
' until now we have all things splitted
EXE$ = mylcasefILE(EXE$)
' until now we have all things splitted
Select Case ExtractType(EXE$)
Case ""
If pexist Then
' this is not normal
' ***************ERROR*************
Else
' so we put exe by default
EXE$ = EXE$ & ".exe"
frm$ = PathFromApp(Trim$(EXE$ & " " & ww$))
If frm$ <> "" Then
MyShell = Shell(frm$, way)
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
Else
MyShell = Shell(Trim$(EXE$ & " " & ww$ & " " & param), way)
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
End If
End If
Case "exe", "bat", "com" ' can be run immediatly
If pexist Then
EXE$ = PP$ + EXE$
If param <> "" Then
'MyShell = Shell(Trim$(PP$ & EXE$ & " " & ww$ + " " + param), way)
If Form1.Visible And way = vbNormalFocus Then
MyShell = ShellExecute(Form1.hWND, 0, StrPtr(EXE$), StrPtr(param), StrPtr(PP$), way)
Else
MyShell = ShellExecute(0, 0, StrPtr(EXE$), StrPtr(param), StrPtr(PP$), way)
End If
Else
If Form1.Visible And way = vbNormalFocus Then
MyShell = ShellExecute(Form1.hWND, 0, StrPtr(EXE$), 0, StrPtr(PP$), way)
Else
MyShell = ShellExecute(0, 0, StrPtr(EXE$), 0, StrPtr(PP$), way)
End If
'MyShell = Shell(Trim$(PP$ & EXE$ & " " & ww$), way)
End If
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
Else
frm$ = PathFromApp(Trim$(EXE$ & " " & ww$))
If frm$ <> "" Then
MyShell = Shell(frm$, vbNormalFocus)
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
Else
MyShell = Shell(Trim$(EXE$ & " " & ww$), way)
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
End If
End If
Case "@@@"
'MyShell = Shell(RTrim$("explorer " & ww$), way)
EXE$ = "explorer"
If Form1.Visible Then
MyShell = ShellExecute(Form1.hWND, 0, StrPtr(EXE$), StrPtr(ww$), 0, way)
Else
MyShell = ShellExecute(0, 0, StrPtr(EXE$), StrPtr(ww$), 0, way)
End If
If Is64bit Then Wow64EnableWow64FsRedirection True
Case Else ' its a document
PP$ = ReplaceStr("file:", "", PP$)
frm$ = PCall(PP$ & EXE$)
If frm$ <> "" Then
If AscW(frm$) = 34 Then
frm$ = frm$ & "@"
frm$ = ReplaceStr(Chr(34) & "@", " " + param & Chr(34), frm$)
frm$ = ReplaceStr("@", "", frm$)
MyShell = Shell(Trim$(frm$), way)
Else
frm$ = PCall(PP$ & EXE$, param)

ww$ = frm$ & " " & ww$
GoTo again
End If
If Is64bit Then Wow64EnableWow64FsRedirection True
Exit Function
Else
End If
If Is64bit Then Wow64EnableWow64FsRedirection True
End Select
If MyShell <> 0 Then AppActivate MyShell
11111:
MyShell = 0
' its a document
End Function

Private Function ReplaceStr2(sStr As String, dStr As String, fromStr As String) As String
  ReplaceStr2 = Replace$(fromStr, sStr, dStr, vbTextCompare)
End Function
Function StarSTR(ByVal sStr As String) As String
Dim l As Long, s As Long
l = Len(sStr)
sStr = RTrim(sStr)
s = l - Len(sStr)
StarSTR = String$(l - s, "*") + String$(s, " ")

End Function
Function ReplaceStr(sStr As String, dStr As String, fromStr As String) As String
  ReplaceStr = Replace$(fromStr, sStr, dStr)  ' changed
End Function

Sub mylist(bstack As basetask, Optional tofile As Long = -1, Optional Lang As Long)
Dim Scr As Object, prive As Long
Set Scr = bstack.Owner
prive = GetCode(Scr)
Dim p As Variant, i As Long, s$, pn&, x As Double, y As Double, it As Long, F As Long, pa$
Dim x1 As Long, y1 As Long, frm$, par As Boolean, ohere$, ss$, w$, sX As Double, sY As Double, modname$
Dim pppp As mArray, hlp$, h&, all$, myobject As Object
Dim w1 As Long, w2 As Long, w3 As Long, DUM As Boolean, virtualtop As Long
pn& = 0
virtualtop = varhash.count - 1
'GoTo bypass  '********************************
For pn& = virtualtop To 0 Step -1
varhash.ReadVar pn&, s$, h&
If InStr(s$, ChrW(&H1FFF)) = 0 And InStr(s$, ChrW(&HFFBF)) = 0 Then Exit For
virtualtop = virtualtop - 1
Next pn&
'bypass:
pn& = 0
Dim a() As String
With players(prive)
Do While pn& < varhash.count
varhash.ReadVar pn&, s$, h&
If SecureNames Then
a() = Split(s$, "].")
If UBound(a()) = 1 Then
a(0) = GetName(a(0))
s$ = Join(a(), ".")
End If
End If
If h& = -1 Then
Else
'If InStr(s$, ChrW(&HFFBF)) > 0 And False Then   '*******************
If InStr(s$, ChrW(&HFFBF)) > 0 Then
GoTo LOOPNEXT
'ElseIf InStr(s$, ChrW(&H1FFF)) > 0 And False Then '******************
ElseIf InStr(s$, ChrW(&H1FFF)) > 0 Then '******************
' DO NOTHING
GoTo LOOPNEXT
ElseIf Right$(s$, 1) = "(" Then
    If MyIsObject(var(h&)) Then
        Set myobject = var(h&)
        If Not CheckIsmArray(myobject) Then GoTo LOOPNEXT
        Set pppp = myobject
            Set myobject = Nothing
       F = pppp.bDnum
       w1 = 0
        pppp.GetDnum w1, w2, w3
        w1 = w1 + 1

        If F > 1 Then
            If tofile < 0 Then
                If tofile = -1 Then
                            If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & ",") Then crNew bstack, players(prive)
                            PlainBaSket Scr, players(prive), s$ & Trim$(Str$(w2)) & ","
                Else
                            all = all + " " + s$ + Trim$(Str$(w2)) + ","
                            s$ = vbNullString
                End If
            Else
                If uni(tofile) Then
                    putUniString tofile, s$ & Trim$(Str$(w2)) & ","
                Else
                    putANSIString tofile, s$ & Trim$(Str$(w2)) & ","
                End If
            End If
        Else
        If pn& < virtualtop Then
        If tofile < 0 Then
            If tofile = -1 Then
            If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & "), ") Then crNew bstack, players(prive)
            PlainBaSket Scr, players(prive), s$ & Trim$(Str$(w2)) & "), "
            Else
            'prop
                all = all + " " + s$ + Trim$(Str$(w2)) + "),"
            End If
            Else
                   If uni(tofile) Then
        putUniString tofile, s$ & Trim$(Str$(w2)) & "), "
                Else
                putANSIString tofile, s$ & Trim$(Str$(w2)) & "), "
            
            End If
            End If
       Else
        If tofile < 0 Then
                If tofile = -1 Then
          If .mx - .curpos < Len(s$ & Trim$(Str$(w2)) & ")") Then crNew bstack, players(prive)
         PlainBaSket Scr, players(prive), s$ & Trim$(Str$(w2)) & ")"
         Else
           all = all + " " + s$ + Trim$(Str$(w2)) + ")"
         End If
         Else
                   If uni(tofile) Then
        putUniString tofile, s$ & Trim$(Str$(w2)) & ")"
                Else
putANSIString tofile, s$ & Trim$(Str$(w2)) & ")"

         End If
         End If
     End If
    End If
x = F - 1

While x > 0
x = x - 1
pppp.GetDnum w1, w2, w3
w1 = w1 + 1
If x > 0 Then
If tofile < 0 Then
    If tofile = -1 Then
    
    If .mx - .curpos < Len(Trim$(Str$(w2)) & ",") Then crNew bstack, players(prive)
    PlainBaSket Scr, players(prive), Trim$(Str$(w2)) & ","
    Else
    ' prop
        all = all + " " + s$ + Trim$(Str$(w2)) + ","
    End If
       Else
        If uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & ","
                Else
         putANSIString tofile, Trim$(Str$(w2)) & ","
        ' Print #tofile, Trim$(str$(w2)) & ",";
         End If
         End If
    
Else
        If pn& < virtualtop Then
         If tofile < 0 Then
            If tofile = -1 Then
            If .mx - .curpos < Len(Trim$(Str$(w2)) & "), ") Then crNew bstack, players(prive)
            PlainBaSket Scr, players(prive), Trim$(Str$(w2)) & "), "
            Else
            'prop
                all = all + " " + s$ + Trim$(Str$(w2)) + "),"
            End If
            Else
     If uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & "), "
                Else
                putANSIString tofile, Trim$(Str$(w2)) & "), "
            'Print #tofile, Trim$(str$(w2)) & "), ";
            End If
            End If
        Else
        If tofile < 0 Then
    If tofile = -1 Then
            If .mx - .curpos < Len(Trim$(Str$(w2)) & ")") Then crNew bstack, players(prive)
            PlainBaSket Scr, players(prive), Trim$(Str$(w2)) & ")"
            Else
            ' prop
                                all = all + " " + s$ + Trim$(Str$(w2)) + ")"
            End If
            Else
                               If uni(tofile) Then
        putUniString tofile, Trim$(Str$(w2)) & ")"
                Else
                putANSIString tofile, Trim$(Str$(w2)) & ")"
            'Print #tofile, scr, Trim$(str$(w2)) & ")";
            End If
            End If
        End If
    End If
Wend

    End If
    GoTo LOOPNEXT
 ElseIf Right$(s$, 1) = "$" Or Right$(s$, 3) = "$()" Then  ' WHY "$()"
    ' h& = Val(Mid$(VarName$, pn&))
        If Typename(var(h&)) = doc Then
            If var(h&).IsEmpty Then
                hlp$ = " [Empty Document]"
            Else
                hlp$ = " [Document " + CStr(var(h&).SizeCRLF) & " chars]"
            End If
        ElseIf Typename(var(h&)) = "PropReference" Then
        hlp$ = " [Object Property]"
        Else
        If MyIsObject(var(h&)) Then
        If TypeOf var(h&) Is lambda Then
            hlp$ = "[lambda$]"
            Else
            
            If TypeOf var(h&) Is Constant Then
                 If Len(var(h&)) > 3 * .mx Then
                    hlp$ = " = [" + Left$(CStr(var(h&)), 4) & "...]"
                Else
                    hlp$ = " = [" + CStr(var(h&)) + "]"
                End If
            Else
            hlp$ = "[" + Typename(var(h&)) + "]"
            End If
            End If
        Else
        
            If Len(var(h&)) > 3 * .mx Then
                hlp$ = " = " & Chr(34) + Left$(CStr(var(h&)), 4) & "..." & Chr(34)
            Else
                hlp$ = " = " & Chr(34) + CStr(var(h&)) + Chr(34)
            End If
            
        End If
        End If
    s$ = s$ & hlp$
    
Else

If MyIsObject(var(h&)) Then
If var(h&) Is Nothing Then
s$ = s$ + "*[Nothing]"
ElseIf TypeOf var(h&) Is mHandler Then
Select Case var(h&).t1
Case 1
    s$ = s$ + "*[Inventory]"
Case 2
    s$ = s$ + "*[Buffer]"
Case 4
    s$ = s$ + "*[" + var(h&).objref.EnumName + "]"
Case Else
If Not var(h&).objref Is Nothing Then
    If TypeOf var(h&).objref Is mHandler Then
        If var(h&).objref.t1 = 4 Then
        s$ = s$ + "*[" + var(h&).objref.objref.EnumName + "]"
        Else
        s$ = s$ + "*[" + Typename(var(h&).objref) + "]"
        End If
    Else
    s$ = s$ + "*[" + Typename(var(h&).objref) + "]"
    End If
End If
End Select
Else

If TypeOf var(h&) Is Constant Then
    On Error Resume Next
    s$ = s$ & " = [" & LTrim$(Str(var(h&))) + "]"
    If Err Then
    s$ = s$ & " = [" & var(h&) + "]"
    Err.Clear
    End If
Else
If TypeOf var(h&) Is Group Then
If var(h&).IamApointer Then
s$ = s$ & "*[" & Typename(var(h&)) & "]"
Else
s$ = s$ & "[" & Typename(var(h&)) & "]"
End If
Else
s$ = s$ & "[" & Typename(var(h&)) & "]"
End If
End If
End If
Else
On Error Resume Next
s$ = s$ & " = " & LTrim(Str(var(h&)))
If Err Then
s$ = s$ & " = " & Chr(34) & var(h&) & Chr(34)
Err.Clear
End If
Select Case VarType(var(h&))
        Case vbLong
        s$ = s$ & "&"
        Case vbDecimal
        s$ = s$ & "@"
        Case vbSingle
        s$ = s$ & "~"
        Case vbCurrency
        s$ = s$ & "#"
        Case vbInteger
        s$ = s$ & "%"
        End Select
End If
End If
If pn& < virtualtop Then s$ = s$ & ", "
If tofile < 0 Then
   If tofile = -1 Then
   If .mx - .curpos < Len(s$) Then crNew bstack, players(prive)
    PlainBaSket Scr, players(prive), s$
    End If
    ' proportional
    all = all + " " + s$
   Else
   If uni(tofile) Then
putUniString tofile, s$
   Else
    putANSIString tofile, s$

    End If
    End If
 End If
LOOPNEXT:
pn& = pn& + 1
Loop
s$ = vbNullString
If Not bstack.StaticCollection Is Nothing Then
Dim st1 As Long, mList As FastCollection
Set mList = bstack.StaticCollection
For st1 = 1 To mList.count
mList.index = st1 - 1
If Left$(mList.KeyToString, 2) <> "%_" Then
If s$ <> "" Then s$ = s$ + ", "
If mList.IsObj Then
If TypeOf mList.ValueObj Is mHandler Then
Select Case mList.ValueObj.t1
Case 1
s$ = s$ + mList.KeyToString + "*[Inventory]"
Case 2
s$ = s$ + mList.KeyToString + "*[Buffer]"
Case 3
s$ = s$ + mList.KeyToString + "*[" + Typename(mList.ValueObj.objref) + "]"
End Select
Else
s$ = s$ + mList.KeyToString + " [" + Typename(mList.ValueObj) + "]"
End If
Else
If IsNumeric(mList.Value) Then
s$ = s$ + mList.KeyToString + " = " + LTrim(Str$(mList.Value))
Else
If Len(var(h&)) > 3 * .mx Then
 s$ = s$ + mList.KeyToString + " = " & Chr(34) + Left$(mList.Value, 4) & "..." & Chr(34)
 Else
s$ = s$ + mList.KeyToString + " = " & Chr(34) + mList.Value + Chr(34)
End If
End If
End If
End If
Next st1
If s$ <> "" Then
If Lang = 1 Then

s$ = " Static Variables: " + s$
Else
s$ = " Στατικές Μεταβλητές: " + s$
End If
If tofile >= 0 Then
 putUniString tofile, vbCrLf
If uni(tofile) Then
        putUniString tofile, s$
                Else
                putANSIString tofile, s$

    End If
End If



End If
End If
    If tofile < -1 Then
        If Scr.CurrentX <> 0 Then crNew bstack, players(prive)
        If s$ <> "" Then s$ = vbCrLf + s$
        wwPlain bstack, players(prive), all$ + s$, Scr.Width, 1000, True, , 3
    ElseIf tofile = -1 Then
        If s$ <> "" Then
         crNew bstack, players(prive)
        
        PlainBaSket Scr, players(prive), s$
        End If
    End If
    
    If tofile < 0 Then crNew bstack, players(prive)
      End With
End Sub

Function NeoGetArrayItem(PP As mArray, bstack As basetask, v$, offset As Long, rst$, Optional noObject As Boolean = False, Optional closepar As Boolean = True) As Boolean
If PP Is Nothing Then
MyEr "Internal Error: NeoGetArrayItem", "εσωτερικό λάθος: NeoGetArrayItem": Exit Function
End If
If noObject And PP.IHaveClass Then Exit Function
Dim dn As Long, dd As Long, w3 As Long, sp$, lim As Long
Dim p As Variant
If v$ <> "" Then sp$ = ")"
again123:
dd = 0
dn = 0
If Not PP.Arr Then
Dim ppp$
    If TypeOf PP.GroupRef Is mHandler Then
        If PP.GroupRef.t1 <> 1 Then
            If IsExp(bstack, rst$, p) Then
                p = MyRound(p)
                If PP.GroupRef.indirect >= 0 Then
                    If Typename(var(PP.GroupRef.indirect)) = myArray Then Exit Function
                        If p >= 0 Or p < var(PP.GroupRef.indirect).objref.items Then
                            GoTo conthere
                        End If
                    Else
                        If p >= 0 Or p < PP.GroupRef.objref.items Then
                            GoTo conthere
                        End If
                    End If
                End If
                MyEr "offset out of limits", "Δείκτης εκτός ορίων"
                Exit Function
            End If
            If IsExp(bstack, rst$, p) Then
                With PP.GroupRef.objref
                    If Not FastSymbol(rst$, "!") Then ppp$ = CStr(p): GoTo contlabel1
                    p = MyRound(p)
                    If Abs(p) < .count Then
                        If p < 0 Then
                            .index = .count + Int(p)
                        Else
                            .index = Int(p)
                        End If
                        .index = p
                        offset = -.index - 100
                        .Done = True
                    Else
                        MyEr "Index out of limits", "Δείκτης εκτός ορίων"
                    End If
                End With
            ElseIf IsStrExp(bstack, rst$, ppp$) Then
contlabel1:
                With PP.GroupRef.objref
                
                    If Not .Find(ppp$) Then
                        MyEr "Not found Key", "Δεν βρέθηκε το κλειδί"
                        NeoGetArrayItem = False
                        Exit Function
                    Else
                        offset = -.index - 100
                        
                    End If
                    
                    If Typename(.ValueObj) = "Group" Then
                        If .ValueObj.HasParametersSet Or .ValueObj.HasParameters Then
                            NeoGetArrayItem = True
                        End If
                   ElseIf FastSymbol(rst, ")(", , 2) Then
                        If Typename(.ValueObj) = myArray Then
                        Set PP = .ValueObj
                        
                        GoTo again123
                        Else
                        NeoGetArrayItem = False
                        End If
                    Else
                    End If
                    
                End With
             End If
    ElseIf TypeOf PP.GroupRef Is Group Then
    
    offset = -2
    
    NeoGetArrayItem = True
    Exit Function
    
        Else
contprop:
            Dim aprop As PropReference
            Set aprop = PP.GroupRef
            If IsExp(bstack, rst$, p) Then
                aprop.index = p
            ElseIf IsStrExp(bstack, rst$, ppp$) Then
                aprop.index = ppp$
            End If
            aprop.UseIndex = True
            Set aprop = Nothing
        End If
conthere:
    If closepar Then If Not FastSymbol(rst$, ")") Then MyEr "missing )", "λείπει )": Exit Function
    NeoGetArrayItem = True
ElseIf PP.SerialItem((0), dd, 5) Then
dd = dd - 1
offset = 0
If dd < 0 Then
If Typename(PP.GroupRef) = "PropReference" Then
GoTo contprop

End If
End If
Do While dn <= dd
PP.GetDnum dn, w3, lim
 If IsExp(bstack, rst$, p) Then
 If dn < dd Then
        If Not FastSymbol(rst$, ",") Then MyEr "need index for " & v$ & sp$, "χρειάζομαι δείκτη για το πίνακα " & v$ & sp$: Exit Function
        Else
        If FastSymbol(rst$, ",") Then MyEr "too many indexes for array " & v$ & sp$, "πολλοί δείκτες για το πίνακα " & v$ & sp$: Exit Function
        If Not FastSymbol(rst$, ")") Then MyEr "missing )", "λείπει )": Exit Function
    End If
        On Error Resume Next
       
        If p < -lim Then
         MyEr "index too low for array " & v$ & sp$, "αρνητικός δείκτης στο πίνακα " & v$ & sp$: Exit Function
    
        End If
        If PP.PushOffset(offset, dn, CLng(p)) Then
        NeoGetArrayItem = True
        Else
          
          MyEr "index too high for array " & v$ & sp$, "δείκτης υψηλός για το πίνακα " & v$ & sp$: Exit Function
        
            
            End If
        Else
         If LastErNum = -2 Then
         Else
   MyEr "missing index for array " & v$ & sp$, "χάθηκε δείκτης για το πίνακα " & v$ & sp$
   End If
   Exit Function
    End If
    dn = dn + 1
Loop
End If
If MaybeIsSymbol(rst, "(") Then

If Typename(PP.item(offset)) = myArray Then
FastSymbol rst$, "("
    Set PP = PP.item(offset)
    NeoGetArrayItem = False
    GoTo again123
ElseIf Typename(PP.item(offset)) = "mHandler" Then
FastSymbol rst$, "("
    Set bstack.lastobj = PP.item(offset)
    Set PP = New mArray
    Set PP.GroupRef = bstack.lastobj
    Set bstack.lastobj = Nothing
    PP.Arr = False
    NeoGetArrayItem = False
    GoTo again123
ElseIf Typename(PP.item(offset)) = "Group" Then
    
   
    NeoGetArrayItem = True

End If
End If

End Function
Sub getfirstpage()
Dim try1 As Long
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If

'If pwox > phoy Then mydpi = phoy Else mydpi = pwox
''mydpi = pwox / 4
If pwox <= phoy Then
mydpi = pwox
Else
mydpi = phoy
End If
''prFactor = 1
prFactor = mydpi / 288#
mydpi = 288


again:
On Error Resume Next
' DC FROM PRINTER
oprinter.ClearUp
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then
oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
Form1.PrinterDocument1.Cls
oprinter.needHDC

Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
If Err > 0 And try1 < 2 Then
try1 = try1 + 1
prFactor = prFactor * 2
mydpi = mydpi / 2
GoTo again
End If
szFactor = mydpi * dv15 / 1440#
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi + 0.5), 3, 1))
pnum = 0
End If
End Sub
Sub getnextpage()

If oprinter.Height = 0 Then
getfirstpage

Else
pnum = pnum + 1
With players(-2)
.curpos = 0
.currow = 0
.lastprint = False
.XGRAPH = 0
.YGRAPH = 0
End With
With Form1.PrinterDocument1
.CurrentX = 0
.CurrentY = 0
End With
oprinter.CopyPicture Form1.PrinterDocument1
oprinter.ThumbnailPaintPrinter 1, 100 * prFactor, False, True, True, , , , , , Form3.CaptionW & " " & Str$(pnum)
Form1.PrinterDocument1.Cls
End If
End Sub
Sub getenddoc()
pnum = pnum + 1
If prFactor = 0 Then prFactor = 1
oprinter.CopyPicture Form1.PrinterDocument1
oprinter.ThumbnailPaintPrinter 1, 100 * prFactor, False, True, True, , , , , , Form3.CaptionW & " " & Str$(pnum)
oprinter.ClearUp
Form1.PrinterDocument1.Picture = LoadPicture("")
End Sub
Sub Landscape(bstack As basetask)
Dim dummy As Object, try1 As Long
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If
If pwox <= phoy Then
mydpi = pwox
Else
mydpi = phoy
End If
prFactor = mydpi / 288
mydpi = 288
again:


If Int(psw / pwox * mydpi + 0.5) / Int(psh / phoy * mydpi + 0.5) < 1 Then ChangeOrientation dummy, Printer.DeviceName, MyDM(): PrinterDim pw, ph, psw, psh, pwox, phoy
If Not bstack.toprinter Then Exit Sub
oprinter.ClearUp
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then
oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
oprinter.needHDC
On Error Resume Next
Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
If Err > 0 And try1 < 2 Then
oprinter.ClearUp
try1 = try1 + 1
prFactor = prFactor * 2
mydpi = mydpi / 2
GoTo again
End If
szFactor = mydpi * dv15 / 1440#
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi / 4) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi / 4 + 0.5), 3, 1))
End If
If bstack.toprinter Then
    SetText Form1.PrinterDocument1
    Else
    PlaceBasket Form1.PrinterDocument1, players(-2)
    SetText Form1.PrinterDocument1
End If

End Sub
Sub Portrait(bstack As basetask)
Dim dummy As Object, try1 As Long
If UBound(MyDM) = 1 Then
PrinterDim pw, ph, psw, psh, pwox, phoy
End If
If pwox <= phoy Then
mydpi = pwox
Else
mydpi = phoy
End If
prFactor = mydpi / 288
mydpi = 288
szFactor = mydpi * dv15 / 1440#
again:
If Int(psw / pwox * mydpi + 0.5) / Int(psh / phoy * mydpi + 0.5) > 1 Then ChangeOrientation dummy, Printer.DeviceName, MyDM(): PrinterDim pw, ph, psw, psh, pwox, phoy
If Not bstack.toprinter Then Exit Sub
oprinter.ClearUp
If oprinter.Create(Int(psw / pwox * mydpi + 0.5), Int(psh / phoy * mydpi + 0.5)) Then
oprinter.WhiteBits
oprinter.GetDpi mydpi, mydpi
oprinter.needHDC
Set Form1.PrinterDocument1 = hDCToPicture(oprinter.HDC1, 0, 0, oprinter.Width, oprinter.Height)
oprinter.FreeHDC
If Err > 0 And try1 < 2 Then
try1 = try1 + 1
prFactor = prFactor * 2
mydpi = mydpi / 2
GoTo again
End If
szFactor = mydpi * dv15 / 1440#
Form1.PrinterDocument1.Scale (0, 0)-(Form1.ScaleX(Int(psw / pwox * (mydpi / 4) + 0.5), 3, 1), Form1.ScaleY(Int(psh / phoy * mydpi / 4 + 0.5), 3, 1))

End If
If bstack.toprinter Then
    SetText Form1.PrinterDocument1
    Else
    PlaceBasket Form1.PrinterDocument1, players(-2)
    SetText Form1.PrinterDocument1
End If
End Sub
Function StripTerminator(ByVal strString As String) As String
    Dim intZeroPos As Long

    intZeroPos = InStr(strString, Chr$(0))
    If intZeroPos > 0 Then
        StripTerminator = Left$(strString, intZeroPos - 1)
    Else
        StripTerminator = strString
    End If
End Function
Sub AddDirSep(strPathName As String)
    If Right(Trim(strPathName), Len(gstrSEP_URLDIR)) <> gstrSEP_URLDIR And _
       Right(Trim(strPathName), Len(gstrSEP_DIR)) <> gstrSEP_DIR Then
        strPathName = RTrim$(strPathName) & gstrSEP_DIR
    End If
End Sub

Function GetWindowsDir() As String
    Dim strBuf As String

    strBuf = Space$(gintMAX_SIZE)

    '
    'Get the windows directory and then trim the buffer to the exact length
    'returned and add a dir sep (backslash) if the API didn't return one
    '
    If GetWindowsDirectory(strBuf, gintMAX_SIZE) > 0 Then
        strBuf = StripTerminator$(strBuf)
        AddDirSep strBuf

        GetWindowsDir = strBuf
    Else
        GetWindowsDir = vbNullString
    End If
End Function
Function GetWindowsfontDir() As String
    Dim strBuf As String

    strBuf = Space$(gintMAX_SIZE)

    '
    'Get the windows directory and then trim the buffer to the exact length
    'returned and add a dir sep (backslash) if the API didn't return one
    '
    If GetWindowsDirectory(strBuf, gintMAX_SIZE) > 0 Then
        strBuf = StripTerminator$(strBuf)
        AddDirSep strBuf
        strBuf = strBuf & "FONT"
        AddDirSep strBuf
    
        GetWindowsfontDir = strBuf
    Else
        GetWindowsfontDir = vbNullString
    End If
End Function

 
Sub nhelp(bstack As basetask, Optional GREEK As Boolean = False)
Dim di As Object
Set di = bstack.Owner
If GREEK Then
Dim bb$
bb$ = "   ΕΛΛΗΝΙΚΑ ή ΛΑΤΙΝΙΚΑ για επιλογή κωδικοσελίδας για το τύπο εμφάνισης βοήθειας " & vbCrLf
bb$ = bb$ & "   Με Esc τερματίζει η εκτέλεση τμημάτων  " & vbCrLf
bb$ = bb$ & "   ctrl + f1 ανοίγει την βοήθεια, γράφοντας και επιλέγοντας βρίσκει" & vbCrLf
bb$ = bb$ & "   ctrl + c Τερματίζει την εκτέλεση και καθαρίζει" & vbCrLf
bb$ = bb$ & "   ctrl + οποιοδήποτε πλήκτρο ανοίγει τη βηματική εκτέλεση" & vbCrLf
bb$ = bb$ & "   pause/break κάνει ψυχρή εκκίνηση / δες ΒΟΗΘΕΙΑ ΑΡΧΗ" & vbCrLf
bb$ = bb$ & "   Σ ονομαΤμηματος ανοίγει τον διορθωτή για να γράψουμε πρόγραμμα" & vbCrLf
bb$ = bb$ & "   Σ ονομαΣυνάρτησης( ανοίγει τον διορθωτή για να γράψουμε συνάρτηση" & vbCrLf
bb$ = bb$ & "   Σ ονομαΣυνάρτησης$( ανοίγει τον διορθωτή για να γράψουμε συνάρτηση$" & vbCrLf
bb$ = bb$ & "   Τμηματα  [μας δείχνει τα τμήματα στη μνήμη και το δίσκο]" & vbCrLf
bb$ = bb$ & "   ΒΟΗΘΕΙΑ κατι (μας δίνει βοήθεια σε ξεχωριστό παράθυρο)" & vbCrLf
bb$ = bb$ & "   ? ή ΤΥΠΩΣΕ τυπώνει" & vbCrLf
bb$ = bb$ & "   δώσε την εντολή ΡΥΘΜΙΣΕΙΣ η ctrl+U για να αλλάξει την εξ ορισμού γραμματοσειρά και τα χρώματα" & vbCrLf
bb$ = bb$ & "   δώσε την εντολή ΕΛΕΓΧΟΣ για να δεις στοιχεία του διερμηνευτή" & vbCrLf
bb$ = bb$ & "   δώσε την εντολή ΤΕΛΟΣ για να τερματίσεις τον διερμηνευτή" & vbCrLf
Else
bb$ = "   GREEK or LATIN for choose the codepage for errors display" & vbCrLf
bb$ = bb$ & "   with LATIN all error messages are in ENGLISH language  " & vbCrLf
bb$ = bb$ & "   Esc escape execution" & vbCrLf
bb$ = bb$ & "   ctrl + f1 open help form, you can write and click for find" & vbCrLf
bb$ = bb$ & "   ctrl + c terminate execution, clear all" & vbCrLf
bb$ = bb$ & "   ctrl + anykey open for test" & vbCrLf
bb$ = bb$ & "   pause/break for break cold reset / look HELP START" & vbCrLf
bb$ = bb$ & "   EDIT modulename     [open editor for writing program]" & vbCrLf
bb$ = bb$ & "   EDIT functionname( [open editor for writing function()]" & vbCrLf
bb$ = bb$ & "   EDIT functionname$( [open editor for writing function$()]" & vbCrLf
bb$ = bb$ & "   MODULES for a list of modules in memory and on dik" & vbCrLf
bb$ = bb$ & "   use HELP writesomething [to find some help, open the help form]" & vbCrLf
bb$ = bb$ & "   ? or PRINT for printing" & vbCrLf
bb$ = bb$ & "   type SETTINGS or ctrl+U to change the default font and colors" & vbCrLf
bb$ = bb$ & "   type MONITOR for info about current state of Interpreter" & vbCrLf
bb$ = bb$ & "   type END and press enter to close this program" & vbCrLf
End If
wwPlain bstack, players(GetCode(bstack.Owner)), bb$, di.Width, 1000, True
crNew bstack, players(GetCode(bstack.Owner))
End Sub
Public Sub EnableMidi()
Dim curDevice As Long, rc As Long

 If hmidi = 0 Then
rc = GetFuncPtr("winmm.dll", "midiOutOpen")
If rc <> 0 Then
    rc = midiOutOpen(hmidi, curDevice, 0, 0, 0)
    If (rc <> 0) Then
       MyEr "Couldn't open midi device - Error #" & rc, "Δεν μπορώ να ανοίξω κανάλι Midi - λάθος #"" & rc"
    End If
    End If
    End If
End Sub
Public Sub DisableMidi()
  midiOutClose (hmidi)
  hmidi = 0
End Sub
Public Sub Quit()
  ' An example of an Application Quit routine:
  
  ' The Dispose method must be called to
  ' clean up the queue
  DisableMidi
  TaskMaster.Dispose
  Set TaskMaster = Nothing
  
  ' Insure all but 1 form is unloaded.
  ' (When called from Form_Unload, that form
  '  cannot be removed, so 1 is allowed)
  Do While Forms.count > 1
    Unload Forms(1)
  Loop
  ' Notification if there are problems with demo
  Debug.Assert Forms.count = 1
End Sub

Public Sub TaskMasterTick()
' This is the TimerFunction that will be
' called when SetTimer times out.
Static once As Boolean
If once Then Exit Sub
  If Not TaskMaster Is Nothing Then

    If Abs(MasterTimer - CDbl(timeGetTime)) > 50 Then
        If Not extreme Then once = True: DoEvents: once = False
        MasterTimer = CDbl(timeGetTime)
    End If
   ' Form1.Caption = MasterTimer
    TaskMaster.TimerTick
  End If

End Sub
Public Sub instrument(insID As Long, Channel As Long)
EnableMidi
Dim midimsg As Long
    midimsg = (insID * 256) + &HC0 + Channel
    midiOutShortMsg hmidi, midimsg
End Sub
Public Function VALIDATEmStiva(bs As basetask, p$, s$) As Boolean
Dim st As mStiva, ss$, j As Long, anything As Object

Set st = bs.soros
Dim i As Long, r$
If p$ <> "" Then
    ''s$ = VbNullString
    If st.Total < Len(p$) Then Exit Function
    Do While i < Len(p$)
    i = i + 1
    j = AscW(st.StackItemType(i))
If j <> 62 Then
    Select Case AscW(Mid$(p$, i, 1))
    Case 62
    ' OPTIONAL IS OK ??

    Case 66, 98, 916, 948
        If j <> 42 Then Exit Function
        If Typename$(st.StackItem(i)) = "mHandler" Then
            If st.StackItem(i).t1 <> 2 Then Exit Function
        Else
            Exit Function
        End If
    
    Case 73, 105, 922, 954
        If j <> 42 Then Exit Function
        If Typename$(st.StackItem(i)) = "mHandler" Then
            If st.StackItem(i).t1 = 3 Then
             Set anything = st.StackItem(i).objref
                If CheckDeepAny(anything) Then
                If Typename$(anything) = "FastCollection" Then
                If anything.StructLen <> 0 Then Exit Function
                Else
                Exit Function
                End If
                Else
                    Exit Function
                End If
            ElseIf st.StackItem(i).t1 <> 1 Then
                Exit Function
            End If
        Else
            Exit Function
        End If
    Case 67, 99, 931, 963
      If j <> 42 Then Exit Function
        If Typename$(st.StackItem(i)) = "mHandler" Then
            If st.StackItem(i).t1 = 3 Then
             Set anything = st.StackItem(i).objref
                If CheckDeepAny(anything) Then
                If Typename$(anything) = "mStiva" Then
                Else
                Exit Function
                End If
                Else
                    Exit Function
                End If
            Else
                Exit Function
            End If
        Else
            Exit Function
        End If
    Case 925, 957, 913, 945, 78, 110 '' number  - use spellunicode to make it
        If j = 42 Then
        If Typename(st.StackItem(i)) = "mHandler" Then If st.StackItem(i).t1 <> 4 Then Exit Function
        ElseIf j <> 78 Then
        Exit Function
        End If
    Case 923, 955, 70, 102  ' change from L l to F f form lambda
     If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 1))
        If j <> 108 Then Exit Function
    Case 915, 947, 83, 115 '' string
        If j <> 83 Then Exit Function
    Case 928, 960, 65, 97  '' array
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 2))
        
        If j <> 65 Then
            If Typename$(st.StackItem(i)) = "mHandler" Then
                If st.StackItem(i).t1 = 3 Then
                    Set anything = st.StackItem(i).objref
                    If CheckDeepAny(anything) Then
                        If Typename$(anything) = myArray Then
                        Else
                            Exit Function
                        End If
                    Else
                        Exit Function
                    End If
                Else
                    Exit Function
                End If
            Else
                Exit Function
            End If
        End If
    Case 917, 69
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 2))
        If j <> 69 Then Exit Function
    Case 927, 959, 954, 71, 103, 67, 99
        If j = 42 Then j = AscW(Mid$(Typename(st.StackItem(i)), 1))
         If j <> 71 Then Exit Function
    Case 76, 924
    If j <> 76 Then Exit Function
    Case Else
        Exit Function
    End Select
    End If
    
    Loop
    s$ = " "
    VALIDATEmStiva = True
    Exit Function
Else
    Do
    i = i + 1
    If st.Total < i Then Exit Do
        ss$ = st.StackItemType(i)
        If ss$ = "*" Then
        
            ss$ = Left$(Typename(st.StackItem(i)), 2)
CheckAgain:
            If ss$ = "mA" Then ss$ = "A"
            If ss$ = "mE" Then ss$ = "E"
            If ss$ = "Gr" Then ss$ = "G"
            If ss$ = "la" Then ss$ = "F"
            If ss$ = "mS" Then ss$ = "C"
            If ss$ = "mH" Then
                Select Case st.StackItem(i).t1
                Case 1
                ss$ = "I"
                Case 2
                ss$ = "B"
                Case 3
                Set anything = st.StackItem(i).objref
                
                If CheckDeepAny(anything) Then
                ss$ = Left$(Typename(anything), 2)
                GoTo CheckAgain
                End If
                ss$ = "U"   ' "Undefined"
                Case 4
                ss$ = "N"
                Case Else
                ss$ = "U"   ' "Undefined"
                End Select
            End If
        End If
    r$ = r$ & Right$("?" + ss$, 1)
    Loop
    s$ = r$
End If
VALIDATEmStiva = r$ <> ""
End Function

Public Function VALIDATE(st$, p$, s$) As Boolean
Dim dummy As Double
Dim i As Long, j As Long, ok As Boolean
If Len(st$) = 0 Then
VALIDATE = True
End If
' NORMALIZE
s$ = vbNullString
ok = True
For i = 1 To Len(st$)
Select Case Mid$(st$, i, 1)
Case " ", ",", ChrW(160)

Case Is = Chr(34)
j = InStr(i + 1, st$, Chr(34), vbBinaryCompare)
If j = 0 Then Exit For
s$ = s$ & "S"
i = j + 1
            If p$ <> "" Then
                Select Case AscW(p$)
                Case 915, 947, 83, 115 '' string
                Case Else
                        ok = False: Exit For
                End Select
                    p$ = Mid$(p$, 2)
                    If p$ = vbNullString Then Exit For
             End If
 Case Is = Chr$(2)
            If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             s$ = s$ & "S"
             If p$ <> "" Then
                Select Case AscW(p$)
                Case 915, 947, 83, 115 '' string
                Case Else
                        ok = False: Exit For
                End Select
             p$ = Mid$(p$, 2)
             If p$ = vbNullString Then Exit For
             End If
             Else
             Exit For
             End If
Case Else
        If IsNumberD3(st$, i, j) Then
                If i = 0 Then i = j + 1
                i = i + j - 2
                s$ = s$ & "N"
                    If p$ <> "" Then
                Select Case AscW(p$)
                 Case 925, 957, 913, 945, 78, 110 '' number
                Case Else
                        ok = False: Exit For
                End Select
                         p$ = Mid$(p$, 2)
                         If p$ = vbNullString Then Exit For
                    End If
      Else
          Exit For
      End If
End Select
      

Next i
 ' TO P$ ΘΑ ΠΑΡΕΙ ΤΟ ΥΠΟΛΟΙΠΟ

   p$ = Mid$(st$, i + 1)
   st$ = Left$(st$, i)
    VALIDATE = ok
End Function

Public Function VALIDATEpart(st$, p$) As Boolean
Dim dummy As Double
Dim i As Long, j As Long, ok As Boolean, s$
If Len(st$) = 0 Then
VALIDATEpart = False   ' reverse logic here...
End If
' NORMALIZE
s$ = vbNullString
ok = True
For i = 1 To Len(st$)
If Mid$(st$, i, 1) = Chr$(2) Then
            If Len(Mid$(st$, i + 1, 8)) = 8 Then
             i = i + UNPACKLNG(Mid$(st$, i + 1, 8)) + 8
             Else
             Exit For
             End If
      ElseIf IsNumberD3(st$, i, j) Then
      i = j + i - 2
      Else
      i = i - 1
      Exit For
      End If
      

Next i
p$ = Left$(st$, i)
    st$ = " " & Mid$(st$, i + 1)
    VALIDATEpart = p$ <> ""
End Function

Public Function GetTempFileName() As String

   Dim sTmp    As String
   Dim sTmp2   As String
   Dim EXENAME As String
   EXENAME = App.EXENAME

   sTmp2 = GetTempPathgg
   sTmp = Space(Len(sTmp2) + 256)
   Call GetTempFileNameW(StrPtr(sTmp2), StrPtr(EXENAME), UNIQUE_NAME, StrPtr(sTmp))
   GetTempFileName = Left$(sTmp, InStr(sTmp, Chr$(0)) - 1)
    tempList2delete = Sput(GetTempFileName) + tempList2delete
End Function
Public Sub DelTemp()
Dim tmp$
On Error Resume Next
While tempList2delete <> ""
If Not ISSTRINGA(tempList2delete, tmp$) Then Exit Sub
KillFile tmp$
Wend

End Sub

Private Function GetTempPathgg() As String
  
   Dim sTmp       As String
   Dim i          As Long
    Dim EM$
    
   i = GetTempPath(0, StrPtr(EM$))
   sTmp = Space(i)

   Call GetTempPath(i, StrPtr(sTmp))
   GetTempPathgg = AddBackslash(Left$(sTmp, i - 1))

End Function

Private Function AddBackslash(s As String) As String

   If Len(s) > 0 Then
      If Right$(s, 1) <> "\" Then
         AddBackslash = s & "\"
      Else
         AddBackslash = s
      End If
   Else
      AddBackslash = "\"
   End If

End Function



Sub mywait(bstack As basetask, PP As Variant, Optional SLEEPSHORT As Boolean = False)
Dim p As Boolean, e As Boolean
On Error Resume Next
If bstack.Process Is Nothing Then
''If extreme Then MyDoEvents1 Form1
If PP = 0 Then Exit Sub
Else

Err.Clear
p = bstack.Process.Done
If Err.Number = 0 Then
e = True
If p <> 0 Then
Exit Sub
End If
End If
End If

PP = PP + CDbl(timeGetTime)

Do


If TaskMaster.Processing And Not bstack.TaskMain Then
        If Not bstack.toprinter Then bstack.Owner.Refresh
        TaskMaster.TimerTick
       ' SleepWait 1
        MyDoEvents1 Form1   'bstack.Owner '
Else
        ' SleepWait 1
        MyDoEvents1 Form1   'bstack.Owner '
End If
If SLEEPSHORT Then Sleep 1
If e Then
p = bstack.Process.Done
If Err.Number = 0 Then
If p <> 0 Then
Exit Do
End If
End If
End If
Loop Until PP <= CDbl(timeGetTime) Or NOEXECUTION

                       If exWnd <> 0 Then
                MyTitle$ bstack
                End If
End Sub
Sub ProcTask(bstack As basetask)
On Error GoTo procbliah
If TaskMaster.Processing Then
           TaskMaster.RestEnd1
 TaskMaster.TimerTick
ElseIf Not (bstack.IamChild Or bstack.IamAnEvent) Then
If REFRESHRATE > 25 Then k1 = 0
REFRESHRATE = 40
Sleep 1
ElseIf SLOW Or IsWine Then
Sleep 1
End If
TaskMaster.rest
SleepWaitEdit bstack, 1
TaskMaster.RestEnd
Exit Sub
procbliah:
 DoEvents
Sleep 1
End Sub
Sub ProcTask2(bstack As basetask)
On Error GoTo procbliah2
If TaskMaster Is Nothing Then
If SLOW Then
Sleep 1
End If
DoEvents
Else
If TaskMaster.Processing Then
          TaskMaster.RestEnd1
 TaskMaster.TimerTickNow

ElseIf SLOW Or IsWine Then
Sleep 1
End If
TaskMaster.rest

SleepWaitEdit2 1
TaskMaster.RestEnd
End If
Exit Sub
procbliah2:
DoEvents
Sleep 1
End Sub

Sub ResetBreak()
Do While KeyPressedLong(&H13) <> 0
MyDoEvents
Loop

End Sub

Function myexit(bstack As basetask) As Boolean
On Error Resume Next
If Not extreme Then

            If escok Then
                        If KeyPressed(&H1B) Then
                        If Modalid <> 0 Then
                         Modalid = 0
                         ShutEnabledGuiM2000
                         MyDoEvents
                           While KeyPressed(&H1B)
                                            MyDoEvents
                                    Wend
                        Else
                         NOEXECUTION = True
                           ShutEnabledGuiM2000 True
                         MyDoEvents
                                    If AVIRUN Then AVI.GETLOST
                                    NOEXECUTION = True
                                    While KeyPressed(&H1B)
                                            MyDoEvents
                                    Wend
                                    myexit = True
                                    Exit Function
                        End If
                        ElseIf NOEXECUTION Then
                          ShutEnabledGuiM2000 True
                         MyDoEvents
                        End If
             End If
End If
'If counter = 0 Then Sleep 0: counter = 5001
'counter = counter - 1
If bstack Is Nothing Then
myexit = True: Exit Function
End If
If TaskMaster.OnlyMusic Then
TaskMaster.TimerTick
End If
If bstack.IamThread Then

myexit = bstack.Process.Done
Else
myexit = False
End If
End Function

Sub closeAll()
Dim i As Long
For i = 0 To 511
If FLEN(i) > 0 Then
FLEN(i) = 0
Close i
End If
FKIND(i) = 0 'FnoUse
Next i
CloseAllConnections
End Sub
Function MakeitObjectGeneric(Number As Long) As Object
Dim aa As New mHandler, k As Long
aa.t1 = 3
On Error GoTo there
If Not MyIsObject(var(Number)) Then
Set var(Number) = aa
aa.t1 = 0
Else
If var(Number) Is Nothing Then
Number = -1

Else
Do While TypeOf var(Number) Is mHandler
If var(Number).indirect < 0 Then Exit Do
If k > 20 Then MyEr "too many references", "πολλές αναφορές": Exit Do
Number = var(Number).indirect
k = k + 1
Loop
End If
there:
aa.indirect = Number
End If
Set aa.objref = Nothing
Set MakeitObjectGeneric = aa

End Function

Sub PlaceIteratorData(bstack As basetask, anything As Variant, st, en)
If MyIsObject(anything) Then
Set bstack.lastobj.objref = anything.objref
End If
With bstack.lastobj.objref
    If st < 0 Then st = .count + st Else st = st - 1
    If en < 0 Then en = .count + en Else en = en - 1
    If st < 0 Then st = 0
    If en < 0 Then en = 0
    If st >= .count Then st = .count - 1
    If en >= .count Then en = .count - 1
    
End With
With bstack.lastobj
    .t1 = 3
     .indirect = -1
    .index_start = st
    .index_End = en
    .index_cursor = st
    .UseIterator = True
End With
If MyIsObject(anything) Then
If TypeOf bstack.lastobj.objref Is FastCollection Then
bstack.lastobj.t1 = 1
Set bstack.lastobj.objref = anything
ElseIf TypeOf bstack.lastobj.objref Is Enumeration Then
Set bstack.lastobj.objref = New mHandler
Set bstack.lastobj.objref.objref = anything.objref
bstack.lastobj.objref.t1 = 4
bstack.lastobj.objref.index_cursor = st
End If
End If

End Sub
Sub MakeitObjectInventory(var As Variant, Optional Queue As Boolean)
Dim aa As New mHandler
aa.t1 = 1 ' 1 for Inventory
Set aa.objref = New FastCollection
If Queue Then aa.objref.AllowAnyKey
Set var = aa
End Sub
Sub MakeitObjectBuffer(var As Variant)
Dim aa As New mHandler
aa.t1 = 2 ' 2 for Buffer
Set aa.objref = New MemBlock
Set var = aa
End Sub
Sub MakeitObjectLong(var As Variant)
Dim aa As Long
var = aa
End Sub
Sub MakeitObjectEvent(var As Variant)
Dim aa As New mEvent
Set var = aa
End Sub
Sub MakeitObject(var As Variant)
Dim aa As New Document
Set var = aa
var.textDoc = vbNullString
End Sub
Sub MakeitPropReference(var As Variant)
Dim aa As New PropReference
Set var = aa
End Sub
Sub CreateFormObject(var As Variant, Id As Long)
Dim aa As Object
Select Case Id
Case 1
Set aa = New GuiM2000
Load aa
Case 2  '
Set aa = New GuiButton
Case 3
Set aa = New GuiTextBox
Case 4
Set aa = New GuiCheckBox
Case 5
Set aa = New GuiEditBox
Case 6
Set aa = New GuiListBox
Case 7
Set aa = New GuiDropDown
End Select
Set var = aa
End Sub
Sub CreateFormOtherObject(var As Variant, ThisObject As Object)
Set var = ThisObject
End Sub
Private Function GetShink(ev As ComShinkEvent, v As Long, objname$) As Boolean
Dim aa As Object
    Set ev = New ComShinkEvent

    Set aa = var(v)
    
                         ev.VarIndex = v
                         If here$ <> "" Then
                         ev.modulename = here$ + "." + objname$
                         ev.modulenameonly = here$
                         Else
                         ev.modulename = objname$
                         ev.modulenameonly = vbNullString
                         End If
                         ev.Attach aa
   Set aa = Nothing
   GetShink = ev.Attached()
End Function
Sub CreateitObject(var As Variant, THISOjBECT As String, Optional ByVal cc As Variant)
Dim aa As Object, b As GUID
If IsMissing(cc) Then
If Left$(THISOjBECT, 1) = "{" Then
    THISOjBECT = strProgIDfromSrting(THISOjBECT)
End If
On Error Resume Next
Set aa = CreateObject(THISOjBECT)
If Err Then
MyEr Err.Description, Err.Description
End If

Else
Set aa = CreateObject(THISOjBECT, CStr(cc))
End If
Set var = aa
End Sub
Sub CheckVar(var As Variant, s As String, Optional Append As Boolean)
If Typename(var) = doc Then
If var.IsEmpty Then
var.textDoc = s
Else
var.InsertDoc var.LastParagraph, var.TextParagraphLen(var.LastParagraph) + 1, s
End If
'ElseIf Typename(var) = "Document" Then
'CantAssignValue
ElseIf Append Then
var = var + s
Else
var = s
End If
End Sub
Function CheckVarOnlyNo(var As Variant, s As String) As Boolean
If Typename(var) = doc Then
If var.IsEmpty Then
var.textDoc = s
Else
var.InsertDoc var.LastParagraph, var.TextParagraphLen(var.LastParagraph) + 1, s
End If
ElseIf MyIsObject(var) Then
CheckVarOnlyNo = True
Else
var = s
End If
End Function
Sub CheckVarLong(var As Variant, l As Long)

If MyIsObject(var) Then

Set var = Nothing
var = Empty
End If
var = l

End Sub
Sub LATIN(bstack As basetask)
On Error Resume Next
cLid = 1033
UserCodePage = 1252

With Form1
bstack.myCharSet = 0
If bstack.tolayer > 0 Then
    .dSprite(bstack.tolayer).Font.charset = 0
    ElseIf bstack.toback Then
    .Font.charset = 0
    Else
    
    .DIS.Font.charset = bstack.myCharSet
    .TEXT1.Font.charset = bstack.myCharSet
    .List1.Font.charset = bstack.myCharSet
   ' .List2.Font.CharSet = bstack.myCharSet
    End If
End With
pagio$ = "LATIN"
cLid = 1033
DefBooleanString = ";T\r\u\e;F\a\l\s\e"
DialogSetupLang 1
With players(GetCode(bstack.Owner))
.charset = 0
End With
End Sub
Sub GREEK(bstack As basetask)
On Error Resume Next
cLid = 1032
UserCodePage = 1253
With Form1
   bstack.myCharSet = 161
If bstack.tolayer > 0 Then
    .dSprite(bstack.tolayer).Font.charset = 161
    ElseIf bstack.toback Then
    .Font.charset = 161
    Else
    .DIS.Font.charset = bstack.myCharSet
    .TEXT1.Font.charset = bstack.myCharSet
    .List1.Font.charset = bstack.myCharSet
   ' .List2.Font.CharSet = bstack.myCharSet
    End If
End With
pagio$ = "GREEK"
cLid = 1032
DefBooleanString = ";Αληθές;Ψευδές"
DialogSetupLang 0
With players(GetCode(bstack.Owner))
.charset = 161
End With
End Sub
Private Function GetLCIDFromKeyboard() As Long
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      r = GetKeyboardLayout(DWL_ANYTHREAD) And &HFFFF
      r = val("&H" & Right(Hex(r), 4))
        ret = GetLocaleInfoW(r, LOCALE_ILANGUAGE, StrPtr(Buffer), Len(Buffer))
    GetLCIDFromKeyboard = CLng(val("&h" + Left$(Buffer, ret - 1)))
End Function
Public Function GetLCIDFromKeyboardLanguage() As String
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      r = GetKeyboardLayout(DWL_ANYTHREAD) And &HFFFF
      r = val("&H" & Right(Hex(r), 4))
      'LOCALE_SENGLANGUAGE&
      If cLid = 0 Then ''
      ret = GetLocaleInfoW(r, LOCALE_SENGLANGUAGE&, StrPtr(Buffer), Len(Buffer))
      Else
        ret = GetLocaleInfoW(r, LOCALE_SLANGUAGE&, StrPtr(Buffer), Len(Buffer))
        End If
     If shortlang Then If ret > 3 Then ret = 4
     On Error Resume Next
    GetLCIDFromKeyboardLanguage = Left$(Buffer, ret - 1)

End Function
Public Function GetlocaleString(ByVal this As Long) As String
On Error GoTo 1234
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      
        ret = GetLocaleInfoW(cLid, this, StrPtr(Buffer), Len(Buffer))
    GetlocaleString = Left$(Buffer, ret - 1)
    
1234:
    
End Function
Private Function GetlocaleString2(ByVal this As Long, ByVal McLid As Long) As String
On Error GoTo 1234
    Dim Buffer As String, ret&, r&
    Buffer = String$(514, 0)
      
        ret = GetLocaleInfoW(McLid, this, StrPtr(Buffer), Len(Buffer))
    GetlocaleString2 = Left$(Buffer, ret - 1)
    
1234:
    
End Function

Public Function QueryDecString() As String
QueryDecString = GetDeflocaleString(14)
End Function


Sub helpBin(F&, n$)
Dim a() As Byte
a() = n$
Put #F, , a
End Sub
Sub MakeitObject2(var As Variant)
Dim aa As Object
Set aa = New Group
Set var = aa
End Sub
Sub prepareGroup(bstack As basetask, ByVal ohere$, vvv As Long, Optional glob As Boolean = False, Optional isAstr As Boolean = False)
Dim hv As Boolean
'' ohere$ = myUcase(ohere$)
If Not glob Then
If here$ = vbNullString Then
    hv = GetVar(bstack, bstack.GroupName & ohere$, vvv, True)
Else
    hv = GetlocalVar(bstack.GroupName & ohere$, vvv)
 End If
 End If
If hv Then
' so it is an object now
    If Not MyIsObject(var(vvv)) Then
        MakeitObject2 var(vvv)
    ElseIf Typename(var(vvv)) <> "Group" Then
        MakeitObject2 var(vvv)
        GoTo conthere
    ElseIf var(vvv).IamApointer Then
     PushStage bstack, False
     Dim myobject As Object
     Set myobject = var(vvv)
     UnFloatGroup bstack, ohere$, vvv, myobject, var(vvv).IamGlobal
     Set myobject = Nothing
     
    End If
Else
    vvv = GlobalVarRefOnly(bstack.GroupName & ohere$, glob)
    MakeitObject2 var(vvv)
conthere:
    If isAstr Then
    GlobalVarRefLink bstack.GroupName & ohere$ + "$", vvv, glob
    End If
 'If Not glob Then
 var(vvv).GroupName = ohere$ + "."
 var(vvv).HasStrValue = isAstr
End If
var(vvv).edittag = vbNullString
End Sub

Function ExecuteGroupStruct(bstack As basetask, ohere$, vvv As Long, rest$, Lang As Long, Optional glob As Boolean = False) As Long
Dim w$, w1$, p As Variant, v As Long, s$, ss$, b$, i As Long, lcl As Boolean, j As Long, nm$, x1 As Long, y1 As Long, frm$, skip As Boolean
Dim uni As Boolean, prv As Boolean, stripstack1 As New basetask, hlp As String, vl As String, NoRec As Boolean, final As Boolean
Dim highpriority As Boolean, ThisGroup As Group, RightAssociative As Boolean, removebypass As Boolean
Const TT$ = "=-+*/<!,{" + vbCr
If Trim(rest$) = vbNullString Then
    var(vvv) = CLng(0)
    ExecuteGroupStruct = 1
    Exit Function
End If
Set ThisGroup = var(vvv)
Dim myobject As Object

Dim OvarnameLen As Long, OarrnameLen As Long
Dim F$
Dim pppp As mArray
bstack.CopyStrip stripstack1
OvarnameLen = varhash.count + 1 ' new way
  
 If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & ThisGroup.GroupName '' & "."
  Else
  bstack.GroupName = ThisGroup.GroupName ''& "."
  End If


   ExecuteGroupStruct = 1
Do
there100:
nm$ = vbNullString: frm$ = vbNullString: hlp$ = vbNullString
ClearSpace rest$

there12345:
If NocharsInLine(rest$) Then Exit Do

v = IsLabelA(here$, rest$, w$)
'Debug.Print w$

If v = 0 Then Exit Do



Select Case w$
Case "ΤΕΛΙΚΟ", "ΤΕΛΙΚΗ", "FINAL"
i = v
ss$ = w$
v = IsLabelA(here$, rest$, w$)
If v <> 0 Then final = True: GoTo VarOnly
v = i
w$ = ss$
i = 0
GoTo VarOnly

Case "PROPERTY", "ΙΔΙΟΤΗΤΑ"
i = IsLabelA("", rest$, w$)
If i = 1 Or i = 3 Then
If i = 1 Then
    hlp = "[" + w$ + "]"
    If Lang = 1 Then
        vl = "value"
    Else
        vl = "αξία"
    End If
Else
    hlp = "[" + Left$(w$, Len(w$) - 1) + "]$"
    If Lang = 1 Then
        vl = "value$"
    Else
        vl = "αξία$"
    End If
    
End If
F$ = vbNullString
If FastSymbol(rest$, "{") Then
    ClearSpace rest$
    nm$ = block(rest$)
    
    If IsLabelA1("", nm$, ss$) Then
    ss$ = myUcase(ss$)
    i = Len(nm$)
            If FastSymbol(nm$, "(") Then
                If varhash.Find(here$ + "." + Left$(ThisGroup.GroupName, Len(ThisGroup.GroupName) - 1) + "(", i) Then
                    MyEr "Array with same name", "Πίνακας με ίδιο όνομα"
                    ExecuteGroupStruct = False
                    Exit Function
                End If
                frm$ = BlockParam(nm$)
              '  If frm$ = VbNullString Then GoTo errBlock
                
                If FastOperator(nm$, "{", Len(frm$) + 2) Then
                    nm$ = "{" + Mid$(nm$, Len(frm$) + 2)
                Else
                    GoTo errDef
                End If
                'frm$ = "(" + frm$ + ")"
                If frm$ = vbNullString Then frm$ = " "
            End If
        Select Case ss$
            Case "VALUE", "ΑΞΙΑ"
                If FastSymbol(nm$, "{") Then
                If MaybeIsSymbol(nm$, "}") Then
                    F$ = F$ + ss$ + " (" + frm$ + "){link parent " + hlp + " to " + w$ + ": =" + w$ + "}" + vbCrLf
                Else
                    F$ = F$ + ss$ + " (" + frm$ + ") {link parent " + hlp + " to " + w$ + ": " + vl + "=" + w$ + vbCrLf + block$(nm$) + vbCrLf + "=" + vl + "}" + vbCrLf
                    End If
                    FastSymbol nm$, "}"
                    
                Else
                      F$ = F$ + "value {link parent " + hlp + " to " + w$ + ":=" + w$ + "}" + vbCrLf
                End If
                
            Case "SET", "ΘΕΣΕ"
                If FastSymbol(nm$, "{") Then
                If frm$ <> "" Then
                If frm$ = " " Then
                        F$ = F$ + ss$ + " () {link parent " + hlp + " to " + w$ + ": read " + vl + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                    Else
                        F$ = F$ + ss$ + " () {link parent " + hlp + " to " + w$ + ": read " + vl + "," + frm$ + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                    End If
                Else
                    F$ = F$ + ss$ + " {link parent " + hlp + " to " + w$ + ": read " + vl + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                End If
                    FastSymbol nm$, "}"
                Else
                    F$ = F$ + "set {link parent " + hlp + " to " + w$ + ": read " + w$ + "}" + vbCrLf
                End If
            Case Else
                rest$ = nm$ + Right$(rest$, i)
                MyEr "unkown command, use set or value", "άγνωστη εντολή, χρησιμοποίησε θέσε ή αξία"
                Exit Function
        End Select
        frm$ = vbNullString
    ElseIf IsSymbol(nm$, ",") Then
    F$ = F$ + "value {link parent " + hlp + " to " + w$ + ":=" + w$ + "}" + vbCrLf
    End If
    ClearSpace nm$
    i = FastSymbol(nm$, ",")
    ClearSpace nm$
    If IsLabelA1("", nm$, ss$) Then
        ss$ = myUcase(ss$)
        i = Len(nm$)
             If FastSymbol(nm$, "(") Then
                If varhash.Find(here$ + "." + Left$(ThisGroup.GroupName, Len(ThisGroup.GroupName) - 1) + "(", i) Then
                    MyEr "Array with same name", "Πίνακας με ίδιο όνομα"
                    ExecuteGroupStruct = False
                    Exit Function
                End If
                frm$ = BlockParam(nm$)
                'If frm$ = VbNullString Then GoTo errBlock
                
                If FastOperator(nm$, "{", Len(frm$) + 2) Then
                    nm$ = "{" + Mid$(nm$, Len(frm$) + 2)
                Else
                    GoTo errDef
                End If
                'frm$ = "(" + frm$ + ")"
                If frm$ = vbNullString Then frm$ = " "
            End If
        Select Case ss$
            Case "VALUE", "ΑΞΙΑ"
              If FastSymbol(nm$, "{") Then
                If MaybeIsSymbol(nm$, "}") Then
                    F$ = F$ + ss$ + " (" + frm$ + "){link parent " + hlp + " to " + w$ + ": =" + w$ + "}" + vbCrLf
                Else
                    F$ = F$ + ss$ + " (" + frm$ + "){link parent " + hlp + " to " + w$ + ": " + vl + "=" + w$ + vbCrLf + block$(nm$) + vbCrLf + "=" + vl + "}" + vbCrLf
                    End If
                    FastSymbol nm$, "}"
                    
                Else
                      F$ = F$ + "value {link parent " + hlp + " to " + w$ + ":=" + w$ + "}" + vbCrLf
                End If
             Case "SET", "ΘΕΣΕ"
                If FastSymbol(nm$, "{") Then
                If frm$ <> "" Then
                    If frm$ = " " Then
                    F$ = F$ + ss$ + " () {link parent " + hlp + " to " + w$ + ": read " + vl + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                    Else
                    F$ = F$ + ss$ + " () {link parent " + hlp + " to " + w$ + ": read " + vl + "," + frm$ + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                    End If
                Else
                    F$ = F$ + ss$ + " {link parent " + hlp + " to " + w$ + ": read " + vl + vbCrLf + block$(nm$) + vbCrLf + w$ + "=" + vl + "}" + vbCrLf
                End If
                    FastSymbol nm$, "}"
                Else
                    F$ = F$ + "set {link parent " + hlp + " to " + w$ + ": read " + w$ + "}" + vbCrLf
                End If
             Case Else
                rest$ = nm$ + rest$
                MyEr "unkown command, use set or value", "άγνωστη εντολή, χρησιμοποίησε θέσε ή αξία"
                Exit Function
        End Select
        ClearSpace nm$
        If IsLabelA1("", nm$, ss$) Then
            rest$ = nm$ + Mid$(rest$, i)
            MyEr "unkown command, use set or value", "άγνωστη εντολή, χρησιμοποίησε θέσε ή αξία"
            Exit Function
        End If
    ElseIf i Then
    F$ = F$ + "set {link parent " + hlp + " to " + w$ + ": read " + w$ + "}" + vbCrLf
    End If
    FastSymbol rest$, "}"
       If FastSymbol(rest$, "=") Then
        x1 = 1
        aheadstatus rest$, , x1
        frm$ = Mid$(rest$, 1, x1 - 1)
        rest$ = Mid$(rest$, x1)
        If frm$ = vbNullString Then MyEr "Nothing to assign", "Τίποτα για να Θέσω": Exit Function
        If prv Then
        F$ = vbCrLf + hlp + "=" + frm$ + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        Else
        F$ = vbCrLf + "private:" + vbCrLf + hlp + "=" + frm$ + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        End If
        Else
        If prv Then
        F$ = vbCrLf + hlp + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        Else
        F$ = vbCrLf + "private:" + vbCrLf + hlp + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        End If
End If
    If prv Then
    rest$ = F$ + "}" + "private:" + vbCrLf + rest$
    Else
    rest$ = F$ + "}" + vbCrLf + rest$
    End If
     
Else
         If FastSymbol(rest$, "=") Then
        x1 = 1
        aheadstatus rest$, , x1
        frm$ = Mid$(rest$, 1, x1 - 1)
        rest$ = Mid$(rest$, x1)
        If frm$ = vbNullString Then MyEr "Nothing to assign", "Τίποτα για να Θέσω": Exit Function
        If prv Then
        F$ = vbCrLf + hlp + "=" + frm$ + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        Else
        F$ = vbCrLf + "private:" + vbCrLf + hlp + "=" + frm$ + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        End If
        Else
        If prv Then
        F$ = vbCrLf + hlp + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        Else
        F$ = vbCrLf + "private:" + vbCrLf + hlp + vbCrLf + "public:" + vbCrLf + "group " + w$ + "{" + vbCrLf + F$
        End If
End If
 F$ = F$ + "value {link parent " + hlp + " to " + w$ + ":=" + w$ + "}" + vbCrLf
 F$ = F$ + "set {link parent " + hlp + " to " + w$ + ": read " + w$ + "}" + vbCrLf
     If prv Then
            rest$ = F$ + vbCrLf + "}" + vbCrLf + "private:" + vbCrLf + rest$
            Else
            rest$ = F$ + vbCrLf + "}" + vbCrLf + rest$
            End If

End If
hlp = vbNullString


GoTo there100
Else
MyEr "No name for property", "Χωρίς όνομα ιδιότητας"
ExecuteGroupStruct = 0
Exit Function
End If
Case "SET", "ΘΕΣΕ"
final = IsLabelSymbolNew(rest$, "ΤΕΛΙΚΟ", "FINAL", Lang)
If FastSymbol(rest$, "(") Then
If varhash.Find(here$ + "." + Left$(ThisGroup.GroupName, Len(ThisGroup.GroupName) - 1) + "(", i) Then
MyEr "Array with same name", "Πίνακας με ίδιο όνομα"
ExecuteGroupStruct = False
Exit Function
End If
ss$ = BlockParam(rest$)
'If ss$ = VbNullString Then GoTo errBlock
ThisGroup.HasParametersSet = True
If FastOperator(rest$, "{", Len(ss$) + 2) Then
    If ss$ <> "" Then
        rest$ = "{Read " + ss$ + ":If Stack.Size>1 then Shift Stack.Size" + vbCrLf + Mid$(rest$, Len(ss$) + 2)
    Else
        rest$ = "{If Stack.Size>1 then Shift Stack.Size " + vbCrLf + Mid$(rest$, 2)
    End If
Else
GoTo errDef
End If
End If
F$ = ChrW(&H1FFF) + ":="
x1 = 1
ThisGroup.HasSet = True
w$ = "&"
GoTo funcoperator
Case "VALUE", "ΑΞΙΑ"
final = IsLabelSymbolNew(rest$, "ΤΕΛΙΚΗ", "FINAL", Lang)
If final Then
If FastSymbol(rest$, "(") Then GoTo contthere1
GoTo contthere22
End If
If MaybeIsSymbol(rest$, "=") Then

GoTo conthereplease
ElseIf FastSymbol(rest$, "(") Then
contthere1:
If varhash.Find(here$ + "." + Left$(ThisGroup.GroupName, Len(ThisGroup.GroupName) - 1) + "(", i) Then
MyEr "Array with same name", "Πίνακας με ίδιο όνομα"
ExecuteGroupStruct = False
Exit Function
End If
ss$ = BlockParam(rest$)

ThisGroup.HasParameters = True
If FastOperator(rest$, "{", Len(ss$) + 2) Then
If ss$ <> "" Then
    rest$ = "{Read " + ss$ + vbCrLf + Mid$(rest$, Len(ss$) + 2)
Else
    Mid$(rest$, 1, 1) = "{"
End If

Else
errDef:
MyEr "Missing Definition in { }", "Λείπει ορισμός σε { }"
ExecuteGroupStruct = 0
Exit Function
End If

End If
contthere22:
If ThisGroup.HasStrValue Then
F$ = ChrW(&H1FFF) + "$"
Else
F$ = ChrW(&H1FFF) + ";"
End If
x1 = 1
ThisGroup.HasValue = True
w$ = "&"
GoTo funcoperator
Case "REMOVE", "ΔΙΑΓΡΑΦΗ"
    x1 = 1
    w$ = ""
    F$ = ChrW(&H1FFF) + "_%"
    final = True
    removebypass = True
    highpriority = False
    GoTo funcoperator
Case "OPERATOR", "ΤΕΛΕΣΤΗΣ"
If prv Then
    MyEr "Private operator not allowed", "Ιδιωτικός τελεστής δεν επιτρέπεται"
    ExecuteGroupStruct = False
    Exit Function
End If

final = IsLabelSymbolNew(rest$, "ΤΕΛΙΚΟΣ", "FINAL", Lang)
x1 = 1
If Not ISSTRINGA(rest$, F$) Then
If IsLabelSymbolNew(rest$, "ΥΨΗΛΟΣ", "HIGH", Lang) Then
highpriority = True
If Not ISSTRINGA(rest$, F$) Then GoTo error0001
If Len(F$) > 2 Or Len(F$) = 0 Or Not MaybeIsSymbol(F$, "/*-+=~^&|<>") Then GoTo error0001
ElseIf IsLabelSymbolNew(rest$, "ΔΕΞΙΟΣ", "RIGHT", Lang) Then
RightAssociative = True
If Not ISSTRINGA(rest$, F$) Then GoTo error0001
If Len(F$) > 2 Or Len(F$) = 0 Or Not MaybeIsSymbol(F$, "/*-+=~^&|<>") Then GoTo error0001
ElseIf IsLabelSymbolNew(rest$, "ΜΟΝΑΔΙΑΙΟΣ", "UNARY", Lang) Then
    F$ = "-:"
    ThisGroup.HasUnary = True
ElseIf Not ISSTRINGA(rest$, F$) Then
error0001:
    MyEr "No Proper Symbol for operator, use string literal", "Δεν βρέθηκε σύμβολο χειριστή, χρησιμοποίησε αλφαριθμητικό με διπλά εισαγωγικά"
    ExecuteGroupStruct = False
    Exit Function
    End If
End If
w$ = "&"
If highpriority Then
    If InStr(ThisGroup.highpriorityoper, "[" + F$ + "]") = 0 Then ThisGroup.highpriorityoper = MergeOperators(ThisGroup.highpriorityoper, "[" + F$ + "]")
ElseIf RightAssociative Then
If InStr(ThisGroup.highpriorityoper, "[R" + F$ + "]") = 0 Then ThisGroup.highpriorityoper = MergeOperators(ThisGroup.highpriorityoper, "[R" + F$ + "]")
End If
F$ = ChrW(&H1FFF) + F$
highpriority = False
GoTo funcoperator
Case "UNIQUE", "ΜΟΝΑΔΙΚΟ"
If Not IsOperator(rest$, ":") Then
GoTo VarOnly
End If
prv = False
uni = True
GoTo there100
Case "PRIVATE", "ΙΔΙΩΤΙΚΟ"
If Not IsOperator(rest$, ":") Then
GoTo VarOnly
End If
uni = False
prv = True
GoTo there100
Case "DEF", "ΚΑΝΕ"
MyEr "DEF can't used in a CLASS", "Η Κάνε δεν μπορεί να χρησιμοποιηθεί σε Κλάση"
ExecuteGroupStruct = False
Exit Function

Case "PUBLIC", "ΔΗΜΟΣΙΟ"
If Not IsOperator(rest$, ":") Then
GoTo VarOnly
End If
NoRec = False
uni = False
prv = False
GoTo there100
Case "LOCAL", "ΤΟΠΙΚΑ", "ΤΟΠΙΚΗ", "ΤΟΠΙΚΕΣ"
lcl = True
GoTo there12345
Case "CLASS", "ΚΛΑΣΗ"
If IsOperator(rest$, ":") Then
NoRec = True
GoTo there100
ElseIf IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", Lang) Then
MyEr "GLOBAL can't used in a CLASS", "Η κλάση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteGroupStruct = False
Exit Function
End If
x1 = IsLabelA("", rest$, w$)
 If x1 = 1 Or x1 = 3 Then
                     If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", Lang) Then
                     MyEr "Use here a Group not a Class", "Χρησιμοποίησε μια Ομάδα και όχι μια Κλάση"
                    ExecuteGroupStruct = False
                    Exit Function
                    End If
                If here$ = vbNullString Then
                F$ = bstack.GroupName + w$
                Else
                F$ = w$
                End If
        If Lang = 1 Then
               If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
            
            If x1 = 1 Then
                s$ = "}" + vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=group(" + w$ + ")"
            rest$ = F$ + " {" + "'11001EDIT " + GetModuleName(bstack, here$) + ",-" + Str$(Len(rest$)) + "'" + ",'" + CStr(Len(s$) + 30) + vbCrLf + " group " + w$ + " {" + ss$ & s$ + rest$
            Else
            nm$ = w$
            w$ = Left$(w$, Len(w$) - 1)
            s$ = "}" + vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=group$(" + nm$ + ")"
            rest$ = F$ + " {" + "'11001EDIT " + GetModuleName(bstack, here$) + Str$(Len(rest$)) + ",-" + Str$(Len(rest$)) + "'" + CStr(Len(s$) + 30) + vbCrLf + " group " + nm$ + " {" + ss$ + s$ + rest$
            End If
            nm$ = vbNullString
            w$ = vbNullString
            GoTo classcontclass
            Else
             F$ = w$
            w$ = "Group "
            End If
         Else
            If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
           ' If Right$("  " + ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
            If x1 = 1 Then
            s$ = "}" + vbCrLf + "Αν Τμήμα(" + w$ + "." + w$ + ") Τότε Κάλεσε! " + w$ + "." + w$ + vbCrLf + "=Ομάδα(" + w$ + ")"
            rest$ = F$ + " {" + "'11001EDIT " + GetModuleName(bstack, here$) + ",-" + Str$(Len(rest$)) + "'" + CStr(Len(s$) + 29) + vbCrLf + " Ομάδα " + w$ + " {" + ss$ + s$ + rest$
            Else
            nm$ = w$
            w$ = Left$(w$, Len(w$) - 1)
            s$ = "}" + vbCrLf + "Αν Τμήμα(" + w$ + "." + w$ + ") Τότε Κάλεσε! " + w$ + "." + w$ + vbCrLf + "=Ομάδα$(" + nm$ + ")"
            rest$ = F$ + " {" + "'11001EDIT " + GetModuleName(bstack, here$) + ",-" + Str$(Len(rest$)) + "'" + CStr(Len(s$) + 29) + vbCrLf + " Ομάδα " + nm$ + " {" + ss$ + s$ + rest$
            End If
                    
            w$ = vbNullString
            GoTo classcontclass
            Else
             F$ = w$
            w$ = "ΟΜΑΔΑ "
            End If
            
        End If
        
        Do While FastSymbol(rest$, ",")
         If IsLabelA("", rest$, nm$) <> 1 Then
            SyntaxError
            ExecuteGroupStruct = False
            Exit Function
         End If
             F$ = F$ + w$ + nm$ + vbCrLf
        Loop
            If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", Lang) Then
                 MyEr "Use here a Group not a Class", "Χρησιμοποίησε μια Ομάδα και όχι μια Κλάση"
                ExecuteGroupStruct = False
            Exit Function
            End If
            w$ = Trim$(w$)
            rest$ = F$ + rest$
        GoTo contVar
            Else
            SyntaxError
            ExecuteGroupStruct = False
            Exit Function
            
   End If
Case "REM", "ΣΗΜ"
SetNextLine rest$: GoTo there100
Case "FUNCTION", "ΣΥΝΑΡΤΗΣΗ"
If IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", Lang) Then
MyEr "GLOBAL can't used in a Group", "Η συνάρτηση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteGroupStruct = False
Exit Function
End If
final = IsLabelSymbolNew(rest$, "ΤΕΛΙΚΗ", "FINAL", Lang)
classcontclass:
x1 = Abs(IsLabelF(rest$, F$))
    If prv Then F$ = ChrW(&HFFBF) + F$
''f$ = myUcase$(f$)
funcoperator:
If x1 <> 0 Then
  If ThisGroup.FuncList <> "" Then  ' maybe we have it
  If InStr(ThisGroup.FuncList, Chr$(2) + F$ + "() ") > 0 Then
      If FastSymbol(rest$, "(") Then
        frm$ = BlockParam(rest$)
        If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$))
        If Not FastSymbol(rest$, ")") Then
        End If
        frm$ = Trim$(frm$)
    Else
        frm$ = vbNullString
    End If
  IsSymbol3 rest$, "{"
    ss$ = block(rest$)
    If FastSymbol(rest$, "}") Then
             If GetSub(bstack.GroupName + F$ + "()", i) Then
                         If rinstr(sbf(i).sbgroup, bstack.GroupName) + Len(bstack.GroupName) - 1 = Len(sbf(i).sbgroup) Then
                         bstack.IndexSub = i
                         
                         If Not sbf(i).locked Then
                          If frm$ <> "" Then
                            If Lang = 1 Then
                                sbf(i).sb = "READ " + frm$ + vbCrLf + ss$
                            Else
                                sbf(i).sb = "ΔΙΑΒΑΣΕ " + frm$ + vbCrLf + ss$
                            End If
                          Else
                            sbf(i).sb = ss$
                          End If
                          Set sbf(i).subs = Nothing
                          End If
                          sbf(i).locked = final
                         
                             GoTo continuehere22
                          Else
                          End If
             End If
 
   If here$ <> "" Then
             If Lang = 1 Then
                rest$ = "GLOBAL " + Chr(34) + here$ + "." + bstack.GroupName + F$ + Chr(34) + " { " + ss$ + "} " + rest$
            Else
                  rest$ = "ΓΕΝΙΚΗ " + Chr(34) + here$ + "." + bstack.GroupName + F$ + Chr(34) + " { " + ss$ + "} " + rest$
            End If
       GoTo BYPASS3
   Else
   
        ExecuteGroupStruct = 0: Exit Function
   End If
   End If
  End If
  End If
  ' so is the first time, put it back
  If Left$(sbf(Abs(bstack.OriginalCode)).sb, 10) = "'11001EDIT" Then
   
   ss$ = rest$
   hlp$ = vbNullString
   If FastSymbol(ss$, "(") Then
                         hlp$ = BlockParam(ss$)
                            If hlp$ <> "" Then Mid$(ss$, 1, Len(ss$) + 2) = Space$(Len(ss$) + 1)
                            If Not FastSymbol(ss$, ")") Then
                       
                            End If
                            
                        hlp$ = Trim$(hlp$)
                        If hlp$ <> "" Then hlp$ = vbCrLf + "Read " + hlp$ + vbCrLf
   
   End If
     IsSymbol3 ss$, "{"
    frm$ = block(ss$)
  If Right$(ss$, 2) <> vbCrLf Then
        b$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb)) '+ "+2"
        ' code to find error position
        i = InStrRev(b$, "'")
        If i > 1 Then
        j = val(Mid$(b$, i + 1))
           b$ = Left$(b$, i - 1)
           Else
          j = 0
        End If
  Else
        b$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb))
                
        End If
        nm$ = GetStrUntil(",", Mid$(b$, 12))
      GetSub nm$, i
      FastSymbol "(", ss$
      If hlp$ <> "" Then
      frm$ = BlockParam(rest)
      
      End If
        If hlp$ <> "" Then
      FastSymbol rest$, "("
      frm$ = BlockParam(rest$)
      
      Mid$(rest$, 1, Len(frm$) + 2) = Space$(Len(frm$) + 2)
      Else
      hlp$ = vbCrLf
      End If
     i = Len(rest$)
      IsSymbol3 rest, "{"
      i = i - Len(rest$) + 1
      If Left$(rest$, 10) = "'11001EDIT" Then
      i = Len(rest$)
       s$ = GetNextLine(rest$)
       i = i - Len(rest$) + 1
       DropLeft "'", s$
       DropLeft "'", s$
       If s$ <> "" Then j = val(s$)
       
      End If
    b$ = "{" + b$ + "-" + CStr(Len(rest$) - Len(frm$) - j - i)
        
    rest$ = b$ + hlp$ + rest$


  End If
  If here$ = vbNullString Then
  If w$ = vbNullString Then
  If Lang = 1 Then
    rest$ = "NEW " + F$ & " " & rest$
    w$ = "FUNCTION"
    Else
     rest$ = "ΝΕΑ " + F$ & " " & rest$
     w$ = "ΣΥΝΑΡΤΗΣΗ"
    End If
  Else
  If Lang = 1 Then
    rest$ = "NEW " + bstack.GroupName + F$ & " " & rest$
    
    Else
     rest$ = "ΝΕΑ " + bstack.GroupName + F$ & " " & rest$
    End If
    End If
  Else
  rest$ = F$ & " " & rest$
    If w$ = vbNullString Then
      If Lang = 1 Then
    w$ = "FUNCTION"
    Else
     w$ = "ΣΥΝΑΡΤΗΣΗ"
    End If
    End If
  End If
  
BYPASS3:
ExecuteGroupStruct = Abs(IdentifierGroup(bstack, w$, rest$, Lang))

  If GetSub(bstack.GroupName + F$ + "()", i) Then
   If sbf(i).locked Then final = True
 If final Then sbf(i).locked = True
  If final Then
  If removebypass Or Not NoRec Then
   If Not lcl Then
   ThisGroup.FuncList = Chr$(1) + Chr$(2) + F$ + "() -" + CStr(i) + Chr$(1) + ThisGroup.FuncList
   Else
   ThisGroup.LocalList = ThisGroup.LocalList + vbCrLf + "Local Function " + F$ + "{" + sbf(i).sb + "}"
   End If
   End If
  Else
   If Not NoRec Then
   If Not lcl Then
   ThisGroup.FuncList = Chr$(1) + Chr$(2) + F$ + "() " + CStr(i) + Chr$(1) + ThisGroup.FuncList
   Else
   ThisGroup.LocalList = ThisGroup.LocalList + vbCrLf + "Local Function " + F$ + "{" + sbf(i).sb + "}"
   End If
   End If
   End If
   If here$ = vbNullString Then
   sbf(i).sbgroup = bstack.GroupName
   Else
    sbf(i).sbgroup = here$ + "." + bstack.GroupName
  End If
Else

  End If
   
  ''   Bstack.GroupName = oldgroupname$
     Else
     ExecuteGroupStruct = 0
     End If
     
     If ExecuteGroupStruct = 0 Then Exit Function
     

Case "MODULE", "ΤΜΗΜΑ"
If IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", Lang) Then
MyEr "GLOBAL can't used in a Group", "Η συνάρτηση στην ομάδα δεν μπορεί να είναι γενική"
ExecuteGroupStruct = False
Exit Function
End If
final = IsLabelSymbolNew(rest$, "ΤΕΛΙΚΟ", "FINAL", Lang)
x1 = Abs(IsLabelF(rest$, F$))
    If prv Then F$ = ChrW(&HFFBF) + F$
If x1 <> 0 Then
  If ThisGroup.FuncList <> "" Then  ' maybe we have it
  If InStr(ThisGroup.FuncList, Chr$(3) + F$ + " ") > 0 Then
    If FastSymbol(rest$, "(") Then
        frm$ = BlockParam(rest$)
        If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
        If Not FastSymbol(rest$, ")") Then
        End If
        frm$ = Trim$(frm$)
    Else
        frm$ = vbNullString
    End If
  
      IsSymbol3 rest$, "{"
    ss$ = block(rest$)
  '  If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
    If FastSymbol(rest$, "}") Then
             If GetSub(bstack.GroupName + F$, i) Then
            '' IF sbf(I).sbGROUP
                         If rinstr(sbf(i).sbgroup, bstack.GroupName) + Len(bstack.GroupName) - 1 = Len(sbf(i).sbgroup) Then
                          bstack.IndexSub = i
                          If sbf(bstack.IndexSub).locked Then
                          Else
                          If frm$ <> "" Then
                            If Lang = 1 Then
                                sbf(i).sb = "READ " + frm$ + vbCrLf + ss$
                            Else
                                sbf(i).sb = "ΔΙΑΒΑΣΕ " + frm$ + vbCrLf + ss$
                            End If
                          Else
                          sbf(i).sb = ss$
                          End If
                          End If
                          Set sbf(i).subs = Nothing
                          GoTo continuehere22 'there12345
                          End If
             End If

 
   If here$ <> "" Then
v = 123
             If Lang = 1 Then
                rest$ = "GLOBAL " + Chr(34) + here$ + "." + bstack.GroupName + F$ + Chr(34) + " {'11001EDIT " + CStr(bstack.OriginalCode) + ", 3" + vbCrLf + ss$ + "} " + rest$
                  Else
                  rest$ = "ΓΕΝΙΚΟ " + Chr(34) + here$ + "." + bstack.GroupName + F$ + Chr(34) + " {'11001EDIT " + CStr(bstack.OriginalCode) + ", 3" + vbCrLf + ss$ + "} " + rest$
                  End If
   GoTo BYPASS4
   Else
   
        ExecuteGroupStruct = 0: Exit Function
   End If
   End If
  End If
  Else
  ' we don't have it
  End If
  ' so is the first time, put it back
  If Left$(sbf(Abs(bstack.OriginalCode)).sb, 10) = "'11001EDIT" Then
   
   ss$ = rest$
   hlp$ = vbNullString
   If FastSymbol(ss$, "(") Then
                         hlp$ = BlockParam(ss$)
                            If hlp$ <> "" Then Mid$(ss$, 1, Len(ss$) + 2) = Space$(Len(ss$) + 1)
                            If Not FastSymbol(ss$, ")") Then
                       
                            End If
                            
                        hlp$ = Trim$(hlp$)
                        If hlp$ <> "" Then hlp$ = vbCrLf + "Read " + hlp$ + vbCrLf
   
   End If
     IsSymbol3 ss$, "{"
    frm$ = block(ss$)
    ' look here
  If Right$(frm$, 2) <> vbCrLf Then
        b$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb)) '+ "+2"
        i = InStrRev(b$, "'")
        If i > 1 Then
        j = val(Mid$(b$, i + 1))
           b$ = Left$(b$, i - 1)
           Else
          j = 0
        End If
  Else
        b$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb))

        End If
        nm$ = GetStrUntil(",", Mid$(b$, 12))
      GetSub nm$, i
abc123:
      FastSymbol "(", ss$
      If hlp$ <> "" Then
      frm$ = BlockParam(rest)
      
      End If
        If hlp$ <> "" Then
      FastSymbol rest$, "("
      frm$ = BlockParam(rest$)
      
      Mid$(rest$, 1, Len(frm$) + 2) = Space$(Len(frm$) + 2)
      Else
      hlp$ = vbCrLf
      End If
      i = Len(rest$)
      IsSymbol3 rest, "{"
      i = i - Len(rest$) + 1
      If Left$(rest$, 10) = "'11001EDIT" Then
      i = Len(rest$)
       s$ = GetNextLine(rest$)
       i = i - Len(rest$) + 1
       DropLeft "'", s$
       DropLeft "'", s$
       If s$ <> "" Then j = val(s$)
       
      End If
      b$ = "{" + b$ + "-" + CStr(Len(rest$) - Len(frm$) - j - i)
    
        
    rest$ = b$ + hlp$ + rest$
Else
 ss$ = rest$
   hlp$ = vbNullString
 If FastSymbol(ss$, "(") Then
                         hlp$ = BlockParam(ss$)
                            If hlp$ <> "" Then Mid$(ss$, 1, Len(ss$) + 2) = Space$(Len(ss$) + 1)
                            If Not FastSymbol(ss$, ")") Then
                       
                            End If
                            
                        hlp$ = Trim$(hlp$)
                        If hlp$ <> "" Then hlp$ = vbCrLf + "Read " + hlp$ + vbCrLf
   
   End If
         FastSymbol "(", ss$
      If hlp$ <> "" Then
      frm$ = BlockParam(rest)
      
      End If
        If hlp$ <> "" Then
      FastSymbol rest$, "("
      frm$ = BlockParam(rest$)
      
      Mid$(rest$, 1, Len(frm$) + 2) = Space$(Len(frm$) + 2)
      Else
      hlp$ = vbCrLf
      End If
      IsSymbol3 rest, "{"
       b$ = "{"
    
        
    rest$ = b$ + hlp$ + rest$

  End If
  If here$ = vbNullString Then
  
  rest$ = bstack.GroupName + F$ & " " & rest$
  Else
  
  rest$ = F$ & " " & rest$
  End If
  If glob Then
  If Lang = 1 Then
  rest$ = "NEW " + rest$
  Else
  rest$ = "ΝΕΟ " + rest$
  End If
  End If
BYPASS4:
 ExecuteGroupStruct = Abs(IdentifierGroup(bstack, w$, rest$, Lang))
  If GetSub(bstack.GroupName + F$, i) Then
  If sbf(i).locked Then final = True
  If final Then sbf(i).locked = True
  
If Not NoRec Then
If final Then
 If Not lcl Then
 ThisGroup.FuncList = Chr$(1) + Chr$(3) + F$ + " -" + CStr(i) + Chr$(1) + ThisGroup.FuncList
 Else
  ThisGroup.LocalList = ThisGroup.LocalList + vbCrLf + "Local Module " + F$ + "{" + sbf(i).sb + "}"
 End If
Else
 If Not lcl Then
 ThisGroup.FuncList = Chr$(1) + Chr$(3) + F$ + " " + CStr(i) + Chr$(1) + ThisGroup.FuncList
 Else
  ThisGroup.LocalList = ThisGroup.LocalList + vbCrLf + "Local Module " + F$ + "{" + sbf(i).sb + "}"
 End If
 End If
End If
        If here$ = vbNullString Then
   sbf(i).sbgroup = bstack.GroupName
   Else
    sbf(i).sbgroup = here$ + "." + bstack.GroupName
  End If
  End If

     Else
     ExecuteGroupStruct = 0
     End If
     If ExecuteGroupStruct = 0 Then Exit Function
Case "EVENT", "ΓΕΓΟΝΟΣ", "EVENTS", "ΓΕΓΟΝΟΤΑ"

If ISSTRINGA(rest$, s$) Then
s$ = CleanStr(s$, " ")
If s$ <> vbNullString Then
ThisGroup.RegisterEvent s$
    Do While FastSymbol(rest$, ",")
        If ISSTRINGA(rest$, s$) Then
            s$ = CleanStr(s$, " ")
            If s$ <> vbNullString Then ThisGroup.RegisterEvent s$
        Else
            MyEr "Expected a string literal for event name", "Περίμενα αλφαριθμητικό σε εισαγωγικά για όνομα γεγονότος"
                    ExecuteGroupStruct = False
                    Exit Function
        End If
    Loop
Else
    Set ThisGroup.Events = Nothing
End If
GoTo there100
Else
GoTo contVar
End If
Case "DIM", "ΠΙΝΑΚΑΣ", "ΠΙΝΑΚΕΣ"
' put back, change HERE$ and
contVar:
bstack.priveflag = prv
bstack.uniflag = uni
bstack.finalFlag = final
ExecuteGroupStruct = Abs(MyDim(bstack, rest$, Lang, glob))
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
     If ExecuteGroupStruct = 0 Then Exit Function
Case "GROUP", "ΟΜΑΔΑ"
If final Then
            NoObjectAssign
            ExecuteGroupStruct = 0
            Exit Function
            End If
     x1 = Abs(IsLabel(bstack, rest$, w$))
     hlp = vbNullString
     If x1 = 3 Then
     x1 = 1
     hlp = w$
     w$ = Left$(w$, Len(w$) - 1)
     End If
     If prv Then w$ = ChrW(&HFFBF) + w$
      If x1 = 1 Then
                         If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", Lang) Then
                                            If IsStrExp(bstack, rest$, ss$) Then
                                            frm$ = bstack.GroupName
                                            prepareGroup bstack, w$, y1, glob, hlp <> ""
                                          
                                            LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                                            
                                            bstack.priveflag = prv
                                             ExecuteGroupStruct = Abs(ExecuteGroupStruct(bstack, bstack.GroupName & w$, y1, ss$, Lang, glob))
                                            bstack.priveflag = False
                                                OvarnameLen = varhash.count + 1 'Len(VarName$) + 1   'we record ...
                                          
                                            
                                             bstack.GroupName = frm$
                                            End If
    
                            Else
                                    If FastSymbol(rest$, "{") Then
                      
                                          frm$ = bstack.GroupName
                                          prepareGroup bstack, w$, y1, glob, hlp <> ""
                                        LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                                        
                                        If Not Abs(ExecuteGroupStruct(bstack, bstack.GroupName & w$, y1, rest$, Lang, glob)) = 0 Then
                                            ExecuteGroupStruct = FastSymbol(rest$, "}")
                                        End If
                                            OvarnameLen = varhash.count + 1  'we record ...
                                  
                                         bstack.GroupName = frm$
                                         If Typename(var(y1)) <> "Group" Then Set var(y1) = New Group
                                    Else
                                      prepareGroup bstack, w$, y1, glob, hlp <> ""
                                        LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                            End If

                          
                        End If
             End If






     If ExecuteGroupStruct = 0 Then Exit Function
       ''LogGroup bstack, vvv, oHere$, OvarnameLen, OarrnameLen, lcl
Case "GLOBAL", "ΓΕΝΙΚΟ", "ΓΕΝΙΚΗ", "ΓΕΝΙΚΕΣ"
MyEr "No global variables in groups, create global group", "Όχι γενικές μεταβλητές σε ομάδα - φτιάξε γενική ομάδα"
ExecuteGroupStruct = 0
Exit Function
Case "LONG", "ΜΑΚΡΥΣ"
    ExecuteGroupStruct = Abs(MyLong(bstack, rest$, Lang))
    
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
       If ExecuteGroupStruct = 0 Then Exit Function
Case "ΚΑΤΑΣΤΑΣΗ", "INVENTORY"
    ExecuteGroupStruct = Abs(ProcInventory(bstack, rest$, Lang))
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
       If ExecuteGroupStruct = 0 Then Exit Function
Case "ΔΙΑΡΘΡΩΣΗ", "BUFFER"
    ExecuteGroupStruct = Abs(ProcBuffer(bstack, rest$, Lang))
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
       If ExecuteGroupStruct = 0 Then Exit Function
Case "DOCUMENT", "ΕΓΓΡΑΦΟ"
    ExecuteGroupStruct = Abs(MyDocument(bstack, rest$, Lang))
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
     If ExecuteGroupStruct = 0 Then Exit Function
Case "ΑΠΑΡΙΘΜΗΣΗ", "ΑΠΑΡ", "ENUMERATION", "ENUM"
  ExecuteGroupStruct = Abs(ProcEnumGroup(bstack, rest$, here$ = ""))
  bstack.priveflag = False
  bstack.uniflag = False
  bstack.finalFlag = False
       If ExecuteGroupStruct = 0 Then Exit Function
Case Else
' check if we have a class
conthereplease:
nm$ = vbNullString
If uni Then
    
Else
    If prv Then w$ = ChrW(&HFFBF) + w$
End If

If Len(rest$) > 0 Then
If Not MaybeIsSymbol(rest$, TT$) Then
    If GetSub(w$ + "()", j) Then
        F$ = "=" + w$ + "()"
        
            If IsLabelA(here$, rest$, w$) <> 1 Then Exit Do
            ''w$ = myUcase(w$)
            rest$ = F$ + rest$
            nm$ = w$
            Set stripstack1 = bstack
            ''
    ElseIf GetSub(bstack.GroupName + w$ + "()", j) Then   '' why not here??
        F$ = "=" + bstack.GroupName + w$ + "()"
        x1 = IsLabelA(here$, rest$, w$)
        If x1 <> 1 And x1 <> 3 Then Exit Do
        ''w$ = myUcase(w$)
        
        rest$ = F$ + rest$

        nm$ = Replace(w$, "$", "")
        Set stripstack1 = bstack
    End If
End If
End If
VarOnly:
w$ = ohere$ & "." & w$
Select Case v
Case 1
    p = 0#
    If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
    skip = True
               If IsLabelSymbolNew(rest$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                            If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(rest$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                        If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CSng(p)
            ElseIf IsLabelSymbolNew(rest$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CBool(p)
            ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CLng(p)
            ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CInt(p)
            ElseIf IsLabelSymbolNew(rest$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                If FastSymbol(rest$, "=") Then If Not IsNumberD2(rest$, p) Then missNumber: Exit Function
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
     
    End If
    
    If glob Then
     v = globalvar(w$, p)
    ElseIf here$ = vbNullString Then
    
        If Not GetVar(bstack, w$, v) Then v = globalvar(w$, p) ': GetVar bstack, W$, v
    Else
        If Not GetlocalVar(w$, v) Then v = globalvar(w$, p)  ': GetlocalVar W$, v
        If final Then
        If MyIsObject(var(v)) Then
        If Not TypeOf var(v) Is Constant Then MyEr "No Constant, it is an object", "Δεν έχω σταθερή, αλλά αντικείμενο": Exit Function
        Else
        Set var(v) = New Constant
        
        End If
        End If
    End If
    If skip Then
    ' do nothing
    ElseIf FastSymbol(rest$, "=") Then
         If IsExp(stripstack1, rest$, p) Then
       
            If Not stripstack1.lastobj Is Nothing Then
            If final Then
            NoObjectAssign
            ExecuteGroupStruct = 0
            Exit Function
            End If
                If TypeOf stripstack1.lastobj Is lambda Then
                    Set var(v) = stripstack1.lastobj
                    Set stripstack1.lastobj = Nothing
                    LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, False 'uni
                    If here$ = vbNullString Or glob Then
                        GlobalSub w$ + "()", "CALL EXTERN " & Str(v), bstack.GroupName
                    Else
                        GlobalSub here$ & "." & w$ + "()", "CALL EXTERN " & Str(v), here$ + "." + bstack.GroupName
                    End If
                    OvarnameLen = varhash.count + 1
                ElseIf TypeOf stripstack1.lastobj Is Group Then
                    Set myobject = stripstack1.lastobj
againgroup:
                    LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                        If MyIsObject(var(v)) Then
                            If TypeOf var(v) Is Group Then
                             If nm$ <> "" Then
                                UnFloatGroupReWriteVars stripstack1, nm$, v, myobject
                            ElseIf stripstack1.UseGroupname = vbNullString Then
                                        UnFloatGroupReWriteVars stripstack1, w$, v, myobject
                            Else
                                UnFloatGroupReWriteVars stripstack1, Mid$(w$, Len(ohere$ & ". ")), v, myobject
                            End If
                            Else
                                MissingGroup
                                ExecuteGroupStruct = 0
                                Exit Function
                            End If
                            OvarnameLen = varhash.count + 1  'we record ...
                        Else 'If nm$ <> "" Then
                    
                        If nm$ <> "" Then
                        UnFloatGroup stripstack1, nm$, v, myobject
                        ElseIf stripstack1.UseGroupname = vbNullString Then
                        UnFloatGroup stripstack1, w$, v, myobject
                        Else
                        UnFloatGroup stripstack1, Mid$(w$, Len(ohere$ & ". ")), v, myobject
                        End If
                        
                  
                        OvarnameLen = varhash.count + 1  'we record ...
                        If nm$ = vbNullString Then
                                Set stripstack1.lastobj = Nothing
                                Set stripstack1 = New basetask
                                bstack.CopyStrip stripstack1
                                GoTo continuehere
                        End If
                    End If
                   
                    If FastSymbol(rest$, ",") Then
                        If IsLabelA(here$, rest$, nm$) = 1 Then
                            If here$ = vbNullString Then
                                If Not GetVar(stripstack1, ohere$ & "." & nm$, v) Then v = globalvar(ohere$ & "." & nm$, p)   ': GetVar bstack, nm$, v
                            Else
                                If Not GetlocalVar(ohere$ & "." & nm$, v) Then v = globalvar(ohere$ & "." & nm$, p)   ': GetlocalVar W$, v
                            End If
                            GoTo againgroup
                        Else
                            SyntaxError
                            Exit Do
                        End If
                    End If
                    Set stripstack1.lastobj = Nothing
                    Set stripstack1 = New basetask
                    bstack.CopyStrip stripstack1
                    GoTo continuehere
                ElseIf Typename$(stripstack1.lastobj) = myArray Then
                    Set var(v) = New mHandler
                    var(v).t1 = 3
                    Set var(v).objref = stripstack1.lastobj
                    Set stripstack1.lastobj = Nothing
                Else
                    Set myobject = stripstack1.lastobj
                    If CheckStackObj(stripstack1, myobject) Then
                    Set var(v) = New mHandler
                    var(v).t1 = 3
                    Set var(v).objref = myobject
                    Set stripstack1.lastobj = Nothing
                    
                    Else
                    SyntaxError
                    Exit Do
                    End If
                End If
            ElseIf VarType(var(v)) = vbLong Then
                var(v) = CLng(p)
            Else
                If MyIsObject(var(v)) Then
                    If TypeOf var(v) Is Constant Then
                        var(v).DefineOnce p
                    End If
                Else
                If final Then
                    Set var(v) = New Constant
                    var(v).DefineOnce p
                Else
                    var(v) = p
                    
                End If
                End If
            End If
        Else
            If LastErNum <> -2 Then NoValueForVar w$
            ExecuteGroupStruct = 0
            Exit Function
        End If
    Else
        ss$ = vbNullString
        i = MyTrimL(rest$)
                If InStr("/*-+=~^&|<>", Mid$(rest$, i, 1)) > 0 Then
                    If InStr("/*-+=~^&|<>!", Mid$(rest$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(rest$, i, 2)
                        If ss$ = "=&" Then
                        ss$ = "="
                        Mid$(rest$, i, 1) = " "
                        Else
                        Mid$(rest$, i, 2) = "  "
                        End If
                    Else
                        ss$ = Mid$(rest$, i, 1)
                        Mid$(rest$, i, 1) = " "
                    End If
                If ss$ <> "" Then
                    NoThatOperator ss$
                    ExecuteGroupStruct = 0
                    Exit Function
                End If
                Else
                    
                End If
    End If
    GoTo continuehere
Case 2
    rest$ = w$ & rest$: Exit Function
Case 3
        ss$ = vbNullString
         If MaybeIsSymbol(rest$, "=<") Then
            If FastSymbol(rest$, "<=", , 2) Then
                    NoThatOperator "<="
                    ExecuteGroupStruct = 0
                    Exit Function
            ElseIf FastSymbol(rest$, "=") Then
            ss$ = "="
            End If
        End If
       

If ss$ <> "" Then

    If ss$ = "=" Then
    
    If here$ = vbNullString Then
            If glob Then
           If IsStrExp(stripstack1, rest$, ss$) Then v = globalvar(w$, ss$)
                If final Then
                    Set var(v) = New Constant
                    var(v).DefineOnce ss$
                End If
           
          ElseIf GetVar(bstack, w$, v) Then
            
                If IsStrExp(stripstack1, rest$, ss$) Then CheckVar var(v), ss$
                
                If final Then
                    Set var(v) = New Constant
                    var(v).DefineOnce ss$
                End If
            ElseIf IsStrExp(stripstack1, rest$, ss$) Then
            
                globalvar w$, ss$
            
            End If
    Else
           If GetlocalVar(w$, v) Then
                If IsStrExp(stripstack1, rest$, ss$) Then CheckVar var(v), ss$
            ElseIf IsStrExp(stripstack1, rest$, ss$) Then
            If Not stripstack1.lastobj Is Nothing Then
                                         If TypeOf stripstack1.lastobj Is lambda Then
                                         v = globalvar(w$, Empty)
                                Set var(v) = stripstack1.lastobj
                                Set stripstack1.lastobj = Nothing
                                LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                                 If here$ = vbNullString Or glob Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & Str(v), bstack.GroupName
                                            Else
                                            
                                                GlobalSub here$ & "." & w$ + "()", "CALL EXTERN " & Str(v), here$ + "." + bstack.GroupName
                                            End If

                                             OvarnameLen = varhash.count + 1
                                             ElseIf TypeOf stripstack1.lastobj Is Group Then
                                             ' here

                                             Set myobject = stripstack1.lastobj
                                             w$ = Replace(w$, "$", "")
                                             
                                       v = globalvar(w$, p)
againgroupstr:
                                               LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni
                                               'nm$ = Left$(nm$, Len(nm$) - 1)
                                               
                                               
                                              If nm$ <> "" Then
                        UnFloatGroup stripstack1, nm$, v, myobject
                        ElseIf stripstack1.UseGroupname = vbNullString Then
                        UnFloatGroup stripstack1, w$, v, myobject
                        Else
                        UnFloatGroup stripstack1, bstack.GroupName + Mid$(w$, Len(ohere$ & ". ")), v, myobject
                        End If
                        
                  
                        OvarnameLen = varhash.count + 1  'we record ...
                        If nm$ = vbNullString Then
                                Set stripstack1.lastobj = Nothing
                                Set stripstack1 = New basetask
                                bstack.CopyStrip stripstack1
                                GoTo continuehere
                        End If
                         If FastSymbol(rest$, ",") Then
                        If IsLabelA(here$, rest$, nm$) = 3 Then
                        frm$ = Left$(ohere$ & "." & nm$, Len(ohere$ & "." & nm$) - 1)
                            If here$ = vbNullString Then
                                If Not GetVar(stripstack1, frm$, v) Then v = globalvar(frm$, p)   ': GetVar bstack, nm$, v
                            Else
                                If Not GetlocalVar(frm$, v) Then v = globalvar(frm$, p) ': GetlocalVar W$, v
                            End If
                            frm$ = vbNullString
                            GoTo againgroupstr
                        Else
                            SyntaxError
                            Exit Do
                        End If
                    End If
                    Set stripstack1.lastobj = Nothing
                    Set stripstack1 = New basetask
                    bstack.CopyStrip stripstack1
                    GoTo continuehere
                        
                        
                                             Else
                                     NoValueForVar w$
                       End If
               Else
                v = globalvar(w$, ss$)
                If final Then
                Set var(v) = New Constant
                var(v).DefineOnce ss$
                End If
            End If
            End If
            End If
    End If
Else
' NO VALUE IS OK
If Not GetlocalVar(w$, v) Then
                v = globalvar(w$, ss$)
                        If final Then
        If MyIsObject(var(v)) Then
        If Not TypeOf var(v) Is Constant Then MyEr "No Constant, it is an object", "Δεν έχω σταθερή, αλλά αντικείμενο": Exit Function
        Else
        Set var(v) = New Constant
        End If
        Else
                var(v) = vbNullString
        End If
        

            End If
End If
Case 4
    p = 0#
If glob Then
     v = globalvar(w$, Round(p, 0), , True)
     If final Then
                    
                    Set var(v) = New Constant
                    var(v).DefineOnce Round(p, 0)
                
     End If
ElseIf here$ = vbNullString Then
If Not GetVar(bstack, w$, v) Then v = globalvar(w$, p) '': GetVar bstack, W$, v
Else
If Not GetlocalVar(w$, v) Then v = globalvar(w$, p) '': GetlocalVar W$, v
        If final Then
        If MyIsObject(var(v)) Then
        If Not TypeOf var(v) Is Constant Then MyEr "No Constant, it is an object", "Δεν έχω σταθερή, αλλά αντικείμενο": Exit Function
        Else
        Set var(v) = New Constant
        End If
        End If
End If
ss$ = vbNullString
        i = MyTrimL(rest$)
                If InStr("/*-+=~^&|<>", Mid$(rest$, i, 1)) > 0 Then
                    If InStr("/*-+=~^&|<>!", Mid$(rest$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(rest$, i, 2)
                        If ss$ = "=&" Then
                        ss$ = "="
                        Mid$(rest$, i, 1) = " "
                        Else
                        Mid$(rest$, i, 2) = "  "
                        End If
                    Else
                        ss$ = Mid$(rest$, i, 1)
                        Mid$(rest$, i, 1) = " "
                    End If
                If ss$ <> "=" And ss$ <> "" Then
                    NoThatOperator ss$
                    ExecuteGroupStruct = 0
                    Exit Function
                End If
                Else
                    
                End If


            If ss$ = "=" Then
                If IsExp(stripstack1, rest$, p) Then
                If MyIsObject(var(v)) Then
                If TypeOf var(v) Is Constant Then
                  var(v).DefineOnce MyRound(p)
                
                End If
                Else
                 var(v) = MyRound(p)
                 End If
                If Err.Number = 6 Then ExecuteGroupStruct = 0:   Exit Function

                Else
                      If LastErNum <> -2 Then NoValueForVar w$
                      ExecuteGroupStruct = 0
                      Exit Function

            
            End If
End If
GoTo continuehere
Case 5
If final Then
rest$ = Mid$(w$, Len(ohere$) + 2) + rest$
w$ = "DIM"
GoTo contVar
End If
    If neoGetArray(stripstack1, w$, pppp, , glob) Then
        If Not NeoGetArrayItem(pppp, stripstack1, w$, v, rest$) Then ExecuteGroupStruct = 0:  Exit Function
        On Error Resume Next
        
        If Not FastSymbol(rest$, "=", True) Then
        End If
        If Not IsExp(stripstack1, rest$, p) Then
            If LastErNum <> -2 Then MissNumExpr
            ExecuteGroupStruct = 0: Exit Function
        End If
        If pppp.Arr Then
            pppp.item(v) = p
            Do While FastSymbol(rest$, ",")
                    If pppp.UpperMonoLimit > v Then
                        v = v + 1
                        If Not IsExp(stripstack1, rest$, p) Then ExecuteGroupStruct = 0:   Exit Function
                        pppp.item(v) = p
                    Else
                        Exit Do
                    End If
            Loop
        Else
            pppp.GroupRef.Value = p
        End If
        lcl = False
    Else
        MyEr "Can't find array " & w$ & ")", "Δεν βρίσκω πίνακα " & w$ & ")"
        ExecuteGroupStruct = 0:   Exit Function
    End If
GoTo continuehere
Case 6
If final Then
rest$ = Mid$(w$, Len(ohere$) + 2) + rest$
w$ = "DIM"
GoTo contVar
End If
If neoGetArray(stripstack1, w$, pppp, , glob) Then
If Not NeoGetArrayItem(pppp, stripstack1, w$, v, rest$) Then ExecuteGroupStruct = 0:   Exit Function
On Error Resume Next

If Not FastSymbol(rest$, "=") Then
  If FastSymbol(rest$, ":=", , 2) Then
    ss$ = Left$(aheadstatus(rest$), 1)
        If ss$ = "S" Then
        If Not IsStrExp(stripstack1, rest$, ss$) Then ExecuteGroupStruct = 0:      Exit Function
        Else
        If Not IsExp(stripstack1, rest$, p) Then ExecuteGroupStruct = 0:    Exit Function
        ss$ = Trim$(Str$(p))
        End If
             If Not MyIsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Do While FastSymbol(rest$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
          ss$ = Left$(aheadstatus(rest$), 1)
                        If ss$ = "S" Then
        If Not IsStrExp(stripstack1, rest$, ss$) Then ExecuteGroupStruct = 0:     Exit Function
        Else
        If Not IsExp(stripstack1, rest$, p) Then ExecuteGroupStruct = 0:   Exit Function
        ss$ = Trim$(Str$(p))
        End If
        
                If Not MyIsObject(pppp.item(v)) Then
                  pppp.item(v) = ss$
                  Else
                CheckVar pppp.item(v), ss$
                
                End If
        Else
        Exit Do
        End If
        Loop
   lcl = False
    Else
        ExecuteGroupStruct = 0:   Exit Function
    End If
Else
If Not IsStrExp(stripstack1, rest$, ss$) Then
     ExecuteGroupStruct = 0:   Exit Function
     End If
    If Not MyIsObject(pppp.item(v)) Then
        pppp.item(v) = ss$
    Else
        CheckVar pppp.item(v), ss$
    End If
        Do While FastSymbol(rest$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
        If Not IsStrExp(stripstack1, rest$, ss$) Then ExecuteGroupStruct = 0:   Exit Function
        
        If Not MyIsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
        CheckVar pppp.item(v), ss$
        
        End If
        Else
        Exit Do
        End If
        Loop
        lcl = False
End If
Else
ExecuteGroupStruct = 0:   Exit Function
End If
Case 7
If final Then
rest$ = Mid$(w$, Len(ohere$) + 2) + rest$
w$ = "DIM"
GoTo contVar
End If
If neoGetArray(stripstack1, w$, pppp, , glob) Then
If Not NeoGetArrayItem(pppp, stripstack1, w$, v, rest$) Then ExecuteGroupStruct = 0:   Exit Function
On Error Resume Next
If Not FastSymbol(rest$, "=") Then ExecuteGroupStruct = 0: Exit Function
If Not IsExp(stripstack1, rest$, p) Then ExecuteGroupStruct = 0: Exit Function
p = MyRound(p)
If Err.Number > 0 Then ExecuteGroupStruct = 0: Exit Function
pppp.item(v) = p
Do While FastSymbol(rest$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(stripstack1, rest$, p) Then ExecuteGroupStruct = 0: Exit Function
pppp.item(v) = MyRound(p)
Else
Exit Do
End If
Loop
Else
ExecuteGroupStruct = 0: Exit Function
End If
GoTo continuehere
Case Else

If MaybeIsSymbol(rest$, ",-+*/_!@()[];<>|~`") Then
SyntaxError
ExecuteGroupStruct = 0
Exit Function
End If
End Select
End Select
continuehere:
''\\\\\\\\\\\\\\\\

LogGroup bstack, vvv, ohere$, OvarnameLen, lcl, NoRec, uni

continuehere22:
If MaybeIsSymbol(rest$, "}") Then

ExecuteGroupStruct = 1
Exit Do
End If
If Not FastSymbol(rest$, ",") Then
final = False
SetNextLine rest$
lcl = False
End If
ExecuteGroupStruct = 1
Loop Until Trim(rest$) = vbNullString


End Function

Private Sub CallByObject(bstack As basetask, i As Long, ret As Boolean)
Dim that As stdCallFunction, Up As Long, getparam As Boolean, PP As Long
Dim k As Long, p As Variant, final(0 To 63) As Variant
Dim x1 As Long, what$, curtype As Long, s$, link$, rtype As Variant
Dim thisref(0 To 63) As Long

Set that = var(i)

If that.ReadType(that.count - 1) = -100 Then
Up = that.count - 1
getparam = True
Else
Up = that.count
End If

For k = 1 To Up
       
        If that.IsByRef(k - 1) Then
            ' look for label..and check it
           If bstack.IsInStackString(what$) Then
                   
                    If that.ReadType(k - 1) <= 4 Then
                            If GetGlobalVar(bstack.GroupName & what$, x1) Then
                                    thisref(k - 1) = x1 ' so that is used to restore value
                                    If MyIsObject(var(x1)) Then
                                         ' THIS IS NOT GOOD
                                    
                                    Else
                                             final(k - 1) = var(x1)
                                             
                                             ' so if this is a long we place a variant long
                                           ' thisref(k - 1) = x1
                                     End If
                            Else
                            ' no such variable
                            End If
                    Else
                    ' error no array yet
                    
                    End If
            Else
            ' type mismatch
            ' exit - error
            End If
        Else
        Dim ii As Long
                Select Case that.ReadType(k - 1)
                Case 2
                   If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = CLng(p)
                   End If
                    
                Case 1, 5
                        If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = p
                    End If
                Case 4, 7
                      If Not bstack.IsInStackNumber(p) Then
                   
                    If Not bstack.IsInStackLong(ii) Then Exit For
                    final(k - 1) = ii
                    Else
                    final(k - 1) = MyRound(p)
                    End If
                Case Else
                    If Not bstack.IsInStackString(s$) Then Exit For
                    final(k - 1) = s$
                End Select
        End If
Next k
If getparam Then
Do
If bstack.IsInStackLong(PP) Then
final(k - 1) = PP
k = k + 1
ElseIf bstack.IsInStackNumber(p) Then
final(k - 1) = p
k = k + 1
ElseIf bstack.IsInStackString(s$) Then
 final(k - 1) = s$
k = k + 1
Else
Exit Do
End If
Loop Until bstack.soros.IsEmpty Or k = 63

Up = k - 1
End If

If k > Up Then
'all is ok
' make your call
If that.RetType = 0 Then
rtype = vbLong
Else
rtype = that.RetType
End If
If that.CallType = 0 Then
x1 = stdCallW(that.LIB, that.func, rtype, final(), Up)
Else
x1 = cdeclCallW(that.LIB, that.func, rtype, final(), Up)
End If
If ret Then
If that.RetType = 0 Then
bstack.soros.PushVal CDbl(x1)   ' FEEDBACK TO STACK
Else
bstack.soros.PushStr GetBStrFromPtr(x1)
End If
End If
Else
'error message


Exit Sub
End If
For k = 1 To that.count
If that.IsByRef(k - 1) Then
' RESTORE VALUES...
    If that.ReadType(k - 1) < 5 Then
    var(thisref(k - 1)) = final(k - 1)
    
    End If
End If
Next k

End Sub

Sub CallGlobal(s$)
Dim ohere$
ohere$ = here$
here$ = "@"
 Execute basestack1, s$, False
 s$ = vbNullString
here$ = ohere$
End Sub






Public Sub ProcProperty(bstack As basetask, v(), vIndex As Long, FN$, rest$, language As Long, Optional hardlink As Boolean = False, Optional usethis As Long)
Dim var1() As Variant, s$, r As Double, l As Long, newref As Long, many As Long, y1 As Boolean, x1 As Long, y2 As Boolean
Dim var2() As String, ss$, sp As Variant, indirect As Boolean
Dim vv As Object, useHandler As Boolean
Dim oo As Object, myVar As Variant
Set vv = v(vIndex)
Dim pppp As mArray
If TypeOf vv Is mHandler Then

If vv.indirect >= 0 Then
 vIndex = vv.indirect
    Set vv = var(vv.indirect)
   
Else
If vv.UseIterator Then
ElseIf vv.IamEnum Then
useHandler = True
Else
    Set vv = vv.objref
End If
End If
 indirect = True
End If
If TypeOf vv Is PropReference Then
If IsObject(vv.Value) Then Set vv = vv.Value Else MyEr "No Object found", "Δεν βρήκα αντικείμενο": Exit Sub
End If
Do
ReDim var1(0 To 0)
Erase var2()
Set pppp = Nothing

If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, r) Then



                        If FastSymbol(rest$, "@") Then
                            Set oo = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            ReDim var1(0 To 1)
                            If IsExp(bstack, rest$, sp) Then
                                var1(0) = sp
                            ElseIf IsStrExp(bstack, rest$, ss$) Then
                                var1(0) = ss$
                            End If
                            If oo Is Nothing Then
                                var1(1) = r
                            Else
                            If TypeOf oo Is mHandler Then
                                Set bstack.lastobj = oo
                                Set var(1) = bstack.lastobjIndirect(var())
                            Else
                                Set var1(1) = oo
                            End If
                                Set oo = Nothing
                            End If
                    
                           CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 2
                         Else
                                If bstack.lastobj Is Nothing Then
                                    var1(0) = r
                                    CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 1
                                Else
                                    Set var1(0) = bstack.lastobj
                                    Set bstack.lastobj = Nothing
                                    CallByNameFixParamArray vv, FN$, VbSet, var1(), var2(), 1
                                    
                                End If
                                
                        End If
 
 
ElseIf IsStrExp(bstack, rest$, s$) Then

                        If FastSymbol(rest$, "@") Then
                            ReDim var1(0 To 1)
                            
                            If IsExp(bstack, rest$, sp) Then
                                var1(0) = sp
                            ElseIf IsStrExp(bstack, rest$, ss$) Then
                                var1(0) = ss$
                            End If
                            var1(1) = s$
                            CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 2
                        Else
                            var1(0) = s$
                            CallByNameFixParamArray vv, FN$, VbLet, var1(), var2(), 1
                        End If
End If
ElseIf IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
' WE MAKE A NEW OBJECT
If TypeOf var(vIndex) Is GuiM2000 Then If UCase(FN$) = "VISIBLE" Then FN$ = "TrueVisible"
                                                    
If FN$ = vbNullString Then
l = usethis
ElseIf useHandler Then
l = FindDISPID(vv.objref, FN$)
Else
l = FindDISPID(vv, FN$)

'FN$ = Typename(vv) & "." & UCase(FN$)
End If
If l <> -1 Then
' we have vv, fn$, l and we are looking for a label to make an object to that
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", language)

If Not y1 Then y2 = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", language) Else y2 = False

x1 = Abs(IsLabel(bstack, rest$, s$))

If x1 < 5 Then
    If y1 Or y2 Then GoTo JUMPTHERE
    If GetlocalVar(s$, newref) Then
    ' so it is an object now
    If Not MyIsObject(var(newref)) Then
    MakeitPropReference var(newref)
    GoTo jumpheretoo
    ElseIf Typename(var(newref)) <> "PropReference" Then
    MakeitPropReference var(newref)
    GoTo jumpheretoo
    End If
Else
JUMPTHERE:
''GlobalVar s$, 0   'we push a zero..GlobalVar create
''GetlocalVar s$, newref
If y1 Then
newref = GlobalVarRefOnly(s$, y1)
Else
newref = GlobalVarRefOnly(bstack.GroupName & s$)
End If
If l = -4 Then
' get now object

sp = vbEmpty
If ReadPropObj(vv, -4, sp) Then

    Set var(newref) = New mHandler
    var(newref).ConstructEnumerator sp
 Else
 NoEnumaretor
End If

Else
MakeitPropReference var(newref)

jumpheretoo:
If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then
    Set oo = oo.objref
    If oo.t1 <> 1 Then
        GoTo there
    End If
End If
    var(newref).ConstructObj oo, l
Set oo = Nothing
Else
If vv Is var(vIndex) Then
var(newref).Construct vIndex, l, indirect    ' this is the link vindex is an index to var()
Else
var(newref).ConstructObj vv, l
End If
'Debug.Print vIndex, l, FN$
End If
' so for every method or property we use this simple struct
' we can define the value type
End If
End If
Else


If y2 Then
If FastSymbol(rest$, ")") Then GoTo contherenew
End If
 If neoGetArray(bstack, s$, pppp, here$ <> "") Then

 
If NeoGetArrayItem(pppp, bstack, s$, newref, rest$) Then

With pppp

  MakeitPropReference myVar
  If pppp.Arr Then Set .item(newref) = myVar
  
    If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then
With oo
If .indirect < 0 Then
    Set oo = oo.objref
Else
    If .indirect <= var2used Then
    '????
    End If
End If
End With
End If
myVar.ConstructObj oo, l
Set oo = Nothing
Else
myVar.Construct vIndex, l   ' this is the link vindex is an index to var()
End If
Set myVar = Nothing
End With

End If
ElseIf FastSymbol(rest$, ")") Then
''s$ = Left$(s$, Len(s$) - 1)
contherenew:
If pppp Is Nothing Then

GlobalArr bstack, s$, "0)", (1), (y1)
 If Not neoGetArray(bstack, s$, pppp, here$ <> "") Then GoTo there
End If




MakeitPropReference myVar

If hardlink Then

Set oo = v(vIndex)
If TypeOf oo Is mHandler Then Set oo = oo.objref
myVar.ConstructObj oo, l
Set oo = Nothing
Else
myVar.Construct vIndex, l   ' this is the link vindex is an index to var()
End If

myVar.UseIndex = True

pppp.PushProp myVar

''
End If

End If
End If
ElseIf IsLabelSymbolNew(rest$, "ΘΕΣΕ", "SET", language) Then
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", language)
' we make a new reference to that property
' make a read now
l = FindDISPID(vv, FN$)
FN$ = UCase(FN$)
If l <> -1 Then

x1 = Abs(IsLabel(bstack, rest$, s$))
If x1 < 5 Then
If Not FastSymbol(rest$, "(") Then
ReadOneParameter vv, l, s$, myVar
Else
GoTo contindex
End If
Else
contindex:
Dim s1$
 If IsExp(bstack, rest$, sp) Then
  Err.Clear
        Set myVar = ReadOneIndexParameter(vv, l, s1$, sp, False)
                    If Err.Number Then
                    Err.Clear
                Set myVar = ReadOneIndexParameter(vv, l, s1$, sp, True)
               
                End If
                            ElseIf IsStrExp(bstack, rest$, ss$) Then
                            On Error Resume Next
                Err.Clear
                Set myVar = ReadOneIndexParameter(vv, l, s1$, ss$, False)
                If Err.Number Then
                Err.Clear
                Set myVar = ReadOneIndexParameter(vv, l, s1$, ss$, True)
               
                End If
                            End If
                            If Not FastSymbol(rest$, ")") Then GoTo there
                         If x1 > 4 Then s$ = Left$(s$, Len(s$) - 1)
End If
'
 '   If x1 < 5 Then
        If GetlocalVar(s$, newref) Then
            'var(newref) = CDbl(myVar)
             If IsObject(myVar) Then
                Set var(newref) = myVar
            Else
            var(newref) = myVar
            End If
        Else
            newref = GlobalVarRefOnly(s$, y1)
            If IsObject(myVar) Then
                Set var(newref) = myVar
            Else
            var(newref) = myVar
            End If
    End If
'Else

'End If
End If
End If
 If FastSymbol(rest$, ",") Then
 If Not IsStrExp(bstack, rest$, FN$) Then Exit Do
 Else
 Exit Do
 End If
Loop
there:
Set oo = Nothing
Set pppp = Nothing
Set vv = Nothing
End Sub
''ProcProperty bstack, var(i), sS$, rest$,  LANG
' METHOD A,"Multiply" (12,12) [AS RESULT]   (or Result$)  if [As] isn't there so
' METHOD A "Multiply" (12,12)  AS RESULT  without
' METHOD A "Multiply", &alfa,&beta$   'passing by reference
''ProcMethod bstack, var(i), sS$, rest$,  LANG
Sub ProcMethod(bstack As basetask, v(), vIndex As Long, FN$, rest$, language As Long, ok As Boolean)
Dim var1() As Variant, s$, r As Double, l As Long, newref As Long, glob As Boolean, newvar As Boolean
Dim vv As Object, mstack As New mStiva, Result As Variant, retobject As Object
Dim namarg As Long
ok = True
Set vv = v(vIndex)
If TypeOf vv Is mHandler Then
If vv.indirect >= 0 Then

vIndex = vv.indirect
If var2used < vv.indirect Then
MyEr "weak reference  out of scope", "η αναφορά είναι εκτός σκοπού"
ok = False
Exit Sub
End If

Set vv = var(vv.indirect)

Else
Set vv = vv.objref
End If
End If
If vv Is Nothing Then Exit Sub
If TypeOf vv Is PropReference Then
If IsObject(vv.Value) Then Set vv = vv.Value Else ok = False: MyEr "No Object found", "Δεν βρήκα αντικείμενο": Exit Sub
End If

ReDim var1(0 To 0)
Dim var2() As String
ReDim var2(0 To 0)
' expression or label:=expression'

''Exit Sub
Dim what$, it As Long, items As Long, y3 As Long

' we have parameters..(by value)
If FastSymbol(rest$, "(") Then  ' we have "(par1, par2...) as result"
        RealMeth bstack, rest$, var1(), var2(), items, namarg
If Not FastSymbol(rest$, ")", True) Then Exit Sub
Result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), items, retobject, namarg, bstack.IamAnEvent)
ElseIf FastSymbol(rest$, ",") Then
RealMeth bstack, rest$, var1(), var2(), items, namarg  ' if we have as result then we get an error...
 Result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), items, retobject, namarg, bstack.IamAnEvent)
Else

 Result = CallByNameFixParamArray(vv, FN$, VbMethod, var1(), var2(), 0, retobject, namarg, bstack.IamAnEvent)

End If
If Not retobject Is Nothing Then
    y3 = IsLabelSymbolNew(rest$, "ΜΕΓΕΓΟΝΟΤΑ", "WITHEVENTS", language)
     If IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
             glob = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", language)
             
              newvar = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", language)
             
             If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                        If newvar Then
                            it = globalvar(what$, 0, , glob)
                            Set var(it) = retobject
                        ElseIf GetVar(bstack, what$, it) Then
                            Set var(it) = retobject
                        Else
                            it = globalvar(what$, 0, , glob)
                            Set var(it) = retobject
                        End If
                            
                                If y3 <> 0 Then
                                            Dim ev As ComShinkEvent
                                    If GetShink(ev, it, what$) Then
                                            ' private
                                            ' no need for a name, we do not address it in any way.
                                            ' ev knows how to call handler
                                            If newvar Then
                                                it = globalvar(ChrW(&HFFBF) + "_" + what$, s$, , glob)
                                            ElseIf Not GetVar(bstack, ChrW(&HFFBF) + "_" + what$, it) Then
                                                        
                                                        it = globalvar(ChrW(&HFFBF) + "_" + what$, s$, , glob)
                                                        End If
                                                        
                                                    Set var(it) = ev
                                     Else
                                            MyEr "Can't handle events here", "Δεν μπορώ να χειριστώ γεγονότα"
                                            ok = False
                                             
                                         '   End Sub
                                     End If
                                End If
            End If
     End If
Else
     If IsLabelSymbolNew(rest$, "ΩΣ", "AS", language) Then
             glob = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", language)
             
              newvar = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", language)
             
             Select Case Abs(IsLabel(bstack, rest$, what$))
             Case 1
                               If newvar Then
                                    globalvar what$, Result, , glob
                                ElseIf GetVar(bstack, what$, it) Then
                                    var(it) = Result
                                    
                                Else
                                    globalvar what$, Result, , glob
                                    
                                End If
              Case 4
                                If newvar Then
                                    globalvar what$, Int(Result), , glob
                                ElseIf GetVar(bstack, what$, it) Then
                                    var(it) = Int(Result)
                                Else
                                    globalvar what$, Int(Result), , glob
                                    
                                End If
              Case 3
                                If newvar Then
                                    globalvar what$, Result, , glob
                                ElseIf GetVar(bstack, what$, it) Then
                                    var(it) = Result
                                Else
                                    globalvar what$, Result, , glob
                                End If
              End Select
            
    End If
End If
End Sub

Sub RealMeth(bstack As basetask, rest$, var2() As Variant, var3() As String, NoNameditems As Long, namedargument As Long)
'  testmeth "122,&beta,121,alfa:=a+4, beta:=122"
Dim s$, l$
Dim trap As Long, ss$, p As Variant, items As Long
Do
again:
If FastSymbol(rest$, ",") Then
' second, or more is optional
        var2(items) = vbError
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
        GoTo again
End If
s$ = aheadstatus(rest$, True) + " "
Select Case Left$(s$, 1)
Case "S"
If (trap Mod 2 = 0) And namedargument > 0 Then Exit Do  ' is a fault
        If IsStrExp(bstack, rest$, ss$) Then
            var2(items) = ss$
           If namedargument = 0 Then NoNameditems = NoNameditems + 1
        Else
            var2(items) = vbNullString
            s$ = vbNullString
        End If
        If trap > 0 Then trap = trap + 1
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
Case "N"


        ' maybe is a named argument
        l$ = rest$
        If IsLabel(bstack, l$, ss$) Then
                If IsOperator(l$, ":=", 2) Then
                    'push name to
                    namedargument = namedargument + 1
                    If UBound(var3()) < namedargument Then ReDim Preserve var3(namedargument + 1)
                    var3(namedargument) = ss$
                    
                    trap = 1
                    rest$ = l$
                    GoTo again
                Else
                       If Not ((trap Mod 2 = 0) And namedargument > 0) Then
                            
                            If IsExp(bstack, rest$, p) Then
                            If bstack.lastobj Is Nothing Then
                                 var2(items) = p
                            Else
                            If TypeOf bstack.lastobj Is mHandler Then
                                Set var2(items) = bstack.lastobjIndirect(var())
                            Else
                                Set var2(items) = bstack.lastobj
                                End If
                                Set bstack.lastobj = Nothing
                                 End If
                                If namedargument = 0 Then NoNameditems = NoNameditems + 1
                                  If trap > 0 Then trap = trap + 1
                             Else
                             
                             End If
                        Else
                        Exit Do
                        End If
                End If
        Else
                If Not ((trap Mod 2 = 0) And namedargument > 0) Then
                         If IsExp(bstack, rest$, p) Then
                             var2(items) = p
                             If namedargument = 0 Then NoNameditems = NoNameditems + 1
                              If trap > 0 Then trap = trap + 1
                         Else
                                 Exit Do
                         End If
                 Else
                             Exit Do
                 End If
    End If
        items = items + 1
        If UBound(var2()) < items Then ReDim Preserve var2(items + 1)
End Select
If Not FastSymbol(rest$, ",") Then Exit Do
Loop Until s$ = vbNullString
End Sub
Sub TestMeth(rest$)
'  testmeth "122,&beta,121,alfa:=a+4, beta:=122"
Dim s$, y1 As Long, l$, namedargument As Long
Dim trap As Long
Do
s$ = aheadstatus(rest$, True, y1)
''Debug.Print s$, Mid$(rest$, 1, y1 - 1)
If s$ <> "" Then
    l$ = Mid$(rest$, 1, y1 - 1)
    rest$ = Mid$(rest$, y1)
End If
If FastSymbol(rest$, ":=", , 2) Then

namedargument = namedargument + 1
trap = 0
ElseIf FastSymbol(rest$, ",") Then
trap = trap + 1
If trap > 1 And namedargument > 0 Then
''Debug.Print "error...no normal after namedvariablesl"
Exit Sub
End If
End If
y1 = 1
Loop Until s$ = vbNullString
End Sub
Function ReadProp(fromIndex As Long, ByVal propIndex As Long, RETVAR As Variant) As Boolean
Dim o As Object, er$
On Error GoTo there
Set o = var(fromIndex)
If o Is Nothing Then Exit Function
If TypeOf o Is mHandler Then
propIndex = -propIndex
If o.UseIterator Then
Else
Set o = o.objref
End If
End If
If o Is Nothing Then Exit Function
If TypeOf o Is PropReference Then
If o.IsObj Then Set o = o.Value
End If
er$ = vbNullString
RETVAR = Empty
ReadProp = ReadOneParameter(o, propIndex, er$, RETVAR)
If Not IsObject(RETVAR) Then

'    If IsNumeric(RETVAR) Then RETVAR = CDbl(RETVAR)
End If
If er$ <> "" Then
there:
BadGetProp
End If
End Function
Function ReadPropIndex(fromIndex As Long, ByVal propIndex As Long, myIndex As Variant) As Variant
Dim o As Object, er$
On Error GoTo there
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
er$ = vbNullString
ReadPropIndex = ReadOneIndexParameter(o, propIndex, er$, myIndex)
If er$ <> "" Then
there:
BadGetProp
End If
End Function
Sub WriteProp(fromIndex As Long, ByVal propIndex As Long, Anyval As Variant)
Dim o As Object, er$
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
If o.UseIterator Then
Else
Set o = o.objref
End If
End If
'ChangeOneIndexParameter
ChangeOneParameter o, propIndex, Anyval, er$
If er$ <> "" Then
BadLetProp
End If
End Sub
Sub WritePropIndex(fromIndex As Long, ByVal propIndex As Long, Anyval As Variant, myIndex)
Dim o As Object, er$
Set o = var(fromIndex)
If TypeOf o Is mHandler Then
propIndex = -propIndex
Set o = o.objref
End If
ChangeOneIndexParameter o, propIndex, Anyval, er$, myIndex
If er$ <> "" Then
BadLetProp
End If
End Sub
Function ReadPropIndexObj(o As Object, ByVal propIndex As Long, myIndex) As Variant
Dim er$
er$ = vbNullString
 ReadPropIndexObj = ReadOneIndexParameter(o, propIndex, er$, myIndex)
If er$ <> "" Then
BadGetProp
End If
End Function
Function ReadPropObj(o As Object, ByVal propIndex As Long, RETVAR As Variant) As Boolean
Dim er$
er$ = vbNullString
ReadPropObj = ReadOneParameter(o, propIndex, er$, RETVAR)
If er$ <> "" Then
BadGetProp
End If
End Function
Sub WritePropObj(o As Object, ByVal propIndex As Long, Anyval As Variant)
Dim er$
ChangeOneParameter o, propIndex, Anyval, er$
If er$ <> "" Then
BadLetProp
End If
End Sub
Sub WritePropIndexObj(o As Object, ByVal propIndex As Long, Anyval As Variant, myIndex)
Dim er$
ChangeOneIndexParameter o, propIndex, Anyval, er$, myIndex
If er$ <> "" Then
BadLetProp
End If
End Sub

Sub MakeThisSub(ThatStack As basetask, rest$)

If Left$(rest$, 5) = "THIS." Then
Dim s$
If ThatStack.GetDotNew(s$, 1) Then

    rest$ = s$ & Mid$(rest$, 6)
    ElseIf ThatStack.GroupName = vbNullString Then
        rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If

ElseIf Left$(rest$, 5) = "ΑΥΤΟ." Then

If ThatStack.GetDotNew(s$, 1) Then

    rest$ = s$ & Mid$(rest$, 6)
    ElseIf ThatStack.GroupName = vbNullString Then
    rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)

Else

    rest$ = ThatStack.GroupName & Mid$(rest$, 6)
End If

Else

End If
End Sub

Sub MakeThisSubNum(ThatStack As basetask, rest$)
If Left$(rest$, 1) = "T" Then
If Left$(rest$, 5) = "THIS." Then
    If ThatStack.UseGroupname <> "" Then
        rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If
    End If
ElseIf Left$(rest$, 1) = "Α" Then
If Left$(rest$, 5) = "ΑΥΤΟ." Then
    If ThatStack.UseGroupname <> "" Then
       rest$ = ThatStack.UseGroupname & Mid$(rest$, 6)
    Else
        rest$ = ThatStack.GroupName & Mid$(rest$, 6)
    End If
End If
End If
End Sub

Function ColorRGB(bstack As basetask, n$, r As Variant) As Boolean
Dim r2 As Variant, r3 As Variant, ss$, par As Boolean
ColorRGB = True
    If IsExp(bstack, n$, r) Then
            
            r = mycolor(r)
            par = True
            If FastSymbol(n$, ",") Then
            par = IsExp(bstack, n$, r2)
            If par And FastSymbol(n$, ",") Then
            par = IsExp(bstack, n$, r3)
            End If
            r = rgb(Abs(r Mod 256), Abs(r2 Mod 256), Abs(r3 Mod 256))
            End If
            If Not par Then ColorRGB = False: Exit Function
    ElseIf IsStrExp(bstack, n$, ss$) Then
            ' value in hexadecimal input as in html RGB
            ' we have to make BGR
    
            ss$ = Right$("00000000" & ss$, 8)
   r = CDbl(UNPACKLNG(Right$(ss$, 2)) * 65536#) + CDbl(UNPACKLNG(Mid$(ss$, 5, 2)) * 256#) + CDbl(UNPACKLNG(Mid$(ss$, 3, 2)))
   
         
             Else
              ColorRGB = False
              
    End If
End Function

Function globalArrByPointer(bs As basetask, basestack As basetask, what$, Optional newonly As Boolean = False, Optional checkforglobal As Boolean) As Boolean
Dim pppp As mArray, myobject As Object, wasAglobal As Boolean
   If bs.IsObjectRef(myobject) Then
   If newonly Then GoTo there1
   
             If neoGetArray(basestack, what$, pppp, , , , , wasAglobal) Then
             If Not checkforglobal Then If wasAglobal Then GoTo there1
                    If Not pppp Is Nothing Then
                        If TypeOf myobject Is mHandler Then
                        If CheckIsmArray(myobject) Then
                            Set var(varhash.lastNDX) = myobject
                            var(varhash.lastNDX).common = pppp.common
                            Else
                                  NotArray
                                  Exit Function
                        
                        End If
                        ElseIf TypeOf myobject Is mArray Then
                        myobject.CopyArray pppp
                        Else
                        NotArray
                        globalArrByPointer = False
                        Set myobject = Nothing
                        Exit Function
                        End If
                        Set myobject = Nothing
                        globalArrByPointer = True
                    End If
            Else
there1:
      
                GlobalArr basestack, basestack.GroupName & what$, "", 0, -1
                If neoGetArray(basestack, what$, pppp) Then  ''basestack.GroupName &
                        If TypeOf myobject Is mHandler Then
                        If CheckIsmArray(myobject) Then
                            Set var(varhash.lastNDX) = myobject
                                  Else
                                  NotArray
                                  Exit Function
                        
                        End If
                        ElseIf TypeOf myobject Is mArray Then
                        myobject.CopyArray pppp
                        Else
                        NotArray
                        globalArrByPointer = False
                        Set myobject = Nothing
                        Exit Function
                         End If
                         globalArrByPointer = True
                        Set myobject = Nothing
                End If
                
             End If
      
    End If
End Function
Public Sub CopyHandler(F As Variant, bstack As basetask)
Dim aa As mHandler, bb As mHandler
Set aa = F
aa.CopyTo bb
Set bstack.lastobj = bb
Set aa = Nothing
Set bb = Nothing
End Sub
Public Function CopyHandlerObj(F As Variant) As Object
Dim aa As mHandler, bb As mHandler
Set aa = F
aa.CopyTo bb
Set CopyHandlerObj = bb
Set aa = Nothing
Set bb = Nothing
End Function
Public Sub CopyLambdaAny(F As Variant, obj As Object)
Dim aa As lambda, bb As lambda
Set aa = F
aa.CopyTo bb, var()
Set obj = bb
Set aa = Nothing
Set bb = Nothing
End Sub
Public Sub CopyLambda(F As Variant, bstack As basetask)
Dim aa As lambda, bb As lambda
Set aa = F
aa.CopyTo bb, var()
Set bstack.lastobj = bb
Set aa = Nothing
Set bb = Nothing
End Sub

Public Sub CopyGroup2(mg As Variant, bstack As basetask)
Dim mgroup As Group
Set mgroup = mg
If mgroup.IamSuperClass Or mgroup.IamApointer Then
    Set bstack.lastobj = mg
    
    Exit Sub
End If
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, w3 As Long
Dim b$(), vvl As Variant, delme As Document, myfirstArray As mArray, mySecondArray As mArray
Dim c$(), arrIndex As Long, choose$
Set k = New Group
Set k.Sorosref = mgroup.soros.Copy
Dim BI As Long
BI = 1

i = mgroup.soros.Total
k.BeginFloat i + 2
k.PokeItem 0, "Variables-Arrays"
k.PokeItem 1, i
For j = 2 To i * 2 + 1 Step 2
b$() = Split(k.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then

k.PokeItem j, b$(0)

If Typename(var(val(b$(1)))) = doc Then 'preserve Documents
 MakeitObject vvl
 vvl.EmptyDoc
 vvl.textDoc = var(val(b$(1))).textDoc
 k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "Group" Then
vvl = -1

CopyGroup2 var(val(b$(1))), bstack
Set vvl = bstack.lastobj
Set bstack.lastobj = Nothing
k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
Set vvl = CopyHandlerObj(var(val(b$(1))))
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then

ElseIf Typename$(var(val(b$(1)))) = myArray Then
    If Not var(val(b$(1))).common Then
        Set myfirstArray = var(val(b$(1)))
        Set mySecondArray = New mArray
        myfirstArray.CopyArray mySecondArray
        Set myfirstArray = Nothing
        Set vvl = mySecondArray
        Set mySecondArray = Nothing
    Else
        Set vvl = var(val(b$(1)))
    End If
Else
If MyIsObject(var(val(b$(1)))) Then Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j
With mgroup
k.PokeItem j, mgroup.LocalList
k.PokeItem j + 1, GetFunctionList(.FuncList)
k.oldFuncRef = ""
k.HasStrValue = .HasStrValue
k.HasValue = .HasValue
k.HasSet = .HasSet
k.HasParameters = .HasParameters
k.HasParametersSet = .HasParametersSet
Set k.SuperClassList = .SuperClassList
Set k.Events = .Events
k.highpriorityoper = .highpriorityoper
k.HasUnary = .HasUnary
End With
Set bstack.lastobj = k
End Sub
Public Function CopyGroupObj(mg As Variant, Optional nofunc As Boolean = False) As Object
Dim mgroup As Group
Set mgroup = mg
If mgroup.IamSuperClass Or mgroup.IamApointer Then
    Set CopyGroupObj = mgroup
    
    Exit Function
End If
If mgroup.IamFloatGroup Then
    Set CopyGroupObj = mgroup
    
    Exit Function

End If
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, w3 As Long
Dim b$(), vvl As Variant
Dim c$(), arrIndex As Long, choose$
Set k = New Group
Set k.Sorosref = mgroup.soros.Copy
Dim BI As Long
BI = 1

i = mgroup.soros.Total
k.BeginFloat i + 2
k.PokeItem 0, "Variables-Arrays"
k.PokeItem 1, i
For j = 2 To i * 2 + 1 Step 2
'Debug.Print k.soros.StackItem(BI)
b$() = Split(k.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then

k.PokeItem j, b$(0)

If Typename(var(val(b$(1)))) = doc Then 'preserve Documents
 MakeitObject vvl
 vvl.EmptyDoc
 vvl.textDoc = var(val(b$(1))).textDoc
 k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "Group" Then
vvl = -1
Set vvl = CopyGroupObj(var(val(b$(1))))
k.PokeItem j + 1, vvl
ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
Set vvl = CopyHandlerObj(var(val(b$(1))))
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then
Else
Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j
With mgroup
k.PokeItem j, mgroup.LocalList
'k.PokeItem j + 1, GetFunctionList(.FuncList)
If nofunc Then
' nothing
Else
    If ChangedFunctionList(.FuncList) Then
        k.PokeItem j + 1, GetFunctionList(.FuncList)
    Else
        If .oldFuncRef <> vbNullString Then
            k.PokeItem j + 1, .oldFuncRef
            k.oldFuncRef = vbNullString
        Else
            k.PokeItem j + 1, GetFunctionList(.FuncList)
        End If
    End If
End If
k.HasStrValue = .HasStrValue
k.HasValue = .HasValue
k.HasSet = .HasSet
k.HasParameters = .HasParameters
k.HasParametersSet = .HasParametersSet
Set k.SuperClassList = .SuperClassList
Set k.Events = .Events
k.highpriorityoper = .highpriorityoper
k.HasUnary = .HasUnary
End With
Set CopyGroupObj = k
End Function


Public Sub CopyGroup0(mg As Variant, bstack As basetask, usethisk As Variant)
Dim mgroup As Group, grgroup As Group
Set mgroup = mg
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, w3 As Long
Dim b$(), vvl As Variant
Dim c$(), arrIndex As Long, choose$
If TypeOf usethisk Is Group Then
Set k = usethisk
Else
Set k = New Group
End If


Dim BI As Long
BI = 1
i = mgroup.soros.Total
If Not k.IamFloatGroup Then Exit Sub

k.PokeItem 0, "Variables-Arrays"

For j = 2 To i * 2 + 1 Step 2

b$() = Split(mgroup.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then


If Typename(var(val(b$(1)))) = doc Then 'preserve Documents

ElseIf Typename(var(val(b$(1)))) = "Group" Then
vvl = -1

k.PeekItem j + 1, vvl
CopyGroup0 var(val(b$(1))), bstack, vvl

Set bstack.lastobj = Nothing


ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
CopyHandler var(val(b$(1))), bstack
Set vvl = bstack.lastobj
Set bstack.lastobj = Nothing
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then
Else
Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j

Set bstack.lastobj = k
End Sub

Public Function CopyGroup0Obj(mg As Variant, usethisk As Variant) As Object
Dim mgroup As Group, grgroup As Group
Set mgroup = mg
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, w3 As Long
Dim b$(), vvl As Variant
Dim c$(), arrIndex As Long, choose$
If TypeOf usethisk Is Group Then
Set k = usethisk
Else
Set k = New Group
End If

Dim BI As Long
BI = 1
i = mgroup.soros.Total
If Not k.IamFloatGroup Then Exit Function

k.PokeItem 0, "Variables-Arrays"


For j = 2 To i * 2 + 1 Step 2

b$() = Split(mgroup.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then

If Typename(var(val(b$(1)))) = doc Then 'preserve Documents

ElseIf Typename(var(val(b$(1)))) = "Group" Then
vvl = -1

k.PeekItem j + 1, vvl
CopyGroup0Obj var(val(b$(1))), vvl

ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
Set vvl = CopyHandlerObj(var(val(b$(1))))
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then
Else
Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j
Set CopyGroup0Obj = k

End Function
Public Function CopyGroup1(mg As Variant, usethisk As Variant) As Object
Dim mgroup As Group, grgroup As Group
Set mgroup = mg
Dim name$, k As Group, i As Long, j As Long, s$, v As Variant, w3 As Long
Dim b$(), vvl As Variant
Dim c$(), arrIndex As Long, choose$
If TypeOf usethisk Is Group Then
Set k = usethisk
Else
Set k = New Group
End If

Dim BI As Long
BI = 1
i = mgroup.soros.Total
If Not k.IamFloatGroup Then Exit Function

k.PokeItem 0, "Variables-Arrays"

For j = 2 To i * 2 + 1 Step 2

b$() = Split(mgroup.soros.StackItem(BI), " ")
If Right$(b$(0), 1) = ")" Then
b$(0) = Left$(b$(0), Len(b$(0)) - 1)

End If
If Right$(b$(0), 1) <> "(" Then
If Typename(var(val(b$(1)))) = doc Then 'preserve Documents

ElseIf Typename(var(val(b$(1)))) = "Group" Then
vvl = -1

k.PeekItem j + 1, vvl
Set CopyGroup1 = CopyGroup1(var(val(b$(1))), vvl)

ElseIf Typename(var(val(b$(1)))) = "mHandler" Then
Set vvl = CopyHandlerObj(var(val(b$(1))))
k.PokeItem j + 1, vvl
Else
k.PokeItem j + 1, var(val(b$(1)))
End If
Else


If val(b$(1)) = 0 Then
Set vvl = New mArray
ElseIf Typename$(var(val(b$(1)))) = "Empty" Then
Else
Set vvl = var(val(b$(1)))

End If
k.PokeItem j, b$(0) + ")"
 k.PokeItem j + 1, vvl
Set vvl = Nothing


End If
BI = BI + 1
Next j
Set CopyGroup1 = k
End Function
Sub UnFloatGroup(bstack As basetask, what$, i As Long, myobject As Object, Optional glob As Boolean = False, Optional Temp As Boolean = False, Optional MakeNew As Boolean)
Dim ThisGroup As Group

If myobject.IamApointer Then
Set var(i) = myobject
Exit Sub
End If
While Right$(what$, 1) = "."
what$ = Left$(what$, Len(what$) - 1)
Wend
If Trim$(what$) = vbNullString Then Exit Sub
If (myobject Is Nothing) Then Exit Sub
If Not TypeOf myobject Is Group Then Exit Sub
 Dim ps As mStiva, v As Long, s$, frm$, vvl As Variant, x1 As Long, ss$, frmarr$, sss$, j As Long
 Dim grtype As Variant, ps2push As String, uni As Boolean, uni1 As Boolean
 
 Set var(i) = New Group
 Set ThisGroup = var(i)
 ThisGroup.FlushEvents
 ThisGroup.IamGlobal = glob
 If Not myobject.SuperClassList Is Nothing Then
 
 Set ThisGroup.SuperClassList = myobject.SuperClassList

 If myobject.IamSuperClass Then Set myobject = myobject.SuperClassList: uni = True
 End If
  Set ps = ThisGroup.soros
 Dim subgroup As Object, pppp As mArray
 Dim ohere$, oldgroupname$
 ohere$ = here$

If bstack.UseGroupname <> "" Or glob Then
'If globl Then
here$ = vbNullString
End If
 oldgroupname$ = bstack.GroupName
    If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & what$ & "."
  Else
  bstack.GroupName = what$ & "."
  End If

With myobject
            If .IamFloatGroup Then
                    .PeekItem 0, grtype
                    .PeekItem 1, vvl
                    For x1 = 2 To 1 + vvl * 2 Step 2
                            .PeekItem x1, vvl    'here is the name
                          '  Debug.Print "Preek one from UnFloatGroup to "; what$; "  <- "; vvl
                                                    
                            s$ = vvl
                            If s$ = vbNullString Then InternalError: s$ = "asap"
                           If Temp Then
                            If Left$(s$, 1) = "@" Then s$ = Mid$(s$, 2)
                            End If
                           If uni Then
                            uni1 = Left$(s$, 1) = "@"
                            If Temp And uni1 Then
                            uni1 = False: s$ = Mid$(s$, 2)
                            End If
                            End If

                           If uni1 Then GoTo cont1010
                            
                                     If here$ = vbNullString Then
                                        ps2push = bstack.GroupName + s$
                                        Else
                                        ps2push = here$ + "." + bstack.GroupName + s$
                                        End If
              
                            
                            .PeekItem x1 + 1, vvl  'here is the value

                                       If InStr(s$, ".") = 0 Then

                            If Typename(vvl) = myArray Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            ss$ = vbNullString
                                  '          If Not neoGetArrayLinkOnly(bstack, s$, j) Then   ''
                                                j = -1
                                            If Temp Then
                                                    GlobalArr bstack, s$, ss$, 0, j  ''bstack.GroupName &
                                                  Set var(j) = vvl 'PRESERVE POINTER
                                                  Else
                                                    Set subgroup = vvl
                                                    GlobalArr bstack, s$, ss$, 0, j
                                                    Set pppp = var(j)
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                                  End If
                                       '     End If

                                            ps.DataStr s$ + Str$(j)
                            ElseIf Typename(vvl) = "lambda" Then
                            v = globalvar(bstack.GroupName & s$, 0)
                                               If here$ = vbNullString Then
                                                GlobalSub bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(v), bstack.GroupName
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(v), here$ + "." + bstack.GroupName
                                            End If
                            GoTo conthere2
                            ElseIf Typename(vvl) = "mHandler" Then
                            Set vvl = CopyHandlerObj(vvl)
                            GoTo conthere1
                            ElseIf Typename(vvl) = "mEvent" Then
                            CopyEvent vvl, bstack
                            Set vvl = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            If here$ = vbNullString Then
                                   vvl.Upgrade bstack.GroupName
                            Else
                            vvl.Upgrade here$ + "." + bstack.GroupName
                            End If
                        
                            GoTo conthere1
                            Else  ' is not array so...

                                                   
                     
                                            If Typename(vvl) = "Group" Then
                                            Dim spare As Object
                                            If Left$(s$, 1) = "*" Then
                                            
                                             v = globalvar(bstack.GroupName & Mid$(s$, 2), 0)
                                             If vvl.IamApointer Then
                                             Set var(v) = vvl
                                             Else
                                                   Set spare = vvl
                                                        UnFloatGroup bstack, Mid$(s$, 2), v, spare, glob, Temp, MakeNew
                                                        
                                                    '    vvl.EndFloat
                                                        Set spare = Nothing
                                                        End If
                                             ps.DataStr s$ + Str(v)
                                             Else
                                             
                                             
                                             
                                             v = globalvar(bstack.GroupName & s$, 0)
                                                 Set spare = vvl
                                                        UnFloatGroup bstack, s$, v, spare, glob, Temp, MakeNew
                                                    
                                                        Set spare = Nothing
                                             
                                              ps.DataStr "*" + s$ + Str(v)
                                             End If
                                                        
                                                  
                                                      
                                            Else

                                            If Right$(s$, 2) = "()" Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            End If
conthere1:
                                                 v = globalvar(bstack.GroupName & s$, 0)
conthere2:
                                                        If MyIsObject(vvl) Then
                                                                    Set var(v) = vvl
                                                        Else
                                                                    var(v) = vvl
                                                        End If
                                                ps.DataStr s$ + Str(v) 'ps2push + Str(V)
                                            End If
                                                        ' ss$ = String$(16, ".")
                                                       ' Mid$(ss$, 1) = Str$(v)
                                                  ''      frm$ = frm$ + ss$
                                                  
                            End If
                            End If  ' rom instr
cont1010:
                 Next x1

                        If ohere$ = vbNullString Or bstack.UseGroupname <> "" Or glob Then
                        here$ = vbNullString
                        Else
                        here$ = ohere$
                        End If
              
              .PeekItem x1, vvl
     
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
                 ExecuteGroupStruct bstack, what$, (i), s$, 1
              End If
                .PeekItem x1 + 1, vvl
               ' save definitions
              ThisGroup.oldFuncRef = vvl
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
           
           
                bstack.GroupName = vbNullString
              While s$ <> ""
                 If ohere$ = vbNullString Or bstack.UseGroupname <> "" Or glob Then
               here$ = oldgroupname$ + what$
              Else
              here$ = ohere$ + "." + oldgroupname$ + what$
              End If
              
             

          x1 = IsLabelA1("", s$, ss$)
        
             If x1 <> 0 Then
                sss$ = s$
                If Len(ss$) > 6 Then
                        x1 = IsLabelA1("", s$, ss$)
                        Dim strX1 As String
                        If MyFunction(-2 * (&H1FFF = AscW(ss$)), bstack, sss$, 1, True, MakeNew) Then '' >6 len for function
                        x1 = bstack.IndexSub
                        If FastSymbol(sss$, ";") Then
                            sbf(x1).locked = True
                            strX1 = " " + Str$(-x1)
                        Else
                            strX1 = Str$(x1)
                        End If
                        If Asc(s$) <> 32 Then
                        If InStr(s$, " ") = 2 Then
                        ss$ = ss$ + Left$(s$, 1)
                        s$ = Mid$(s$, 2)
                        Else
                        
                        ss$ = ss$ + Left$(s$, 2)
                        s$ = Mid$(s$, 3)
                        End If
                        End If
                        
                       '
                       If sbf(x1).sbgroup = here$ + "." Then
                       If InStr(ThisGroup.FuncList, Chr$(2) + ss$ + "() ") = 0 Then
                        ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + "()" + strX1 + Chr$(1) + ThisGroup.FuncList
                       End If
                        Else
                                    ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + "()" + strX1 + Chr$(1) + ThisGroup.FuncList
                                              
                                            sbf(x1).sbgroup = here$ + "."
                        End If
                        Else
                        x1 = 0
                         End If
                       
                      
                Else
                        x1 = IsLabelA1("", s$, ss$)
                        If MyModule(bstack, sss$, 1, True, MakeNew) Then
                       
                         x1 = bstack.IndexSub
                         
                        If FastSymbol(sss$, ";") Then
                            sbf(x1).locked = True
                            strX1 = " " + Str$(-x1)
                        Else
                            strX1 = Str$(x1)
                        End If
                        
                         If sbf(x1).sbgroup = here$ + "." Then
                                                If InStr(ThisGroup.FuncList, Chr$(2) + ss$ + "() ") = 0 Then
                                 ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + Str(x1) + Chr$(1) + ThisGroup.FuncList
        
                                            End If
                         Else
                        If sbf(x1).locked Then
                              ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + strX1 + Chr$(1) + ThisGroup.FuncList
                        Else
                              ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + strX1 + Chr$(1) + ThisGroup.FuncList
                              End If
                              sbf(x1).sbgroup = here$ + "."
                        End If
                      Else
                        x1 = 0
                       End If
                End If
                
       
                sss$ = NLtrim$(sss$) + " "
                While AscW(sss$) = 13
                    SetNextLine sss$
                    sss$ = NLtrim$(sss$) + " "
                Wend
                    If bstack.UseGroupname <> "" Or glob Then
                                here$ = vbNullString
                    Else
                            here$ = ohere$
                    End If
               
                s$ = sss$
              Else
              s$ = vbNullString
              
              End If
              Wend
              End If
                 End If
                End With
                With ThisGroup
              
                 .GroupName = what$ + "."
                 .FloatGroupName = myobject.FloatGroupName
              
              If myobject.HasStrValue Then
               If here$ = vbNullString Then
                                        ps2push = bstack.GroupName
                                        Else
                                        ps2push = here$ + "." + bstack.GroupName
                                        End If
                Mid$(ps2push, Len(ps2push), 1) = "$"
                GlobalVarRefLink ps2push, i, True
             End If
                .HasStrValue = myobject.HasStrValue
                .HasValue = myobject.HasValue
                .HasSet = myobject.HasSet
                .HasParameters = myobject.HasParameters
                .HasParametersSet = myobject.HasParametersSet
                
                  Set .Events = myobject.Events
                .highpriorityoper = myobject.highpriorityoper
                .HasUnary = myobject.HasUnary
                End With
            
            here$ = ohere$
             bstack.GroupName = oldgroupname$
End Sub
Sub UnFloatGroupReWriteVars(bstack As basetask, what$, i As Long, myobject As Object, Optional mergesuper As Boolean = False, Optional MakeNew As Boolean)
Dim ThisGroup As Group, ohere$
Set ThisGroup = var(i)
If myobject.IamApointer Then
'If Not TypeOf myobject Is Group Then Exit Sub
If ThisGroup.IamApointer Then Set var(i) = myobject: Exit Sub

  If myobject.link.IamFloatGroup Or ThisGroup.soros.Total = 0 Then
        
        Set var(i) = myobject
        Exit Sub
   ElseIf myobject.link.IamFloatGroup Then
   Set myobject = CopyGroupObj(myobject.link)

    Else  ' need to make a copy group using
        ohere$ = here$
        here$ = myobject.lasthere
       
        If GetVar(bstack, myobject.GroupName, i, , , True) Then
        
        CopyGroup2 myobject.link, bstack
        End If
        here$ = ohere$
        Set myobject = bstack.lastobj
        Set bstack.lastobj = Nothing
      '  UnFloatGroup bstack, what$, i, myobject
'Exit Sub
    End If

End If

If ThisGroup.IamApointer Then
 If ThisGroup.link.IamFloatGroup Then
    Set var(i).link = myobject
    Else
    Stop
End If
Exit Sub
End If
While Right$(what$, 1) = "."
what$ = Left$(what$, Len(what$) - 1)
Wend
If Trim$(what$) = vbNullString Then Exit Sub
If (myobject Is Nothing) Then Exit Sub
If Not TypeOf myobject Is Group Then Exit Sub
 Dim ps As mStiva, v As Long, s$, frm$, vvl As Variant, x1 As Long, ss$, frmarr$, sss$, j As Long
 Dim grtype As Variant, ps2push As String, TT As Long, ff$, uni As Boolean
 Set ps = var(i).soros
 Dim subgroup As Object, pppp As mArray
 Dim oldgroupname$, glob As Boolean
 ohere$ = here$
 glob = ThisGroup.IamGlobal
 uni = myobject.IamSuperClass
  If Not myobject.SuperClassList Is Nothing Then
  
 Set ThisGroup.SuperClassList = myobject.SuperClassList
 
  If myobject.IamSuperClass Then Set myobject = myobject.SuperClassList
 End If
If bstack.UseGroupname <> "" Or glob Then
    If Not glob Then
Else
here$ = vbNullString
End If

'If glob Then here$ = VbNullString
End If
 oldgroupname$ = bstack.GroupName
 
    If bstack.GroupName <> "" Then
  bstack.GroupName = bstack.GroupName & what$ & "."
  Else
  bstack.GroupName = what$ & "."
  End If
If myobject Is Nothing Then GoTo exithere1
             With myobject
             If Not .IamFloatGroup Then

             GoTo exithere1
             End If
                If .IamFloatGroup Then
                 .PeekItem 0, grtype
                 
                 .PeekItem 1, vvl
                    For x1 = 2 To 1 + vvl * 2 Step 2
                            .PeekItem x1, vvl    'here is the name
                    
                            
                            s$ = vvl
                            
                                   If here$ = vbNullString Then
                                        ps2push = bstack.GroupName + s$
                                        Else
                                        ps2push = here$ + "." + bstack.GroupName + s$
                                        End If
                            If uni Then
                            If Left$(s$, 1) = "@" Then
                            If mergesuper Then
                                    s$ = Mid$(s$, 2)
                                Else
                                GoTo cont1010
                            End If
                            End If
                            End If
                                 
                            
                            .PeekItem x1 + 1, vvl  'here is the value

                            If Typename(vvl) = myArray Then
                                            s$ = Left$(s$, Len(s$) - 1)
                                            ss$ = vbNullString
                                            If here$ = vbNullString And bstack.UseGroupname <> vbNullString Then
                                            If neoGetArrayLinkOnly(bstack, bstack.UseGroupname + s$, j) Then GoTo conthere1111
                                            
                                            End If
                                            If Not neoGetArrayLinkOnly(bstack, s$, j) Then  ''
                                            
                                            j = -1
                                                    Set subgroup = vvl
                                                    GlobalArr bstack, s$, ss$, 0, j
                                                    Set pppp = var(j)
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                            Else
conthere1111:
                                                    Set subgroup = vvl
                                                    Set pppp = var(j)
                                                    subgroup.CopyArray pppp
                                                    Set subgroup = Nothing
                                            End If
                                            TT = ps.Total
                                          
                                            ps.DataStrUn s$ + Str$(j)
                                    
                                            
                            ElseIf Typename(vvl) = "lambda" Then
                          
                             If GetVar1(bstack, bstack.GroupName & s$, v) And here$ = vbNullString Then
                             ElseIf Not GetVar1(bstack, s$, v) Then
                        
                             v = globalvar(bstack.GroupName & s$, 0)
                              If here$ = vbNullString Then
                                                GlobalSub bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(v), bstack.GroupName
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(v), here$ + "." + bstack.GroupName
                                            End If
                             End If
                             Set var(v) = vvl
                                
                              TT = ps.Total
                                 ps.DataStrUn s$ + Str(v)
                             
                            Else  ' is not array so...
                            '' drop *
                            If Asc(s$) = 42 Then s$ = Mid$(s$, 2)
                                  If GetVar1(bstack, bstack.GroupName & s$, v) Then ' And here$ = VbNullString
                                  ' this needed for "a<=b"  a copy to a global group
                                                ElseIf GetVar1(bstack, ps2push, v) Then
                                                ElseIf Not GetVar1(bstack, s$, v) Then
                                                        v = globalvar(bstack.GroupName & s$, 0)
                                            End If
                                            If Typename(vvl) = "Group" Then
                                                        Dim spare As Object
                                                        Set spare = vvl
                                                                    If Typename(var(v)) <> "Group" Then
                                                                                UnFloatGroup bstack, s$, v, spare, here$ = vbNullString, , MakeNew
                                                                    Else
                                                                                UnFloatGroupReWriteVars bstack, s$, v, spare, , MakeNew
                                                                    End If
                                           
                                                        Set spare = Nothing
                                                                  TT = ps.Total
                              
                                                         ps.DataStrUn "*" + s$ + Str(v)  'ps2push + Str(v)
                                            Else
                                                        If MyIsObject(vvl) Then
                                                        
                                                                    
                                                                    If Typename(vvl) = "mHandler" Then
                                                                    Set vvl = CopyHandlerObj(vvl)
                                                                    ElseIf Typename(vvl) = "mEvent" Then
                                                                    
                                                                    CopyEvent vvl, bstack
                                                                    Set vvl = bstack.lastobj
                                                                    Set bstack.lastobj = Nothing
                                                                    If here$ = vbNullString Then
                                                                           vvl.Upgrade bstack.GroupName
                                                                    Else
                                                                    vvl.Upgrade here$ + "." + bstack.GroupName
                                                                    End If
                                                                    End If
                                                                    Set var(v) = vvl
                                                                    
                                                        Else
                                                                    var(v) = vvl
                                                        End If

                                                         TT = ps.Total
                                                             ps.DataStrUn s$ + Str(v)  'ps2push + Str(v)
                                            End If
                                    '                 If Not TT = ps.Total Then
                                     '  End If

                            End If
cont1010:
                 Next x1
                End If
                If ohere$ = vbNullString Or glob Then
                                here$ = vbNullString
              Else
                                 here$ = ohere$
              End If
              
              .PeekItem x1, vvl
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
                   ExecuteGroupStruct bstack, what$, (i), s$, 1
              End If
                .PeekItem x1 + 1, vvl
              
              If Trim$(vvl) <> "" Then
              s$ = CStr(vvl)
           
                bstack.GroupName = vbNullString
              While s$ <> ""
                 ' If ohere$ = VbNullString Or bstack.UseGroupname <> "" Or glob Then
                 If ohere$ = vbNullString Or glob Then
               here$ = oldgroupname$ + what$
              Else
     here$ = ohere$ + "." + oldgroupname$ + what$
              End If
              
              ''Execute bstack, s$, (True)
   
        x1 = IsLabelA1("", s$, ss$)
             If x1 <> 0 Then
                sss$ = s$
                If Len(ss$) > 6 Then
                        x1 = IsLabelA1("", s$, ss$)
                        Dim strX1 As String
                        If MyFunction(-2 * (&H1FFF = AscW(ss$)), bstack, sss$, 1, True, MakeNew) Then '' >6 len for function
                        If Asc(s$) <> 32 Then
                        If InStr(s$, " ") = 2 Then
                        ss$ = ss$ + Left$(s$, 1)
                        s$ = Mid$(s$, 2)
                        Else
                        ss$ = ss$ + Left$(s$, 2)
                        s$ = Mid$(s$, 3)
                        End If
                        End If
                        x1 = bstack.IndexSub
                            sbf(x1).Changed = True
                         If FastSymbol(sss$, ";") Then
                            sbf(x1).locked = True
                            strX1 = " " + Str$(-x1)
                        Else
                            strX1 = Str$(x1)
                        End If
                     
                        If sbf(x1).sbgroup = here$ + "." Then
                        Else
                                              ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + "()" + strX1 + Chr$(1) + ThisGroup.FuncList
                                              sbf(x1).sbgroup = here$ + "."
                        End If
                                              
                        Else
                        x1 = 0
                         End If
                       
                      
                Else
                        x1 = IsLabelA1("", s$, ss$)
                        If MyModule(bstack, sss$, 1, True, MakeNew) Then
                         x1 = bstack.IndexSub
                         sbf(x1).Changed = True
                        If FastSymbol(sss$, ";") Then
                            sbf(x1).locked = True
                            strX1 = " " + Str$(-x1)
                        Else
                            strX1 = Str$(x1)
                        End If
                         If sbf(x1).sbgroup = here$ + "." Then
                         Else
                              ThisGroup.FuncList = Chr$(1) + Chr$(2) + ss$ + strX1 + Chr$(1) + ThisGroup.FuncList
                              sbf(x1).sbgroup = here$ + "."
                         End If
                      Else
                        x1 = 0
                       End If
                End If
                
       
                sss$ = NLtrim$(sss$) + " "
                While AscW(sss$) = 13
                    SetNextLine sss$
                    sss$ = NLtrim$(sss$) + " "
                Wend
                        If bstack.UseGroupname <> "" Or glob Then
                    here$ = vbNullString
                    Else
                                  here$ = ohere$
                    End If
               
                s$ = sss$
              Else
              s$ = vbNullString
              End If
              Wend

              End If
             
             ''\   .EndFloat
                   
                
                
                End With
                With ThisGroup
    
               .HasValue = myobject.HasValue Or .HasValue
                .HasSet = myobject.HasSet Or .HasValue
                .HasStrValue = myobject.HasStrValue Or .HasStrValue
                .HasParameters = myobject.HasParameters Or .HasParameters
                .HasParametersSet = myobject.HasParametersSet Or .HasParametersSet

                If Not myobject.Events Is Nothing Then
                    If .Events Is Nothing Then
                        Set .Events = myobject.Events
                    End If
                End If
                .highpriorityoper = MergeOperators(myobject.highpriorityoper, .highpriorityoper)
                .HasUnary = myobject.HasUnary Or .HasUnary
                End With
exithere1:
            here$ = ohere$
             bstack.GroupName = oldgroupname$

End Sub
Function ChangedFunctionList(ByVal s$) As Boolean
ChangedFunctionList = True
Exit Function
Dim c$, k$(), final As Long
Do While s$ <> "" And Not ChangedFunctionList
If ISSTRINGA(s$, c$) Then ChangedFunctionList = sbf(Abs(val(Split(c$, " ")(1)))).Changed
Loop

End Function


Function GetFunctionList(ByVal s$) As String
Dim c$, F$, k$(), qq$, final As Long, tmp$, oldl As Long, mtrim As Long
While s$ <> ""
If ISSTRINGA(s$, c$) Then
k$() = Split(c$, " ")
final = val(k$(1))
qq$ = sbf(Abs(final)).sb
If Left$(qq$, 10) = "'11001EDIT" Then
tmp$ = GetNextLine(qq$)
mtrim = MyTrimR(qq$)
oldl = Len(qq$)
If oldl > mtrim Then
qq$ = tmp$ + "-" + CStr(oldl - mtrim) + vbCrLf + MyTrim(qq$)
Else
qq$ = tmp$ + vbCrLf + NLtrim(qq$)
End If
End If
final = final < 0
'If qq$ <> "" Then
  '  If Right$(qq$, 2) <> vbCrLf Then qq$ = qq$ + vbCrLf
'End If
If Right$(k$(0), 1) = ")" Then

If final Then
F$ = "Function " + Mid$(k$(0), 2, Len(k$(0)) - 3) + " {" + qq$ + vbCrLf + "};" + F$
Else
F$ = "Function " + Mid$(k$(0), 2, Len(k$(0)) - 3) + " {" + qq$ + vbCrLf + "}" + F$
End If
Else
If final Then
F$ = "Module " + Mid$(k$(0), 2, Len(k$(0)) - 1) + " {" + qq$ + vbCrLf + "};" + F$
Else
F$ = "Module " + Mid$(k$(0), 2, Len(k$(0)) - 1) + " {" + qq$ + vbCrLf + "}" + F$
End If
End If
End If

Wend
GetFunctionList = F$
End Function

Sub MakeMyTitle(s$, Lang As Long)
     If InStr(s$, "(") > 0 Then
            If shortlang Then
            If Lang Then Form1.TEXT1.Title = "F. " + s$ + " F12 " Else Form1.TEXT1.Title = "Σ. " + s$ + " "
            Else
            If Lang Then Form1.TEXT1.Title = "Function " + s$ + " F12 " Else Form1.TEXT1.Title = "Συνάρτηση " + s$ + " "
            End If
            Else
            If shortlang Then
            If Lang Then Form1.TEXT1.Title = "M. " + s$ + " F12 " Else Form1.TEXT1.Title = "Τ. " + s$ + " "
            Else
            If Lang Then Form1.TEXT1.Title = "Module " + s$ + " F12 " Else Form1.TEXT1.Title = "Τμήμα " + s$ + " "
            End If
            End If
End Sub
Function SBcode(i As Long) As String
If i < 0 Then
SBcode = var(-i).code$
Else
SBcode = sbf(i).sb
End If
End Function
Function GlobalHandler(basestack As basetask, rest$, Lang As Long, typeHandler As Long) As Boolean
Dim x1 As Long, ss$, i As Long, s$, what$, par As Boolean
Do
x1 = Abs(IsLabel(basestack, rest$, what$))
If x1 <> 1 Then GlobalHandler = False: Exit Function
ss$ = here$
here$ = vbNullString

i = globalvar(basestack.GroupName & what$, s$, , True)
Select Case typeHandler
Case 1
MakeitObjectInventory var(i)
here$ = ss$
If FastSymbol(rest$, "=") Then
Set basestack.lastobj = var(i)
GlobalHandler = AddInventory(basestack, rest$)
Exit Function
End If
Case 2
MakeitObjectBuffer var(i)
here$ = ss$
Case 3
MakeitObjectInventory var(i), True
here$ = ss$
If FastSymbol(rest$, "=") Then
Set basestack.lastobj = var(i)
GlobalHandler = AddInventory(basestack, rest$)
Exit Function
End If

Case Else
here$ = ss$
End Select
Loop Until Not FastSymbol(rest$, ",")
If rest$ <> "" Then
If Not MaybeIsSymbol(rest$, ":" + vbCr) Then
SyntaxError
Else
GlobalHandler = True
End If
Else
GlobalHandler = True
End If

 


End Function
Function GlobalEVENT(basestack As basetask, rest$, Lang As Long) As Boolean
Dim x1 As Long, ss$, i As Long, s$, what$

x1 = Abs(IsLabel(basestack, rest$, what$))
If x1 <> 1 Then GlobalEVENT = False: Exit Function
ss$ = here$
here$ = vbNullString
i = globalvar(basestack.GroupName & what$, s$, , True)
MakeitObjectEvent var(i)
here$ = ss$
GlobalEVENT = ProcEvent(basestack, rest$, Lang, i)
 


End Function

Function GlobalMoveGroup(bstack As basetask, w$) As Boolean

Dim myobject As Object, r1 As Long, p As Variant
                           r1 = globalvar(w$, p)
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If r1 <> 0 Then
                                        
                                            If Typename(var(r1)) = "Group" Then
                                 
                                            UnFloatGroupReWriteVars bstack, w$, r1, myobject
                                            Else
                         
                                        UnFloatGroup bstack, w$, r1, myobject
                                                 ' global??
                                        Set myobject = Nothing
                                    
                                            End If
                                                         
                                            
                                        End If

End Function
Function dimString(typo$) As String
Dim pppp As mArray, PP, i As Long, p, lim As Long
Dim b$(), vl$
b$() = Split(typo$, " ")

Set pppp = var(val(b$(1)))
      pppp.SerialItem PP, CLng(p), 5
         Dim a$()
         If PP < 1 Then dimString$ = b$(0) + ")": Exit Function
         ReDim a$(PP - 1)
      For i = 0 To PP - 1
      pppp.GetDnum i, p, lim
      'pppp.SerialItem p, i, 6
      a$(i) = Trim$(Str$(-lim)) + " TO " + Trim$(Str$(p - lim - 1))
      Next i
      pppp.SerialItem p, CLng(0), 2
      If InStr(b$(0), "$") > 0 Then
      vl$ = "{" + CStr(p) + "} "
      Else
      If IsNumeric(p) Then
       vl$ = "=" + Str(p) + " "
       Else
       vl$ = "=0 "
      End If
      End If
      If PP > 1 Then
      dimString = b$(0) + Join(a$(), ",") + ")" + vl$
      Else
      dimString = b$(0) + a$(0) + ")" + vl$
      End If
End Function
Sub LogGroup(bstack As basetask, vvv As Long, ohere$, OvarnameLen As Long, lcl As Boolean, ByPass As Boolean, unique As Boolean)
If ByPass Then GoTo bye

'unique = False

'
Dim ss$, w$, i As Long, nm$, nt$, CM$, nt1$, j As Long, k As Long, dropit As Long
Dim s() As String
      With var(vvv)

  
        
        If here$ <> "" Then
        w$ = UCase(here$ & "." & ohere$ & ".")
        Else
        w$ = UCase(ohere$ & ".")
        End If
            If OvarnameLen <= varhash.count Then
                    
            For i = OvarnameLen To varhash.count  ' or not
            
                 varhash.ReadVar i - 1, ss$, dropit
                 
                If Left(ss$, Len(w$)) = w$ Then
                j = dropit
                    nt$ = Typename$(var(j))
                 If Not lcl Then
                                         If nt$ = "Group" Then
                                         If Right$(ss$, 1) <> "$" Then
                                         
                                        .soros.DataStr "*" + Mid$(ss$, Len(w$) + 1) + Str(j)
                                        Else
                                        
                                        End If
                                        Else
                                        If unique Then
                                        .soros.DataStr "@" + Mid$(ss$, Len(w$) + 1) + Str(j)
                                        Else
                                        .soros.DataStr Mid$(ss$, Len(w$) + 1) + Str(j)
                                        End If
                                       
                                        End If
                            Else
                             nm$ = Mid$(ss$, Len(w$) + 1)
                          
                                If nt1$ <> nt$ Then .LocalList = .LocalList + vbCrLf: CM$ = vbNullString
                           If i = OvarnameLen Then CM$ = "Local " Else CM$ = ", "
                           If nt$ = "Long" Then
                           If CM$ = "," Then nt1$ = vbNullString Else nt1$ = nt$ + " "
                           .LocalList = .LocalList + CM$ + nt1$ + nm$ + "=" + Trim$(Str(var(j)))
                           ElseIf nt$ = myArray Then
                            .LocalList = .LocalList + vbCrLf + "local DIM " + dimString(nm$ + Str$(j)) + vbCrLf
                           ElseIf nt$ = doc Then
                           If CM$ = "," Then nt1$ = vbNullString Else nt1$ = nt$ + " "
                           .LocalList = .LocalList + CM$ + nt1$ + nm$ + "=" + "{" + CStr(var(j)) + "}"
                           ElseIf InStr(nm$, "$") Then
                                .LocalList = .LocalList + CM$ + nm$ + "=" + "{" + CStr(var(j)) + "}"
                           Else
                                .LocalList = .LocalList + CM$ + nm$ + "=" + CStr(var(j))
                            End If
                            nt1$ = nt$
                End If
                End If
            Next i

            If lcl Then .LocalList = .LocalList + vbCrLf
            End If
        
           
           '
           

End With
bye:
OvarnameLen = varhash.count + 1 'Len(VarName$) + 1   'we record ...AGAIN

End Sub
Function FindNameForGroup(bstack As basetask, w$) As Boolean
Dim ss() As String, w2 As Long
  If InStr(w$, ChrW(&H1FFF)) > 0 Then
        If InStr(w$, ".") > 0 Then
        ss() = Split(w$, ".")
            If GetVar(bstack, ss(0), w2) Then
                If Typename(var(w2)) = "Group" Then
                   If var(w2).FloatGroupName <> "" Then ss(0) = var(w2).FloatGroupName: FindNameForGroup = True
                   w$ = Join(ss(), ".")
                            If InStr(w$, ChrW(&H1FFF)) > 0 Then
                             w$ = vbNullString
                            Else
                             FindNameForGroup = True
                             End If
                 Else
                 w$ = vbNullString
                End If
                                 Else
                 w$ = vbNullString
            End If
                             Else
                 w$ = vbNullString
    End If
    End If
End Function
Sub i3MouseIcon(basestack As basetask, rest$, Lang As Long)
On Error Resume Next
Dim Scr As Object, s$, x As Double, aPic As StdPicture
Set Scr = basestack.Owner

If Typename(basestack.Owner) Like "Gui*" Then
oxiforforms
ElseIf basestack.toprinter Then
    oxiforPrinter
Else
        If IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", Lang) Then
                If FastSymbol(rest$, "!") Or OperatingSystem > System_Windows_7 Then
                MouseShow False
                ElseIf basestack.tolayer > 0 Or basestack.toback Then
                            Scr.MouseIcon = Form1.Picture2.Picture
                            Scr.mousepointer = 99
                Else
                            If Not basestack.LastState Then
                                        basestack.LastState = True
                                        Scr.MouseIcon = Form1.Picture2.Picture
                                        Scr.mousepointer = 99
                            End If
                End If
        ElseIf IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", Lang) Then
                If FastSymbol(rest$, "!") Or OperatingSystem > System_Windows_7 Then
                MouseShow True
                ElseIf basestack.tolayer > 0 Or basestack.toback Then
                 Scr.mousepointer = 1
                          Set Scr.MouseIcon = Nothing
                           
                
                Else
                            If basestack.LastState Then
                                    basestack.LastState = False
                                    If basestack.LastMouse1 = 99 Then
                                          s$ = CFname(basestack.LastMouse2)
                                           Set aPic = LoadMyPicture(GetDosPath(s$))
                                            If aPic Is Nothing Then Exit Sub
                                          Scr.MouseIcon = aPic
                                    End If
                                    Scr.mousepointer = basestack.LastMouse1
                            End If
                End If
        ElseIf IsStrExp(basestack, rest$, s$) Then
                    
                If basestack.tolayer > 0 Or basestack.toback Then
                            If CFname(s$) <> "" Then
                                        s$ = CFname(s$)
                                       Set aPic = LoadMyPicture(GetDosPath(s$))
                                            If aPic Is Nothing Then Exit Sub
                                          Scr.MouseIcon = aPic
                            End If
                Else
                            If Not basestack.LastState Then
                                     s$ = CFname(s$)
                                              Set aPic = LoadMyPicture(GetDosPath(s$))
                                            If aPic Is Nothing Then Exit Sub
                                          Scr.MouseIcon = aPic
                                        Scr.mousepointer = 99
                            Else
                                        If CFname(s$) <> "" Then
                                                s$ = CFname(s$)
                                                basestack.LastMouse1 = 99
                                                basestack.LastMouse2 = s$
                                                If Not basestack.LastState Then
                                                 s$ = CFname(s$)
                                                        Set aPic = LoadMyPicture(GetDosPath(s$))
                                                             If aPic Is Nothing Then Exit Sub
                                                                Scr.MouseIcon = aPic
                                                                Scr.mousepointer = 99
                                                End If
                                        End If
                        End If
                End If
    ElseIf IsExp(basestack, rest$, x) Then
                basestack.LastState = False
                On Error Resume Next
                Scr.mousepointer = CLng(x)
                If Err Then MyEr "Bad icon bumber", "Πρόβλημα με τον αριθμό" Else basestack.LastMouse1 = CLng(x)
                Err.Clear
    Else
             MyEr "Missing  filename or icon number", "Λείπει όνομα αρχείου ή αριθμός εικονιδίου"
    End If
End If
End Sub
Function procTestMe(bstack As basetask, rest$, what$) As Boolean
Dim ss$
procTestMe = True

If Not Form1.Visible Then
newshow basestack1
k1 = 0
End If
If FastSymbol(rest$, "!") Then
untest:
If trace Then
With Form2
    If pagio$ = "GREEK" Then
    .gList2.HeadLine = "Έλεγχος"
    Else
    .gList2.HeadLine = "Control"
    End If
    If TestShowCode And here$ <> "" Then
        Form2.gList3(2).backcolor = &H606060
    Else
        Form2.gList3(2).backcolor = &H3B3B3B
        End If
    .label1(0) = vbNullString
    .label1(1) = vbNullString
    .label1(2) = vbNullString
    .Hide
     Set .Process = Nothing
     End With
 
STq = False
STEXIT = False
STbyST = False
trace = False
Exit Function
End If
End If
If bypassST Then GoTo bb1
    STq = False
    STEXIT = False
    STbyST = True
    Form2.Show , Form1

If here$ = vbNullString Then

 TestShowSub = vbNullString
 TestShowStart = 0
 Form2.testpad.Text = vbNullString
 Form2.testpad.Show
 Form2.testpad.SetRowColumn 1, 1
 
 End If
MyDoEvents
' gList2.HeadLine
 If bstack.IamLambda Then
  If pagio$ = "GREEK" Then
  Form2.label1(0) = "ΣΥΝΑΡΤΗΣΗ ΛΑΜΔΑ"
  Else
  Form2.label1(0) = "LAMBDA FUNCTION"
  End If
  Else
Form2.label1(0) = GetName$(here$)
End If
Form2.label1(1) = what$
Form2.label1(2) = GetStrUntil(vbCrLf, rest$ & vbCrLf, False)
Dim back$
bb1:
If ISSTRINGA(rest$, ss$) Then IsSymbol rest$, ","
If ss$ <> "" Then
With Form2
    If pagio$ = "GREEK" Then
        .gList2.HeadLine = "Έλεγχος: " + ss$
    Else
        .gList2.HeadLine = "Control: " + ss$
    End If
 If Not bypassST Then TestShowCode = True
End With

If TestShowCode And here$ <> "" Then

Form2.gList3(2).backcolor = &H606060
If Len(TestShowSub) >= WaitShow And WaitShow > 0 Then
        TestShowStart = rinstr(TestShowSub, Mid$(rest$, 2)) - 1
Else
    WaitShow = 0
    
    ss$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb))
    If Left$(ss$, 10) = "'11001EDIT" Then
    
    TestShowSub = Mid$(sbf(Abs(bstack.OriginalCode)).sb, Len(ss$) + 3)
    Else
         TestShowSub = ss$
    End If
    If bstack.addlen Then
        If Len(TestShowSub) - bstack.addlen > 0 Then
               TestShowStart = rinstr(Left$(TestShowSub, Len(TestShowSub) - bstack.addlen), Mid$(rest$, 2)) - 1
        Else
               TestShowStart = 1
        End If
     Else
        TestShowStart = rinstr(TestShowSub, Mid$(rest$, 2)) - 1
    End If
    
    End If
Else
 TestShowSub = vbNullString
 End If
 Set Form2.Process = bstack
stackshow bstack
MyDoEvents
Form1.Show , Form5
what$ = vbNullString
If IsLabelOnly((rest$), what$) = 1 Then
rest$ = ": " + rest$
If Not trace Then
trace = True

procTestMe = Execute(bstack, what$, True) = 1
GoTo untest
Else


End If
ElseIf what$ <> "" Then
com1020:
Dim m As Long, s$
Do
m = 1

 what$ = aheadstatus(rest$, , m)

 If m > 1 Then
 If Asc(LTrim(Left$(rest$, m))) < 32 Then Exit Do
 STq = True
 If s$ <> "" Then
 s$ = s$ + ", " + LTrim(Left$(rest$, m - 1))
 Else
s$ = s$ + LTrim(Left$(rest$, m - 1))
End If
Mid$(rest$, 1, m - 1) = Space$(m - 1)
STbyST = False
End If
If Not FastSymbol(rest$, ",") Then Exit Do
Loop Until m = 1
If Not Form2.Visible Then Form2.Show , Form1
Form2.Compute.vartext = s$
rest$ = NLtrim(rest$)
trace = True


TestShowCode = False
Form2.gList4.ListIndex = 1
End If

Else
If IsLabelOnly((rest$), what$) = 1 Then
TestShowCode = True
rest$ = ": " + rest$
trace = True
 Set Form2.Process = bstack
stackshow bstack
MyDoEvents
Form1.Show , Form5
Else
GoTo com1020
End If

End If

End Function
Function procMotionW(bstack As basetask, rest$) As Boolean
Dim x As Double, y As Double, myform As GuiM2000, where As Long
If TypeOf bstack.Owner Is GuiM2000 Then
procMotionW = True
Set myform = bstack.Owner
where = FindFormSScreen(myform)
  If Not IsExp(bstack, rest$, x) Then x = myform.Left
    If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, y) Then procMotionW = False: Exit Function
        Else
        
        y = myform.Top
    End If
    If FastSymbol(rest$, ";") Then
    x = ((ScrInfo(where).Width - 1) - myform.Width) / 2 + ScrInfo(where).Left
    y = ((ScrInfo(where).Height - 1) - myform.Height) / 2 + ScrInfo(where).Top
    If x < ScrInfo(where).Left Then x = ScrInfo(where).Left
    If y < ScrInfo(where).Top Then y = ScrInfo(where).Top
    End If
    
myform.Move x, y

Else
'If Not Form1.Visible Then Exit Function
procMotionW = True
'Form1.Visible = True
'If Form3.Visible Then Form3.skiptimer = True: Form3.WindowState = 0
Console = FindFormSScreen(Form1)

If Form1.WindowState <> 0 Then Form1.WindowState = 0 ': mydoevents
If IsWine Then Sleep 50: Form1.SetFocus

If Form1.WindowState = 0 Then
    If Not IsExp(bstack, rest$, x) Then x = Form1.Left
    If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, y) Then procMotionW = False: Exit Function
        Else
        
        y = Form1.Top
    End If
    
    If FastSymbol(rest$, ";") Then
    x = ((ScrInfo(Console).Width - 1) - Form1.Width) / 2 + ScrInfo(Console).Left
    y = ((ScrInfo(Console).Height - 1) - Form1.Height) / 2 + ScrInfo(Console).Top
    End If
' LETS MOVE

If IsWine And Form1.Width = ScrInfo(Console).Width Then Form1.Width = ScrInfo(Console).Width - dv15
If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
If IsWine Then
If x = ScrInfo(Console).Left And y = ScrInfo(Console).Top Then
Form1.Move x, y
If form5iamloaded Then Form5.RestorePos
Sleep 10
End If
End If
Form1.Move x, y
If form5iamloaded Then Form5.RestorePos
Console = FindFormSScreen(Form1)
    If FastSymbol(rest$, ";") Then
    x = ((ScrInfo(Console).Width - 1) - Form1.Width) / 2 + ScrInfo(Console).Left
    y = ((ScrInfo(Console).Height - 1) - Form1.Height) / 2 + ScrInfo(Console).Top
    If x < ScrInfo(where).Left Then x = ScrInfo(where).Left
    If y < ScrInfo(where).Top Then y = ScrInfo(where).Top
    If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
    Form1.Move x, y
    End If
Form1.Up
If IsWine Then Sleep 10
End If
End If
End Function
Function procLineSpace(bstack As basetask, rest$) As Boolean
Dim x As Double
procLineSpace = True
If IsExp(bstack, rest$, x) Then

    If CLng(x) < 0 Or CLng(x) > 60 * dv15 Then
    OutOfLimit
    Else
    x = (x \ 30) * 60
    x = CLng(x) / 2
    
   SetText bstack.Owner, CLng(x)
    
    End If
ElseIf FastSymbol(rest$, "!") Then
   SetText bstack.Owner, 4 * Screen.TwipsPerPixelY
Else
MissNumExpr
procLineSpace = False

Exit Function
End If


End Function

Function ProcLabel(basestack As basetask, rest$) As Boolean
Dim s$, frm$, p As Variant, x As Double, y As Double, sX As Double, sY As Double
Dim Scr As Object, prive As basket
Set Scr = basestack.Owner
prive = players(GetCode(Scr))
ProcLabel = True
If Not IsStrExp(basestack, rest$, s$) Then Exit Function


frm$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))
s$ = vbNullString
x = 0
If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, s$) Then
    If TypeOf Scr Is GuiM2000 Then
    s$ = Scr.Controls(1).FontName
    Else
    s$ = prive.FontName
    End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, x) Then
         If TypeOf Scr Is GuiM2000 Then
         x = Scr.Controls(1).FontSize
         Else
            x = prive.SZ
        End If
        End If
        
            y = 0
            
                If FastSymbol(rest$, ",") Then
                    If Not IsExp(basestack, rest$, p) Then p = 0
                  If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, sY) Then
                        nPlain basestack, frm$, s$, x, y, CLng(p), True, CLng(sY \ DXP)
                    Else
                        nPlain basestack, frm$, s$, x, y, CLng(-p - 1)
                    End If
                 Else
                    nPlain basestack, frm$, s$, x, y, CLng(-p - 1)
                 End If
                Else
                    nPlain basestack, frm$, s$, x, y, -1
                End If
    Else
        nPlain basestack, frm$, s$, x, 0, -1
    End If
Else
nPlain basestack, frm$, prive.FontName, prive.SZ, x, -1
End If
PlaceBasket Scr, prive
End Function
Function ProcLegend(basestack As basetask, rest$) As Boolean
Dim s$, frm$, p As Variant, x As Double, y As Double, sX As Double, sY As Double
Dim Scr As Object, prive As basket
Set Scr = basestack.Owner
prive = players(GetCode(Scr))
ProcLegend = True
If FastSymbol(rest$, "!") Then
ProcLegend = False
If IsStrExp(basestack, rest$, s$) Then
      If InStr(s$, ChrW(&HFFFFF8FB)) > 0 Then s$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))

    ProcLegend = True
    If Not FastSymbol(rest$, ",") Then ProcLegend = False: Exit Function
    If IsExp(basestack, rest$, p) Then
    x = p
    If Not FastSymbol(rest$, ",") Then
    y = 1
    ElseIf Not IsExp(basestack, rest$, y) Then
       ProcLegend = False: Exit Function
    End If
    Else
    x = prive.mx
    If Not FastSymbol(rest$, ",") Then ProcLegend = False: Exit Function
    If Not IsExp(basestack, rest$, y) Then ProcLegend = False: Exit Function
    End If
    wPlain Scr, prive, s$, (x), y - 1
End If
Else
If Not IsStrExp(basestack, rest$, s$) Then Exit Function


frm$ = Replace(s$, ChrW(&HFFFFF8FB), ChrW(&H2007))
s$ = vbNullString
x = 0
If FastSymbol(rest$, ",") Then
If Not IsStrExp(basestack, rest$, s$) Then Exit Function
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, x) Then Exit Function
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, y) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, p) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, sX) Then Exit Function
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, sY) Then Exit Function
nPlain basestack, frm$, s$, x, y, CLng(p), sX <> False, CLng(sY \ DXP)
Else
nPlain basestack, frm$, s$, x, y, CLng(p), sX <> False
End If
Else
nPlain basestack, frm$, s$, x, y, CLng(p)
End If
Else
nPlain basestack, frm$, s$, x, y
End If
Else

nPlain basestack, frm$, s$, x
End If
End If
If FastSymbol(rest$, ";") Then
''NO REFRESH
Else
If Not extreme Then If Not basestack.toprinter Then MyDoEvents1 Scr
End If
PlaceBasket Scr, prive
End Function

Function ProcText(basestack As basetask, isHtml As Boolean, rest$) As Boolean
Dim x1 As Long, frm$, pa$, s$
ProcText = True
If IsSymbol(rest$, "UTF-8", 5) Then
x1 = 2
ElseIf IsSymbol(rest$, "UTF-16", 6) Then
x1 = 0 ' only little endian (but if something convert it to big we can read...)
Else
x1 = 3
End If

s$ = vbNullString
If Not IsStrExp(basestack, rest$, s$) Then
If Not Abs(IsLabelOnly(rest$, s$)) = 1 Then
    ProcText = False
    Exit Function
End If
End If
FastSymbol rest$, ","
If s$ <> "" Then

If FastSymbol(rest$, "+") Then pa$ = vbNullString Else pa$ = "new"
If FastSymbol(rest$, "{") Then frm$ = NLtrim$(blockString(rest$, 125))
If frm$ <> "" Then
If isHtml Then
If ExtractType(s$) = vbNullString Then s$ = s$ & ".html"
End If
 textPUT basestack, mylcasefILE(s$), frm$, pa$, x1
Else
 textDel (mylcasefILE(s$))
 ProcText = True
 Exit Function
End If
ProcText = FastSymbol(rest$, "}")
End If
Exit Function

End Function
Function ProcPrinting(basestack As basetask, rest$, Lang As Long) As Boolean
Dim xp As Printer, Scr As Object
Set Scr = basestack.Owner
  ProcPrinting = True
 If ThereIsAPrinter = False Then Exit Function
If IsLabelSymbolNew(rest$, "ΝΑΙ", "ON", Lang) And pname <> "" And Not basestack.toprinter Then
                            basestack.toprinter = True
                            For Each xp In Printers
                            If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
                            Next xp
                            getfirstpage
                            Set Scr = Form1.PrinterDocument1
                            If players(-2).Xt = 0 Then
                            players(-2) = players(0)  'COPY dis
                            With players(-2)
                                .curpos = 0
                                .currow = 0
                                .XGRAPH = 0
                                .YGRAPH = 0
                            End With
                            End If
                            PlaceBasket Form1.PrinterDocument1, players(-2)
                            SetText Form1.PrinterDocument1
                            ''SetTextSZ scr, players(0).SZ
                            LCTbasket Form1.PrinterDocument1, players(-2), 0, 0
                            Printer.CurrentX = 0
                            Printer.CurrentY = 0
ElseIf IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", Lang) And basestack.toprinter Then
                    getenddoc
                    Set Scr = Form1.DIS
                    basestack.toprinter = False
                    SetNormal Scr
ElseIf IsLabelSymbolNew(rest$, "ΔΙΕΚΟΨΕ", "BREAK", Lang) And basestack.toprinter Then
                    pnum = 0
                    oprinter.ClearUp
                    Form1.PrinterDocument1.Picture = LoadPicture("")
                    Set Scr = Form1.DIS
                    basestack.toprinter = False
                    SetNormal Scr
                    Else
                    ProcPrinting = False
                    End If
Exit Function


End Function

Function ProcPrinter(basestack As basetask, rest$) As Boolean
Dim xp As Printer, i As Long, p As Variant, x1 As Long, y1 As Long, x As Double, y As Double
Dim s$, ss$, frm$, F As Long, pa$, sX As Double, it As Long, ya As Long, AddTwipsTopL As Long
Dim Scr As Object
ProcPrinter = True
Set Scr = basestack.Owner
If basestack.toprinter Then Exit Function
 If ThereIsAPrinter = False Then Exit Function
If FastSymbol(rest$, "!") Then
olamazi
If ThereIsAPrinter Then
For Each xp In Printers
If xp.DeviceName = pname Then
Set Printer = xp
Exit For
End If
Next xp

If ShowProperties(Form1, Printer.DeviceName, MyDM()) Then
MyDoEvents
PrinterDim pw, ph, psw, psh, pwox, phoy
End If
End If
Exit Function
End If
If FastSymbol(rest$, "+") Then
Form1.List1.Clear
For Each xp In Printers
Form1.List1.additemFast xp.DeviceName & " (" & xp.port & ")"
Next xp
For i = 0 To Form1.List1.listcount - 1
If pname & " (" & port & ")" = Form1.List1.list(i) Then Form1.List1.ListIndex = i
Next i
Exit Function
ElseIf FastSymbol(rest$, "?") Then
Form1.List1.Clear
For Each xp In Printers
Form1.List1.additemFast xp.DeviceName & " (" & xp.port & ")"
Next xp
For i = 0 To Form1.List1.listcount - 1
If pname & " (" & port & ")" = Form1.List1.list(i) Then Form1.List1.ListIndex = i
Next i
Execute basestack, "menu !", True
If CDbl(Form1.List1.ListIndex + 1) > 0 Then
i = InStr(Form1.List1.ListValue, " (")
pname = Left$(Form1.List1.ListValue, i - 1)
port = Mid$(Form1.List1.ListValue, i + 2, InStr(i + 2, Form1.List1.ListValue, ")") - i - 2)
End If
For Each xp In Printers
If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
Next xp
ReDim MyDM(1 To 1) As Byte
Exit Function
End If
getfirstpage
If Not IsExp(basestack, rest$, p) Then p = players(-2).SZ / szFactor

If FastSymbol(rest$, ",") Then
If IsStrExp(basestack, rest$, s$) Then
For Each xp In Printers
If xp.DeviceName & " (" & xp.port & ")" = s$ Then
pname = xp.DeviceName
port = xp.port
Set Printer = xp
ReDim MyDM(1 To 1) As Byte
If FastSymbol(rest$, ",") Then
If IsStrExp(basestack, rest$, ss$) Then
If ss$ <> "" Then
LoadArray MyDM(), ss$
End If
End If
Exit For
End If
End If
Next xp

Exit Function
End If
End If
If FastSymbol(rest$, "{") Then
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
 If ThereIsAPrinter = False Then Exit Function
If pname = vbNullString Then Exit Function
For Each xp In Printers
If xp.DeviceName = pname And xp.port = port Then Set Printer = xp
Next xp
getfirstpage

If players(-2).Xt = 0 Then

players(-2) = players(0)  'COPY dis
With players(-2)
players(-2).curpos = 0
players(-2).currow = 0
If p = 0 Then p = .SZ
szFactor = mydpi * dv15 / 1440#
.SZ = CSng(p * szFactor)
End With
PlaceBasket Form1.PrinterDocument1, players(-2)
SetText Form1.PrinterDocument1

Else
SetTextSZ Form1.PrinterDocument1, CSng(p * mydpi * dv15 / 1440)

LCTbasket Form1.PrinterDocument1, players(-2), 0, 0
'realfactor = CSng(players(-2).SZ) / prFactor / p
End If

With Printer   ' for no specific reason..I have to think it again
.CurrentX = 0
.CurrentY = 0
End With
basestack.toprinter = True
it = Execute(basestack, ss$, False)
If Not basestack.toprinter Then
pnum = 0
oprinter.ClearUp
Form1.PrinterDocument1.Picture = LoadPicture("")
Else
getenddoc
End If
basestack.toprinter = False
Set Scr = basestack.Owner
If it = 0 Then
If Trim(ss$) = vbNullString Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$
ProcPrinter = False
End If
End If
Else
PlainBaSket Scr, players(GetCode(Scr)), pname & " (" & port & ")"
crNew basestack, players(GetCode(Scr))
End If
Exit Function
End Function

Function ProcLayer(basestack As basetask, rest$) As Boolean
Dim xp As Printer, i As Long, p As Variant, x1 As Long, y1 As Long, x As Double, y As Double
Dim s$, ss$, frm$, F As Long, pa$, sX As Double, it As Long, w3 As Long, ya As Long, AddTwipsTopL As Long
Dim Scr As Object, scr1 As GuiM2000
Dim prive As basket
ProcLayer = True
Set Scr = basestack.Owner
prive = players(GetCode(Scr))  ' backup
If Not IsExp(basestack, rest$, p) Then
prive = players(0)
p = 0 ' dis
Set basestack.lastobj = Nothing
End If
If basestack.lastobj Is Nothing Then
If p > 32 Or p < 0 Then p = 0 ' dis
Else
If Typename(basestack.lastobj) = "mHandler" Then
    i = basestack.lastobj.indirect
    If i >= 0 And i <= var2used Then
        If Typename(var(i)) = "GuiM2000" Then
            Set scr1 = var(i)
            p = GetCode(scr1)
        End If
    End If
ElseIf Typename(basestack.lastobj) = "GuiM2000" Then
    Set scr1 = basestack.lastobj
    p = GetCode(scr1)

End If
End If
Set basestack.lastobj = Nothing
w3 = basestack.tolayer
basestack.tolayer = CLng(p)


If FastSymbol(rest$, "{") Then
If p > 32 Then
jumphere:
    If players(p).MAXXGRAPH = 0 Then
        SetTextBasketBack scr1, players(0)
        SetText scr1, prive.MineLineSpace, True
        With players(p)
        .italics = False
        .bold = False
        .curpos = 0
        .currow = 0
        .mysplit = 0
        .osplit = 0
        .XGRAPH = 0
        .YGRAPH = 0
        .lastprint = True
        .Paper = Form1.DIS.backcolor
        .mypen = players(0).mypen
        End With
        With Prefresh(p)
        .k1 = uintnew(timeGetTime + REFRESHRATE): .RRCOUNTER = 1
        End With
        scr1.backcolor = Form1.DIS.backcolor
        scr1.CurrentX = 0
        scr1.CurrentY = 0
     End If
ElseIf p > 0 Then
F = FindSpriteByTag(CLng(p))
If F = 0 Then

    F = GetNewLayerObj(CLng(p), Scr.Width, Scr.Height)
    SetTextBasketBack Form1.dSprite(F), prive   ' load form prive to dSprite
         With players(p)
        Form1.dSprite(F).Font.Italic = .italics
        Form1.dSprite(F).Font.bold = .bold
        End With
    SetText Form1.dSprite(F), prive.MineLineSpace, True    'load Players() with first values
    With players(p)
    .curpos = 0
    .currow = 0
    .mysplit = 0
    .osplit = 0
    .Paper = Form1.DIS.backcolor
    .mypen = players(0).mypen
    End With
    With Prefresh(p)
        .k1 = uintnew(timeGetTime + REFRESHRATE): .RRCOUNTER = 1
        End With
    Form1.dSprite(F).backcolor = Form1.DIS.backcolor
End If

p = F
End If
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
If p = 0 Then
Set basestack.Owner = Form1.DIS
ElseIf p < 33 Then
Set basestack.Owner = Form1.dSprite(p)
Else
Set basestack.Owner = scr1
End If

it = Execute(basestack, ss$, False)

MyDoEvents2 basestack.Owner
GdiFlush
basestack.tolayer = w3
Set basestack.Owner = Scr

If it = 0 Then
If Trim(ss$) = vbNullString Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$
ProcLayer = False
End If
End If
End If



End Function
Function MakeForm(basestack As basetask, rest$) As Boolean
On Error Resume Next
MakeForm = True
Dim Scr As Object, XX As Single, p As Variant, x1 As Long, y1 As Long, x As Double, y As Double
Dim w3 As Long, W4 As Long, sX As Double, adjustlinespace As Boolean, SZ As Single
Dim monitor As Long

Set Scr = basestack.Owner
'monitor = FindFormSScreen(scr)

Dim basketcode As Long, mAddTwipsTop As Long


If Typename(Scr) Like "Gui*" Then
If Typename(Scr) Like "GuiM2000" Then GoTo there1
ElseIf Scr.name = "Form1" Then

Else
there1:
basketcode = GetCode(Scr)
'If players(basketcode).double Then SetNormal scr
With players(basketcode)
SetNormal Scr
mAddTwipsTop = .uMineLineSpace  ' the basic

If IsExp(basestack, rest$, p) Then
    If p < 10 Then p = 10
    x = 4
    XX = 4
    If Scr.name = "DIS" Then
    Do
    y = CDbl(XX)
    XX = CSng(x)
    nForm basestack, XX, w3, W4, mAddTwipsTop  'using line spacing
    If XX > CSng(x) Then x = CDbl(XX)
    
    If Form1.Width < w3 * p Then Exit Do
    x = x + 0.25
    Loop
 
    
    Else
    Do
    
    y = CDbl(XX)
    XX = CSng(x)

    nForm basestack, XX, w3, W4, mAddTwipsTop  'using line spacing
    If XX > CSng(x) Then x = CDbl(XX)
    
    If Scr.Width < w3 * p Then Exit Do
    
    x = x + 0.4
    Loop
    End If
    x = y
    sX = 0
   
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, sX) Then
        '' ok
        
       mAddTwipsTop = 0  ' find a new one
       players(basketcode).MineLineSpace = 0
       players(basketcode).uMineLineSpace = 0
        adjustlinespace = True
    ''    mmx = scr.Width
''mmy = scr.Height
        Else
        MakeForm = False
        MissNumExpr
        Set Scr = Nothing
        Exit Function
        End If
   
End If
If FastSymbol(rest$, ";") And Scr.name = "DIS" Then
adjustlinespace = False
If IsWine Then
    Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top, ScrInfo(Console).Width - 1, ScrInfo(Console).Height - 1
Else
    Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top, ScrInfo(Console).Width, ScrInfo(Console).Height
End If
    Form1.backcolor = players(-1).Paper
    
Sleep 1
End If
nForm basestack, CSng(x), w3, W4, 0
Dim mmx As Long, mmy As Long
If sX = 0 Then
SZ = CSng(x)
mmx = Scr.Width
 If Scr.name = "DIS" Then
 mmy = CLng(mmx * Form1.Height / Form1.Width) ' WHY 3/4 ??
 Else
 mmy = Scr.Width
 End If
 players(basketcode).MineLineSpace = mAddTwipsTop
 players(basketcode).uMineLineSpace = mAddTwipsTop
FrameText Scr, SZ, CLng(w3 * p), mmy, players(basketcode).Paper
Else
If Scr.name = "DIS" Then
If (sX * W4) > Form1.Height Then
y = Form1.Height
While sX * W4 > Form1.Height

XX = y / (dv20 * sX)

nForm basestack, XX, w3, W4, 0  'using no spacing so we put a lot of lines
x = CDbl(XX)
y = y * 0.9
Wend


End If
Else
If sX * W4 > Scr.Height Then
y = Scr.Height
Do While sX * W4 > Scr.Height

XX = y / (dv20 * sX)
nForm basestack, XX, w3, W4, 0  'using no spacing so we put a lot of lines
If x = CDbl(XX) Then Exit Do
x = CDbl(XX)
y = y * 0.9
Loop


End If

End If
If Scr.name = "DIS" Then
If Not adjustlinespace Then If Scr.Height >= Form1.Height - dv15 Then mAddTwipsTop = dv15 * (((Scr.Height - sX * W4) / sX / 2) \ dv15)
End If
nForm basestack, (x), w3, W4, mAddTwipsTop
SZ = CSng(x)
'If mmx < scr.Width Then
mmx = Scr.Width


'If mmx < scr.Width Then
mmy = Scr.Height
If adjustlinespace Then
If Scr.name = "DIS" Then
mAddTwipsTop = dv15 * (((Form1.Height - sX * W4) / sX / 2) \ dv15)

Else
mAddTwipsTop = dv15 * (((Scr.Height - sX * W4) / sX / 2) \ dv15)
End If
sX = CLng(sX * (W4 + mAddTwipsTop * 2))
Else
sX = CLng(sX * W4)
End If
players(basketcode).MineLineSpace = mAddTwipsTop
players(basketcode).uMineLineSpace = mAddTwipsTop
FrameText Scr, SZ, CLng(w3 * p), CLng(sX), players(basketcode).Paper, Not (Scr.name = "DIS")

End If


ElseIf FastSymbol(rest$, ";") And Scr.name = "DIS" Then



If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
If IsWine Then
         Form1.Width = ScrInfo(Console).Width - 1
         Form1.Height = ScrInfo(Console).Height
         Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top
Else
        Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top, ScrInfo(Console).Width, ScrInfo(Console).Height
    
End If
Form1.backcolor = players(-1).Paper
Form1.Cls
With players(-1)
        .mysplit = 0
        .MAXXGRAPH = Form1.Width
        .MAXYGRAPH = Form2.Height
        SetText Form1
        End With
MyMode Scr
ElseIf Scr.name = "DIS" Then

w3 = Form1.Left + Scr.Left
W4 = Form1.Top + Scr.Top
If IsWine And Form1.Width = ScrInfo(Console).Width Then Form1.Width = ScrInfo(Console).Width - dv15
If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top: W4 = Form1.Top + Scr.Top
scrMove00 Scr
If IsWine Then
    If Scr.Width = ScrInfo(Console).Width Then
       Form1.Width = Scr.Width - 1
    Else
        Form1.Width = Scr.Width
    End If
    Form1.Height = Scr.Height
    Form1.Move w3, W4
Else
    Form1.Move w3, W4, Scr.Width, Scr.Height
End If
Form1.Cls
        With players(-1)
        .mysplit = 0
        .MAXXGRAPH = Form1.Width
        .MAXYGRAPH = Form2.Height
        SetText Form1
        End With
SetText Scr

Set Scr = Nothing
Exit Function
Else
'' CROP LAYER
If basketcode > 0 Then
With players(basketcode)
.MAXXGRAPH = .mx * .Xt
.MAXYGRAPH = .My * .Yt
End With
With Form1.dSprite(basestack.tolayer)
.Move .Left, .Top, players(basketcode).MAXXGRAPH, players(basketcode).MAXYGRAPH
End With

End If
End If

players(basketcode).MineLineSpace = mAddTwipsTop
players(basketcode).uMineLineSpace = mAddTwipsTop
MakeForm = True
.curpos = 0
.currow = 0

End With
End If
SetText Scr


End Function
Function ProcAbout(basestack As basetask, rest$, Lang As Long) As Boolean

Dim par As Boolean, s$, ss$, x As Double, y As Double, i As Long
Dim kk As New Document
Dim UAddPixelsTop As Long  ' just not used
If IsLabelSymbolNewExp(rest$, "ΔΕΙΞΕ", "SHOW", Lang, ss$) Then
If lastAboutHTitle <> "" Then abt = True: vH_title$ = vbNullString
If IsStrExp(basestack, rest$, ss$) Then
    feedback$ = ss$
feednow$ = FeedbackExec$
CallGlobal feednow$
Else
    vHelp
 End If
ProcAbout = True
Exit Function
ElseIf FastSymbol(rest$, "!") Then
'*******
vH_title$ = vbNullString
par = True
par = par And IsStrExp(basestack, rest$, s$)

If par Then
If s$ = vbNullString Then
mHelp = False
abt = False
lastAboutHTitle = vbNullString
sHelp "", "", 0, 0
GoTo conthere
Else
par = par And FastSymbol(rest$, ",")
par = par And IsExp(basestack, rest$, x)
par = par And FastSymbol(rest$, ",")
par = par And IsExp(basestack, rest$, y)
par = par And FastSymbol(rest$, ",")
par = par And IsStrExp(basestack, rest$, ss$)
If par Then
abt = True
kk.EmptyDoc
kk.textDoc = ReplaceSpace(s$)
s$ = kk.textFormat(vbCrLf)
kk.EmptyDoc
kk.textDoc = ReplaceSpace(s$)
s$ = kk.TextParagraph(1)
kk.EmptyDoc
kk.textDoc = ReplaceSpace(ss$)
' save to
lastAboutHTitle = s$
LastAboutText = kk.textFormat(vbCrLf)
sHelp lastAboutHTitle, LastAboutText, CLng(x), CLng(y)
End If
End If
End If
'*******
ElseIf IsLabelSymbolNew(rest$, "ΚΑΛΕΣΕ", "CALL", Lang) Then
mHelp = True
abt = True
If IsStrExp(basestack, rest$, ss$) Then

kk.textDoc = ReplaceSpace(ss$)
FeedbackExec$ = kk.textFormat(vbCrLf)
End If
Else
If IsStrExp(basestack, rest$, s$) Then
mHelp = True
If s$ = vbNullString Then
If Lang = 0 Then
lastAboutHTitle = "Βοήθεια Εφαρμογής"
LastAboutText = vbNullString
Else
lastAboutHTitle = "Application Help"
LastAboutText = vbNullString
End If
GoTo conthere
End If
kk.EmptyDoc
kk.textDoc = ReplaceSpace(s$)
s$ = kk.textFormat(vbCrLf)
kk.EmptyDoc
kk.textDoc = ReplaceSpace(s$)
s$ = kk.TextParagraph(1)

        i = 0
       
        x = (ScrInfo(Console).Width - 1) * 2 / 5
        y = (ScrInfo(Console).Height - 1) / 7
        vH_title$ = s$
        If FastSymbol(rest$, ",") Then
                par = True
                    If Not IsExp(basestack, rest$, x) Then
                    x = (ScrInfo(Console).Width - 1) * 2 / 5: par = False
                    Else
                    i = 1
                    End If
                    If FastSymbol(rest$, ",") Then
                        par = True
                        If Not IsExp(basestack, rest$, y) Then
                        y = (ScrInfo(Console).Height - 1) / 7: par = False
                        Else
                        i = 2
                        End If
                    End If
        End If

        If Not Form4.Visible Then
        Helplastfactor = 1
       helpSizeDialog = 1
           vH_x = CLng(x * Helplastfactor)
           vH_y = CLng(y * Helplastfactor)
           
                Form4.Show , Form1
                
                myform Form4, ScrInfo(Console).Width - CLng(x * Helplastfactor), ScrInfo(Console).Height - CLng(y * Helplastfactor), CLng(x * Helplastfactor), CLng(y * Helplastfactor), True, 1  'Helplastfactor
                  MoveFormToOtherMonitorOnly Form4, True
                HelpLastWidth = x
        ElseIf i <> 0 Then
                Form4.Show , Form1
                myform Form4, Form4.Left, Form4.Top, CLng(x * Helplastfactor), CLng(y * Helplastfactor), True, Helplastfactor
                MoveFormToOtherMonitorOnly Form4, True
                
        End If
       
        Form4.Line (0, 0)-(Form4.ScaleWidth - dv15, Form4.ScaleHeight - dv15), Form4.backcolor, BF
        Form4.moveMe
        If FastSymbol(rest$, ",") Or Not par Then
        If IsStrExp(basestack, rest$, ss$) Then
        kk.EmptyDoc
        kk.textDoc = ReplaceSpace(ss$)
        Form4.label1.Text = kk.textFormat(vbCrLf)
        End If
        End If
        
With Form4.label1

.EditDoc = False
.NoMark = True
.enabled = True
.NewTitle s$, 4 + UAddPixelsTop
.glistN.DragEnabled = False
.glistN.WordCharLeft = "["
.glistN.WordCharRight = "]"
.glistN.WordCharRightButIncluded = vbNullString
End With
Else
conthere:
'vH_title$ = vbNullString
If Not (basestack.IamChild Or basestack.IamAnEvent) Then
abt = False
End If
If Form4.Visible Then
Form4.Visible = False
If Form1.Visible Then
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
    End If
End If
Helplastfactor = 1
helpSizeDialog = 1

Unload Form4
End If
End If
Exit Function
End Function
Sub procthreads(Scr As Object, bstack As basetask, rest$, Lang As Long)
If TaskMaster Is Nothing Then Exit Sub
If TaskMaster.QueueCount >= 0 Then

If IsLabelSymbolNew(rest$, "ΣΒΗΣΕ", "ERASE", Lang) Then
TaskMaster.Dispose
bstack.ThrowThreads
Exit Sub
End If
If Lang = 0 Then
        PlainBaSket Scr, players(GetCode(Scr)), "NHMATA ΣΕ ΕΠΕΞΕΡΓΑΣΙΑ:" & CStr(TaskMaster.QueueCount)
        Else
        PlainBaSket Scr, players(GetCode(Scr)), "THREADS PROCESSING:" & CStr(TaskMaster.QueueCount)
        End If
        If bstack.ThreadsStr(Lang) <> "" Then
        crNew bstack, players(GetCode(Scr))
        PlainBaSket Scr, players(GetCode(Scr)), bstack.ThreadsStr(Lang)
        End If
Else
        If Lang = 0 Then
        PlainBaSket Scr, players(GetCode(Scr)), "ΤΙΠΟΤΑ ΣΕ ΕΠΕΞΕΡΓΑΣΙΑ"
        Else
        PlainBaSket Scr, players(GetCode(Scr)), "NOTHING PROCESSING"
        End If
End If
crNew bstack, players(GetCode(Scr))
' was mydoevents 2
MyDoEvents1 Scr
Set Scr = Nothing
End Sub
Function ProcPage(basestack As basetask, rest$, Lang As Long) As Boolean
ProcPage = True
Dim Scr As Object, x As Double
Set Scr = basestack.Owner
If basestack.toprinter Then
getnextpage
If IsNumber(basestack, rest$, x) Then
If x = 1 Then Portrait basestack Else Landscape basestack
End If
ElseIf IsNumber(basestack, rest$, x) Then
If x = 1 Then Portrait basestack Else Landscape basestack
Else
ClearScr Scr, mycolor(PaperOne)
End If
Set Scr = Nothing
End Function

Function ProcMotion(basestack As basetask, rest$, Lang As Long) As Boolean
Dim Scr As Object, x1 As Long, y1 As Long, p As Variant
Set Scr = basestack.Owner
ProcMotion = True
If Lang = 1 And IsLabelSymbolLatin(rest$, "CENTER") Then
ProcMotion = ProcMode(basestack, Str$(players(GetCode(Scr)).SZ) & "," & Str$(Scr.Width) & "," & Str$(Scr.Height))
ElseIf IsLabelSymbol(rest$, "ΚΕΝΤΡΟ") Then
ProcMotion = ProcMode(basestack, Str$(players(GetCode(Scr)).SZ) & "," & Str$(Scr.Width) & "," & Str$(Scr.Height))
Else
If IsExp(basestack, rest$, p) Then x1 = CLng(p) Else x1 = Scr.Left
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
y1 = CLng(p)
Else
Set Scr = Nothing
ProcMotion = False
Exit Function
End If
Else
y1 = Scr.Top
End If
Scr.Move x1, y1
End If
 MyDoEvents1 Scr
Set Scr = Nothing


End Function


Function ProcCls(basestack As basetask, rest$) As Boolean
'If basestack.toprinter Then Exit Function
Dim Scr As Object, p As Variant
 ProcCls = True
Set Scr = basestack.Owner

With players(GetCode(Scr))
If Not IsExp(basestack, rest$, p) Then
p = -.Paper
Else
.Paper = mycolor(p)
End If



If FastSymbol(rest$, ",") Then
    If IsExp(basestack, rest$, p) Then
    If Not basestack.toprinter Then
    If p < 0 Then p = .My + p
        .mysplit = MyRound(p)
        If .mysplit >= .My Then .mysplit = 0: .pageframe = 0
        .pageframe = Int((.My - .mysplit) * 2 / 3)

    End If
        Else
        ProcCls = False
        Set Scr = Nothing
        Exit Function
    End If
End If
If basestack.toprinter Then
If oprinter.Height > 0 Then
oprinter.Cls CLng(mycolor(.Paper))
oprinter.PaintPicture Form1.PrinterDocument1.hDC
.curpos = 0
.currow = .mysplit
.lastprint = False
Scr.CurrentX = 0
Scr.CurrentY = 0
End If
Else
ClearScrNew Scr, players(GetCode(Scr)), CLng(mycolor(.Paper))
End If
If Form4.Visible Then
If Not mHelp And Not abt Then vHelp
End If
End With
Set Scr = Nothing
End Function

Function ProcPen(basestack As basetask, rest$) As Boolean
Dim Scr As Object, x1 As Long, y1 As Long, p As Variant, ss$, it As Long
ProcPen = True
Set Scr = basestack.Owner
If IsExp(basestack, rest$, p) Then
    If FastSymbol(rest$, "{") Then
        ss$ = "{" & block(rest$) & "}"
        If FastSymbol(rest$, "}") Then
         y1 = GetCode(Scr)
            x1 = players(y1).mypen
           
            players(y1).mypen = CLng(mycolor(p))
            TextColor Scr, players(y1).mypen
            Call executeblock(it, basestack, ss$, False, False)

            players(y1).mypen = x1
            TextColor Scr, x1
            If it <> 1 Then ProcPen = False: rest$ = Left$(ss$, Len(ss$) - 1) + rest$
        End If
    Else
    
        players(GetCode(Scr)).mypen = CLng(mycolor(p))
        
        TextColor Scr, CLng(mycolor(p))
    End If
Else
    ProcPen = False
End If
Set Scr = Nothing
End Function
Function ProcMedia(basestack As basetask, rest$, Lang As Long) As Boolean
Dim Scr As Object
Dim s$, ss$, x As Double, y As Double
Set Scr = basestack.Owner
On Error Resume Next
ProcMedia = True
If IsLabelSymbolNew(rest$, "ΦΟΡΤΩΣΕ", "LOAD", Lang) Then
            If AVIUP Then
                  AVI.GETLOST
                  MyDoEvents
            End If
            If IsStrExp(basestack, rest$, s$) Then
                If s$ <> "" Then
                    If ExtractType(s$) = vbNullString Then s$ = s$ & ".avi"
                    If CFname(s$) = vbNullString Then
                        s$ = mcd & s$: If CFname(s$) = vbNullString Then Exit Function
                    Else
                        s$ = CFname(s$)
                    End If
                Else
                    Set Scr = Nothing
                    ProcMedia = True  ' ??????????
                    Exit Function
                End If
                avifile = s$
                Load AVI
                
                MediaPlayer1.playMovie
                MediaPlayer1.pauseMovie
                
                MediaPlayer1.setPositionTo 0
                Sleep 2
                MyDoEvents
                AVIRUN = False
                    If Form1.Visible Then Form1.SetFocus
                    MediaPlayer1.setLeftVolume vol * 10
                    MediaPlayer1.setRightVolume vol * 10
                    
                
            End If
            Set Scr = Nothing
            ProcMedia = True
            Exit Function
            
    ElseIf AVIUP Then
    ss$ = vbNullString
        If IsLabelSymbolNewExp(rest$, "ΔΕΙΞΕ", "SHOW", Lang, ss$) Then
            'If Not AVIRUN Then MediaPlayer1.playMovie: MediaPlayer1.pauseMovie
            If Scr.name = "GuiM2000" Then
            If Scr.Visible Then
                AVI.Show , Scr
      End If
                Set Scr = Nothing
                ProcMedia = True
                Exit Function
           
                
            Else
                If Form1.Visible Then
                AVI.Show , Form1
                Else
                AVI.Show , Form5
                End If
               
                AVI.ZOrder 0
             AVI.SetFocus
                MyDoEvents
                Set Scr = Nothing
                ProcMedia = True
                Exit Function
       End If
        ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΥΨΕ", "HIDE", Lang, ss$) Then
                AVI.Hide
                Set Scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΑΤΗΣΕ", "PAUSE", Lang, ss$) Then
                If MediaPlayer1.isMoviePlaying Then MediaPlayer1.pauseMovie
                Set Scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΠΑΙΞΕ", "PLAY", Lang, ss$) Then
        
                If Not AVIRUN Then
                AVI.Timer1.Interval = MediaPlayer1.getLengthInMS - MediaPlayer1.getPositionInMS
                AVI.Avi2Up
                End If
        
                MyDoEvents
                Set Scr = Nothing
                ProcMedia = True
                Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΞΕΚΙΝΑ", "RESTART", Lang, ss$) Then
                    If Not MediaPlayer1.isMoviePlaying Then
                    
                         MediaPlayer1.playMovie
                         
                    Else
                         MediaPlayer1.resumeMovie
                    End If
                    MyDoEvents
                    AVIRUN = False
                    Set Scr = Nothing
                    ProcMedia = True
                    Exit Function
        ElseIf IsLabelSymbolNewExp(rest$, "ΣΤΟ", "TO", Lang, ss$) Then
                    If IsExp(basestack, rest$, x) Then
                        If MediaPlayer1.getLengthInMS > 0 Then MediaPlayer1.setPositionTo x
                        
                    End If
                    Set Scr = Nothing
                    ProcMedia = True
                    Exit Function

        End If
    End If
    ss$ = vbNullString
' do nothing until here
If IsExp(basestack, rest$, x) Then
   
            If FastSymbol(rest$, ",") Then
    
             UseAviSize = False
    AviSizeX = 0
    AviSizeY = 0
    aviX = 0
    aviY = 0
    UseAviSize = False
    UseAviXY = True: aviX = CLng(x): aviY = 0
            If IsExp(basestack, rest$, y) Then aviY = CLng(y) Else ProcMedia = False: UseAviXY = False: aviX = 0
            Else ' SPECIAL
            If MediaPlayer1.getLengthInMS > 0 Then
                If x < 0 Then
                MediaPlayer1.pauseMovie
                AVIRUN = MediaPlayer1.isMoviePlaying
                If Scr.name <> "Printer" Then
                If Scr.Visible Then Scr.SetFocus
                End If
                ElseIf x = 0 Then
                          
                MediaPlayer1.playMovie
                MyDoEvents
                Else
                MediaPlayer1.setPositionTo x
                End If
                ProcMedia = True
        Else
        ProcMedia = False
        End If
        Set Scr = Nothing
        Exit Function
            End If
            If aviX = 0 Then UseAviXY = False
            If FastSymbol(rest$, ",") Then
                    If IsExp(basestack, rest$, x) Then AviSizeX = CLng(x) Else rest$ = "," & rest$
                If FastSymbol(rest$, ",") Then
            If IsExp(basestack, rest$, x) Then AviSizeY = CLng(x) Else rest$ = "," & rest$
                End If
                UseAviSize = (Abs(AviSizeY) + Abs(AviSizeX)) <> 0 Or (aviX = 0 And aviY = 0)
                
            End If
            If Not FastSymbol(rest$, ",") Then
                   If AVIUP Then
                   If UseAviXY And UseAviSize Then
                   AVI.Move aviX, aviY, AviSizeX, AviSizeY
                   MediaPlayer1.sizeLocateMovie 0, 0, Form1.ScaleX(AviSizeX, vbTwips, vbPixels), Form1.ScaleY(AviSizeY, vbTwips, vbPixels) + 1
                   ElseIf UseAviXY Then
                   AVI.Move aviX, aviY
                    MediaPlayer1.sizeLocateMovie 0, 0, Form1.ScaleX(AviSizeX, vbTwips, vbPixels), Form1.ScaleY(AviSizeY, vbTwips, vbPixels) + 1
                    ElseIf UseAviSize Then
                     AVI.Move AVI.Left, AVI.Top, AviSizeX, AviSizeY
                   MediaPlayer1.sizeLocateMovie 0, 0, Form1.ScaleX(AviSizeX, vbTwips, vbPixels), Form1.ScaleY(AviSizeY, vbTwips, vbPixels) + 1
                    End If
           Else
                   If AVIRUN Or AVIUP Then
                AVI.GETLOST
            End If
           
            End If
            Set Scr = Nothing
            Exit Function
            
            End If
      
ElseIf FastSymbol(rest$, ";") Then
'MediaPlayer1.closeMovie
    UseAviXY = False
    UseAviSize = False
    AviSizeX = 0
    AviSizeY = 0
    aviX = 0
    aviY = 0
    AVI.GETLOST
Else
 
'MediaPlayer1.closeMovie
If AVIRUN Or AVIUP Then
                AVI.GETLOST
              
            End If
  
End If

Do
ProcTask2 basestack

 If Not MediaPlayer1.isMoviePlaying Then AVIRUN = False
Loop Until Not AVIRUN Or NOEXECUTION

Do While IsStrExp(basestack, rest$, s$)
If s$ <> "" Then
If ExtractType(s$) = vbNullString Then s$ = s$ & ".avi"
    If CFname(s$) = vbNullString Then
        s$ = mcd & s$: If CFname(s$) = vbNullString Then Set Scr = Nothing: Exit Function

    Else
        s$ = CFname(s$)
    End If
    Else
    AVI.GETLOST
    Exit Do
End If
avifile = s$
Load AVI
AVI.Avi2Up
AVI.Show
Sleep 5

If AVIRUN Then
If Form1.Visible Then Form1.SetFocus
MediaPlayer1.setLeftVolume vol * 10
MediaPlayer1.setRightVolume vol * 10

End If
If FastSymbol(rest$, ",") Then
If AVIRUN Then
Do
 AVIRUN = MediaPlayer1.isMoviePlaying
 ProcTask2 basestack
' sleep 5

Loop Until AVIRUN = False Or NOEXECUTION
End If
Else
If FastSymbol(rest$, ";") Then
If AVIRUN Then
Do
 AVIRUN = MediaPlayer1.isMoviePlaying
ProcTask2 basestack
 ' sleep 5

Loop Until AVIRUN = False Or NOEXECUTION
End If
End If
Exit Do
End If
Loop
Set Scr = Nothing
Exit Function


End Function
Sub ProcUsers(bstack As basetask)
Dim aDir As New recDir, ss$, a$, b$, n As Integer
aDir.IncludedFolders = True
aDir.Nofiles = True
aDir.TopFolder = GetSpecialfolder(CLng(26)) & "\M2000_USER\"
aDir.LevelStop = 1
aDir.SortType = 1

b$ = GetSpecialfolder(CLng(26)) & "\M2000_USER\"
n = Len(b$) + 2
a$ = Tcase(Mid$(mylcasefILE$(aDir.Dir2$(b$, "", False)), n))
b$ = vbNullString
While a$ <> ""
If InStr(a$, " ") > 0 Then a$ = "[" + Replace(a$, " ", ChrW(160)) + "]"
b$ = a$

a$ = Tcase(Mid$(aDir.Dir2, n))
If a$ <> "" Then ss$ = ss$ + b$ + ", "
Wend
If b$ <> "" Then ss$ = ss$ + b$
Dim Scr As Object, prive As Long
Set Scr = Form1.DIS 'bstack.Owner
prive = GetCode(Scr)
wwPlain bstack, players(prive), ss$, Scr.Width, 1000, True, , 3
End Sub
Function ProcCat(bstack As basetask, rest$, Lang As Long) As Boolean
Dim aDir As New recDir, ss$, s$, pa$, frm$, par As Boolean, i As Long, col As Long
aDir.IncludedFolders = True
aDir.Nofiles = True
aDir.TopFolder = mcd
aDir.LevelStop = 1
aDir.SortType = Abs(FastSymbol(rest$, "!")) + Abs(FastSymbol(rest$, "!"))
ProcCat = True
s$ = vbNullString
pa$ = vbNullString

par = Lang = 1
i = FastSymbol(rest$, "+")
If FastSymbol(rest$, "*") Then
ss$ = "*"
ElseIf Not IsStrExp(bstack, rest$, ss$) Then
ss$ = vbNullString
Else
ss$ = myUcase$(ss$)
End If
''stac1 = VbNullString

If InStr(ss$, "?") > 0 Or InStr(ss$, "*") > 0 Then
aDir.Pattern = ss$
frm$ = mylcasefILE$(aDir.Dir2$(mcd, "", False))

Else
frm$ = mylcasefILE$(aDir.Dir2$(mcd, ss$, False))

End If

If i = False Then
    If frm$ <> "" Then
        If par Then
            pa$ = "Folders " & ss$ & ": "
        Else
            pa$ = "Κατάλογοι " & ss$ & ": "
        End If
    End If
End If
ss$ = vbNullString
col = Len(mcd)
Do While frm$ <> ""
MyDoEvents
s$ = Mid$(frm$, col + 2)
If s$ <> "" Then
If i Then
Form1.List1.additem s$
Else
If InStr(s$, " ") > 0 Then s$ = Chr(34) + s$ + Chr(34)
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
End If
End If
s$ = aDir.Dir2
If s$ <> "" Then frm$ = s$ Else frm$ = vbNullString
Loop
If i = False Then RepPlain bstack, bstack.Owner, pa$ + ss$

End Function
Function ProcImage(bstack As basetask, rest$, Lang As Long) As Boolean
Dim photo As cDIBSection, pppp As mArray, s$, x1 As Long, y1 As Long, w$, it As Long, p As Variant, part As Boolean, border As Long, titl$
Dim aPic As StdPicture, s1$, usecolorback As Boolean, ihavepic As Boolean, mem As MemBlock
ProcImage = True
part = IsLabelSymbolNew(rest$, "ΠΛΑΙΣΙΟ", "FRAME", Lang)
If IsStrExp(bstack, rest$, s$) Then
    ihavepic = Left$(s$, 4) = "cDIB" And Len(s$) > 12
    GoTo cont1
ElseIf IsExp(bstack, rest$, p) Then
    If Not bstack.lastobj Is Nothing Then
        If TypeOf bstack.lastobj Is mHandler Then
            If bstack.lastobj.t1 = 2 Then
                Set mem = bstack.lastobj.objref
                Set bstack.lastobj = Nothing
                x1 = -1
                If FastSymbol(rest$, "(") Then
                    If Not IsExp(bstack, rest$, p) Then MissNumExpr: Exit Function
                    x1 = 0
                    If Not FastSymbol(rest$, ")", True) Then Exit Function
                End If
                If x1 Then
                    Set aPic = mem.GetStdPicture(, , mycolor(p))
                Else
                    Set aPic = mem.GetStdPicture(, , mycolor(p))
                End If
                Set bstack.lastobj = Nothing
                GoTo cont1
            End If
        End If
    End If
    Set bstack.lastobj = Nothing
errNoImage:
    MyEr "No Image found", "Δεν βρήκα εικόνα"
    Exit Function
cont1:
    x1 = 0
    y1 = 0
    If aPic Is Nothing Then If Not ihavepic Then If ExtractType(s$) = vbNullString Then s$ = s$ + ".bmp"
    If part Then
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = p
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p Else ProcImage = False: MissNumExpr: Exit Function
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then border = p Else ProcImage = False: MissNumExpr: Exit Function
        If FastSymbol(rest$, ",") Then If Not IsStrExp(bstack, rest$, titl$) Then ProcImage = False: MissStringExpr: Exit Function
        If Not aPic Is Nothing Then
            Set photo = New cDIBSection
            photo.CreateFromPicture aPic
            photo.GetDpi 96, 96
            If photo.Width = 0 Then
                Set photo = Nothing
                MissCdib
                ProcImage = False: Exit Function
            End If
            If photo.bitsPerPixel <> 24 Then Conv24 photo
            ThumbImageDib bstack.Owner, x1, y1, photo, border, dv15, titl$
            Set photo = Nothing
        ElseIf Not ihavepic Then
            Set photo = New cDIBSection
            If CFname(s$) <> "" Then
                s$ = CFname(s$)
                Set aPic = LoadMyPicture(GetDosPath(s$))
                If aPic Is Nothing Then Exit Function
                photo.CreateFromPicture aPic
                photo.GetDpi 96, 96
                If photo.Width = 0 Then
                    Set photo = Nothing
                    MissCdib
                    ProcImage = False: Exit Function
                End If
                CheckOrientation photo, s$
                If photo.bitsPerPixel <> 24 Then Conv24 photo
                ThumbImageDib bstack.Owner, x1, y1, photo, border, dv15, titl$
                Set photo = Nothing
            End If
        Else
           ThumbImage bstack.Owner, x1, y1, s$, border, dv15, titl$
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
        If CFname(s$) <> "" Or ihavepic Or Not aPic Is Nothing Then
            Select Case Abs(IsLabel(bstack, rest$, w$))
            Case 3
                If GetVar(bstack, w$, it) Then
                    If FastSymbol(rest$, "(") Then
                        If IsExp(bstack, rest$, p) Then usecolorback = True
                        If Not FastSymbol(rest$, ")", True) Then ProcImage = False: Exit Function
                    End If
                    Set photo = New cDIBSection
                    If Not ihavepic Or aPic Is Nothing Then
                        s$ = CFname(s$)
                        Set aPic = LoadMyPicture(s$, usecolorback, mycolor(p))
                    End If
                    If Not aPic Is Nothing Then
                        If aPic.Type = vbPicTypeIcon Then photo.backcolor = bstack.Owner.backcolor
                        photo.CreateFromPicture aPic
                        photo.GetDpi 96, 96
                        If photo.Width = 0 Then
                            Set photo = Nothing
                            MissCdib
                            ProcImage = False: Exit Function
                        End If
                        CheckOrientation photo, s$
                        If photo.bitsPerPixel <> 24 Then Conv24 photo
                    ElseIf Not cDib(s$, photo) Then
                        Set photo = Nothing
                        ProcImage = False
                        MyEr "No Image Found", "Δεν βρήκε εικόνα"
                        Exit Function
                    End If
                    x1 = photo.Width
                    y1 = photo.Height
                    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = x1 * p / 100#: y1 = y1 * p / 100#
                    If FastSymbol(rest$, ",") Then
                        If IsExp(bstack, rest$, p) Then
                            y1 = photo.Height * p / 100#
                        Else
                            Set photo = Nothing
                            ProcImage = False: MissNumExpr: Exit Function
                        End If
                    End If
                    If photo.Width > 0 Then
                        Set photo = photo.Resample(Abs(y1), Abs(x1))
                        var(it) = DIBtoSTR(photo)
                    Else
                        var(it) = vbNullString
                    End If
                    Set photo = Nothing
                Else
                    ProcImage = False
                    If w$ <> "" Then
                        Nosuchvariable w$
                    Else
                        MissingStrVar
                    End If
                End If
                Exit Function
            Case 6
    ' ΑΠΟ ΠΙΝΑΚΑ
                Dim W5 As Long
                If neoGetArray(bstack, w$, pppp) Then
                    If Not NeoGetArrayItem(pppp, bstack, w$, W5, rest$) Then ProcImage = False: MissNumExpr: Exit Function
                    If MyIsObject(pppp.item(W5)) Then
                        MyEr "can't copy image to " + Typename(pppp.item(W5)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W5))
                        ProcImage = False
                        Exit Function
                    End If
                    If FastSymbol(rest$, "(") Then
                        If IsExp(bstack, rest$, p) Then usecolorback = True
                        If Not FastSymbol(rest$, ")", True) Then ProcImage = False: Exit Function
                    End If
                    Set photo = New cDIBSection
                    If Not ihavepic Or aPic Is Nothing Then
                        s$ = CFname(s$)
                        Set aPic = LoadMyPicture(s$, usecolorback, mycolor(p))
                    End If
                    If Not aPic Is Nothing Then
                        If aPic.Type = vbPicTypeIcon Then photo.backcolor = bstack.Owner.backcolor
                        photo.CreateFromPicture aPic
                        photo.GetDpi 96, 96
                        If photo.Width = 0 Then
                            Set photo = Nothing
                            MissCdib
                            ProcImage = False: Exit Function
                        End If
                        CheckOrientation photo, s$
                        If photo.bitsPerPixel <> 24 Then Conv24 photo
                    ElseIf Not cDib(s$, photo) Then
                            Set photo = Nothing
                            MissCdibStr
                            Exit Function
                    End If
                    x1 = photo.Width
                    y1 = photo.Height
                    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = x1 * p / 100#: y1 = y1 * p / 100#
                    If FastSymbol(rest$, ",") Then
                        If IsExp(bstack, rest$, p) Then
                            y1 = photo.Height * p / 100#
                        Else
                            Set photo = Nothing
                         ProcImage = False: MissNumExpr: Exit Function
                        End If
                    End If
                    If photo.Width > 0 Then
                        Set photo = photo.Resample(y1, x1)
                        If MyIsObject(pppp.item(W5)) Then
                            MyEr "can't copy image to " + Typename(pppp.item(W5)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W5))
                            ProcImage = False
                        Else
                            pppp.item(W5) = DIBtoSTR(photo)
                        End If
                    End If
                    Set photo = Nothing
                    Exit Function
                Else
                     ProcImage = False: MissingArray w$: Exit Function
                End If
            End Select
        Else
            MyEr "missing file, or image in string or in buffer", "λείπει αρχείο ή εικόνα σε αλφαριθμητικό ή σε διάρθρωση μνήμης"
            ProcImage = False
            Exit Function
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΕΞΑΓΩΓΗ", "EXPORT", Lang) Then
        If IsStrExp(bstack, rest$, w$) Then
            If Not CanKillFile(w$) Then FilePathNotForUser:  Exit Function
            Set photo = New cDIBSection
            If Not ihavepic And Not aPic Is Nothing Then
                 MyEr "No found Image in String or Buffer", "Δεν βρήκα εικόνα σε αλφαριθμητικό ή σε διάρθρωση μνήμης"
                 ProcImage = False
                 Exit Function
            ElseIf aPic Is Nothing Then
                If cDib(s$, photo) Then
cont4:
                    If FastSymbol(rest$, ",") Then
                        If IsExp(bstack, rest$, p) Then
                            x1 = (Abs(p) - 1) Mod 100 + 1
                            s$ = ""
                            If FastSymbol(rest$, ",") Then If Not IsStrExp(bstack, rest$, s$) Then MissStringExpr: ProcImage = False: Exit Function
                            SaveJPG photo, ExtractPath(w$) + ExtractNameOnly(w$) & ".jpg", x1, s$
                        Else
                            Set photo = Nothing
                            ProcImage = False: MissNumExpr: Exit Function
                        End If
                    Else
                        photo.SaveDib ExtractPath(w$) + ExtractNameOnly(w$) & ".bmp"
                    End If
                Else
                 MyEr "No Proper Image in String", "Δεν βρήκα κατάλληλη εικόνα σε αλφαριθμητικό"
                 ProcImage = False
                 Exit Function
                End If
            Else
                photo.backcolor = &HFFFFFF
                photo.CreateFromPicture aPic
                photo.GetDpi 96, 96
                If photo.Width = 0 Then
                    Set photo = Nothing
                    MissCdib
                    ProcImage = False: Exit Function
                End If
                If photo.bitsPerPixel <> 24 Then Conv24 photo
                GoTo cont4
            End If
            Set photo = Nothing
            Exit Function
        Else
             ProcImage = False: MyEr "Missing Filename", "Δεν βρήκα όνομα αρχείου": Exit Function
        End If
ElseIf mem Is Nothing Then
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = p
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p Else ProcImage = False: MissNumExpr: Exit Function
    SImage bstack.Owner, x1, y1, s$
Else
    Dim d1 As Object
    Set d1 = bstack.Owner
    x1 = 0
    y1 = 0
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x1 = Abs(p)
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = Abs(p) Else ProcImage = False: MissNumExpr: Exit Function
    If x1 = 0 Then x1 = -1 Else x1 = d1.ScaleX(x1, 1, 3)
    If y1 = 0 Then y1 = -1 Else y1 = d1.ScaleY(y1, 1, 3)
    With players(GetCode(d1))
        mem.DrawImageToHdc d1, .XGRAPH \ dv15, .YGRAPH \ dv15, x1, y1
    End With
End If
End If
End Function
Function ProcField(bstack As basetask, rest$, Lang As Long) As Boolean
Dim prive As Long, pppp As mArray, s$, it As Long, x As Double, y As Double, p As Variant
Dim i As Long, x1 As Long, y1 As Long, what$, par As Boolean
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
ProcField = True
 prive = GetCode(bstack.Owner)
  With players(prive)
        If IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", Lang) Then
            If IsExp(bstack, rest$, p) Then Result = p Else Result = 0
            Exit Function
        End If
        If IsLabelSymbolNew(rest$, "ΣΥΝΘΗΜΑ", "PASSWORD", Lang) Then i = True
    
        If Not IsExp(bstack, rest$, x) Then x = .curpos
        If Not FastSymbol(rest$, ",") Then Exit Function
        If Not IsExp(bstack, rest$, y) Then y = .currow
        If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, p) Then Exit Function
        p = MyRound(p)
        End If
        If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then Exit Function
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 3
            par = False
            If Not GetVar(bstack, what$, it) Then it = globalvar(what$, String$(CLng(p), 32))
            s$ = var(it)
        Case 6
                 par = True
                If neoGetArray(bstack, what$, pppp) Then If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                s$ = pppp.item(it)
        Case Else
        Exit Function
        End Select
        If p = 0 And s$ = vbNullString Then Exit Function
        If p = 0 Then p = Len(s$)
        s$ = Left$(s$, p)
        s$ = s$ & String$(p - Len(s$), " ")
        x1 = 1
        
        s$ = gf(bstack, y, x, s$, x1, y1, CBool(i))
        
        
        If y1 <> 99 Then
        LCTbasket bstack.Owner, players(prive), y + 1, 0
        End If
        Result = y1
        If par Then
                If Typename(pppp.item(it)) = doc Then
            Set pppp.item(it) = New Document
            If s$ <> "" Then pppp.item(it).textDoc = s$
            Else
            pppp.item(it) = s$
            End If
        Else
        CheckVar var(it), s$
        End If
        Exit Function
End With
End Function
Function ProcFiles(bstack As basetask, rest$, Lang As Long) As Boolean
Dim aDir As New recDir, ss$, pa$, s$, par As Boolean, stac1 As String, frm$, i As Long
Dim addext As Boolean, addpath As Boolean, p As Variant
ProcFiles = True
aDir.IncludedFolders = False
aDir.Nofiles = False
aDir.TopFolder = mcd
aDir.SortType = Abs(FastSymbol(rest$, "!")) + Abs(FastSymbol(rest$, "!"))

s$ = vbNullString
pa$ = vbNullString

par = Lang = 1
i = FastSymbol(rest$, "+")
If FastSymbol(rest$, "*") Then
ss$ = "*"
ElseIf Not IsStrExp(bstack, rest$, ss$) Then
ss$ = "TXT"
Else
ss$ = myUcase$(ss$)
End If
stac1 = vbNullString
If FastSymbol(rest$, ",") Then
' SEARCH INSIDE FILE
If Not IsStrExp(bstack, rest$, stac1$) Then
If Not IsExp(bstack, rest$, p) Then
SyntaxError: Exit Function
Else
Select Case p
Case 1
addext = True
Case 2
addext = True
addpath = True
Case Else
MyEr "Not defined yet", "δεν έχει οριστεί ακόμα"
ProcFiles = False
Exit Function
End Select
End If
End If
End If
If i <> 0 Then addpath = False
If InStr(ss$, "?") > 0 Or InStr(ss$, "*") > 0 Then
aDir.Pattern = ss$
frm$ = mylcasefILE$(aDir.Dir2$(mcd, "", False))
'frm$ = mylcasefILE$(Dir(mcd + mylcasefILE(sS$)))
Else
frm$ = mylcasefILE$(aDir.Dir2$(mcd, ss$, False))
'frm$ = mylcasefILE$(Dir(mcd & "*." & sS$))
End If

If i = False Then
    If frm$ <> "" Then
        If par Then
            If stac1 <> "" Then
            pa$ = "Files " & Replace(ss$, "|", ", ") & " with text " & Chr(34) + stac1 + Chr(34) & " :  "
            Else
            pa$ = "Files " & Replace(ss$, "|", ", ") & ": "
            End If
        Else
            If stac1 <> "" Then
            pa$ = "Αρχεία " & Replace(ss$, "|", ", ") & " με κείμενο " & Chr(34) + stac1 + Chr(34) & " :  "
            
            Else
            pa$ = "Αρχεία " & Replace(ss$, "|", ", ") & ": "
            End If
        End If
    End If
Else
   ' Form1.List2.clear
End If
If InStr(ss$, "|") > 0 Then addext = True
ss$ = vbNullString
Do While frm$ <> ""
MyDoEvents
If NOEXECUTION Then Exit Do
If Right$(" " & aDir.Pattern, 1) <> "*" And InStr(" " & aDir.Pattern, "|") = 0 Then
    If addext Then
        If addpath Then
            s$ = Included(mcd + frm$, stac1)
            If s$ <> "" Then s$ = mcd + s$
        Else
            s$ = ExtractName(Included(mcd + frm$, stac1))
        End If
    Else
        s$ = ExtractNameOnly(Included(mcd + frm$, stac1))
    End If
Else
If addpath Then
            s$ = Included(mcd + frm$, stac1)
            If s$ <> "" Then s$ = mcd + s$
Else
   s$ = Included(mcd + frm$, stac1)
   End If
End If
If s$ <> "" Then
If i Then
If Right$(" " & aDir.Pattern, 1) <> "*" Then
Form1.List1.additem s$
Else
Form1.List1.additem s$
End If
Else

If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
End If
End If
s$ = aDir.Dir2
If s$ <> "" Then frm$ = s$ Else frm$ = vbNullString
Loop
If i = False Then
RepPlain bstack, bstack.Owner, pa$ + ss$
End If
End Function

Function ProcEdit(basestack As basetask, rest$, Lang As Long) As Boolean
Dim s$, x1 As Long, y1 As Long, o As Long, frm$, i As Long, par As Boolean, p As Variant
Dim Scr As Object, ss$
ProcEdit = True
If Not (basestack.IamChild Or basestack.IamAnEvent) Then abt = False: mHelp = False: lastAboutHTitle = vbNullString
Set Scr = basestack.Owner
If Typename(Scr) Like "Gui*" Then oxiforforms: Exit Function
Form1.EditTextWord = False ' edit code

s$ = aheadstatus(rest$, False, y1)
If y1 > 2 And Left$(s$, 1) = "S" Then
If Mid$(rest$, y1 - 1, 1) = "(" Or Mid$(rest$, y1 - 2, 2) = "()" Then s$ = "ok"

End If

If Left$(s$, 1) = "S" Then
    
    If IsStrExp(basestack, rest$, s$) Then
        If s$ <> "" Then
            If ExtractPath(s$) = vbNullString Then
                If CFname(s$) <> "" Then
                    s$ = CFname(s$)
                ElseIf mylcasefILE(s$) = ExtractName(s$) Then
                    s$ = mcd + s$
                End If
                If ExtractType(s$) = vbNullString Then
                    MyEr "missing file type (.gsb or .txt or .gm2)", "δεν υπάρχει τύπος αρχείου (.gsb η .txt η .gm2)"
                    Set Scr = Nothing
                    Exit Function
                End If
            End If
            s$ = ExtractPath(s$) + ExtractName(s$)
            ' check if path exist
            ' uSE THE MYDIR.ISDIR
            If Dir$(ExtractPath(s$), vbDirectory) = vbNullString Then
            ' error
                MyEr "wrong path to save", "λάθος τόπος για σώσιμο"
                Set Scr = Nothing
                Exit Function
            ElseIf ExtractName(s$) = vbNullString Then
                MyEr "missing file name", "χάθηκε το όνομα αρχείου"
                Set Scr = Nothing
                Exit Function
            End If
          Dim oldclid As Long
          oldclid = cLid
            If CFname(s$) <> "" Then
            s$ = CFname(s$)
             frm$ = ReadUnicodeOrANSI(s$, True, x1)
             ' CHECK TO SEE IF THIS IS A PASSWORD PROTECTED PROGRAMM
             For i = 1 To Len(frm$)
             If AscW(Mid$(frm$, i, 1)) < 128 Then
             Exit For
             End If
             Next i
             If i > Len(frm$) Then
             If Lang = 1 Then
             MsgBoxN "not text found", 0
             Else
             MsgBoxN "δεν βρήκα κείμενο", 0
             End If
             Set Scr = Nothing
             Exit Function
             End If
           ' par = Len(frm$) = FileLen(GetDosPath(s$)) ' not unicode
            par = x1 = 3
     
            Else
            frm$ = vbNullString
            par = False
            End If
            Form1.EditTextWord = LCase(ExtractType(s$)) <> "gsb"
                Form1.TEXT1.Title = ExtractName(s$) + " "
            If x1 = 0 Then x1 = -5
            Form1.ResetMarks
            If o < 1 Then o = 0
            If o > Len(frm$) Then o = Len(frm$) + 1
            With players(GetCode(basestack.Owner))
            ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1, o, x1
            End With
            Form1.ResetMarks
            If frm$ <> "" And Abs(x1) >= 0 And Not CancelEDIT Then
            If par Then
                            i = FreeFile
                                            If Not WeCanWrite(s$) Then Set Scr = Nothing: Exit Function
                            On Error Resume Next
                            
                            Open GetDosPath(s$) For Output As i
                                            If Err.Number > 0 Then
                                Err.Clear
                                 MyEr "Bad filename", "Λάθος στο όνομα αρχείου"
                                Set Scr = Nothing
                                Exit Function
                                End If
                            Print #i, frm$;
                            Close i
                Else
                par = SaveUnicode(s$, frm$, x1)
                End If
                
            End If
        End If
        Set Scr = Nothing
        cLid = oldclid
        Exit Function
    Else
    Set Scr = Nothing
    Exit Function
    End If
End If

    If s$ <> "" Then
x1 = Abs(IsLabel(basestack, rest$, s$))
        If x1 > 0 Then
        If x1 > 3 Then
            s$ = ReplaceStr("(", "", s$)
            If FastSymbol(rest$, ")") Then
            End If
            s$ = s$ & "()"
            End If
        Else
        Set Scr = Nothing
        Exit Function
        End If
        MakeThisSub basestack, s$  'NO GOOD..
        If GetSub(s$, x1) Then
jump1:
            ' επιτρέπεται αλλαγή σε περίπτωση που κάποιο τμήμα έτρεξε και πιάσαμε με TRY το λάθος
            ' να δώσουμε την δυνατότητα για αλλαγή χωρίς να σταματήσουν τυχόν νήματα!
            If x1 >= lckfrm And lckfrm <> 0 Then
            MyEr s$ & " is locked", s$ & " είναι κλειδωμένο"
            rest$ = vbNullString
            Set Scr = Nothing
            Exit Function
            End If
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
            y1 = Abs(IsLabel(basestack, rest$, frm$))
              If y1 <> 0 Then
           '' frm$ = myUcase(frm$)
             GetSub frm$, x1
             
            If x1 = 0 Then
            If y1 > 3 Then frm$ = frm$ + ")"
            GetSubFullName s$, ss$
            
            subHash.RenameKey ss$, Mid$(frm$, Len(ss$) - Len(s$) + 1)
            End If
            End If
            Set Scr = Nothing
            Exit Function
            ElseIf FastSymbol(rest$, ",") Then
            i = 1
                If IsExp(basestack, rest$, p) Then
                    i = Int(p)
                    If i < 0 Then i = Len(sbf(x1).sb) + i
                    If i < 0 Then i = 0
                    If i > Len(sbf(x1).sb) Then i = Len(sbf(x1).sb) + 1
                End If
                sbf(x1).sbc = i
            End If
            If sbf(x1).sbc = 0 Then sbf(x1).sbc = -1
        MakeMyTitle s$, Lang
        Set sbf(x1).subs = Nothing
        With players(GetCode(basestack.Owner))
            ScreenEdit basestack, sbf(x1).sb, 0, .mysplit, .mx - 1, .My - 1, sbf(x1).sbc
            End With
            FK$(13) = "@EDIT " & s$ & "," & CStr(i)
        Else
        If InStr(s$, ".") > 0 Then
        frm$ = s$
        s$ = GetStrUntil(".", frm$)
        If GetSub(s$, x1) Then
        GoTo jump1
        End If
        End If
            If FastSymbol(rest$, ",") Then
             If IsExp(basestack, rest$, p) Then
             End If
            End If
            i = -1
          
           MakeMyTitle s$, Lang
           With players(GetCode(basestack.Owner))
            ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1, i
            End With
            If frm$ <> "" Then
            MakeThisSub basestack, s$
                If here$ = vbNullString And InStr(s$, "(") = 0 Then
                    x1 = GlobalSub(s$, frm$, , s$)
                Else
                    x1 = ModuleSub(s$, frm$)
                End If
                If x1 <> 0 Then sbf(x1).sbc = i: Set sbf(x1).subs = Nothing
                FK$(13) = "@EDIT " & s$ & "," & CStr(i)
                Else
                FK$(13) = "@EDIT " & s$
            End If
        End If
    ElseIf Not (basestack.IamChild Or basestack.IamAnEvent) Then
        frm$ = Mid$(ReplaceStr(vbCr, vbCrLf, QUERYLIST), 3)
        Form1.ShadowMarks = True
        If UserCodePage = 1253 Then
        Form1.TEXT1.Title = "Λίστα εντολών "
        Else
        Form1.TEXT1.Title = "Command List "
        End If
        With players(GetCode(basestack.Owner))
        ScreenEdit basestack, frm$, 0, .mysplit, .mx - 1, .My - 1
        End With
        Form1.ShadowMarks = False
        QUERYLIST = vbCr + ReplaceStr(vbCrLf, vbCr, frm$)
    End If

End Function
Function ProcModuleEntry(basestack As basetask, ohere$, x1 As Long, rest$, Optional Lang As Long = -1, Optional thisIsEvent As Boolean = False) As Boolean
On Error GoTo there22
  If LastErNum = -1 Then GoTo there22
Dim frm$, bs As basetask, i As Long, pa$, p As Variant, loopthis As Boolean
Dim subs As Long, snames As Long, VName As Long, vvv As Variant, S3 As Long

Dim subspoint As Boolean
'LastErName = VbNullString: LastErNameGR = VbNullString
If CurrentStackSize > stacksize Then
    MyEr "Function's Stack is Full - 15", "Η στοίβα των συναρτήσεων έχει γεμίσει - 15"
    ProcModuleEntry = False:
    here$ = ohere$
    Exit Function
End If
' ******************************************* module entry..............
If x1 = 0 Then x1 = basestack.callx1: ohere$ = basestack.callohere: basestack.callx1 = 0
i = 1
        Set bs = New basetask
       With bs
       .IamAnEvent = thisIsEvent
        .reflimit = varhash.count
        Set .Parent = basestack
        Set .Sorosref = basestack.soros   'same stack
        Set .Owner = .Parent.Owner
        .OriginalName$ = ohere$
        .Vars = var2used + basestack.ByName: VName = varhash.count + basestack.ByName
        basestack.ByName = 0
        .commnum = comhash.count
        .strfunnum = strfunid.count
        .numfunnum = funid.count
        .strnum = strid.count
        .numnum = numid.count
        subs = sb2used: snames = subHash.count

        .UseGroupname = sbf(x1).sbgroup
        .OriginalCode = x1
        If Not basestack.StaticCollection Is Nothing Then
           If basestack.ExistVar("%_" + here$) Then
                   basestack.ReadVar "%_" + here$, vvv
                   If MyIsObject(vvv) Then Set bs.StaticCollection = vvv
                    Set vvv = Nothing

        End If
        End If
       .StaticInUse$ = here$
       End With
If SecureNames Then
If basestack.IamThread Then
here$ = Str$(basestack.Process.Id) + here$
Mid$(here$, 1, 1) = "_"
End If
End If
If Lang <> -1 Then
    If IsSymbol(rest$, ";") Then
        Dim what$, WHAT1$
Do
   
        If IsLabel(basestack, rest$, what$) = 1 Then
 
            
        
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
                If IsLabel(basestack, rest$, WHAT1$) <> 1 Then GoTo myerror1
            Else
            WHAT1$ = what$
            End If
                    If subHash.Find(ohere$ & "." & WHAT1$, i) Then
                        MyModule bs, what$ + " {}", Lang
                        sbf(bs.IndexSub).locked = True
                        sbf(bs.IndexSub).sb = sbf(i).sb
                        sbf(bs.IndexSub).sbc = sbf(i).sbc
                        sbf(bs.IndexSub).sbgroup = sbf(i).sbgroup
                         
                    ElseIf subHash.Find(WHAT1$, i) Then
                        MyModule bs, what$ + " {}", Lang
                        sbf(bs.IndexSub).locked = True
                        sbf(bs.IndexSub).sb = sbf(i).sb
                        sbf(bs.IndexSub).sbc = sbf(i).sbc
                        sbf(bs.IndexSub).sbgroup = sbf(i).sbgroup
                    End If
                End If
        Loop Until Not IsSymbol(rest$, ",")
    End If
End If
       i = 1

If myexit(bs) Then
ProcModuleEntry = False: Exit Function
End If
 Do
  frm$ = Mid$(sbf(x1).sb, i)

againmod:
       If LastErNum = -1 Then
       GoTo myerror1
       End If
        Select Case Execute(bs, frm$, False, False, loopthis)

        Case 0
        
myerror1:
If MOUT And Not NOEXECUTION Then
    MOUT = False
    rest$ = vbNullString: MyEr "", ""
    Exit Do
End If
                    If sb2used <> 0 And Not NERR Then
        If bs.UseGroupname <> "" Then
If InStr(bs.UseGroupname, ChrW(&H1FFF)) > 0 Then

pa$ = GetNextLine((sbf(Abs(bs.OriginalCode)).sb))
FK$(13) = Mid$(pa$, 7) + "-" + CStr(Len(frm$))
MyErMacro rest$, "Problem in class in module " + GetName(here$), "Πρόβλημα στη κλάση στο τμήμα " + GetName(here$)
'MyErMacro rest$, "Problem in class", "Πρόβλημα στη κλάση"
ProcModuleEntry = True
GoTo thh1
End If

        End If
                    pa$ = "EDIT " & GetModuleName(bs, here$) & ", " + CStr(Len(sbf(x1).sb))
                    If ohere$ <> "" Then
                    
                    If Left$(sbf(x1).sb, 10) = "'11001EDIT" Then
                    
                    pa$ = Mid$(GetNextLine(sbf(x1).sb), 7)
                    sbf(x1).sb = Mid$(sbf(x1).sb, 3)
                    Set sbf(x1).subs = Nothing
                    If SecureNames Then
                    MyEr "in module " & GetName(here$), "στο τμήμα " & GetName(here$)
                    Else
                    MyEr "in module " & GetName(ohere$) & "." & GetName(here$), "στο τμήμα " & GetName(ohere$) & "." & GetName(here$)
                    End If
                    Else
                        MyEr "in module " & GetName(ohere$), "στο τμήμα " & GetName(ohere$)
                    End If
                    Else
                    If here$ = vbNullString Then
                    MyEr "in command prompt", "στην εισαγωγή εντολών"
                    Else
                    MyEr "in module " & GetName(here$), "στο τμήμα " & GetName(here$)
                    End If
                    End If
                    If InStr(FK$(13), ",") > 0 Then
                    If Left$(pa$, InStr(pa$, ",")) <> Left$(FK$(13), InStr(FK$(13), ",")) Then
                    GoTo thh
                    End If
               
GoTo thh

                    End If
                    If (Len(sbf(x1).sb) - Len(frm$)) < 0 Then
                    FK$(13) = pa$
                    Else
                    DropLeft ",", FK$(13)
                    If FK$(13) <> "" Then FK$(13) = "+" & FK$(13)
                    
                    FK$(13) = pa$ & "-" & CStr(Len(frm$)) + FK$(13)
                    End If
                    
                    Else
                    If sb2used > 0 Then
                    MyEr "in module " & GetName(here$), "στο τμημα " & GetName(here$)
                    Else
                    MyEr "", ""
                    End If
                    End If
                    
                    GoTo thh
            
        Case 1, 3

thh:
    If bs.IamChild Then
    If Not bs.soros Is bs.Parent.soros Then
    Set bs.Parent.Sorosref = bs.soros
    End If
    End If
    If LastErNum <> 0 Then
                   rest$ = vbNullString
                    End If
thh1:
                    On Error Resume Next
                    With bs
                    .ThrowThreads
                  MOUT = False
                    var2used = .Vars
                    varhash.ReduceHash VName, var()
                    If UBound(var()) / 3 >= var2used And UBound(var()) > 2999 Then
                        ReDim Preserve var(UBound(var()) / 2) As Variant
                    End If
                    
                        
                  
                    
                    

                    sb2used = subs
                    subHash.ReduceHash snames, sbf()
                     If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
                               ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
                       End If
                       End With
                    With bs
                        If Not .StaticCollection Is Nothing Then
                            basestack.SetVarobJ "%_" + .StaticInUse$, .StaticCollection
                        End If
                        If .commnum <> comhash.count Then comhash.ReduceHash .commnum, sbf()
                        If .numfunnum <> funid.count Then funid.ReduceHash .numfunnum
                        If .strfunnum <> strfunid.count Then strfunid.ReduceHash .strfunnum
                        If .numnum <> numid.count Then numid.ReduceHash .numnum
                        If .strnum <> strid.count Then strid.ReduceHash .strnum
                    End With
                   
                    Set bs = Nothing
                    here$ = ohere$
                
               
                    Exit Do
        Case 2
                    i = 1
                    
                    If frm$ <> "" Then
                            If frm$ = "BREAK" Then
                            
                            GoTo thh1
                              'Exit Do
                             ElseIf frm$ = Chr$(0) Then
                             
                                     If bs.IsInRetStackNumber(p) Then
                                     If p < -1 Then
                                     vvv = Abs(p + 2)
                                     bs.IsInRetStackNumber p
                                     subspoint = True
                                     If vvv <> x1 And vvv <> 0 Then
                                     i = Len(sbf(vvv).sb) - CLng(p) + 1
                                                frm$ = Mid$(sbf(vvv).sb, i)
                                                S3 = x1
                                                PopStage bs
                                            GoTo againmod
                                            
                                     Else
                                     i = Len(sbf(FindPrevOriginal(basestack)).sb) - CLng(p) + 1
                                                frm$ = Mid$(sbf(S3).sb, i)
                                                PopStage bs
                                             GoTo againmod
                                             End If
                                     ElseIf p < 0 Then
                                     subspoint = False
                                     bs.IsInRetStackNumber p
                                     i = Len(sbf(x1).sb) - CLng(p) + 1
                                     End If
                                   PopStage bs
                    
                                       
                             ElseIf bs.IsInRetStackString(frm$) Then
                                      If InStr(frm$, " ") > 0 Then
                                   If subspoint Then bs.RetStack.PushVal -2 - S3 Else bs.RetStack.PushVal -1
                                   S3 = x1
                                        If searchsub(S3, frm$, i, S3) Then
                                     
                                         subspoint = False
                                                If frm$ <> "" Then If Not MyRead(7, basestack, frm$, 1) Then GoTo thh
                                                    frm$ = Mid$(sbf(S3).sb, i)
                                                    subspoint = S3 <> x1
                                                    GoTo againmod
                                                 ElseIf x1 <> basestack.OriginalCode And basestack.OriginalCode <> 0 Then
                                                
                                                 If searchsub(FindPrevOriginal(bs), frm$, i, S3) Then
                                                 subspoint = True
                                                 
                                                             If frm$ <> "" Then If Not MyRead(7, basestack, frm$, 1) Then GoTo thh
                                                             frm$ = Mid$(sbf(S3).sb, i)
                                                             GoTo againmod
                                                             Else
                                                            'Debug.Print "Bad pop"
                                                            MyEr "sub not found", "δεν βρέθηκε η ρουτίνα"
                                                            
                                                            bs.RetStack.drop 5
                                                             GoTo myerror1
                                                             'Exit Do
                                                 End If
                                                 Else
                                                 If frm$ <> "" Then MyEr "sub not found", "δεν βρέθηκε η ρουτίνα"
                                                 If bs.IsInRetStackNumber(p) Then
                          
                                     If p = -1 Then
                                     subspoint = False
                                     bs.IsInRetStackNumber p
                                     'i = Len(sbf(x1).sb) - CLng(p) + 1
                                     frm$ = Space(p)
                                     End If
                                                    End If
                                                    bs.RetStack.drop 5
                                                                        GoTo myerror1

                                                 End If
                                         Else
                                         MyEr "Fault in Return", "Λάθος στην Επιστροφή"
                                         bs.RetStack.Flush
                                         Exit Do
                                         End If

                                    End If

                             Else
                                        '' i = PosLabel(frm$, sbf(x1).sb)
                                        If sbf(x1).subs Is Nothing Then
                                        Set sbf(x1).subs = New FastCollection
                                        End If
                                        If sbf(x1).subs.ExistKey(frm$) Then
                                        If IsNumeric(sbf(x1).subs.Value) Then
                                            i = sbf(x1).subs.Value
                                        Else

                                                    
                                            i = val(Split(sbf(x1).subs.Value)(0))
                                            x1 = val(Split(sbf(x1).subs.Value)(1))
                                        End If
                                        Else
                                         If InStr(frm$, vbCr) > 0 Then
                                         i = rinstr(sbf(x1).sb, frm$)
                                         If i = 0 Then i = Len(sbf(x1).sb) + 1
                                          Else
                                          i = PosLabel(frm$, sbf(x1).sb)
                                         End If
                                         sbf(x1).subs.AddKey frm$, i
                                         End If
                                         
                            End If
                    Else
                    
If Not loopthis Then GoTo thh1
loopthis = False
                   End If
Case 12
MyEr "Exit for out of for next loop", "Έξοδος για έξω από Για Επόμενο"
Exit Do
        End Select
Loop
ProcModuleEntry = True
Exit Function
there22:
If Err Then
MyEr Err.Description, Err.Description
Err.Clear
If Not bs Is Nothing Then GoTo thh
End If
End Function
Function PushParamGeneralV7(basestack As basetask, rest$, Optional ByVal temphere$) As Boolean
PushParamGeneralV7 = True

Dim ps As mStiva, p As Variant, s$, ok As Long
If MaybeIsSymbol(rest$, ")") Then Set ps = New mStiva: GoTo conthere
Dim ParentStack As basetask
Set ParentStack = basestack.Parent
Set ParentStack.lastobj = Nothing
    Set ps = New mStiva
                Do
                 If FastSymbol(rest$, "%") Then
            p = IsLabel(basestack, rest$, s$, True)
            ok = 1
            If p < 4 Then
            ExecuteVar ok, p, basestack, s$, rest$, (ok), 1, True, False, 0, "", 0, (temphere$)
            If ok <> 1 Then PushParamGeneralV7 = False: Exit Function
            ps.DataOptional
            Else
            MyEr "Array can't pass by name", "Ο πίνακας δεν μπορεί να περάσει με όνομα"
            PushParamGeneralV7 = False: Exit Function
            End If
        ElseIf FastSymbol(rest$, "?") Then
                        ps.DataOptional
            ElseIf FastSymbol(rest$, "!") Then
                If IsExp(ParentStack, rest$, p) Then
                If ParentStack.lastobj Is Nothing Then
                ps.DataValLong p
                ElseIf TypeOf ParentStack.lastobj Is mHandler Then
                If TypeOf ParentStack.lastobj.objref Is mStiva Then
                    ps.MergeBottom ParentStack.lastobj.objref
                    ElseIf TypeOf ParentStack.lastobj.objref Is mArray Then
                      ps.MergeBottomCopyArray ParentStack.lastobj.objref
                    End If
                    
                    Set ParentStack.lastobj = Nothing
                Else
                    PushParamGeneralV7 = False
                    MyEr "Expected Stack Object after !", "Περίμενα αντικείμενο τύπου Σωρού μετά το !"
                    Set ParentStack.lastobj = Nothing
                    Exit Function
                End If
                
                End If
                ElseIf IsExp(ParentStack, rest$, p) Then
        If Not ParentStack.lastobj Is Nothing Then
        
         If TypeOf ParentStack.lastobj Is mStiva Then
            Dim mm As mStiva
            Set mm = ParentStack.lastobj
            ps.MergeBottom mm
            Set mm = Nothing
        ElseIf Not ParentStack.lastpointer Is Nothing Then
                ps.DataObj ParentStack.lastobj
                Set ParentStack.lastpointer = Nothing
                Set ParentStack.lastobj = Nothing
        Else
           ps.DataObj ParentStack.lastobj
           Set ParentStack.lastobj = Nothing
           End If
       Set ParentStack.lastobj = Nothing
        Else
            ps.DataVal p
         End If
    ElseIf Not LastErNum <> 0 Then
    If IsStrExp(ParentStack, rest$, s$) Then
       If Not ParentStack.lastpointer Is Nothing Then
            ps.DataObj ParentStack.lastobj
            Set ParentStack.lastpointer = Nothing
            Set ParentStack.lastobj = Nothing
        ElseIf Not ParentStack.lastobj Is Nothing Then
            ps.DataObj ParentStack.lastobj
            Set ParentStack.lastobj = Nothing
        Else
        ps.DataStr s$
        End If
    ElseIf MaybeIsSymbol(rest$, ",") Then
        ps.DataOptional
    ' here
    End If
    Else
  If LastErNum <> 0 Then
     PushParamGeneralV7 = False
  Exit Do
    End If
    End If
      If LastErNum <> -2 And LastErNum <> 0 Then
      MyEr "Error in input list", "Πρόβλημα στις παραμέτρους"
      PushParamGeneralV7 = False
      End If
    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
             Set ParentStack = Nothing
conthere:
             With basestack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
            
End Function
Function PushParamGeneral(basestack As basetask, rest$, Optional ByVal temphere$) As Boolean
PushParamGeneral = True
Dim ps As mStiva, p As Variant, s$, ok As Long
    Set ps = New mStiva
    Set basestack.lastobj = Nothing
                Do
        If FastSymbol(rest$, "%") Then
            p = IsLabel(basestack, rest$, s$, True)
            ok = 1
            If p < 4 Then
            ExecuteVar ok, p, basestack, s$, rest$, (ok), 1, True, False, 0, "", 0, (temphere)
            If ok <> 1 Then PushParamGeneral = False: Exit Function
            ps.DataOptional
            Else
            MyEr "Array can't pass by name", "Ο πίνακας δεν μπορεί να περάσει με όνομα"
            PushParamGeneral = False: Exit Function
            End If
        ElseIf FastSymbol(rest$, "?") Then
                        ps.DataOptional
            ElseIf FastSymbol(rest$, "!") Then
                If IsExp(basestack, rest$, p) Then
                If basestack.lastobj Is Nothing Then
                   ps.DataValLong p
                ElseIf TypeOf basestack.lastobj Is mHandler Then
                    If TypeOf basestack.lastobj.objref Is mStiva Then
                        ps.MergeBottom basestack.lastobj.objref
                    ElseIf TypeOf basestack.lastobj.objref Is mArray Then
                     ps.MergeBottomCopyArray basestack.lastobj.objref
                        Else
                            PushParamGeneral = False
                            MyEr "Expected Stack Object after !", "Περίμενα αντικείμενο τύπου Σωρού μετά το !"
                            Set basestack.lastobj = Nothing
                            Exit Function
                    End If
                Set basestack.lastobj = Nothing
                End If
                End If
                ElseIf IsExp(basestack, rest$, p) Then
        If Not basestack.lastobj Is Nothing Then
        If TypeOf basestack.lastobj Is mStiva Then
            Dim mm As mStiva
            Set mm = basestack.lastobj
            ps.MergeBottom mm
            Set mm = Nothing
        ElseIf Not basestack.lastpointer Is Nothing Then
            ps.DataObj basestack.lastobj
            Set basestack.lastpointer = Nothing
            
        ElseIf Not basestack.lastobj Is Nothing Then
           ps.DataObj basestack.lastobj

        End If
       Set basestack.lastobj = Nothing
       
        Else
            ps.DataVal p
            
         End If
    ElseIf Not LastErNum <> 0 Then
    If IsStrExp(basestack, rest$, s$) Then
       
       
       If Not basestack.lastpointer Is Nothing Then
            ps.DataObj basestack.lastobj
            Set basestack.lastpointer = Nothing
        ElseIf Not basestack.lastobj Is Nothing Then
           ps.DataObj basestack.lastobj
        Else
            ps.DataStr s$
        End If
        Set basestack.lastobj = Nothing
    ElseIf MaybeIsSymbol(rest$, ",") Then
        ps.DataOptional
    ' here
    End If
    Else
  If LastErNum <> 0 Then
     PushParamGeneral = False
  Exit Do
    End If
    End If
      If LastErNum <> -2 And LastErNum <> 0 Then
      MyEr "Error in input list", "Πρόβλημα στις παραμέτρους"
      PushParamGeneral = False
      End If
    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
            
            ' If ps Is Nothing Then Stop
             With basestack
             If .SorosNothing Then
           
               Set .Sorosref = ps
             Else
                .soros.MergeTop ps
             End If
             End With
            
End Function

Sub PushParamStraight(basestack As basetask, rest$)
Dim p As Variant, s$
    Dim ps As mStiva
    Set ps = basestack.soros
                Do
                    If IsExp(basestack, rest$, p) Then
                            If Not basestack.lastpointer Is Nothing Then
                                ps.DataObj basestack.lastobj
                                Set basestack.lastpointer = Nothing
                                Set basestack.lastobj = Nothing
                            ElseIf Not basestack.lastobj Is Nothing Then
                                ps.DataObj basestack.lastobj
                                Set basestack.lastobj = Nothing
                            Else
                                ps.DataVal p
                            End If
                    ElseIf IsStrExp(basestack, rest$, s$) Then
                    
                            If Not basestack.lastpointer Is Nothing Then
                                ps.DataObj basestack.lastobj
                                Set basestack.lastpointer = Nothing
                                Set basestack.lastobj = Nothing
                            ElseIf Not basestack.lastobj Is Nothing Then
                                ps.DataObj basestack.lastobj
                                Set basestack.lastobj = Nothing
                            Else
                                ps.DataStr s$
                            End If

                    Else
                    
                            Exit Do
                    End If
                    If Not FastSymbol(rest$, ",") Then Exit Do
                Loop
             
             Set ps = Nothing
End Sub

Function searchsub(ByVal where As Long, w$, final As Long, site As Long) As Boolean
Dim ww$()
ww$() = Split(w$)
If where = 0 Then
Exit Function
Else
If where < 0 Then
    With var(-where)
    If .subs Is Nothing Then
        Set .subs = New FastCollection
    Else
        If UBound(ww$()) = 0 Then
            w$ = ww$(0)
        Else
            w$ = ww$(1)
        End If
        If .subs.ExistKey(UCase(w$)) Then
        ww$ = Split(CStr(.subs.Value))
        final = val(ww$(0))
        If UBound(ww$()) = 0 Then
        
        Else
        site = val(ww$(1))
        End If
        If .subs.ExistKey(UCase(w$) + ")") Then w$ = .subs.Value Else w$ = vbNullString
        WaitShow = 0
        searchsub = True
        Exit Function
        End If
        w$ = Join(ww$)
    End If
    End With
Else
    With sbf(where) 'varhash.ItemCreator what$, i
    If .subs Is Nothing Then
        Set .subs = New FastCollection
    Else
        If UBound(ww$()) = 0 Then
            w$ = ww$(0)
        Else
            w$ = ww$(1)
        End If
        If .subs.ExistKey(UCase(w$)) Then
        ww$ = Split(CStr(.subs.Value))
        final = val(ww$(0))
        If UBound(ww$()) = 0 Then
        
        Else
        site = val(ww$(1))
        End If
        If .subs.ExistKey(UCase(w$) + ")") Then w$ = .subs.Value Else w$ = vbNullString
        WaitShow = 0
        searchsub = True
        Exit Function
        End If
        w$ = Join(ww$)
    End If
    End With
    End If
End If

Dim Len1 As Long, there1 As Long, a$
Dim aCopy As Document, there As Long, Curs As Long, Curs2 As Long
Dim a1 As Long, b As Long, c As Long, d As Long
Dim ss$, DUMP$
If where > 0 Then
a$ = sbf(where).sb
Else
a$ = var(-where).code$
End If
paliedo:
Len1 = Len(ww$(0))
If Len1 = 1 Then
If ww$(0) = "S" Then
Set aCopy = New Document
With aCopy
.textDocFast = a$
.lcid = 1032
ww$(1) = ww$(1) + ":"
Do While .FindIdentifier(ww$(1), False, there, Curs)
If Trim$(Left$(.TextParagraph(there), Curs - 1)) = vbNullString Then
' we find it
                               final = -1
                               .FindPos .FirstParagraphLine(there) + 2, 1, final, a1, b, c, d
                               final = final + 1 ' because mid$ starts from 1
                               w$ = vbNullString
                                searchsub = True
                                GoTo register
End If

Loop
End With
Else
final = PosLabel(ww$(1), a$)
If final <> 1 Then
w$ = vbNullString
searchsub = True
GoTo register
End If
End If
Exit Function
End If

Set aCopy = New Document

With aCopy
.textDocFast = a$
.lcid = 1032
there = 0
Curs = 0
Do
If .FindIdentifier(ww$(0), False, there, Curs) Then

ss$ = Left$(aCopy.TextParagraph(there), Curs - 1)

IsNumberLabel ss$, DUMP$
                        If Trim$(ss$) = vbNullString Then
                        Curs2 = Curs
                        there1 = there
                        If .FindIdentifier(ww$(1), True, there1, Curs2) Then
                        
                                    If there1 <> there Then
                                           Curs = 0
                                    Else
                                                final = -1  ' this is the mode for search charpos ...in findpos
                                                ' FROM 1,0, BUT  PARAGRAPH LINES ARE FROM 0
                                                ' SO PLUS ONE PLU ONE MORE FOR NEXT LINE
                                                '
                                                .FindPos .FirstParagraphLine(there1) + 2, 1, final, a1, b, c, d
                                                       final = final + 1 ' because mid$ starts from 1
                                                       
                                                       
                                                        w$ = BlockParam(Trim(Mid$(.TextParagraph(there), Curs2 + Len(ww(1)))))
                                                        If w$ <> "" Then
                                                   '' If Right$(w$, 1) = ")" Then w$ = Left$(w$, Len(w$) - 1)
                                                        End If
                                                        searchsub = True
                                                        
                                                       

                                                        Exit Do
                                    End If
                        End If
            End If
            Else
            If ww$(0) = "ΡΟΥΤΙΝΑ" Then
            ww$(0) = "ΡΟΥΤΊΝΑ"
            GoTo paliedo
            End If
            Exit Do
        End If
   Loop
End With
register:
If searchsub Then
If site > 0 Then
If sbf(site).subs Is Nothing Then Set sbf(site).subs = New FastCollection
sbf(site).subs.AddKey UCase(ww$(1)), Trim$(Str$(final) + Str$(where))
If w$ <> "" Then
'If InStr(w$, "=") > 0 Then w$ = "? " + w$
sbf(site).subs.AddKey UCase(ww$(1)) + ")", w$
End If
ElseIf site < 0 Then
If var(-site).subs Is Nothing Then Set var(-site).subs = New FastCollection
var(-site).subs.AddKey UCase(ww$(1)), Trim$(Str$(final) + " " + Str$(where))
If w$ <> "" Then var(-site).subs.AddKey UCase(ww$(1)) + ")", w$
ElseIf where > 0 Then
site = where
If sbf(site).subs Is Nothing Then Set sbf(site).subs = New FastCollection
sbf(site).subs.AddKey UCase(ww$(1)), Trim$(Str$(final) + Str$(where))
If w$ <> "" Then sbf(site).subs.AddKey UCase(ww$(1)) + ")", w$
End If
site = where
End If


End Function
Function search2KIND(a$, w$, final As Long, Optional Anypos As Boolean = False) As Boolean
Dim aCopy As Document, there As Long, Curs As Long, Curs2 As Long
Dim a1 As Long, b As Long, c As Long, d As Long
Dim ww$(), there1 As Long
Dim ss$, DUMP$
ww$() = Split(w$)

Set aCopy = New Document

With aCopy
.textDocFast = a$
there = 0
Curs = 0
Do
If .FindIdentifier(ww$(0), True, there, Curs) Then

ss$ = Left$(aCopy.TextParagraph(there), Curs - 1)

IsNumberLabel ss$, DUMP$
If Anypos Then
If Right$(Trim$(ss$), 1) = ":" Then ss$ = vbNullString
End If
                        If Trim$(ss$) = vbNullString Then
                        Curs2 = Curs + Len(ww$(0))
                        there1 = there
                        If .FindWord(ww$(1), True, there1, Curs2) Then
                        
                                    If there1 <> there Then
                                           Curs = 0
                                    Else
                                                final = -1  '
                                                If Not Anypos Then Curs2 = 1 Else Curs2 = Curs2 + 1
                                                .FindPos .FirstParagraphLine(there1) + 1, Curs2, final, a1, b, c, d

                                                       search2KIND = True
                                                        Exit Do
                                    End If
                        End If
            End If
            Else
            Exit Do
        End If
   Loop
End With


End Function

Function executeblock(Exec As Long, bstack As basetask, b$, once As Boolean, kolpo As Boolean, Optional stepbystep As Boolean = False) As Boolean
' MsgBox CurrentStackSize()
executeblock = True
'bstack.LastComm = VbNullString
Dim i As Long, ec$, ec1$, LL As Long, oldLL As Long, bb$, p As Variant, x2 As Long, y2 As Long, monce As Long, w3 As Long, removebracket As Boolean
Dim myLevel As Long, oldexec As Long, loopthis As Boolean, subspoint As Boolean, RetStackSize As Long, subs As FastCollection, vvv As Long
RetStackSize = bstack.RetStackTotal
If Exec = 0 Then Exec = 1
oldexec = Exec
myLevel = bstack.SubLevel
i = 1
monce = once
If FastSymbol(b$, "}") Then ''MyDoEvents
executeblock = False
 If myexit(bstack) Then Exec = 1 Else Exec = Abs(NOEXECUTION = False) * oldexec
Exit Function
ElseIf IsSymbolBracket(b$) Then
stepbystep = False
ec1$ = b$
ec$ = block(ec1$)
removebracket = True
Else
ec1$ = b$
ec$ = block(ec1$)
If ec$ = vbNullString Then ec$ = b$
End If
oldLL = bstack.addlen
If Len(ec1$) > 0 And Len(b$) <> Len(ec1$) Then

LL = Len(ec1$) + oldLL
Else
LL = oldLL
End If
ec1$ = vbNullString

        Do
        
                bb$ = Mid$(ec$, i)
fromfirst0:
        
                kolpo = once: once = False
                bstack.addlen = LL
              '  WaitShow = 0 ' for trace
                w3 = Execute(bstack, bb$, kolpo, stepbystep, loopthis)
                bstack.addlen = oldLL
                Select Case w3
                Case 0
                        If myLevel <> bstack.SubLevel Then
                                b$ = bb$
                                Exec = 0
                                bstack.RetStack.drop 7 * (bstack.SubLevel - myLevel)  ' NOW LEVEL HAS 5+2 ITEMS
                                Exit Function
                        End If
                        If NocharsInLine(bb$) Then
                                b$ = vbNullString
                        Else
                                If LastErNum = -2 Then
                                        b$ = bb$
                                ElseIf Len(ec$) < Len(bb$) Then
                                 b$ = vbNullString
                               Else
                                        b$ = Mid$(b$, Len(ec$) - Len(bb$) + 1)
                                End If
                        End If
                        Exec = 0
                        Exit Function
                Case 1
ALFA12:
                        If LastErNum = -2 Then
                                If NocharsInLine(bb$) Then
                                        b$ = vbNullString
                                Else
                                        If Left$(bb$, 12) = " : ERROR -2" Then
                                                b$ = bb$
                                        Else
                                                b$ = Mid$(b$, Len(ec$) - Len(bb$) + 1)
                                        End If
                                End If
                                Exec = 0
                                Exit Function
                        End If
                        Exec = oldexec ''1
                        If kolpo And monce And Exec = 1 Then
                                b$ = bb$
                                once = True
                                Exit Function
                        ElseIf kolpo And NocharsInLine(bb$) Then
                                ' exit
                                Exec = w3
                                Exit Do
                        End If
                        If removebracket Then
                                b$ = Right$(b$, Len(b$) - Len(ec$))
                                If IsSymbol(b$, "}") Then Exec = oldexec: Exit Do
                                If once Then Exit Do
                        ElseIf NocharsInLine(bb$) And kolpo Then
                                b$ = vbNullString
                        Else
                                If stepbystep Then
                                        b$ = bb$
                                Else
                                        b$ = Right$(b$, Len(b$) - Len(ec$))
                                End If
                        End If
                        Exit Do

                Case 2
                
                        If bb$ = "BREAK" Then
                                Exec = 2
                                b$ = vbNullString
                                once = True
                                kolpo = True
                                Exit Function
                        End If
                        If Not kolpo Then
                                If bb$ <> "" Then
                                        If bb$ = Chr$(0) Then
                                        If RetStackSize >= bstack.RetStackTotal Then
                                        If bstack.RetStack.LookTopVal < 0 Then
                                        ' this is a return form other block
                                         Exec = 2
                                        b$ = bb$
                                        Exit Function
                                        End If
                                        End If
                                                i = 1
                                                
from123:

                                                If bstack.IsInRetStackNumber(p) Then
                                                        If LastErNum = -1 Then
                                                                bstack.RetStack.PushVal p
                                                                Exec = 0
                                                                Exit Function
                                                        End If
           
                                                        subspoint = False
                                                        bstack.IsInRetStackNumber p
                                                        If p < 0 Then
                                                        Exec = 0
                                                      If RetStackSize <> bstack.RetStackTotal Then
                                                        MyEr "Problem in return stack", "Πρόβλημα στο σωρό επιστροφής"
                                                      End If
                                                      bstack.RetStack.Flush
                                                      b$ = vbNullString
                                                        Exit Function
                                                        
                                                        End If
                                                        Exec = 1
                                                        i = Len(ec$) - CLng(p) + 1
                                                        PopStage bstack
                                                        If loopthis Then
                                                                bb$ = Mid$(ec$, i)
                                                                GoTo fromfirst0
                                                        Else
                                                            bb$ = Mid$(ec$, CLng(p) + 1)
                                                        End If
                                                        If bb$ = vbCrLf Then Exit Do
                                                ElseIf bstack.IsInRetStackString(bb$) Then
findelsesub0:

                                                        If InStr(bb$, " ") > 0 Then
                                                          If subspoint Then bstack.RetStack.PushVal -2 - w3 Else bstack.RetStack.PushVal -1
                                                             w3 = bstack.OriginalCode
                                                                  If searchsub(w3, bb$, i, w3) Then
                                                                
                                                                        subspoint = False
                                                                    If bb$ <> "" Then
                                                                              If Not MyRead(7, bstack, bb$, 1) Then
                                                                                Exec = 0
                                                                                Exit Function
                                                                               End If
                                                                               
                                                                               
                                                                        End If
                                                                        If w3 > 0 Then
                                                                        
                                                                                bb$ = Mid$(sbf(w3).sb, i)
                                                                        
                                                                        Else
                                                                                bb$ = Mid$(var(-w3).code$, i)
                                                                        End If
    
                                                                    WaitShow = Len(bb$)
                                                                    bstack.addlen = 0
                                                                        kolpo = False
                                                                        If trace Then TestShowStart = 1: TestShowSub = bb$
                                                                        GoTo contSub
                                                                ElseIf bstack.IamChild Then
                                                                If bstack.IamLambda Then
                                                                MyEr "Sub Not Found", "Η ρουτίνα δεν βρέθηκε"
                                                                         Exec = 0
                                                                                            Exit Function
                                                                        ElseIf searchsub(FindPrevOriginal(bstack), bb$, i, w3) Then
                                                                                subspoint = True
                                                                        If bb$ <> "" Then
                                                                           If Not MyRead(7, bstack, bb$, 1) Then
                                                                                Exec = 0
                                                                                Exit Function
                                                                               End If
                                                                               
                                                                        End If
                                                                                                                                                        

                                                                        bb$ = Mid$(sbf(w3).sb, i)
                                                                        subspoint = w3 <> bstack.OriginalCode
                                                                        WaitShow = Len(bb$)
                                                                             
                                                                        kolpo = False
                                                                              If trace Then
                                                                 TestShowSub = bb$
                                                                TestShowStart = i
                                                                 stackshow bstack
                                                                
                                                                End If
                                                                      
                                                                                  
contSub:
                                                                y2 = y2 + 1
subsub02:
                                                                        Exec = 0
                                                                        
                                                                                    x2 = Execute(bstack, bb$, kolpo)
                                                                                    If x2 = 2 Then
                                                                                            If bb$ = Chr$(0) Then

                                                                                       
                                                                                                    If bstack.IsInRetStackString(bb$) Then GoTo findelsesub0
                                                                           
                                                                                                    y2 = y2 - 1
                                                                                                    If y2 = 0 Then GoTo from123  'normal level
                                                                                           
                                                                                                    If bstack.IsInRetStackNumber(p) Then
                                                                                              
                                                                                                            If p < -2 Then
                                                                                                            vvv = Abs(p + 2)
                                                                                                                    subspoint = True
                                                                                                                    bstack.IsInRetStackNumber p
                                                                                                    
                                                                                                                '   bb$ = Mid$(sbf(Abs(bstack.Parent.OriginalCode)).sb, Len(sbf(Abs(bstack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                                                                        
                                                                                                                     bb$ = Mid$(sbf(vvv).sb, Len(sbf(vvv).sb) - CLng(p) + 1)
                                                                                                                     w3 = Abs(bstack.OriginalCode)
                                                                                                                     
                                                                                                            ElseIf p < 0 Then
                                                                                                                    subspoint = False
                                                                                                                    bstack.IsInRetStackNumber p
                                                                                                  If bstack.OriginalCode = 0 Then
                                                                                                    bb$ = Mid$(sbf(Abs(bstack.Parent.OriginalCode)).sb, Len(sbf(Abs(bstack.Parent.OriginalCode)).sb) - CLng(p) + 1)
                                                                                                  Else
                                                                                                                '    bb$ = Mid$(sbf(Abs(bstack.OriginalCode)).sb, Len(sbf(Abs(bstack.OriginalCode)).sb) - CLng(p) + 1)
                                                                                                                If w3 < 0 Then
                                                                                                                    bb$ = Mid$(var(-w3).code$, Len(var(-w3).code$) - CLng(p) + 1)
                                                                                                                Else
                                                                                                                    bb$ = Mid$(sbf(w3).sb, Len(sbf(w3).sb) - CLng(p) + 1)
                                                                                                                    End If
                                                                                                                    End If
                                                                                                                    
                                                                                                            End If
                                                                                                             PopStage bstack
                                                                                                            Exec = 1
                                                                                                            GoTo subsub02
                                                                                                    Else
                                                                                                            Exit Do
                                                                                                    End If
                                                                                            ElseIf InStr(bb$, " ") > 0 Then
                                                                                                    GoTo findelsesub0
                                                                                            Else   ' jump ??
                                                                                           '' never come here
                                                                                            x2 = bstack.OriginalCode: If x2 = 0 Then x2 = FindPrevOriginal(bstack)
                                                                                                If sbf(x2).subs Is Nothing Then
                                                                                                    Set sbf(x2).subs = New FastCollection
                                                                                                End If
                                                                                            If sbf(x2).subs.ExistKey(bb$) Then
                                                                                                i = sbf(x2).subs.Value
                                                                                                bb$ = Mid$(sbf(x2).sb, i)
                                                                                                GoTo subsub02
                                                                                            Else
                                                                                                i = PosLabel(bb$, sbf(x2).sb)
                                                                                                If i <> 0 And i < Len(sbf(Abs(bstack.OriginalCode)).sb) Then
                                                                                                    sbf(x2).subs.AddKey bb$, i
                                                                                                    bb$ = Mid$(sbf(x2).sb, i)
                                                                                                    GoTo subsub02
                                                                                                End If
                                                                                            End If
                                                                                                   Exit Do
                                                                                            End If
                                                                                    ElseIf x2 = 1 Then
                                                                                            If LastErNum <> -2 Then
                                                                                                    bstack.RetStack.drop 7 * bstack.SubLevel - myLevel
                                                                                                    b$ = ec$
                                                                                                    Exec = oldexec
                                                                                                    Exit Function
                                                                                                    
                                                                                            End If
                                                                                            ' NO RETURN...DROP STACK
                                                                                            bstack.RetStack.drop 2
                                                                                            Exit Do
                                                                                    ElseIf x2 = 0 Then
                                                                                            b$ = bb$
                                                                                            Exec = 0
                                                                                            Exit Function
                                                                                    End If
                                                                            Else
                                                                             MyEr "sub not found", "δεν βρέθηκε η ρουτίνα"
                                                                             Exec = 0
                                                                                    bstack.RetStack.drop 5
                                                                                    Exit Do
                                                                            End If
                                                                    Else
                                                                            bstack.RetStack.drop 5
                                                                            Exit Do
                                                                    End If
                                                         Else
                                                          bstack.RetStack.drop 1
                                                            b$ = Chr$(0)
                                                            Exec = 2
                                                            Exit Function
                                                         End If
                                                        ' ????????
                                                
                                                End If
                                        ElseIf MaybeIsSymbol(bb$, "}") Or NocharsInLine(bb$) Then
                                                i = 1
                                                bb$ = ec$
                                        Else
                                        If monce = True Then
                                        b$ = bb$
                                        Exec = w3
                                        Exit Do
                                        End If
                                                 If subs Is Nothing Then
                                                        Set subs = New FastCollection
                                                    End If
                                                 If subs.ExistKey(bb$) Then
                                                    i = subs.Value
                                                    If i = 0 Or i > Len(ec$) Then
                                                        b$ = bb$
                                                        Exec = 2
                                                        Exit Do
                                                    Else
                                                        bb$ = Mid$(ec$, i)
                                                        GoTo fromfirst0
                                                    End If
                                                Else
                                                    i = PosLabel(bb$, ec$)
                                                    If i = 0 Or i > Len(ec$) Then
                                                        b$ = bb$
                                                        Exec = 2
                                                        Exit Do
                                                    Else
                                                      subs.AddKey bb$, i
                                                        bb$ = Mid$(ec$, i)
                                                        GoTo fromfirst0
                                                    End If
                                                End If
                                        End If
                                Else
                                loopthis = False
                                        i = 1
                                End If
                        Else
                               once = kolpo
                               Exec = 2: b$ = bb$: Exit Function
                        End If

                Case Else
                        If w3 = 12 Then
                        
                                                        b$ = bb$
                                                        Exec = 12
                                                        Exit Do
                        ElseIf w3 = 3 And bb$ = "CONTINUE" Then
                                If removebracket Then
                                        ec$ = block(b$)
                                Else
                                b$ = Mid$(b$, Len(ec$) + 1)
                                   
                                End If
                              
                                Exec = 3: Exit Do
                       ElseIf w3 = 3 And NocharsInLine(bb$) Then
                       bb$ = Mid$(b$, Len(ec$) + 1)
                       w3 = 1
                       GoTo ALFA12   ' FROM REVISION 121
                        End If
                        If IsSymbol(b$, "}") Then
                                Exec = 1: Exit Do
                                If once Then Exit Do
                        Else
                                b$ = Right$(b$, Len(b$) - Len(bb$))
                        End If
                        Exit Do
                End Select

                If myexit(bstack) Then Exec = oldexec: Exit Do

                If monce Then Exit Do
        Loop
        
executeblock = False
End Function
Function StockValues(bstack As basetask, b$, Lang As Long) As Boolean
' Stock  A[$|%| ]() in  A,B$,C(3)   copy values to stock array...and

' Stock  A[$|%| ]() out  A,B$,C(3),...  copy values to variables and make empty space in stock

' Stock A[$|%| ]()  keep  N,  B[$|%| ]()
' Stock A[$|%| ]()  sweep  N [,  value ]   fill a copy of value to n items or empty slots
Dim w$, pppp As mArray, v As Long, VN As Long, i As Long, what$, pppp1 As mArray, v1 As Long
Dim bs As New basetask, p As Variant, p1 As Variant, soros As mStiva, ww$, ss$
If Abs(IsLabel(bstack, b$, what$)) > 4 Then
        If neoGetArray(bstack, what$, pppp) Then
If Not pppp.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                If NeoGetArrayItem(pppp, bstack, what$, v, b$) Then
againhere:
                            If IsLabelSymbolNew(b$, "ΑΠΟ", "IN", Lang) Then
                            
                                If what$ = vbNullString Then Exit Function   ' no for no named array
                                Set soros = bstack.soros
                                Set bstack.Sorosref = bs.soros
                                ' Need bstack and not bs because bstack has more info inside.
                                    If MyData(bstack, b$) Then
                                     Set bstack.Sorosref = soros
                                     Set soros = Nothing
                                                   VN = v + bs.soros.Total - 1
                                                   If pppp.UpperMonoLimit >= VN Then
                                                            With bs.soros
                                                                     i = 1
                                                                     For v = v To VN
                                                                              If Not .StackItemTypeIsObject(i) Then
                                                                                       pppp.item(v) = .StackItem(i)
                                                                              Else
                                                                            If TypeOf .StackItem(i) Is mArray Then
                                                                            If .StackItem(i).Arr Then
                                                                                Set pppp1 = New mArray
                                                                                .StackItem(i).CopyArray pppp1
                                                                                Set pppp.item(v) = pppp1
                                                                                Else
                                                                                       Set pppp.item(v) = .StackItem(i)
                                                                                End If
                                                                            Else
                                                                                       Set pppp.item(v) = .StackItem(i)
                                                                                       End If
                                                                                       
                                                                              End If
                                                                              i = i + 1
                                                                     Next v
                                                            End With
                                                   Else
                                                            MyEr "Stock out of space", "Το στοκ έμεινε από χώρο"
                                                            Exit Function
                                                   End If
                                                    StockValues = True
                                                    Exit Function
                                    End If
                            ElseIf IsLabelSymbolNew(b$, "ΣΕ", "OUT", Lang) Then
                                                  
                                                                     Do
                                                                        If MyIsObject(pppp.item(v)) Then
                                                                       
                                                                                        Select Case Abs(IsLabel(bstack, b$, w$))
                                                                                        Case 1, 4
                                                                                        If GetVar(bstack, w$, i, , , , ww$) Then
                                                                                        If Typename$(var(i)) = "Group" Then
                                                                                            ss$ = bstack.GroupName
                                                                                            If ww$ <> "" Then w$ = ww$
                                                                                            If Len(var(i).GroupName) > Len(w$) Then
                                                                                                If var(i).IamRef Then
                                                                                                    ww$ = here$
                                                                                                    here$ = vbNullString
                                                                                                    UnFloatGroupReWriteVars bstack, w$, i, pppp.item(v)
                                                                                                    here = ww$
                                                                                                Else
                                                                                                    UnFloatGroupReWriteVars bstack, w$, i, pppp.item(v)
                                                                                                End If
                                                                                            Else
                                                                                                bstack.GroupName = Left$(w$, Len(w$) - Len(var(i).GroupName) + 1)
                                                                                                w$ = Left$(var(i).GroupName, Len(var(i).GroupName) - 1)
                                                                                                If Len(var(i).GroupName) > 0 Then
                                                                                                    ww$ = here$
                                                                                                    here$ = vbNullString
                                                                                                    UnFloatGroupReWriteVars bstack, w$, i, pppp.item(v)
                                                                                                    here = ww$
                                                                                                Else
                                                                                                    bstack.GroupName = ss$
                                                                                                    GroupWrongUse
                                                                                                    StockValues = False
                                                                                                    Exit Function
                                                                                                End If
                                                                                            End If
                                                                                            bstack.GroupName = ss$
                                                                                          Else
                                                                                                bs.soros.PushObj pppp.item(v)
                                                                                                bs.soros.Copy2TopItem 1
                                                                                                Set var(i) = bs.soros.PopObj
                                                                                                bs.soros.drop 1
                                                                                           
                                                                                           
                                                                                        End If
                                                                                        Else
                                                                                            i = globalvar(w$, 0)
                                                                                            
                                                                                                bs.soros.PushObj pppp.item(v)
                                                                                                bs.soros.Copy2TopItem 1
                                                                                                If TypeOf pppp.item(v) Is mArray Then
                                                                                                If pppp.item(v).Arr Then
                                                                                                
                                                                                                            Set var(i) = New mHandler
                                                                                                         var(i).t1 = 3
                                                                                                        Set var(i).objref = bs.soros.PopObj
                                                                                                        Else
                                                                                                         Set var(i) = bs.soros.PopObj
                                                                                                        End If
                                                                                                Else
                                                                                                Set var(i) = bs.soros.PopObj
                                                                                                End If
                                                                                                bs.soros.drop 1
                                                                                        End If
                                                                                        Case 3
                                                                                        If GetVar(bstack, w$, i) Then Set var(i) = pppp.item(v)
                                                                                        Case 5, 6, 7
                                                                                         If neoGetArray(bstack, w$, pppp1) Then
                                                                                         If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                                            If IsSymbol(b$, ")") Then
                                                                                                bs.soros.PushObj pppp.item(v)
                                                                                                        If Not globalArrByPointer(bs, bstack, w$) Then MyEr "No array found", "Δεν βρήκα πίνακα"
                                                                                                Else
                                                                                                        If NeoGetArrayItem(pppp1, bstack, w$, v1, b$) Then
                                                                                                               Set pppp1.item(v1) = pppp.item(v)
                                                                                                        End If
                                                                                                End If
                                                                                        ElseIf IsSymbol(b$, ")") Then
                                                                                                        bs.soros.PushObj pppp.item(v)
                                                                                                        If Not globalArrByPointer(bs, bstack, w$) Then MyEr "No array found", "Δεν βρήκα πίνακα"
                                                                                                End If

                                                                                        
                                                                                        End Select
                                                                        Else
                                                                        Select Case Abs(IsLabel(bstack, b$, w$))
                                                                                        Case 1, 3, 4
                                                                                        If GetVar(bstack, w$, i) Then
                                                                                        Else
                                                                                        i = globalvar(w$, 0)
                                                                                        End If
                                                                                        If MyIsObject(var(i)) Then
                                                                                        
                                                                                        If TypeOf var(i) Is Document Then
                                                                                            var(i).EmptyDoc
                                                                                            var(i).textDoc = pppp.item(v)
                                                                                        Else
                                                                                        
                                                                                        End If
                                                                                        Else
                                                                                        var(i) = pppp.item(v)
                                                                                        End If
                                                                                        Case 5, 6, 7
                                                                                         If neoGetArray(bstack, w$, pppp1) Then
                                                                                         If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                                         If MaybeIsSymbol(b$, ")") Then
                                                                                         If NeoGetArrayItem(pppp1, bstack, w$ + ")", v1, "") Then
                                                                                         
                                                                                         Else
                                                                                         i = -1
                                                                                         GlobalArr bstack, w$, vbNullString, 0, i
                                                                                         Set var(i) = pppp.item(v)
                                                                                         
                                                                                         End If
                                                                                         Else
                                                                                                If NeoGetArrayItem(pppp1, bstack, w$, v1, b$) Then
                                                                                                     pppp1.item(v1) = pppp.item(v)
                                                                                                End If
                                                                                         End If
                                                                                         End If
                                                                                        End Select
                                                                        
                                                                        End If
                                                                        v = v + 1
                                                                          If pppp.UpperMonoLimit < v Then
                                                                          If MaybeIsSymbol(b$, ",") Then
                                                                          MyEr "Reach array upper limit", "Έφθασα στο άνω όριο του πίνακα"
                                                                          Exit Function
                                                                          End If
                                                                          End If
                                                                        Loop Until Not FastSymbol(b$, ",")
                                                  
                                                    ElseIf IsLabelSymbolNew(b$, "ΓΙΑ", "KEEP", Lang) Then
                                                    
                                                    If IsExp(bstack, b$, p) Then
                                                            If p <> MyRound(p) Or p < 0 Then
                                                                        MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                        Exit Function
                                                            End If
                                                                     If IsSymbol(b$, ",") Then
                                                                     If Abs(IsLabel(bstack, b$, w$)) > 4 Then
                                                                        If neoGetArray(bstack, w$, pppp1) Then
                                                                        If Not pppp1.Arr Then MyEr "Need an Array", "Χρειάζομαι ένα πίνακα": Exit Function
                                                                         If NeoGetArrayItem(pppp1, bstack, w$, v1, b$) Then
                                                                                   If Not (v1 + p - 1 <= pppp1.UpperMonoLimit) Then
                                                                                                MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                                                Exit Function
                                                                                   Else
                                                                                   If pppp1 Is pppp Then
                                                                                   If v = v1 Then
                                                                                   ' do nothing
                                                                                   ElseIf Abs(v - v1) < p Then
                                                                                   'from top
                                                                                   If v1 > v Then
                                                                                               For i = p - 1 To 0 Step -1
                                                                                                                With pppp
                                                                                                                If MyIsObject(.item(i + v)) Then
                                                                                                                If i + v < v1 Then
                                                                                                                    bs.soros.PushObj .item(i + v)
                                                                                                                    bs.soros.Copy2TopItem 1
                                                                                                                    Set pppp1.item(i + v1) = bs.soros.PopObj
                                                                                                                    bs.soros.drop 1
                                                                                                                Else
                                                                                                                       Set pppp1.item(i + v1) = .item(i + v)
                                                                                                                End If
                                                                                                                Else
                                                                                                                     pppp1.item(i + v1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                    Else  ' v > V1
                                                                                            For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If MyIsObject(.item(i + v)) Then
                                                                                                                If p + v1 <= v + i Then
                                                                                                                    bs.soros.PushObj .item(i + v)
                                                                                                                    bs.soros.Copy2TopItem 1
                                                                                                                    Set pppp1.item(i + v1) = bs.soros.PopObj
                                                                                                                    bs.soros.drop 1
                                                                                                                    Else
                                                                                                                    Set pppp1.item(i + v1) = .item(i + v)
                                                                                                                    End If
                                                                                                                Else
                                                                                                                    pppp1.item(i + v1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                    
                                                                                    End If
                                                                                   Else
                                                                                            For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If MyIsObject(.item(i + v)) Then
                                                                                                                    bs.soros.PushObj .item(i + v)
                                                                                                                    bs.soros.Copy2TopItem 1
                                                                                                                    Set pppp1.item(i + v1) = bs.soros.PopObj
                                                                                                                    bs.soros.drop 1
                                                                                                                Else
                                                                                                                    pppp1.item(i + v1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                   End If

                                                                                   Else
                                                                                               For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If MyIsObject(.item(i + v)) Then
                                                                                                                    bs.soros.PushObj .item(i + v)
                                                                                                                    bs.soros.Copy2TopItem 1
                                                                                                                    Set pppp1.item(i + v1) = bs.soros.PopObj
                                                                                                                    bs.soros.drop 1
                                                                                                                    
                                                                                                                Else
                                                                                                                      pppp1.item(i + v1) = .item(i + v)
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                    End If
                                                                                    StockValues = True
                                                                                    Exit Function
                                                                                    End If
                                                                                                End If
                                                                                  End If
                                                                                  ElseIf Right$(w$, 1) = "$" Then
                                                                                   If GetVar(bstack, w$, v1) Then
                                                                                    var(v1) = vbNullString
                                                                                        Else
                                                                                        v1 = globalvar(w$, "")
                                                                                        End If
                                                                                        VN = Right$(what$, 3) = "$"
                                                                                         If p - 1 + v > pppp.UpperMonoLimit Then
                                                                                          MyEr "Invalid copy number", "Μη έγκυρος δείκτης αντιγραφής"
                                                                                         Exit Function
                                                                                         End If
                                                                                    For i = 0 To p - 1
                                                                                                                With pppp
                                                                                                                If MyIsObject(.item(i + v)) Then
                                                                                                                        If VN Then var(v1) = var(v1) + Sput("") Else var(v1) = var(v1) & " 0"
                                                                                                                Else
                                                                                                                  
                                                                                                                     Select Case Typename(.item(i + v))
                                                                                                                     Case "Double"
                                                                                                                     var(v1) = var(v1) + " " + Trim$(Str(.item(i + v)))
                                                                                                                     Case "String"
                                                                                                                     w$ = .item(i + v)
                                                                                                                     If IsNumberD2(w$, p) Then
                                                                                                                     var(v1) = var(v1) + " " + .item(i + v)
                                                                                                                     Else
                                                                                                                     var(v1) = var(v1) + Sput(.item(i + v))
                                                                                                                     End If
                                                                                                                     Case Else
                                                                                                                     If VN Then var(v1) = var(v1) + Sput("") Else var(v1) = var(v1) & " 0"
                                                                                                              
                                                                                                                     ''var(V1) = var(V1) & " " & Trim$(Str$(.item(i + V)))
                                                                                                                     End Select
                                                                                                                End If
                                                                                                                End With
                                                                                               Next i
                                                                                               
                                                                                   StockValues = True
                                                                                    Exit Function
                                                                                  End If
                                                   End If
                                                   End If

                                                    
                                                    ElseIf IsLabelSymbolNew(b$, "ΘΕΣΕ", "SWEEP", Lang) Then
                                                    If what$ = vbNullString Then Exit Function   ' no for no named array
                                                            If IsExp(bstack, b$, p) Then
                                                                            If p <> MyRound(p) Or p < 0 Then
                                                                                   MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                                   Exit Function
                                                                            End If
                                                         
                                                                If Not (v + p - 1 <= pppp.UpperMonoLimit) Then
                                                                            MyEr "Invalid index", "Μη έγκυρος δείκτης"
                                                                            Exit Function
                                                                Else
                                                                    If Not IsSymbol(b$, ",") Then
                                                                                                                For i = 0 To p - 1
                                                                                                               If MyIsObject(pppp.item(i + v)) Then
                                                                                                               Set pppp.item(i + v) = Nothing
                                                                                                               End If
                                                                                                                pppp.item(i + v) = Empty
                                                                                                                Next i
                                                                    
                                                                    Else
                                                                    
                                                                            i = 1
                                                                            what$ = aheadstatus(b$, False, i)
                                                                            Set bstack.lastobj = Nothing
                                                                            If what$ <> "" Then
                                                                                            If Left$(what$, 1) = "N" Then
                                                                                                        If IsNumber(bstack, b$, p1) Then
                                                                                                                If bstack.lastobj Is Nothing Then
                                                                                                                For i = 0 To p - 1
                                                                                                                pppp.item(i + v) = p1
                                                                                                                Next i
                                                                                                                Else
                                                                                                            bs.soros.PushObj bstack.lastobj
                                                                                                                Set bstack.lastobj = Nothing
                                                                                                                For i = 0 To p - 1
                                                                                                                bs.soros.Copy2TopItem 1
                                                                                                                Set pppp.item(i + v) = bs.soros.PopObj
                                                                                                                Next i
                                                                                                                End If
                                                                                                        End If
                                                                                            Else
                                                                                                        If IsString(bstack, b$, what$) Then
                                                                                                                If bstack.lastobj Is Nothing Then
                                                                                                                For i = 0 To p - 1
                                                                                                               
                                                                                                                pppp.item(i + v) = what$
                                                                                                                Next i
                                                                                                                Else
                                                                                                                                                bs.soros.PushObj bstack.lastobj
                                                                                                                Set bstack.lastobj = Nothing
                                                                                                                For i = 0 To p - 1
                                                                                                                bs.soros.Copy2TopItem 1
                                                                                                                Set pppp.item(i + v) = bs.soros.PopObj
                                                                                                                Next i
                                                                                                                End If
                                                                                                                End If
                                                                                                        End If
                                                                                            End If
                                                                                    End If
                                                                                    End If
                                                          
                                                            End If
                                                        End If
                                                    End If
                                                    StockValues = True
                                Else
                            b$ = what$ + b$
                            If IsExp(bstack, b$, p) Then
                            what$ = vbNullString
                            If Typename(bstack.lastobj) = myArray Then Set pppp = bstack.lastobj: Set bstack.lastobj = Nothing: GoTo againhere
                            
                            ElseIf IsStrExp(bstack, b$, what$) Then
                            what$ = vbNullString
                            If Typename(bstack.lastobj) = myArray Then Set pppp = bstack.lastobj: Set bstack.lastobj = Nothing: GoTo againhere
                            End If
                            End If
                           
                    End If
            
End Function
Public Function SubsExist() As Boolean
SubsExist = subHash.count > 0
End Function
Function preProcessor(bstack As basetask, b$) As Long
Dim ec$, ss$, w$, backup, p As Variant, backupstr$
If Len(b$) = 0 Then
preProcessor = 1: Exit Function
End If
If AscW(b$) = 39 Then backup = InStr(b$, vbCrLf) + 2 Else backup = 1
' backup show first char for code
While Mid$(b$, backup, 2) = vbCrLf
backup = backup + 2
Wend
If Mid$(b$, backup, 2) = "\#" Then
backupstr$ = Left$(b$, backup - 1)
b$ = Mid$(b$, backup + 2)

Do
        Do While FastSymbol(b$, "(")
        If FastSymbol(b$, ")") Then b$ = "()" + b$: Exit Do
                    If IsExp(bstack, b$, p) Then
                            If p = 0 Then  ''skip lines"
                                    If FastSymbol(b$, ",") Then  ''Skip lines
                                    If IsExp(bstack, b$, p) Then
                                        For p = p To 1 Step -1:    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): Next p
                                    Else
                                    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): GoTo continueloop
                                    
                                    End If
                                    Else  ' skip this
                                    w$ = GetNextLine(b$): b$ = Mid$(b$, 3): GoTo continueloop
                                    End If
                                    
                            End If
                            IsSymbol3 b$, ")"
                    End If
            Loop
    w$ = GetNextLine(b$)
    ec$ = w$
    ss$ = GetStrUntil(":", ec$)
        If ss$ = vbNullString Then
        ec$ = w$
        ss$ = GetStrUntil(" ", ec$)
        End If
    ec$ = NLtrim$(ec$)
    b$ = ReplaceStr2(ss$, ec$, b$)
While Left$(b$, 2) = vbCrLf
    b$ = Mid$(b$, 3)
Wend
continueloop:
Loop Until Not FastSymbol(b$, "\#", , 2)
b$ = backupstr$ + b$
End If
preProcessor = backup
End Function
Function newStart(basestack As basetask, rest$) As Boolean
Dim Scr As Object, s$, pa As Long
byPassCallback = False
HaltLevel = -HaltLevel
newStart = True
Set Scr = basestack.Owner
SetNormal Scr
Targets = False
ReDim q(0) As target
Scr.ForeColor = mycolor(11)
basestack.myBold = False
basestack.myitalic = False
pa = 0

            Err.Clear
            On Error Resume Next
If IsStrExp(basestack, rest$, s$) Then
            If s$ <> "" And s$ <> "*" Then MYFONT = s$ Else MYFONT = Scr.Font.name
      
                Scr.Font.charset = 0
                Scr.Font.name = MYFONT
               If Not myLcase(MYFONT) = myLcase(Scr.Font.name) Then
               Scr.Font.charset = 1
               Scr.Font.name = MYFONT
               End If
               Sleep 1
              '  mydoevents
                Scr.Font.charset = basestack.myCharSet
                    Form1.TEXT1.Font.charset = basestack.myCharSet

    Form1.List1.Font.charset = basestack.myCharSet
  '  Form1.List2.Font.CharSet = BaseSTACK.myCharSet
                Scr.FontBold = False
                Scr.FontItalic = False
            If Err.Number > 0 Then
                Err.Clear
                Scr.Font.name = FFONT
                Scr.Font.charset = basestack.myCharSet
            End If
        StoreFont Scr.Font.name, Scr.FontSize, Scr.Font.charset
        
        SetText Scr, -2, True
            s$ = vbNullString
            If FastSymbol(rest$, ",") Then
             
            If IsStrExp(basestack, rest$, s$) Then
            'rest$ = s$ & "}" & rest$
            If s$ <> "" Then s$ = ": " & s$ & "}"
            ElseIf FastSymbol(rest$, "{") Then
            s$ = ": " & block(rest$)
            If Not FastSymbol(rest$, "}") Then Set Scr = Nothing: newStart = False: Exit Function
                End If
                End If
            original basestack1, s$  ' set...
            
Else
    MyEr "", ""
    closeAll ' we closed all files
    If AVIRUN Then MediaPlayer1.stopMovie
    PlaySoundNew ""
    
    If basestack.toprinter Then
    getnextpage
    End If
    Set Scr = Form1.DIS
  
    Form1.myBreak basestack
    basestack.toprinter = False
    players(DisForm).mypen = mycolor(PenOne)
    players(DisForm).Paper = mycolor(PaperOne)

    Form1.Cls
    
    original basestack1, "NEW:CLEAR"

    basestack.soros.Flush

End If

End Function
Sub newHide(basestack As basetask)
Dim Scr As Object
Set Scr = basestack.Owner
If Scr.name = "DIS" Or Scr.name = "dSprite" Then
Scr.Visible = False
End If
MyDoEvents1 Scr
Set Scr = Nothing
End Sub

Sub newshow(bstack As basetask)
On Error Resume Next
Dim Scr As Object
Set Scr = bstack.Owner
If Scr.name = "DIS" Or Scr.name = "dSprite" Then
If Not Form1.Visible Or Form1.TrueVisible Then
backhere:
If UseMe Is Nothing Then
Form3.skiptimer = True
Form3.Visible = True: If Form3.WindowState = 0 Then Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000
mywait basestack1, 100
Form3.CaptionWsilent = ExtractNameOnly(cLine)
Else
PlaceCaption ExtractNameOnly(cLine)
If Err.Number > 0 Then
Err.Clear: Set UseMe = Nothing
Form3.skiptimer = True
Form3.Visible = True: If Form3.WindowState = 0 Then Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000
mywait basestack1, 100
Form3.CaptionWsilent = ExtractNameOnly(cLine)
End If
End If
End If
If Form1.Visible = False Then
conthere:
    If ttl Then
        If Form3.WindowState = 1 Then
           Form1.Visible = True
            Form3.skiptimer = True
            Form3.Visible = True
            Form3.skiptimer = True
            Form3.WindowState = 0
              
            Do While Not Form1.Visible Or NOEXECUTION
                mywait bstack, 1
                Sleep 10
            Loop
            If Form3.WindowState = 0 Then Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000
            Form3.Timer1.Interval = 20
            Form3.Show
            Sleep 50
            Form3.CaptionW = ""
            PlaceCaption ""
            If Form3.Visible Then Form3.Refresh
            MyDoEvents1 Form3, True
            mywait bstack, 50
        End If
    Else
        Form1.Show , Form5
        mywait bstack, 5
    End If
Else
    If ttl Then
    ' we have title
        If Form3.WindowState = 1 Then
        Form3.Visible = True: Form3.WindowState = 0: If Form3.WindowState = 0 Then Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000
            Do While Not Form1.Visible Or NOEXECUTION
           mywait bstack, 5
                Loop
        End If
    Else
     Form1.Show , Form5
     mywait bstack, 5
    End If
End If
If Typename(Scr) = "PictureBox" Then
If Scr.Parent.Visible = False Then
Scr.Parent.Visible = True
mywait bstack, 5
End If
End If
    Scr.Visible = True
        Do While Not Scr.Visible Or NOEXECUTION
mywait bstack, 5
        Loop
If Scr.Visible Then
Scr.SetFocus

End If
End If
Set Scr = Nothing
End Sub
Sub TraceStore(b As basetask, v As Long, c$, o&, Optional r&)
     v = b.addlen
     r& = Len(c$) - o&

         b.addlen = r& + b.addlen
         
End Sub
Sub TraceRestore(b As basetask, v As Long)
         b.addlen = v
End Sub
Sub ProcBackGround(bstack As basetask, rest$, Lang As Long, afier As Boolean)
Dim s$, p As Variant, i As Long, x1 As Long, x As Double, y As Double, F As Long, y1 As Long, sX As Double, ss$, pa$, it As Long
Dim Scr As Object, frm$, w3 As Long, ya As Long, AddTwipsTopL As Long
Set Scr = bstack.Owner
afier = True
Dim prive As basket
If IsLabelSymbolNew(rest$, "ΜΟΥΣΙΚΗ", "MUSIC", Lang) Then
If IsStrExp(bstack, rest$, s$) Then
 'OPEN OR REPLACE
 If s$ <> "" Then
                    If ExtractType(s$) = vbNullString Then s$ = s$ & ".avi"
                    If CFname(s$) = vbNullString Then
                        s$ = mcd & s$: If CFname(s$) = vbNullString Then Exit Sub
                    Else
                        s$ = CFname(s$)
                    End If
                   If s$ <> "" Then
                   MediaBack1.closeMovie
                   MediaBack1.FileName = s$
                   MediaBack1.openMovie
                   MediaBack1.playMovie
                   End If
                Else
                    afier = False
                    Exit Sub
                End If
Else
' CLOSE
MediaBack1.closeMovie
End If
Else
If Not IsExp(bstack, rest$, p) Then p = 0   '' no change

If FastSymbol(rest$, "{") Then
ss$ = block(rest$)

frm$ = rest$
If FastSymbol(rest$, "}") Then
'' check players(-2)
If players(-1).SZ = 0 Or Not NoBackFormFirstUse Then
NoBackFormFirstUse = True
prive = players(GetCode(Scr))
SetTextBasketBack Form1, prive
    SetText Form1, prive.MineLineSpace, True    'load Players() with first values
    With players(-1)
    .curpos = 0
    .currow = 0
    .mysplit = 0
    .osplit = 0
    .Paper = prive.Paper
    End With
            With Prefresh(-1)
        .k1 = uintnew(timeGetTime + REFRESHRATE): .RRCOUNTER = 1
        End With
End If
If p > 0 Then
SetTextSZ Form1, CSng(p)
End If
w3 = bstack.tolayer
bstack.toback = True
Set bstack.Owner = Form1
If NLtrim(ss$) = vbNullString Then
If players(-1).Paper <> Form1.backcolor Then
Form1.backcolor = players(-1).Paper
 End If
it = 1
Else
 ss$ = "{" & ss$ & "}"
afier = executeblock(it, bstack, ss$, False, False) = 0
End If
 MyDoEvents2 bstack.Owner

Set bstack.Owner = Scr
bstack.tolayer = w3
bstack.toback = False
If it <> 1 Then
If Trim(ss$) = vbNullString Then ss$ = " "
rest$ = Left$(ss$, Len(ss$) - 1) + frm$: afier = False: Exit Sub
End If

End If
End If

End If

End Sub

Sub SetSizeAndHotSpot(thisbasket As basket, MaxX As Long, MaxY As Long, Optional ByVal HotSpotX = 0, Optional ByVal HotSpotY = 0)
With thisbasket
.MAXXGRAPH = MaxX
.MAXYGRAPH = MaxY
If Not IsMissing(HotSpotX) Then .x = CLng(HotSpotX)  ' this is hotspot
If Not IsMissing(HotSpotY) Then .y = CLng(HotSpotY)
End With
End Sub
Sub FeedBasket(ddd As Object, thisbasket As basket, alinespace As Long)
With thisbasket
.FontName = ddd.FontName
.SZ = ddd.FontSize
.charset = ddd.Font.charset
.MineLineSpace = alinespace
.uMineLineSpace = alinespace
''.Paper = ddd.BackColor
FrameText ddd, .SZ, 0, 0, -.Paper, (ddd.name <> "Form1")

End With
End Sub
Sub PlaceBasketPrive(ddd As Object, thisbasket As basket)
On Error Resume Next
With thisbasket
If Not ddd.FontName = .FontName And ddd.Font.charset = .charset And ddd.FontSize = .SZ Then
ddd.Font.charset = 0
ddd.FontSize = 9
ddd.FontName = .FontName
ddd.Font.charset = .charset
ddd.FontSize = .SZ
End If
' these I have to delete after change
End With
End Sub
Sub PlaceBasket(ddd As Object, thisbasket As basket)
On Error Resume Next
With thisbasket
If Not (ddd.FontName = .FontName And ddd.Font.charset = .charset And ddd.Font.Size = .SZ) Then
StoreFont .FontName, .SZ, .charset
ddd.Font.charset = 0
ddd.FontSize = 9
ddd.FontName = .FontName
ddd.Font.charset = .charset
ddd.FontSize = .SZ
End If
ddd.ForeColor = .mypen
End With
End Sub
Function GetCode(dq As Object) As Long
Dim u As Long
If TypeOf dq Is GuiM2000 Then

' each gui* take a number above 32
On Error Resume Next
u = dq.prive
If Err > 0 Then Err.Clear: oxiforforms: GetCode = -1: Set dq = Form1: Exit Function
If u = 0 Then
For u = 33 To 132
If Not players(u).used Then Exit For
Next u
If u = 133 Then oxiforforms: GetCode = -1: Set dq = Form1: Exit Function
dq.prive = u

players(u) = Zero
players(u).used = True
End If

GetCode = u
Else
If dq Is Form1.DIS Then
GetCode = 0
ElseIf dq Is Form1 Then
GetCode = -1
ElseIf dq Is Form1.PrinterDocument1 Then
GetCode = -2
ElseIf dq.name = "dSprite" Then
    GetCode = val("0" & Form1.dSprite(dq.index).Tag)
End If
End If
End Function
Sub RepPlain(bstack As basetask, Scr As Object, txt$)
Dim prive As Long
prive = GetCode(Scr)
If players(prive).curpos > 0 Then crNew bstack, players(prive)
wwPlain bstack, players(prive), txt$, Scr.Width, 100000, True
If players(prive).curpos > 0 Then crNew bstack, players(prive)
End Sub
Sub ProcWindow(bstack As basetask, rest$, Scr As Object, ifier As Boolean)
Dim x1 As Long, y1 As Long, p As Variant, useScreen As Long
If Scr.name = "GuiM2000" Then
    Else
If Scr.name = "Form1" Then
    DisableTargets q(), -1
ElseIf Scr.name = "DIS" Then
    DisableTargets q(), 0
ElseIf Scr.name = "dSprite" Then
    DisableTargets q(), val(Scr.index)
End If
End If
With players(GetCode(Scr))
If .double Then SetNormal Scr
        If IsExp(bstack, rest$, p) Then
            .SZ = p
            If .SZ < 4 Then .SZ = 4
            If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, p) Then
                    x1 = CLng(p)
again:
                    If x1 >= 0 And x1 <= DisplayMonitorCount - 1 And Scr.name = "DIS" Then
                    Console = x1
                    
                    If Not Form1.WindowState = 0 Then Form1.WindowState = 0: Form1.Refresh
                    
                    If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
                    If IsWine Then
                        Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top
                        If Form1.Width = ScrInfo(Console).Width Then
                        Form1.Width = ScrInfo(Console).Width - 1
                        Else
                        Form1.Width = ScrInfo(Console).Width
                        End If
                        Form1.Height = ScrInfo(Console).Height
                        Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top
                    
                    Else
                        Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top, ScrInfo(Console).Width - 1, ScrInfo(Console).Height - 1
                    End If
                    FrameText Scr, .SZ, CLng(Form1.Width), CLng(Form1.Height), .Paper
                    players(-1).MAXXGRAPH = .MAXXGRAPH
                    players(-1).MAXYGRAPH = .MAXYGRAPH
                   
                    Exit Sub
                    
                ElseIf x1 > 3000 Then
                    y1 = CLng(x1 * ScrInfo(Console).Height / ScrInfo(Console).Width)
                ElseIf Scr.name <> "DIS" Then
                    
                Else
                    x1 = 0
                    GoTo again
                End If
        End If
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = CLng(p)
    End If
    If Scr.name = "GuiM2000" Then
        useScreen = FindMonitorFromMouse
        Set Scr.Picture = LoadPicture("")
               If FastSymbol(rest$, ";") Then 'CENTER
                    FrameText Scr, .SZ, x1, y1, .Paper, True
                    Scr.Move (ScrInfo(useScreen).Width - .MAXXGRAPH) / 2, (ScrInfo(useScreen).Height - .MAXYGRAPH) / 2
                Else
                    If x1 = 0 Then x1 = 14000
                    If y1 = 0 Then y1 = 6000
                    Scr.Move Scr.Left, Scr.Top, x1, y1
                    FrameText Scr, .SZ, 0, 0, .Paper, True
                            
            End If
            SetTextSZ Scr, .SZ
    ElseIf Scr.name = "dSprite" Then
            RsetRegion Scr
            Set Scr.Picture = LoadPicture("")
            If FastSymbol(rest$, ";") Then 'CENTER
                        FrameText Scr, .SZ, x1, y1, .Paper, True
                        Scr.Move (ScrInfo(Console).Width - .MAXXGRAPH) / 2, (ScrInfo(Console).Height - .MAXYGRAPH) / 2
            Else
                        Scr.Move Scr.Left, Scr.Top, x1, y1

                        FrameText Scr, .SZ, 0, 0, .Paper, True
                        
            End If
            SetTextSZ Scr, .SZ
    Else
        If FastSymbol(rest$, ";") Then 'CENTER
            Form1.WindowState = 0
            If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
            
            FrameText Scr, .SZ, x1, y1, .Paper
                    
                    If IsWine Then
                        If .MAXXGRAPH = ScrInfo(Console).Width Then
                        Form1.Width = .MAXXGRAPH - 1
                        Else
                        Form1.Width = .MAXXGRAPH
                        End If
                        Form1.Height = .MAXYGRAPH
                        'Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top
                        Form1.Move ((ScrInfo(Console).Width - 1) - Form1.Width) / 2 + ScrInfo(Console).Left, ((ScrInfo(Console).Height - 1) - Form1.Height) / 2 + ScrInfo(Console).Top
                    Else
            
            Form1.Move ScrInfo(Console).Left + (ScrInfo(Console).Width - .MAXXGRAPH) / 2, ScrInfo(Console).Top + (ScrInfo(Console).Height - .MAXYGRAPH) / 2, .MAXXGRAPH, .MAXYGRAPH
            End If
            Form1.Up
            scrMove00 Scr
            If Form1.Visible Then
                 If form5iamloaded Then
                     Form1.Show , Form5
                 Else
                     Form1.Show
                 End If
             End If
        Else
            Form1.WindowState = 0
            If Form1.Top > VirtualScreenHeight() - 100 Then Form1.Top = ScrInfo(Console).Top
            FrameText Scr, .SZ, x1, y1, .Paper
            If IsWine Then
                        If .MAXXGRAPH = ScrInfo(Console).Width Then
                        Form1.Width = .MAXXGRAPH - 1
                        Else
                        Form1.Width = .MAXXGRAPH
                        End If
                        Form1.Height = .MAXYGRAPH
                        Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top
                                           Else
            
            
            
            Form1.Move ScrInfo(Console).Left, ScrInfo(Console).Top, .MAXXGRAPH, .MAXYGRAPH
            End If
            players(-1).MAXXGRAPH = .MAXXGRAPH
            players(-1).MAXYGRAPH = .MAXYGRAPH
            Form1.Up
            scrMove00 Scr
            If Form1.Visible Then
                If form5iamloaded Then
                    Form1.Show , Form5
                Else
                    Form1.Show
                End If
            End If
    End If
End If
Else
ifier = False
Exit Sub
End If
''SleepWait 4
End With
End Sub


Function GetRealPos(dq As Object) As Long
Dim mybasket As basket, oldx
mybasket = players(GetCode(dq))
If mybasket.lastprint Then
oldx = dq.CurrentX
dq.CurrentX = dq.CurrentX + mybasket.Xt - dv15
GetXYb dq, mybasket, mybasket.curpos, mybasket.currow
dq.CurrentX = oldx
End If

 GetRealPos = mybasket.curpos
End Function
Function GetRealRow(dq As Object) As Long
Dim mybasket As basket
mybasket = players(GetCode(dq))
If mybasket.lastprint Then
GetXYb dq, mybasket, mybasket.curpos, mybasket.currow
End If

 GetRealRow = mybasket.currow
End Function

Function Funcweak(basestack As basetask, s$, Optional w As Long, Optional lastname As String) As String
' no validation of names
' check for "dot"
Dim ww$, original$, s1$, ww1$, p As Variant, w1 As Long
again:
w = IsLabel(basestack, s$, lastname)
ww$ = lastname$
ww1$ = ww$
If w >= 5 Then
s1$ = "&" + ww$ + ")"
w1 = IsLabel(basestack, s1$, ww$)
If w1 = 2 Then
' IT IS A FUNCTION
 ww1$ = ww1$ + ")"
GetSubFullName ww1$, ww$
If FastSymbol(s$, ")") Then
If here$ = vbNullString Then
Funcweak = ww1$
Else
Funcweak = here$ + "." + ww1$
End If
End If
ElseIf w1 = 0 Then
If ISSTRINGA(s1$, ww$) Then
If FastSymbol(s$, ")") Then
Funcweak = ww$
Else
' check parameters
'ww$ = ww$ + "("
again12:
Do

If IsExp(basestack, s$, p) Then
ww$ = ww$ + CStr(p)
ElseIf IsStrExp(basestack, s$, ww1$) Then
ww$ = ww$ + Chr$(34) + ww1$ + Chr$(34)
End If

If Not FastSymbol(s$, ",") Then Exit Do
ww$ = ww$ + ","
Loop
If FastSymbol(s$, ")") Then ww$ = ww$ + ")"
    If FastSymbol(s$, ".") Then ' ............
        If AscW(s$) > 64 Then
            If IsLabelOnly(s$, ww1$) > 3 Then
            ww$ = ww$ + "." + ww1$
            GoTo again12
            Else
             ww$ = ww$ + "." + ww1$
            End If
        End If
    
    End If

Funcweak = ww$
End If
End If
End If
Else

s1$ = "&" + ww$
If IsLabel(basestack, s1$, ww1$) = 0 Then

If s1$ = vbNullString Then

GetSubFullName ww$, ww1$
Funcweak = ww1$
Else

If ISSTRINGA(s1$, ww1$) Then
If FastSymbol(s$, ".") Then

If Right$(ww1$, 1) = "$" Then
If IsStrExp(basestack, ww1$, ww$) Then
s$ = ww$ + "." + s$
GoTo again
End If
End If
End If
Funcweak = ww1$
End If
End If
End If
End If

End Function
Function VariantType(a As Variant) As Integer
    GetMem2 VarPtr(a), VariantType
End Function

Static Function MyRound(a As Variant, Optional ByVal i As Integer = 0)
Dim c As Variant, j As VbVarType
Dim n(1 To 28) As Single, d(1 To 28) As Double, cur(1 To 28) As Currency, dec(1 To 28) As Variant
Dim SG(-1 To 1) As Single, sg4(-1 To 1) As Double, sg8(-1 To 1) As Currency
j = VarType(a)
If j < vbSingle Then MyRound = a: Exit Function
On Error GoTo there
If n(1) = 0 Then
    SG(-1) = CSng(-0.5)
    SG(1) = CSng(0.5)
    sg4(-1) = -0.5
    sg4(1) = 0.5
    sg8(-1) = CCur(-0.5)
    sg8(1) = CCur(0.5)
    For c = 1& To 6&
        n(c) = CSng(10 ^ c)
    Next c
    For c = 7& To 27&
        n(c) = CSng(-1)
    Next c
        n(c) = CSng(10 ^ 5)
        n(10) = CSng(10 ^ 5)
    For c = 1& To 13&
        d(c) = CDbl(10 ^ c)
    Next c
    For c = 14& To 27&
        d(c) = CDbl(-1)
    Next c
    d(c) = CDbl(10 ^ 13)
    
    For c = 1& To 3&
        cur(c) = CCur(10 ^ c)
    Next c
    For c = 4& To 28&
        cur(c) = CCur(-1)
    Next c
    For c = 1& To 28&
        dec(c) = CDec(10 ^ c)
    Next c
End If
    If i = 0 Then
        MyRound = Sgn(a) * Int(Abs(a) + 0.5)
        Exit Function
    Else
        c = Fix(a)
        Select Case j
        Case vbSingle
            If n(i) > 0 Then
                c = SG(Sgn(a))
                MyRound = Fix(a * n(i) + c) / n(i)
            Else
                MyRound = a
            End If
            Exit Function
        Case vbDouble
            c = sg4(Sgn(a))
 
            If d(i) > 0 Then
                MyRound = Fix(a * d(i) + c) / d(i)
            Else
                MyRound = a
            End If
            Exit Function
        Case vbCurrency
            If cur(i) > 0 Then
                c = sg8(Sgn(a))
                MyRound = Fix(a) + Fix((a - Fix(a)) * cur(i) + c) / cur(i)
            Else
                MyRound = a
            End If
            Exit Function
        Case vbDecimal
            c = sg8(Sgn(a))
            MyRound = Fix(a) + Fix((a - Fix(a)) * dec(i) + c) / dec(i)
            Exit Function
        Case Else
            MyRound = a
            Exit Function
        End Select
    End If
there:
Err.Clear
MyRound = a
If i < 0 Or i > 28 Then MyEr "Round Place exit range 0 to 28", "Η θέση στρογγυλοποίησης εκτός περιοχής από 0 έως 28"
End Function


Function AllocVar()
var2used = var2used + 1
  If UBound(var()) <= var2used + 20 Then
        On Error Resume Next

            ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
               ReDim Preserve var(UBound(var()) * 2 + 1) As Variant
            If Err.Number > 0 Then
            If UBound(var()) <= var2used Then
            Err.Clear
            Else
            NOEXECUTION = True
            MyEr Err.Description, Err.Description
            Err.Clear
            Exit Function
            End If
            End If
            
        End If
       AllocVar = var2used
End Function
Function AllocSub() As Long
    On Error Resume Next
    If UBound(sbf()) <= sb2used + 1 Then
    ReDim Preserve sbf(UBound(sbf()) * 2 + 1) As modfun
    End If
    sb2used = sb2used + 1
    AllocSub = sb2used
End Function
Public Function ExpEnvirStr(strInput) As String
Dim Result As Long
Dim strOutput As String
'' Two calls required, one to get expansion buffer length first then do expansion
strOutput = Space$(1000)
Result = ExpandEnvironmentStrings(StrPtr(strInput), StrPtr(strOutput), Result)
strOutput = Space$(Result)
Result = ExpandEnvironmentStrings(StrPtr(strInput), StrPtr(strOutput), Result)
ExpEnvirStr = StripTerminator(strOutput)
End Function
Function ProcEventVarSet(bstack As basetask, i As Long) As mEvent

If i = -1 Then  '
    If Typename(bstack.lastobj) = "mEvent" Then
    Set ProcEventVarSet = bstack.lastobj
    Else
    MyEr "Not found an object Event", "Δεν βρήκα ένα αντικείμενο Γεγονός"
    Exit Function
    End If
Else
    Set ProcEventVarSet = var(i)
End If
End Function
Function ProcEvent(bstack As basetask, rest$, Lang As Long, i As Long) As Boolean
'look for { }, or hold
Dim aa As mEvent, s$, lastname$, dd As Long, pm As Long, pf As Long
ProcEvent = True
Dim ss$, rd$, ss1$
If FastSymbol(rest$, "{") Then
Set aa = ProcEventVarSet(bstack, i)
aa.BypassInit 10
aa.VarIndex = i
If here$ = vbNullString Then
    aa.NoHere = bstack.GroupName
Else
    aa.NoHere = here$ + "." + bstack.GroupName
End If
aa.enabled = True
ss$ = NLtrim$(block(rest$))
rd$ = vbNullString
While ss$ <> ""
If FastSymbol(ss$, vbCrLf) Then
ss$ = NLtrim(ss$)
ElseIf IsLabelSymbolNew(ss$, "ΔΙΑΒΑΣΕ", "READ", Lang) Then
If Lang = 1 Then
If rd$ = vbNullString Then rd$ = "READ "
Else
If rd$ = vbNullString Then rd$ = "ΔΙΑΒΑΣΕ "
End If

Do
dd = 1
      s$ = aheadstatus(ss$, , dd)
      If s$ <> "" Then
      pm = pm + 1
      If IsLabelOnly((ss$), ss1$) Then
   
            If pm < 2 Then
            rd$ = rd$ + Left$(ss$, dd - 1)
            Else
            rd$ = rd$ + "," + Left$(ss$, dd - 1)
            End If
      
      ss$ = Mid$(ss$, dd)
      Else
      ProcEvent = False
      Exit Function
      End If
      Else
      Exit Do
      End If
   Loop Until Not FastSymbol(ss$, ",")

ElseIf IsLabelSymbolNew(ss$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", Lang) Then
'' check only for blocks
pf = pf + 1
If FastSymbol(ss$, "{") Then
s$ = "{" + rd$ + vbCrLf + block(ss$) + "}" + here$ + "." + bstack.GroupName
If Not FastSymbol(ss$, "}") Then ProcEvent = False: Exit Function
aa.GenItemCreator LTrim(Str(pf * 123)), s$
While ss$ <> ""
If FastSymbol(ss$, vbCrLf, , 2) Then
    ss$ = NLtrim(ss$)
ElseIf IsLabelSymbolNew(ss$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", Lang) Then
        If FastSymbol(ss$, "{") Then
            s$ = "{" + rd$ + vbCrLf + block(ss$) + "}"
            If Not FastSymbol(ss$, "}") Then ProcEvent = False: Exit Function
            ' βάλε ένα key
            pf = pf + 1
            aa.GenItemCreator LTrim(Str(pf * 123)), s$
        Else
            ProcEvent = False: Exit Function
        End If
Else
    ProcEvent = False: Exit Function
End If
Wend
End If
Else
    ProcEvent = False: Exit Function
End If
Wend
aa.ParamBlock rd$, pm




Set aa = Nothing

If Not FastSymbol(rest$, "}") Then ProcEvent = False: Exit Function
' do something
' find Read command and some Functions
ElseIf IsLabelSymbolNew(rest$, "ΑΦΗΣΕ", "RELEASE", Lang) Then
    Set aa = ProcEventVarSet(bstack, i)
    aa.enabled = True
ElseIf IsLabelSymbolNew(rest$, "ΚΡΑΤΗΣΕ", "HOLD", Lang) Then
    Set aa = ProcEventVarSet(bstack, i)
    aa.enabled = False
ElseIf IsLabelSymbolNew(rest$, "ΚΑΘΑΡΟ", "CLEAR", Lang) Then
    Set aa = ProcEventVarSet(bstack, i)
    aa.enabled = False
    aa.BypassInit 10
ElseIf IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", Lang) Then
    Set aa = ProcEventVarSet(bstack, i)
    Do
        dd = 1
        ss$ = aheadstatus(rest$, , dd)
        If ss$ = "S" Then
            lastname$ = here$ + "." + MyTrim(myUcase(Left(rest$, dd - 1), True))
            If Not IsStrExp(bstack, rest$, s$) Then ProcEvent = False: Exit Function
        ElseIf ss$ = "N" Then
            ss$ = "&" + Left$(rest$, dd)
            If Not IsString(bstack, (ss$), s$) Then
                ProcEvent = False: Exit Function
            Else
                lastname$ = subHash.LastKnown
            End If
            rest$ = Mid$(rest$, dd)
        Else
            s$ = vbNullString
        End If
        If Len(s$) > 1 Then
            If Not aa.StandBy("(FREE)", lastname$, s$) Then aa.GenItemCreator lastname$, s$
        Else
            ProcEvent = False
            Exit Function
        End If
    Loop Until Not FastSymbol(rest$, ",")
    Set aa = Nothing
ElseIf IsLabelSymbolNew(rest$, "ΠΕΤΑ", "DROP", Lang) Then
    Set aa = ProcEventVarSet(bstack, i)
    Do
        dd = 1
        ss$ = aheadstatus(rest$, , dd)
        If ss$ = "S" Then
              lastname$ = here$ + "." + MyTrim(myUcase(Left(rest$, dd - 1), True))
              If Not IsStrExp(bstack, rest$, s$) Then ProcEvent = False: Exit Function
        ElseIf ss$ = "N" Then
              ss$ = "&" + Left$(rest$, dd)
              If Not IsString(bstack, (ss$), s$) Then
                  ProcEvent = False: Exit Function
              Else
                  lastname$ = subHash.LastKnown
              End If
              rest$ = Mid$(rest$, dd)
        Else
                s$ = vbNullString
        End If
        If Len(s$) > 1 Then
            aa.StandBy lastname$, "(FREE)", "" ' no erroro if not found
        Else
            ProcEvent = False
            Exit Function
        End If
    Loop Until Not FastSymbol(rest$, ",")
    Set aa = Nothing
    Exit Function
End If
Set aa = Nothing
End Function
Sub CopyEvent(a As Variant, bstack As basetask)
Dim alfa As New mEvent, i As Long
Dim aa As mEvent
Set aa = a
'' now put code to copy a to alfa
alfa.BypassInit CLng(a.CurMaxSpace)
Dim aaa() As GenItem, bbb() As Long, mytop As Long
aa.CopySpaceUp aaa(), bbb(), mytop
alfa.CopySpaceDown aaa(), bbb(), mytop
alfa.ParamBlock aa.ParamsRead, aa.params
alfa.NoHere = aa.NoHere
Set bstack.lastobj = alfa
Set aa = Nothing
End Sub
Function CallEvent(bstack As basetask, rest$, Lang As Long, ByVal i As Long) As Boolean
If i > -1 Then
If Typename(var(i)) <> "mEvent" Then
Exit Function
End If
Else
If Typename(bstack.lastobj) <> "mEvent" Then
Exit Function
End If
End If
CallEvent = True
Dim a As mEvent, n$, F$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
FastSymbol rest$, ","
If i < 0 Then
Set a = bstack.lastobj
i = var2used + CLng(Rnd(1000))
Else
Set a = var(i)
End If
''bstack.Look2Parent = True
If Not PushParamGeneral(bstack, rest$) Then

CallEvent = False
Set a = Nothing
Exit Function

End If
''bstack.Look2Parent = False
Dim j As Long, k, s1$, klm As Long
Set oldbstack = bstack.soros
Dim ohere$
ohere$ = here$
If a Is Nothing Then Exit Function
For j = 0 To a.count - 1
here$ = "EV" + CStr(i) + "." + CStr(j)
If a.enabled Then
a.ReadVar j, n$, F$
If F$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            bb.Copy2TopNItems2FromStiva a.params, oldbstack
            PushStage bstack, False
            s1$ = Mid$(F$, 2, rinstr(F$, "}") - 2)
            klm = ModuleSub("A_()", s1$, Trim$(Mid$(F$, Len(s1$) + 3)))
            
            If Not ProcModuleEntry(bstack, "A_()", klm, "", , True) Then
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
            PopStage bstack

bb.Flush
End If
End If
Next j
conthere:
Set bstack.Sorosref = oldbstack
Set oldbstack = Nothing
bstack.soros.drop a.params
Set bb = Nothing

here$ = ohere$
End Function
Public Function CallEventFromGui(gui As Object, a As mEvent, aString$) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
olescok = escok
escok = False
extr = extreme
extreme = True
tr = trace
If Rnd * 100 > 3 Then trace = False
On Error Resume Next

CallEventFromGui = True
Dim n$, F$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = New basetask
With bstack
    .IamAnEvent = True
Set .Owner = basestack1.Owner
Set .StaticCollection = EventStaticCollection
End With
Dim i As Long
If a Is Nothing Then GoTo conthere1
i = a.VarIndex
bstack.soros.DataStr aString$
If gui.index >= 0 Then
bstack.soros.DataVal gui.index
End If
bstack.soros.DataObj gui

Set oldbstack = bstack.soros
Dim j As Long, s1$, klm As Long
Dim ohere$
ohere$ = here$
For j = 0 To a.count - 1
here$ = "EV" + CStr(i) + "." + CStr(j)
If a.enabled Then
a.ReadVar j, n$, F$
If F$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            bb.Copy2TopNItems2FromStiva a.params, oldbstack
            PushStage bstack, False
            s1$ = Mid$(F$, 2, rinstr(F$, "}") - 2)
            klm = ModuleSub("A_()", s1$, Trim$(Mid$(F$, Len(s1$) + 3)))
            
            If Not ProcModuleEntry(bstack, "A_()", klm, "", , True) Then
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
            PopStage bstack

bb.Flush
End If
End If
Next j
conthere:
Set bstack.Sorosref = oldbstack
Set oldbstack = Nothing
bstack.soros.drop a.params
Set bb = Nothing
here$ = ohere$
conthere1:
extreme = extr
If tr Then
'If STEXIT Then trace = tr
trace = tr
End If
Set basestack1.StaticCollection = bstack.StaticCollection

'bstack.IamAnEvent = oldstatus
escok = olescok
End Function
Public Function CallEventFromGuiOne(gui As Object, a As mEvent, aString$) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
CallEventFromGuiOne = True
olescok = escok
escok = False
tr = trace
extr = extreme
extreme = True
If Rnd * 100 > 3 Then trace = False
Dim n$, F$, F1$, bb As mStiva, uIndex As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
Set bstack.StaticCollection = EventStaticCollection
bstack.IamAnEvent = True
Dim i As Long
If a Is Nothing Then GoTo conthere0
i = a.VarIndex
uIndex = gui.index
If uIndex >= 0 Then
bstack.soros.DataVal CDbl(uIndex)
uIndex = 1
End If
uIndex = uIndex + 1
F1$ = gui.modulename$
bstack.soros.DataObj gui

Dim j As Long, k As Long, s1$, klm As Long, s2$
Dim ohere$
ohere$ = here$
here$ = "EV" + CStr(i)
If a.enabled Then
            PushStage bstack, False
            IsLabelOnly (aString$), F$
            n$ = Mid$(aString$, Len(F$) + 1)
            n$ = Left$(n$, Len(n$) - 1)
            If n$ <> "" Then
           If uIndex > 0 Then
            n$ = "Data " + n$ + " : ShiftBack Stack.Size" + Str(1 - uIndex) + "," + Str$(uIndex) + vbCrLf
            Else
            n$ = "Data " + n$ + " : ShiftBack Stack.Size" + vbCrLf
            End If
            End If
            If F1$ <> "" Then F$ = myUcase(F1$ + "." + F$ + ")", True) Else F$ = myUcase(F$ + ")", True)
            If Not GetSub(F$, klm) Then
            PopStage bstack: CallEventFromGuiOne = False: GoTo conthere
            End If
            s1$ = sbf(klm).sb
            If Left$(s1$, 10) = "'11001EDIT" Then
            SetNextLine s1$
            End If
            If F1$ <> "" Then s1$ = n$ + "Module " + F1$ + vbCrLf + sbf(klm).sb Else s1$ = n$ + sbf(klm).sb
            If Execute(bstack, s1$, False, False) = 0 Then
            If F1$ = "" Then
            MyEr "Problem in Event " + aString$, "Πρόβλημα στο γεγονός " + aString$
            Else
            MyEr "Problem in Event " + aString$ + " in module " + F1$, "Πρόβλημα στο γεγονός " + aString$ + " στο τμήμα " + F1$
            End If
            bstack.soros.Flush
                PopStage bstack
                GoTo conthere
            End If
            PopStage bstack
End If
conthere:
Set bstack = Nothing
here$ = ohere$
conthere0:
If tr Then
'If STEXIT Then
trace = tr
End If
extreme = extr
escok = olescok
End Function
Public Function CallEventFromGuiNow(gui As Object, a As mEvent, aString$, vrs()) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
olescok = escok
escok = False
CallEventFromGuiNow = True
extr = extreme
extreme = True
tr = trace
If Rnd * 100 > 3 Then trace = False
Dim n$, F$, F1$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
Set bstack.StaticCollection = EventStaticCollection
bstack.IamAnEvent = True
Dim i As Long
If a Is Nothing Then GoTo conthere0
i = a.VarIndex
F1$ = gui.modulename$
Set oldbstack = bstack.soros
Dim j As Long, k As Long, s1$, klm As Long, s2$
Dim ohere$
ohere$ = here$
'For j = 0 To a.Count - 1

here$ = "EV" + CStr(i)

If a.enabled Then
a.ReadVar 0, n$, F$
If F$ <> "" Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            PushStage bstack, False
            For k = LBound(vrs()) To UBound(vrs()) - 1
            If VarType(vrs(k)) = vbString Then
            globalvar "EV" + CStr(i + k) + "$", vrs(k)
            bb.DataStr here$ + "." + "EV" + CStr(i + k) + "$"
            Else
            globalvar "EV" + CStr(i + k), vrs(k)
            bb.DataStr here$ + "." + "EV" + CStr(i + k)
            End If
            
            
            Next k
            bb.DataObj gui
             
            IsLabelOnly (aString$), F$
            n$ = Mid$(aString$, Len(F$) + 1)
            If Len(n$) > 0 Then
            
            n$ = Left$(n$, Len(n$) - 1)
            If n$ <> "" Then n$ = "Push " + n$ + vbCrLf
         End If
            If F1$ <> "" Then F$ = myUcase(F1$ + "." + F$ + ")", True) Else F$ = myUcase(F$ + ")", True)
  
            If Not GetSub(F$, klm) Then PopStage bstack: bb.Flush: CallEventFromGuiNow = False: GoTo conthere
            '' look for '11001EDIT
            s1$ = sbf(klm).sb
            If Left$(s1$, 10) = "'11001EDIT" Then
            SetNextLine s1$
            End If
            If F1$ <> "" Then s1$ = n$ + "Module " + F1$ + vbCrLf + sbf(klm).sb Else s1$ = n$ + sbf(klm).sb
            
          Dim nn As Long
           
            If Execute(bstack, s1$, False, False) = 0 Then
           MyEr "Problem in Event " + aString$, "Πρόβλημα στο γεγονός " + aString$
            
            
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
                  here$ = "EV" + CStr(i)
       For k = LBound(vrs()) To UBound(vrs()) - 1
        If VarType(vrs(k)) = vbString Then
            GetlocalVar "EV" + CStr(i + k) + "$", j
            vrs(k) = var(j)
        Else
            GetlocalVar "EV" + CStr(i + k), j
             vrs(k) = var(j)
            End If
           
            Next k
            PopStage bstack

            bb.Flush
End If
End If

conthere:

Set bstack.Sorosref = oldbstack
here$ = ohere$
conthere0:
Set oldbstack = Nothing
Set bb = Nothing

If tr Then
'If STEXIT Then trace = tr
trace = tr
End If
extreme = extr
escok = olescok
End Function

Function ExpandGui(bstack As basetask, what$, rest$, ifier As Boolean, Lang As Long, oName As String)
Dim pppp As mArray, aVar As Variant, h$
'' add new GuiItems but not visible
what$ = Left$(what$, Len(what$) - 1)
 If neoGetArray(bstack, oName$, pppp, here$ <> "") Then
 If Not pppp.IHaveGui Then ifier = False: Exit Function
 Dim i As Long
 i = pppp.UpperMonoLimit + 1
 pppp.SerialItem 0, i + 2, 9
  If Typename$(pppp.item(0)) Like "Gui*" Then

  On Error Resume Next
  Select Case Typename$(pppp.item(0))
  Case "GuiM2000"
                             CreateFormObject aVar, 1
                                Set pppp.item(i) = aVar
                                Dim aaa As GuiM2000
                                Set aaa = aVar
                                With pppp.item(0)
                                Set aaa.EventObj = .EventObj
                                h$ = .modulename
                                End With
                                
                                With aaa
                                 .MyName = what$
                                 .modulename = h$
                                 .Title = what$ + "(" + LTrim(Str$(i)) + ")"
                                 .index = i
                                End With
                                Set aaa = Nothing
Case "GuiButton"
                                CreateFormObject aVar, 2
                            
                                Set pppp.item(i) = aVar
                                Dim aaa1 As GuiButton
                                Set aaa1 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa1.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                End With
Case "GuiTextBox"
                                CreateFormObject aVar, 3
                                Set pppp.item(i) = aVar
                                Dim aaa2 As GuiTextBox
                                Set aaa2 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa2.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                                 End With
                                
Case "GuiCheckBox"
                                CreateFormObject aVar, 4
                                Set pppp.item(i) = aVar
                                Dim aaa3 As GuiCheckBox
                                Set aaa3 = pppp.item(0)
                                With aVar
                                .ConstructArray aaa3.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With
                               
Case "GuiEditBox"
                                CreateFormObject aVar, 5
                                Set pppp.item(i) = aVar
                                Dim aaa4 As GuiEditBox
                                Set aaa4 = pppp.item(0)
                                Set aaa = aaa4.GetCallBack
                                With aVar
                                .ConstructArray aaa, what$, i
                                .Move 0, 2000, 6000, 1200
                              
                                If aaa.prive <> 0 Then
                                    .Linespace = players(aaa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                                 End With
                                 Set aaa = Nothing
                              
Case "GuiListBox"
                                CreateFormObject aVar, 6
                                Set pppp.item(i) = aVar
                                Dim aaa5 As GuiListBox
                                Set aaa5 = pppp.item(0)
                                Set aaa = aaa5.GetCallBack
                                With aVar
                                .ConstructArray aaa5.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                If aaa.prive <> 0 Then
                                    .Linespace = players(aaa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With
Case "GuiDropDown"
                                CreateFormObject aVar, 7
                                Set pppp.item(i) = aVar
                                Dim aaa6 As GuiDropDown
                                Set aaa6 = pppp.item(0)
                                Set aaa = aaa6.GetCallBack
                                With aVar
                                .ConstructArray aaa5.GetCallBack, what$, i
                                .Move 0, 2000, 6000, 600
                                'If aaa.prive <> 0 Then
                                 '   .Linespace = players(aaa.prive).uMineLineSpace
                                'Else
                                 '   .Linespace = players(0).uMineLineSpace
                                'End If
                                '.ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                                 End With

End Select
ifier = True
End If
End If
End Function
Function DeclareGUI(bstack As basetask, what$, rest$, ifier As Boolean, Lang As Long, i As Long, Optional ar As Long = 0, Optional oName As String = vbNullString, Optional glob As Long = 0)
DeclareGUI = True
Dim w$, x1 As Long, y1 As Long, s$, useold As Boolean, bp As Long
Dim alfa As GuiM2000, mm As CallBack2
Dim aVar As Variant, p As Variant
Dim pppp As mArray, mmmm As mEvent
' for these events no use of noHere property because no copyevent/upgrade happens
'         see .upgrade in UnFloatGroupReWriteVars and UnFloatGroup

 If IsLabelSymbolNew(rest$, "ΕΦΑΡΜΟΓΗ", "APPLICATION", Lang) Then
 If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
     Set var(i) = Form1
 Else
    Set mm = New CallBack2
 
                     With mm
                     .NoPublic bstack, ""
                     
                    End With

                     Set var(i) = mm
                     Set mm = Nothing
    End If
                        Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΤΜΗΜΑ", "MODULE", Lang) Then
         Set mm = New CallBack2
                     With mm
                     .NoPublic bstack, here$
                    End With
                     Set var(i) = mm
                     Set mm = Nothing
                     Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
                  If IsLabelSymbolNew(rest$, "ΓΕΓΟΝΟΣ", "EVENT", Lang) Then
                  
                             x1 = Abs(IsLabel(bstack, rest$, w$))
                             If x1 <> 1 Then
                                     BadObjectDecl
                             Else
                                If GetlocalVar(bstack.GroupName & w$, y1) Then
                                useold = True
                                ElseIf GetVar(bstack, bstack.GroupName & w$, y1) Then
                                useold = True
                                Else
                                y1 = globalvar(bstack.GroupName & w$, s$)
                                MakeitObjectEvent var(y1)
                                 
                                End If
                                If Typename(var(y1)) <> "mEvent" Then
                                    ifier = False
                                    DeclareGUI = False: Exit Function
                                End If
                                
                             End If
                              
                            If ar = 0 Then
                               If Not useold Then ProcEvent bstack, "{Read msg$, &obj}", 1, y1
                                CreateFormObject var(i), 1
                                  Set alfa = var(i)
                                  Set alfa.EventObj = var(y1)
                                  alfa.index = -1
                                  alfa.MyName = what$
                                  alfa.modulename = here$
                                  alfa.Title = what$
                                  Set alfa = Nothing
                            Else
                                ProcEvent bstack, "{Read index, msg$, &obj}", 1, y1
                                Set mmmm = var(y1)
                                GoTo contEvArray
                           End If
                    Else
                    bp = True
                    If ar = 0 Then
                    CreateFormObject var(i), 1
                    Set alfa = var(i)
                    Set mmmm = New mEvent
                                  Set alfa.EventObj = mmmm
                                  With mmmm
                                    .BypassInit 10
                                    .VarIndex = i * 1000 + varhash.count
                                    .enabled = True
                                    .ParamBlock "Read msg$, &obj", 2
                                    .GenItemCreator LTrim(Str(i * 456)), "{ Module " + here$ + vbCrLf + "try { Call local " + here$ + "." + bstack.GroupName + what$ + "() } }" + here$ + "." + bstack.GroupName
                                 End With
                                  alfa.MyName = what$
                                  alfa.index = -1
                                  alfa.modulename = here$
                                  alfa.ByPass = bp
                                  alfa.Title = what$
                                  Set mmmm = Nothing
                                  Set alfa = Nothing
                    Else
                     Set mmmm = New mEvent
contEvArray:
                        If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                                what$ = Left$(what$, Len(oName$))
                              If y1 = 0 Then
                                 With mmmm
                                    .BypassInit 10
                                    .VarIndex = i * 1000 + varhash.count
                                    .enabled = True
                                    .ParamBlock "Read Index, msg$, &obj", 3
                                    .GenItemCreator LTrim(Str(i * 3456)), "{ Module " + here$ + vbCrLf + "try { call local " + here$ + "." + bstack.GroupName + what$ + "() } }" + here$ + "." + bstack.GroupName
                                 End With
                                 End If
                                For i = 0 To ar - 1
                                CreateFormObject aVar, 1
                                Set pppp.item(i) = aVar
                                Dim aaa As GuiM2000
                                Set aaa = aVar
                                Set aaa.EventObj = mmmm
                               
                                With aaa
                                 .MyName = what$
                                 .modulename = here$
                                 .ByPass = bp
                                 .Title = what$ + "(" + LTrim(Str$(i)) + ")"
                                 .index = i
                                End With
                                Next i
                                Set aaa = Nothing
                         End If
                         pppp.IHaveGui = True
                         Set mmmm = Nothing
                    End If
                    End If
         
 ElseIf IsLabelSymbolNew(rest$, "ΠΛΗΚΤΡΟ", "BUTTON", Lang) Then
        If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 2
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .Caption = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 2
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
ElseIf IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗ", "TEXTBOX", Lang) Then
        If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 3
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .SetUp
                        .Text = what$
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 3
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΕΠΙΛΟΓΗ", "CHECKBOX", Lang) Then
         If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 4
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .Caption = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 4
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .Caption = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΚΕΙΜΕΝΟ", "EDITBOX", Lang) Then
          If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 5
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 1200
                        If alfa.prive <> 0 Then
                            .Linespace = players(alfa.prive).uMineLineSpace
                        Else
                            .Linespace = players(0).uMineLineSpace
                        End If
                        .SetUp
                        .Text = what$
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 5
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 1200
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .SetUp
                                .Text = what$ + "(" + LTrim(Str$(i)) + ")"
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΛΙΣΤΑ", "LISTBOX", Lang) Then
 If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 6
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                        .ListText = what$
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 6
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                If alfa.prive <> 0 Then
                                    .Linespace = players(alfa.prive).uMineLineSpace
                                Else
                                    .Linespace = players(0).uMineLineSpace
                                End If
                                .ListText = what$ + "(" + LTrim(Str$(i)) + ")"
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
 ElseIf IsLabelSymbolNew(rest$, "ΛΙΣΤΑ.ΕΙΣΑΓΩΓΗΣ", "COMBOBOX", Lang) Then
    If IsLabelSymbolNew(rest$, "ΦΟΡΜΑ", "FORM", Lang) Then
            If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
            Else
                If bstack.lastobj Is Nothing Then
                    BadObjectDecl
                    Exit Function
                End If
                If ar = 0 Then
                    CreateFormObject var(i), 7
                    Set alfa = bstack.lastobjIndirect(var())
                    Set bstack.lastobj = Nothing
                    With var(i)
                        .Construct alfa, what$
                        .Move 0, 2000, 6000, 600
                        .SetUp
                    End With
                    Set alfa = Nothing
                Else
                    If neoGetArray(bstack, oName$ + "(", pppp, , CBool(glob)) Then
                        what$ = Left$(what$, Len(oName$))
                        Set alfa = bstack.lastobjIndirect(var())
                        Set bstack.lastobj = Nothing
                        For i = 0 To ar - 1
                            CreateFormObject aVar, 7
                            Set pppp.item(i) = aVar
                            With aVar
                                .ConstructArray alfa, what$, i
                                .Move 0, 2000, 6000, 600
                                .SetUp
                            End With
                        Next i
                        pppp.IHaveGui = True
                        Set alfa = Nothing
                    End If
                End If
            End If
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΠΛΗΡΟΦΟΡΙΕΣ", "INFORMATION", Lang) Then
    Set var(i) = OsInfo
    ElseIf IsLabelSymbolNew(rest$, "ΜΑΘΗΜΑΤΙΚΑ", "MATH", Lang) Then
    Set var(i) = New Math
    ElseIf IsLabelSymbolNew(rest$, "ΣΥΛΛΟΓΗ", "COLLECTION", Lang) Then
    Set var(i) = New Collection
    End If
End Function

Sub ProcMethodArray(bstack As basetask, pppp As mArray, index As Long, co$, rest$, Lang As Long, ifier0 As Boolean)
Dim VR(1)
Set VR(0) = pppp.item(index)
On Error Resume Next
ProcMethod bstack, VR(), 0, co$, rest$, Lang, ifier0
 ifier0 = (Err = 0) And ifier0
          Err.Clear
End Sub
Sub ProcPropertyArray(bstack As basetask, pppp As mArray, index As Long, co$, rest$, Lang As Long, ifier0 As Boolean, Optional usethis As Long)
        Dim VR(1)
        If VarType(pppp.item(index)) <> vbEmpty Then
        
        Set VR(0) = pppp.item(index)
        On Error Resume Next
          ProcProperty bstack, VR(), 0, co$, rest$, Lang, True, usethis
  ifier0 = Err = 0
          Err.Clear
          Else
          MyEr "No Object found", "Δεν βρήκα αντικείμενο"
          End If
End Sub
Private Function ProcPtr(ByVal nAddress As Long) As Long
    ProcPtr = nAddress
End Function

Function CallByPtr(nSubAddress As Long, basestack As basetask, rest$, Lang As Long) As Boolean
Dim resp As Boolean
If TaskMaster.PlayMusic Then
                    TaskMaster.OnlyMusic = True
                        TaskMaster.TimerTick
                        TaskMaster.OnlyMusic = False
End If
CallWindowProc nSubAddress, VarPtr(basestack), VarPtr(rest$), VarPtr(Lang), VarPtr(resp)
CallByPtr = resp
End Function

Sub NeoWait(basestackLP As Long, rest$, Lang As Long, resp As Boolean)
Dim basestack As basetask, p As Variant
Set basestack = ObjFromPtr(basestackLP)
If IsExp(basestack, rest$, p) Then
mywait basestack, p
Else
mywait basestack, 0
End If
Set basestack = Nothing
resp = True
End Sub

Sub CallNext(basestack As basetask, rest$, resp As Boolean, v1 As Variant, v2 As String)
Dim i As Long, p As Variant, par As Boolean, F As Long, b$
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
s$ = v2
i = Abs(IsLabel(basestack, s$, what$))
GoTo there
reenter1:

i = Abs(IsLabel(basestack, rest$, what$))
there:
If i = 3 And Len(rest$) > 0 Then
If AscW(rest$) = 46 Then
If Not IsStrExp(basestack, (what$), what$) Then MissPar:  Exit Sub
rest$ = what$ + rest$
GoTo reenter1
End If
End If
' call function as module
'**********************************************************

    ss$ = what$ & ")"
    
     If FastSymbol(rest$, ",") Then
    
    End If
    ''ss$ = myUcase$(ss$)

    resp = True
    MakeThisSub basestack, ss$
    it = CLng(GetSub(ss$, x1))
    
    If Not it Then it = CLng(GetlocalSub(ss$, x1))
 
    If it Then
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        If Not TheSame(here$, ss$) Then Set bs.Sorosref = basestack.soros
        Set bs.Owner = basestack.Owner
            ' bs.UseGroupname = sbf(x1).sbgroup
             bs.OriginalCode = x1
             If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
         
             Call GoFunc(bs, ss$, rest$, vvl, , x1)
            
             Else
             bs.UseGroupname = sbf(x1).sbgroup
        Call GoFunc(bs, ss$, rest$, vvl)
        End If
            If Not bs.StaticCollection Is Nothing Then
        basestack.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
        If Not par Then
        If Typename(vvl) = "Empty" Then resp = False: Exit Sub
        If InStr(ss$, "$") > 0 Then
   
        v2 = CStr(vvl)
        Else
        
            v1 = CDbl(vvl)
   
        End If
        End If
        Else
        ' ??
        End If
End Sub

Sub NeoCall0(basestackLP As Long, rest$, Lang As Long, resp As Boolean)
Dim basestack As basetask, i As Long, p As Variant, par As Boolean, F As Long, b$
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
Set basestack = ObjFromPtr(basestackLP)
resp = True
If FastSymbol(rest$, "!") Then basestack.nokillvars = True
par = False: F = 0
If IsLabelSymbolNew(rest$, "ΚΕΝΗ", "VOID", Lang) Then par = True
If IsLabelSymbolNew(rest$, "ΕΞΩΤΕΡΙΚΗ", "EXTERN", Lang) Then
' NOW WE HAVE TO GET THE NUMBER
basestack.nokillvars = False
If IsExp(basestack, rest$, p) Then
' WE HAVE THE NUMBER, BUT IS f OUR OBJECT???
i = CLng(p)
If i >= 0 Or i <= p Then
If Typename(var(i)) = "stdCallFunction" Then
CallByObject basestack, i, Not par
Set basestack = Nothing

Exit Sub
ElseIf Typename(var(i)) = "lambda" Then
' call lamda
            PushStage basestack, False
            flag = False
            it = 1
            rest$ = ""
            Dim aa As lambda
            var(i).name = here$
            
            var(i).CopyToVar basestack, here$ = "", var()
            'sbf(0).sb = var(i).code$
            basestack.OriginalCode = -i
            basestack.FuncRec = subHash.LastKnown
            b$ = var(i).code$
               Call executeblock(it, basestack, b$, False, flag)
               var(i).CopyFromVar basestack, var()
          If it = 0 Then
                    Set basestack.lastobj = Nothing
                    Set basestack.FuncObj = Nothing
                    basestack.ThrowThreads
                    MyErMacro rest$, "Problem in lambda", "Πρόβλημα στη λάμδα"
                   '  pa$ = "EDIT " & sbf(var(i).OriginalCode).goodname & ", " + CStr(Len(sbf(x1).sb))
                      FK$(13) = "EDIT " + sbf(var(i).OriginalCode).goodname + ", " + CStr(-var(i).lastlen - Len(b$))
                     var(i).lastlen = Len(b$)
                    PopStage basestack
                    Set basestack = Nothing

                    Exit Sub
             End If
            PopStage basestack
            Set basestack = Nothing

            Exit Sub
Else
' INVALID FUNCTION HANDLE
End If

Else
' INVALID FUNCTION HANDLE
End If
Else
'WRONG...
End If
ElseIf IsLabelSymbolNew(rest$, "ΓΕΓΟΝΟΣ", "EVENT", Lang) Then
    i = Abs(IsLabel(basestack, rest$, what$))
    If i = 1 Then
        If Not GetVar(basestack, basestack.GroupName & what$, i) Then
            MissPar
        Else
            If Typename(var(i)) <> "mEvent" Then
                  MyEr "Can't find Event", "Δεν μπορώ να βρω Γεγονός"
            Else
               resp = CallEvent(basestack, rest$, Lang, i)
  
            End If
        End If
    ElseIf i = 5 Then
    If GetEventFromArray(basestack, rest$, what$) Then
    resp = CallEvent(basestack, rest$, Lang, -1)
    End If
    Else
        MissPar
    End If
    Set basestack = Nothing

    Exit Sub
Else
flag = IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", Lang)
If IsLabelSymbolNew(rest$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", Lang) Then F = 3

reenter1:

i = Abs(IsLabel(basestack, rest$, what$))
If i = 3 And Len(rest$) > 0 Then
If AscW(rest$) = 46 Then
If Not IsStrExp(basestack, (what$), what$) Then MissPar: Set basestack = Nothing:  Exit Sub
rest$ = what$ + rest$
GoTo reenter1
End If
End If
If i = 0 Or i = 2 Then
If i = 0 Then
If Not IsStrExp(basestack, rest$, what$) Then MissPar: Set basestack = Nothing:  Exit Sub
End If
s$ = what$
i = Abs(IsLabel(basestack, s$, what$))

If i = 0 Then

If FastSymbol(s$, "{") Then
reenter2:
 ss$ = block(s$)
 If FastSymbol(s$, "}") And ss$ <> "" Then
PushStage basestack, False
x1 = ModuleSub("A_()", ss$, Trim$(s$))
 Set bs = New basetask
     bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
    If par Then
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       Else
       '' no static for this type of call
       
       bs.OriginalName = "()"
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       If Not vvl = Empty Then
       vvl = CStr(vvl)
       x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
       End If
       End If
        If Not bs.StaticCollection Is Nothing Then
        basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        ''
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
        
    resp = True
PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
End If
rest$ = s$ + rest$
End If
If F > 0 And i < 5 Then i = i + 4: what$ = what$ & "("
If i = 1 Then
If Right$(what$, 1) = ChrW(&H1FFF) Then
i = InStr(rest$, "()")
If i > 0 And i < 4 Then
what$ = what$ + Left$(rest$, i + 1)
rest$ = Mid$(rest$, i + 1)  ' leave last )
End If
End If
    If FastSymbol(rest$, ",") Then
    End If

    
    MakeThisSub basestack, what$
   it = GetlocalSub(what$, x1)
  
    'If Not it Then it = GetSub(what$, x1)
 If Not it Then
If here$ = what$ Then
  it = True: x1 = basestack.OriginalCode
 Else
  If SecureNames Then x1 = iRVAL22(here$)
 If x1 > 0 Then
If Not InStr(sbf(x1).goodname, what$) - 2 = Len(here$) And Not Right$(sbf(x1).goodname, Len(what$) + 1) = "." + what$ Then
If Replace(here$, ChrW(&HFFBF), "") = what$ Then
 it = True: x1 = basestack.OriginalCode
 ElseIf InStr(what$, basestack.UseGroupname) = 1 Then
 what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
 it = GetSub(what$, x1)
 End If
Else
 it = True
 End If
 Else
 
 For i = -iRVAL(here$, 0) To -1
 
    it = GetSub(RVAL2(here$, i) + what$, x1)
    If it Then Exit For
    Next i
   End If
   End If
   
  If it = 0 Then
 If StripThis(here$) = what$ Then
 it = True: x1 = basestack.OriginalCode
 ElseIf Replace(here$, ChrW(&HFFBF), "") = what$ Then
 it = True: x1 = basestack.OriginalCode
 ElseIf InStr(what$, basestack.UseGroupname) = 1 Then
 what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
 it = GetSub(what$, x1)
 End If
 End If
 End If

    If it Then
       
        resp = True
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
        If here$ = "" Then
            here$ = what$
            Call GoFunc(bs, what$, rest$, vvl, , x1)
            here$ = ""
        ElseIf x1 >= 0 Then
           ' Call GoFunc(bs, "", rest$, vvl, , x1)
            If flag Then
                bs.UseGroupname = basestack.UseGroupname
                bs.GroupName = basestack.GroupName
                  bs.StaticInUse = basestack.StaticInUse
                Call GoFunc(bs, "()", rest$, vvl, , x1)
            Else
                bs.UseGroupname = sbf(x1).sbgroup
                bs.StaticInUse = what$
                Call GoFunc(bs, "", rest$, vvl, , x1)
                
            End If
        Else
            Call GoFunc(bs, what$, rest$, vvl)
        End If
myerror1:
        If Not bs.StaticCollection Is Nothing Then
            basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
    Else
        resp = False
        rest$ = ":" & what$ & " " & rest$
    End If


  Set basestack = Nothing:  Exit Sub
ElseIf i = 3 Then
    'If FastSymbol(rest$, ",") Then
    
   ' End If
    If IsStrExp(basestack, what$, s$) Then
    If Len(s$) > 0 Then
    If FastSymbol(s$, "{") Then GoTo reenter2
     rest$ = s$ & rest$
    
      GoTo reenter1
      Else
      basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
      End If
    Else
        ' error
        basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
    End If
ElseIf i > 3 Then
' call function as module
'**********************************************************

    ss$ = what$ & ")"
    
     If FastSymbol(rest$, ",") Then
    
    End If
    ''ss$ = myUcase$(ss$)

    
    MakeThisSub basestack, ss$
    it = CLng(GetSub(ss$, x1))
    
    If Not it Then it = CLng(GetlocalSub(ss$, x1))
 
    If it Then
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        bs.IamAnEvent = basestack.IamAnEvent
        If basestack.IamThread Then Set bs.Process = basestack.Process
        If Not TheSame(here$, ss$) Then Set bs.Sorosref = basestack.soros
        Set bs.Owner = basestack.Owner
            ' bs.UseGroupname = sbf(x1).sbgroup
             bs.OriginalCode = x1
             If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
             Call GoFunc(bs, ss$, rest$, vvl, , x1)
             Else
             bs.UseGroupname = sbf(x1).sbgroup
            
            Call GoFunc(bs, ss$, rest$, vvl)
        End If
            If Not bs.StaticCollection Is Nothing Then
        basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
        If Not par Then
        If InStr(ss$, "$") > 0 Then
            If vvl <> "" Then  ' no zero we have error
            x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            basestack.nokillvars = False
            

            Set basestack = Nothing: Exit Sub
            End If
        Else
            If val(vvl) <> 0 Then  ' no zero we have error
                MyEr "ERROR " & Trim$(Str$(val(vvl))), "ΛΑΘΟΣ " & Trim$(Str$(val(vvl)))
                resp = False
                basestack.nokillvars = False
                Set basestack = Nothing

               Set basestack = Nothing:  Exit Sub
            End If
        End If
        End If
    Else
    rest$ = ""
    End If
ElseIf IsStrExp(basestack, rest$, s$) Then
If F = 3 Then s$ = s$ & "("
If FastSymbol(rest$, ",") Then
End If
If s$ <> "" Then
If InStr(s$, ").") > 0 And F <> 3 Then
If Right$(s$, 1) = ")" Then

rest$ = s$ & " " & rest$

GoTo reenter1
Else

rest$ = ": " + s$ & " " & rest$
End If
Else
If Right$(s$, 1) = ")" Then

rest$ = Left$(s$, Len(s$) - 1) & " " & rest$

Else

rest$ = s$ & " " & rest$
End If
GoTo reenter1
End If
End If
Else
rest$ = ": " & rest$
End If
End If
basestack.nokillvars = False
Set basestack = Nothing

End Sub


Sub NeoCall(basestackLP As Long, rest$, Lang As Long, resp As Boolean)
Dim basestack As basetask, i As Long, p As Variant, par As Boolean, F As Long, op As Object, op1 As Object
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
Set basestack = ObjFromPtr(basestackLP)

 If IsLabelSymbolNew(rest$, "ΤΕΛΕΣΤΗ", "OPERATOR", Lang) Then

    If ISSTRINGA(rest$, s$) Then
contoper:
        If ThisPointer(basestack, x1) Then
        
            If FastSymbol(rest$, ",") Then
            If IsExp(basestack, rest$, p) Then
                If basestack.lastobj Is Nothing Then
                    NeedAGroupFromExpression
                    Set basestack.lastobj = Nothing
                    Exit Sub
                End If
                    If TypeOf basestack.lastobj Is Group Then
                       basestack.soros.PushObj basestack.lastobj
                       Set basestack.lastobj = Nothing
                        NeoCall2 ObjPtr(basestack), "." + ChrW(&H1FFF) + s$ + "()", (True)
                  
                        resp = True
                    Else
                        NeedAGroupFromExpression
                    End If
                Else
                MissNumExpr
                End If
            Else
               NeoCall2 ObjPtr(basestack), "." + ChrW(&H1FFF) + s$ + "()", (True)
                
                resp = True
            End If
            Set basestack.lastobj = Nothing
            Exit Sub
        Else
            OnlyInAGroup
            Exit Sub
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΜΟΝΑΔΙΑΙΟ", "UNARY", Lang) Then
        s$ = "-:": GoTo contoper
    Else
        SyntaxError
        Exit Sub
    End If
End If
resp = True



If FastSymbol(rest$, "!") Then basestack.nokillvars = True
par = False: F = 0

If IsLabelSymbolNew(rest$, "ΚΕΝΗ", "VOID", Lang) Then par = True
If IsLabelSymbolNew(rest$, "ΕΞΩΤΕΡΙΚΗ", "EXTERN", Lang) Then
basestack.nokillvars = False
If IsExp(basestack, rest$, p) Then
i = CLng(p)
If i >= 0 Or i <= p Then
If Typename(var(i)) = "stdCallFunction" Then
On Error Resume Next
 Err.Clear
CallByObject basestack, i, Not par

Set basestack = Nothing
If Err.Number <> 0 Then
MyEr Err.Description, Err.Description
End If
Exit Sub
ElseIf Typename(var(i)) = "lambda" Then
' call lamda
            PushStage basestack, False
            flag = False
            it = 1
            rest$ = vbNullString
            Dim aa As lambda
            var(i).name = here$
            
            var(i).CopyToVar basestack, here$ = vbNullString, var()
            'sbf(0).sb = var(i).code$
            basestack.OriginalCode = -i
            basestack.FuncRec = subHash.LastKnown
            Dim b$
            b$ = var(i).code$
               Call executeblock(it, basestack, b$, False, flag)
               var(i).CopyFromVar basestack, var()
          If it = 0 Then
                    Set basestack.lastobj = Nothing
                    Set basestack.FuncObj = Nothing
                    basestack.ThrowThreads
                    MyErMacro rest$, "Problem in lambda", "Πρόβλημα στη λάμδα"
                    FK$(13) = "EDIT " + sbf(var(i).OriginalCode).goodname + ", " + CStr(-var(i).lastlen - Len(b$))
                     var(i).lastlen = Len(b$)
                     
                    PopStage basestack
                    Set basestack = Nothing

                    Exit Sub
             End If
            PopStage basestack
            Set basestack = Nothing

            Exit Sub
Else
' INVALID FUNCTION HANDLE
End If

Else
' INVALID FUNCTION HANDLE
End If
Else
'WRONG...
End If
ElseIf IsLabelSymbolNew(rest$, "ΓΕΓΟΝΟΣ", "EVENT", Lang) Then
    i = Abs(IsLabel(basestack, rest$, what$))
    
    If i = 1 Then
        If Not GetVar(basestack, basestack.GroupName & what$, i) Then
            MissPar
        Else
            If Typename(var(i)) <> "mEvent" Then
                  MyEr "Can't find Event", "Δεν μπορώ να βρω το Γεγονός"
            Else
               resp = CallEvent(basestack, rest$, Lang, i)
  
            End If
        End If
    ElseIf i = 5 Then
    If GetEventFromArray(basestack, rest$, what$) Then
    resp = CallEvent(basestack, rest$, Lang, -1)
    End If
    ElseIf i = 0 Then
        If ISSTRINGA(rest$, s$) Then
            If ThisPointer(basestack, i) Then
                s$ = myUcase(s$)
                Set op = var(i)
                Dim a As Group
                Set a = op
                Set op = Nothing
                If Not a.EventFuncPos(s$, ss$, x1) Then
                    ' check parent
                    If basestack.UseGroupname <> "" Then
                        what$ = Mid$(basestack.UseGroupname, 1, Len(basestack.UseGroupname) - 1)
                        If GetVar(basestack, what$, x1) Then
                            what$ = Left$(what$, Len(what$) - Len(var(x1).GroupName))
                        End If
                        Do While GetVar(basestack, what$, x1)
                            If Typename$(var(x1)) <> "Group" Then Exit Do
                            Set a = var(x1)
                            If a.EventFuncPos(s$, ss$, x1) Then
                                If sbf(x1).goodname = ss$ Then GoTo contcallhere
                            End If
                            what$ = Left$(what$, Len(what$) - Len(var(x1).GroupName))
                        Loop
                    End If
                Set a = Nothing
ThrowPar:
        ' THROW PARAMETERS HERE
                Set bs = New basetask
                Set bs = New basetask
                Set bs.Owner = basestack.Owner
                If bs Is Nothing Then Set bs = basestack
                Set bs.Parent = basestack
                bs.Look2Parent = True
                FastSymbol rest$, ","
                If Not PushParamGeneralV7(bs, rest$) Then Exit Sub
                Set bs = Nothing
            ElseIf Not sbf(x1).goodname = ss$ Then
                GoTo ThrowPar
            Else
contcallhere:
                Set bs = New basetask
                Set bs.Owner = basestack.Owner
                If bs Is Nothing Then Set bs = basestack
                bs.UseGroupname = sbf(x1).sbgroup
                bs.OriginalCode = x1
                Set bs.Parent = basestack
                bs.Look2Parent = True
                FastSymbol rest$, ","
                If Not PushParamGeneralV7(bs, rest$) Then
                    bs.Look2Parent = False
                    Exit Sub
                End If
                bs.strg = False
                bs.fHere = Left$(ss$, rinstr(ss$, ".") - 1)
                s$ = here$
                here$ = bs.fHere
                bs.Look2Parent = False
                PushStage basestack, False
                executeblock i, bs, (sbf(x1).sb), (False), (flag)
                PopStage basestack
                here$ = s$
                Set bs = Nothing
                Exit Sub
            End If
        End If
    End If
    Else
        MissPar
    End If
    Set basestack = Nothing

    Exit Sub
Else
flag = IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", Lang)
If IsLabelSymbolNew(rest$, "ΣΥΝΑΡΤΗΣΗ", "FUNCTION", Lang) Then F = 3

reenter1:

i = Abs(IsLabel(basestack, rest$, what$))
If i = 3 And Len(rest$) > 0 Then
If AscW(rest$) = 46 Then
If Not IsStrExp(basestack, (what$), what$) Then MissPar: Set basestack = Nothing:  Exit Sub
rest$ = what$ + rest$
GoTo reenter1
End If
End If
If i = 0 Or i = 2 Then
If i = 0 Then
If Not IsStrExp(basestack, rest$, what$) Then MissPar: Set basestack = Nothing:  Exit Sub
End If
s$ = what$
i = Abs(IsLabel(basestack, s$, what$))

If i = 0 Then

If FastSymbol(s$, "{") Then
reenter2:
 ss$ = block(s$)
 If FastSymbol(s$, "}") And ss$ <> "" Then
PushStage basestack, False
x1 = ModuleSub("A_()", ss$, Trim$(s$))
 Set bs = New basetask
     bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
    If par Then
    
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       
       Else
       '' no static for this type of call
       
       bs.OriginalName = "()"
       
       Call GoFunc(bs, what$, rest$, vvl, , x1)
       
       If Not vvl = Empty Then
       vvl = CStr(vvl)
       x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
       End If
       End If
        If Not bs.StaticCollection Is Nothing Then
        basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        ''
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
        
    resp = True
PopStage basestack   ' this always kill vars
       Set basestack = Nothing:  Exit Sub
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
Else
s$ = "Error" + "{Bad Call}, {στη κλήση}"
End If
End If
rest$ = s$ + rest$
End If
If F > 0 And i < 5 Then i = i + 4: what$ = what$ & "("
If i = 1 Then
If Right$(what$, 1) = ChrW(&H1FFF) Then
i = InStr(rest$, "()")
If i > 0 And i < 4 Then
what$ = what$ + Left$(rest$, i + 1)
rest$ = Mid$(rest$, i + 1)  ' leave last )
End If
End If
FastSymbol rest$, ","
MakeThisSub basestack, what$
it = GetlocalSub(what$, x1)
If Not it Then
    If SecureNames Then
    x1 = iRVAL22(here$)
    End If
    If here$ = what$ Then
    ' nothing ??
    ElseIf x1 > 0 Then
        If Not InStr(sbf(x1).goodname, what$) - 2 = Len(here$) And Not Right$(sbf(x1).goodname, Len(what$) + 1) = "." + what$ Then
            i = x1
            s$ = what$
            If Replace(here$, ChrW(&HFFBF), "") = what$ Then
                it = True: x1 = basestack.OriginalCode
            ElseIf Len(basestack.UseGroupname) > 0 Then
            If InStr(what$, basestack.UseGroupname) = 1 Then
                what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
                it = GetSub(what$, x1)
                End If
            End If
            If it = 0 Then
                what$ = s$
                If basestack.fHere <> "" Then
                    If sbf(i).goodname = StripThis2(basestack.fHere + "[") + "." + s$ Then
                     x1 = i: it = True
                    End If
                Else
                    If sbf(i).goodname = StripThis2(here$ + "[") + "." + s$ Then
                        x1 = i: it = True
                    Else
                        it = subHash.Find(what$, x1)
                    End If
                End If
            End If
            If it = 0 Then it = GetSub(what$, x1)
        Else
            it = True
        End If
     ElseIf Left$(basestack.fHere$, InStr(basestack.fHere$ + "[", "[") - 1) = what$ Then  ' GetStrUntil("[", basestack.fHere$ + "[")
        it = True: x1 = basestack.OriginalCode
     ElseIf Not SecureNames Then
        If iRVAL(here$, 0) > 0 Then
            For i = -iRVAL(here$, 0) To -1
                it = GetSub(RVAL2(here$, i) + what$, x1)
                If it Then Exit For
            Next i
        End If
        If it = 0 Then it = GetSub(what$, x1)
        Else
        it = GetSub(what$, x1)
    End If
    If it = 0 Then
        If Replace(here$, ChrW(&HFFBF), "") = what$ Then
            it = True: x1 = basestack.OriginalCode
            ElseIf Len(basestack.UseGroupname) > 0 Then
        If InStr(what$, basestack.UseGroupname) = 1 Then
              s$ = what$
              If Len(basestack.UseGroupname) > 0 Then what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
              it = GetSub(what$, x1)
              If it = 0 Then it = GetSub(s$, x1): what$ = s$
          
          End If
           End If
           If it = 0 Then
           'x1 = iRVAL22(here$)
          ' it = True
           End If
       End If
    End If
    If it Then
       
        resp = True
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
        If here$ = vbNullString Then
            here$ = what$
            
            Call GoFunc(bs, what$, rest$, vvl, , x1)
            
            here$ = vbNullString
        ElseIf x1 >= 0 Then
           ' Call GoFunc(bs, "", rest$, vvl, , x1)
            If flag Then
                bs.UseGroupname = basestack.UseGroupname
                bs.GroupName = basestack.GroupName
                  bs.StaticInUse = basestack.StaticInUse
                  Call GoFunc(bs, "()", rest$, vvl, , x1)
                 If LastErNum Then
                            MyEr Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), ""), Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), "")
                            resp = False
                            GoTo exithere
                End If
            Else
                bs.UseGroupname = sbf(x1).sbgroup
                 If Left$(what$, 1) <> "_" Then
                    If SecureNames And basestack.IamThread Then
                        what$ = "_" + what$ + LTrim$(basestack.Process.Id)
                    End If
                End If
                bs.StaticInUse = what$
                Call GoFunc(bs, "", rest$, vvl, , x1)
                If LastErNum Then
                        MyEr Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), ""), Replace(GetName(sbf(x1).goodname), ChrW(&HFFBF), "")
                        resp = False
                        GoTo exithere

                End If
               
            End If
        Else
        
            Call GoFunc(bs, what$, rest$, vvl)
            
        End If
myerror1:
        If Not bs.StaticCollection Is Nothing Then
            basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
        basestack.nokillvars = False
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
    Else
        resp = False
         ' Debug.Print  ":" & what$ & " " & rest
        rest$ = ":" & what$ & " " & rest$
    End If


  Set basestack = Nothing:  Exit Sub
ElseIf i = 3 Then
    'If FastSymbol(rest$, ",") Then
    
   ' End If
    If IsStrExp(basestack, what$, s$) Then
    If Len(s$) > 0 Then
    If FastSymbol(s$, "{") Then GoTo reenter2
     rest$ = s$ & rest$
    
      GoTo reenter1
      Else
      basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
      End If
    Else
        ' error
        basestack.nokillvars = False
        resp = False

       Set basestack = Nothing:  Exit Sub
    End If
ElseIf i > 3 Then
' call function as module
'**********************************************************

    ss$ = what$ & ")"
    
     If FastSymbol(rest$, ",") Then
    
    End If
    ''ss$ = myUcase$(ss$)

    
    MakeThisSub basestack, ss$
    it = CLng(GetSub(ss$, x1))
    
    If Not it Then it = CLng(GetlocalSub(ss$, x1))

  If it = 0 Then
 If StripThis(here$) = ss$ Then
 it = True: x1 = basestack.OriginalCode
' flag = True
 ElseIf Replace(here$, ChrW(&HFFBF), "") = ss$ Then
 it = True: x1 = basestack.OriginalCode

 ElseIf InStr(what$, basestack.UseGroupname) = 1 Then
 If Len(basestack.UseGroupname) > 0 Then ss$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(ss$, Len(basestack.UseGroupname) + 1)
 it = GetSub(ss$, x1)
 Else
 it = GetSub(ss$, x1)
 If it = 0 Then
 If Left$(what$, 1) = "T" Or Left$(what$, 1) = "Α." Then
 If Left$(what$, 5) = "THIS." Or Left$(what$, 5) = "ΑΥΤΟ." Then
  ss$ = Left$(what$, 5) + ChrW(&HFFBF) + Mid$(what$, 6) + ")"
  MakeThisSub basestack, ss$
 it = GetSub(ss$, x1)
 End If
 End If
 End If
 End If
 End If


    If it Then
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        bs.IamAnEvent = basestack.IamAnEvent
        If basestack.IamThread Then Set bs.Process = basestack.Process
        If Not TheSame(here$, ss$) Then Set bs.Sorosref = basestack.soros
        Set bs.Owner = basestack.Owner
            ' bs.UseGroupname = sbf(x1).sbgroup
             bs.OriginalCode = x1
             If flag Then
             bs.UseGroupname = basestack.UseGroupname
             bs.GroupName = basestack.GroupName
             
             Call GoFunc(bs, ss$, rest$, vvl, , x1)
             
             Else
             bs.UseGroupname = sbf(x1).sbgroup
            
            Call GoFunc(bs, ss$, rest$, vvl, True, x1)
            
        End If
            If Not bs.StaticCollection Is Nothing Then
        basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
        If Not par Then
        If InStr(ss$, "$") > 0 Then
            If vvl <> "" Then  ' no zero we have error
            x = InStr(vvl, "|")
            If x = 0 Then
                MyEr "ERROR " & vvl, "ΛΑΘΟΣ " & vvl
            Else
                MyEr "ERROR " & Left$(vvl, x - 1), "ΛΑΘΟΣ " & Mid$(vvl, x + 1)
            End If
            resp = False
            basestack.nokillvars = False
            

            Set basestack = Nothing: Exit Sub
            End If
        Else
            If val(vvl) <> 0 Then  ' no zero we have error
                MyEr "ERROR " & Trim$(Str$(val(vvl))), "ΛΑΘΟΣ " & Trim$(Str$(val(vvl)))
                resp = False
                basestack.nokillvars = False
                Set basestack = Nothing

               Set basestack = Nothing:  Exit Sub
            End If
        End If
        End If
    Else
    If Not flag Then
    
      MyEr "Nothing to call", "Τίποτα για να καλέσω"
      resp = False
    Else
    rest$ = vbNullString
    End If
    End If
ElseIf IsStrExp(basestack, rest$, s$) Then
If F = 3 Then s$ = s$ & "("
If FastSymbol(rest$, ",") Then
End If
If s$ <> "" Then
If InStr(s$, ").") > 0 And F <> 3 Then
If Right$(s$, 1) = ")" Then

rest$ = s$ & " " & rest$

GoTo reenter1
Else

rest$ = ": " + s$ & " " & rest$
End If
Else
If Right$(s$, 1) = ")" Then

rest$ = Left$(s$, Len(s$) - 1) & " " & rest$

Else

rest$ = s$ & " " & rest$
End If
GoTo reenter1
End If
End If
Else
rest$ = ": " & rest$
End If
End If
exithere:
basestack.nokillvars = False
Set basestack = Nothing

End Sub
Sub NeoCall2(basestackLP As Long, rest$, resp As Boolean)
Dim basestack As basetask, i As Long, p As Variant, par As Boolean, F As Long
Dim flag As Boolean, it As Long, what$, s$, x1 As Long, ss$, bs As basetask, vvl As Variant, x As Double
Set basestack = ObjFromPtr(basestackLP)
resp = True
i = Abs(IsLabel(basestack, rest$, what$))
If i = 1 Then

If Right$(what$, 1) = ChrW(&H1FFF) Then
i = InStr(rest$, "()")
If i > 0 And i < 4 Then
what$ = what$ + Left$(rest$, i + 1)
rest$ = Mid$(rest$, i + 1)  ' leave last )
End If

End If
jumphere:
    MakeThisSub basestack, what$
   it = GetlocalSub(what$, x1)
  
    If Not it Then it = GetSub(what$, x1)
 If Not it Then
 If here$ = what$ Then
  it = True: x1 = basestack.OriginalCode
 Else
 For i = -iRVAL(here$, 0) To -1
 
    it = GetSub(RVAL2(here$, i) + what$, x1)
    If it Then Exit For
    Next i
   End If
  If it = 0 Then
 If StripThis(here$) = what$ Then
 it = True: x1 = basestack.OriginalCode
 ElseIf Replace(here$, ChrW(&HFFBF), "") = what$ Then
 it = True: x1 = basestack.OriginalCode
 ElseIf InStr(what$, basestack.UseGroupname) = 1 Then
 what$ = basestack.UseGroupname + ChrW(&HFFBF) + Mid$(what$, Len(basestack.UseGroupname) + 1)
 it = GetSub(what$, x1)
 End If
 End If
 End If

    If it Then
       
        resp = True
        Set bs = New basetask
        bs.reflimit = varhash.count
        Set bs.Parent = basestack
        If basestack.IamThread Then Set bs.Process = basestack.Process
        Set bs.Sorosref = basestack.soros  ' same stack
        Set bs.Owner = basestack.Owner
        bs.UseGroupname = sbf(x1).sbgroup
        bs.OriginalCode = x1
        If here$ = "" Then
            here$ = what$
            Call GoFunc(bs, what$, rest$, vvl, , x1)
            here$ = ""
        ElseIf x1 >= 0 Then
           ' Call GoFunc(bs, "", rest$, vvl, , x1)
                bs.UseGroupname = sbf(x1).sbgroup
                bs.StaticInUse = what$
                Call GoFunc(bs, "", rest$, vvl, , x1)
        Else
            Call GoFunc(bs, what$, rest$, vvl)
        End If
myerror1:
        If Not bs.StaticCollection Is Nothing Then
            basestack.Parent.SetVarobJ "%_" + bs.StaticInUse, bs.StaticCollection
        End If
        Set bs = Nothing
       
        If LastErNum = -1 Then
            Set basestack = Nothing
            resp = False: Set basestack = Nothing: Exit Sub
        End If
    Else
        resp = False
        rest$ = ":" & what$ & " " & rest$
    End If
ElseIf i = 7 Then
what$ = what$ + ")"
GoTo jumphere
End If

  Set basestack = Nothing


End Sub

Function myStructure(basestack As basetask, rest$, Lang As Long) As Boolean
Dim base As String
If IsStrExp(basestack, rest$, base) Then
    TABLENAMES base, basestack, rest$, Lang
    myStructure = True
Else
    myStructure = makestruct(basestack, rest$, Lang)
End If
End Function
Function makestruct(basestack As basetask, rest$, Lang As Long) As Boolean
Dim what$, offset As Long, offset1 As Long, offsetlist As FastCollection, i As Long, s$, b$, p As Variant, w2 As Long

' struct is an inventory of offsets
If Abs(IsLabel(basestack, rest$, what$)) = 1 Then  ' WE HAVE A NAME
If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
          If GetlocalVar(basestack.GroupName & what$, i) Then
                        If Not MyIsObject(var(i)) Then MakeitObjectInventory var(i)
                    ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
                        If Not MyIsObject(var(i)) Then MakeitObjectInventory var(i)
                    Else
                        i = globalvar(basestack.GroupName & what$, s$)
                        MakeitObjectInventory var(i)
                        var(i).objref.UcaseKeys = True
                    End If
Set offsetlist = var(i).objref
' so now we have the inventory
If FastSymbol(rest$, "{") Then
    If StructPage(basestack, rest$, Lang, 0, offset, offsetlist, "") Then
    If offsetlist Is Nothing Then Exit Function
    offsetlist.StructLen = offset
    var(i).ReadOnly = True
    makestruct = True
    End If
End If
Set offsetlist = Nothing
End If
End Function
Private Function Between(a, b, c, Optional exclude) As Boolean
If IsMissing(exclude) Then
Between = a >= b And a <= c
Else
Between = (a >= b And a <= c) And Not a = exclude
End If
End Function
Function StructPage(basestack As basetask, rest$, Lang As Long, ByVal offset, ByRef offset2, offsetlist As FastCollection, ByVal lasthead$) As Boolean
Dim what$, offset1 As Long, i As Long, s$, b$, p As Variant, w2 As Long, maxoffset As Long, probeoffset As Long
Dim itissingle As Boolean
    b$ = NLtrim$(block(rest$))
   If Not FastSymbol(rest$, "}") Then Exit Function
again:
    If FastSymbol(b$, vbCrLf, , 2) Then
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = vbNullString
again1:
    itissingle = False
    If MaybeIsSymbol(b$, "\'") Then
    
    SetNextLineNL b$
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = vbNullString
 
    GoTo again1
    ElseIf FastSymbol(b$, "{") Then
    ' IS A NEW PAGE
    probeoffset = 0
    If StructPage(basestack, b$, Lang, offset, probeoffset, offsetlist, lasthead$) Then
        If probeoffset > maxoffset Then maxoffset = probeoffset
        ' leave offset as is
    GoTo again
    Else
    Exit Function
    End If
    ElseIf Between(Abs(IsLabelOnly(b$, what$)), 1, 3, 2) Then
    Do
    '' check type, or by default use 2
    If IsLabelSymbolNew(what$, "ΔΟΜΗ", "STRUCTURE", Lang, , , , False) Then
    If Abs(IsLabelOnly(b$, what$)) = 1 Then
    If FastSymbol(b$, "{") Then
        probeoffset = 0
        If offsetlist.ExistKey(lasthead$ + what$) Then
        MyEr "double name is same struct", "διπλή εισαγωγή ονόματος"
        StructPage = False
        Set offsetlist = Nothing
        Exit Function
        End If

        If StructPage(basestack, b$, Lang, offset, probeoffset, offsetlist, lasthead$ + what$ + ".") Then
            If probeoffset > maxoffset Then maxoffset = probeoffset
            ' leave offset as is
    
            offsetlist.AddKey myUcase(lasthead$ + what$, True), CVar(offset)
            If offsetlist.Done Then
            offsetlist.sValue = probeoffset - offset
            ' keytype not used for strucrures except for single values
            ' so Eval() can read single from 4 bytes
            If itissingle Then offsetlist.KeyTypeValue = CInt(vbSingle): itissingle = False
            End If
        GoTo again
        Else
        Exit Function
        End If
    Else
        Exit Function
    End If
        Else
        Exit Function
    End If

    ElseIf IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang, , , , False) Then
    itissingle = False
                            If IsLabelSymbolNew(b$, "ΨΗΦΙΟ", "BYTE", Lang, , , , False) Then
                                     offset1 = 1
                                ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                                     offset1 = 2
                                ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                                     offset1 = 4
                                ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                                     offset1 = 4
                                     itissingle = True
                                ElseIf IsLabelSymbolNew(b$, "ΓΡΑΜΜΑ", "STRING", Lang, , , , False) Then
                                     offset1 = -4
                                ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                                     offset1 = 8
                                Else
                                If IsLabelOnly(b$, s$) Then
                                If IsExp(basestack, s$, p) Then
                                    If basestack.lastobj Is Nothing Then GoTo comehere
                                    If Not TypeOf basestack.lastobj Is mHandler Then GoTo comehere
                                    If Not TypeOf basestack.lastobj.objref Is FastCollection Then GoTo comehere
                                    If basestack.lastobj.objref.StructLen = 0 Then GoTo comehere
                                offset1 = basestack.lastobj.objref.StructLen
                                    Set basestack.lastobj = Nothing
                                    Else
                                    GoTo comehere
                                End If
                                Else
comehere:
                                    SyntaxError
                 
                                   Exit Function
                                   End If
                                   End If
    
    Else
    
    offset1 = 2
    End If
    w2 = offset1  ' negative offset for strings
    p = 1
    If FastSymbol(b$, "*") Then
    If Not IsExp(basestack, b$, p) Then
           MissNumExpr
        Exit Function
    Else
    p = MyRound(p)
    If p * Abs(offset1) + offset > &H1FFFFFFF Then  ' half gigabyte for struct (is very big too)
        MyEr "Too big number for struct", "Μεγάλο νούμερο για δομή"
        Exit Function
    ElseIf p < 0 Then
        MyEr "Too big number for struct", "Μεγάλο νούμερο για δομή"
        Exit Function
    Else
        offset1 = offset1 * CLng(p)
    End If
    End If
    End If
    If offsetlist.ExistKey(lasthead$ + what$) Then
    MyEr "double name is same struct", "διπλή εισαγωγή ονόματος"
    StructPage = False
    Set offsetlist = Nothing
    Exit Function
    End If
    
    offsetlist.AddKey myUcase(lasthead$ + what$, True), CVar(offset)
    If offsetlist.Done Then offsetlist.sValue = w2
    If itissingle Then offsetlist.KeyTypeValue = CInt(vbSingle): itissingle = False
    offset = offset + Abs(offset1)
    SetNextLineNL b$
    Do
        While FastSymbol(b$, vbCrLf, , 2)
        Wend
    Loop Until Not NocharsInLine(b$) Or b$ = vbNullString
    Loop Until Not Between(Abs(IsLabelOnly(b$, what$)), 1, 3, 2)
        If maxoffset < offset Then
    offset2 = offset
    Else
    offset2 = maxoffset
    End If
    StructPage = True
    GoTo again1
   End If
    If maxoffset < offset Then
    offset2 = offset
    Else
    offset2 = maxoffset
    End If
    StructPage = True
   
    If offset2 < maxoffset Then
        offset2 = maxoffset
        StructPage = True
    End If
    End If
    

End Function

Function MyLet(bstack As basetask, rest$, Lang As Long) As Boolean
Dim what$, ss$, i As Long, x1 As Long, flag As Boolean, grp As Boolean
grp = bstack.UseGroupname = vbNullString
MyLet = True
Do
   x1 = Abs(IsLabelBig(bstack, rest$, what$))
    
    If x1 <> 0 Then
            If x1 > 4 Then
                    ss$ = BlockParam(rest$)
                    what$ = what$ + ss$ + ")"
                    rest$ = Mid$(rest$, Len(ss$) + 2)
                    Do While IsSymbol(rest$, ".")
                    x1 = IsLabel(bstack, rest$, ss$)
                    If x1 > 0 Then what$ = what$ + "." + ss$ Else Exit Do
                            If x1 > 4 Then
                            ss$ = BlockParam(rest$)
                            what$ = what$ + ss$ + ")"
                            rest$ = Mid$(rest$, Len(ss$) + 2)
                            End If
                    Loop
            End If
    
If FastSymbol(rest$, "=") Then

    i = 1
    aheadstatus rest$, False, i
    If i > 1 Then
ss$ = Left$(rest$, i - 1)
                'I2 bstack, "PUSH", ss$, flag, lang
                flag = MyPush(bstack, ss$)
                If LastErNum = -2 Then
                rest$ = ss$ + Mid$(rest$, i)
                MyLet = flag
                Exit Function
                End If
              If MyLet Then
              
              MyLet = MyRead(6, bstack, (what$), 1, what$, x1)
            
            
             rest$ = Mid$(rest$, i)
             Else
             MyEr "Nothing to assign", "Τίποτα για να δώσω"
             Exit Function
             End If
    Else
            MyEr "Expecting expression", "Περίμενα έκφραση"
            MyLet = False
    End If
  
End If

End If
Loop Until Not FastSymbol(rest$, ",")
End Function
Function MyThread(bstack As basetask, rest$, Lang As Long) As Boolean
Dim frm$, ss$, what$, i As Long, p As Variant, x As Double, par As Boolean, bs As basetask
MyThread = True
     If FastSymbol(rest$, "{") Then
        frm$ = NLtrim$(block(rest$))
        If FastSymbol(rest$, "}") Then
                par = False
                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
                Else
                    MyEr "can't find clause AS variable_name", "δεν μπορώ να βρώ το μέρος ΩΣ ονομα_μεταβλητής"
                   
                    MyThread = False
               
                    Exit Function
                End If
                Select Case Abs(IsLabel(bstack, rest$, what$)) ' is Ifier
                Case 1
                        p = GetTaskId + 20000
                        If GetVar(bstack, what$, i) Then ' if exist
                            var(i) = p
                        Else
                            globalvar what$, p     ' or make one
                        End If
                        Set bs = New basetask   ' bs is the basetask of the thread but thread process class arn't constructed yet
                        Set bs.Parent = bstack  ' link to current basestask
      
                        bs.reflimit = bstack.reflimit
                        bstack.PushThread CLng(p), what$  'push thread id and Ifier to threads collection in current basetask
                        sThreadInternal bs, p, 0, frm$, uintnew(-1), here$, False ' thread construction - also we have a connection to
                        
                        
                        Set bs = Nothing
                        ss$ = vbNullString
                        If IsLabelSymbolNewExp(rest$, "ΚΑΘΕ", "INTERVAL", Lang, ss$) Then
                        GoTo chekInterval
                        ElseIf IsLabelSymbolNewExp(rest$, "ΕΚΤΕΛΕΣΗ", "EXECUTE", Lang, ss$) Then
                        TaskMaster.Message CLng(p), 4, , rest$
                        End If
                Case Else
                       MissingnumVar
                        
                        MyThread = False
  
                     Exit Function
                End Select
        End If
ElseIf IsExp(bstack, rest$, p) Then
ss$ = vbNullString
    If IsLabelSymbolNewExp(rest$, "ΣΒΗΣΕ", "ERASE", Lang, ss$) Then
       If Not bstack.ThrowOne(CLng(p)) Then
       TaskMaster.ThrowOne (CLng(p))
       End If
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΡΑΤΑ", "HOLD", Lang, ss$) Then
        TaskMaster.Message CLng(p), 0
    ElseIf IsLabelSymbolNewExp(rest$, "ΕΚΤΕΛΕΣΗ", "EXECUTE", Lang, ss$) Then
     TaskMaster.Message CLng(p), 4, , rest$
    ElseIf IsLabelSymbolNewExp(rest$, "ΞΕΚΙΝΑ", "RESTART", Lang, ss$) Then
        TaskMaster.Message CLng(p), 2
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΑΘΕ", "INTERVAL", Lang, ss$) Then
chekInterval:
        If IsExp(bstack, rest$, x) Then
            If x < 2 Then x = 2
            TaskMaster.Message CLng(p), 3, CLng(x)
        Else
            MisInterval
            MyThread = False
        End If
    Else
        NoClauseInThread
      
        MyThread = False

    End If
End If
what$ = vbNullString
End Function
Function ObjFromPtr(ByVal Ptr As Long) As Object
    ObjSetAddRef ObjFromPtr, Ptr
End Function
Sub ProcBold(bstack As basetask, rest$)
Dim p As Variant
If IsExp(bstack, rest$, p) Then
bstack.myBold = (p <> 0)
Else
bstack.myBold = Not bstack.myBold
p = CDbl(bstack.myBold)
End If
players(GetCode(bstack.Owner)).bold = Abs(p <> 0)
bstack.Owner.Font.bold = Abs(p <> 0)

End Sub
Sub ProcChooseFont(bstack As basetask, Lang As Long)
If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
DialogSetupLang Lang
With bstack.Owner
    ReturnFontName = .Font.name
    ReturnBold = .Font.bold
    ReturnItalic = .Font.Italic
    ReturnSize = CSng(.Font.Size)
    ReturnCharset = .Font.charset
End With
FeedFont2Stack bstack, OpenFont(bstack, Form1)

End Sub
Function ProcGradient(bstack As basetask, rest$) As Boolean
Dim x As Double, y As Double, p As Variant
ProcGradient = True
If Not IsExp(bstack, rest$, x) Then x = rgb(255, 255, 255)
If Not FastSymbol(rest$, ",") Then
y = 0
Else
If Not IsExp(bstack, rest$, y) Then y = 0
End If
If Not FastSymbol(rest$, ",") Then

Gradient bstack.Owner, mycolor(x), mycolor(y), 0, 0, 0, 0, True, False


Else
If Not IsExp(bstack, rest$, p) Then
ProcGradient = IfierVal: Exit Function
Else
Gradient bstack.Owner, mycolor(x), mycolor(y), 0, 0, 0, 0, p <> 0, False


End If
End If

End Function
Function ProcMode(bstack As basetask, rest$) As Boolean
Dim Scr As Object, p As Variant, x1 As Long, y1 As Long
Dim prive As Long
ProcMode = True
'' Kform is global
Kform = True
On Error Resume Next
Set Scr = bstack.Owner
With players(GetCode(Scr))
If .double Then SetNormal Scr

x1 = Scr.Width
y1 = Scr.Height
If Scr.name = "GuiM2000" Then
    Else
If Scr.name = "Form1" Then
DisableTargets q(), -1

ElseIf Scr.name = "DIS" Then
DisableTargets q(), 0

ElseIf Scr.name = "dSprite" Then
DisableTargets q(), val(Scr.index)
End If
End If
If IsExp(bstack, rest$, p) Then
If bstack.toprinter Then
If prFactor = 0 Then
prFactor = 1
End If
.SZ = CSng(p) * szFactor
Else
.SZ = CSng(p)
End If
If .SZ < 4 Then .SZ = 4
If Not bstack.toprinter Then
If FastSymbol(rest$, ",") Then
    If IsExp(bstack, rest$, p) Then x1 = CLng(p): y1 = CLng(x1 * ScrInfo(Console).Height / ScrInfo(Console).Width)
    If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, p) Then y1 = CLng(p)
        
    End If
ElseIf FastSymbol(rest$, ";") Then
prive = GetCode(bstack.Owner)
.mysplit = 0
Scr.Font.Size = .SZ
       SetText Scr
        GetXYb Scr, players(prive), .curpos, .currow

Set Scr = Nothing
Exit Function
End If
Else
'.SZ = .SZ * 3
End If
Err.Clear
Scr.Font.Size = .SZ
If Err.Number > 0 Then

MYFONT = "ARIAL"
Scr.Font.name = MYFONT
Scr.Font.charset = bstack.myCharSet
Scr.Font.name = MYFONT
Scr.Font.charset = bstack.myCharSet
End If
.SZ = Scr.Font.Size
     .uMineLineSpace = .MineLineSpace
    
 FrameText Scr, .SZ, x1, y1, .Paper
 
    Else
    ProcMode = False
    Exit Function
    End If
    .currow = 0
    .curpos = 0
    .XGRAPH = 0
    .YGRAPH = 0
End With
Set Scr = Nothing

End Function
Function ProcDrawWidth(bstack As basetask, rest$) As Boolean
Dim x As Double, p As Variant, it As Long, ss$, frm$, i As Long, x1 As Long
ProcDrawWidth = True
Dim Scr As Object
Set Scr = bstack.Owner
If IsExp(bstack, rest$, p) Then
    i = Scr.DrawWidth
    x1 = Scr.DrawStyle
    If Int(p) < 1 Then p = 1
    Scr.DrawWidth = p
   
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, x) Then
                On Error Resume Next
                x = Int(x)
                If x >= 0 Or x <= 6 Then
                    Scr.DrawStyle = x
                    If Err Then x = 0: Scr.DrawStyle = Int(x)
                    Scr.DrawWidth = p
                End If
            End If
        End If
   
    If FastSymbol(rest$, "{") Then
        ss$ = "{" & block(rest$) & "}"
        frm$ = rest$
        If FastSymbol(rest$, "}") Then
            Call executeblock(it, bstack, ss$, False, False)
        End If
    End If
End If
Scr.DrawWidth = i
Scr.DrawStyle = x1
If it <> 1 Then
    If Trim(ss$) = vbNullString Then ss$ = " "
    rest$ = Left$(ss$, Len(ss$) - 1) + frm$
    ProcDrawWidth = False
End If
Set Scr = Nothing
End Function
Function ProcCurve(bstack As basetask, rest$, Lang As Long) As Boolean
Dim par As Boolean, sX As Double, sY As Double, x As Double, y As Double, x1 As Integer, p As Variant, F As Long
Dim Scr As Object

Set Scr = bstack.Owner
ProcCurve = True
With players(GetCode(Scr))
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", Lang) Then par = True
F = 32
ReDim PLG(F)
x1 = 1
PLG(0).x = Scr.ScaleX(.XGRAPH, 1, 3)
PLG(0).y = Scr.ScaleY(.YGRAPH, 1, 3)
Do
If x1 >= F Then F = F * 2: ReDim Preserve PLG(F)
If IsExp(bstack, rest$, p) Then
x = p

If Not FastSymbol(rest$, ",") Then ProcCurve = False: MissNumExpr: Exit Function
If IsExp(bstack, rest$, p) Then
If par Then
sX = x / PI2
sX = (sX - Fix(sX)) * PI2
.XGRAPH = .XGRAPH + Cos(sX) * p
.YGRAPH = .YGRAPH - Sin(sX) * p
Else
.XGRAPH = .XGRAPH + CLng(x)
.YGRAPH = .YGRAPH + CLng(p)
End If
PLG(x1).x = Scr.ScaleX(.XGRAPH, 1, 3)
PLG(x1).y = Scr.ScaleY(.YGRAPH, 1, 3)

Else
 ProcCurve = False: MissNumExpr: Exit Function
End If
Else
 ProcCurve = False: MissNumExpr: Exit Function
End If

x1 = x1 + 1
Loop Until Not FastSymbol(rest$, ",")
x1 = x1 - 1




If GDILines And Not .NoGDI Then
If .pathgdi > 0 Then
If x1 + 4 >= F Then F = F + 4: ReDim Preserve PLG(F)
PLG(x1 + 1) = PLG(0)
PLG(x1 + 2) = PLG(0)
PLG(x1 + 3) = PLG(0)
PLG(x1 + 4) = PLG(0)
    DrawBezierGdi Scr.hDC, .mypen, .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, PLG(), CLng(x1 + 4)
    Else
    DrawBezierGdi Scr.hDC, .mypen, -1, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, PLG(), CLng(x1 + 1)
End If
Else
If PolyBezier(Scr.hDC, PLG(0), x1 + 1) = 0 Then
BadGraphic
 Exit Function
End If
End If
Scr.fillstyle = vbSolid
End With
MyDoEvents1 Scr


End Function

Function ProcPoly(bstack As basetask, rest$, Lang As Long) As Boolean
Dim par As Boolean, sX As Double, sY As Double, x As Double, y As Double, x1 As Integer, p As Variant, F As Long
Dim col As Long, Scr As Object
ProcPoly = True

Set Scr = bstack.Owner
If IsExp(bstack, rest$, p) Then
col = p
End If
If Not FastSymbol(rest$, ",") Then SyntaxError: ProcPoly = False: Exit Function
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", Lang) Then par = True
Scr.fillstyle = vbSolid
Scr.FillColor = mycolor(col)
F = 32
ReDim PLG(F)
x1 = 1
With players(GetCode(Scr))
PLG(0).x = Scr.ScaleX(.XGRAPH, 1, 3)
PLG(0).y = Scr.ScaleY(.YGRAPH, 1, 3)
Do
If x1 >= F Then F = F * 2: ReDim Preserve PLG(F)
If IsExp(bstack, rest$, p) Then
x = p

If Not FastSymbol(rest$, ",") Then SyntaxError: ProcPoly = False: Set Scr = Nothing: Exit Function
    If IsExp(bstack, rest$, p) Then
        If par Then
      
            sX = x / PI2
            sX = (sX - Fix(sX)) * PI2
            .XGRAPH = .XGRAPH + Cos(sX) * p
            .YGRAPH = .YGRAPH - Sin(sX) * p
        Else
            .XGRAPH = .XGRAPH + CLng(x)
            .YGRAPH = .YGRAPH + CLng(p)
        End If
        PLG(x1).x = Scr.ScaleX(.XGRAPH, 1, 3)
        PLG(x1).y = Scr.ScaleY(.YGRAPH, 1, 3)
    
    Else
         MissNumExpr
         Set Scr = Nothing
        ProcPoly = False: Exit Function
    End If
Else
MissNumExpr
Set Scr = Nothing
ProcPoly = False: Exit Function
End If

x1 = x1 + 1
Loop Until Not FastSymbol(rest$, ",")
x1 = x1 - 1
'If x1 >= F Then F = F + 1: ReDim Preserve PLG(F)
PLG(x1) = PLG(0)
If GDILines And Not .NoGDI Then
If .pathgdi > 0 Then
    DrawPolygonGdi Scr.hDC, .mypen, .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, PLG(), CLng(x1 + 1)
    Else
    DrawPolygonGdi Scr.hDC, .mypen, Scr.FillColor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, PLG(), CLng(x1 + 1)
End If
Else
If Polygon(Scr.hDC, PLG(0), x1) = 0 Then

ProcPoly = True: BadGraphic: Set Scr = Nothing: Exit Function
End If
End If
Scr.fillstyle = vbSolid
End With
MyDoEvents1 Scr
Set Scr = Nothing
End Function
Function ProcCircle(bstack As basetask, rest$, Lang As Long) As Boolean
Dim par As Boolean, sX As Double, sY As Double, x As Double, y As Double, x1 As Integer, p As Variant
Dim col As Long, Scr As Object, isarc As Boolean
ProcCircle = True
par = False
If IsLabelSymbolNew(rest$, "ΓΕΜΙΣΜΑ", "FILL", Lang) Then
If IsExp(bstack, rest$, p) Then x = p
If Not FastSymbol(rest$, ",") Then MissNumExpr: ProcCircle = False: Exit Function
par = True
End If
x1 = 0
y = 1

With players(GetCode(bstack.Owner))
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MissNumExpr: ProcCircle = False: Exit Function
sX = 0
sY = 0
isarc = False
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sX = p: isarc = True Else MissNumExpr: ProcCircle = False: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sY = p: isarc = True Else MissNumExpr: ProcCircle = False: Exit Function
sX = sX / PI2
sX = (sX - Fix(sX)) * PI2
sY = sY / PI2
sY = (sY - Fix(sY)) * PI2
Set Scr = bstack.Owner
Scr.CurrentX = .XGRAPH
Scr.CurrentY = .YGRAPH
If x1 <= 0 Or y < 0.001 Then Exit Function
If par Then
    Scr.fillstyle = vbSolid
    Scr.FillColor = mycolor(x)
    If sX = sY Then sY = PI2
    If sX = sY Or Abs(sX - sY) + 0.0001 > PI2 Then
    
        If GDILines And Not .NoGDI Then
        If y > 1 Then
            If .pathfillstyle > 0 Then
                DrawEllipseGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            Else
                DrawEllipseGdi Scr.hDC, mycolor(col), mycolor(x), vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            End If
        Else
            If .pathfillstyle > 0 Then
                DrawEllipseGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            Else
                DrawEllipseGdi Scr.hDC, mycolor(col), mycolor(x), vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3)
            End If
        End If
        Else
            sX = MyMod(sX + Pi * 2, 2 * Pi)
    sY = MyMod(sY + Pi * 2, 2 * Pi)
             Scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), , , y
        End If
        
    Else
            If sX = 0 Then sX = 0.0001
            If sY = 0 Then sY = PI2
            If GDILines And Not .NoGDI Then
            ' revision 30, version 9.3 fixed
            If y > 1 Then
            If .pathfillstyle > 0 Then
                    DrawArcPieGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3), -sX, -sY
               Else
                 
                    DrawArcPieGdi Scr.hDC, mycolor(col), mycolor(x), vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3), -sX, -sY
                End If
            Else
               If .pathfillstyle > 0 Then
                    DrawArcPieGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3), -sX, -sY
               Else
                 
                    DrawArcPieGdi Scr.hDC, mycolor(col), mycolor(x), vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3), -sX, -sY
                End If
                End If
            Else
    sX = MyMod(sX + Pi * 2, 2 * Pi)
    sY = MyMod(sY + Pi * 2, 2 * Pi)
                Scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), -sX, -sY, y
            End If
    End If
            Scr.fillstyle = 1
Else
    Scr.fillstyle = 1
    If GDILines And Not .NoGDI Then
       
        If sX = sY Or Abs(sX - sY) + 0.0001 > PI2 Then
        If y > 1 Then
        If .pathfillstyle > 0 Then
                DrawEllipseGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            Else
                DrawEllipseGdi Scr.hDC, mycolor(col), -1, vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            End If
        Else
             If .pathfillstyle > 0 Then
                DrawEllipseGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3)
            Else
                DrawEllipseGdi Scr.hDC, mycolor(col), -1, vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3)
            End If
            End If
        Else
        If y > 1 Then
             If .pathfillstyle > 0 Then
           
                DrawArcPieGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3), -sX, -sY
            Else
                'fixed
                DrawArcPieGdi Scr.hDC, mycolor(col), -1, vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3), -sX, -sY
            End If
        Else
             If .pathfillstyle > 0 Then
           
                DrawArcPieGdi Scr.hDC, mycolor(col), .pathcolor, .pathfillstyle, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1 / y, 1, 3), Scr.ScaleY(.YGRAPH - x1, 1, 3), Scr.ScaleX(x1 * 2 / y, 1, 3), Scr.ScaleY(x1 * 2, 1, 3), -sX, -sY
            Else
                'fixed
                DrawArcPieGdi Scr.hDC, mycolor(col), -1, vbSolid, Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH - x1, 1, 3), Scr.ScaleY(.YGRAPH - x1 * y, 1, 3), Scr.ScaleX(x1 * 2, 1, 3), Scr.ScaleY(x1 * 2 * y, 1, 3), -sX, -sY
            End If
        End If
        End If
    Else
    sX = MyMod(sX + Pi * 2, 2 * Pi)
    sY = MyMod(sY + Pi * 2, 2 * Pi)
        Scr.Circle (.XGRAPH, .YGRAPH), x1, mycolor(col), sX, sY, y
    End If
End If
End With
MyDoEvents1 Scr
Set Scr = Nothing

End Function
Function ProcDraw(bstack As basetask, rest$, Lang As Long) As Boolean
Dim col As Long, x1 As Long, sX As Double, sY As Double, F As Long, y1 As Long
Dim p As Variant, Scr As Object

ProcDraw = True

With players(GetCode(bstack.Owner))
x1 = 0
y1 = 1
col = .mypen
If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", Lang) Then
If IsExp(bstack, rest$, p) Then x1 = p Else x1 = .XGRAPH
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then y1 = p Else y1 = .YGRAPH
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then col = p Else ProcDraw = False: Exit Function
End If
Else
 y1 = .YGRAPH
End If

Set Scr = bstack.Owner
Scr.CurrentX = .XGRAPH
Scr.CurrentY = .YGRAPH

If GDILines Then
DrawLineGdi Scr.hDC, mycolor(col), Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH, 1, 3), Scr.ScaleX(.YGRAPH, 1, 3), Scr.ScaleX(x1, 1, 3), Scr.ScaleX(y1, 1, 3)
.XGRAPH = x1
.YGRAPH = y1
Else
Scr.Line (.XGRAPH, .YGRAPH)-(x1, y1), mycolor(col)
.XGRAPH = Scr.CurrentX
.YGRAPH = Scr.CurrentY

End If
MyDoEvents1 Scr
Set Scr = Nothing
Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", Lang) Then
If IsExp(bstack, rest$, p) Then sX = p Else ProcDraw = False: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sY = p Else ProcDraw = False: Exit Function
sX = sX / PI2
sX = (sX - Fix(sX)) * PI2
x1 = Cos(sX) * sY
y1 = -Sin(sX) * sY
Else
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p
End If
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else ProcDraw = False: Exit Function
Set Scr = bstack.Owner
Scr.CurrentX = .XGRAPH
Scr.CurrentY = .YGRAPH


If GDILines Then
DrawLineGdi Scr.hDC, mycolor(col), Scr.DrawWidth, Scr.DrawStyle, Scr.ScaleX(.XGRAPH, 1, 3), Scr.ScaleX(.YGRAPH, 1, 3), Scr.ScaleX(.XGRAPH + x1, 1, 3), Scr.ScaleX(.YGRAPH + y1, 1, 3)
.XGRAPH = .XGRAPH + x1
.YGRAPH = .YGRAPH + y1
Else
Scr.Line (.XGRAPH, .YGRAPH)-Step(x1, y1), mycolor(col)
.XGRAPH = Scr.CurrentX
.YGRAPH = Scr.CurrentY
End If
MyDoEvents1 Scr
Set Scr = Nothing
End With

End Function
Function ProcStep(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, sY As Double, sX As Double
ProcStep = True
With players(GetCode(bstack.Owner))
If IsLabelSymbolNew(rest$, "ΓΩΝΙΑ", "ANGLE", Lang) Then
If IsExp(bstack, rest$, p) Then sX = p Else ProcStep = False: MissNumExpr: Exit Function
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then sY = p Else ProcStep = False: MissNumExpr: Exit Function
sX = sX / PI2
sX = (sX - Fix(sX)) * PI2
.XGRAPH = .XGRAPH + Cos(sX) * sY
.YGRAPH = .YGRAPH - Sin(sX) * sY
Else
If IsExp(bstack, rest$, p) Then .XGRAPH = .XGRAPH + p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then .YGRAPH = .YGRAPH + p Else ProcStep = False: MissNumExpr: Exit Function
End If
End With


End Function
Function ProcMove(bstack As basetask, rest$) As Boolean
ProcMove = True
Dim p As Variant
With players(GetCode(bstack.Owner))
If FastSymbol(rest$, "!") Then
 .XGRAPH = .curpos * .Xt
 .YGRAPH = .currow * .Yt
ElseIf IsExp(bstack, rest$, p) Then .XGRAPH = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then .YGRAPH = p Else ProcMove = False: MissNumExpr: Exit Function
End If
End With
End Function
Function ProcPlayer(bstack As basetask, rest$, Lang As Long)
Dim par As Boolean, sX As Double, sY As Double, x As Double, y As Double, x1 As Integer, p As Variant, it As Long
Dim col As Long, Scr As Object, what$, i As Long, s$, pppp As mArray, frm$, sxy As Double
If IsExp(bstack, rest$, p) Then
    If p = 0 Then   ' ZERO CLEAR ALL HARDWARE SPRITES
        ClrSprites
        ProcPlayer = True
        Exit Function
    End If
    If p < 1 Or p > 32 Then SyntaxError: ProcPlayer = False: Exit Function
    it = FindSpriteByTag(CLng(p))
    If FastSymbol(rest$, ",") Then
        If Not IsExp(bstack, rest$, x) Then  ' get new left or leave it empty
            If it = 0 Then
                x = 0
            Else
                x = Form1.dSprite(it).Left + players(it).x
            End If
            If FastSymbol(rest$, ",") Then
                If Not IsExp(bstack, rest$, y) Then MissNumExpr: ProcPlayer = False: Exit Function
            Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End If
        Else
            If FastSymbol(rest$, ",") Then   ' so ,, is "stay X where you are
                If Not IsExp(bstack, rest$, y) Then MissNumExpr: ProcPlayer = False: Exit Function
            Else
                If it = 0 Then
                    y = 0
                Else
                    y = Form1.dSprite(it).Top + players(it).y
                End If
            End If
        End If
        If IsLabelSymbolNew(rest$, "ΜΕ", "USE", Lang) Then ' no need for coma
            Select Case Abs(IsLabel(bstack, rest$, what$))
            Case 3
                If GetVar(bstack, what$, i) Then s$ = var(i)
            Case 6
                If neoGetArray(bstack, what$, pppp) Then
                    
                    If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then
                        MissNumExpr
                        ProcPlayer = True: Exit Function
                    End If
                Else
                    MissNumExpr
                    ProcPlayer = False: Exit Function
                End If
                s$ = pppp.item(it)  ' get the sprite image
            Case Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End Select
            col = rgb(255, 255, 255)
            sX = 0
            If FastSymbol(rest$, ",") Then  ' get image manipulators..
                    If IsExp(bstack, rest$, sY) Then
                     col = CLng(sY)
                     If col > 0 Then col = QBColor(col Mod 16) Else col = -col
                     ElseIf IsStrExp(bstack, rest$, frm$) Then
                     '' maybe is a mask
                     
                     col = 0
                     Else
                     ProcPlayer = False: MissNumExpr: Exit Function
                    End If
                     
                        If FastSymbol(rest$, ",") Then
                            If IsExp(bstack, rest$, sX) Then
                          
                               Else
                            MissNumExpr
                            ProcPlayer = False: Exit Function
                            End If
                        Else
                
                        End If
                    
              End If
              If FastSymbol(rest$, ",") Then
                            If IsExp(bstack, rest$, sxy) Then
                        
                               Else
                            MissNumExpr
                            ProcPlayer = False: Exit Function
                            End If
                        Else
                
                        End If
                   If IsLabelSymbolNew(rest$, "ΜΕΓΕΘΟΣ", "SIZE", Lang) Then
              If Not IsExp(bstack, rest$, sY) Then ProcPlayer = False: MissNumExpr: Exit Function
              Else
              sY = 1
              End If
              ' so col, sx and sy are image manipulators
            it = GetNewSpriteObj(CLng(p), s$, col, CLng(sX), CSng(sY), CSng(sxy), frm$)
          
            PosSprite CLng(p), x - players(it).x, y - players(it).y
        Else ' without USE
         PosSprite CLng(p), x - players(it).x, y - players(it).y
        End If
        Else ' without x, y
            If IsLabelSymbolNew(rest$, "ΜΕ", "USE", Lang) Then
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 3
            If GetVar(bstack, what$, i) Then s$ = var(i)
        Case 6
             If neoGetArray(bstack, what$, pppp) Then
   
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then
                     ProcPlayer = False: MissNumExpr: Exit Function
                End If
            Else
                 ProcPlayer = False: MissNumExpr: Exit Function
            End If
            s$ = pppp.item(it)
        Case Else
             ProcPlayer = False: MissNumExpr: Exit Function
        End Select
        col = rgb(255, 255, 255)
        sX = 0
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, sY) Then
            col = CLng(sY)
            If col > 0 Then col = QBColor(col) Else col = -col
        ElseIf IsStrExp(bstack, rest$, frm$) Then
            '' maybe is a mask
            col = 0
        Else
            ProcPlayer = False: MissNumExpr: Exit Function
        End If
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, sX) Then
            Else
                MissNumExpr
                ProcPlayer = False: Exit Function
            End If
        Else
        End If
    End If
            If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, sxy) Then
                Else
                    MissNumExpr
                    ProcPlayer = False: Exit Function
                End If
            Else
    
            End If
            If IsLabelSymbolNew(rest$, "ΜΕΓΕΘΟΣ", "SIZE", Lang) Then          ' SIZE WITHOUT COMMA
                If Not IsExp(bstack, rest$, sY) Then ProcPlayer = False: MissNumExpr: Exit Function
            Else
                sY = 1
            End If
    
            it = GetNewSpriteObj(CLng(p), s$, col, CLng(sX), CSng(sY), CSng(sxy), frm$)
            ' no USE no X, Y or X,Y USE ..
            ' only command
        ElseIf IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", Lang) Then     ' SHOW
            SrpiteHideShow p, (True)
        ElseIf IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", Lang) Then        ' HIDE
            SrpiteHideShow p, (False)
        ElseIf IsLabelSymbolNew(rest$, "ΑΛΛΑΞΕ", "SWAP", Lang) Then       ' SWAP
            If IsExp(bstack, rest$, x) Then
                SpriteControl CLng(p), CLng(x)
                Dim bb As basket, bl As Long, BR As Long
                bl = FindSpriteByTag(CLng(p))
                BR = FindSpriteByTag(CLng(x))
                bb = players(bl)
                players(bl) = players(BR)
                players(BR) = bb
                
            Else
                ProcPlayer = False
            End If
        End If
    End If
End If
ProcPlayer = True
Exit Function
End Function
Function MyRead(jump As Long, bstack As basetask, rest$, Lang As Long, Optional ByVal what$, Optional usex1 As Long) As Boolean
Dim ps As mStiva, bs As basetask, F As Long, ohere$, par As Boolean, flag As Boolean, flag2 As Boolean, ok As Boolean
Dim s$, ss$, pa$, x1 As Long, y1 As Long, i As Long, myobject As Object, it As Long, useoptionals As Boolean, optlocal As Boolean
Dim m As mStiva, checktype As Boolean, allowglobals As Boolean, isAglobal As Boolean, look As Boolean
MyRead = True
Dim p As Variant, x As Double
Dim pppp As mArray
ohere$ = here$
Dim col As Long
Dim ihavetype As Boolean
look = jump = 1 Or jump = 7
On jump GoTo read, refer, commit, readnew, readlocal, readlet, readfromsub, link
Exit Function
commit:
If bstack.UseGroupname <> "" Then
F = True
col = 1
Set bs = bstack
GoTo contFromRebound
Else
BadReBound
MyRead = False
End If
Exit Function
link:
flag2 = True
refer:
col = 1
GoTo read123

readlocal:
flag = True
GoTo read123
readfromsub:
If FastSymbol(rest$, "?") Then useoptionals = True
readnew:
flag2 = True
GoTo read123
readlet:
allowglobals = True
Set bs = bstack
x1 = usex1
If x1 > 3 Then x1 = Abs(IsLabel(bstack, rest$, what$))
'***********************
Select Case x1
Case 1
    If bs.IsObjectRef(myobject) Then
        MyRead = True
        If GetVar3(bstack, what$, i, , , flag, s$, checktype, isAglobal, True) Then
            If Typename$(myobject) = Typename(var(i)) Then
                If Typename$(var(i)) = "Group" Then
                                    ss$ = bstack.GroupName
                                    If s$ <> "" Then what$ = s$
                                     If Len(var(i).GroupName) > Len(what$) Then
                                        If var(i).IamRef Then ' Or bstack.UseGroupname <> ""
                                    
                                         s$ = here$
                                          here$ = vbNullString
                                        UnFloatGroupReWriteVars bstack, what$, i, myobject
                                        here = s$
                                        Else
                                        UnFloatGroupReWriteVars bstack, what$, i, myobject
                                        End If
                                    Else
                                        bstack.GroupName = Left$(what$, Len(what$) - Len(var(i).GroupName) + 1)
                                        If Len(var(i).GroupName) > 0 Then
                                            what$ = Left$(var(i).GroupName, Len(var(i).GroupName) - 1)
                                            s$ = here$
                                            here$ = vbNullString
                                            UnFloatGroupReWriteVars bstack, what$, i, myobject
                                            here = s$
                                        ElseIf var(i).IamApointer And myobject.IamApointer Then
                                        Set var(i) = myobject
                                        
                                        Else
                                            Set myobject = Nothing
                                            bstack.GroupName = ss$
                                            GroupWrongUse
                                            MyRead = False
                                            Exit Function
                                        End If
                                    End If
                                    Set myobject = Nothing
                                    bstack.GroupName = ss$
        
                       
                        ElseIf Typename$(var(i)) = "mHandler" Then
                            If var(i).ReadOnly Then
                                MyRead = False
                               ReadOnly
                               Exit Function
                            ElseIf var(i).t1 = myobject.t1 Or myobject.t1 = 3 Then
                               Set var(i) = myobject
                            Else
                              MyRead = False
                              MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                              Exit Function
                            End If
                        Else
                        Set var(i) = myobject
                        End If
                    ElseIf x1 = 1 And CheckIsmArray(myobject) Then
                   
                        ''bstack.lastobj.CopyArray pppp
                        Set var(i) = New mHandler
                        var(i).t1 = 3
                       Set var(i).objref = myobject
                        'Set pppp = Nothing
                        Set myobject = Nothing
                    Else
                    If TypeOf myobject Is mHandler Then
                    If myobject.t1 = 4 Then
                    p = myobject.index_cursor
                    Set myobject = Nothing
                    GoTo itisinumber
                    End If
                    End If
                         MyRead = False
                        MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                        Exit Function
                    End If
                    Else
                    i = globalvar(what$, 0)
                    If Typename$(myobject) = "Group" Then
                   If myobject.IamApointer Then
               
                Set var(i) = myobject
                Else
               UnFloatGroup bstack, bstack.GroupName & what$, i, myobject, here$ = vbNullString Or bstack.UseGroupname <> "", , True
               End If
                 ElseIf Typename$(myobject) = "mEvent" Then
                Set var(i) = myobject
            ElseIf Typename$(myobject) = "lambda" Then
                Set var(i) = myobject
                If ohere$ = vbNullString Then
                    GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
                Else
                    GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
                End If
            ElseIf Typename$(myobject) = "mHandler" Then
                If myobject.indirect > -1 Then
                    Set var(i) = MakeitObjectGeneric(myobject.indirect)
                Else
                
                Set var(i) = myobject
                End If
            ElseIf Typename$(myobject) = myArray Then
             Set var(i) = New mHandler
            var(i).t1 = 3
            Set var(i).objref = myobject

            Else
            Set var(i) = myobject
                    
            End If
            End If
    ElseIf bs.IsNumber(p) Then
itisinumber:
    If GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
    If MyIsObject(var(i)) Then
                If TypeOf var(i) Is Group Then
                    If var(i).HasSet Then
                       
                        Set m = bstack.soros
                        Set bstack.Sorosref = New mStiva
                        bstack.soros.PushVal p
                        NeoCall2 ObjPtr(bstack), what$ + "." + ChrW(&H1FFF) + ":=()", ok
                        Set bstack.Sorosref = m
                        Set m = Nothing
                    Else
                        GoTo there182741
                    End If
                Else
there182741:
If TypeOf var(i) Is Constant Then
                CantAssignValue
Else
                    MyEr "Can't assign value to object", "Δεν μπορώ να δώσω τιμή σε αντικείμενο"
                    End If
                    Exit Function
                End If
      
        Else
            If checktype Then
            If ihavetype Then
                If VarType(var(i)) <> VarType(p) Then
                    MyEr "Cant' change type of variable", "Δεν μπορώ να αλλάξω τύπο μεταβλητής"
                ElseIf AssignTypeNumeric(p, VarType(var(i))) Then
                    var(i) = p
                Else
                MyEr "Cant' Assign number", "Δεν μπορώ να θέσω τιμή κατά το διάβασμα τιμών"
                End If
            
           
            ElseIf AssignTypeNumeric(p, VarType(var(i))) Then
                var(i) = p
            Else
            MyEr "Cant' Assign number", "Δεν μπορώ να θέσω τιμή κατά το διάβασμα τιμών"
            End If
            Else
                var(i) = p
            End If
        End If

        ElseIf i = -1 Then
                bstack.SetVar what$, p
        Else
                globalvar what$, p
        End If
        End If
Case 3
    If bs.IsString(s$) Then
        MyRead = True
        If GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
        If MyIsObject(var(i)) Then
                If TypeOf var(i) Is Group Then
                        
                        Set m = bstack.soros
                        Set bstack.Sorosref = New mStiva
                        bstack.soros.PushStr s$
                        NeoCall2 ObjPtr(bstack), Left$(what$, Len(what$) - 1) + "." + ChrW(&H1FFF) + ":=()", ok
                        Set bstack.Sorosref = m
                        Set m = Nothing
                ElseIf TypeOf var(i) Is Constant Then
                CantAssignValue
                MyRead = False
                Exit Function
                Else
                    CheckVar var(i), s$
                End If
            Else
                var(i) = s$
            End If
        ElseIf i = -1 Then
            bstack.SetVar what$, s$
        Else
            globalvar what$, s$
        End If
        Else
            bstack.soros.drop 1
        MissStackStr
        MyRead = False
              End If
   
Case 4
    If bs.IsNumber(p) Then
        MyRead = True
        If GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
            var(i) = MyRound(p)
        ElseIf i = -1 Then
            bstack.SetVar what$, p
        Else
            globalvar what$, MyRound(p)
        End If
    Else
        bstack.soros.drop 1
        MissStackNumber
        MyRead = False

    End If
Case 5, 7

    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2, allowglobals): If Not MyRead Then SyntaxError: Exit Function
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Function
        Else
            Exit Function
        End If
        If IsOperator(rest$, ".") Then
            If Not Typename(pppp.item(it)) = "Group" Then
                MyEr "Expected group", "Περίμενα ομάδα"
                MyRead = False: Exit Function
            Else
                 i = 1
                aheadstatus rest$, False, i
                ss$ = Left$(rest$, i - 1)
                MyRead = SpeedGroup(bstack, pppp, "@READ", ".", ss$, it) <> 0
                rest$ = Mid$(rest$, i)
            End If
        Else
            If Not bs.IsNumber(p) Then
            bstack.soros.drop 1
                MissStackNumber
                MyRead = False
                
                Exit Function
            ElseIf x1 = 7 Then
            pppp.item(it) = Round(p)
            Else
            
            pppp.item(it) = p
            
            End If
        
        
        End If

    MyRead = True
    End If
 Case 6
    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2): If Not MyRead Then SyntaxError: Exit Function
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Function
        Else
            Exit Function
        End If
        If Not bs.IsString(s$) Then
            If bs.IsObjectRef(myobject) Then
                If Typename$(myobject) = "lambda" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing
                ElseIf Typename$(myobject) = "Group" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing

            ElseIf Typename$(myobject) = myArray Then
                    If myobject.Arr Then
                        Set pppp.item(it) = CopyArray(myobject)
                    Else
                        Set pppp.item(it) = myobject
                    End If
                    Set myobject = Nothing
                ElseIf Typename$(myobject) = "mHandler" Then
                    If myobject.indirect > -0 Then
                    Set pppp.item(it) = myobject
                    Else
                    p = myobject.t1
                    If CheckDeepAny(myobject) Then
                    If TypeOf myobject Is mHandler Then
                    Set pppp.item(it) = myobject
                    Else
                    Set pppp.item(it) = New mHandler
                    pppp.item(it).t1 = p
                    Set pppp.item(it).objref = myobject
                    End If
                    Set myobject = Nothing
                    End If
                    
                    End If
              ElseIf Typename$(myobject) = "PropReference" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing
                Else
                    MissStackStr
                    Exit Function
                End If
            Else
            bstack.soros.drop 1
                MissStackStr
                Exit Function
            End If

        Else
            If Not MyIsObject(pppp.item(it)) Then
                pppp.item(it) = s$
            ElseIf Typename(pppp.item(it)) = "Group" Then
            ' do something
            Else
                Set pppp.item(it) = New Document
                CheckVar pppp.item(it), s$
            End If
        End If
        MyRead = True
    End If

      
'*****************************************************
    End Select
    p = CDbl(0)
    Exit Function
read:
If FastSymbol(rest$, "?") Then useoptionals = True

flag2 = Fast2Label(rest$, "ΝΕΟ", 3, "NEW", 3, 3)
If Not flag2 Then flag = Fast2Label(rest$, "ΤΟΠΙΚΑ", 6, "LOCAL", 5, 6)
read123:
Set bs = bstack
contFromRebound:
par = Fast2Label(rest$, "ΑΠΟ", 3, "FROM", 4, 4)
If par And F Then
SyntaxError
MyRead = False
Exit Function
End If
If par Then
' make it general...
x1 = IsLabelBig(bstack, rest$, ss$, , , , par)
If x1 > 0 And x1 <> 1 Then rest$ = ss$ + " " + rest$
If x1 = 1 Then

 If getvar2(bstack, ss$, i, , , flag) Then
 If MyIsObject(var(i)) Then
            ' need to make new stack frame with pointers to
        If Typename(var(i)) <> "Group" Then MyRead = True: Exit Function
        Set ps = New mStiva
        If ohere$ <> "" Then
                If bstack.UseGroupname <> "" Then
                    Set myobject = var(i).PrepareSoros(var(), "")
                Else
                    If par Then
                    Set myobject = var(i).PrepareSoros(var(), ohere$ + "." + Left$(ss$, Len(ss$) - Len(var(i).GroupName) + 1))
                    Else
                    Set myobject = var(i).PrepareSoros(var(), ohere$ + ".")
                    End If
                    
                End If
                Else
                Set myobject = var(i).PrepareSoros(var(), Left$(ss$, Len(ss$) - Len(var(i).GroupName) + 1))
                End If
        With myobject
               For x1 = 1 To .Total
                  s$ = .StackItem(x1) + " "
                  If Left$(s$, 1) = "*" Then '' we have a group
                  s$ = Split(Mid$(s$, 2))(0)
                  Else
                  s$ = Split(s$)(0)
                  End If

 ''we place references

                If Right$(s$, 2) = "()" Then
                        ps.DataStr Left$(s$, Len(s$) - 2)
                ElseIf Right$(s$, 1) = "(" Then
                        ps.DataStr Left$(s$, Len(s$) - 1)
                Else
                        ps.DataStr s$
                End If
 ''bstack.Soros.DataStr .StackItem(X1)
            Next x1
        End With
Set myobject = Nothing
 Set bs = New basetask
    Set bs.Sorosref = ps
    If FastSymbol(rest$, ";") Then
    bstack.soros.MergeTop ps
    
    MyRead = True
    Exit Function
    End If
    If Not FastSymbol(rest$, ",") Then
    MissPar
    MyRead = False
 Exit Function
    End If
    
 Else
 MissingGroup
 MyRead = False
 Exit Function
 End If
 Else
 MissingGroup
 MyRead = False
 Exit Function
 End If
 col = 1 ' this is a switch... look down
 
ElseIf IsStrExp(bstack, rest$, ss$) Then
Set ps = New mStiva
Do While ss$ <> ""
If ISSTRINGA(ss$, pa$) Then
ps.DataStr pa$
ElseIf IsNumberD(ss$, x) Then
ps.DataVal x
Else
Exit Do
End If
Loop
Set bs = New basetask
Set bs.Sorosref = ps
    If Not FastSymbol(rest$, ",") Then
    MissPar
    MyRead = False
 Exit Function
    End If
End If
End If
' from here is not Myread = True
Do
again1:
MyRead = False
ihavetype = False
If look Then If FastSymbol(rest$, "?") Then useoptionals = True
If FastSymbol(rest$, ",") Then bs.soros.drop 1: GoTo again1
If FastSymbol(rest$, "&") Or col = 1 Then
' so now for GROUP variables we use only by reference
Select Case Abs(IsLabel(bstack, rest$, what$))
Case 1
If bs.IsString(s$) Then
     
          
    
    If GetGlobalVar(s$, i) Then
    
conthereifglobal:
        If flag2 Then
            If Not F Then
                If Not flag Then
                    If ohere$ <> "" Then
                        GoTo contpush12
                    Else
                        NoSecReF
                        Exit Do
                    End If
                End If
            End If
        ElseIf GetVar3(bstack, what$, it, , , flag, , , , True) And Not F Then
               If Not flag Then
                          If GetlocalVar(what$, y1) = False And ohere$ <> "" Then
                                   GoTo contpush12
                              Else
                                  NoSecReF
                                 Exit Do
                            End If
                End If
                
   
   Else
contpush12:
       what$ = myUcase$(what$)
backfromstr:
                If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                   If Not MyIsObject(var(i)) Then
                        p = var(i)
checkconstant:
                        Select Case VarType(p)
                        Case vbDecimal
                            If Not Fast2Varl(rest$, "ΑΡΙΘΜΟΣ", 7, "DECIMAL", 7, 7, F) Then MyRead = False: MissType: Exit Function
                        Case vbDouble
                            If Not Fast2Varl(rest$, "ΔΙΠΛΟΣ", 6, "DOUBLE", 6, 6, F) Then MyRead = False: MissType: Exit Function
                        Case vbSingle
                            If Not Fast2Varl(rest$, "ΑΠΛΟΣ", 5, "SINGLE", 6, 6, F) Then MyRead = False: MissType: Exit Function
                        Case vbBoolean
                            If Not Fast2Varl(rest$, "ΛΟΓΙΚΟΣ", 7, "BOOLEAN", 7, 7, F) Then MyRead = False: MissType: Exit Function
                        Case vbLong
                            If Not Fast2Varl(rest$, "ΜΑΚΡΥΣ", 6, "LONG", 4, 6, F) Then MyRead = False: MissType: Exit Function
                        Case vbInteger
                            If Not Fast2Varl(rest$, "ΑΚΕΡΑΙΟΣ", 8, "INTEGER", 7, 8, F) Then MyRead = False: MissType: Exit Function
                        Case vbCurrency
                            If Not Fast2Varl(rest$, "ΛΟΓΙΣΤΙΚΟ", 9, "CURRENCY", 8, 9, F) Then MyRead = False: MissType: Exit Function
                        Case Else
                            p = IsLabel(bstack, rest$, (what$))  ' just throw any name
                        End Select
                    Else
                        If TypeOf var(i) Is Group Then
                            If Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then MyRead = False: MissType: Exit Function
                        ElseIf TypeOf var(i) Is mHandler Then
                            If TypeOf var(i).objref Is mArray Then
                                If Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then MyRead = False: MissType: Exit Function
                            ElseIf TypeOf var(i).objref Is FastCollection Then
                                If Not Fast2Varl(rest$, "ΚΑΤΑΣΤΑΣΗ", 9, "INVENTORY", 9, 9, F) Then MyRead = False: MissType: Exit Function
                            ElseIf TypeOf var(i).objref Is MemBlock Then
                                If Not Fast2Varl(rest$, "ΔΙΑΡΘΡΩΣΗ", 9, "BUFFER", 6, 9, F) Then MyRead = False: MissType: Exit Function
                            ElseIf var(i).t1 = 4 Then
                              If Not FastType(rest$, var(i).objref.EnumName) Then MyRead = False: MissType: Exit Function
                   
                            Else
                                p = IsLabel(bstack, rest$, (what$)) ' just throw any name
                            End If
                        ElseIf TypeOf var(i) Is lambda Then
                            If Not Fast2Varl(rest$, "ΛΑΜΔΑ", 5, "LAMBDA", 6, 6, F) Then MyRead = False: MissType: Exit Function
                        
                        ElseIf TypeOf var(i) Is mEvent Then
                            If Not Fast2Varl(rest$, "ΓΕΓΟΝΟΣ", 7, "EVENT", 5, 5, F) Then MyRead = False: MissType: Exit Function
                        ElseIf TypeOf var(i) Is Constant Then
                            p = var(i)
                            GoTo checkconstant
                        Else
                            p = IsLabel(bstack, rest$, (what$)) ' just throw any name
                        End If
                    End If
                End If
       If Not LinkGroup(bstack, what$, var(i)) Then
            If F Then

                If Not ReboundVar(bstack, what$, i) Then globalvar what$, i, True
            Else
    
                globalvar what$, i, True
                If Typename(var(i)) = "lambda" Then
                    If ohere$ = vbNullString Then
                        GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
                    Else
                        GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
                    End If
                End If
            End If
        Else
            it = globalvar(what$, it)
            MakeitObject2 var(it)
            If var(i).IamApointer Then
            If var(i).link.IamFloatGroup Then
               Set var(it).LinkRef = var(i).link
                var(it).IamApointer = True
                var(it).isref = True
         '   MyEr "There is no reference for this pointer", "Δεν υπάρχει αναφορά για αυτόν τον δείκτη"
          '  MyRead = False
          '  Exit Function
            Else
            With var(i).link
            
                var(it).edittag = .edittag
                var(it).FuncList = .FuncList
                var(it).GroupName = myUcase(what$) + "."
                Set var(it).Sorosref = .soros.Copy
                var(it).HasValue = .HasValue
                var(it).HasSet = .HasSet
                var(it).HasStrValue = .HasStrValue
                var(it).HasParameters = .HasParameters
                var(it).HasParametersSet = .HasParametersSet
            
                        Set var(it).Events = .Events
            
                var(it).highpriorityoper = .highpriorityoper
                var(it).HasUnary = .HasUnary
            End With
            End If
            
            Else
            With var(i)
            
                var(it).edittag = .edittag
                var(it).FuncList = .FuncList
                var(it).GroupName = myUcase(what$) + "."
                Set var(it).Sorosref = .soros.Copy
                var(it).HasValue = .HasValue
                var(it).HasSet = .HasSet
                var(it).HasStrValue = .HasStrValue
                var(it).HasParameters = .HasParameters
                var(it).HasParametersSet = .HasParametersSet
            
                        Set var(it).Events = .Events
            
                var(it).highpriorityoper = .highpriorityoper
                var(it).HasUnary = .HasUnary
            End With
             var(it).IamRef = Len(bstack.UseGroupname) > 0
             End If
            If var(i).HasStrValue Then
                globalvar what$ + "$", it, True
            End If
            
        End If
        MyRead = True
    End If
     Else
        If GetVar3(bstack, s$, i, True, , , , , , True) Then GoTo conthereifglobal

         NoReference
    MyRead = False
    Exit Function

    End If
    Else
If bs.IsObjectRef(myobject) Then

If TypeOf myobject Is Group Then
i = AllocVar()
Set var(i) = myobject
Set myobject = Nothing
GoTo backfromstr
Else
If Not GetVar3(bstack, what$, i, , , flag, , , , True) Then i = globalvar(what$, 0)
CreateFormOtherObject var(i), myobject
End If
 MyRead = True
Set myobject = Nothing
Else
    NoReference
    MyRead = False
    Exit Function
    End If
    End If

Case 3, 4
    If bs.IsString(s$) Then
        If GetGlobalVar(s$, i) Then
            If flag2 Then
            If Not F Then
                If Not flag Then
                    If ohere$ <> "" Then
                            'GoTo contpush12
               If MyIsObject(var(i)) Then
                    If Typename(var(i)) = "lambda" Then
                        If ohere$ = vbNullString Then
                            GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
                        Else
                            GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
                        End If
                        globalvar what$, i, True
                    ElseIf Typename(var(i)) = "Group" Then
                        what$ = Left$(what$, Len(what$) - 1)
                        GoTo backfromstr
                    Else
                        globalvar what$, i, True
                    End If
                Else
                     globalvar what$, i, True
                 End If
               MyRead = True
               Else
                        NoSecReF
                        Exit Do
                    End If
                End If
            End If
        ElseIf GetVar3(bstack, what$, it, , , flag, , , , True) And Not F Then
            If Not flag Then
                          If GetlocalVar(what$, y1) = False And ohere$ <> "" Then

                                GoTo contherestr
                              Else
                                  NoSecReF
                                 Exit Do
                            End If
                End If
                NoSecReF
                Exit Do
            Else
                If F Then
                    If Not ReboundVar(bstack, what$, i) Then globalvar what$, i, True
                Else
contherestr:

            If MyIsObject(var(i)) Then
                    If Typename(var(i)) = "lambda" Then
                         If ohere$ = vbNullString Then
                             GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
                         Else
                             GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
                         End If
                         globalvar what$, i, True
                    ElseIf Typename(var(i)) = "Group" Then
                         what$ = Left$(what$, Len(what$) - 1)
                         GoTo backfromstr
                    Else
                         globalvar what$, i, True
                     End If
                Else
                globalvar what$, i, True
                End If
                End If
                MyRead = True
            End If
        Else
            NoReference
            MyRead = False
            Exit Function
        End If
    Else
        NoReference
        MyRead = False
        Exit Function
    End If
Case 5, 6, 7
    If bs.IsString(s$) Then  ' get the pointer!!!!!
        If MaybeIsSymbol(s$, "{") Then
            If Not FastSymbol(rest$, ")") Then
                MyEr "Syntax error, use )", "Συντακτικό λάθος βάλε )": Exit Do
            Else
                s$ = Left$(what$, Len(what$) - 1) + " " + s$
                If F Then
                    ss$ = here$
                    here$ = vbNullString
                    If Not MyFunction(0, bstack, s$, 1) Then
                        MyEr "No function definition founded", "Δεν βρέθηκε ορισμός συνάρτησης"
                        Exit Do
                    Else
                        sbf(bstack.IndexSub).sbgroup = s$
                    End If
                    here$ = ss$
                Else
                    If Not MyFunction(0, bstack, s$, 1) Then
                        MyEr "No function definition founded", "Δεν βρέθηκε ορισμός συνάρτησης"
                        Exit Do
                    Else
                        sbf(bstack.IndexSub).sbgroup = s$
                    End If
                End If
                MyRead = True
            End If
        Else
            i = CopyArrayItemsNoFormated(bstack, s$)
            If i <> 0 Then
                If Not FastSymbol(rest$, ")") Then MyEr "Syntax error, use )", "Συντακτικό λάθος βάλε )": Exit Do
                If F And i > 0 Then '' look about f - work for refer but no refer can be done...why???
                    If Not ReboundArr(bstack, what$, i) Then GoTo arrconthere
                Else
arrconthere:
                what$ = myUcase(what$)
                If ohere$ = vbNullString Then
                    If varhash.ExistKey(what$) Then
                      If flag2 And Not F And Not flag Then
                        If i < 0 Then i = -i
                           varhash.ItemCreator what$, i
                           
                    Else
                        MyEr "Try other array name", "Δοκίμασε άλλο όνομα πίνακα"
                        Exit Do
                        End If
                    Else
                        varhash.ItemCreator what$, i
                    End If
                Else
                    If varhash.ExistKey(ohere$ & "." & what$) Then
                    If flag2 And Not F And Not flag Then
                        i = Abs(i)
                           varhash.ItemCreator ohere$ & "." & what$, i, True, True
                    Else
                        MyEr "Try other array name", "Δοκίμασε άλλο όνομα πίνακα"
                        Exit Do
                    End If
                    Else
                      i = Abs(i)
                    varhash.ItemCreator ohere$ & "." & what$, i, True, True
                    End If
                End If
            End If
            MyRead = True
        
        End If
    End If
End If
Case Else
    Exit Do
End Select
Else
' here not for LET any more
x1 = Abs(IsLabel(bstack, rest$, what$))
If x1 <> 0 Then
    what$ = myUcase(what$)
End If
Select Case x1
Case 1
    If bs.IsObjectRef(myobject) Then
        MyRead = True
        If flag2 Then
        GoTo comehere
        ElseIf flag Then
            p = 0#
           i = globalvar(what$, p)
           GoTo contread123
        End If
       If GetVar3(bstack, what$, i, , , flag, s$, checktype, isAglobal, True) Then
        If isAglobal And Not allowglobals Then GoTo comehere
        
contread123:
                If Typename$(myobject) = Typename(var(i)) Then
                    If Typename$(var(i)) = "Group" Then
                                ss$ = bstack.GroupName
                                If s$ <> "" Then what$ = s$
                                 If Len(var(i).GroupName) > Len(what$) Then
                                    If var(i).IamRef Then ' Or bstack.UseGroupname <> ""
                                
                                     s$ = here$
                                      here$ = vbNullString
                                    UnFloatGroupReWriteVars bstack, what$, i, myobject
                                    here = s$
                                    Else
                                    UnFloatGroupReWriteVars bstack, what$, i, myobject
                                    End If
                                Else
                                    bstack.GroupName = Left$(what$, Len(what$) - Len(var(i).GroupName) + 1)
                                    If Len(var(i).GroupName) > 0 Then
                                        what$ = Left$(var(i).GroupName, Len(var(i).GroupName) - 1)
                                        s$ = here$
                                        here$ = vbNullString
                                        UnFloatGroupReWriteVars bstack, what$, i, myobject
                                        here = s$
                                    ElseIf var(i).IamApointer And myobject.IamApointer Then
                                    Set var(i) = myobject
                                    
                                    Else
                                        Set myobject = Nothing
                                        bstack.GroupName = ss$
                                        GroupWrongUse
                                        MyRead = False
                                        Exit Function
                                    End If
                                End If
                                Set myobject = Nothing
                                bstack.GroupName = ss$
    
                   
                    ElseIf Typename$(var(i)) = "mHandler" Then
                        If var(i).ReadOnly Then
                            MyRead = False
                           ReadOnly
                           Exit Function
                        ElseIf var(i).t1 = myobject.t1 Or myobject.t1 = 3 Then
                           Set var(i) = myobject
                        Else
                          MyRead = False
                          MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                          Exit Function
                        End If
                    Else
                    Set var(i) = myobject
                    End If
                ElseIf x1 = 1 And CheckIsmArray(myobject) Then
               
                    ''bstack.lastobj.CopyArray pppp
                    Set var(i) = New mHandler
                    var(i).t1 = 3
                   Set var(i).objref = myobject
                    'Set pppp = Nothing
                    Set myobject = Nothing
                Else
                     MyRead = False
                    MyEr "Wrong object type", "Λάθος τύπος αντικειμένου"
                    Exit Function
                End If
        Else
comehere:
            i = globalvar(what$, 0)

            If Typename$(myobject) = "Group" Then
                 If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Fast2Varl(rest$, "ΔΕΙΚΤΗΣ", 7, "POINTER", 7, 7, F) Then
                    If Not myobject.IamApointer Then
                          WrongObject
                          MyRead = False
                          Exit Function
                    End If
                    GoTo contpointer
                    ElseIf Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then
                          WrongObject
                          MyRead = False
                          Exit Function
                    End If
                    If myobject.IamApointer Then
                    If myobject.link.IamFloatGroup Then
                    
                    UnFloatGroup bstack, bstack.GroupName & what$, i, myobject.link, here$ = vbNullString Or bstack.UseGroupname <> ""
                    Else
                    CopyPointerRef bstack, myobject
                    UnFloatGroup bstack, bstack.GroupName & what$, i, bstack.lastobj, here$ = vbNullString Or bstack.UseGroupname <> ""
                    End If
                Else
               UnFloatGroup bstack, bstack.GroupName & what$, i, myobject, here$ = vbNullString Or bstack.UseGroupname <> "", , True
               End If
                    
                    Else
contpointer:
                If myobject.IamApointer Then
               
                Set var(i) = myobject
                Else
               UnFloatGroup bstack, bstack.GroupName & what$, i, myobject, here$ = vbNullString Or bstack.UseGroupname <> "", , True
               End If
               End If
               ' var(i).IamRef = Len(bstack.UseGroupname) > 0
            ElseIf Typename$(myobject) = "mEvent" Then
                If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Not Fast2Varl(rest$, "ΓΕΓΟΝΟΣ", 7, "EVENT", 5, 5, F) Then
                        WrongObject
                        Exit Function
                    End If
                End If
                Set var(i) = myobject
            ElseIf Typename$(myobject) = "lambda" Then
                            If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Not Fast2Varl(rest$, "ΛΑΜΔΑ", 5, "LAMBDA", 6, 6, F) Then
                        WrongObject
                        Exit Function
                    End If
                End If
                Set var(i) = myobject
                If ohere$ = vbNullString Then
                    GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
                Else
                    GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
                End If
            ElseIf Typename$(myobject) = "mHandler" Then
            If MyIsObject(var(i)) Then
                    If TypeOf var(i) Is mHandler Then
                        If var(i).ReadOnly Then
                            ReadOnly
                            MyRead = False
                            Exit Function
                        End If
                    End If
                        End If
            If myobject.indirect > -1 Then
             If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If IsLabel(bstack, rest$, ss$) = 0 Then
                    MyEr "No type found", "δεν βρήκα τύπο"
                    MyRead = False
                    Exit Function
                    End If
               
                If LCase(Typename(var(myobject.indirect))) <> LCase(ss$) Then
                        WrongObject
                        MyRead = False
                        Exit Function
                End If
             End If
                Set var(i) = MakeitObjectGeneric(myobject.indirect)
                Else
                If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                If Not Fast2Varl(rest$, "ΔΕΙΚΤΗΣ", 7, "POINTER", 7, 7, F) Then
                If myobject.t1 = 1 Then
                    If Not Fast2Varl(rest$, "ΚΑΤΑΣΤΑΣΗ", 9, "INVENTORY", 9, 9, F) Then
                            WrongObject
                            MyRead = False
                            Exit Function
                    End If
                ElseIf myobject.t1 = 2 Then
                    If Not Fast2Varl(rest$, "ΔΙΑΡΘΡΩΣΗ", 9, "BUFFER", 6, 9, F) Then
                            WrongObject
                            MyRead = False
                            Exit Function
                    End If
                ElseIf myobject.t1 = 3 Then
                    If Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then
                            WrongObject
                            MyRead = False
                            Exit Function
                    End If
                ElseIf myobject.t1 = 4 Then
                    If Not FastType(rest$, myobject.objref.EnumName) Then
                    
                        p = myobject.index_cursor
                        Set myobject = Nothing
                        GoTo conthereEnum
                    End If
                End If
                End If
                End If
                Set var(i) = myobject
                End If
            ElseIf Typename$(myobject) = myArray Then
                   
                   If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then
                        WrongObject
                        Exit Function
                    End If
            End If
            Set var(i) = New mHandler
            var(i).t1 = 3
            Set var(i).objref = myobject
            Else
             If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Not Fast2Varl(rest$, "ΔΕΙΚΤΗΣ", 7, "POINTER", 7, 7, F) Then
                    ElseIf IsLabel(bstack, rest$, ss$) = 0 Then
                    MyEr "No type found", "δεν βρήκα τύπο"
                    MyRead = False
                    Exit Function
                    End If
                End If
                If LCase(Typename(myobject)) <> LCase(ss$) Then
                        WrongObject
                        Exit Function
                End If
                Set var(i) = myobject
            
            End If
            
            
            
            
            Set myobject = Nothing
        End If
    ElseIf bs.IsNumber(p) Then
    If Not MaybeIsSymbol(rest$, ",") Then
    ' F used again
        If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
conthereEnum:
        ihavetype = True
            If Fast2Varl(rest$, "ΑΡΙΘΜΟΣ", 7, "DECIMAL", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                    p = CDec(p)
            ElseIf Fast2Varl(rest$, "ΔΙΠΛΟΣ", 6, "DOUBLE", 6, 6, F) Then
                            If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CDbl(p)
            ElseIf Fast2Varl(rest$, "ΑΠΛΟΣ", 5, "SINGLE", 6, 6, F) Then
                        If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CSng(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΚΟΣ", 7, "BOOLEAN", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CBool(p)
            ElseIf Fast2Varl(rest$, "ΜΑΚΡΥΣ", 6, "LONG", 4, 6, F) Then
                    If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CLng(p)
            ElseIf Fast2Varl(rest$, "ΑΚΕΡΑΙΟΣ", 8, "INTEGER", 7, 8, F) Then
                    If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CInt(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΣΤΙΚΟ", 9, "CURRENCY", 8, 9, F) Then
                If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
                p = CCur(p)
            Else
            If Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΚΑΤΑΣΤΑΣΗ", 9, "INVENTORY", 9, 9, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΔΙΑΡΘΡΩΣΗ", 9, "BUFFER", 6, 9, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΛΑΜΔΑ", 5, "LAMBDA", 6, 6, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΓΕΓΟΝΟΣ", 7, "EVENT", 5, 5, F) Then
                    ElseIf IsLabel(bstack, rest$, (what$)) <> 0 Then
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            If myobject Is Nothing Then
            WrongType
            Else
            MyEr "Object is null", "Το αντικείμενο είναι άτιμο!"
                End If
                MyRead = False
                Exit Function
            End If
            ElseIf FastSymbol(rest$, "=") Then
            If Not IsNumberD2(rest$, (p)) Then missNumber: Exit Function
        End If
    End If
        MyRead = True
        If flag2 Then
            globalvar what$, p
        ElseIf GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
       If isAglobal And Not allowglobals Then
            globalvar what$, p
       ElseIf MyIsObject(var(i)) Then
                If TypeOf var(i) Is Group Then
                    If var(i).HasSet Then
                       
                        Set m = bstack.soros
                        Set bstack.Sorosref = New mStiva
                        bstack.soros.PushVal p
                        NeoCall2 ObjPtr(bstack), what$ + "." + ChrW(&H1FFF) + ":=()", ok
                        Set bstack.Sorosref = m
                        Set m = Nothing
                    Else
                        GoTo there18274
                    End If
                Else
there18274:
If TypeOf var(i) Is Constant Then
                CantAssignValue
Else
                    MyEr "Can't assign value to object", "Δεν μπορώ να δώσω τιμή σε αντικείμενο"
                    End If
                    Exit Function
                End If
      
        Else
            If checktype Then
            If ihavetype Then
                If VarType(var(i)) <> VarType(p) Then
                    MyEr "Cant' change type of variable", "Δεν μπορώ να αλλάξω τύπο μεταβλητής"
                ElseIf AssignTypeNumeric(p, VarType(var(i))) Then
                    var(i) = p
                Else
                MyEr "Cant' Assign number", "Δεν μπορώ να θέσω τιμή κατά το διάβασμα τιμών"
                End If
            
           
            ElseIf AssignTypeNumeric(p, VarType(var(i))) Then
                var(i) = p
            Else
            MyEr "Cant' Assign number", "Δεν μπορώ να θέσω τιμή κατά το διάβασμα τιμών"
            End If
            Else
                var(i) = p
            End If
        End If

        ElseIf i = -1 Then
                bstack.SetVar what$, p
        Else
                globalvar what$, p
        End If
    p = CDbl(0)
    ElseIf bs.IsOptional Then
        MyRead = True
        If Not MaybeIsSymbol(rest$, ",") Then
        If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
            ihavetype = True
            If Fast2Varl(rest$, "ΑΡΙΘΜΟΣ", 7, "DECIMAL", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                    p = CDec(p)
            ElseIf Fast2Varl(rest$, "ΔΙΠΛΟΣ", 6, "DOUBLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                    p = CDbl(p)
            ElseIf Fast2Varl(rest$, "ΑΠΛΟΣ", 5, "SINGLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                    p = CSng(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΚΟΣ", 7, "BOOLEAN", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                    p = CBool(p)
            ElseIf Fast2Varl(rest$, "ΜΑΚΡΥΣ", 6, "LONG", 4, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CLng(p)
            ElseIf Fast2Varl(rest$, "ΑΚΕΡΑΙΟΣ", 8, "INTEGER", 7, 8, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CInt(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΣΤΙΚΟ", 9, "CURRENCY", 8, 9, F) Then
                If FastSymbol(rest$, "=") Then
                    If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                    optlocal = Not useoptionals: useoptionals = True
                End If
                p = CCur(p)
            Else
            If Not flag2 And GetVar3(bstack, what$, i, , , flag, , , isAglobal, True) Then
                If isAglobal Then
                GoTo nofound
             Else
             
                    If TypeOf var(i) Is Group Then
                            If Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then MyRead = False: MissType: Exit Function
                        ElseIf TypeOf var(i) Is mHandler Then
                            If TypeOf var(i).objref Is mArray Then
                                If Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then MyRead = False: MissType: Exit Function
                            ElseIf TypeOf var(i).objref Is FastCollection Then
                                If Not Fast2Varl(rest$, "ΚΑΤΑΣΤΑΣΗ", 9, "INVENTORY", 9, 9, F) Then MyRead = False: MissType: Exit Function
                            ElseIf TypeOf var(i).objref Is MemBlock Then
                                If Not Fast2Varl(rest$, "ΔΙΑΡΘΡΩΣΗ", 9, "BUFFER", 6, 9, F) Then MyRead = False
                            Else
                                p = IsLabel(bstack, rest$, (what$)) ' just throw any name
                            End If
                        ElseIf TypeOf var(i) Is lambda Then
                            If Not Fast2Varl(rest$, "ΛΑΜΔΑ", 5, "LAMBDA", 6, 6, F) Then MyRead = False: MissType: Exit Function
                        
                        ElseIf TypeOf var(i) Is mEvent Then
                            If Not Fast2Varl(rest$, "ΓΕΓΟΝΟΣ", 7, "EVENT", 5, 5, F) Then MyRead = False: MissType: Exit Function
                        ElseIf TypeOf var(i) Is Constant Then
                            p = var(i)
                            GoTo checkconstant
                        Else
                            p = IsLabel(bstack, rest$, (what$)) ' just throw any name
                        End If
                    
            
             
             
             
             
             
             
             
                 GoTo loopcont123
             End If
            
            Else
             
                    If Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΠΙΝΑΚΑΣ", 7, "ARRAY", 5, 7, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΚΑΤΑΣΤΑΣΗ", 9, "INVENTORY", 9, 9, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΔΙΑΡΘΡΩΣΗ", 9, "BUFFER", 6, 9, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΛΑΜΔΑ", 5, "LAMBDA", 6, 6, F) Then
                    ElseIf Not Fast2Varl(rest$, "ΓΕΓΟΝΟΣ", 7, "EVENT", 5, 5, F) Then
                    ElseIf IsLabel(bstack, rest$, (what$)) <> 0 Then
            
nofound:
            
            
                MyEr "No type found", "δεν βρήκα τύπο"
                MyRead = False
                Exit Function
                End If
                MyEr "Object is null", "Το αντικείμενο είναι άτιμο!"
                
                MyRead = False
                Exit Function
                
            End If
            End If
        ElseIf FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
        Else
                        p = 0#
        End If


        If flag2 Then
        
            globalvar what$, p
        If Not useoptionals Then GoTo err100
         
        ElseIf GetVar3(bstack, what$, i, , , flag, , , isAglobal, True) Then
        If isAglobal Then
          If Not useoptionals Then GoTo err10
                globalvar what$, p
         ElseIf ihavetype Then
         If VarType(p) <> VarType(var(i)) Then
         
        If Not AssignTypeNumeric(var(i), VarType(p)) Then
            MyRead = False
            Exit Function
        End If
         
         End If
         End If
        ' just skip read for this value
        ElseIf i = -1 Then
        
                bstack.SetVar what$, p
         If Not useoptionals Then GoTo err100
        Else
       
            If VarType(p) = vbEmpty Then p = CDbl(0)
            
                globalvar what$, p
 If Not useoptionals Then GoTo err10
        End If
        p = CDbl(0)
    Else
        bstack.soros.drop 1
        MissStackNumber
        MyRead = False
        Exit Do
    End If
    
Case 3
    If bs.IsString(s$) Then
        If FastSymbol(rest$, "=") Then optlocal = Not useoptionals: useoptionals = True: If Not ISSTRINGA(rest$, (s$)) Then MyEr "Missing String literal", "Δεν βρήκα σταθερή αλφαριθμητική": Exit Function
contstrhere:
        MyRead = True
        If flag2 Then
            globalvar what$, s$
        ElseIf GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
        If isAglobal And Not allowglobals Then
            globalvar what$, s$
        ElseIf MyIsObject(var(i)) Then
                If TypeOf var(i) Is Group Then
                        
                        Set m = bstack.soros
                        Set bstack.Sorosref = New mStiva
                        bstack.soros.PushStr s$
                        NeoCall2 ObjPtr(bstack), Left$(what$, Len(what$) - 1) + "." + ChrW(&H1FFF) + ":=()", ok
                        Set bstack.Sorosref = m
                        Set m = Nothing
                ElseIf TypeOf var(i) Is Constant Then
                CantAssignValue
                MyRead = False
                Exit Function
                Else
                    CheckVar var(i), s$
                End If
            Else
                var(i) = s$
            End If
        ElseIf i = -1 Then
            bstack.SetVar what$, s$
        Else
            globalvar what$, s$
        End If
    ElseIf bs.IsOptional Then
    s$ = vbNullString
       If FastSymbol(rest$, "=") Then
        If Not ISSTRINGA(rest$, s$) Then MyEr "Missing String literal", "Δεν βρήκα σταθερή αλφαριθμητική": Exit Function
       optlocal = Not useoptionals: useoptionals = True
       End If
     
       MyRead = True
       
        If flag2 Then
            If Not useoptionals Then GoTo err100
            globalvar what$, s$
        ElseIf GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
            If isAglobal And Not allowglobals Then
               globalvar what$, s$
                End If
        ElseIf i = -1 Then
      
        Else
            If Not useoptionals Then GoTo err10
            globalvar what$, s$
        End If
    ElseIf bs.IsObjectRef(myobject) Then
        If Typename$(myobject) = "lambda" Then
            If flag2 Then
               i = globalvar(what$, s$)
            ElseIf GetVar3(bstack, what$, i, , , flag) Then
                CheckVar var(i), s$
            Else
                i = globalvar(what$, s$)
            End If
            Set var(i) = myobject
            If ohere$ = vbNullString Then
                GlobalSub what$ + "()", "CALL EXTERN " & Str(i)
            Else
                GlobalSub ohere$ & "." & bstack.GroupName & what$ + "()", "CALL EXTERN " & Str(i)
            End If
            MyRead = True
        ElseIf Typename$(myobject) = "Group" Then
        Set bstack.lastobj = myobject
         Set myobject = Nothing
         If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
                    If Not Fast2Varl(rest$, "ΟΜΑΔΑ", 5, "GROUP", 5, 5, F) Then SyntaxError: Exit Function
        
            If Not ProcGroup(100, bstack, what$, Lang) Then
                MyRead = False
                Set bstack.lastobj = Nothing
                Exit Function
            End If
                Set myobject = Nothing
                MyRead = True
           
        Else
                 If Not ProcGroup(100, bstack, what$, Lang) Then
                MyRead = False
                Set bstack.lastobj = Nothing
                Exit Function
            End If
                Set myobject = Nothing
                MyRead = True
        End If
         Else
                MyRead = False
            End If
    Else
         If FastSymbol(rest$, "=") Then
         optlocal = Not useoptionals: useoptionals = True: If Not ISSTRINGA(rest$, s$) Then MyEr "Missing String literal", "Δεν βρήκα σταθερή αλφαριθμητική": Exit Function
         GoTo contstrhere
         
         Else
    bstack.soros.drop 1
        MissStackStr
        MyRead = False
        Exit Do
        End If
    End If
Case 4
    If bs.IsNumber(p) Then
            If Not MaybeIsSymbol(rest$, ",") Then
        If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
            If Fast2Varl(rest$, "ΑΡΙΘΜΟΣ", 7, "DECIMAL", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If

                    p = CDec(p)
            ElseIf Fast2Varl(rest$, "ΔΙΠΛΟΣ", 6, "DOUBLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If

                p = CDbl(p)
            ElseIf Fast2Varl(rest$, "ΑΠΛΟΣ", 5, "SINGLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CSng(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΚΟΣ", 7, "BOOLEAN", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CBool(p)
            ElseIf Fast2Varl(rest$, "ΜΑΚΡΥΣ", 6, "LONG", 4, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CLng(p)
            ElseIf Fast2Varl(rest$, "ΑΚΕΡΑΙΟΣ", 8, "INTEGER", 7, 8, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CInt(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΣΤΙΚΟ", 9, "CURRENCY", 8, 9, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            ElseIf FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If

    End If
    
        MyRead = True
        If flag2 Then
            globalvar what$, MyRound(p)
        ElseIf GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
            If isAglobal And Not allowglobals Then
                globalvar what$, MyRound(p)
            Else
                var(i) = MyRound(p)
            End If
        ElseIf i = -1 Then
            bstack.SetVar what$, p
        Else
            globalvar what$, MyRound(p)
        End If
    ElseIf bs.IsOptional Then

        MyRead = True
        If Not MaybeIsSymbol(rest$, ",") Then
        If Fast2VarNoTrim(rest$, "ΩΣ", 2, "AS", 2, 2, F) Then
            If Fast2Varl(rest$, "ΑΡΙΘΜΟΣ", 7, "DECIMAL", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                    p = CDec(p)
            ElseIf Fast2Varl(rest$, "ΔΙΠΛΟΣ", 6, "DOUBLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CDbl(p)
            ElseIf Fast2Varl(rest$, "ΑΠΛΟΣ", 5, "SINGLE", 6, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CSng(p)
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΚΟΣ", 7, "BOOLEAN", 7, 7, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CBool(p)
            ElseIf Fast2Varl(rest$, "ΜΑΚΡΥΣ", 6, "LONG", 4, 6, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CLng(p)
            ElseIf Fast2Varl(rest$, "ΑΚΕΡΑΙΟΣ", 8, "INTEGER", 7, 8, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CInt(p)
                
            ElseIf Fast2Varl(rest$, "ΛΟΓΙΣΤΙΚΟ", 9, "CURRENCY", 8, 9, F) Then
                    If FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
        ElseIf FastSymbol(rest$, "=") Then
                        If Not IsNumberD2(rest$, p, True) Then missNumber: Exit Function
                        optlocal = Not useoptionals: useoptionals = True
                    End If
          Else
            p = 0#
        End If
        
            p = MyRound(p)
        If flag2 Then
         If Not useoptionals Then GoTo err100
            globalvar what$, p
        ElseIf GetVar3(bstack, what$, i, , , flag, , checktype, isAglobal, True) Then
            If isAglobal And Not allowglobals Then
               globalvar what$, p
                End If
        ElseIf i = -1 Then
            
        Else
        If Not useoptionals Then GoTo err100
        If VarType(p) = vbEmpty Then p = CDbl(0)
        
            globalvar what$, p
        End If
    Else
        bstack.soros.drop 1
        MissStackNumber
        MyRead = False
        Exit Do
    End If
Case 5, 7

    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2, allowglobals): If Not MyRead Then SyntaxError: Exit Do
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Do
        Else
            Exit Do
        End If
        If IsOperator(rest$, ".") Then
            If Not Typename(pppp.item(it)) = "Group" Then
                MyEr "Expected group", "Περίμενα ομάδα"
                MyRead = False: Exit Function
            Else
                 i = 1
                aheadstatus rest$, False, i
                ss$ = Left$(rest$, i - 1)
                MyRead = SpeedGroup(bstack, pppp, "@READ", ".", ss$, it) <> 0
                rest$ = Mid$(rest$, i)
                GoTo loopcont123
            End If
        End If
        If bs.IsObjectRef(myobject) Then
                If Typename$(myobject) = "Group" Then
                         If myobject.IamFloatGroup Then
                                    Set pppp.item(it) = myobject
                                    Set myobject = Nothing
                                    MyRead = True
                             Else
                             
                                          BadGroupHandle
                                          MyRead = False
                                          Set myobject = Nothing
                                          Exit Function
                             End If
                             
                             GoTo loopcont123
                   ElseIf Typename$(myobject) = "lambda" Then
                            Set pppp.item(it) = myobject
                            Set myobject = Nothing
                            MyRead = True
                            GoTo loopcont123

                    ElseIf Typename$(myobject) = myArray Then
                                  If myobject.Arr Then
                        Set pppp.item(it) = CopyArray(myobject)
                    Else
                        Set pppp.item(it) = myobject
                    End If
                    Set myobject = Nothing
                            MyRead = True
                            GoTo loopcont123
                    ElseIf Typename$(myobject) = "mHandler" Then
                    If myobject.indirect > -0 Then
                    Set pppp.item(it) = myobject
                    Else
                    p = myobject.t1
                    If CheckDeepAny(myobject) Then
                    If TypeOf myobject Is mHandler Then
                    Set pppp.item(it) = myobject
                    Else
                    Set pppp.item(it) = New mHandler
                    pppp.item(it).t1 = p
                    Set pppp.item(it).objref = myobject
                    End If
                    Set myobject = Nothing
                    End If
                    
                    End If
                    MyRead = True
                            GoTo loopcont123
                    ElseIf Typename$(myobject) = "PropReference" Then
                    Set pppp.item(it) = myobject
                            Set myobject = Nothing
                            MyRead = True
                            GoTo loopcont123
                    End If
        ElseIf bs.IsOptionalForArray(useoptionals) Then
        ' do nothing
        MyRead = True
        Else
            If Not bs.IsNumber(p) Then
            bstack.soros.drop 1
                MissStackNumber
                MyRead = False
                
                Exit Do
            ElseIf x1 = 7 Then
            pppp.item(it) = Round(p)
            Else
            
            pppp.item(it) = p
            
            End If
        
        
        End If

    MyRead = True
    End If
 Case 6
    MyRead = False
    If FastSymbol(rest$, ")") Then
        MyRead = globalArrByPointer(bs, bstack, what$, flag2): If Not MyRead Then SyntaxError: Exit Do
    Else
        If neoGetArray(bstack, what$, pppp) And Not flag2 Then
            If Not NeoGetArrayItem(pppp, bs, what$, it, rest$) Then Exit Do
        Else
            Exit Do
        End If
        If Not bs.IsString(s$) Then
            If bs.IsObjectRef(myobject) Then
                If Typename$(myobject) = "lambda" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing
                ElseIf Typename$(myobject) = "Group" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing

            ElseIf Typename$(myobject) = myArray Then
                    If myobject.Arr Then
                        Set pppp.item(it) = CopyArray(myobject)
                    Else
                        Set pppp.item(it) = myobject
                    End If
                    Set myobject = Nothing
                ElseIf Typename$(myobject) = "mHandler" Then
                    If myobject.indirect > -0 Then
                    Set pppp.item(it) = myobject
                    Else
                    p = myobject.t1
                    If CheckDeepAny(myobject) Then
                    If TypeOf myobject Is mHandler Then
                    Set pppp.item(it) = myobject
                    Else
                    Set pppp.item(it) = New mHandler
                    pppp.item(it).t1 = p
                    Set pppp.item(it).objref = myobject
                    End If
                    Set myobject = Nothing
                    End If
                    
                    End If
              ElseIf Typename$(myobject) = "PropReference" Then
                    Set pppp.item(it) = myobject
                    Set myobject = Nothing
                Else
                    MissStackStr
                    Exit Do
                End If
          ElseIf bs.IsOptionalForArray(useoptionals) Then
            MyRead = True
            Else
            bstack.soros.drop 1
                MissStackStr
                Exit Do
            End If

        Else
            If Not MyIsObject(pppp.item(it)) Then
                pppp.item(it) = s$
            ElseIf Typename(pppp.item(it)) = "Group" Then
            ' do something
            Else
                Set pppp.item(it) = New Document
                CheckVar pppp.item(it), s$
            End If
        End If
        MyRead = True
    End If

End Select
End If
loopcont123:
If MaybeIsSymbol(rest$, "@&!#~") Then SyntaxError: MyRead = False
If optlocal Then useoptionals = False

Loop Until Not FastSymbol(rest$, ",")
Exit Function
err10:
            MyEr "Variable " & what$ & " can't initialized", "Η μεταβλητή " & what$ & " δεν αρχικοποιθηκε"
            MyRead = False
err100:
            MyEr "Parameter is not optional", "Η παράμετρος είναι απαραίτητη"
            MyRead = False


End Function

Function MyPush(bstack As basetask, rest$) As Boolean
Dim s$, p As Variant
MyPush = True
Do
     If FastSymbol(rest$, "!") Then
                If IsExp(bstack, rest$, p) Then
                 If bstack.lastobj Is Nothing Then
                   bstack.soros.PushValLong CLng(p)
                ElseIf TypeOf bstack.lastobj Is mHandler Then
                    If TypeOf bstack.lastobj.objref Is mStiva Then
                        bstack.soros.MergeTop bstack.lastobj.objref
                    ElseIf TypeOf bstack.lastobj.objref Is mArray Then
                     bstack.soros.MergeTopCopyArray bstack.lastobj.objref
                        Else
                            MyPush = False
                            MyEr "Expected Stack Object or Array after !", "Περίμενα αντικείμενο Σωρό ή πίνακα μετά το !"
                            Set bstack.lastobj = Nothing
                            Exit Function
                  
                    End If
                    Set bstack.lastobj = Nothing
                End If
                End If
                ElseIf IsExp(bstack, rest$, p) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.PushVal p
                Else
                    If TypeOf bstack.lastobj Is mStiva Then
                    Set bstack.Sorosref = bstack.lastobj
                    ElseIf TypeOf bstack.lastobj Is VarItem Then
                        bstack.soros.PushObjVarItem bstack.lastobj
                    Else
                        bstack.soros.PushObj bstack.lastobj
                        Set bstack.lastpointer = Nothing
                    End If
                         Set bstack.lastobj = Nothing
                         
                End If
        ElseIf IsStrExp(bstack, rest$, s$) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.PushStr s$
                Else
                        bstack.soros.PushObj bstack.lastobj
                         Set bstack.lastobj = Nothing
                           Set bstack.lastpointer = Nothing
                End If
        Else
                Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
Loop
End Function
Function MyData(bstack As basetask, rest$) As Boolean
Dim s$, p As Variant ', vvl As Variant, photo As Object
MyData = True
Do
    If FastSymbol(rest$, "!") Then
                If IsExp(bstack, rest$, p) Then
                    If bstack.lastobj Is Nothing Then
                        bstack.soros.DataValLong p
                    ElseIf TypeOf bstack.lastobj Is mHandler Then
                        If TypeOf bstack.lastobj.objref Is mStiva Then
                            bstack.soros.MergeBottom bstack.lastobj.objref
                        ElseIf TypeOf bstack.lastobj.objref Is mArray Then
                            bstack.soros.MergeBottomCopyArray bstack.lastobj.objref
                        Else
                            MyData = False
                            MyEr "Expected Stack Object or Array after !", "Περίμενα αντικείμενο Σωρό ή πίνακα μετά το !"
                            Set bstack.lastobj = Nothing
                            Exit Function
                        End If
                            Set bstack.lastobj = Nothing
                        End If
                     End If
                ElseIf IsExp(bstack, rest$, p) Then
                  If bstack.lastobj Is Nothing Then
                      bstack.soros.DataVal p
                 Else
                   If TypeOf bstack.lastobj Is mStiva Then
                   Set bstack.Sorosref = bstack.lastobj
                   ElseIf TypeOf bstack.lastobj Is VarItem Then
                    bstack.soros.DataObjVaritem bstack.lastobj
                      Else
                      bstack.soros.DataObj bstack.lastobj
                    Set bstack.lastpointer = Nothing
                    End If
                      Set bstack.lastobj = Nothing
                End If
        ElseIf IsStrExp(bstack, rest$, s$) Then
                If bstack.lastobj Is Nothing Then
                        bstack.soros.DataStr s$
                Else
                        bstack.soros.DataObj bstack.lastobj
                        Set bstack.lastobj = Nothing
                          Set bstack.lastpointer = Nothing
                End If
        Else
                Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
        
Loop
End Function
Function MyClear(bstack As basetask, rest$) As Boolean
Dim curbstack As basetask, i As Long, y1 As Long, what$, it As Long, pppp As mArray, myobject As mStiva
'Dim bs As basetask
MyClear = True


Do
y1 = Abs(IsLabel(bstack, rest$, what$))


If y1 = 3 Then
      If GetVar(bstack, what$, i) Then
        If Typename(var(i)) = doc Then
        Set var(i) = New Document
        var(i).lcid = LCID_DEF
        var(i).textDoc = vbNullString
        Else
        var(i) = vbNullString
        End If
       Else
        globalvar what$, ""
        
       End If
ElseIf y1 < 5 And y1 > 0 Then
      If GetVar(bstack, what$, i) Then
        If MyIsObject(var(i)) Then
        ' PUT ZERO TO VARIABLES INSIDE GROUP
       If Typename(var(i)) = "lambda" Then
       Set var(i) = Nothing
       Dim ok As Boolean
       var(i) = CLng(0)
       ElseIf Typename(var(i)) = "Group" Then
       If m_bInIDE Then
        CallClear bstack, what$, var(i)
        Else
        CallClear bstack, what$, var(i), -1
        End If
        
        If var(i).IamApointer Then
        Set var(i) = New Group
        
        Else
       var(i).ResetGroup
       End If
    
       ElseIf Typename(var(i)) = "mHandler" Then
       If var(i).t1 = 1 Then
       If var(i).ReadOnly Then
            ReadOnly
            MyClear = False
            Exit Function
        End If
        If var(i).UseIterator Then
            ReadOnly
            MyClear = False
            Exit Function
        End If

            Set var(i) = Nothing
            MakeitObjectInventory var(i)
           
       ElseIf var(i).t1 = 2 Then
       
        Set var(i) = New mHandler

         var(i).t1 = 2
            Set var(i).objref = New MemBlock
       Else
       If var(i).UseIterator Then
       Set var(i) = Nothing
       var(i) = CLng(0)
       Else

       If Typename$(var(i).objref) = myArray Then
       With var(i)
        Set .objref = New mArray
       End With
       End If
       End If
       End If
       Else
       If Typename$(var(i)) = "PropReference" Then
       var(i) = Empty
       Else
         MissingGroup
         MyClear = False
         End If
       End If
        Else
        If VarType(var(i)) = vbLong Then
        var(i) = CLng(0)
        Else
            var(i) = CDbl(0)
            End If
        End If
        
       Else
        globalvar what$, it
       End If
ElseIf y1 = 5 Or y1 = 7 Then
  If neoGetArray(bstack, what$, pppp) Then
  If Not pppp.Arr Then NotArray: MyClear = False: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then MyClear = False: Exit Function
                        If Typename(pppp.item(it)) = "Group" Then
                            Dim mm As Variant
                            Set mm = pppp.item(it)
                            Set pppp.item(it) = Nothing
                            EmptyVariantArrayItem pppp, it
                            If m_bInIDE Then
                                CallClear bstack, what$, mm
                            Else
                                CallClear bstack, what$, mm, -1
                            End If

                         ElseIf Typename(pppp.item(it)) = "lambda" Then
                         Set pppp.item(it) = Nothing
                         EmptyVariantArrayItem pppp, it
                         Else
                         SyntaxError
                         MyClear = False
                         End If
                 
       Else
       SyntaxError
       MyClear = False
       End If
ElseIf y1 = 6 Then
        If neoGetArray(bstack, what$, pppp) Then
        If Not pppp.Arr Then NotArray: MyClear = False: Exit Function
                If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then MyClear = False: Exit Function
                         If Typename(pppp.item(it)) = doc Then
                             Set pppp.item(it) = New Document
                             pppp.item(it).textDoc = vbNullString
                         ElseIf Typename(pppp.item(it)) = "lambda" Then
                            Set pppp.item(it) = Nothing
                            EmptyVariantArrayItem pppp, it
                         Else
                         pppp.item(it) = vbNullString
                         End If
                 
       Else
       SyntaxError
       MyClear = False
       End If
ElseIf y1 > 0 Then
  SyntaxError
       MyClear = False
Else
Form1.List1.Clear
If bstack.IamThread Then
If Not bstack.StaticCollection Is Nothing Then
Set bstack.StaticCollection = Nothing
Else
 MyEr "Can't Clear all variables in a thread", "Δεν μπορώ να σβήσω όλες τις μεταβλητές σε ένα νήμα"
 End If
ElseIf bstack.IamAnEvent Then

 
If Not bstack.StaticCollection Is Nothing Then
    If Not bstack.Parent.StaticCollection Is Nothing Then
    If bstack.Parent.StaticCollection.ExistKey("%_" + here$) Then
            bstack.Parent.StaticCollection.RemoveWithNoFind
    End If
    End If
    Set bstack.StaticCollection = Nothing
  
    Else
 MyEr "Only static variables can clear in an event", "Μόνο στατικές μπορώ να σβήσω σε ένα γεγονός"
End If
Else
Set curbstack = bstack

again1234:

 If curbstack.IamChild Then
 If curbstack.IamThread Then Set curbstack = Nothing: Exit Function
 With curbstack
   Set .StaticCollection = Nothing
        If .Vars <> 0 Then Set curbstack = Nothing: Exit Function
      
   End With
If Not curbstack.Parent.IamChild And Not curbstack.Parent.IamAnEvent Then
Set EventStaticCollection = New FastCollection
End If
Set curbstack = curbstack.Parent
If here$ = vbNullString Then GoTo again1234
varhash.ReduceHash curbstack.Vars, var()
var2used = curbstack.Vars

Exit Function
End If
GarbageFlush
Set curbstack = Nothing
Set EventStaticCollection = New FastCollection
Set bstack.StaticCollection = Nothing
varhash.ReduceHash 0, var()
var2used = 0
ReDim var(3000) As Variant

Set curbstack = bstack
again12345:
 If curbstack.IamChild Then
            With curbstack
                 If .Vars = 0 Then Set curbstack = Nothing: Exit Function
                     .Vars = 0
   
            End With
            Set curbstack = curbstack.Parent
            GoTo again12345
End If
Set curbstack = Nothing
End If
Exit Do
End If
If Not MyClear Then Exit Do
Loop Until Not FastSymbol(rest$, ",")
End Function
Function MyDeclare(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, i As Long, s$, pa$
Dim x1 As Long, y1 As Long, par As Boolean, ss$, w$, what$, y3 As Boolean
Dim declobj As Object, ML As Long
Dim DUM As Boolean
Dim pppp As mArray
Dim ii As Long, ev As ComShinkEvent
MyDeclare = True
ML = -1
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", Lang)
y3 = IsLabelSymbolNew(rest$, "ΜΕΓΕΓΟΝΟΤΑ", "WITHEVENTS", Lang)
x1 = Abs(innerIsLabel(bstack, rest$, what$, , True, True))

w$ = myUcase$(what$)
gohere:
    If x1 = 1 Or x1 = 3 Then
        If x1 = 1 Then
            If GetVar(bstack, w$, i) Then
            If y3 Then
            If TypeOf var(i) Is GuiM2000 Then
                    MyEr "Can't define com events here", "Δεν μπορώ να χειριστώ γεγονότα COM εδώ"
                            MyDeclare = False
            Exit Function
            End If
               If GetShink(ev, i, w$) Then
                            If Not GetVar(bstack, ChrW(&HFFBF) + "_" + w$, ii) Then
                            
                            ii = globalvar(ChrW(&HFFBF) + "_" + w$, s$, , y1 = True)
                            End If
                            
                            
                            Set var(ii) = ev
                                        
                            Else
                            MyEr "Can't handle events here", "Δεν μπορώ να χειριστώ γεγονότα"
                            MyDeclare = False
                         End If
                        Exit Function
            End If
            ss$ = vbNullString

               If IsLabelSymbolNewExp(rest$, "ΤΙΠΟΤΑ", "NOTHING", Lang, ss$) Then
                   If ML >= 0 Then
goNothing:
              If neoGetArray(bstack, w$, pppp) Then
              For i = 0 To pppp.UpperMonoLimit
                If MyIsObject(pppp.item(i)) Then
                    If Typename$(pppp.item(i)) = "GuiM2000" Then
                    Set declobj = pppp.item(i)
                    Unload declobj
                    End If
                 Set pppp.item(i) = Nothing
                Else
                pppp.item(i) = Empty
                End If
              Next i
              Else
              MyDeclare = False
                Exit Function
              End If
                   
                   ElseIf Not MyIsObject(var(i)) Then
                        BadObjectDecl
                        MyDeclare = False
                   Else
                   If var(i) Is Nothing Then Exit Function
                      If TypeOf var(i) Is GuiM2000 Then
                      var(i).CloseNow
                      Unload var(i)
                      Else
                      If GetVar(bstack, ChrW(&HFFBF) + "_" + w$, ii) Then
                        Set var(ii) = Nothing
                      End If
                      End If
                       Set var(i) = Nothing
                   End If
                   Exit Function
               
               ElseIf IsLabelSymbolNewExp(rest$, "ΝΕΟ", "NEW", Lang, ss$) Then
               Set var(i) = Nothing
               GoTo THEREnew
               Else
                  BadObjectDecl
                    MyDeclare = False
                  Exit Function
               End If
                     
            End If
   
         End If
         ss$ = vbNullString
         
         If IsLabelSymbolNewExp(rest$, "ΑΠΟ", "LIB", Lang, ss$) Then
         
              par = Fast2Label(rest$, "C", 1, "", 0, 1)
              
            If IsStrExp(bstack, rest$, pa$) Then
                       ' we get the lib
                If Not IsStrExp(bstack, rest$, ss$) Then ss$ = vbNullString
                ' clear vbcr
                
                Do
                If FastSymbol(ss$, vbCrLf, , 2) Then
                s$ = vbNullString
                Else
                s$ = GetNextLine(ss$)
                If Not MaybeIsSymbol(s$, "'\") Then Exit Do
                End If
                Loop
                ss$ = s$ + CleanStr(ss$, vbCrLf)
                s$ = vbNullString
                SpaceForVar i
                Set declobj = New stdCallFunction
                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
                If Not IsExp(bstack, rest$, p) Then
                BadObjectDecl
                MyDeclare = False
                Set declobj = Nothing
                Exit Function
                Else
            declobj.RetType = CLng(p)
                End If
                End If
                declobj.CallThis pa$, ss$, Lang
                If par Then declobj.CallType = 1
            
                Set var(i) = declobj
                
                s$ = w$
                If x1 = 3 Then
                    If here$ = vbNullString Or y1 Then
                        GlobalSub s$ + "()", "CALL EXTERN " & Str(i) & " : = LETTER$"
                    Else
                        GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(i) & " : = LETTER$"
                    End If
                Else
                    If here$ = vbNullString Or y1 Then
                        GlobalSub s$ + "()", "CALL EXTERN " & Str(i) & " : = NUMBER"
                    Else
                        GlobalSub here$ & "." & bstack.GroupName & s$ + "()", "CALL EXTERN " & Str(i) & " : = NUMBER"
                    End If
                End If
               Set declobj = Nothing
                Exit Function
            Else
                BadObjectDecl
                 MyDeclare = False
                 Set declobj = Nothing
                Exit Function
            End If
        ElseIf IsLabelSymbolNewExp(rest$, "ΜΕ", "USE", Lang, ss$) Then
                If y3 <> 0 Then
                SyntaxError
                Exit Function
                End If


                    x1 = Abs(IsLabel(bstack, rest$, pa$))
                    IsSymbol3 rest$, ","
                    If x1 = 1 Then
                            If GetVar(bstack, pa$, x1) Then
                                    If MyIsObject(var(x1)) Then
                                                i = globalvar(w$, s$, , y1 = True)
                                                If IsStrExp(bstack, rest$, ss$) Then
                                                Set var(i) = MakeObjectFromString(var(x1), ss$)
                                         
                                                
                                                
                                                
                                                End If
                                    End If
                            End If
                    Else
                    MissPar
                    MyDeclare = False
                    End If
                    Exit Function
        End If
        If ML >= 0 Then
         If neoGetArray(bstack, w$, pppp, here$ <> "") Then
                MyDeclare = False
                Exit Function
         Else
         
         GlobalArr bstack, w$ + "(", LTrim(Str(ML)) + ")", i, y1
        If DeclareGUI(bstack, what$, rest$, MyDeclare, Lang, i, ML, w$, y1) Then
        Exit Function
        End If
        End If
        '' EXPAND OBJECTS HERE
        '' ElseIf IsLabelSymbolNewExp(rest$, "GREEK NAME", "ENGLISH NAME", lang, ss$) Then
        '' i = GlobalVar(w$, s$, , y1 = True)
        '' Set var(i) = New .....

        Else
        i = globalvar(w$, s$, , y1 = True)
        End If
THEREnew:
MyDeclare = False
        If IsStrExp(bstack, rest$, s$) Then
            If FastSymbol(rest$, ",") Then
                If IsStrExp(bstack, rest$, pa$) Then
                    
                If FastSymbol(rest$, ",") Then
                        If IsStrExp(bstack, rest$, w$) Then
                        Err.Clear
                        On Error Resume Next
                        If w$ = vbNullString Then
                            Licenses.Add s$
                        Else
                            Licenses.Add s$, w$
                        End If
                        If Err.Number > 0 And Err.Number <> 732 Then
                        MissLicence
                        Err.Clear
                        Else
                        Err.Clear
                        CreateitObject var(i), s$, CStr(pa$)
                        If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                        End If
                        Licenses.Remove s$
                        Else
                        MissStringExpr
                        End If
                        
                        
                Else
                      Err.Clear
                        On Error Resume Next
                CreateitObject var(i), s$, CStr(pa$)
                     If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                    End If
                    
                    
                Else
                 If FastSymbol(rest$, ",") Then
                 If IsStrExp(bstack, rest$, pa$) Then
                    Err.Clear
                        On Error Resume Next
                        If pa$ = vbNullString Then
                        Licenses.Add s$
                        Else
                 Licenses.Add s$, pa$
                 End If
                     If Err.Number > 0 And Err.Number <> 732 Then
                        MissLicence
                        Err.Clear
                        Else
                        Err.Clear
                 CreateitObject var(i), s$
                 If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        End If
                        End If
                 Licenses.Remove s$
                 Else
                    MissStringExpr
                 End If
                Else
                    MissStringExpr
                    End If
                End If
                
                
                
                
                
            Else
               Err.Clear
                        On Error Resume Next
                CreateitObject var(i), s$
                
                 If Err.Number > 0 Then
                        Err.Clear
                        MissLicence
                        ElseIf y3 <> 0 Then
                        
                         
                         If GetShink(ev, i, w$) Then
                         ' private
                         ' no need for a name, we do not address it in any way.
                         ' ev knows how to call handler
                            If Not GetVar(bstack, ChrW(&HFFBF) + "_" + w$, ii) Then
                            
                            ii = globalvar(ChrW(&HFFBF) + "_" + w$, s$, , y1 = True)
                            End If
                            
                            
                            Set var(ii) = ev

                         Else
                         MyEr "Can't handle events here", "Δεν μπορώ να χειριστώ γεγονότα"
                            MyDeclare = False
            
                         End If
                         
                        End If
            End If
            
        ElseIf y3 Then
        SyntaxError
        Exit Function
        ElseIf DeclareGUI(bstack, what$, rest$, MyDeclare, Lang, i) Then
         
         
        End If
           Err.Clear
                        On Error Resume Next
            
        If Not MyIsObject(var(i)) Then
        BadObjectDecl
        End If
       
    ElseIf x1 = 5 Then
If FastSymbol(rest$, ")") Then
 'w$ = Left$(w$, Len(w$) - 1)
'w$ = w$ + ")"
 If IsLabelSymbolNewExp(rest$, "ΤΙΠΟΤΑ", "NOTHING", Lang, ss$) Then GoTo goNothing
 If IsLabelSymbolNewExp(rest$, "ΠΑΝΩ", "OVER", Lang, ss$) Then
    ExpandGui bstack, what$, rest$, MyDeclare, Lang, w$
    '' not yet
'' ElseIf IsLabelSymbolNewExp(rest$, "ΥΠΟ", "UNDER", lang, ss$) Then
  ''  ReduceGui bstack, what$, rest$, ifier, lang, w$
Else

 
 BadObjectDecl
 End If
ElseIf IsExp(bstack, rest$, p) Then
ML = CLng(p)
If FastSymbol(rest$, ")") Then
x1 = 1
 w$ = Left$(w$, Len(w$) - 1)
   GoTo gohere
Else
BadObjectDecl
End If
Else
BadObjectDecl
End If
    Else
    
    BadObjectDecl
    
    End If
     MyDeclare = True
     Set declobj = Nothing
    

End Function
Function MyWith(bstack As basetask, rest$, Lang As Long) As Boolean
Dim i As Long, ss$, s$, pppp As mArray, pa$, x1 As Long, Id
MyWith = True
x1 = Abs(IsLabel(bstack, rest$, s$))
If x1 = 1 Or x1 = 3 Then
    If GetVar(bstack, s$, i) Then
            If Not MyIsObject(var(i)) Then BadObjectDecl:  Exit Function
            If Not var(i) Is Nothing Then  ''???
                   Do While FastSymbol(rest$, ",")
                    If IsStrExp(bstack, rest$, ss$) Then
                    On Error Resume Next

                      ProcProperty bstack, var(), i, ss$, rest$, Lang
                      If Err.Number > 0 Then
                      MyEr "Property " + ss$ + " problem", "Πρόβλημα με ιδιότητα " + ss$
                      Err.Clear
                      MyWith = False
                    Exit Do
                      End If
                      MyWith = Err = 0
                      Err.Clear
                    ElseIf IsExp(bstack, rest$, Id) Then
                    If Not ss$ = vbNullString Then ss$ = vbNullString
                    ProcProperty bstack, var(), i, ss$, rest$, Lang, , CLng(Id)
                    Else
                    MissStringNumber
                    MyWith = False
                    Exit Do
                    End If
                    Loop
                    Exit Function
            Else
                    BadObjectDecl
                    Exit Function
            End If
    Else
    
     Nosuchvariable s$
    End If
ElseIf x1 = 5 Or x1 = 6 Then
  If neoGetArray(bstack, s$, pppp) Then
    If NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then
      Do While FastSymbol(rest$, ",")
                    If IsStrExp(bstack, rest$, ss$) Then
                    If TypeOf pppp.item(i) Is GuiM2000 Then
                      If UCase(ss$) = "VISIBLE" Then ss$ = "TrueVisible"
                      End If
                  ProcPropertyArray bstack, pppp, i, ss$, rest$, Lang, MyWith
                  If LastErNum1 = -1 Then
                  Exit Do
                  End If
                  If Err.Number > 0 Then
                      MyEr "Property " + ss$ + " problem", "Πρόβλημα με ιδιότητα " + ss$
                      Err.Clear
                      MyWith = False
                    Exit Do
                      End If
                      MyWith = Err = 0
                      Err.Clear
                   ElseIf IsExp(bstack, rest$, Id) Then
                    If Not ss$ = vbNullString Then ss$ = vbNullString
                     ProcPropertyArray bstack, pppp, i, ss$, rest$, Lang, MyWith
                    
                    Else
                    MissStringNumber
                    MyWith = False
                    Exit Do
                    End If
                    Loop
                    Exit Function
           
            
     End If
  Else
      MissingObj
  End If
Else
MissingObj
End If
End Function
Function MyMethod(bstack As basetask, rest$, Lang As Long) As Boolean

Dim i As Long, s$, pppp As mArray, pa$, ok As Boolean, r As Variant
i = Abs(IsLabel(bstack, rest$, s$))
MyMethod = True
ok = True
If i = 1 Or i = 3 Then
 If GetVar(bstack, s$, i) Then
        If MyIsObject(var(i)) Then
            If var(i) Is Nothing Then
                MissingObj
            Else
                IsSymbol3 rest$, ","
                If IsStrExp(bstack, rest$, pa$) Then
           ''     IsSymbol3 rest$, ","
              ProcMethod bstack, var(), i, pa$, rest$, Lang, ok
          MyMethod = (Err = 0) And ok
          Err.Clear
          
                End If
            End If
        Else
            MissingObjRef
        End If
        Exit Function
        Else
  Nosuchvariable s$
 End If
 ElseIf i = 5 Or i = 6 Then
  If neoGetArray(bstack, s$, pppp) Then
again11:
    If NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then
    If FastSymbol(rest$, "(") Then
    If MyIsObject(pppp.item(i)) Then
    Dim pppp1 As mArray
    If TypeOf pppp.item(i) Is mArray Then
        Set pppp = pppp.item(i)
    Else
        pppp1.Arr = False
        Set pppp1.GroupRef = pppp.item(i)
        Set pppp = pppp1
        Set pppp1 = Nothing
    End If
    GoTo again11
    End If
    End If
             IsSymbol3 rest$, ","
            If IsStrExp(bstack, rest$, pa$) Then
                ProcMethodArray bstack, pppp, i, pa$, rest$, Lang, MyMethod
              End If
     End If
  Else
      MissingObj
  End If

End If

End Function
Function GetEventFromArray(basestack As basetask, rest$, what$) As Boolean
Dim pppp As mArray, x1 As Long
 If neoGetArray(basestack, what$, pppp) Then
  If Not NeoGetArrayItem(pppp, basestack, what$, x1, rest$, True) Then Exit Function
    If MyIsObject(pppp.item(x1)) Then
    GetEventFromArray = True
    Set basestack.lastobj = pppp.item(x1)
    Exit Function
    Else
    MyEr "Not an Event object", "Όχι ένα αντικείμενο Γεγονός"
 Exit Function
    End If
 End If
End Function
Function myEvent(basestack As basetask, rest$, Lang As Long)
Dim x1 As Long, what$, i As Long, s$
myEvent = True
 x1 = Abs(IsLabel(basestack, rest$, what$))
 If x1 <> 1 Then
 If x1 = 5 Then
 Dim pppp As mArray
 If neoGetArray(basestack, what$, pppp) Then
  If Not NeoGetArrayItem(pppp, basestack, what$, x1, rest$, True) Then Exit Function
    If MyIsObject(pppp.item(x1)) Then
    Set basestack.lastobj = pppp.item(x1)
    myEvent = ProcEvent(basestack, rest$, Lang, -1)
    Exit Function
    Else
    MyEr "Not an Event object", "Όχι ένα αντικείμενο Γεγονός"
    myEvent = False: Exit Function
    End If
 End If
 Else
    myEvent = False: Exit Function
 End If
 End If
 If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
 If GetlocalVar(basestack.GroupName & what$, i) Then
 ' we found it
  ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
  ' we found it
  Else
   i = globalvar(basestack.GroupName & what$, s$)
   MakeitObjectEvent var(i)
 End If
 myEvent = ProcEvent(basestack, rest$, Lang, i)
End Function
Function MyReport(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, prive As Long, x As Double, y As Double, y1 As Long, x1 As Long, it As Long
Dim s$, i As Long, pa$, sX As Double
MyReport = False
prive = GetCode(bstack.Owner)

If IsExp(bstack, rest$, p) Then
If Not FastSymbol(rest$, ",") Then MissPar:: Exit Function
Else
p = 0
End If
If IsStrExp(bstack, rest$, s$) Then
 x = bstack.Owner.Width
If FastSymbol(rest$, ",") Then
If Not IsExp(bstack, rest$, x) Then: Exit Function
With players(prive)
If x <= .mx Then
x = x * .Xt - 2 * dv15
bstack.Owner.CurrentX = bstack.Owner.CurrentX + dv15
End If
End With
End If

If FastSymbol(rest$, ",") Then
If Not IsExp(bstack, rest$, y) Then: Exit Function
y1 = y - 1
If IsLabelSymbolNew(rest$, "ΓΡΑΜΜΗ", "LINE", Lang) Then
        If Not IsExp(bstack, rest$, sX) Then: Exit Function
        x1 = sX - 1
If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
          wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), x1, , , True
  rest$ = "@READ " + rest$
  If Not executeblock(i, bstack, rest$, True, False) Then
' error ??
  End If
  Else
        wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), x1
      End If
Else
If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
  wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), , it, , True
  rest$ = "@READ " + rest$
  If Not executeblock(i, bstack, rest$, True, False) Then
 ' error ?
  End If
  
Else
  wwPlain bstack, players(prive), s$, CLng(x), y1, , , CLng(p), , it
  End If
 End If
players(prive).LastReportLines = CDbl(it)
  
Else

 wwPlain bstack, players(prive), s$, CLng(x), 100000, True, , CLng(p), , it
   players(prive).LastReportLines = -1
End If

MyReport = True
Else
If LastErNum <> 0 Then LastErNum = 0:: Exit Function      'ifier=true

End If

End Function
Function MyInput(bstack As basetask, rest$, Lang As Long) As Boolean
Dim i As Long, p As Variant, PP As Variant, s$, ss$, what$, F As Long, x1 As Long, y As Double, x As Double
Dim frm$, par As Boolean, pppp As mArray, prive As Long, it As Long, w$, mystack As mStiva
If IsLabelSymbolNew(rest$, "ΜΕ", "WITH", Lang) Then
    If IsStrExp(bstack, rest$, s$) Then
        inpcsvsep$ = Left$(s$, 1)
        If FastSymbol(rest$, ",") Then If IsStrExp(bstack, rest$, s$) Then inpcsvDec$ = Left$(s$, 1): MyInput = True
        inpcsvuseescape = False
        If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then inpcsvuseescape = CBool(p): MyInput = True
         If FastSymbol(rest$, ",") Then MyInput = False: If IsExp(bstack, rest$, p) Then inpcleanstrings = CBool(p): MyInput = True
    End If
    Exit Function
End If
FKey = 0
If inpcsvsep$ = vbNullString Then inpcsvsep$ = ","
If inpcsvDec$ = vbNullString Then inpcsvDec$ = "."

MyInput = True
With players(GetCode(bstack.Owner))
If IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", Lang) Then

If Not NOEDIT Then

NOEDIT = True
Else
If QRY Then QRY = False  ''INK$ = Chr$(13) '
End If
Exit Function
End If
prive = GetCode(bstack.Owner)
If Not releasemouse Then If Not Form1.Visible Then newshow basestack1
MyInput = False '*************
rest$ = NLtrim$(rest$)

If FastSymbol(rest$, "!") Then
        x1 = 0
        frm$ = vbNullString
        If bstack.toprinter = True Then oxiforPrinter:   Exit Function
        If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
        F = Abs(IsLabel(bstack, rest$, what$))
        Select Case F
        Case 1, 4
                     If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                     If Not IsExp(bstack, rest$, p) Then p = .mx
                     x = p
                     
                             y = 0
                    If FastSymbol(rest$, ",") Then
                     If Not IsExp(bstack, rest$, p) Then x1 = 29
                     x1 = p
                     If x1 < 1 Or x1 > 29 Then x1 = 29
                     Else
                     x1 = 29
                    End If
                    
                     Form1.ShadowMarks = True
                    
                    If y < 1 And x1 = 0 Then y = 1
                     If GetVar(bstack, what$, i) Then
                     
                     s$ = LTrim(Str(var(i)))
                     If VarType(var(i)) = vbLong Or VarType(var(i)) = vbInteger Then F = 4
                     If VarType(var(i)) = vbBoolean Then F = 4: x1 = 1: s$ = LTrim(Str(Abs(CLng(var(i)))))
                       If Not NoUseDec Then
                                If OverideDec Then
                                    s$ = Replace(s$, ".", NowDec$)
                                 End If
                            Else
                                s$ = Replace(s$, ".", QueryDecString)
                            End If
       
                     p = var(i)
                     Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, F = 4)
                     Loop Until ValidNum(s$, True, F = 4, VarType(p))
                            If Not NoUseDec Then
                                If OverideDec Then
                                   s$ = Replace(s$, NowDec$, ".")
                                 End If
                            Else
                                s$ = Replace(s$, QueryDecString, ".")
                            End If
                            
                               ValidNumberOnly s$, p, F = 4
                             Select Case VarType(var(i))
                             Case vbInteger
                             var(i) = CInt(p)
                             Case vbLong
                             var(i) = CLng(p)
                             Case vbSingle
                             var(i) = CSng(p)
                             Case vbCurrency
                             var(i) = CCur(p)
                             Case vbDouble
                             var(i) = CDbl(p)
                             Case vbDecimal
                             var(i) = CDec(p)
                             Case vbBoolean
                             var(i) = CBool(p)
                             Case Else
                             var(i) = p
                             End Select
                               
                               
                             
                             
                     Else
                     If i = -1 Then
                     If F = 4 Then
                      s$ = LTrim(Str(ReadVarInt(bstack, what$)))
                     Else
                     
                      s$ = LTrim(Str(ReadVarDouble(bstack, what$)))
                      End If
                      p = ReadVarDouble(bstack, what$)
                      If VarType(p) = vbLong Or VarType(p) = vbInteger Then F = 4
                                       If Not NoUseDec Then
                                If OverideDec Then
                                    s$ = Replace(s$, ".", NowDec$)
                                 End If
                            Else
                                s$ = Replace(s$, ".", QueryDecString)
                            End If
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, F = 4)
                     Loop Until ValidNum(s$, True, F = 4)
                           If Not NoUseDec Then
                                If OverideDec Then
                                   s$ = Replace(s$, NowDec$, ".")
                                 End If
                            Else
                                s$ = Replace(s$, QueryDecString, ".")
                            End If
                            If VarType(p) = vbLong Or VarType(p) = vbInteger Then
                            ValidNumberOnly s$, p, F = 4
                            On Error Resume Next
                            p = CLng(p)
                            If Err.Number = 6 Then
                                    OverflowLong
                                    MyInput = False
                               End If
                            Else
                              ValidNumberOnly s$, p, F = 4
                              End If
                             bstack.SetVar what$, p
                             
                     Else
                     s$ = vbNullString
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, F = 4)
                     Loop Until ValidNum(s$, True, F = 4)
                           If Not NoUseDec Then
                                If OverideDec Then
                                   s$ = Replace(s$, NowDec$, ".")
                                 End If
                            Else
                                s$ = Replace(s$, QueryDecString, ".")
                            End If
                              ValidNumberOnly s$, p, F = 4
                             globalvar what$, (p)
                     End If
                     End If
                     MyInput = True
                     Form1.ShadowMarks = False
        Case 3
                     If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                     If Not IsExp(bstack, rest$, p) Then p = .mx
                     x = p
                     If Not FastSymbol(rest$, ",") Then
                             y = 0
                             x1 = 50
                             If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", Lang, , , , False) Then
                                     If FastSymbol(rest$, "=") Then
                                             If IsExp(bstack, rest$, p) Then
                                                     x1 = Abs(MyRound(p))
                                             Else
                                                     MissNumExpr
                                                     Exit Function
                                             End If
                                     Else
                                             MissSymbolMyEr "="
                                             Exit Function
                                     End If
                             End If
                     ElseIf Not IsExp(bstack, rest$, y) Then
                             MissPar
                             Exit Function
                     Else
                             If FastSymbol(rest$, ",") Then
                                     If Not IsStrExp(bstack, rest$, frm$) Then MissPar: Exit Function
                            Else
                            If Len(var(i)) > 0 Then x1 = -Len(var(i))
                        
                             End If
                           
                     End If
                     Form1.ShadowMarks = True
                     ''rest$ = nltrim$(rest$)
If y < 1 And x1 = 0 Then y = 1
                     If GetVar(bstack, what$, i) Then
                             var(i) = iText(bstack, var(i), (x), (y), frm$, x1)
                     Else
                     If i = -1 Then

                     bstack.SetVar what$, iText(bstack, ReadVarStr(bstack, what$), (x), (y), frm$, x1)
                     Else
                             globalvar what$, iText(bstack, "", (x), (y), frm$, x1)
                     End If
                     End If
                     MyInput = True
                     Form1.ShadowMarks = False
        Case 5, 7 ' NUMBER IN ARRAY
                            If neoGetArray(bstack, what$, pppp) Then
                            If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                    Else
                        MyEr "No such Array", "Δεν υπάρχει τέτοιος πίνακας"
                            Exit Function
                    End If
                    If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                    If Not IsExp(bstack, rest$, p) Then p = .mx
                    x = p
                     y = 0
                     
                    If FastSymbol(rest$, ",") Then
                     If Not IsExp(bstack, rest$, p) Then x1 = 29
                     x1 = p
                     If x1 < 1 Or x1 > 29 Then x1 = 29
                     Else
                     x1 = 29
                    End If
                Form1.ShadowMarks = True
                If y < 1 And x1 = 0 Then y = 1

            
            
       s$ = LTrim(Str(pppp.itemnumeric(it)))
       p = pppp.itemnumeric(it)
       If VarType(p) = vbLong Or VarType(p) = vbInteger Then F = 7
       If VarType(var(i)) = vbBoolean Then F = 7: x1 = 1: s$ = LTrim(Str(Abs(CLng(pppp.itemnumeric(it)))))
                      Do
                     s$ = iText(bstack, s$, (x), (y), "", x1, True, F = 7)
                     Loop Until ValidNum(s$, True, F = 7, VarType(p))
                    
                           If Not NoUseDec Then
                                If OverideDec Then
                                   s$ = Replace(s$, NowDec$, ".")
                                 End If
                            Else
                                s$ = Replace(s$, QueryDecString, ".")
                            End If
                    
                              
           
                            
                            ValidNumberOnly s$, p, F = 7
                             Select Case VarType(pppp.item(it))
                             Case vbInteger
                              pppp.item(it) = CInt(p)
                             Case vbLong
                              pppp.item(it) = CLng(p)
                             Case vbSingle
                              pppp.item(it) = CSng(p)
                             Case vbCurrency
                              pppp.item(it) = CCur(p)
                             Case vbDouble
                              pppp.item(it) = CDbl(p)
                             Case vbDecimal
                              pppp.item(it) = CDec(p)
                             Case vbBoolean
                             pppp.item(it) = CBool(p)
                             Case Else
                             pppp.item(it) = p
                             End Select
               
           
        Form1.ShadowMarks = False
                MyInput = True
        Case 6
                    If neoGetArray(bstack, what$, pppp) Then
                            If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then
                            Exit Function
                            End If
                
                Else
                            MyEr "No such Array", "Δεν υπάρχει τέτοιος πίνακας"
                            Exit Function
                    End If
                    If Not FastSymbol(rest$, ",") Then MissPar: Exit Function
                    If Not IsExp(bstack, rest$, p) Then p = .mx
                    x = p
                    If Not FastSymbol(rest$, ",") Then
                        y = 0
                        x1 = 50
                        If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", Lang, , , , False) Then
                                If FastSymbol(rest$, "=") Then
                                        If IsExp(bstack, rest$, p) Then
                                            x1 = Abs(MyRound(p))
                                        Else
                                            MissNumExpr
                                            Exit Function
                                        End If
                                Else
                                        MissSymbolMyEr "="
                                        Exit Function
                                End If
                        ElseIf Not IsExp(bstack, rest$, y) Then
                                MissPar
                                Exit Function
                        Else
                                If FastSymbol(rest$, ",") Then
                                        If Not IsStrExp(bstack, rest$, frm$) Then MissPar: Exit Function
                                        Else
                            If Len(CStr(pppp.item(it))) > 0 Then x1 = -Len(CStr(pppp.item(it)))
                        
                                End If
                        End If
                End If
                Form1.ShadowMarks = True
                If y < 1 And x1 = 0 Then y = 1
                s$ = iText(bstack, LTrim(Str(pppp.item(it))), (x), (y), frm$, x1)
                Form1.ShadowMarks = False
                If Typename(pppp.item(it)) = doc Then
                        Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                Else
                        pppp.item(it) = s$
                End If
                MyInput = True
        End Select
        Exit Function
                    '********************************************
ElseIf FastSymbol(rest$, "#") Then
            If Not IsExp(bstack, rest$, p) Then MissPar:   Exit Function
            If Not FastSymbol(rest$, ",") Then MissPar:  Exit Function
            F = CLng(MyMod(p, 512))
              If FKIND(F) = FnoUse Or FKIND(F) = Foutput Or FKIND(F) = Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": MyInput = False: Exit Function
            par = True
Else
If bstack.toprinter = True Then oxiforPrinter:   Exit Function
 If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
            If ISSTRINGA(rest$, frm$) Then
            
            If Not Fast2Symbol(rest$, ",", 1, ";", 1) Then MissPar: Exit Function
            Else
            frm$ = "?"
            End If
            par = False
End If
w$ = vbNullString
FKey = -1
If bstack.toprinter = True And Not par Then
            oxiforPrinter
            FKey = 0
            Exit Function
End If
 If (Typename(bstack.Owner) Like "Gui*") And Not par Then oxiforforms: FKey = 0: Exit Function
MyInput = False
Do
        
        Select Case Abs(IsLabel(bstack, rest$, what$))
        Case 1
                If FastSymbol(rest$, "=") Then IsNumberCheck rest$, p Else p = CDbl(0)
                If p <> 0 Then p = p - p
                If par Then
                        If uni(F) Then
                                getUniRealComma F, s$
                        Else
                                getAnsiRealComma F, s$
                        End If
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), "+*/!@#$|\{}[]'~`%^&()=_:;", True)
                        
                        ' If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False:  FKey = 0: Exit Function
                         If Trim(s$) = "" Then ErrNum: MyInput = False:    FKey = 0: Exit Function
                       
                End If
             
                If GetVar(bstack, what$, i) Then
                        If MyIsObject(var(i)) Then
                        If Typename(var(i)) = "Group" Then
                                If var(i).HasSet Then
                                Set mystack = bstack.soros
                                'If bstack.lastobj Is Nothing Then
                                Select Case Typename(p)
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If par Then
                                If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                                Else
                                If Not IsNumberCheck(s$, PP) Then PP = p
                                End If
                                bstack.soros.PushVal PP
                                'Else
                                 '   bstack.soros.PushObj bstack.lastobj
                                    Set bstack.lastobj = Nothing
                                'End If
                                NeoCall2 ObjPtr(bstack), what$ + "." + ChrW(&H1FFF) + ":=()", MyInput
                                Set bstack.Sorosref = mystack
                                Set mystack = Nothing
                            Else
                                BadGroupHandle
                                MyInput = False
                                FKey = 0: Exit Function
                                End If
                        ElseIf Typename(var(i)) = "Constant" Then
                                CantAssignValue
                        End If
                        Else
                            Select Case Typename(var(i))
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If par Then
                                    If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                                Else
                                    If Not IsNumberCheck(s$, PP) Then PP = p
                                End If
                        var(i) = PP
                        End If
                Else
                
                    
                    If i = -1 Then
                    bstack.ReadVar what$, PP
                                Select Case Typename(PP)
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If IsNumberCheck(s$, p) Then bstack.SetVar what$, PP
                    Else
                        Select Case Typename(p)
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If par Then
                                    If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                                Else
                                    If Not IsNumberCheck(s$, PP) Then PP = p
                                End If
                        globalvar what$, PP
                    End If
                End If
                 MyInput = True
        Case 3
               
                If par Then
                        If uni(F) Then
                                getUniStringComma F, s$, inpcleanstrings
                        Else
                                getAnsiStringComma F, s$, inpcleanstrings
                        End If
                      If inpcsvuseescape Then s$ = EscapeStrToString(s$)
                Else
                 prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        QUERY bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), IIf(MaybeIsSymbol(rest$, ","), ",", Chr$(0)) + Chr$(34) + "{}"
                End If
                If GetVar(bstack, what$, i) Then
                 If MyIsObject(var(i)) Then
                        If Typename(var(i)) = "Group" Then
                                If var(i).HasSet Then
                                Set mystack = bstack.soros
                                If bstack.lastobj Is Nothing Then
                                    bstack.soros.PushStr s$
                                Else
                                    bstack.soros.PushObj bstack.lastobj
                                    Set bstack.lastobj = Nothing
                                End If
                                NeoCall2 ObjPtr(bstack), Left$(what$, Len(what$) - 1) + "." + ChrW(&H1FFF) + ":=()", MyInput
                                Set bstack.Sorosref = mystack
                                Set mystack = Nothing
                                
                            Else
                                BadGroupHandle
                                MyInput = False
                                FKey = 0: Exit Function
                                End If
                        ElseIf Typename(var(i)) = "Constant" Then
                                CantAssignValue
                        End If
                        Else
                
                        CheckVar var(i), s$
                        End If
                Else
                    If i = -1 Then
                        bstack.SetVar what$, s$
                    Else
                        globalvar what$, s$
                    End If
                End If
                 MyInput = True
    Case 4
               If FastSymbol(rest$, "=") Then IsNumberCheck rest$, p Else p = CDbl(0)
               If p <> 0 Then p = p - p
                If par Then
                        If uni(F) Then
                                getUniRealComma F, s$
                        Else
                                getAnsiRealComma F, s$
                        End If
                Else
                                prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), "+*/!.@#$|\{}[]'~`%^&()=_:;", True)
                      '' If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False: FKey = 0: Exit Function
                       ''If Trim(s$) <> "," And Trim(s$) <> "" Then ErrNum: MyInput = False:  FKey = 0: Exit Function
                     If Trim(s$) = "" Then ErrNum: MyInput = False:    FKey = 0: Exit Function
                End If
                If GetVar(bstack, what$, i) Then
                     Select Case Typename(var(i))
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If par Then
                                    If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                                Else
                                    If Not IsNumberCheck(s$, PP) Then PP = p
                                End If
                        var(i) = MyRound(PP)
                Else
                        If i = -1 Then
                        bstack.ReadVar what$, PP
                        Select Case Typename(PP)
                        Case "Long"
                            s$ = s$ + "&"
                        Case "Currency"
                            s$ = s$ + "#"
                        Case "Decimal"
                            s$ = s$ + "@"
                        Case "Single"
                            s$ = s$ + "~"
                        Case "Integer"
                            s$ = s$ + "%"
                        End Select
                        If IsNumberCheck(s$, p) Then bstack.SetVar what$, PP
                        bstack.SetVar what$, MyRound(PP)
                        Else
                                Select Case Typename(p)
                                Case "Long"
                                    s$ = s$ + "&"
                                Case "Currency"
                                    s$ = s$ + "#"
                                Case "Decimal"
                                    s$ = s$ + "@"
                                Case "Single"
                                    s$ = s$ + "~"
                                Case "Integer"
                                    s$ = s$ + "%"
                                End Select
                                If par Then
                                    If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                                Else
                                    If Not IsNumberCheck(s$, PP) Then PP = p
                                End If
                            If Typename(p) <> Typename(PP) Then
                            Overflow
                            Else
                        globalvar what$, MyRound(PP)
                        End If
                        End If
                End If
                 MyInput = True
    Case 5
                
                If neoGetArray(bstack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then FKey = 0: Exit Function
                Else
                MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                       FKey = 0:  Exit Function
                End If
                If FastSymbol(rest$, "=") Then IsNumberCheck rest$, p Else p = CDbl(0)
                MyInput = True
                If par Then
                        If uni(F) Then
                                getUniRealComma F, s$
                        Else
                                getAnsiRealComma F, s$
                        End If
                Else
              prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), "+*/!@#$|\{}[]'~`%^&()=_:;", True)
                        'If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False:  FKey = 0: Exit Function
                        If Trim(s$) = "" Then ErrNum: MyInput = False: FKey = 0: Exit Function
                End If
                'p = pppp.item(it)
                If FastSymbol(rest$, "=") Then IsNumberCheck rest$, p Else p = pppp.item(it)
                p = p - p
                Select Case Typename(p)
                    Case "Long"
                        s$ = s$ + "&"
                    Case "Currency"
                        s$ = s$ + "#"
                    Case "Decimal"
                        s$ = s$ + "@"
                    Case "Single"
                        s$ = s$ + "~"
                    Case "Integer"
                        s$ = s$ + "%"
                    End Select
                    If par Then
                        If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                    Else
                        If Not IsNumberCheck(s$, PP) Then PP = p
                    End If
                        pppp.item(it) = PP
                        
                 MyInput = True
    Case 6
                
                If neoGetArray(bstack, what$, pppp) Then
                       If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then FKey = 0: Exit Function
                Else
                 MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                       FKey = 0: Exit Function
                End If
                MyInput = True
                If par Then
                        If uni(F) Then
                                getUniStringComma F, s$, inpcleanstrings
                        Else
                                getAnsiStringComma F, s$, inpcleanstrings
                        End If
                        If inpcsvuseescape Then s$ = EscapeStrToString(s$)
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        QUERY bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), IIf(MaybeIsSymbol(rest$, ","), ",", Chr$(0)) + Chr$(34) + "{}"
                End If
                If MyIsObject(pppp.item(it)) Then
                If Typename(pppp.item(it)) = "Group" Then
                
                        If pppp.item(it).HasSet Then
                        what = Left$(what$, Len(what$) - 2)
                    

                                    Set mystack = bstack.soros
                                    PushParamGeneral bstack, rest$
                                    If Not FastSymbol(rest$, ")", True) Then
                                    Set bstack.Sorosref = mystack
                                    MyInput = False: Exit Function
                                    End If
                                    bstack.soros.DataStr s$
                                    NeoCall2 ObjPtr(bstack), what$ + "." + ChrW(&H1FFF) + ":=()", MyInput
                                    Set bstack.Sorosref = mystack
                                    Set mystack = Nothing
                    
        Else
        GroupCantSetValue
        End If
                ElseIf Typename(pppp.item(it)) = doc Then
                Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                        End If
                Else
                        pppp.item(it) = s$
                End If
                 MyInput = True
    Case 7
                If neoGetArray(bstack, what$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then FKey = 0: Exit Function
                Else
                        MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                        Exit Function
                End If
                
                If par Then
                        If uni(F) Then
                                getUniRealComma F, s$
                        Else
                                getAnsiRealComma F, s$
                        End If
                Else
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
                        w$ = QUERY(bstack, frm$, s$, 256, False, IIf(MaybeIsSymbol(rest$, ","), "," + vbCr, vbCr), "+*/!@#$|\{}[.]'~`%^&()=_:;", True)
                         'If Not IsNumber(bstack, s$, p) Then ErrNum: MyInput = False:  FKey = 0: Exit Function
                        If Trim(s$) = "" Then ErrNum: MyInput = False: FKey = 0: Exit Function
                End If
                 If FastSymbol(rest$, "=") Then IsNumberCheck rest$, p Else p = pppp.item(it)
                p = p - p
                Select Case Typename(p)
                    Case "Long"
                        s$ = s$ + "&"
                    Case "Currency"
                        s$ = s$ + "#"
                    Case "Decimal"
                        s$ = s$ + "@"
                    Case "Single"
                        s$ = s$ + "~"
                    Case "Integer"
                        s$ = s$ + "%"
                    End Select
                    If par Then
                        If Not IsNumberCheck(s$, PP, inpcsvDec$) Then PP = p
                    Else
                        If Not IsNumberCheck(s$, PP) Then PP = p
                    End If
                pppp.item(it) = MyRound(PP)
                MyInput = True
    End Select
    
                If FastSymbol(rest$, ",") Then
                w$ = vbNullString
                If Not par Then frm$ = " "
                ElseIf FastSymbol(rest$, ";") Then
                If Not par Then
               
                                 w$ = ";"
                                frm$ = " "
                   End If
                Else
                If Not par Then If Not w$ = ";" Then crNew bstack, players(prive)
                w$ = vbNullString
                FKey = 0: Exit Function
                End If
                
                Loop
                FKey = 0
                Exit Function
                End With

End Function
Function MyModules(bstack As basetask, rest$, Lang As Long) As Boolean
Dim frm$, s$, pa$, ss$, mDir As recDir

MyModules = True
frm$ = subHash.ShowRev    ' Mid$(SubName$, 2)
s$ = vbNullString
pa$ = vbNullString
ss$ = vbNullString
Do While ISSTRINGA(frm$, s$)

If frm$ <> "" Then
    If InStrRev(s$, ") ") > 0 Then
    
    pa$ = pa$ & Left$(s$, InStrRev(s$, ")")) & ", "
    ElseIf InStrRev(s$, " ") > 0 Then
    pa$ = pa$ & Left$(s$, InStrRev(s$, " ") - 1) & ", "
    End If
Else
    If InStrRev(s$, ") ") > 0 Then
    pa$ = pa$ & Left$(s$, InStrRev(s$, ")"))
    ElseIf InStrRev(s$, " ") > 0 Then
    pa$ = pa$ & Left$(s$, InStrRev(s$, " ") - 1)
    End If
End If
Loop

If pa$ <> "" Then
If here$ <> "" Then If FastSymbol(rest$, "?") Then GoTo ponly
If Lang Then

pa$ = "In Memory: " & pa$ & vbCrLf & "        Use REMOVE to remove the right most, EDIT module_name to edit"
Else
pa$ = "Στη Μνήμη: " & pa$ & vbCrLf & "        Με τη ΔΙΑΓΡΑΦΗ θα σβήσεις το τελευταίο, με ΣΥΓΓΡΑΦΗ ή Σ όνομα_τμήματος θα γράψεις"
End If
If here$ = vbNullString Then If FastSymbol(rest$, "?") Then GoTo ponly
End If
IsSymbol3 rest$, "?"

Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "GSB", False))

If frm$ <> "" Then
If pa$ <> "" Then pa$ = pa$ & vbCrLf
If Lang Then
pa$ = pa$ & "On Disk: "
Else
pa$ = pa$ & "Στον Δίσκο: "
End If
End If
ss$ = vbNullString
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = vbNullString

Loop
Set mDir = Nothing
pa$ = pa$ & ss$
If ss$ <> "" Then
If here$ = vbNullString Then
If Lang Then
pa$ = pa$ & vbCrLf + ReplaceStr$("'", Chr(34), "        Use LOAD 'module_name' to load, EDIT 'module_name.gsb' to edit on disk")
If IsSupervisor Then pa$ = pa$ & ", WIN DIR$ for folders tasks"
Else
pa$ = pa$ & vbCrLf + ReplaceStr$("'", Chr(34), "        Με ΦΟΡΤΩΣΕ ονομα_τμηματος φορτώνεις στη μνήμη, με Σ ή ΣΥΓΓΡΑΦΗ 'ονομα_τμηματος.gsb' διορθώνεις στο δίσκο")
If IsSupervisor Then pa$ = pa$ & ", με ΣΥΣΤΗΜΑ ΚΑΤ$ ανοίγεις τον κατάλογο με τα αρχεία για εργασίες"
End If
End If
End If
' PRINT ONLY
ponly:
RepPlain bstack, bstack.Owner, pa$

End Function
Function MyScore(bstack As basetask, rest$) As Boolean
Dim s$, sX As Double, p As Variant
MyScore = False
If IsExp(bstack, rest$, p) Then
If p >= 1 And p <= 16 Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, sX) Then
If FastSymbol(rest$, ",") Then
If IsStrExp(bstack, rest$, s$) Then
voices(p - 1) = s$
BEATS(p - 1) = sX
MyScore = True
End If
End If
End If
End If
End If
End If
End Function

Function MyPlayScore(bstack As basetask, rest$) As Boolean
Dim task As TaskInterface, sX As Double, p As Variant

MyPlayScore = True
If IsExp(bstack, rest$, p) Then
    If p = 0 Then
    TaskMaster.MusicTaskNum = 0
    TaskMaster.OnlyMusic = True
    Do
    TaskMaster.TimerTickNow
    Loop Until TaskMaster.PlayMusic = False
    TaskMaster.OnlyMusic = False   '' forget it in revision 130
   mute = True
    Else
    mute = False
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, sX) Then
          If sX < 1 Then
          sX = 0
          Do While TaskMaster.ThrowOne(CLng(p))
          sX = sX - 1
          If sX < -100 Then Exit Do
          Loop
          Else
          Set task = New MusicBox
          Set task.Owner = Form1.DIS
         
          task.Parameters CLng(p), CLng(sX)
          TaskMaster.MusicTaskNum = TaskMaster.MusicTaskNum + 1
          TaskMaster.AddTask task
          End If
          Do While FastSymbol(rest$, ",")
           MyPlayScore = False
        If IsExp(bstack, rest$, p) Then
             If FastSymbol(rest$, ",") Then
                If IsExp(bstack, rest$, sX) Then
                If sX < 1 Then
                        sX = 0
                        Do While TaskMaster.ThrowOne(CLng(p))
                        sX = sX - 1
                        If sX < -100 Then Exit Do
                        Loop
                  Else
                    Set task = New MusicBox
                    Set task.Owner = Form1.DIS
                    task.Parameters CLng(p), CLng(sX)
                    TaskMaster.MusicTaskNum = TaskMaster.MusicTaskNum + 1
                     TaskMaster.AddTask task
              End If
                MyPlayScore = True
                 End If
            End If
        End If
        If MyPlayScore = False Then
          mute = True
        Exit Do
        End If
          Loop
        End If
    End If
    End If
Else

MyPlayScore = False
End If
End Function
Function MyCopy(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, Scr As Object, photo As cDIBSection, s$, it As Long, what$
MyCopy = True
Dim x1 As Long, y1 As Long, x2 As Long, y2 As Long, pppp As mArray, y22 As Single
            If IsStrExp(bstack, rest$, s$) Then
             If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
                Set photo = New cDIBSection
                If cDib(s$, photo) Then
                If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
                If IsStrExp(bstack, rest$, s$) Then
                       photo.SaveDib s$
                       Set photo = Nothing
                       End If
                       End If
                       Exit Function
                Else
                        noImage s$
                        Exit Function
                End If
             Else
                If ExtractType(s$) = vbNullString Then s$ = s$ + ".bmp"
                FixPath s$
                If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            
             
            On Error Resume Next
            
            Set photo = New cDIBSection
            photo.CopyPicture bstack.Owner
            photo.SaveDib s$
            Set photo = Nothing
            Exit Function
            End If
Else
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p

If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
Select Case Abs(IsLabel(bstack, rest$, s$))
Case 3
    If GetVar(bstack, s$, it) Then
    
    Set photo = New cDIBSection
    Set Scr = bstack.Owner
    With players(GetCode(Scr))
    x1 = Scr.ScaleX(x1 + .XGRAPH, 1, 3) - Scr.ScaleX(.XGRAPH, 1, 3)
    y1 = Scr.ScaleX(y1 + .YGRAPH, 1, 3) - Scr.ScaleX(.YGRAPH, 1, 3)
    If photo.Create(CLng(x1), CLng(y1)) Then
    photo.LoadPictureBlt Scr.hDC, CLng(Scr.ScaleX(.XGRAPH, 1, 3)), CLng(Scr.ScaleX(.YGRAPH, 1, 3))
    
    If photo.bitsPerPixel <> 24 Then Conv24 photo
    
    var(it) = DIBtoSTR(photo)
    ' DOSE OK
    End If
    End With
     Set photo = Nothing
     Set Scr = Nothing
    Exit Function
    Else
    what$ = s$
    MyCopy = False
    Exit Function
    End If
Case 6
    ' ΑΠΟ ΠΙΝΑΚΑ
    Dim W6 As Long
    If neoGetArray(bstack, s$, pppp) Then
           If Not NeoGetArrayItem(pppp, bstack, s$, W6, rest$) Then Exit Function
    
    
      Set photo = New cDIBSection
      Set Scr = bstack.Owner
      With players(GetCode(Scr))
    x1 = Scr.ScaleX(x1 + .XGRAPH, 1, 3) - Scr.ScaleX(.XGRAPH, 1, 3)
    y1 = Scr.ScaleX(y1 + .YGRAPH, 1, 3) - Scr.ScaleX(.YGRAPH, 1, 3)
    If photo.Create(CLng(x1), CLng(y1)) Then
            photo.LoadPictureBlt Scr.hDC, CLng(Scr.ScaleX(.XGRAPH, 1, 3)), CLng(Scr.ScaleX(.YGRAPH, 1, 3))

            If photo.bitsPerPixel <> 24 Then Conv24 photo
                If MyIsObject(pppp.item(W6)) Then
                        MyEr "can't copy image to " + Typename(pppp.item(W6)), "δεν μπορώ να αντιγράψω εικόνα σε " + Typename(pppp.item(W6))
                        MyCopy = False
                Else
                        pppp.item(W6) = DIBtoSTR(photo)
                End If
            ' DOSE OK
        End If
        End With
        Set photo = Nothing
        Set Scr = Nothing
        Exit Function
    
        Else
    what$ = s$
    MyCopy = False
    Exit Function
    End If

End Select
ElseIf IsLabelSymbolNew(rest$, "ΜΕ", "USE", Lang) Then

If IsStrExp(bstack, rest$, s$) Then
 Set photo = New cDIBSection

If cDib(s$, photo) Then
y22 = 0!
  Set Scr = bstack.Owner
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y22 = p
    If y2 = 0 Then y2 = 100
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else y2 = 100

 If Not (y22 = 0 And y2 = 100) Then
     RotateDib1 bstack, photo, y22, y2, Scr.backcolor
     End If
      photo.PaintPicture Scr.hDC, CLng(Scr.ScaleX(x1, 1, 3)), CLng(Scr.ScaleX(y1, 1, 3))

End If
Set photo = Nothing
Set Scr = Nothing
Else
 MyCopy = False: MissNumExpr: Exit Function
End If
ElseIf IsLabelSymbolNew(rest$, "ΕΠΑΝΩ", "TOP", Lang) Then

If IsStrExp(bstack, rest$, s$) Then
 Set photo = New cDIBSection
Set Scr = bstack.Owner
If cDib(s$, photo) Then
y22 = 0!
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y22 = p
    If y2 = 0 Then y2 = 100
    If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else y2 = 100
    
If Not (y22 = 0 And y2 = 100) Then
     RotateDib1 bstack, photo, y22, y2, , CLng(x1), CLng(y1)
       End If
        photo.PaintPicture Scr.hDC, MyRound((Scr.ScaleX(x1, 1, 3)), 0), MyRound((Scr.ScaleX(y1, 1, 3)), 0) '', photo.Width * y2 \ 100, photo.Height * y2 \ 100
     
 
End If
Set photo = Nothing
Set Scr = Nothing
Else
 MyCopy = False: MissNumExpr: Exit Function
End If
Else
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then x2 = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y2 = p Else MyCopy = False: MissNumExpr: Exit Function

If x2 = 0 Or y2 = 0 Then MyCopy = False: MissNumExpr: Exit Function
ICOPY bstack.Owner, x1, y1, x2, CLng(y2)
End If
End If
MyDoEvents1 bstack.Owner

End Function
Function MyDrawings(bstack As basetask, rest$, Lang As Long) As Boolean
MyDrawings = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "WMF", False))
s$ = vbNullString
ss$ = vbNullString
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = vbNullString
Loop

If Lang Then
ss$ = "Drawings: " & ss$
Else
ss$ = "Σχέδια: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function
Function MySounds(bstack As basetask, rest$, Lang As Long) As Boolean
MySounds = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "WAV", False))
s$ = vbNullString
ss$ = vbNullString
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = vbNullString
Loop
If Lang Then
ss$ = "Sounds: " & ss$
Else
ss$ = "Ήχοι: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function

Function MyMovies(bstack As basetask, rest$, Lang As Long) As Boolean
MyMovies = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "AVI", False))
s$ = vbNullString
ss$ = vbNullString
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = vbNullString
Loop
Set mDir = Nothing
If Lang Then
ss$ = "Movies: " & ss$
Else
ss$ = "Ταινίες: " & ss$
End If
RepPlain bstack, bstack.Owner, ss$
End Function
Function MyBitmaps(bstack As basetask, rest$, Lang As Long) As Boolean
MyBitmaps = True
Dim mDir As recDir, s$, ss$, frm$
Set mDir = New recDir
mDir.IncludedFolders = False
mDir.Nofiles = False
mDir.TopFolder = mcd
mDir.SortType = Abs(FastSymbol(rest$, "!"))
frm$ = ExtractNameOnly(mDir.Dir2$(mcd, "BMP", False))
s$ = vbNullString
ss$ = vbNullString
Do While frm$ <> ""
s$ = frm$
If ss$ <> "" Then ss$ = ss$ & ", " & s$ Else ss$ = s$
s$ = mDir.Dir2
If s$ <> "" Then frm$ = ExtractNameOnly(s$) Else frm$ = vbNullString
Loop
If Lang Then
ss$ = "Bitmaps: " & ss$
Else
ss$ = "Εικόνες: " & ss$
End If
Set mDir = Nothing
RepPlain bstack, bstack.Owner, ss$
End Function
Function MyFunction(entrypoint As Long, bstack As basetask, rest$, Lang As Long, Optional noskipcommand = False, Optional MakeNew As Boolean) As Boolean
Dim y1 As Long, par As Boolean, what$, s$, ss$, pa$, x1 As Long, i As Long, frm$
Dim ohere$
ohere$ = here$
MyFunction = True
        If entrypoint = 1 Then
                par = True
                y1 = True
        ElseIf entrypoint = 2 Then
        ' operators
        par = IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", Lang)
        i = InStr(rest$, " ")
        If i = 1 Then
        i = InStr(2, rest$, " ")
        what$ = Mid$(rest$, 2, i - 2) ' + "()"
        Else
        what$ = Left$(rest$, i - 1) ' + "()"
        End If
        rest$ = Mid$(rest$, i + 1)
            GoTo operators
        Else
                y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", Lang)
                par = IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", Lang)
        End If
        If y1 <> 0 Then
                ' FUNCTION GLOBAL "ALFA[212].other" {definition} so we can place [ ] in a definition..
                ' FOR INTERNAL USE..
                    If MaybeIsSymbol(rest$, Chr(34)) Then
                        ISSTRINGA rest$, what$
                            x1 = 1
                        If Right$(what$, 1) = "$" Then
                            x1 = 3
                        ElseIf Right$(what$, 1) = "%" Then
                            x1 = 4
                        End If
                        what$ = what$ & "()"
                        If FastSymbol(rest$, "{") Then
                                ss$ = block(rest$)
                                i = Len(rest$)
                                If Not FastSymbol(rest$, "}") Then
                                        MyFunction = False
                                Else
                                ''*****************************************************************************
                       
                                                If Left$(sbf(Abs(bstack.OriginalCode)).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = vbNullString
                                                        Else
                                                                pa$ = sbf(Abs(bstack.OriginalCode)).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i - 2) + vbCrLf
                                                                End If
                                                        End If
                                                ElseIf Not bstack.LoadOnly Then
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & GetModuleName(bstack, ohere$) & ",-" & CStr(i - 2) + vbCrLf
                                                        End If
                                                End If
                                        bstack.IndexSub = ModuleSub(what$, s$ + ss$)
                                End If
                                Exit Function
                        End If
                End If
        End If
        x1 = Abs(IsLabelF(rest$, what$))
If x1 = 1 Or x1 = 3 Or x1 = 4 Then   ' C() C%() C$()
operators:
              If Not noskipcommand Then
                If x1 = 1 Then
                If funid.Find(what$ + "(", i) Then
                    funid.ItemCreator what$ + "(", -Abs(i)
                End If
                ElseIf x1 = 3 Then
                If strfunid.Find(what$ + "(", i) Then
                    strfunid.ItemCreator what$ + "(", -Abs(i)
               End If
                End If
                End If
                what$ = what$ & "()"
                MakeThisSub bstack, what$
                
                If y1 Then  ' We have a global function
                        If Not GetGlobalSubAfterHere(bstack, what$, x1) Then
                                    If FastSymbol(rest$, "(") Then
                                        frm$ = BlockParam(rest$)
                                    If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                                    If Not FastSymbol(rest$, ")") Then
                                    
                                    End If
                                    
                                    frm$ = Trim$(frm$)
                                    End If
                                If FastSymbol(rest$, "{") Then
                                        ss$ = block(rest$)
                                        i = Len(rest$)
                                        If Not FastSymbol(rest$, "}") Then
                                                MyFunction = False
                                        Else
                                                '  If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                                  If Left$(sbf(Abs(bstack.OriginalCode)).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = vbNullString
                                                        Else
                                                                pa$ = sbf(Abs(bstack.OriginalCode)).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i - 2) + vbCrLf
                                                                End If
                                                        End If
                                                ElseIf bstack.OriginalCode > 0 And Not bstack.LoadOnly And here$ <> "" Then
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & GetModuleName(bstack, ohere$) & ",-" & CStr(i - 2) + vbCrLf
                                                        End If
                                                End If
                                                If frm$ <> "" Then
                                                
                                                If Lang = 1 Then
                                                             s$ = s$ + vbCrLf + "Read " + frm$ + vbCrLf
                                           
                                                Else
                                                                 s$ = s$ + vbCrLf + "Διάβασε " + frm$ + vbCrLf
                                                End If
                                                End If
                                             bstack.IndexSub = ModuleSub(what$, s$ + ss$)
                                    
                                        End If
                                Else
                                       MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                                End If
                         Else
                                If FastSymbol(rest$, "(") Then
                                    frm$ = BlockParam(rest$)
                                If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                                If Not FastSymbol(rest$, ")") Then
                                End If
                                frm$ = Trim$(frm$)
                                End If
                                If FastSymbol(rest$, "{") Then
                                        what$ = block(rest$)
                                            If Len(frm$) <> 0 Then
                                                    If Lang = 1 Then
                                                        what$ = "Read " + frm$ + vbCrLf + what$
                                                    Else
                                                        what$ = "Διάβασε " + frm$ + vbCrLf + what$
                                                    End If
                                                    frm$ = vbNullString
                                                End If
                                        If Not FastSymbol(rest$, "}") Then
                                                MyFunction = False
                                        Else
                                               ' ' Call preProcessor(bstack, what$)
                                                If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                sbf(x1).sb = what$: bstack.IndexSub = x1
                                                Set sbf(x1).subs = Nothing
                                        End If
                                Else
                                    MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                                End If
                        End If
                        Exit Function
                Else
                If par Then
                x1 = ModuleSub(what$, "")
                GoTo jump1
                        ElseIf here$ = vbNullString And GetSub2(bstack, what$, x1) And Not MakeNew Then
                        
jump1:
                                If x1 >= lckfrm And lckfrm <> 0 Then   ' when we load a scrabled program..we have locked functions/modules
                                            MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                            rest$ = vbNullString
                                            MyFunction = False: Exit Function
                                End If
                                If FastSymbol(rest$, "(") Then
                                    frm$ = BlockParam(rest$)
                                    If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                                    If Not FastSymbol(rest$, ")") Then
                                    End If
                                    frm$ = Trim$(frm$)
                                    Else
                                    frm$ = vbNullString
                                    
                                End If

                                If FastSymbol(rest$, "{") Then
                                
                                            what$ = block(rest$) + " "
                                                If Len(frm$) <> 0 Then
                                                    If Lang = 1 Then
                                                        what$ = "Read " + frm$ + vbCrLf + what$
                                                    Else
                                                        what$ = "Διάβασε " + frm$ + vbCrLf + what$
                                                    End If
                                                    frm$ = vbNullString
                                                End If
                                            If Not FastSymbol(rest$, "}") Then
                                                    MyFunction = False
                                            Else
                                                    If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                                    sbf(x1).Changed = True
                                                    sbf(x1).sb = what$: bstack.IndexSub = x1
                                                    Set sbf(x1).subs = Nothing
                                            End If
                                    Else
                                            MyFunction = False
                                    End If
                                    Exit Function
                        ElseIf GetlocalSub(bstack.GroupName & what$, x1) And Not MakeNew Then
                     
                                If FastSymbol(rest$, "(") Then
                                    frm$ = BlockParam(rest$)
                                    If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                                    If Not FastSymbol(rest$, ")") Then
                                    End If
                                frm$ = Trim$(frm$)
                                  Else
                                frm$ = vbNullString
                                End If
                                                   
                                
                                    If FastSymbol(rest$, "{") Then
                                           If sbf(x1).locked Then
                                         what$ = block(rest$)
                                        bstack.IndexSub = x1
                                       FastSymbol rest$, "}", True
                                     Exit Function
                                    End If
                                   ' If noskipcommand Then
                                  '  If sbf(x1).sbgroup = vbNullString Then GoTo jumpheretoo
                                   ' Else
                                   '   If bstack.OriginalCode > x1 Then GoTo jumpheretoo
                                   '   End If
                                        If Len(frm$) <> 0 Then
                                            If Lang = 1 Then
                                            rest$ = "Read " + frm$ + vbCrLf + rest$
                                            Else
                                            rest$ = "Διάβασε " + frm$ + vbCrLf + rest$
                                            End If
                                            frm$ = vbNullString
                                        End If

                                        If x1 >= lckfrm And lckfrm <> 0 Then
                                            MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                            rest$ = vbNullString
                                            MyFunction = False: Exit Function
                                        End If
                                        i = Len(rest$)
                                        
                                        what$ = block(rest$) + " "
                                        While Left$(what$, 10) = "'11001EDIT"
                                                SetNextLine what$
                                        Wend
                                        If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                        what$ = "'11001EDIT " & GetModuleName(bstack, ohere$) & ",-" & CStr(i - 2) + vbCrLf + what$
                                        If Not FastSymbol(rest$, "}") Then
                                                MyFunction = False
                                        Else
                                            ' Call preProcessor(bstack, what$)
                                            If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                            sbf(x1).Changed = True
                                            sbf(x1).sb = what$
                                                bstack.IndexSub = x1
                                            Set sbf(x1).subs = Nothing
                                            End If
                                        
                                        
                                    
                                    Else
                                    '' or MyFunction=false
                                            rest$ = ":" & bstack.GroupName & what$ & " " & rest$
                                    End If
                                    Exit Function
                        ElseIf FastSymbol(rest$, "(") Then
                            frm$ = BlockParam(rest$)
                             If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                            If Not FastSymbol(rest$, ")") Then
                            End If
                            frm$ = Trim$(frm$)
                            If FastSymbol(rest$, "{") Then GoTo jumpheretoo
                        ElseIf FastSymbol(rest$, "{") Then
jumpheretoo:
                        
                                    If here$ = vbNullString Then
                                                s$ = block(rest$)
                                                 If frm$ <> "" Then

                                                    s = "READ " + frm$ + vbCrLf + s$
                                                 End If
                                                If Right$(s$, 2) <> vbCrLf Then s$ = s$ + vbCrLf
                                                ' NEED TO HAVE A HEADER ******************************************************************************
                                                bstack.IndexSub = ModuleSub(what$, s$)
                                    Else
                                                ss$ = block(rest$)
                                                i = Len(rest$)
                                             '   If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                                If Left$(sbf(Abs(bstack.OriginalCode)).sb, 10) = "'11001EDIT" Then
                                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                                s$ = vbNullString
                                                        Else
                                                                pa$ = sbf(Abs(bstack.OriginalCode)).sb
                                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                                
                                                                         s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                                                         
                                                                End If
                                                        End If
                                                ElseIf Not bstack.LoadOnly Then
                                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                                s$ = "'11001EDIT " & GetModuleName(bstack, ohere$) & ",-" & CStr(i + 2 * (bstack.UseGroupname <> "")) + vbCrLf
                                                        End If
                                                End If
                                                If frm$ <> "" Then
                                                        If Lang = 1 Then
        
                                                        s$ = s$ + vbCrLf + "Read " + frm$ + vbCrLf
                   
                                                        Else
        
                                                        s$ = s$ + vbCrLf + "Διάβασε " + frm$ + vbCrLf
                                                        End If

                                                End If

                                                bstack.IndexSub = ModuleSub(here$ & "." & bstack.GroupName & what$, s$ + ss$)
                                                
                                    End If
                                    If Not FastSymbol(rest$, "}") Then MyFunction = False
                                    Exit Function
                            Else
                                    MyFunction = False
                            End If
                End If
        Else
                rest$ = what$ & " " & rest$
                MyFunction = False
        End If

End Function
Function ProcDBprovider(bstack As basetask, rest$, Lang As Long) As Boolean
Dim pa$, s$, ss$
ProcDBprovider = True
If IsStrExp(bstack, rest$, pa$) Then
If pa$ = vbNullString Then
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
Else
' DB.PROVIDER "Microsoft.ACE.OLEDB.12.0","Jet OLEDB","100101"
' DB.PROVIDER "Microsoft.Jet.OLEDB.4.0", "Jet OLEDB", "100101"
' DB.PROVIDER "dns=testme;Uid=admin;Pwd=12alfa45", "ODBC", "100101"
' use (name) for database name

 JetPrefixUser = "Provider=" + pa$ + ";Data Source="  ' normal
    If FastSymbol(rest$, ",") Then
       If IsStrExp(bstack, rest$, s$) Then
          If s$ = vbNullString Then
             ProcDBprovider = False
          ElseIf UCase(s$) = "ODBC" Or UCase(s$) = "PATH" Then
                If FastSymbol(rest$, ",") Then
                 If IsStrExp(bstack, rest$, ss$) Then
                 JetPrefixUser = pa$ & ";Password=" & ss$
                 Else
                 JetPrefixUser = pa$ & ";Password="
                 End If
                Else
                JetPrefixUser = pa$
                End If
                JetPostfixUser = ";"
          Else
          
             If FastSymbol(rest$, ",") Then
                If IsStrExp(bstack, rest$, ss$) Then
                   If ss$ = vbNullString Then
                       JetPostfixUser = ";" & s$ & ":Database Password=100101;"
                   Else
                       JetPostfixUser = ";" & s$ & ":Database Password=" & ss$ & ";"
                   
                   End If
                    
                Else
                    ProcDBprovider = False
                End If
             Else
                JetPostfixUser = ";" & s$ & ":Database Password=100101;"
             End If
          End If
        Else
         ProcDBprovider = False
       End If
    Else
       JetPostfixUser = JetPostfixHelp

    End If
 End If
 Else
 JetPrefixUser = JetPrefixHelp
 
End If
JetPostfix = JetPostfixUser
JetPrefix = JetPrefixUser
End Function
Function ProcDBUSER(bstack As basetask, rest$, Lang As Long) As Boolean
Dim s$
ProcDBUSER = -True
    If IsStrExp(bstack, rest$, s$) Then
        If s$ = vbNullString Then
            extDBUser = vbNullString
            extDBUserPassword = vbNullString
        Else
            extDBUser = s$
        End If
        If FastSymbol(rest$, ",") Then
            If Not IsStrExp(bstack, rest$, extDBUserPassword) Then
                extDBUserPassword = vbNullString
            End If
            DBUser = extDBUser
            DBUserPassword = extDBUserPassword
        End If
    End If

End Function
Function ProcChooseOrgan(bstack As basetask, rest$, Lang As Long) As Boolean
Dim F As Long, i As Long, s$
If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
Form1.List1.Clear
F = 0
For i = 1 To 127
s$ = ORGAN(i)
Form1.List1.additemFast s$
'If TextWidth(bstack.Owner, s$) > f Then f = TextWidth(bstack.Owner, s$)
Next i
ProcChooseOrgan = MyMenu(1, bstack, rest$, Lang)
End Function
Function ProcChooseObj(bstack As basetask, rest$, Lang As Long) As Boolean
Dim F As Long, i As Long, s$, p As Variant
    Dim iSectCount As Long, iSect As Long, sSections() As String
    Dim iVerCount As Long, iVer As Long, sVersions() As String
      Dim iExeSectCount As Long, iExeSect As Long, sExeSect() As String

If Form4.Visible Then
Form4.Visible = False
    If Form1.TEXT1.Visible Then
        Form1.TEXT1.SetFocus
    Else
        Form1.SetFocus
    End If
End If
 Form1.List1.Clear
    If MaybeIsSymbol(rest$, "!") Then
            ObjectCatalog.Done = True
            For i = 0 To ObjectCatalog.count - 1
                ObjectCatalog.index = i
                Form1.List1.additemFast ObjectCatalog.KeyToString
                
            Next i
        ProcChooseObj = MyMenu(2, bstack, rest$, Lang)
    Else
      
       Set ObjectCatalog = New FastCollection
       Dim cr As New cRegistry, first$, k As Long
       Dim bFoundExeSect As Boolean, ss$, mmdir As New recDir
       '' some code here are copies from VbScriptEditor
       '' http://www.codeproject.com/Articles/19986/VbScript-Editor-With-Intellisense
       cr.ClassKey = HKEY_CLASSES_ROOT
       cr.ValueType = REG_SZ
       cr.SectionKey = "TypeLib"
        If cr.EnumerateSections(sSections(), iSectCount) Then
            For iSect = 1 To iSectCount
                cr.SectionKey = "TypeLib\" & sSections(iSect)
                If cr.EnumerateSections(sVersions(), iVerCount) Then
             
                    For iVer = 1 To iVerCount
                    
                            cr.SectionKey = "TypeLib\" & sSections(iSect) & "\" & sVersions(iVer)
                            first$ = cr.Value
                            cr.EnumerateSections sExeSect(), iExeSectCount
                           ''    ObjectCatalog.AddKey cR.Value + sVersions(iVer) + CStr(k), cR.Value + " (" + sVersions(iVer) + ")" + CLSIDToProgID(sSections(iSect))
                            If iExeSectCount > 0 Then
                                       bFoundExeSect = False
                                        For iExeSect = 1 To iExeSectCount
                                            If IsNumeric(sExeSect(iExeSect)) Then
                                            
                                            cr.SectionKey = cr.SectionKey & "\" & sExeSect(iExeSect) & "\win32"
                                                bFoundExeSect = True
                                            Exit For
                     
                                            End If
                                    Next iExeSect
                                                
                                       If bFoundExeSect Then
                                            ss$ = cr.Value
                                            
'
                                             ss$ = ExtractPath(ss$, , True) + ExtractName(ss$)
                                             If mmdir.ExistFile(ss$) Then
                                             
                                                ObjectCatalog.AddKey first$ + " (" + sVersions(iVer) + ")", ss$
 
                                               
                                          End If
                                        End If
               
                            End If
                            
                       Next iVer
                     End If
            Next iSect
            ObjectCatalog.Sort
            ObjectCatalog.Done = True
            For i = 0 To ObjectCatalog.count - 1
                ObjectCatalog.index = i
                Form1.List1.additemFast ObjectCatalog.KeyToString
                
            Next i
            
            ProcChooseObj = MyMenu(2, bstack, rest$, Lang)
        
        Else
            OutOfLimit
            ProcChooseObj = False
        End If
    End If
End Function

Function ProcBrowser(bstack As basetask, rest$, Lang As Long) As Boolean
Dim s$, w$, x As Double
ProcBrowser = True
If Not IsStrExp(bstack, rest$, s$) Then

    If Not Abs(IsLabelFileName(bstack, rest$, s$, , w$)) = 1 Then
         If NOEDIT Then
                If Form1.view1.Visible Then
                    Form1.KeyPreview = True
                    ProcTask2 bstack
                    Form1.view1.SetFocus: Form1.KeyPreview = False
                Else
                    Form1.KeyPreview = True
                End If
        End If
            Exit Function
    Else
     s$ = w$ '' low case
    End If
End If
            If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IEX = CLng(x): IESizeX = Form1.ScaleWidth - IEX Else MissNumExpr: ProcBrowser = False: Exit Function
                If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IEY = CLng(x): IESizeY = Form1.ScaleHeight - IEY Else MissNumExpr: ProcBrowser = False: Exit Function
                                If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IESizeX = CLng(x) Else MissNumExpr: ProcBrowser = False: Exit Function
                                    If FastSymbol(rest$, ",") Then
                    If IsExp(bstack, rest$, x) Then IESizeY = CLng(x) Else MissNumExpr: ProcBrowser = False: Exit Function
                 End If
                End If
             End If
           End If
           If IESizeX = 0 Or IESizeY = 0 Then
           IEX = Form1.ScaleWidth / 8
           IEY = Form1.ScaleHeight / 8
           IESizeX = Form1.ScaleWidth * 6 / 8
           IESizeY = Form1.ScaleHeight * 6 / 8
           End If

If myLcase(Left$(s$, 8)) = "https://" Or myLcase(Left$(s$, 7)) = "http://" Or myLcase(Left$(s$, 4)) = "www." Or myLcase(Left$(s$, 6)) = "about:" Then
Form1.IEUP s$
ElseIf s$ <> "" Then
Form1.IEUP "file:" & strTemp + s$
Else
Form1.IEUP ""
Form1.KeyPreview = True
End If
ProcTask2 bstack
End Function

Function ProcView(bstack As basetask, rest$, Lang As Long) As Boolean
If bstack.toprinter Then oxiforPrinter: Exit Function
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
GetNames bstack, rest$, Form1.List1, Lang
mywait bstack, CDbl(100)
If Not FastSymbol(rest$, ";") Then ProcView = MyMenu(2, bstack, rest$, Lang) Else ProcView = True
End Function

Function ProcTone(bstack As basetask, rest$) As Boolean
Dim p As Variant, sX As Double
If IsExp(bstack, rest$, p) Then
    If Not FastSymbol(rest$, ",") Then
       Beeper 1000, p
    ElseIf IsExp(bstack, rest$, sX) Then
    Beeper sX, p
    Else
    MyEr "wrong parameter", "λάθος παράμετρος"
    Exit Function
    End If
Else
Beeper 1000, 100
End If
ProcTone = True
End Function
Function ProcProto(bstack As basetask, rest$, Lang As Long) As Boolean
ProcProto = True
Dim s$, w$, v As Long
If FastSymbol(rest$, "{") Then
s$ = block(rest$)
Else
MissingCodeBlock
ProcProto = False
Exit Function
End If
If FastSymbol(rest$, "}", True) Then
    If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
        If IsLabelOnly(rest$, w$) = 3 Then
            v = globalvar(w$, v, , True)
            var(v) = s$
        Else
        MyEr "No string name (using $)", "Δεν βρήκα όνομα αλφαριθμητικού"
        ProcProto = False
        Exit Function
        End If
    Else
        MyEr "Missing AS", "Λείπει το Ως"
        ProcProto = False
        Exit Function
    End If
    Else
    ProcProto = False
End If
End Function
Function ProcBuffer(bstack As basetask, rest$, Lang As Long) As Boolean
ProcBuffer = True
Dim s$, what$, i As Long, p As Variant, PP As Long, par As Long, what2$, Runnable As Boolean, itissingle As Boolean
If IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", Lang) Then Runnable = True
If IsLabelSymbolNew(rest$, "ΚΕΝΗ", "CLEAR", Lang) Then par = &H8

     Do While Abs(IsLabel(bstack, rest$, what$)) = 1
     If bstack.priveflag Then what$ = ChrW(&HFFBF) + what$
     
                    If GetlocalVar(bstack.GroupName & what$, i) Then
                        If Not MyIsObject(var(i)) Then MakeitObjectBuffer var(i)
                    ElseIf GetVar(bstack, bstack.GroupName & what$, i, True) Then
                        If Not MyIsObject(var(i)) Then MakeitObjectBuffer var(i)
                    Else
                        i = globalvar(bstack.GroupName & what$, s$)
                        MakeitObjectBuffer var(i)
                    End If
                    ' GET TYPE OF  BUFFER
                    ' Char (1 byte) String (2 bytes)  Long (4 Bytes)
                    PP = 1
                    If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
                        If IsLabelSymbolNew(rest$, "ΨΗΦΙΟ", "BYTE", Lang, , , , False) Then
                            PP = 1
                        ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                            PP = 2
                        ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                            PP = 4
                        ElseIf IsLabelSymbolNew(rest$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                            itissingle = True
                            PP = 4
                        ElseIf IsLabelSymbolNew(rest$, "ΓΡΑΜΜΑ", "STRING", Lang, , , , False) Then
                            
                            PP = -4
                        ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                            PP = 8
                        ElseIf Abs(IsLabel(bstack, rest$, what2$)) = 1 Then
                        If IsExp(bstack, what2$, p) Then
                                If bstack.lastobj Is Nothing Then GoTo comehere
                                If Not TypeOf bstack.lastobj Is mHandler Then GoTo comehere
                                If Not TypeOf bstack.lastobj.objref Is FastCollection Then GoTo comehere
                                If bstack.lastobj.objref.StructLen = 0 Then GoTo comehere
                               PP = bstack.lastobj.objref.StructLen
                               Set var(i).objref.structref = bstack.lastobj.objref
                               var(i).objref.UseStruct = True
                               Set bstack.lastobj = Nothing
                        End If
                        Else
comehere:
                        SyntaxError
                            ProcBuffer = False
                                Exit Function
                        End If
                    
                    If FastSymbol(rest$, "*") Then
                        If IsExp(bstack, rest$, p) Then
                        ' we get the size here
                        If p <= 0 Then
                            MyEr "No Zero or Negative number for size", "Όχι μηδέν ή αρνητικό αριθμό για μήκος"
                            ProcBuffer = False
                            Exit Function
                        Else
                         '' MAKE IT
                    If var(i).objref.ItemSize <> 0 Then
                    If var(i).objref.ItemSize = Abs(PP) Then
                    var(i).objref.ResizeItems CLng(p), par
                    End If
                    Else
                        If itissingle Then
                            var(i).objref.Costruct PP, CLng(p), par, Runnable, vbSingle
                        Else
                            var(i).objref.Costruct PP, CLng(p), par, Runnable
                        End If
                        End If
                        End If
                        Else
                            MissPar
                            ProcBuffer = False
                            Exit Function
                        End If
                        
                    Else
                    If var(i).objref.Status = 0 Then
                        If itissingle Then
                            var(i).objref.Costruct PP, 1, par, Runnable, vbSingle
                        Else
                            var(i).objref.Costruct PP, 1, par, Runnable
                        End If
                        End If
                    End If
                End If
     
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     Loop

End Function
Function ProcInventory(bstack As basetask, rest$, Lang As Long) As Boolean
ProcInventory = True
Dim s$, what$, i As Long, p As Variant, Queue As Boolean, serr As Boolean
    Queue = IsLabelSymbolNew(rest$, "ΟΥΡΑ", "QUEUE", Lang)
     Do While Abs(IsLabel(bstack, rest$, what$)) = 1
     serr = False
conthere:
     If bstack.priveflag Then what$ = ChrW(&HFFBF) + what$
     If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(bstack.GroupName & what$, i) Then
       
            If Not MyIsObject(var(i)) Then GoTo makeitnow1
            If FastSymbol(rest$, "=") Then
             GoTo there12
             Else
             GoTo makeitnow1
             End If
           ' use global inventory for global ' change from revision 19-version 8.7
            ElseIf here$ = vbNullString Then
            If Not GetVar(bstack, bstack.GroupName & what$, i) Then
            ' If Not MyIsObject(var(i)) Then GoTo makeitnow1
            'GoTo there12
            GoTo lookglobal
            End If
             GoTo makeitnow1
            Else
lookglobal:
            i = globalvar(bstack.GroupName & what$, s$)     ' MAKE ONE  '
                    If Not MyIsObject(var(i)) Then GoTo makeitnow1
             If FastSymbol(rest$, "=") Then
             GoTo there12
             Else
             GoTo makeitnow1
             End If
            End If
            ElseIf GetVar(bstack, bstack.GroupName & what$, i, True) Then
             GoTo makeitnow1
            Else
        
                i = globalvar(bstack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow1:
                    MakeitObjectInventory var(i), Queue
' here look for block
                    If FastSymbol(rest$, "=") Then
there12:
                    
                        Set bstack.lastobj = var(i)
                        ' new addition we can change an inventory to a queue inventory
                        ' but not the other way
                       If Queue Then bstack.lastobj.objref.AllowAnyKey
                       serr = True
                        ProcInventory = AddInventory(bstack, rest$, serr)
                        If serr Then Exit Function
                        serr = Not Abs(IsLabel(bstack, rest$, what$)) = 1
                        If serr Then Exit Do
                        GoTo conthere

                    Else
                    ' nothing
                    End If
                End If
            End If
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     serr = True

     Loop
If serr Then SyntaxError: ProcInventory = False
End Function


Function ProcSettings(bstack As basetask, rest$, Lang As Long) As Boolean
Dim it As Long
TweakLang = Lang
With bstack.Owner
    it = .FontItalic
    .FontItalic = 0
    notweak = True
    MoveFormToOtherMonitorOnly TweakForm
    If Not Form1.Visible Then
    TweakForm.Show , Form5
    Else
    TweakForm.Show 1, Form1
    End If
   
    If Not notweak Then
        Form1.myBreak bstack
        original bstack, ""
    Else
        .FontItalic = it
    End If
End With
ProcSettings = True
End Function
Function ProcThreadPlan(bstack As basetask, rest$, Lang As Long) As Boolean
If IsLabelSymbolNew(rest$, "ΤΑΥΤΟΧΡΟΝΟ", "CONCURRENT", Lang) Then
If TaskMaster.QueueCount <> 0 Then
If Not Interrupted Then MyEr "Threads exist, can't change thread plan", "Υπάρχουν νήματα, δεν μπορείς να αλλάξεις σχέδιο"
Else
Interrupted = True
End If

ElseIf IsLabelSymbolNew(rest$, "ΔΙΑΔΟΧΙΚΟ", "SEQUENTIAL", Lang) Then
If TaskMaster.QueueCount <> 0 Then
If Interrupted Then MyEr "Threads exist, can't change thread plan", "Υπάρχουν νήματα, δεν μπορείς να αλλάξεις σχέδιο"
Else
Interrupted = False
End If
End If
ProcThreadPlan = True
End Function
Function ProcBeep(bstack As basetask, rest$) As Boolean
Dim p As Variant
If IsExp(bstack, rest$, p) Then
MessageBeep CLng(p)
Else
Beep
End If
ProcBeep = True
End Function
Function ProcSound(bstack As basetask, rest$) As Boolean
Dim s$
If IsStrExp(bstack, rest$, s$) Then PlaySoundNew s$
ProcSound = True
End Function
Function ProcTune(bstack As basetask, rest$) As Boolean
'' break async
Dim p As Variant, s$
If IsExp(bstack, rest$, p) Then
    If Not FastSymbol(rest$, ",") Then
        beeperBEAT = CLng(p)
    ElseIf IsStrExp(bstack, rest$, s$) Then
        beeperBEAT = CLng(p)
        PlayTune (s$)
    Else
        MyEr "wrong parameter", "λάθος παράμετρος"
        Exit Function
    End If
ElseIf IsStrExp(bstack, rest$, s$) Then
' B C D E F G
PlayTune (s$)
End If
ProcTune = True
End Function
Function ProcName(bstack As basetask, rest$, Lang As Long) As Boolean
Dim s$, w$, x1 As Long, y1 As Long, ss$
ProcName = True

x1 = Abs(IsLabelFileName(bstack, rest$, s$, , w$))

If x1 = 1 Then
s$ = w$
 If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then ProcName = False: Exit Function

 y1 = Abs(IsLabelFileName(bstack, rest$, ss$, , w$))

 If y1 = 0 Then
rest$ = w$ + rest$
y1 = IsStrExp(bstack, rest$, ss$)
ElseIf y1 = 1 Then
ss$ = w$
End If
If y1 <> 0 Then
If Not CanKillFile(CFname(s$)) Then FilePathNotForUser: ProcName = False: Exit Function
RenameFile s$, ss$

Exit Function
End If
Else
rest$ = s$ + rest$
End If
If IsStrExp(bstack, rest$, s$) Then
 If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then ProcName = False: Exit Function
If IsStrExp(bstack, rest$, ss$) Then
On Error Resume Next
RenameFile s$, ss$
On Error GoTo 0
Else
ProcName = False
Exit Function
End If
Else
ProcName = False
Exit Function
End If
End Function
Function ProcOpen(bstack As basetask, rest$, Lang As Long) As Boolean
Dim s$, what$, it As Long, p As Variant, x1 As Long, i As Long, skip As Boolean, excl As Boolean
If IsStrExp(bstack, rest$, s$) Then
    If s$ <> "" Then
        FixPath s$
    Else
        skip = True
        i = -2
    End If
    If IsLabelSymbolNew(rest$, "ΓΙΑ", "FOR", Lang, True) Then
        If skip Then
            If Not IsLabelSymbolNew(rest$, "ΕΥΡΙΑ", "WIDE", Lang) Then
                IsLabelSymbolNew rest$, "ΕΥΡΕΙΑ", "WCHAR", Lang
            End If
        Else
            i = FreeFile
            uni(i) = IsLabelSymbolNew(rest$, "ΕΥΡΙΑ", "WIDE", Lang)
            'SPELLING CORRECTION FOR GREEK WORD..
            If Not uni(i) Then uni(i) = IsLabelSymbolNew(rest$, "ΕΥΡΕΙΑ", "WCHAR", Lang)
            End If
        If IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗ", "INPUT", Lang) Then
            excl = IsLabelSymbolNew(rest$, "ΑΠΟΚΛΕΙΣΤΙΚΑ", "EXCLUSIVE", Lang)
            If skip Then BadFilename: Exit Function
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, True) Then
            IsSymbol rest$, "#"
            
            
                    If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                        If GetVar(bstack, what$, it) Then
                            var(it) = i
                            
                        Else
                            globalvar what$, i
                        End If
                        FLEN(i) = 1
                        FKIND(i) = Finput
                        If CFname(GetDosPath(s$)) <> "" Then
                            On Error Resume Next
                            If excl Then
                                Open GetDosPath(s$) For Binary Access Read Lock Read Write As i
                            Else
                                Open GetDosPath(s$) For Binary Access Read As i
                            End If
                            If Err.Number > 0 Then MyEr Err.Description, Err.Description: Exit Function
                         
                        End If
                End If
                End If
        ElseIf IsLabelSymbolNew(rest$, "ΣΥΜΠΛΗΡΩΣΗ", "APPEND", Lang) Then
            excl = IsLabelSymbolNew(rest$, "ΑΠΟΚΛΕΙΣΤΙΚΑ", "EXCLUSIVE", Lang)
            If Not skip Then If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, True) Then
                IsSymbol rest$, "#"
                If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                    If GetVar(bstack, what$, it) Then
                        var(it) = i
                    Else
                        globalvar what$, i
                    End If
                    If Not skip Then
                    If CFname(GetDosPath(s$)) <> "" Then
                        FLEN(i) = 1
                        FKIND(i) = Fappend
                        On Error Resume Next
                        If Not WeCanWrite(GetDosPath(s$)) Then ProcOpen = False: Exit Function
                            If excl Then
                            Open GetDosPath(s$) For Binary Access Write Lock Read Write As i
                            Else
                            Open GetDosPath(s$) For Binary Access Write As i
                            End If
                            Seek i, LOF(i) + 1
                        If Err.Number > 0 Then MyEr Err.Description, Err.Description: Exit Function
                    End If
                    End If
                Else
                    ExpectedVariable
                    Exit Function
                End If
            Else
                Exit Function
            End If
        ElseIf IsLabelSymbolNew(rest$, "ΕΞΑΓΩΓΗ", "OUTPUT", Lang) Then
            excl = IsLabelSymbolNew(rest$, "ΑΠΟΚΛΕΙΣΤΙΚΑ", "EXCLUSIVE", Lang)
            If Not skip Then If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, True) Then
                IsSymbol rest$, "#"
                If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                    If GetVar(bstack, what$, it) Then
                        var(it) = i
                    Else
                        globalvar what$, i
                    End If
                    On Error Resume Next
                    If Not skip Then
                       FLEN(i) = 1
                       FKIND(i) = Foutput
                       If Not NeoUnicodeFile(s$) Then NoCreateFile: Exit Function
                       On Error Resume Next
                       If excl Then
                       Open GetDosPath(s$) For Binary Access Write Lock Read Write As i
                       Else
                       Open GetDosPath(s$) For Binary Access Write As i
                       End If
                       If Err.Number > 0 Then MyEr Err.Description, Err.Description: Exit Function
                    End If
                Else
                    ExpectedVariable
                    Exit Function
                End If
            Else
                Exit Function
            End If
        ElseIf IsLabelSymbolNew(rest$, "ΠΕΔΙΑ", "RANDOM", Lang) Then
            excl = IsLabelSymbolNew(rest$, "ΑΠΟΚΛΕΙΣΤΙΚΑ", "EXCLUSIVE", Lang)
            If skip Then BadFilename: Exit Function
            If Not CanKillFile(s$) Then FilePathNotForUser:  Exit Function
            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang, True) Then
                IsSymbol rest$, "#"
                If Abs(IsLabel(bstack, rest$, what$)) = 1 Then
                    If GetVar(bstack, what$, it) Then
                        var(it) = i
                     Else
                        globalvar what$, i
                    End If
                    If IsLabelSymbolNew(rest$, "ΜΗΚΟΣ", "LEN", Lang, , , , False) Then
                        If FastSymbol(rest$, "=", True) Then
                            If IsExp(bstack, rest$, p) Then
                                p = Abs(p)
                                If uni(i) Then p = p * 2
                                    If p > 32767 Then p = 32767
                                        x1 = p
                                        FLEN(i) = x1
                                        FKIND(i) = Frandom
                                    Else
                                        Exit Function
                                    End If
                                Else
                                    MissNumExpr
                                    Exit Function
                                End If
                                On Error Resume Next
                                If CFname(s$) = vbNullString Then
                                    If Not NeoUnicodeFile(s$) Then NoCreateFile: Exit Function
                                End If
                                If excl Then
                                Open GetDosPath(s$) For Binary Lock Read Write As i
                                Else
                                Open GetDosPath(s$) For Binary As i
                                End If
                                If Err.Number > 0 Then MyEr Err.Description, Err.Description: Exit Function
                            Else
                                MissNumExpr
                                ExpectedVariable
                                Exit Function
                            End If
                    Else
                        Exit Function
                    End If
                Else
                    ExpectedVariable
                    Exit Function
                End If
            Else
                MyEr "Choose a way to open  file", "Διάλεξε έναν τρόπο για να ανοίξεις το αρχείο"
                Exit Function
            End If
        End If
        ProcOpen = True
Else
        MissStringExpr
End If

End Function
Function ProcTargets(bstack As basetask, rest$, Lang As Long) As Boolean
If Lang = 1 Then
If IsLabelSymbolLatin(rest$, "NEW") Then
If Targets Then
Targets = False
End If
ReDim q(0) As target
End If
Else
If IsLabelSymbol(rest$, "ΝΕΟΙ") Then
If Targets Then
Targets = False
End If
ReDim q(0) As target
End If
End If
ProcTargets = True
End Function
Function ProcWriter(basestack As basetask, rest$, Lang As Long) As Boolean
Dim prive As Long
prive = GetCode(basestack.Owner)
If Lang = 1 Then
PlainBaSket basestack.Owner, players(prive), "George Karras (C), Preveza, Greece 1999-2018"
Else
PlainBaSket basestack.Owner, players(prive), "Γιώργος Καρράς (C), Πρέβεζα, Ελλάδα 1999-2018"
End If
crNew basestack, players(prive)
ProcWriter = True
End Function
Function ProcList(basestack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, again$, Clsid() As GUID, LNames() As String, clsNumber As Long, i As Long, probe$, what$
Dim usemodule As Boolean, where As Long, page$
If IsLabelSymbolNew(rest$, "ΧΡΗΣΤΩΝ", "USERS", Lang) Then
ProcUsers basestack
ProcList = True
Exit Function
End If

If FastSymbol(rest$, "!") Then
mylist basestack, -2, Lang   ' proportional
ElseIf IsLabelSymbolNew(rest$, "COM", "COM", Lang) Then
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
If here$ <> "" Then
    MyEr "Only in command line interpreter", "Μόνο στον μεταφραστή γραμμής"
    Exit Function
End If

If IsLabelOnly(rest$, what$) = 0 Then
    MyEr "Expect a module name", "Περίμενα ένα όνομα τμήματος"
    Exit Function
End If
what$ = myUcase(what$, True)
If Not subHash.Find(what$, where) Then
If Lang = 1 Then
where = ModuleSub(what$, "\\ End for Automatic list" + vbCrLf)
Else
where = ModuleSub(what$, "\\ Τέλος Αυτόματης λίστα" + vbCrLf)
End If
End If
usemodule = True

End If

'' read a name and give a list
'' use Choose.Object
'' List Lib ?
If ObjectCatalog.count <> 0 Then again$ = "!"
' use Choose.object + to make it again
If ProcChooseObj(basestack, again$, Lang) Then
' list1 is a glist control
If Form1.List1.ListIndex = -1 Then ProcList = True: Exit Function
    If Form1.List1.listcount > 0 Then
                ObjectCatalog.index = Form1.List1.ListIndex
        If Not usemodule Then
                basestack.soros.PushStr ObjectCatalog.Value
                ProcList = MyReport(basestack, "letter$", Lang)
        End If
        On Error GoTo there
        If GetAllCoclasses(ObjectCatalog.Value, Clsid(), LNames(), clsNumber) Then
        If Not usemodule Then If clsNumber > 0 Then ProcList = MyReport(basestack, "{CoClasses - Objects}", Lang)
        For i = 0 To clsNumber - 1
        If usemodule Then
            If Lang = 1 Then
                page$ = page$ + "Declare "
            Else
                page$ = page$ + "Όρισε "
            End If
            page$ = page$ + LNames(i) + " " + Chr$(34) + GetGUIDstr(Clsid(i)) + Chr$(34) + vbCrLf
        Else
        probe$ = strProgID(Clsid(i))
        basestack.soros.PushStr GetGUIDstr(Clsid(i))
        If probe$ = vbNullString Then
        basestack.soros.PushStr LNames(i)
        Else
        basestack.soros.PushStr probe$
        End If
        
        ProcList = MyReport(basestack, "quote$(letter$)+{, }+quote$(letter$)", Lang)
        End If
        Next i
         If usemodule Then
         sbf(where).sb = page$ + sbf(where).sb
         End If
       ' If Not UnloadLibrary(ObjectCatalog.Value) Then
        'MyEr "Can't Unload library", "Δεν μπορώ να ξεφορτώσω την βιβλιοθήκη"
        'End If
        End If
      ProcList = True
    End If
Else
ProcList = True
End If
Exit Function
ElseIf IsExp(basestack, rest$, p) Then
mylist basestack, CLng(p), Lang

Else
mylist basestack, , Lang

  


End If
MyDoEvents1 basestack.Owner
ProcList = True
Exit Function
there:
MyEr Err.Description, Err.Description
Err.Clear
End Function
Function ProcFKey(bstack As basetask, rest$, Lang As Long) As Boolean
Dim i As Long, p As Variant, s$, prive
If IsLabelSymbolNew(rest$, "ΚΑΘΑΡΟ", "CLEAR", Lang) Then
    For i = 1 To 13: FK$(i) = vbNullString: Next i
ElseIf IsExp(bstack, rest$, p) Then

    i = ((CLng(p) + 11) Mod 12) + 1
    If MaybeIsSymbol(rest$, "{") Then
         If IsStrExp(bstack, rest$, s$) Then
            FK$(i) = s$
        Else
            MissPar
            Exit Function
        End If
    ElseIf FastSymbol(rest$, ",") Then
        If IsStrExp(bstack, rest$, s$) Then
            FK$(i) = s$
        Else
            MissPar
            Exit Function
        End If
    Else
        prive = GetCode(bstack.Owner)
        PlainBaSket bstack.Owner, players(prive), FK$(i)
        crNew bstack, players(prive)
    End If
Else
    s$ = vbNullString: prive = GetCode(bstack.Owner)
    For i = 1 To 13
        If FK$(i) <> "" Then
            s$ = s$ + placeme$("ΚΛΕΙΔΙ", "FKEY", Lang) + Right$(" " & Str$(i), 3) & " [" & FK$(i) & "]" ' FKEY
            If i = 13 Then s$ = s$ + " SHIFT + F1" Else s$ = s$ + " F" & CStr(i)
            s$ = s$ + vbCrLf
        End If
    Next i
    RepPlain bstack, bstack.Owner, s$
End If
ProcFKey = True
End Function
Function ProcItalic(bstack As basetask, rest$) As Boolean
Dim p As Variant
If IsExp(bstack, rest$, p) Then
    bstack.myitalic = (p <> 0)
Else
    bstack.myitalic = Not bstack.myitalic
    p = CDbl(bstack.myitalic)
End If
players(GetCode(bstack.Owner)).italics = Abs(p <> 0)
bstack.Owner.Font.Italic = (p <> 0)
ProcItalic = True
End Function
Function ProcEditDoc(bstack As basetask, rest$, Lang As Long) As Boolean
Dim prive As Long, s$, sX As Double, i As Long, DUM As Boolean, frm$
Dim x1 As Long, y1 As Long, p As Variant, col As Long
Dim pppp As mArray
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
prive = GetCode(bstack.Owner)
With players(prive)

                Form1.EditTextWord = Not IsLabelSymbolNew(rest$, "ΚΩΔΙΚΑ", "CODE", Lang)
                DUM = False
                    y1 = Abs(IsLabel(bstack, rest$, s$))
                     
                    If y1 = 6 Then
                                If neoGetArray(bstack, s$, pppp) Then
                                 If Not NeoGetArrayItem(pppp, bstack, s$, i, rest$) Then Exit Function
                                Else
                                MissingDoc
                                
                                Exit Function
                                End If
                    End If
                    If FastSymbol(rest$, ",") Then
                        If Not IsExp(bstack, rest$, sX) Then    ' FROM
                      If FastSymbol(rest$, ",") Then
                      GoTo conteditdoc
                      Else
                             MissNumExpr
                            
                            Exit Function
                      End If
                        End If
                    Else
                
                    
                 sX = 0
                    End If
                    If FastSymbol(rest$, ",") Then
conteditdoc:
                        If Not IsStrExp(bstack, rest$, frm$) Then
                        If FastSymbol(rest$, ",") Then GoTo conteditdoc2
                        End If
                          Else
                    Form1.ResetMarks
                     frm$ = vbNullString
                    
                    End If
                    If FastSymbol(rest$, ",") Then
conteditdoc2:
                        If Not IsExp(bstack, rest$, p) Then    ' FROM
                            MissStringExpr
                            
                            Exit Function
                            Else
                            col = CLng(p)
                            DUM = True
                        End If
                        
                    Else
                    Form1.ResetMarks
                    End If
                        If y1 = 3 Then
                            If GetVar(bstack, s$, i) Then
                                If Typename(var(i)) = doc Then
                                If var(i).LastSelStart > 0 And sX = 0 Then
                                x1 = var(i).LastSelStart
                                    Else
                                    If sX = 0 Then sX = -1
                                    x1 = sX
                                End If
                                   Form1.TEXT1.Title = frm$ + " "
                                  ScreenEditDOC bstack, var(i), 0, .mysplit, .mx - 1, .My - 1, x1, DUM, col
                                    var(i).LastSelStart = x1
                                    var(i).ColorEvent = False
                                    ProcEditDoc = True
                                Else
                                    MissingDoc
                                    
                                End If
                            Else
                                   MissFuncParameterStringVar
                                    
                            End If
                        ElseIf y1 = 6 Then
                                    If Typename(pppp.item(i)) = doc Then
                                                  If pppp.item(i).LastSelStart > 0 And sX = 0 Then
                                x1 = pppp.item(i).LastSelStart
                               
                                    Else
                                    If sX = 0 Then sX = -1
                                    x1 = sX
                                End If
                                    Form1.TEXT1.Title = frm$ + " "
                                  ScreenEditDOC bstack, pppp.item(i), 0, .mysplit, .mx - 1, .My - 1, x1, DUM, col
                                    pppp.item(i).LastSelStart = x1
                                     pppp.item(i).ColorEvent = False
                                    ProcEditDoc = True
                                    
                                      Else
                                      MissingDoc
                                      
                                      End If
                               
                                    
                    Else
                          MissPar
                          
                    End If
End With
End Function
Function ProcVersion(bstack As basetask) As Boolean
Dim prive
prive = GetCode(bstack.Owner)
' from 8.8 rev 6 change
'PlainBaSket bstack.Owner, players(prive), CStr(App.Major) & "." & CStr((App.Minor \ 1000) - 1) & " (" & CStr(App.Minor Mod 1000) & ")"
PlainBaSket bstack.Owner, players(prive), CStr(App.Major) & "." & CStr((App.Minor \ 100)) & " (" & CStr(App.Minor Mod 100) & ")"
crNew bstack, players(prive)
ProcVersion = True
End Function
Function ProcSrcoll(bstack As basetask, rest$, Lang As Long) As Boolean
Dim prive As Long, p As Variant, DUM As Boolean
ProcSrcoll = True
If bstack.toprinter Then
MyEr "No scrolling for printer document", "Όχι κύλιση για το έγγραφο εκτύπωσης"
ProcSrcoll = False
Else
prive = GetCode(bstack.Owner)
If IsLabelSymbolNew(rest$, "ΚΑΤΩ", "DOWN", Lang) Then
    ScrollDownNew bstack.Owner, players(prive)
ElseIf IsLabelSymbolNew(rest$, "ΧΩΡΙΣΜΑ", "SPLIT", Lang) Then
If IsExp(bstack, rest$, p) Then
''SetText bstack.Owner
With players(prive)
    If p < 0 Then p = .My + p
    If p >= 0 And p < .My Then .mysplit = p
End With
Else
ProcSrcoll = False
SyntaxError
End If
Else
 DUM = IsLabelSymbolNew(rest$, "ΑΝΩ", "UP", Lang)
ScrollUpNew bstack.Owner, players(prive)


End If
End If

End Function
Function ProcFont(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, s$
    prive = GetCode(bstack.Owner)
    If IsStrExp(bstack, rest$, s$) Then
        On Error Resume Next
        x1 = bstack.Owner.Font.charset
        bstack.Owner.Font.name = s$
        If Not (x1 = bstack.Owner.Font.charset) Then
            bstack.Owner.Font.charset = x1
        End If
    
        If LCase(bstack.Owner.Font.name) <> LCase(s$) Then
        
            bstack.Owner.Font.name = MYFONT
            bstack.Owner.Font.charset = bstack.myCharSet
        End If
    End If
        StoreFont bstack.Owner.Font.name, players(prive).SZ, bstack.Owner.Font.charset
        players(prive).FontName = bstack.Owner.Font.name
        SetText bstack.Owner
        GetXYb bstack.Owner, players(prive), players(prive).curpos, players(prive).currow
 ProcFont = True
End Function
Function ProcStack(bstack As basetask, rest$, Lang As Long) As Boolean
Dim ss$, frm$, ps As mStiva, it As Long, x As Variant, x0 As Double, s$, once As Boolean, prive As Boolean
Dim x1 As Long, pa$, what$, i As Long, pppp As mArray, F As Long, myobject As Object
ProcStack = True
   If IsLabelSymbolNew(rest$, "ΝΕΟΣ", "NEW", Lang) Then
   If FastSymbol(rest$, "{") Then
ss$ = "{" & block(rest$) & "}"
frm$ = rest$
If FastSymbol(rest$, "}") Then
Set ps = bstack.soros
Set bstack.Sorosref = New mStiva
Call executeblock(it, bstack, ss$, False, once)
Set bstack.Sorosref = ps
Set ps = Nothing
If it = 0 Then ProcStack = False
Exit Function
End If
End If
   Else
If FastSymbol(rest$, "!") Then
If VALIDATEpart(rest$, s$) Then
Do While s$ <> ""
If ISSTRINGA(s$, pa$) Then
bstack.soros.DataStr pa$
ElseIf IsNumberD(s$, x0) Then
bstack.soros.DataVal x0
Else
Exit Do
End If
Loop
Else
again:

If IsExp(bstack, rest$, x) Then
If bstack.lastobj Is Nothing Then
    'SyntaxError
Else
If TypeOf bstack.lastobj Is mHandler Then
If TypeOf bstack.lastobj.objref Is mArray Then
    bstack.soros.MergeBottomCopyArray bstack.lastobj.objref
ElseIf TypeOf bstack.lastobj.objref Is mStiva Then
    bstack.soros.MergeBottom bstack.lastobj.objref
End If
ElseIf TypeOf bstack.lastobj Is mArray Then
bstack.soros.MergeBottomCopyArray bstack.lastobj
ElseIf TypeOf bstack.lastobj.objref Is mStiva Then
    bstack.soros.MergeBottom bstack.lastobj.objref
End If
Set bstack.lastobj = Nothing
If FastSymbol(rest$, ",") Then FastSymbol rest$, "!": GoTo again

    Exit Function
End If
End If
ProcStack = False
End If
Exit Function
Else
' STACK A$
' stack a$, "NN"
If MaybeIsSymbol(rest$, ".") Then
If IsStrExp(bstack, rest$, ss$) Then
    GoTo isAstring
ElseIf IsExp(bstack, rest$, x) Then
    GoTo isAnobject
Else
    SyntaxError
    ProcStack = False
End If
Exit Function
Else
x1 = Abs(IsLabel(bstack, rest$, what$))
End If
If x1 = 3 Then
    If Not MaybeIsSymbol(rest$, "+") Then
        If GetVar(bstack, what$, it) Then
            ss$ = var(it)
            If FastSymbol(rest$, ",") Then
                If Not IsStrExp(bstack, rest$, pa$) Then ProcStack = False: Exit Function
            End If
            If VALIDATE(ss$, pa$, frm$) Then
                IsSymbol3 pa$, ","
                    If Typename(var(it)) = doc Then
                        Set var(it) = New Document
                        var(it).textDoc = pa$
                    Else
                        var(it) = pa$
                    End If
                    Set ps = New mStiva
                i = 1
                Do While i <= Len(frm$) And ss$ <> ""
                    If Mid$(frm$, i, 1) = "S" Then
                        If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
                    Else
                        If IsNumberD(ss$, x0) Then ps.DataVal x0
                    End If
                    IsSymbol ss$, ","
                    i = i + 1
                Loop
                With bstack
                    If .SorosNothing Then
                        Set .Sorosref = ps
                    Else
                        .soros.MergeTop ps
                    End If
                End With
            Else
                MyEr "Stack can't read choosen types", "Ο σωρός δεν μπορεί να διαβάσει τους επιλεγμένους τύπους"
                ProcStack = False
                Exit Function
            End If
        Else
            Nosuchvariable what$
        End If
    Else
        rest$ = what$ + rest$
        If IsStrExp(bstack, rest$, ss$) Then
            pa$ = vbNullString
            If VALIDATE(ss$, pa$, frm$) Then
                Set ps = New mStiva
                i = 1
                Do While i <= Len(frm$) And ss$ <> ""
                    If Mid$(frm$, i, 1) = "S" Then
                        If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
                    Else
                        If IsNumberD(ss$, x0) Then ps.DataVal x0
                    End If
                    IsSymbol ss$, ","
                    i = i + 1
                Loop
                With bstack
                     If .SorosNothing Then
                        Set .Sorosref = ps
                     Else
                        .soros.MergeTop ps
                     End If
                End With
            End If
        Else
            ProcStack = False
            Exit Function
        End If
    End If
ElseIf x1 = 6 Then
    If neoGetArray(bstack, what$, pppp) Then
        If Not NeoGetArrayItem(pppp, bstack, what$, F, rest$) Then ProcStack = False: Exit Function
        ss$ = pppp.item(F)
        If FastSymbol(rest$, ",") Then
            If Not IsStrExp(bstack, rest$, pa$) Then ProcStack = False: Exit Function
        End If
        
        If VALIDATE(ss$, pa$, frm$) Then
            IsSymbol3 pa$, ","
            If Typename(pppp.item(F)) = doc Then
                s$ = pppp.item(F)
                Set pppp.item(F) = New Document
                If s$ <> "" Then
                    pppp.item(F).textDoc = s$
                End If
            Else
                pppp.item(F) = pa$
            End If
            Set ps = New mStiva
            i = 1
            Do While i <= Len(frm$) And ss$ <> ""
                If Mid$(frm$, i, 1) = "S" Then
                    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
                Else
                    If IsNumberD(ss$, x0) Then ps.DataVal x0
                End If
                IsSymbol ss$, ","
                i = i + 1
            Loop
            With bstack
                If .SorosNothing Then
                    Set .Sorosref = ps
                Else
                    .soros.MergeTop ps
                End If
            End With
        'stack$(bstack) = ss$ & stack$(bstack)
        Else
            MyEr "String has no valid stack", "Το αλφαριθμητικό δεν έχει έγκυρα στοιχεία σωρού"
        End If
    Else
    GoTo conthere
    End If
Else
conthere:
    rest$ = what$ & rest$
    If IsStrExp(bstack, rest$, ss$) Then
isAstring:
        pa$ = vbNullString
        If VALIDATE(ss$, pa$, frm$) Then
                Set ps = New mStiva
                i = 1
                Do While i <= Len(frm$) And ss$ <> ""
                If Mid$(frm$, i, 1) = "S" Then
                    If ISSTRINGA(ss$, pa$) Then ps.DataStr pa$
                Else
                    If IsNumberD(ss$, x0) Then ps.DataVal x0
                End If
                IsSymbol ss$, ","
                i = i + 1
                Loop
                With bstack
                    If .SorosNothing Then
                        Set .Sorosref = ps
                    Else
                        .soros.MergeTop ps
                    End If
                End With
                'stack$(bstack) = ss$ & stack$(bstack)
        
        Else
            ProcStack = False

        End If
                    Exit Function
    ElseIf IsExp(bstack, rest$, x) Then
isAnobject:
        Set myobject = bstack.lastobj
        Set bstack.lastobj = Nothing
        If Err Then MyEr "Not a stack", "Δεν είναι σωρός": Exit Function
        If CheckDeepAny(myobject) Then
            If Not TypeOf myobject Is mStiva Then MyEr "Not a stack", "Δεν είναι σωρός": Exit Function
            If FastSymbol(rest$, "{") Then
                ss$ = "{" & block(rest$) & "}"
                frm$ = rest$
                If FastSymbol(rest$, "}") Then
                    Set ps = bstack.soros
                    Set bstack.Sorosref = myobject
                    Call executeblock(it, bstack, ss$, False, once)
                    Set bstack.Sorosref = ps
                    Set ps = Nothing
                    If it = 0 Then ProcStack = False
            
                End If
            Else
            bstack.soros.MergeBottom myobject
                'MyEr "No Block {}", "Δεν υπάρχει μπλοκ εντολών { }"
            End If
        Else
            MyEr "Nothing found", "Δεν βρήκα τίποτα"
        End If
        Exit Function
End If
    i = 0
    With bstack.soros
    s$ = vbNullString
    Do
    i = i + 1
    If .Total < i Then Exit Do
    
    Select Case .StackItemType(i)
    Case "?"
    s$ = s$ & "(?) "
    Case "N", "L", "D"
    s$ = s$ & Trim$(Str(.StackItem(i))) & " "
    Case "S"
    ss$ = .StackItem(i)
        If Len(ss$) > 78 Then
        s$ = s$ & Chr(34) + Left$(ss$, 75) & ".." & Chr(34)
        Else
        s$ = s$ & Chr(34) + ss$ & Chr(34)
        End If
    Case ">"
    If Lang = 1 Then
    ss$ = "[Optional]"
    Else
    ss$ = "[Προαιρετικό]"
    End If
        
        s$ = s$ & ss$
        
    
    Case Else
    Set myobject = .StackItem(i)
    If Not myobject Is Nothing Then
    If TypeOf myobject Is mHandler Then
    Dim aaa As mHandler
    If myobject.indirect > -1 Then
    If MyIsObject(var(myobject.indirect)) Then
    If myobject.indirect <= var2used Then
    
            s$ = s$ + "*[" + Typename(var(myobject.indirect)) + "]"
            Else
             s$ = s$ + "*[Error]"
            End If
    Else
            s$ = s$ + "*[Nothing]"
    End If
    Else
        Select Case myobject.t1
        Case 1
            s$ = s$ + "*[Inventory]"
        Case 2
            s$ = s$ + "*[Buffer]"
        Case Else
            s$ = s$ + "*[" + Typename(myobject.objref) + "]"
        End Select
    End If
    Else
        s$ = s$ + "*[" + Typename(myobject) + "]"
    End If
    Else
    s$ = s$ + "*[Nothing]"
    End If
    
    End Select
    Loop
    Set myobject = Nothing
    End With
    prive = GetCode(bstack.Owner)
    PlainBaSket bstack.Owner, players(prive), s$
    crNew bstack, players(prive)
    Exit Function
    End If
End If
End If

End Function
Function ProcCHANGE(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, x As Double, w$
If IsExp(bstack, rest$, p) Then
p = CLng(p)
If p >= 0 And p < UBound(q()) Then
     
              '
While FastSymbol(rest$, ",")
If IsLabelSymbolNew(rest$, "ΦΡΑΣΗ", "TEXT", Lang) Then
If IsStrExp(bstack, rest$, w$) Then q(p).Tag = w$
ElseIf IsLabelSymbolNew(rest$, "ΠΕΝΑ", "PEN", Lang) Then
If IsExp(bstack, rest$, x) Then q(p).pen = x
ElseIf IsLabelSymbolNew(rest$, "ΦΟΝΤΟ", "BACK", Lang) Then
If IsExp(bstack, rest$, x) Then q(p).back = x
ElseIf IsLabelSymbolNew(rest$, "ΠΛΑΙΣΙΟ", "BORDER", Lang) Then
If IsExp(bstack, rest$, x) Then q(p).fore = x
ElseIf IsLabelSymbolNew(rest$, "ΟΔΗΓΙΑ", "COMMAND", Lang) Then
If IsStrExp(bstack, rest$, w$) Then q(p).Comm = w$
End If

Wend
RTarget bstack, q(p)
End If
ProcCHANGE = True
End If

End Function
Function ProcSaveAs(bstack As basetask, rest$, Lang As Long) As Boolean
Dim Scr As Object, frm$, pa$, s$, ss$, w$
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi

frm$ = mcd
DialogSetupLang Lang

IsStrExp bstack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(bstack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(bstack, rest$, pa$) Then ss$ = pa$
If FastSymbol(rest$, ",") Then If Not IsStrExp(bstack, rest$, w$) Then Exit Function
olamazi
If TypeOf bstack.Owner Is GuiM2000 Then
Set Scr = bstack.Owner
Else
If Form1.Visible Then
Set Scr = Form1
Else
Set Scr = Nothing
End If
End If
' change for file type
If InStr(w$, "|") > 0 Then w$ = vbNullString  ' NOT COMBATIBLE..CHANGE TO ALL FILES
If SaveAsDialog(bstack, Scr, s$, frm$, ss$, w$) Then
bstack.soros.PushStr ReturnFile
Else
bstack.soros.PushStr ""
End If
Set Scr = Nothing
ProcSaveAs = True
End Function
Function ProcChooseColor(bstack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, i As Long, it As Long, Scr As Object
olamazi
With players(GetCode(bstack.Owner))
If IsExp(bstack, rest$, p) Then
i = CLng(p)
Else
i = -.mypen
End If
it = i
If i > 16 Then it = -it
If i > 0 And i < 16 Then i = QBColor(i)

If TypeOf bstack.Owner Is GuiM2000 Then
Set Scr = bstack.Owner
Else
    If Form1.Visible Then
    Set Scr = Form1
    Else
    Set Scr = Nothing
    End If
End If
DialogSetupLang Lang
If OpenColor(bstack, Scr, i) Then
bstack.soros.PushVal CDbl(-i)
Else
bstack.soros.PushVal CDbl(-it)

End If
Set Scr = Nothing
End With
ProcChooseColor = True
End Function
Function ProcDesktop(bstack As basetask, rest$, Lang As Long) As Boolean
Dim work1 As Boolean, oldleft As Long, oldtop As Long
Dim photo As cDIBSection, s$, p As Variant, x As Double, aPic As StdPicture
olamazi
If IsLabelSymbolNew(rest$, "ΕΙΚΟΝΑ", "IMAGE", Lang) Then
If IsStrExp(bstack, rest$, s$) Then
' FILL WIDTH  IMAGE
 If Left$(s$, 4) = "cDIB" And Len(s$) > 12 Then
 Set photo = New cDIBSection
 If Not cDib(s$, photo) Then MissCdibStr:  Exit Function
  photo.GetDpi 96, 96
  If form5iamloaded Then
  Form5.RestoreSizePos
  Form5.Cls
  photo.ThumbnailPaint Form5
  Else
  photo.ThumbnailPaint Form1
  End If
 Else
 If ExtractType(s$) = vbNullString Then s$ = s$ & ".jpg"
                    If CFname(s$) = vbNullString Then
                        s$ = mcd & s$
                        If CFname(s$) = vbNullString Then
                        BadFilename
                        Exit Function
                        End If
                    Else
                        s$ = CFname(s$)
                    End If
        If Len(s$) < 254 Then
        ' look for image to load
            Set photo = New cDIBSection
            If CFname(s$) <> "" Then
             s$ = CFname(s$)
                                       Set aPic = LoadMyPicture(GetDosPath(s$))
                If Not aPic Is Nothing Then
                
                    photo.CreateFromPicture aPic
                                           
                    If photo.bitsPerPixel <> 24 Then
                        Conv24 photo
                        Else
                        CheckOrientation photo, s$
                        End If
                       photo.GetDpi 96, 96
                       If form5iamloaded Then
                       Form5.RestoreSizePos
                       Form5.Cls
                       photo.ThumbnailPaint Form5
                       Else
                       photo.ThumbnailPaint Form1
                       End If
                    End If
                    End If
        Else
        BadFilename
        End If
        End If
 Set photo = Nothing
End If
ElseIf IsLabelSymbolNew(rest$, "ΚΡΥΨΕ", "HIDE", Lang) Then
If Not form5iamloaded Then
'
End If
Form5.backcolor = &H0 ' ALWAYS BLACK
Form5.Cls
SetTrans Form5, CByte(255), mycolor(0), True
ElseIf IsLabelSymbolNew(rest$, "ΚΑΘΑΡΗ", "CLEAR", Lang) Then
If form5iamloaded Then
Form5.RestoreSizePos
Form5.backcolor = &H0 ' ALWAYS BLACK
Form5.Cls

Set Form5.Picture = LoadPicture("")
Form5.Cls
SetTrans Form5, CByte(255), mycolor(-2)

Else
Form1.Cls
End If
Else
If Not Form1.Visible Then
work1 = True
oldleft = Form1.Left
oldtop = Form1.Left
Form1.Move -Form1.Width - dv15, -Form1.Height - dv15
Form1.Visible = True
End If
If IsExp(bstack, rest$, p) Then
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, x) Then
        
        Form5.Visible = True
        Form5.ZOrder 1
        SetTrans Form1, CByte(p And &HFF), mycolor(x), True
        
        End If
    Else

    Form5.Visible = True
    'Form5.ZOrder 1
    SetTrans Form1, CByte(p And &HFF)
    End If
    Else
    CdESK
    End If
End If
If work1 Then
    Form1.Visible = False
    Form1.Move oldleft, oldtop
End If

ProcDesktop = True
End Function
Function ProcPath(bstack As basetask, rest$, Lang As Long) As Boolean
Dim F As Boolean, p As Variant, col As Long, it As Long, ss$, x As Double, par As Boolean, frm$, prive As Long
Dim oldGDIlines As Boolean, region As Boolean, oldpathcolor As Long, oldpathfillstyle As Integer
ProcPath = True
prive = GetCode(bstack.Owner)
F = IsLabelSymbolNew(rest$, "ΠΑΝΩ", "OVER", Lang)
If FastSymbol(rest$, "!") Then par = True

If IsExp(bstack, rest$, p) Then
        col = CLng(p)  ' using a fill color
        If FastSymbol(rest$, ",") Then
           If Not IsExp(bstack, rest$, x) Then MissNumExpr
           Else
           x = vbSolid
           End If
        If FastSymbol(rest$, "{") Then
            'ss$ = "{" & block(rest$) & "}"
            ss$ = block(rest$) & vbCr
            frm$ = rest$
            If FastSymbol(rest$, "}") Then
            
                        players(prive).pathgdi = players(prive).pathgdi + 1
                        oldpathfillstyle = players(prive).pathfillstyle
                        oldpathcolor = players(prive).pathcolor
                        
                        players(prive).pathcolor = mycolor(col)
                        players(prive).pathfillstyle = Int(x) Mod 8
                        
                        BeginPath bstack.Owner.hDC
                        If (par Or F) And GDILines Then oldGDIlines = True: players(prive).NoGDI = True
                        Call executeblock(it, bstack, ss$, False, False)
                        If oldGDIlines = True Then players(prive).NoGDI = False
                        players(prive).pathgdi = players(prive).pathgdi - 1
                        If players(prive).pathgdi > 0 Then
                        players(prive).pathcolor = oldpathcolor
                        players(prive).pathfillstyle = oldpathfillstyle
                        End If
                        
                        ' what for 2 and 3 values
                        EndPath bstack.Owner.hDC
        
                        bstack.Owner.fillstyle = Int(x) Mod 8
                        bstack.Owner.FillColor = mycolor(col)
                        col = p ' from  6.3 change
                        If par Then bstack.Owner.DrawMode = 7
                        If F Then  ' from 8 rev 83
                              If bstack.Owner.fillstyle = 1 Then
                                   StrokeAndFillPath bstack.Owner.hDC
                                Else
                                    FillPath bstack.Owner.hDC
                                  End If
                        Else
                             StrokeAndFillPath bstack.Owner.hDC         ' stroke and fill path
                        End If
                        If par Then bstack.Owner.DrawMode = 13
                        bstack.Owner.fillstyle = vbSolid
          
                If Trim(ss$) = vbNullString Then ss$ = " "
                  If it <> 1 Then rest$ = Left$(ss$, Len(ss$) - 1) + frm$: ProcPath = False
              End If
            Else
       MissPar
ProcPath = False
        End If
        Exit Function
    Else
        If FastSymbol(rest$, "{") Then
            ss$ = block(rest$)
            If Trim(ss$) = vbNullString Then
             ProcPath = FastSymbol(rest$, "}")
            If FastSymbol(rest$, ";") Then
  
                SelectClipRgn bstack.Owner.hDC, 0&
            
            End If
            Exit Function
            End If
            ss$ = "{" & ss$ & "}"
            frm$ = rest$
            If FastSymbol(rest$, "}") Then
                If FastSymbol(rest$, ";") Then region = True
                oldpathfillstyle = players(prive).pathfillstyle
                oldpathcolor = players(prive).pathcolor
                
                players(prive).pathcolor = mycolor(col)
                players(prive).pathfillstyle = Int(x) Mod 8
                BeginPath bstack.Owner.hDC
                If (par Or region) And GDILines Then oldGDIlines = True: players(prive).NoGDI = True
                Call executeblock(it, bstack, ss$, False, False)
                If oldGDIlines = True Then players(prive).NoGDI = False
                EndPath bstack.Owner.hDC
                players(prive).pathgdi = players(prive).pathgdi - 1
                 If players(prive).pathgdi > 0 Then
                        players(prive).pathcolor = oldpathcolor
                        players(prive).pathfillstyle = oldpathfillstyle
                        End If
                bstack.Owner.fillstyle = vbSolid
                If region Then            ' path { block of commands };
                If F Then
                SelectClipPath bstack.Owner.hDC, 2
                Else
                    SelectClipPath bstack.Owner.hDC, RGN_COPY  ' make a clip path
                    End If
                Else
                    If par Then bstack.Owner.DrawMode = 7
                    StrokePath bstack.Owner.hDC               ' stroke path
                    If par Then bstack.Owner.DrawMode = 13
                End If
                If Trim(ss$) = vbNullString Then ss$ = " "
                   If it <> 1 Then rest$ = Left$(ss$, Len(ss$) - 1) + frm$: ProcPath = False: Exit Function

        End If
    Else
MissPar
ProcPath = False
    End If
    
End If

End Function
Function ProcFLOODFILL(bstack As basetask, rest$, Lang As Long) As Boolean
Dim x1 As Long, y1 As Long, col As Long, p As Variant, par As Boolean

With players(GetCode(bstack.Owner))
par = IsLabelSymbolNew(rest$, "ΧΡΩΜΑ", "COLOR", Lang)
x1 = .XGRAPH
y1 = .YGRAPH
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = CLng(p)
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = CLng(p)
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = CLng(p) Else MissNumExpr: Exit Function
Ffill bstack.Owner, (x1), (y1), col, par
End With
MyDoEvents1 bstack.Owner
ProcFLOODFILL = True
End Function
Function ProcFill(bstack As basetask, rest$) As Boolean
Dim prive As Long, x As Double, p As Variant, y As Double, x1 As Long, y1 As Long, par As Boolean, col As Long
Dim Scr As Object, ss$
Set Scr = bstack.Owner
prive = GetCode(Scr)
With players(prive)
If FastSymbol(rest$, "@") Then par = True
x1 = 0
y1 = 1
col = players(prive).mypen
If IsExp(bstack, rest$, p) Then x1 = p
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = p

Scr.CurrentX = .XGRAPH
Scr.CurrentY = .YGRAPH
If par Then

'*****************
y = 5
If FastSymbol(rest$, ",") Then If Not IsExp(bstack, rest$, y) Then y = 5
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, x) Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
MyFill Scr, (x1), (y1), (y), (x), (p)
Else
    MissNumExpr
    Exit Function
End If
Else
MyFill Scr, (x1), (y1), (y), (x)
End If
ElseIf IsStrExp(bstack, rest$, ss$) Then
MyFill Scr, (x1), (y1), (y), ss$
Else
MyFill Scr, (x1), (y1), 5, "?"
End If
Else
MyFill Scr, (x1), (y1), 6, 0
End If

'*******************
Else
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MissNumExpr: Exit Function
If FastSymbol(rest$, ",") Then 'ok
par = False
    If Not IsExp(bstack, rest$, x) Then
        If col = 0 Then x = rgb(255, 255, 255) Else x = 0
        Else
        par = True
    End If
    y = True
    If FastSymbol(rest$, ",") Then 'ok
        If IsExp(bstack, rest$, y) Then
            y = y <> 0
            par = True
        End If
    End If
    p = True
    If FastSymbol(rest$, ",") Then
        If IsExp(bstack, rest$, p) Then
            p = p <> 0
            par = True
        End If
    End If
    If par Then
    Gradient Scr, mycolor(col), mycolor(x), RMIN(.XGRAPH, x1 + .XGRAPH), Scr.Width - RMAX(.XGRAPH, x1 + .XGRAPH), RMIN(.YGRAPH, y1 + .YGRAPH), Scr.Height - RMAX(.YGRAPH, y1 + .YGRAPH), y, p
    .XGRAPH = .XGRAPH + x1
    .YGRAPH = .YGRAPH + y1
    MyDoEvents1 Scr
    Set Scr = Nothing
    ProcFill = True
    Exit Function
    End If
    Set Scr = Nothing
MissNumExpr:  Exit Function
Else

Scr.Line (.XGRAPH, .YGRAPH)-Step(x1, y1), mycolor(col), BF
.XGRAPH = Scr.CurrentX
.YGRAPH = Scr.CurrentY

End If
End If


End With
MyDoEvents1 Scr
Set Scr = Nothing
ProcFill = True
End Function
Function MyCursor(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, y1 As Long, p As Variant
prive = GetCode(bstack.Owner)
MyCursor = True
With players(prive)
If FastSymbol(rest$, "!") Then
 .curpos = .XGRAPH \ .Xt
  .currow = (.YGRAPH) \ .Yt '(.Yt + .uMineLineSpace)
ElseIf IsExp(bstack, rest$, p) Then
x1 = CLng(p) Mod 1000 '' Mod (.mx + 1)
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
y1 = CLng(p) Mod 1000   ''Mod (.my + 1)
.curpos = x1
.currow = y1

Else
MyCursor = False
End If
Else
.curpos = x1
End If
.lastprint = False
Else
If FastSymbol(rest$, ",") Then
    If IsExp(bstack, rest$, p) Then
    y1 = CLng(p) Mod 1000   ''Mod (.my + 1)
    .currow = y1
    Else
    MyCursor = False
    End If
End If
.lastprint = False
End If
End With
LCTbasketCur bstack.Owner, players(prive)
End Function
Function MyLineInput(bstack As basetask, rest$, Lang As Long) As Boolean
Dim F As Long, p As Variant, what$, it As Long, s$, i As Long, prive As Long, frm$
Dim pppp As mArray
If IsLabelSymbolNew(rest$, "ΕΙΣΑΓΩΓΗΣ", "INPUT", Lang) Then
If FastSymbol(rest$, "#") Then

    If Not IsExp(bstack, rest$, p) Then Exit Function
    If Not FastSymbol(rest$, ",") Then Exit Function
    F = CLng(MyMod(p, 512))
    Select Case Abs(IsLabel(bstack, rest$, what$))
    Case 3
    MyLineInput = True
    If uni(F) Then
    If Not getUniStringlINE(F, s$) Then MyLineInput = False: MyEr "Can't input, not UTF16LE", "Δεν μπορώ να εισάγω, όχι UTF16LE": Exit Function
    Else
    getAnsiStringlINE F, s$
    End If
    If GetVar(bstack, what$, i) Then
    CheckVar var(i), s$
    Else
    globalvar what$, s$
    End If
    Case 6
    If neoGetArray(bstack, what$, pppp) Then

    If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
    Else
    Exit Function
    End If
    MyLineInput = True
    If uni(F) Then
    If Not getUniStringlINE(F, s$) Then MyLineInput = False: MyEr "Can't input, not UTF16LE", "Δεν μπορώ να εισάγω, όχι UTF16LE": Exit Function
    Else
    getAnsiStringlINE F, s$
    End If
    If Typename(pppp.item(it)) = doc Then
    Set pppp.item(it) = New Document
    If s$ <> "" Then pppp.item(it).textDoc = s$
    Else
    pppp.item(it) = s$
    End If
    End Select
Else
If Not releasemouse Then If Not Form1.Visible Then newshow basestack1
If bstack.toprinter = True Then oxiforPrinter:   Exit Function
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
Select Case Abs(IsLabel(bstack, rest$, what$))
Case 3
           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
QUERY bstack, frm$, s$, 1000, False

                If GetVar(bstack, what$, i) Then
                        CheckVar var(i), s$
                Else
                        globalvar what$, s$
                End If
                 MyLineInput = True
Case 6
If neoGetArray(bstack, what$, pppp) Then
                       If Not NeoGetArrayItem(pppp, bstack, what$, it, rest$) Then Exit Function
                Else
                 MyEr "No such array", "Δεν υπάρχει τέτοιος πίνακας"
                       Exit Function
                End If
                           prive = GetCode(bstack.Owner)
                If players(prive).lastprint Then
                LCTbasket bstack.Owner, players(prive), players(prive).currow, players(prive).curpos
                players(prive).lastprint = False
                End If
QUERY bstack, frm$, s$, 1000, False

 If Typename(pppp.item(it)) = doc Then
                Set pppp.item(it) = New Document
                        If s$ <> "" Then pppp.item(it).textDoc = s$
                Else
                        pppp.item(it) = s$
                End If
                 MyLineInput = True
End Select

End If


End If
End Function

Function MyFrame(bstack As basetask, rest$) As Boolean
Dim prive As Long, x1 As Long, y1 As Long, col As Long, p As Variant
Dim x As Double, y As Double, ss$
MyFrame = True
prive = GetCode(bstack.Owner)
With players(prive)
x1 = 1
y1 = 1
col = .mypen
If FastSymbol(rest$, "@") Then
If FastSymbol(rest$, "(") Then
    If IsExp(bstack, rest$, p) Then x1 = Abs(p + .curpos) Mod (.mx + 1)
    If Not FastSymbol(rest$, ")") Then MissSymbol ")": Exit Function
Else
    If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod (.mx + 1)
End If
If FastSymbol(rest$, ",") Then
    If FastSymbol(rest$, "(") Then
        If IsExp(bstack, rest$, p) Then y1 = Abs(p + .currow - 1) Mod (.My + 1)
        If Not FastSymbol(rest$, ")") Then MissSymbol ")": Exit Function
    
    Else
        If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod (.My + 1)
    End If
    '
    
End If
y = 5
If FastSymbol(rest$, ",") Then If Not IsExp(bstack, rest$, y) Then y = 5
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, x) Then
If FastSymbol(rest$, ",") Then
If IsExp(bstack, rest$, p) Then
MyRect bstack.Owner, players(prive), (x1), (y1), (y), (x), (p)
Else
 MyFrame = False: MissNumExpr: Exit Function
End If
Else
MyRect bstack.Owner, players(prive), (x1), (y1), (y), (x)
End If
ElseIf IsStrExp(bstack, rest$, ss$) Then
MyRect bstack.Owner, players(prive), (x1), (y1), (y), ss$
Else
MyRect bstack.Owner, players(prive), (x1), (y1), 5, "?"
End If
Else
MyRect bstack.Owner, players(prive), (x1), (y1), 6, 0
End If
Else
If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod .mx
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod .My

x1 = x1 + .curpos - 1
y1 = y1 + .currow - 1
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then BoxColorNew bstack.Owner, players(prive), x1, y1, (p)


If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p Else MyFrame = False: MissNumExpr: Exit Function


BoxBigNew bstack.Owner, players(prive), x1, y1, col
End If
End With
MyDoEvents1 bstack.Owner


End Function
Function MyMark(bstack As basetask, rest$) As Boolean
Dim prive As Long, p As Variant, par As Boolean, x1 As Long, y1 As Long, col As Long
MyMark = True
prive = GetCode(bstack.Owner)
With players(prive)
x1 = 1
y1 = 1
col = .mypen
If IsExp(bstack, rest$, p) Then x1 = Abs(p) Mod .mx
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then y1 = Abs(p) Mod .My
x1 = x1 + .curpos - 1
y1 = y1 + .currow - 1
If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then col = p

If FastSymbol(rest$, ",") Then If IsExp(bstack, rest$, p) Then par = Not (p = 0)

CircleBig bstack.Owner, players(prive), x1, y1, col, par
End With
MyDoEvents1 bstack.Owner


End Function
Function MyMenu(entrypoint As Long, bstack As basetask, rest$, Lang As Long) As Boolean
Dim prive As Long, p As Variant, par As Boolean, x1 As Long, y1 As Long, col As Long
Dim frm$, it As Long, s$, F As Long
MyMenu = True
If entrypoint = 1 Then GoTo ekei
If bstack.toprinter Then
oxiforPrinter
 MyMenu = False
Exit Function
End If
If Typename(bstack.Owner) Like "Gui*" Then oxiforforms: Exit Function
prive = GetCode(bstack.Owner)
            If IsLabelSymbolNew(rest$, "ΔΕΙΞΕ", "SHOW", Lang) Then
                If Form1.List1.Visible Then
                        If IsStrExp(bstack, rest$, s$) Then
                            p = Form1.List1.Find(s$)
                        ElseIf IsExp(bstack, rest$, p) Then
                            p = p - 1
                        Else
                            SyntaxError
                            MyMenu = False
                        End If
                        If p <> -1 Then
                            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then  ' CHANGE MENU ITEM IN AN OPEN MENU
                                If IsStrExp(bstack, rest$, s$) Then
                                    Form1.List1.list(CLng(p)) = s$
                                Else
                                   MissStringExpr
                                  MyMenu = False
                                End If
                            End If
                            If Not FastSymbol(rest$, ";") Then Form1.List1.ShowThis CLng(p + 1) Else Form1.List1.ShowMe2
                        End If
                Else
                        If Form1.List1.listcount > 0 Then  ' YOU CAN OPEN A MENU WITH A START ITEM OTHER THAN 1
                            If IsStrExp(bstack, rest$, s$) Then
                                p = Form1.List1.Find(s$)
                            ElseIf IsExp(bstack, rest$, p) Then
                                p = p - 1
                            Else
                               SyntaxError
                               MyMenu = False
                            End If
                            If p <> -1 Then
                                If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then  ' CHANGE MENU ITEM IN AN OPEN MENU
                                ' IN A THREAD OR IN A @ VARIANT
                                    If IsStrExp(bstack, rest$, s$) Then
                                        Form1.List1.list(CLng(p)) = s$
                                    Else
                                        MissStringExpr
                                        MyMenu = False
                                    End If
                                Else
                                    If p < Form1.List1.listcount Then Form1.List1.ListIndex = CLng(p)
                                End If
                        End If
                        frm$ = Form1.List1.Tag
                End If
                GoTo ekei
        End If
    ElseIf IsLabelSymbolNew(rest$, "ΠΛΑΙΣΙΟ", "FRAME", Lang) Then
            Form1.List1.BorderStyle = 1 - Abs(IsLabelSymbolNew(rest$, "ΟΧΙ", "OFF", Lang))
    ElseIf IsLabelSymbolNew(rest$, "ΒΑΨΕ", "FILL", Lang) Then
        If IsExp(bstack, rest$, p) Then
        Form1.List1.CapColor = mycolor(p)
        LEVCOLMENU = 1
        If FastSymbol(rest$, ",") Then
            If IsExp(bstack, rest$, p) Then
                   Form1.List1.backcolor = mycolor(p)
                   LEVCOLMENU = 2
                           If FastSymbol(rest$, ",") Then
                                If IsExp(bstack, rest$, p) Then
                                   Form1.List1.ForeColor = mycolor(p)
                                   LEVCOLMENU = 3
                                   Else
                                   MissNumExpr
                                               MyMenu = False
                                   End If
                        End If
            
                   Else
                   MissNumExpr
                               MyMenu = False
                   End If
            End If
     
        Else
        MissNumExpr
                    MyMenu = False
        End If
        ElseIf IsLabelSymbolNew(rest$, "ΤΙΤΛΟΣ", "TITLE", Lang) Then
        If Not IsStrExp(bstack, rest$, s$) Then Exit Function
        If Right$(s$, 2) = vbCrLf Then s$ = Left$(s$, Len(s$) - 2)
        Form1.List1.enabled = Form1.List1.Visible
    
        Form1.List1.HeadLine = s$
        Form1.List1.FloatList = Not IsLabelSymbolNew(rest$, "ΚΡΑΤΗΣΕ", "HOLD", Lang)
        ElseIf IsLabelSymbolNew(rest$, "ΕΠΙΛΕΞΕ", "SELECT", Lang) Then
        '' If Form1.List1.LeaveonChoose Then

         Form1.List1.PressSoft

        '' End If
        Else
If FastSymbol(rest$, "@") Then
    par = True
    If Not IsStrExp(bstack, rest$, s$) Then Exit Function
    frm$ = s$
    If FastSymbol(rest$, "!") Then GoTo ekei
    If Not FastSymbol(rest$, ",") Then Exit Function
    
    Else
    par = False
    End If
    If FastSymbol(rest$, "+") Then
    If Not IsStrExp(bstack, rest$, s$) Then Exit Function

    Form1.List1.additemFast s$
       While FastSymbol(rest$, ",")
    If Not IsStrExp(bstack, rest$, s$) Then MyMenu = False: Exit Function
    Form1.List1.additemFast s$
    Wend
   If Form1.List1.LeaveonChoose Then GoTo ekei Else Exit Function
    
    End If
    If Not FastSymbol(rest$, "!") Then
    If Form1.List1.enabled = True Then
    Form1.List1.Visible = False
    If Not par Then Form1.List1.HeadLine = vbNullString
    End If
    If entrypoint = 2 Then GoTo ekei
    Form1.List1.enabled = False
    
    Form1.List1.Clear

    If Not IsStrExp(bstack, rest$, s$) Then
  bstack.Owner.TabStop = False
    Form1.List1.HeadLine = vbNullString: Form1.KeyPreview = True: Exit Function
    End If
    
    
    Form1.List1.additemFast s$
    If TextWidth(bstack.Owner, s$) > F Then F = TextWidth(bstack.Owner, s$)
    While FastSymbol(rest$, ",")
    If Not IsStrExp(bstack, rest$, s$) Then MyMenu = False: Exit Function
    Form1.List1.additemFast s$
    If TextWidth(bstack.Owner, s$) > F Then F = TextWidth(bstack.Owner, s$)
    Wend
    'f = f \ .xt + 1
    Else
ekei:
    it = Form1.List1.listcount
    F = 0
    If it > 0 Then
    With Form1.List1
            
            For it = it - 1 To 0 Step -1
            If TextWidth(bstack.Owner, .list(it)) > F Then F = TextWidth(bstack.Owner, .list(it))
            
            Next
    End With
    End If
    End If
    
    
    it = Form1.List1.listcount
With players(prive)
If .lastprint Then
x1 = (bstack.Owner.CurrentX + .Xt - dv15) \ .Xt
If x1 < 0 Then x1 = 0
If x1 > .mx Then x1 = .mx - 1
Else
x1 = .curpos

End If
y1 = .currow
If x1 < 0 Then
  x1 = 0
  ElseIf x1 > .mx Then
  x1 = .mx - 1
  Else
  
  ''    GetXYb scr, players(prive), .curpos, .currow
    End If
    F = Int(F / TextWidth(bstack.Owner, "W") + 0.5)
    If it > 0 Then
            If F < 4 Then F = 4  ' 4 chars minimum
            If F > .mx Then F = .mx  ' .mx maximum
            If F + x1 > .mx Then x1 = .mx - F - 1
            If it > .My \ 2 Then it = .My \ 2
            If CLng(.My - y1) < it Then  ' need space above
                If .My - y1 > 2 Then  ' if we have space under
                    it = .My - .currow - 1
                    
                Else  ' no we dont have
                   y1 = .My - it - 1
                
                End If
            End If

            If Not Form1.Visible Then newshow basestack1: MyDoEvents
            bstack.Owner.Refresh
                If Not Form1.List1.Visible Then
                    If Not bstack.Owner.Visible Then bstack.Owner.Visible
                    If bstack.tolayer Then bstack.Owner.ZOrder 0
                End If
                With Form1.List1
            .enabled = True
            .NoPanRight = False
            .NoFreeMoveUpDown = True
            .SingleLineSlide = True
            SetTextBasketBack bstack.Owner, players(prive)
            .overrideTextHeight = fonttest.TextHeight("fj")
            End With
    ListChoise bstack, frm$, x1, y1, F + x1, it + y1 - 1
    INK$ = vbNullString
    ''UINK$ = VbNullString
    MINK$ = vbNullString
    End If
    '------------------------
End With

End If
End Function
Function ProcScreenRes(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double
If IsExp(basestack, rest$, x) Then
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
            ChangeScreenRes CLng(x), CLng(y)
        Else
            
            MissNumExpr
        End If
    Else
        
        SyntaxError
    End If
ElseIf FastSymbol(rest$, "!") Then
    ScreenRestore
Else
    
    MissNumExpr
End If
ProcScreenRes = True
End Function
Function ProcDrop(basestack As basetask, rest$, Lang As Long) As Boolean
Dim x As Double
ProcDrop = True
If Not IsExp(basestack, rest$, x) Then
x = 1
Else
If Not basestack.lastobj Is Nothing Then
If TypeOf basestack.lastobj Is mHandler Then
    If basestack.lastobj.ReadOnly Then
        ReadOnly
        Exit Function
    End If
    If basestack.lastobj.t1 <> 1 Then Exit Function
    If TypeOf basestack.lastobj.objref Is FastCollection Then
        Dim tmp As FastCollection
        Set tmp = basestack.lastobj.objref
        If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", Lang) Then
            If IsExp(basestack, rest$, x) Then
                tmp.drop x + 1
                ProcDrop = True
            Else
                MissNumExpr
            End If
        Else
            FastSymbol rest$, ","  ' optional
            If IsExp(basestack, rest$, x) Then
                tmp.drop tmp.count - x + 1
                ProcDrop = True
            Else
                tmp.drop tmp.count
                ProcDrop = True
            End If
        End If
    End If
End If
Exit Function
End If
End If

If x < 0 Then
     
        MyEr "No many items to drop from stack", "Δεν υπάρχουν τιμές να πετάξω από το σωρό"
Exit Function
End If

If x = 0 Then
    ' do nothing
Else
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    ElseIf x = basestack.soros.Total Then
    basestack.soros.Flush
    Else
    basestack.soros.drop CLng(x)
    End If
    End If

End Function
Function ProcShift(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcShift = True
If Not IsExp(basestack, rest$, x) Then x = basestack.soros.Total
If x <= 0 Then
     
        MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"
Exit Function
End If
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    Else

    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
        y = Int(y)
        If y < 0 Then
        y = Abs(y)
        x = x - 1
        If CLng(x + y) > basestack.soros.count Then y = basestack.soros.count - x
        For i = x + 1 To x + y
        
         basestack.soros.MakeTopItem CLng(i)
      
        Next i
        Else
           'y = y - 1
If CLng(x + y - 1) > basestack.soros.count Then y = basestack.soros.count - x + 1

        For i = y To 1 Step -1
        
         basestack.soros.MakeTopItem CLng(x + y - 1)
      
        Next i

        End If
    End If
    Else
        basestack.soros.MakeTopItem CLng(x)
    End If
    End If


End Function
Function ProcShiftBack(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcShiftBack = True
If Not IsExp(basestack, rest$, x) Then x = basestack.soros.Total
If x <= 0 Then
     
        MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"

Exit Function
End If
If x > basestack.soros.Total Then
MissStackItem

Exit Function
    Else
    
    
        If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, y) Then
        If y < 0 Then
        y = Abs(Int(y))
        x = x - 1
          If CLng(x + y) > basestack.soros.count Then y = basestack.soros.count - x
        For i = y To 2 Step -1
        
         basestack.soros.MakeTopItemBack CLng(i + x)
      
        Next i
        If x > 0 Then basestack.soros.MakeTopItemBack CLng(i + x)
        Else
        y = Int(y)
        If CLng(x + y - 1) > basestack.soros.count Then y = basestack.soros.count - x + 1

        For i = 1 To y
        basestack.soros.MakeTopItemBack CLng(x + y - 1)
        Next i
     
        End If
    End If
    Else
    basestack.soros.MakeTopItemBack CLng(x)
    End If
    End If
End Function
Function ProcOver(basestack As basetask, rest$) As Boolean
Dim x As Double, y As Double, i As Long
ProcOver = True
If Not IsExp(basestack, rest$, x) Then x = 1
    If x <= 0 Then
         
            MyEr "No negatives or zero", "Όχι αρνητικοί ή μηδέν"
    Exit Function
    End If
    If x > basestack.soros.Total Then
        MissStackItem
        
        Exit Function
    Else
        If FastSymbol(rest$, ",") Then
            If IsExp(basestack, rest$, y) Then
            y = Int(y)
                For i = 1 To y
                    basestack.soros.Copy2TopItem CLng(x)
                Next i
            Else
                MissPar
            End If
        Else
            basestack.soros.Copy2TopItem CLng(x)
        End If
    End If

End Function
Function ProcSort(basestack As basetask, rest$, Lang As Long) As Boolean
Dim i As Long, s$, sX As Double, sY As Double, pppp As mArray
Dim x1 As Long, y1 As Long, p As Variant, ML As Long, desc As Boolean, numb As Boolean, useclid As Boolean
ProcSort = False
desc = IsLabelSymbolNew(rest$, "ΦΘΙΝΟΥΣΑ", "DESCENDING", Lang)
If Not desc Then
    useclid = IsLabelSymbolNew(rest$, "ΑΥΞΟΥΣΑ", "ASCENDING", Lang)
Else
    useclid = True
End If
    y1 = Abs(IsLabel(basestack, rest$, s$))
    If y1 = 1 Then
         If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = "mHandler" Then
                        If var(i).ReadOnly Then
                        ReadOnly
                        Exit Function
                        End If
                            If var(i).t1 = 1 Then
                            If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
                                numb = IsLabelSymbolNew(rest$, "ΑΡΙΘΜΟΣ", "NUMBER", Lang, , , , False)
                                If Not numb Then
                                If Not IsLabelSymbolNew(rest$, "ΚΕΙΜΕΝΟ", "TEXT", Lang, , , , False) Then
                                MyEr "Expected Text or Number", "Περίμενα Κείμενο ή Αριθμός"
                                ProcSort = False
                                Exit Function
                                End If
                                End If
                                var(i).objref.NumericSort = numb
                            End If
                            If FastSymbol(rest$, ",") Then
                                If IsExp(basestack, rest$, p) Then
                                With var(i).objref
                                    If useclid Then
                                        .SetBinaryCompare
                                        .useclid = CLng(p)
                                    
                                            If desc Then
                                                .SortDes
                                            Else
                                                .Sort
                                            End If
                                    
                                    ElseIf p <> 0 Then
                                        .useclid = 0
                                        .Sort
                                    Else
                                        .useclid = 0
                                        .SortDes
                                    End If
                                 End With
                                Else
                                    MissPar
                                    Exit Function
                                End If
                                
                            Else
                            With var(i).objref
                                If desc Then
                                 .useclid = 0
                                 .SortDes
                                Else
                                .useclid = 0
                                    .Sort
                                End If
                            End With
                            End If
                            
                            ProcSort = True
                            Else
                            MyEr "Expected Inventory", "Περίμενα Κατάσταση"
                            End If
                Else
                   MyEr "Expected Inventory", "Περίμενα Κατάσταση"
                End If
            Else
                   MissFuncParameterStringVar
            End If
    Exit Function
    ElseIf y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, sX) Then    ' FROM
            If FastSymbol(rest$, ",") Then
            sX = 1
                GoTo sort2
            Else
                MissNumExpr
                Exit Function
            End If
        End If
    Else
 sX = 1
    End If
    
     If FastSymbol(rest$, ",") Then
sort2:
        If Not IsExp(basestack, rest$, p) Then   ' TO
            If FastSymbol(rest$, ",") Then
            x1 = 0
                GoTo sort3
            Else
                MissNumExpr
                Exit Function
            End If
        End If
        x1 = CLng(p)
     Else
        x1 = 0    ' TO THE LAST
    End If
         If FastSymbol(rest$, ",") Then
sort3:
        If Not IsExp(basestack, rest$, sY) Then   ' TO
                        MissNumExpr
                        Exit Function
        End If
        ML = CLng(sY)
     Else
        ML = 1   ' KEYSTART
    End If
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                            If desc Then
                            var(i).SortDocDes ML, CLng(sX), x1
                            Else
                            var(i).SortDoc ML, CLng(sX), x1
                            End If
                            ProcSort = True '*******************************************
                Else
                   MissingDoc
                End If
            Else
                   MissFuncParameterStringVar
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                                If desc Then
                                pppp.item(i).SortDocDes ML, CLng(sX), x1
                                Else
                                pppp.item(i).SortDoc ML, CLng(sX), x1
                                End If
                                ProcSort = True  '*****************************************
                      Else
                                MissingDoc
                      End If
        Else
                    MissPar
        End If

End Function
Function ProcWords(basestack As basetask, rest$) As Boolean
Dim x1 As Long, y1 As Long, s$, sX As Double, i As Long, p As Variant, pppp As mArray
ProcWords = True
    y1 = Abs(IsLabel(basestack, rest$, s$))

    If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, sX) Then    ' FROM
            MissNumExpr
            Exit Function
        End If
    Else
 sX = 1
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                basestack.soros.Begin 1
                var(i).ExportWords2ObjectAddItem basestack.soros, sX <> 0
                var(i).ResetWords
                    
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                   Exit Function
                    
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                        basestack.soros.Begin 1
                         pppp.item(i).ExportWords2ObjectAddItem basestack.soros, sX <> 0
                         pppp.item(i).ResetWords
                      Else
                      MissingDoc
                      Exit Function
                      End If
               
                    
    Else
                    
                MissPar
                Exit Function
    End If

End Function
Function ProcFind(basestack As basetask, rest$) As Boolean
Dim i As Long, s$, pppp As mArray, x1 As Long, y1 As Long
Dim p As Variant, col As Long, frm$, ss$
ProcFind = True
    y1 = Abs(IsLabel(basestack, rest$, s$))
     
        If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                    MissingDoc
                    Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, frm$) Then
        MissStringExpr
        Exit Function
    End If
        ss$ = GetNextLine(frm$)
        SetNextLine frm$
    If frm$ <> "" Then
        MyEr "Search string with line breaks", "Αλφαριθμητικό αναζήτησης με αλλαγές γραμμών"
        Exit Function
    End If
    Else
        MissPar
        Exit Function
    End If
    
     If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then
            MissNumExpr
            Exit Function
        End If
        x1 = CLng(p)
     Else
        x1 = 0
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                
                     x1 = var(i).FindStr(ss$, x1, y1, col)
                     If x1 > 0 Then
                        basestack.soros.PushVal CDbl(col)  ' CHAR IN PARAGRAPH
                        basestack.soros.PushVal CDbl(y1)   'PARAGRAPH ORDER ..NUMBER START FROM 1
                     End If
                        basestack.soros.PushVal CDbl(x1)   ' POSITION IN ALL DOCUMENT
                    
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                    Exit Function
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
          
                        x1 = pppp.item(i).FindStr(ss$, x1, y1, col)
                            If x1 > 0 Then
                               basestack.soros.PushVal CDbl(col)  ' CHAR IN PARAGRAPH
                               basestack.soros.PushVal CDbl(y1)   'PARAGRAPH ORDER ..NUMBER START FROM 1
                            End If
                        basestack.soros.PushVal CDbl(x1)   ' POSITION IN ALL DOCUMENT
                    
              
                        Else
                         MissingDoc
                         Exit Function
                        End If
                    
    Else
                    
                MissPar
                Exit Function
    End If

End Function
Function ProcSaveDoc(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim DUM As Boolean, w$, i As Long, s$, pppp As mArray, ss$, p As Variant
Dim x1 As Long, y1 As Long
If entrypoint = 1 Then DUM = True
    y1 = Abs(IsLabel(basestack, rest$, s$))
         If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                MissingDoc
                Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, w$) Then
        MissStringExpr
        Exit Function
    End If
    ss$ = GetNextLine(w$)
    SetNextLine w$
    If w$ <> "" Then
    MyEr "filename with line breaks", "όνομα αρχείου με αλλαγές γραμμών"
    Exit Function
    End If
    ' check valid name
    If ExtractNameOnly(ss$) = vbNullString Then BadFilename:  Exit Function
    If ExtractPath(ss$) = vbNullString Then
    ss$ = mylcasefILE(mcd + ss$)
    End If
    If ExtractType(ss$) = vbNullString Then ss$ = ss$ + ".txt"
    Else
    MissPar
    Exit Function
    End If
    
     If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then    'type...for saving
        MissNumExpr
        Exit Function
        End If
        x1 = CLng(p)
        If x1 > 500 Then
        
        x1 = 0
        End If
     Else
        x1 = -5 ' ' 2 = utf-8 standard save mode
    End If
    
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then
                         If x1 = -5 Then
                    If var(i).ListLoadedType <> 0 Then
                    x1 = var(i).ListLoadedType
                    Else
                    x1 = 2
                    End If
                    End If
                    If CanKillFile(ss$) Then
                    If x1 = 0 And p <> 0 Then
                    var(i).lcid = CLng(p)
                    x1 = 3
                    End If
                     If Not var(i).SaveUnicodeOrAnsi(ss$, x1, DUM) Then
                       MyEr "can't save " + ss$, "δεν μπορώ να σώσω " + ss$
                      End If
                      Else
                      FilePathNotForUser
                      Exit Function
                      End If
                Else
                    MissingDoc
                    Exit Function
                End If
            Else
                   MissFuncParameterStringVar
                    Exit Function
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                    If x1 = -5 Then
                    If pppp.item(i).ListLoadedType <> 0 Then
                    x1 = pppp.item(i).ListLoadedType
                    Else
                    x1 = 2
                    End If
                    End If
                    If CanKillFile(ss$) Then
                    If x1 = 0 And p <> 0 Then
                    pppp.item(i).lcid = CLng(p)
                    x1 = 3
                    End If
                     If Not pppp.item(i).SaveUnicodeOrAnsi(ss$, x1, DUM) Then
                       MyEr "can't save " + ss$, "δεν μπορώ να σώσω " + ss$
                       Exit Function
                      End If
                      Else
                      FilePathNotForUser
                      Exit Function
                      End If
                        Else
                         MissingDoc
                         Exit Function
                        End If
                    
    Else
                    
                MissPar
                Exit Function
    End If
ProcSaveDoc = True
End Function
Function ProcWin(basestack As basetask, rest$) As Boolean
Dim s$, w$, x1 As Long
If IsSupervisor Then

x1 = Abs(IsLabelFileName(basestack, rest$, s$, , w$))

If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If

If x1 Then
On Error Resume Next

If s$ = ExtractPath$(s$) Then
MyShell "explorer " & Chr(34) + s$ & Chr(34)
Else
If IsSymbol(rest$, ",") Then
x1 = Abs(IsLabelFileName(basestack, rest$, (w$), , w$))
If x1 = 1 Then
If ExtractType(w$) = vbNullString Then w$ = w$ + ".gsb"
If ExtractPath(w$) = vbNullString Then w$ = mcd + w$
Else
rest$ = w$ + rest$
x1 = IsStrExp(basestack, rest$, w$)
End If
If x1 Then

MyShell s$, 1 - 5 * (IsSymbol(rest$, ";")), w$
Else
MissStringExpr
Exit Function
End If
Else
MyShell s$, 1 - 5 * (IsSymbol(rest$, ";"))
End If
End If
'***********************************************
End If
Else
BadCommand
Exit Function
End If
ProcWin = True
End Function
Function ProcDos(basestack As basetask, rest$) As Boolean
Dim s$, w$, x1 As Long, p As Variant
If IsSupervisor Then
On Error Resume Next

x1 = Abs(IsLabelFileName(basestack, rest$, s$, , w$))

If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If
If FastSymbol(rest$, ",") Then
If Not IsExp(basestack, rest$, p) Then MissNumExpr: Exit Function
Else
p = 300
End If
        If x1 Then
        
                    If FastSymbol(rest$, ";") Then
                                Shell "CMD /C " & s$, vbMinimizedNoFocus
                    Else
                                Shell "CMD /K " & s$, vbNormalFocus
                    End If
        Else
                    Shell "CMD", vbNormalFocus
        End If

           MyDoEvents
        Sleep CLng(Abs(p))

Else
BadCommand
Exit Function
End If
ProcDos = True
End Function
Function ProcSpeech(basestack As basetask, rest$) As Boolean
Dim s$, p As Variant, DUM As Boolean
If IsStrExp(basestack, rest$, s$) Then

If FastSymbol(rest$, "#") Then s$ = "<spell>" & s$ & "</spell>"
DUM = FastSymbol(rest$, "!")
If FastSymbol(rest$, ",") Then ' get voice number
If Not IsExp(basestack, rest$, p) Then MissNumExpr:  Exit Function
SPEeCH s$, DUM, CLng(p)
Else
SPEeCH s$, DUM
End If
End If
ProcSpeech = True
End Function
Function ProcPropeties(basestack As basetask, rest$) As Boolean
Dim s$
  If IsStrExp(basestack, rest$, s$) Then
  LoadArray MyDM(), s$
  Else
  SyntaxError
  Exit Function
  End If
ProcPropeties = True
End Function
Function ProcFlush(basestack As basetask, rest$, Lang As Long) As Boolean
Dim pppp As mArray, what$, it As Long, y1 As Long
If IsLabelSymbolNew(rest$, "ΛΑΘΟΣ", "ERROR", Lang) Then
         NOEXECUTION = False
         NERR = False
           LastErNum1 = 0
         LastErNum = 0
            LastErName = vbNullString
            LastErNameGR = vbNullString
ElseIf IsLabelSymbolNew(rest$, "ΣΚΟΥΠΙΔΙΑ", "GARBAGE", Lang) Then
    GarbageFlush2
Else
Do
    y1 = Abs(IsLabel(basestack, rest$, what$))
    If y1 = 0 Then
     If it = 0 Then basestack.soros.Flush
    Else
        If y1 = 3 Then
            If GetVar(basestack, what$, it) Then
                If Typename(var(it)) = doc Then
                    var(it).EmptyDoc
                Else
                      SyntaxError
                        Exit Function
                End If
            Else
                  SyntaxError
                        Exit Function
            End If
        ElseIf y1 = 6 Then
        If neoGetArray(basestack, what$, pppp) Then
        If Not pppp.Arr Then NotArray: Exit Function
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then Exit Function
                         If Typename(pppp.item(it)) = doc Then
                         Set pppp.item(it) = New Document
                         pppp.item(it).EmptyDoc
                         Else
                      SyntaxError
                        Exit Function
                         End If
                 
       Else
       SyntaxError
        Exit Function
       End If
        End If
    End If
    Loop Until Not FastSymbol(rest$, ",")
End If
ProcFlush = True
End Function
Function ProcOpenImage(basestack As basetask, rest$, Lang As Long) As Boolean
Dim pa$, ss$, frm$, s$, w$, Scr As Object, x1 As Long
Dim aaa() As String
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi
 
frm$ = mcd
DialogSetupLang Lang

IsStrExp basestack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then ss$ = pa$
If FastSymbol(rest$, ",") Then If Not IsStrExp(basestack, rest$, w$) Then MissNumExpr:  Exit Function
If TypeOf basestack.Owner Is GuiM2000 Then
Set Scr = basestack.Owner
Else
         If Form1.Visible Then
        Set Scr = Form1
        Else
        Set Scr = Nothing
        End If
End If
If InStr(w$, "|") > 0 Then
If InStr(w$, "(*.") > 0 Then
aaa() = Split(w$, "(*.")
Else
aaa() = Split(w$, "|")
End If
w$ = vbNullString
If UBound(aaa()) > LBound(aaa()) Then
w$ = "|"
For x1 = LBound(aaa()) + 1 To UBound(aaa())
w$ = w$ & UCase(Left$(aaa(x1), InStr(aaa(x1), ")") - 1) & "|")
Next x1
End If
End If
    If OpenImage(basestack, Scr, frm$, s$, ss$, w$) Then
    ' push to stack
    If multifileselection Then
    If ReturnListOfFiles <> "" Then
    aaa() = Split(ReturnListOfFiles, "#")
    If UBound(aaa()) > LBound(aaa()) Then

For x1 = UBound(aaa()) To LBound(aaa()) + 1 Step -1
    basestack.soros.PushStr aaa(x1)
Next x1
basestack.soros.PushVal UBound(aaa()) - LBound(aaa())
basestack.soros.PushStr aaa(x1)
End If
Else
    basestack.soros.PushStr ReturnFile
    End If
    Else
    basestack.soros.PushStr ReturnFile
    End If
    Else
    basestack.soros.PushStr ""
    End If

Set Scr = Nothing
ProcOpenImage = True
End Function
Function ProcOpenFile(basestack As basetask, rest$, Lang As Long) As Boolean
Dim pa$, ss$, frm$, s$, w$, Scr As Object, x1 As Long, p As Variant, par As Boolean, F As Boolean
Dim aaa() As String, DUM As Boolean
If IsSelectorInUse Then
SelectorInUse
Exit Function
End If
olamazi
frm$ = mcd
DialogSetupLang Lang

IsStrExp basestack, rest$, s$
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then frm$ = pa$
If frm$ <> "" Then If Not isdir(frm$) Then NoSuchFolder: Exit Function
If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, pa$) Then ss$ = pa$
par = False
If FastSymbol(rest$, ",") Then If Not IsStrExp(basestack, rest$, w$) Then Exit Function
If FastSymbol(rest$, ",") Then If IsExp(basestack, rest$, p) Then par = p <> 0
If FastSymbol(rest$, ",") Then F = IsExp(basestack, rest$, p) Else p = 0  '' if f is false what???
 DUM = p <> 0
If TypeOf basestack.Owner Is GuiM2000 Then
Set Scr = basestack.Owner
Else
 If Form1.Visible Then
Set Scr = Form1
Else
Set Scr = Nothing
End If
End If
If InStr(w$, "|") > 0 Then
    If InStr(w$, "(*.") > 0 Then
        aaa() = Split(w$, "(*.")
        w$ = vbNullString
        If UBound(aaa()) > LBound(aaa()) Then
            w$ = "|"
            For x1 = LBound(aaa()) + 1 To UBound(aaa())
                w$ = w$ & UCase(Left$(aaa(x1), InStr(aaa(x1), ")") - 1) & "|")
            Next x1
        End If
    Else
        aaa() = Split(w$, "|")
        w$ = vbNullString
        If UBound(aaa()) > LBound(aaa()) Then
            w$ = "|"
            For x1 = LBound(aaa()) To UBound(aaa())
                w$ = w$ & UCase(aaa(x1)) & "|"
            Next x1
        End If
    End If
End If

    If OpenDialog(basestack, Scr, frm$, s$, ss$, w$, Not par, DUM) Then
     If multifileselection Then
        If ReturnListOfFiles <> "" Then
                aaa() = Split(ReturnListOfFiles, "#")
                If UBound(aaa()) > LBound(aaa()) Then
            
                        For x1 = UBound(aaa()) To LBound(aaa()) + 1 Step -1
                            basestack.soros.PushStr aaa(x1)
                        Next x1
                        basestack.soros.PushVal UBound(aaa()) - LBound(aaa())
                        basestack.soros.PushStr aaa(x1)
                 End If
            Else
            
     If isdir(ReturnFile) Then
     basestack.soros.PushStr ""
    Else
    basestack.soros.PushStr ReturnFile
    End If
        End If
    Else
    If isdir(ReturnFile) Then
     basestack.soros.PushStr ""
    Else
    basestack.soros.PushStr ReturnFile
    End If
    End If
    Else
    basestack.soros.PushStr ""
    End If

Set Scr = Nothing
ProcOpenFile = True
End Function
Function ProcUSE(basestack As basetask, rest$, Lang As Long) As Boolean
Dim ss$, ML As Long, x As Double, pa$, s$, stac1$, p As Variant, frm$, i As Long, w$, pppp As mArray
Dim it As Long, what$
If IsStrExp(basestack, rest$, ss$) Then   'gsb
ElseIf Not Abs(IsLabel(basestack, rest$, ss$)) = 1 Then ' WITHOUT " .gsb"
SyntaxError
Exit Function
End If
ML = 0
If UCase(ss$) = "PIPE" Or UCase(ss$) = "ΑΥΛΟΥ" Then
ML = 1
End If

stac1$ = vbNullString
If FastSymbol(rest$, "!") And ML <> 1 Then
If VALIDATEpart(rest$, s$) Then
Do While s$ <> ""
    If ISSTRINGA(s$, pa$) Then
        basestack.soros.DataStr pa$
    ElseIf IsNumberD(s$, x) Then
        basestack.soros.DataVal x
    Else
        Exit Do
    End If
Loop
Else
SyntaxError
Exit Function
End If
Else
If ML <> 1 Then
    Do
        If IsExp(basestack, rest$, p) Then
        stac1$ = stac1$ & Str$(p)
        ElseIf IsStrExp(basestack, rest$, s$) Then
         stac1$ = stac1$ & Sput(s$)
        Else
        Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
    Loop
    pa$ = ExtractPath(ss$)
    para$ = RTrim$(".gsb " & Mid$(ss$, Len(ExtractPath(ss$) + ExtractName(ss$)) + 1))
    If pa$ = vbNullString Then pa$ = mcd
    frm$ = ExtractNameOnly(ss$)
    End If
End If

If Not IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then

w$ = "S" & CStr(Int(Rnd(12) * 100000))

Else

Select Case Abs(IsLabel(basestack, rest$, ss$))

Case 3
    If GetVar(basestack, ss$, i) Then
       w$ = "V" & CStr(i)
       s$ = frm$
       frm$ = var(i)
       var(i) = vbNullString
      Else
     i = globalvar(ss$, "")
             If i <> 0 Then
              w$ = "V" & CStr(i)
              
            var(i) = vbNullString
            End If
                        
     End If
Case 6
   
     If neoGetArray(basestack, ss$, pppp) Then
            If Not NeoGetArrayItem(pppp, basestack, ss$, it, rest$) Then
        MyEr "Not such index for array", "Περίμενα σωστούς δείκτες για πίνακα"
        
        Exit Function
        End If
     Else
     MyEr "Not such array, need to DIM fisrt", "Περίμενα πίνακα, πρέπει να ορίσεις έναν"
: Exit Function
     End If
    
    w$ = "A" & CopyArrayItems(basestack, ss$) + Str(it) ''''''''''εδω για τον νεο πίνακα πρέπει να δώσω το mArray???
    s$ = frm$
    frm$ = pppp.item(it)
    If Typename(pppp.item(it)) = doc Then
    Set pppp.item(it) = New Document
    Else
     pppp.item(it) = vbNullString
    End If
   
    Case Else
    SyntaxError
: Exit Function
   End Select
   If Left$(w$, 1) <> "S" Then

p = GetTaskId + 10000 ' starts from 10000
If Not IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
's$ = validpipename(ss$)

If frm$ <> "" Then

ss$ = frm$
Else

ss$ = "M" & CStr(p)
End If

Thing w$, validpipename(ss$)
sThread CLng(p), 0, ss$, w$
TaskMaster.Message CLng(p), 3, CLng(100)
Exit Function
Else
Select Case Abs(IsLabel(basestack, rest$, what$))
Case 0 ' TAKE A NUMBER
If IsNumberLabel(rest$, what$) Then
frm$ = "S" + Right$("0000" + what$, 5)
p = val(what$)
s$ = frm$
If Left$(w$, 1) = "V" Then var(val(Mid$(w$, 2))) = validpipename(frm$)
Else
MyEr "No number found (5 digits)", "Δεν βρήκα αριθμό (5 ψηφία)"
Exit Function
End If
Case 1
    If GetVar(basestack, what, i) Then
    If var(i) < 10000 Then var(i) = p Else p = var(i)
      Else
      globalvar what, p
                             
     End If
Case 5, 7
   
     If neoGetArray(basestack, what, pppp) Then
        If Not NeoGetArrayItem(pppp, basestack, ss$, it, rest$) Then
        MyEr "Not such index for array", "Περίμενα σωστούς δείκτες για πίνακα"
      
        Exit Function
        End If
     Else
     MyEr "Not such array, need to DIM fisrt", "Περίμενα πίνακα, πρέπει να ορίσεις έναν"
     
      Exit Function
     End If
     If pppp.item(it) < 10000 Then pppp.item(it) = p Else p = pppp.item(it)
    Case Else
    MyEr "Wrong parameter", "Λάθος παράμετρος"
     Exit Function
   End Select
   End If
End If
'ss$ = validpipename("M" & CStr(p))
'stac1$ = Sput(ss$) + stac1$
If frm$ <> "" Then
ss$ = frm$
Else
ss$ = "M" & CStr(p)
End If
frm$ = s$
sThread CLng(p), 0, ss$, w$
TaskMaster.Message CLng(p), 3, CLng(100)
ss$ = validpipename(ss$)
stac1$ = Sput(ss$) + stac1$
ss$ = "M" & CStr(p)
End If
If ML <> 1 Then
If stac1$ = vbNullString And Left$(s$, 1) = "S" Then
s$ = App.path
AddDirSep s$
s$ = s$ & "M2000.EXE "
If Shell(s$ & Chr(34) + pa$ & frm$ & ".gsb" & para$ & Chr(34), vbNormalFocus) > 0 Then
End If
End If
If Left$(w$, 1) = "V" Then
ss$ = GetTag$ & ".gsb"
Else
ss$ = w$ & ".gsb"
End If
i = FreeFile
On Error Resume Next
 If Not NeoUnicodeFile(strTemp + ss$) Then
 MyEr "can't save " + strTemp + ss$, "δεν μπορώ να σώσω " + strTemp + ss$
what$ = vbNullString
 Exit Function
End If

Open GetDosPath(strTemp + ss$) For Output As i
If Err.Number > 0 Then
InternalEror
what$ = vbNullString
Exit Function
End If
If stac1$ <> "" Then

' look for unicode...
Print #i, "STACK !" & stac1$ & ": DIR " & Chr(34) + pa$ & Chr(34) & " : LOAD " & Chr(34) + frm$ & para$ & Chr(34)

Else
Print #i, "DIR " & Chr(34) + pa$ & Chr(34) & " : LOAD " & Chr(34) + frm$ & para$ & Chr(34)

End If
Close i
tempList2delete = Sput(strTemp + ss$) + tempList2delete
s$ = App.path
AddDirSep s$
s$ = s$ & "M2000.EXE "
LastUse = MyShell(s$ & Chr(34) + strTemp + ss$ & Chr(34), vbNormalFocus - 4 * (ML <> 0 Or IsSymbol(rest$, ";")))
Sleep 1
If LastUse <> 0 Then

If ML = 0 Then
If IsSymbol(rest$, ";") Then
Else
'AppActivate LastUse
End If
End If
'killfile strTemp + ss$
End If
End If
ProcUSE = True
End Function
Function ProcRelease(basestack As basetask) As Boolean
' make this for each Guim2000 form also
If basestack.Owner.name = "DIS" Then
Form1.MY_BACK.PaintPicture Form1.DIS.hDC
ElseIf Typename(basestack.Owner) = "GuiM2000" Then
Dim a As GuiM2000
Set a = basestack.Owner
If a.Sizable Then
MyEr "Not for User forms with resize function", "Όχι για φόρμες χρήστη με δυνατότητα αλλαγής μεγέθους"
Else

a.MY_BACK.PaintPicture a.hDC
End If
Set a = Nothing

End If
ProcRelease = True
End Function
Function ProcHold(basestack As basetask) As Boolean
' make this for each Guim2000 form also
If basestack.Owner.name = "DIS" Then
Form1.MY_BACK.ClearUp
If Form1.MY_BACK.Create(Form1.DIS.Width / DXP, Form1.DIS.Height / DYP) Then
Form1.MY_BACK.LoadPictureBlt Form1.DIS.hDC
If Form1.MY_BACK.bitsPerPixel <> 24 Then Conv24 Form1.MY_BACK
End If
ElseIf Typename(basestack.Owner) = "GuiM2000" Then
Dim a As GuiM2000
Set a = basestack.Owner
If a.MY_BACK Is Nothing Then Set a.MY_BACK = New cDIBSection
If a.Sizable Then
MyEr "Not for User forms with resize function", "Όχι για φόρμες χρήστη με δυνατότητα αλλαγής μεγέθους"
Else
With a
.MY_BACK.ClearUp
If .MY_BACK.Create(.Width / DXP, .Height / DYP) Then
.MY_BACK.LoadPictureBlt .hDC
If .MY_BACK.bitsPerPixel <> 24 Then Conv24 .MY_BACK
End If
Set a = Nothing
End With
End If
End If
ProcHold = True
End Function
Function ProcGet(basestack As basetask, rest$) As Boolean
Dim pppp As mArray, it As Long, what$, p As Variant, F As Long, par As Boolean, i As Long, s$, Arr As Boolean
Dim flag As Boolean, myobject As mHandler, PP As Variant
IsSymbol3 rest$, "#"

If IsExp(basestack, rest$, p) Then
    F = CLng(MyMod(p, 512))
     If FKIND(F) = FnoUse Or FKIND(F) = Foutput Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": ProcGet = False: Exit Function
    If Not FastSymbol(rest$, ",") Then GoTo ex123
    Select Case IsLabel(basestack, rest$, what$)
    Case 1  ' check to see if is a handler
    If GetVar(basestack, what$, it) Then
     PP = 0
     If Typename(var(it)) = "mHandler" Then
    
        If var(it).ReadOnly Then
                     ReadOnly
                             GoTo ex123
                     End If
        End If
      Set myobject = var(it)
     
     flag = True
    End If
    par = False
    Case 5  'check for handler
    what$ = Left$(what$, Len(what$) - 1)
    If GetVar(basestack, what$, it) Then
    PP = 0
    If IsExp(basestack, rest$, PP) Then
    ' nothing here
    Arr = True
    End If

    If Not FastSymbol(rest$, ")") Then GoTo ex123
    If Not Typename(var(it)) = "mHandler" Then GoTo ex123
        
           If var(it).ReadOnly Then
                        ReadOnly
                                GoTo ex123
                        End If
        Set myobject = var(it)
        flag = True
    End If
    par = False
    Case 3
       If FKIND(F) <> Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": ProcGet = False: Exit Function
        par = True: If Not GetVar(basestack, what$, it) Then it = globalvar(what$, "")
        
    Case 6
    If FKIND(F) <> Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": ProcGet = False: Exit Function
        par = False: If neoGetArray(basestack, what$, pppp) Then If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then GoTo ex123
    Case Else
        MissingStrVar
        GoTo ex123
    End Select
    
    If FastSymbol(rest$, ",") Then
        If IsExp(basestack, rest$, p) Then
            i = CLng(MyMod(p, 2147483647))
            Seek #F, (i - 1) * FLEN(F) + 1
        ElseIf Not flag Then
            MissNumExpr
            GoTo ex123
        End If
    End If
If flag Then
Dim buf As MemBlock
Dim aa() As Byte
Set buf = myobject.objref
With buf
' pp is offset
If FLEN(F) = 1 Then
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
p = Int(Abs(p))
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, PP) Then
PP = Int(Abs(PP))
If PP = 0 Then GoTo wrong
If .ValidArea(p, CLng(PP)) Then
    .getData F, p, CLng(PP)
Else
GoTo wrong
End If

Else
MissNumExpr
ProcGet = False
GoTo ex123

End If
Else
MissNumExpr
ProcGet = False
GoTo ex123
End If
Else
MissNumExpr
ProcGet = False
GoTo ex123
End If
Else
On Error Resume Next
.getData F, .GetBytePtr(0), .SizeByte
End If

Else
If Arr Then
    p = 1
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then
                MissNumExpr
                GoTo ex123
        End If
    End If
    p = Int(Abs(p))
    If p = 0 Then GoTo wrong
        If .ValidArea2(PP, FLEN(F) * p) Then
            .getData F, .GetPtr(PP), FLEN(F) * p
        Else
wrong:
            MyEr "Wrong size-position for loading the buffer", "Λάθος μέγεθος-θέση για να φορτωθεί η Διάρθρωση"
            GoTo ex123
        
        End If
    Else
        .getData F, .GetPtr(0), .SizeByte
    End If
End If
End With
Else
        s$ = Space(FLEN(F) \ 2)
        getUniString F, s$  '
        If Not uni(F) Then
        s$ = StrConv(s$, vbUnicode)
        End If
        If par Then
        CheckVar var(it), s$
        Else
        If Typename(pppp.item(it)) = doc Then
            Set pppp.item(it) = New Document
            If s$ <> "" Then pppp.item(it).textDoc = s$
            Else
            pppp.item(it) = s$
            End If
        End If
End If
        End If
ProcGet = True
ex123:
Set pppp = Nothing
Set myobject = Nothing
Set basestack.lastobj = Nothing
End Function
Function ProcPipe(basestack As basetask, rest$) As Boolean
Dim stac1$, ss$, p As Variant, s$
If IsStrExp(basestack, rest$, ss$) Then
If FastSymbol(rest$, ",") Then
stac1$ = vbNullString
Do
If IsExp(basestack, rest$, p) Then
stac1$ = stac1$ & " " & Trim$(Str$(p))
ElseIf IsStrExp(basestack, rest$, s$) Then
stac1$ = stac1$ & Sput(s$)
Else
Exit Do
End If
If Not FastSymbol(rest$, ",") Then Exit Do
Loop

If VALIDATE(stac1$, "", s$) Then
ProcPipe = Trans2pipe(ss$, Sput(ss$) + Sput(s$) + stac1$)
Exit Function
End If
End If
End If
ProcPipe = True

End Function
Function ProcJoypad(basestack As basetask, rest$) As Boolean
Dim p As Variant
        If IsExp(basestack, rest$, p) Then
        If Not StartJoypadk(MyRound(p)) Then
        ' ERROR
        MyEr "Joypad " & CStr(p) & " not exist", "η λαβή " & CStr(p) & " δεν υπάρχει"
        
        Exit Function
        End If
        While FastSymbol(rest$, ",")
        
         If IsExp(basestack, rest$, p) Then
        If Not StartJoypadk(MyRound(p)) Then
        MyEr "Joypad " & CStr(p) & " not exist", "η λαβή " & CStr(p) & " δεν υπάρχει"
        
        Exit Function

        End If
        Else
        MyEr "Joypad Number?", "Αριθμός Λαβής?"
        
        Exit Function

        End If
        Wend
        
        Else
        FlushJoyAll
        End If
ProcJoypad = True
End Function
Function ProcKeyboard(basestack As basetask, rest$) As Boolean
Dim par As Boolean, s$, p As Variant
If FastSymbol(rest$, "!") Then
    MyShell "osk.exe"
Else
    par = True
    Do
        If par = False Then Exit Do
        If IsExp(basestack, rest$, p) Then
            MKEY$ = MKEY$ & ChrW$(MyRound(p) And &HFFFF)
            par = False
        ElseIf IsStrExp(basestack, rest$, s$) Then
        MKEY$ = MKEY$ & s$
        par = False
        Else
        Exit Do
        End If
        If Not FastSymbol(rest$, ",") Then Exit Do
        par = True
    Loop
End If
ProcKeyboard = True
End Function
Function ProcSoundRec(basestack As basetask, rest$, Lang As Long) As Boolean
' not tested yet...
Dim s$, p As Variant, ss$, x As Double, y As Double
    If IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", Lang) Then
    Set sRec = New RecordMci
    sRec.Rec_Initialize
    If IsStrExp(basestack, rest$, s$) Then
    
    sRec.FileName = s$
    End If
    If FastSymbol(rest$, ",") Then
    If IsExp(basestack, rest$, p) Then
    ' hz
        If IsLabelSymbolLatin(rest$, "STEREO") Then
        sRec.Stereo
        Else
        sRec.Mono
        End If
        If IsLabelSymbolLatin(rest$, "HIFI") Then
        sRec.Bit16
        Else
        sRec.Bit8
        End If
        sRec.QualityAny p
    End If
    Else
        sRec.RecFast
    End If
    ElseIf Not (sRec Is Nothing) Then
    ss$ = vbNullString
    If IsLabelSymbolNewExp(rest$, "ΕΙΣΑΓΩΓΗ", "INSERT", Lang, ss$) Then
        sRec.Capture True
    ElseIf IsLabelSymbolNewExp(rest$, "ΑΛΛΑΓΗ", "OVERWRITE", Lang, ss$) Then
        sRec.ReCapture
    ElseIf IsLabelSymbolNewExp(rest$, "ΑΠΟΚΟΠΗ", "DELETE", Lang, ss$) Then
            If IsExp(basestack, rest$, x) Then
            Else
                x = 0
            End If
            If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", Lang) Then
                If Not IsExp(basestack, rest$, y) Then
                    y = sRec.getLengthInMS
                End If
            Else
                y = sRec.getLengthInMS
            End If
            sRec.CutRecordMs x, y
    ElseIf IsLabelSymbolNewExp(rest$, "STOP", "ΔΙΑΚΟΠΗ", Lang, ss$) Then
        sRec.recStop
    ElseIf IsLabelSymbolNewExp(rest$, "ΔΟΚΙΜΗ", "TEST", Lang, ss$) Then
        sRec.recPlay
    ElseIf IsLabelSymbolNewExp(rest$, "ΘΕΣΗ", "POS", Lang, ss$) Then
        If sRec.isRecPlaying Then
            If IsExp(basestack, rest$, x) Then
            sRec.recPlayFromMs x
            Else
            sRec.recPlay
            End If
        Else
        ' SEEK
            If IsExp(basestack, rest$, x) Then
            sRec.oneMCI "seek capture to " & CStr(CLng(x))
            Else
            sRec.oneMCI "seek capture to 0"
            End If
        End If
    ElseIf IsLabelSymbolNewExp(rest$, "ΣΩΣΕ", "SAVE", Lang, ss$) Then
        If IsStrExp(basestack, rest$, s$) Then
            sRec.SaveAs s$
        Else
            sRec.Save
        End If
    ElseIf IsLabelSymbolNewExp(rest$, "ΚΛΕΙΣΕ", "END", Lang, ss$) Then
        Set sRec = Nothing
    End If
    Else
        
        MyEr "You don't have new recording", "Δεν έχεις ετοιμάσει νέα ηχογράφηση"
    End If
  ProcSoundRec = True
End Function
Function ProcLoadDoc(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim DUM As Boolean, pppp As mArray, s$, i As Long, x1 As Long, y1 As Long, frm$, ss$
ProcLoadDoc = True
If entrypoint = 1 Then DUM = True
      y1 = Abs(IsLabel(basestack, rest$, s$))

        If y1 = 6 Then
                If neoGetArray(basestack, s$, pppp) Then
                    If Not NeoGetArrayItem(pppp, basestack, s$, i, rest$) Then Exit Function
                Else
                    MissingDoc
                    Exit Function
                End If
    End If
    If FastSymbol(rest$, ",") Then
    If Not IsStrExp(basestack, rest$, frm$) Then
    MissStringExpr
    
    Exit Function
    End If
    ss$ = GetNextLine(frm$)
    SetNextLine frm$
    If frm$ <> "" Then
    MyEr "filename with line breaks", "όνομα αρχείου με αλλαγές γραμμών"
    
    End If
    ' check valid name
    If ExtractNameOnly(ss$) = vbNullString Then BadFilename:  Exit Function
    If ExtractPath(ss$) = vbNullString Then
    ss$ = mylcasefILE(mcd + ss$)
    End If
    If ExtractType(ss$) = vbNullString Then ss$ = ss$ + ".txt"
    Else
    
    MissPar
    Exit Function
    End If
    
   
        If y1 = 3 Then
            If GetVar(basestack, s$, i) Then
                If Typename(var(i)) = doc Then

                x1 = 2
                On Error Resume Next
                If FastSymbol(rest$, ",") Then
                Dim p As Variant
                If IsExp(basestack, rest$, p) Then
                var(i).lcid = CLng(p)
                End If
                End If
            If basestack.Owner.name = "GuiM2000" Then
                Set basestack.Owner.mDoc = var(i)
                var(i).ReadUnicodeOrANSI ss$, DUM, x1
                Set basestack.Owner.mDoc = Nothing
            Else
                var(i).ReadUnicodeOrANSI ss$, DUM, x1
                End If
                If Err.Number > 0 Then Err.Clear: Exit Function
                 var(i).ListLoadedType = x1
                 Exit Function
                Else
                    MissingDoc
                    
                End If
            Else
                   MissFuncParameterStringVar
                    
            End If
        ElseIf y1 = 6 Then
                    If Typename(pppp.item(i)) = doc Then
                                    x1 = 2
                pppp.item(i).ReadUnicodeOrANSI ss$, DUM, x1
                 pppp.item(i).ListLoadedType = x1
                    
                        Else
                         MissingDoc
                         
                        End If
    Else
                MissPar
    End If
End Function
Function ProcRecursionLimit(basestack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, prive As Long
ProcRecursionLimit = True
If IsExp(basestack, rest$, p) Then
deep = Abs(MyRound(p))
If IsSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then funcdeep = Abs(MyRound(p))  ' obsolate
End If
ElseIf IsSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then funcdeep = Abs(MyRound(p)) ' obsolate
Else
prive = GetCode(basestack.Owner)
    If deep = 0 Then
            If Lang = 1 Then
            PlainBaSket basestack.Owner, players(prive), "NO RECURSION LIMIT FOR SUBRUTINES"
            Else
            PlainBaSket basestack.Owner, players(prive), "ΧΩΡΙΣ ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΡΟΥΤΙΝΕΣ"
            End If
            
    Else
    If Lang = 1 Then
        PlainBaSket basestack.Owner, players(prive), "RECURSION LIMIT FOR SUBRUTINES " + CStr(deep)
         crNew basestack, players(prive)
         If m_bInIDE Then
         PlainBaSket basestack.Owner, players(prive), "RECURSION LIMIT FOR FUNCTIONS " + CStr(stacksize \ 2948 - 1)
         Else
        PlainBaSket basestack.Owner, players(prive), "RECURSION LIMIT FOR FUNCTIONS " + CStr(stacksize \ 9832 - 1)
        End If
    Else
        PlainBaSket basestack.Owner, players(prive), "ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΡΟΥΤΙΝΕΣ " + CStr(deep)
         crNew basestack, players(prive)
          If m_bInIDE Then
          PlainBaSket basestack.Owner, players(prive), "ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΣΥΝΑΡΤΗΣΕΙΣ " + CStr(stacksize \ 2948 - 1)
          Else
        PlainBaSket basestack.Owner, players(prive), "ΟΡΙΟ ΑΝΑΔΡΟΜΗΣ ΣΤΙΣ ΣΥΝΑΡΤΗΣΕΙΣ " + CStr(stacksize \ 9832 - 1)
        End If
    End If
    End If
      '  PlainBaSket basestack.Owner, players(prive), CStr(deep)
    crNew basestack, players(prive)
End If
If funcdeep < 128 Then funcdeep = 128
If funcdeep > 3260 Then funcdeep = 3260
End Function
Function ProcSalata(entrypoint As Long, basestack As basetask, rest$) As Boolean
Dim p As Variant, Scr As Object, prive As Long, s$
ProcSalata = True
On entrypoint GoTo charset, codepage, Locale
Exit Function
charset:
If IsExp(basestack, rest$, p) Then
On Error Resume Next
chr11:
    Set Scr = basestack.Owner
    prive = GetCode(Scr)
    Scr.Font.charset = CInt(p)
    Form1.TEXT1.Font.charset = Scr.Font.charset
    Form1.List1.Font.charset = Scr.Font.charset
      StoreFont Scr.Font.name, players(prive).SZ, Scr.Font.charset
      players(prive).charset = Scr.Font.charset
          Set Scr = Nothing
End If
Exit Function
codepage:
        If IsExp(basestack, rest$, p) Then
        ' usercodepage for use compare.
        ' also change to form.
        On Error Resume Next
CHR222:
        UserCodePage = p
        p = GetCharSet(CLng(p))
        
        GoTo chr11
        End If
Exit Function
Locale:
    On Error Resume Next
    If IsExp(basestack, rest$, p) Then
    cLid = CLng(p)
    If cLid = 1032 Then
    DefBooleanString = ";Αληθές;Ψευδές"
    Else
    DefBooleanString = ";T\r\u\e;F\a\l\s\e"
    End If
    OverideDec = True
    NoUseDec = False
    NowDec$ = GetlocaleString(LOCALE_SDECIMAL)
    NowThou$ = GetlocaleString(LOCALE_STHOUSAND)
    p = GetCodePage(CLng(p))
    GoTo CHR222
    ElseIf IsStrExp(basestack, rest$, s$) Then
    ' format$ for true/false values
    If s$ = "" Then DefBooleanString = ";T\r\u\e;F\a\l\s\e" Else DefBooleanString = s$
    End If
End Function
Function ProcGroup(entrypoint As Long, basestack As basetask, rest$, Lang As Long) As Boolean
Dim s$, x1 As Long, y1 As Long, what$, flag As Boolean, ss$, i As Long, par As Boolean
Dim p As Variant, HasStrName As Boolean, strName$
ProcGroup = True

If entrypoint = 1 Then flag = True
Dim y3 As Long
y3 = IsLabelSymbolNew(rest$, "ΜΕΓΕΓΟΝΟΤΑ", "WITHEVENTS", Lang)
If IsLabelSymbolNew(rest$, "ΑΥΤΟ", "THIS", Lang) Then
    If basestack.UseGroupname <> "" Then
        MyEr "Not in a Group Definition: Remove Group This { }", "Όχι σε ορισμό ομάδας: Αφαίρεσε την Ομάδα Αυτό {} "
        Exit Function
    Else
    s$ = ""
' s$ = "."
     If basestack.GetDotNew(s$, 1) Then
 
            If Len(s$) = 0 Then: Exit Function '' why

            what$ = Left$(s$, Len(s$) - 1)
            x1 = 1
        Else
            MyEr "Used in a For statement, For Group { this= or =this }", "Χρησιμοποιείται εντός ενός ΓΙΑ ομάδα { αυτό= ή =αυτό} "
            Exit Function
        End If
    End If
Else
    x1 = Abs(IsLabel(basestack, rest$, what$))
End If
again:
If x1 = 3 Then
HasStrName = True
strName$ = what$
what$ = Left$(what$, Len(what$) - 1)
x1 = 1
End If
If x1 = 1 Then
    If IsLabelSymbolNew(rest$, "ΤΥΠΟΣ", "TYPE", Lang) Then
        If IsStrExp(basestack, rest$, ss$) Then
            s$ = basestack.GroupName
            prepareGroup basestack, what$, y1, flag, HasStrName
            var(y1).IamGlobal = flag
            ProcGroup = ExecuteGroupStruct(basestack, basestack.GroupName & what$, y1, ss$, Lang) <> 0
            basestack.GroupName = s$
        End If
        
    Else
        par = Not FastSymbol(rest$, "+")
        If FastSymbol(rest$, "{") Then
            If par Then
            '' GROUP
                s$ = basestack.GroupName
                
                prepareGroup basestack, what$, y1, flag, HasStrName

                var(y1).IamGlobal = flag
                
                If flag Then ss$ = here$: here$ = vbNullString
                
                If ExecuteGroupStruct(basestack, basestack.GroupName & what$, y1, rest$, Lang, flag) = 0 Then
                    If flag Then here$ = ss$
                    var(y1).edittag = "'11001EDIT " + here$ + ", " + CStr(Len(rest$))
                End If
                If flag Then here$ = ss$
                ProcGroup = FastSymbol(rest$, "}")
            var(y1).FlushEvents
                  If y3 = -1 Then
          On Error Resume Next
            
            MakeThunk what$, var(y1)
        
        
        End If
                
            Else
            '' CLASS
                    ss$ = block(rest$)
                    s$ = basestack.GroupName
                    
                    prepareGroup basestack, what$, y1, flag, HasStrName
                    var(y1).IamGlobal = flag
                    If ExecuteGroupStruct(basestack, basestack.GroupName & what$, y1, ss$, Lang, flag) = 0 Then
                       rest$ = ss$ + rest$
                    Else
                        ProcGroup = FastSymbol(rest$, "}")
                    End If
            End If
            basestack.GroupName = s$
            If var(y1).IamApointer Then
            Set var(y1) = CopyGroup0Obj(var(y1), p)
            
            PopStage basestack
            End If
       Else
            If GetVar(basestack, basestack.GroupName & what$, i, flag) Then
            ProcGroup = True
            Else
contthere:
                i = globalvar(basestack.GroupName & what$, CLng(0), False, flag)
                Set var(i) = New Group
                var(i).IamGlobal = flag
                If FastSymbol(rest$, "=") Then
                    If IsExp(basestack, rest$, p) Then
                        If Not basestack.lastobj Is Nothing Then
                            If Typename(basestack.lastobj) = "Group" Then
                                If basestack.lastobj.IamApointer Then
     
                                    If basestack.lastobj.link.IamFloatGroup Then
                                    Set basestack.lastobj = basestack.lastobj.link
                                    Else
                                    Dim ohere$, w2 As Long
                            
                                    ohere$ = here$
                                        here$ = basestack.lastobj.lasthere
                                        If GetVar(basestack, basestack.lastobj.GroupName, w2, , , True) Then
                                        
                                        CopyGroup2 var(w2), basestack
                                        End If
                                    here$ = ohere$
   
                                    End If
                                    Set basestack.lastpointer = Nothing
                                End If
                               
                                UnFloatGroup basestack, basestack.GroupName & what$, i, basestack.lastobj, flag
                               Set basestack.lastobj = Nothing
                            End If
                        End If
                    End If
                    var(i).FlushEvents
                    If y3 = -1 Then
                    On Error Resume Next
                    MakeThunk what$, var(i)
                    End If
                ElseIf FastSymbol(rest$, "->", , 2) Then
                    If y3 = -1 Then
                    If IsExp(basestack, rest$, p) Then
                        If Not basestack.lastobj Is Nothing Then
                            If Typename(basestack.lastobj) = "Group" Then
                                
                               
                                UnFloatGroup basestack, basestack.GroupName & what$, i, basestack.lastobj, flag
                               Set basestack.lastobj = Nothing
                            End If
                        End If
                    End If
                    var(i).ResetEvents
                    On Error Resume Next
                    MakeThunk what$, var(i)
                    Else
                    MyEr "Used only with Group WithEvents", "Χρησιμοποιείται μόνο με την Ομάδα ΜεΓεγονότα"
                    ProcGroup = False
                    End If
                    
                ElseIf entrypoint = 99 Then

                                var(i).IamGlobal = True
                                UnFloatGroup basestack, basestack.GroupName & what$, i, basestack.lastobj, True
  

                                Set basestack.lastobj = Nothing
                ElseIf entrypoint = 100 Then
                          If basestack.lastobj.IamApointer Then
                          If Not basestack.lastobj.link.IamFloatGroup Then
                          CopyPointerRef basestack, basestack.lastobj
                          End If
                          End If
                                UnFloatGroup basestack, basestack.GroupName & what$, i, basestack.lastobj, here$ = vbNullString
                            
                                Set basestack.lastobj = Nothing
                Else
                             var(i).GroupName = what$ + "."
                             If FastSymbol(rest$, ",") Then
                             x1 = Abs(IsLabel(basestack, rest$, what$))
                            If x1 = 1 Or x1 = 3 Then GoTo again
                            SyntaxError
                            ProcGroup = False
                            Exit Function
                            End If
                End If
            
                Exit Function
            End If
      
        End If
        
    End If
End If
  
End Function
Sub MakeThunk(where$, ThisGroup As Variant)
Dim EventObj As FastCollection, m As Group
Set m = ThisGroup
Set EventObj = m.Events
If EventObj Is Nothing Then Exit Sub
Dim i As Long, j As Long, part$
If here$ <> "" Then where$ = here$ + "." + where$
With EventObj
    For i = 0 To .count - 1
    .index = i
    .Done = True
        If .Value = vbNullString Then
        .Value = where$ + "_" + .KeyToString + "()"
        .sValue = ModuleSub(.Value, "")
    End If
    Next i
    .Done = False
End With
End Sub
Function MyModule(basestack As basetask, rest$, Lang As Long, Optional noskipcommand = False, Optional MakeNew As Boolean) As Boolean
Dim s$, pa$, ss$, x1 As Long, par As Boolean, what$, ohere$, i As Long, X3 As Long, frm$
ohere$ = here$
MyModule = True
x1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΟ", "GLOBAL", Lang)
        par = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", Lang)
If x1 <> 0 Then
        If MaybeIsSymbol(rest$, Chr(34)) Then
                ISSTRINGA rest$, what$
                GoTo BYPASS1
        End If
End If
X3 = IsLabelF(rest$, what$)
If X3 = 1 Then
If Right$(what$, 1) = "(" Then
If FastSymbol(rest$, ")") Then what$ = what$ + ")"
End If

        If x1 Then
BYPASS1:

                If Not GetGlobalSubAfterHere(basestack, what$, x1) Then
                    If noskipcommand Then
                        x1 = ModuleSub(what$, "")
                    Else
                        x1 = GlobalSub(what$, "", , what$)
                    End If
                    basestack.IndexSub = x1
                End If
                If FastSymbol(rest$, "(") Then
                                frm$ = BlockParam(rest$)
                             If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                            If Not FastSymbol(rest$, ")") Then
                       
                            
                            End If
                           frm$ = Trim$(frm$)

                        End If
                        
                If FastSymbol(rest$, "{") Then
                ss$ = block(rest$)
                
                i = Len(rest$)
                
                'If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                If Left$(sbf(Abs(basestack.OriginalCode)).sb, 10) = "'11001EDIT" Then
                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                s$ = vbNullString
                        Else
                                pa$ = sbf(Abs(basestack.OriginalCode)).sb
                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                            s$ = GetNextLine(pa$) & "-" & CStr(i) + vbCrLf
                                End If
                        End If
                Else
                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                If here$ = "" Then
                                ElseIf basestack.OriginalCode > 0 And Not basestack.LoadOnly Then
                                s$ = "'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i - 2) + vbCrLf
                                End If
                        End If
                End If
                            If frm$ <> "" Then
                                If Lang = 1 Then
                                s$ = s$ + vbCrLf + "Read " + frm$ + vbCrLf
                                Else
                                s$ = s$ + vbCrLf + "Διάβασε " + frm$ + vbCrLf
                                End If
                                End If
                
                 sbf(x1).sb = s$ + ss$: basestack.IndexSub = x1
                 Set sbf(x1).subs = Nothing
                         If Not FastSymbol(rest$, "}") Then MyModule = False
                        
                Else
                        MyEr what$ & " missing definition", what$ & " λείπει ο ορισμός"
                End If
                Exit Function
        Else
          If par Then
                If noskipcommand Then
                    x1 = ModuleSub(what$, "")
                Else
                    x1 = GlobalSub(what$, "", , what$)
                End If
                GoTo JUMP0
                ElseIf here$ = vbNullString And GetSub(what$, x1) And Not MakeNew Then
JUMP0:
                        If x1 >= lckfrm And lckfrm <> 0 Then
                                MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                rest$ = vbNullString
                                MyModule = False: Exit Function
                        End If
                        If FastSymbol(rest$, "{") Then
                            what$ = block(rest$)
                        If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                   If Not FastSymbol(rest$, "}") Then
                                           MyModule = False
                                      Else
                                     ' Call preProcessor(basestack, what$)
                                    If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                            sbf(x1).Changed = True
                                            sbf(x1).sb = what$: basestack.IndexSub = x1
                                            Set sbf(x1).subs = Nothing
                                End If
                               
                                        
                        Else
                                rest$ = ":" & what$ & " " & rest$      ''why
                        End If
                        Exit Function
                ElseIf GetlocalSub(basestack.GroupName & what$, x1) And Not MakeNew Then
                 
                 If FastSymbol(rest$, "(") Then
                                frm$ = BlockParam(rest$)
                             If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                            If Not FastSymbol(rest$, ")") Then
                       
                            
                            End If
                           frm$ = Trim$(frm$)

                        End If
                        If FastSymbol(rest$, "{") Then
                       ' If basestack.OriginalCode > x1 Then
                        ' we have collision so we need a new one
                        'If sbf(Abs(basestack.OriginalCode)).sbgroup <> sbf(x1).sbgroup Then
                       ' GoTo jumpheretoo
                        'End If
                       ' End If
                        If x1 >= lckfrm And lckfrm <> 0 Then
                                MyEr what$ & " is locked", what$ & " είναι κλειδωμένο"
                                rest$ = vbNullString
                                MyModule = False: Exit Function
                        End If
                                i = Len(rest$) ''
                                what$ = block(rest$) + " "
                                ' here for locked
                                If Not sbf(x1).locked Then
                                While Left$(what$, 10) = "'11001EDIT"
                                        SetNextLine what$
                                Wend
                                If Right$(what$, 2) <> vbCrLf Then what$ = what$ + vbCrLf
                                s$ = "'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i - 2)
                                  If frm$ <> "" Then
                                If Lang = 1 Then
                                what$ = s$ + vbCrLf + "Read " + frm$ + vbCrLf + what$
                                Else
                                what$ = s$ + vbCrLf + "Διάβασε " + frm$ + vbCrLf + what$
                                End If
                                Else
                                what$ = s$ + vbCrLf + what$
                                End If
                                If Not FastSymbol(rest$, "}") Then
                                        MyModule = False
                                Else
                                ' Call preProcessor(basestack, what$)
                                sbf(x1).Changed = True
                                sbf(x1).sb = what$
                                basestack.IndexSub = x1
                                Set sbf(x1).subs = Nothing
                                
                                End If
                                Else
                                If Not FastSymbol(rest$, "}") Then
                                        MyModule = False
                                Else
                                      basestack.IndexSub = x1
                                End If
                                End If
                        Else
                                rest$ = ":" & basestack.GroupName & what$ & " " & rest$
                        End If
                        Exit Function
                        ElseIf FastSymbol(rest$, "(") Then
                            frm$ = BlockParam(rest$)
                             If frm$ <> "" Then Mid$(rest$, 1, Len(frm$)) = Space$(Len(frm$)) ': If InStr(frm$, "=") > 0 Then frm$ = "? " + frm$
                            If Not FastSymbol(rest$, ")") Then
                            End If
                            frm$ = Trim$(frm$)
                            If FastSymbol(rest$, "{") Then GoTo jumpheretoo
                ElseIf FastSymbol(rest$, "{") Then
jumpheretoo:
                        If here$ = vbNullString Then
                                pa$ = block(rest$)
                                ' Call preProcessor(basestack, pa$)
                                If frm$ <> "" Then pa$ = "READ " + frm$ + vbCrLf + pa$
                                If Right$(pa$, 2) <> vbCrLf Then pa$ = pa$ + vbCrLf
                                
                                If noskipcommand Then
                                    basestack.IndexSub = ModuleSub(what$, pa$)
                                Else
                                    basestack.IndexSub = GlobalSub(what$, pa$, , what$)
                                End If
                        Else
                                ss$ = block(rest$)
                                ' Call preProcessor(basestack, ss$)
                                i = Len(rest$)
                              '  If Right$(ss$, 2) <> vbCrLf Then ss$ = ss$ + vbCrLf
                                If Left$(sbf(Abs(basestack.OriginalCode)).sb, 10) = "'11001EDIT" Then
                                        If InStr(here$, ChrW(&H1FFF)) > 0 Then
                                                s$ = vbNullString
                                        Else
                                                pa$ = sbf(Abs(basestack.OriginalCode)).sb
                                                If Not Left$(ss$, 10) = "'11001EDIT" Then
                                                            s$ = GetNextLine(pa$) & "-" & CStr(i) + IIf(Right$(ss$, 2) <> vbCrLf, vbCrLf, "")
                                                End If
                                        End If
                                ElseIf Not basestack.LoadOnly Then
                                        If Left$(ss$, 10) <> "'11001EDIT" Then
                                                s$ = "'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i - 2) + IIf(Right$(ss$, 2) <> vbCrLf, vbCrLf, "")
                                        End If
                                End If
                                If frm$ <> "" Then
                                If Lang = 1 Then
                                s$ = s$ + vbCrLf + "Read " + frm$ + vbCrLf
                                Else
                                s$ = s$ + vbCrLf + "Διάβασε " + frm$ + vbCrLf
                                End If
                                End If
                                If noskipcommand Then
                                    If basestack.GroupName = vbNullString Then
                                        basestack.IndexSub = ModuleSub(here$ & "." & what$, s$ + ss$)
                                    Else
                                        basestack.IndexSub = ModuleSub(here$ & "." & basestack.GroupName & what$, s$ + ss$)
                                    End If
                                Else
                                    If basestack.GroupName = vbNullString Then
                                        basestack.IndexSub = GlobalSub(here$ & "." & what$, s$ + ss$, , what$)
                                    Else
                                        basestack.IndexSub = ModuleSub(here$ & "." & basestack.GroupName & what$, s$ + ss$)
                                    End If
                                End If
                        End If
                        If Not FastSymbol(rest$, "}") Then MyModule = False
                        Exit Function
                Else
                If basestack.StaticCollection Is Nothing Then ConnectStatic basestack, myUcase(what$)
                   basestack.connectnow = True
                        here$ = what$
                End If
        End If
Else
        If what$ <> "" Then rest$ = what$ & " :" & rest$
        If IsStrExp(basestack, rest$, s$) Then
         
                If basestack.StaticCollection Is Nothing Then ConnectStatic basestack, myUcase(s$)
                 basestack.connectnow = True
                here$ = myUcase(s$)
        Else
                rest$ = what$ & " " & rest$
                MyModule = False
        End If
End If
End Function
Function MyEscape(rest$, Lang As Long) As Boolean
MyEscape = True
If Lang = 1 Then
If IsLabelSymbolLatin(rest$, "ON") Then
escok = True
ElseIf IsLabelSymbolLatin(rest$, "OFF") Then
escok = False
Else
MyEscape = False
End If
Else
If IsLabelSymbol(rest$, "ΝΑΙ") Then
escok = True
ElseIf IsLabelSymbol(rest$, "ΟΧΙ") Then
escok = False
Else
MyEscape = False
End If
End If
End Function
Private Function GetObjFromHandler(vv As Object, ok As Boolean) As Object
Dim mh As mHandler, vIndex As Long
If TypeOf vv Is mHandler Then
    Set mh = vv
    If mh.indirect >= 0 Then
    vIndex = mh.indirect
    If var2used < mh.indirect Then
    MyEr "weak reference  out of scope", "η αναφορά είναι εκτός σκοπού"
    ok = False
    Exit Function
    End If
    
    Set GetObjFromHandler = var(mh.indirect)
    ok = True
    Else
    Set GetObjFromHandler = mh.objref
    ok = True
    End If
End If
End Function
Function MyIcon(basestack As basetask, rest$) As Boolean
Dim s$, aPic As StdPicture, p, anyObj As Object, ok As Boolean
On Error Resume Next

    If IsStrExp(basestack, rest$, s$) Then
        If CFname$(s$) <> "" Then
        
       s$ = CFname$(s$)
        Set aPic = LoadPicture(GetDosPath(s$))
        If aPic Is Nothing Then Exit Function
             ok = True
        End If
    ElseIf IsExp(basestack, rest$, p) Then
    If TypeOf basestack.lastobj Is mHandler Then
            anyObj = GetObjFromHandler(basestack.lastobj, ok)
            If ok Then
                Set aPic = anyObj
                MyIcon = True
            Else
            MyEr "No icon find", "Δεν βρήκα εικόνα"
                Exit Function
            End If
        Else
            Set aPic = Form2.Icon
            End If
    Else
            Set aPic = Form2.Icon
    End If
    If Not UseMe Is Nothing Then
        PlaceIcon aPic
        Else
        Set Form3.Icon = aPic
    End If
    Set Form1.Icon = aPic
    MyIcon = ok
End Function
Function ProcTitle(basestack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, s$
If IsStrExp(basestack, rest$, s$) Then
    
If FastSymbol(rest$, ",") Then

    If IsExp(basestack, rest$, p) Then
        
        If p = 0 Then
            If s$ = "" And Not UseMe Is Nothing Then
                UseMe.Hide
'                Form1.CaptionW = "M2000"
            Else
                
                If Not UseMe Is Nothing Then UseMe.Show
                PlaceCaption s$
            End If
            If Not ttl Then
                Form1.TrueVisible = Form1.Visible Or Form1.TrueVisible
                Form1.Visible = False
                If s$ <> "" Then
                    Form1.CaptionW = s$
                Else
                    Form1.CaptionW = "M2000"
                End If
            Else
               If Not Form3.WindowState = 1 Then
                        If Not Form3.Visible Then
                        Form1.TrueVisible = Form1.Visible
                        Form1.Visible = False
                        If s$ = "" Then
                        'Unload Form3: ttl = False
                        End If
                        ProcTitle = True
                        Exit Function
                        End If
                        
                        Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000
                        Form3.skiptimer = True
                        Form3.WindowState = 1
                        Form1.TrueVisible = Form1.TrueVisible Or Form1.Visible
                        Form1.Visible = False
                        ProcTitle = True
                        Exit Function
                        
                   End If
                   
        End If
                   
        Else
NormalState:
        
        
         
        If UseMe Is Nothing Then
         If s$ = "" Or Not Form1.Visible Then ProcTitle = True: Exit Function
            If Not ttl Then
            Load Form3
            If Form3.WindowState = 1 Then Form3.skiptimer = False: Form3.WindowState = 0
            Form3.Move VirtualScreenWidth() + 2000, VirtualScreenHeight() + 2000: ttl = True
            
            End If
            Form3.Timer1.Interval = 30
            Form3.Timer1.enabled = False
            Form3.CaptionW = s$
            Form1.CaptionW = ""
                Form1.TrueVisible = True
                If Not Form3.WindowState = 0 Then
                    Form3.Visible = True
                    
                    Form3.WindowState = 0
    
                        End If
        Else
            PlaceCaption s$
        End If
          
             mywait basestack, 100
             
             
             End If
        ProcTitle = True
        Exit Function
    Else
        ProcTitle = False
    End If
Else
    If Not UseMe Is Nothing Then UseMe.Show
    GoTo NormalState
End If
Else
    If UseMe Is Nothing Then
            If ttl Then
                Unload Form3
                ttl = False
            End If
    Else
            UseMe.SetExtCaption ""
            'Form1.CaptionW = "M2000"
    End If
End If
ProcTitle = True
End Function
Function MyWrite(basestack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, s$, it As Long, par As Boolean, i As Long, skip As Boolean
If IsLabelSymbolNew(rest$, "ΜΕ", "WITH", Lang) Then
    If IsStrExp(basestack, rest$, s$) Then
        csvsep$ = Left$(s$, 1)
        If FastSymbol(rest$, ",") Then If IsStrExp(basestack, rest$, s$) Then csvDec$ = Left$(s$, 1): MyWrite = True
        csvuseescape = False
        If FastSymbol(rest$, ",") Then If IsExp(basestack, rest$, p) Then csvuseescape = CBool(p): MyWrite = True
        If FastSymbol(rest$, ",") Then MyWrite = False: If IsExp(basestack, rest$, p) Then cleanstrings = CBool(p): MyWrite = True
    End If
    Exit Function
End If
MyWrite = True
If csvsep$ = vbNullString Then csvsep$ = ","
If IsLabelSymbolNew(rest$, "ΔΕΚΑΕΞ", "HEX", Lang) Then it = 1
If FastSymbol(rest$, "#") Then

    MyWrite = False
    If IsExp(basestack, rest$, p) Then
    skip = p < 0
        On Error Resume Next
    If skip Then
    Dim Scr As Object, prive As basket, basketcode As Long
    Set Scr = basestack.Owner
    basketcode = GetCode(Scr)
    prive = players(GetCode(Scr))
    Else
    i = CLng(MyMod(p, 512))
    If FKIND(i) = FnoUse Or FKIND(i) = Finput Or FKIND(i) = Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": MyWrite = False: Exit Function
    End If
        
        par = False
        Do While FastSymbol(rest$, ",")

            If IsExp(basestack, rest$, p) Then
            s$ = LTrim(Str$(p))
            If it Then
            Else
             If Left$(s$, 1) = "." Then
                s$ = "0" + s$
                ElseIf Left$(s$, 2) = "-." Then s$ = "-0" + Mid$(s$, 2)
                End If
            End If
                If par Then
                    If skip Then
                        PlainBaSket Scr, prive, csvsep$
                    ElseIf uni(i) Then
                            putUniString i, csvsep$
                    Else
                            putANSIString i, csvsep$
                           ' Print #i, ",";
                    End If
                End If
                If skip Then
                        If it Then
                            PlainBaSket Scr, prive, PACKLNG2$(p)
                        Else
                            If Len(csvDec$) = 0 Then
                                PlainBaSket Scr, prive, s$
                            Else
                                PlainBaSket Scr, prive, Replace(Str$(p), ".", csvDec$)
                            End If
                        End If
                ElseIf uni(i) Then
                        If it Then
                            putUniString i, PACKLNG2$(p)
                        ElseIf Len(csvDec$) = 0 Then
                            putUniString i, s$
                        Else
                            putUniString i, Replace(s$, ".", csvDec$)
                        End If
                Else
                        If Len(csvDec$) = 0 Then
                            putANSIString i, s$
                        Else
                            putANSIString i, Replace(s$, ".", csvDec$)
                        End If
                        
                        If Err.Number > 0 Then Exit Function
                End If
            ElseIf IsStrExp(basestack, rest$, s$) Then
            If csvuseescape Then s$ = StringToEscapeStr(s$, False)
                If par Then
                    If skip Then
                        PlainBaSket Scr, prive, csvsep$
                    ElseIf uni(i) Then
                        putUniString i, csvsep$
                    Else
                        putANSIString i, csvsep$

                    End If
                End If
                If Not cleanstrings Then s$ = Replace$(s$, Chr(34), Chr(34) + Chr(34))
                If skip Then
                    PlainBaSket Scr, prive, Chr(34) + s$ + Chr(34)
                ElseIf uni(i) Then
                    If cleanstrings Then
                        putUniString i, s$
                    Else
                        putUniString i, Chr(34) + s$ + Chr(34)
                    End If
                Else
                    If cleanstrings Then
                        putANSIString i, s$
                    Else
                        putANSIString i, Chr(34) + s$ + Chr(34)
                    End If
                    End If
                    If Err.Number > 0 Then Exit Function
            Else
                
                    Exit Function
            End If
            par = True
            If skip Then players(basketcode) = prive
        Loop
        If skip Then
            crNew basestack, prive
        ElseIf uni(i) Then
            putUniString i, vbCrLf
        Else
            putANSIString i, vbCrLf
        End If
        MyWrite = True

    End If
End If
If skip Then players(basketcode) = prive

End Function
Function MyPut(basestack As basetask, rest$) As Boolean
Dim s$, F As Long, p As Variant, i As Long, PP As Variant, it As Long, flag As Boolean, Arr As Boolean
Dim myobject As mHandler, what$
MyPut = False
 IsSymbol3 rest$, "#"
If IsExp(basestack, rest$, p) Then
F = CLng(MyMod(p, 512))
    If FKIND(F) = FnoUse Or FKIND(F) = Finput Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": Exit Function
If Not FastSymbol(rest$, ",") Then Exit Function
    i = 1
    what$ = aheadstatus(rest$, , i)
    If Left$(what$, 1) = "N" Then
Select Case IsLabel(basestack, rest$, what$)
    Case 1  ' check to see if is a handler
    If GetVar(basestack, what$, it) Then
     PP = 0
     If Typename(var(it)) = "mHandler" Then
    
        If var(it).ReadOnly Then
                     ReadOnly
                             GoTo ex123
                     End If
        End If
      Set myobject = var(it)
     
     flag = True
    End If

    Case 5  'check for handler
    what$ = Left$(what$, Len(what$) - 1)
    If GetVar(basestack, what$, it) Then
    PP = 0
    If IsExp(basestack, rest$, PP) Then
    ' nothing here
    Arr = True
    End If
    If Not FastSymbol(rest$, ")") Then GoTo ex123
    If Not Typename(var(it)) = "mHandler" Then GoTo ex123
        
           If var(it).ReadOnly Then
                        ReadOnly
                                GoTo ex123
                        End If
        Set myobject = var(it)
        flag = True
    End If
    
    Case Else
        SyntaxError
        GoTo ex123
    End Select
    Else
    If FKIND(F) <> Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": MyPut = False: Exit Function
     If Not IsStrExp(basestack, rest$, s$) Then GoTo ex123
    End If
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
    i = CLng(MyMod(p, 2147483647))
    Seek #F, (i - 1) * FLEN(F) + 1
ElseIf Not flag Then
    GoTo ex123
End If
End If

If flag Then
Dim buf As MemBlock
Dim aa() As Byte
Set buf = myobject.objref

With buf
If FLEN(F) = 1 Then
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
p = Int(Abs(p))
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, PP) Then
PP = Int(Abs(PP))
If .ValidArea(p, CLng(PP)) Then
    .putData F, p, CLng(PP)
Else
GoTo wrong
End If

Else
MissNumExpr
GoTo ex123
End If
Else
MissNumExpr
GoTo ex123
End If
Else
MissNumExpr
GoTo ex123
End If
Else
.putData F, .GetBytePtr(0), .SizeByte
End If

Else
    If Arr Then
    p = 1
    If FastSymbol(rest$, ",") Then
        If Not IsExp(basestack, rest$, p) Then
                MissNumExpr
                MyPut = False
                GoTo ex123
        End If
    End If
    p = Int(Abs(p))
    If p = 0 Then GoTo wrong
        If .ValidArea2(PP, FLEN(F) * p) Then
            .putData F, .GetPtr(PP), FLEN(F) * p
        Else
wrong:
            MyEr "Wrong size-position for loading the buffer", "Λάθος μέγεθος-θέση για να φορτωθεί η Διάρθρωση"
            GoTo ex123
        End If
    Else
        .putData F, .GetPtr(0), .SizeByte
    End If
End If
End With
' use pp for
Else
If FKIND(F) <> Frandom Then MyEr "Wrong File Handler", "Λάθος Χειριστής Αρχείου": MyPut = False: Exit Function
If uni(F) Then
s$ = Left$(s$, FLEN(F) \ 2)
s$ = s$ & Space$(FLEN(F) \ 2 - Len(s$))
Else
s$ = Left$(s$, FLEN(F))
s$ = s$ & Space$(FLEN(F) - Len(s$))
End If
If FastSymbol(rest$, ",") Then
If IsExp(basestack, rest$, p) Then
i = CLng(MyMod(p, 2147483647))
Seek #F, (i - 1) * FLEN(F) + 1
Else
GoTo ex123
End If
End If
If uni(F) Then
putUniString F, s$
Else
Put #F, , s$
End If
End If
MyPut = True
End If
ex123:
Set myobject = Nothing
Set basestack.lastobj = Nothing
End Function
Function ProcSubDir(basestack As basetask, rest$, Lang As Long) As Boolean
Dim x1 As Long, ss$, w$

x1 = Abs(IsLabelFileName(basestack, rest$, ss$, , w$))

If x1 = 1 Then
    ss$ = w$
ElseIf x1 = 0 Or x1 = 3 Or x1 = 6 Then
rest$ = ss$ + rest$
    x1 = IsStrExp(basestack, rest$, ss$)
End If
If x1 <> 0 Then
    ss$ = mcd + ss$
    AddDirSep ss$
    If PathMakeDirs(ss$) Then
        mcd = ss$
        ProcSubDir = True
    Else
        BadPath
    End If
Else
MissDir
End If

End Function
Function ProcDir(basestack As basetask, rest$, Lang As Long) As Boolean
Dim pa$, w$, par As Boolean, s$, ss$, i As Long, p As Variant, what$, x1 As Long
If IsLabelSymbolNew(rest$, "ΧΡΗΣΤΗ", "USER", Lang) Then
If IsSupervisor Then
dset
Else
    mcd = userfiles
    End If
    ProcDir = True
    Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΚΥΡΙΟ", "MASTER", Lang) Then

    userfiles = GetSpecialfolder(CLng(26)) & "\M2000\"
    ProcDir = True
    Exit Function
ElseIf IsLabelSymbolNew(rest$, "ΥΠΟΛΟΓΙΣΤΗ", "COMPUTER", Lang) Then
 If IsSupervisor Then pa$ = "#" Else BadCommand: ProcDir = False: Exit Function
Else
    pa$ = vbNullString
End If
If FastSymbol(rest$, "?") Or pa$ <> "" Then
If IsSelectorInUse Then
ProcDir = False
SelectorInUse
Exit Function
End If
ProcDir = True
    If pa$ = "#" Then
    w$ = "#"
    pa$ = vbNullString
    Else
    p = CBool(IsStrExp(basestack, rest$, w$))
    End If
    If pa$ = vbNullString Then If FastSymbol(rest$, ",") Then p = CBool(IsStrExp(basestack, rest$, pa$))
    olamazi
    DialogSetupLang Lang
    par = False
    If w$ <> "" Then
    
        If Right$(w$, 1) = "?" Then
            w$ = Trim$(Left$(w$, Len(w$) - 1))
    mcd = w$ '' userfiles = W$
            par = True
        End If
    Else
    If IsSupervisor Then w$ = "\" Else w$ = userfiles
    End If

s$ = vbNullString
    If Form1.Visible Then
    If w$ = "#" Then
        If IsSupervisor Then
          If FolderSelector(basestack, Form1, "", "*", pa$, False) Then
            s$ = ReturnFile
        End If
        Else
        BadCommand
        ProcDir = False
        Exit Function
        End If
    Else
    If w$ <> "" Then If Not isdir(w$) Then BadPath: ProcDir = False: Exit Function
    If Not CanKillFile(w$) Then FilePathNotForUser: ProcDir = False: Exit Function
        If FolderSelector(basestack, Form1, mcd, w$, pa$, par) Then
            s$ = ReturnFile
        End If
    End If
    ElseIf form5iamloaded Then
      If w$ <> "" Then If Not isdir(w$) Then BadPath: ProcDir = False: Exit Function

      If Not CanKillFile(w$) Then FilePathNotForUser: ProcDir = False: Exit Function
        If FolderSelector(basestack, Form5, mcd, w$, pa$, par) Then
           s$ = ReturnFile
        End If
    End If
    s$ = mylcasefILE(s$)
            If s$ <> "" Then
            AddDirSep s$
                ''If Right(s$, 1) <> "\" Then s$ = s$ & "\"
                If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
                      Select Case Abs(IsLabel(basestack, rest$, what$))
                        Case 3
                        ProcDir = True
                            If GetVar(basestack, what$, i) Then
                            CheckVar var(i), s$
                            Else
                            globalvar what$, s$
                    
                            End If
                        Case Else
                            MissingStrVar
                            ProcDir = True
                            Exit Function
                        End Select
                 Else
                   mcd = s$
        
                   ProcDir = True
                   Exit Function
                End If
            End If
Else
x1 = Abs(IsLabelFileName(basestack, rest$, ss$, , w$))
If x1 = 1 Then
ss$ = w$
ElseIf x1 = 0 Or x1 = 3 Or x1 = 6 Then
rest$ = ss$ + rest$
x1 = IsStrExp(basestack, rest$, ss$)
End If

'If Left$(ss$, 1) = "." Then x1 = 1
If Left$(ss$, 2) = ".." And mcd = userfiles And Not IsSupervisor Then ProcDir = True: Exit Function ' no error
FixPath ss$
If x1 = 0 Then
IsSymbol3 rest$, "."
If FastSymbol(rest$, "*") Then
rest$ = Chr(34) + "*" + Chr(34) + rest$
ElseIf Not FastSymbol(rest$, "!") Then
rest$ = Chr(34) + "GSB" + Chr(34) + rest$
End If
 x1 = 1: ss$ = mcd
 par = True
End If
If x1 <> 0 Then
AddDirSep ss$
    If isdir(ss$) Then
        If Right(ss$, 1) <> "\" Then ss$ = ss$ & "\"
        If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
                Select Case Abs(IsLabel(basestack, rest$, what$))
                Case 3
                ProcDir = True
                    If GetVar(basestack, what$, i) Then
                    CheckVar var(i), ss$
                    Else
                    globalvar what$, ss$
            
                    End If
                Case Else
               MissingStrVar
               ProcDir = False
            Exit Function
                End Select
          
        Else
        If CanKillFile(ss$) Then
            mcd = ss$
            ProcDir = True
            If par = True Then
            'GOTO FILES
            If UserPath = "." Then
            If Lang Then
            ss$ = Chr(34) & "Dir User: " & Tcase(Originalusername) & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος Χρήστη: " & Tcase(Originalusername) & Chr(34)
            End If
            Else
            If IsSupervisor Then
            If Lang Then
            ss$ = Chr(34) & "Dir: " & UserPath2 & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος: " & UserPath2 & Chr(34)
            End If
            Else
            If Lang Then
            ss$ = Chr(34) & "Dir User: " & Tcase(Originalusername) & ": " & mylcasefILE(UserPath2) & Chr(34)
                Else
            ss$ = Chr(34) & "Κατάλογος Χρήστη: " & Tcase(Originalusername) & ": " & mylcasefILE(UserPath2) & Chr(34)
            End If
            End If
            End If
          
            par = MyReport(basestack, ss$, Lang)
            par = ProcFiles(basestack, rest$, Lang)
            par = ProcCat(basestack, "", Lang)
            End If
            Else
            
         mcd = ss$
            ProcDir = True
            If par Then
            If Lang Then
            ss$ = "{Read Only Folder: " & mcd & "}"
            Else
            ss$ = "{Κατάλογος μόνο για ανάγνωση: " & mcd & "}"
            End If
            par = MyReport(basestack, ss$, Lang)
            par = ProcFiles(basestack, rest$, Lang)
            par = ProcCat(basestack, "", Lang) Or par
            
            End If
            End If
            Exit Function
          
        End If
     Else
     BadPath
            ProcDir = False
            Exit Function
    End If
    End If
End If

End Function

Function ProcRemove(basestack As basetask, rest$, Lang As Long) As Boolean
Dim ss$
ProcRemove = True
If IsLabelSymbolNew(rest$, "ΑΔΕΙΑΣ", "LICENCE", Lang) Then
If IsStrExp(basestack, rest$, ss$) Then
Licenses.Remove ss$
Else
MissStringExpr
End If
Else
If IsStrExp(basestack, rest$, ss$) Then
RemoveDll ss$
ElseIf sb2used <= basestack.OriginalCode And basestack.OriginalCode <> 0 Then
MyEr "Can't Remove Last Module/Function", "Δεν μπορώ να διαγράψω το τελευταίο τμήμα/συνάρτηση"
ProcRemove = False
Else
If sb2used > 0 Then
If subHash.count > 0 Then subHash.ReduceHash subHash.count - 1, sbf()
    If UBound(sbf()) / 2 > sb2used And UBound(sbf()) > 19 Then
       ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
         
    End If
    sb2used = sb2used - 1

If lckfrm <> 0 Then
If lckfrm > sb2used Then lckfrm = 0

End If
End If


End If
End If
End Function
Function ProcClass(basestack As basetask, rest$, Lang As Long, super As Boolean) As Boolean
Dim i As Long, ss$, y1 As Long, what$, w$, ohere$, w2$, subs As Long, snames As Long, s$
If super Then
    subs = sb2used: snames = subHash.count:
    Dim r As Variant
    Dim SuperGroup As Object
    
End If
ohere$ = here$
ProcClass = True
y1 = IsLabelSymbolNew(rest$, "ΓΕΝΙΚΗ", "GLOBAL", Lang)
Select Case IsLabelA("", rest$, w$)
Case 1
            If FastSymbol(rest$, "{") Then
            ' new code for finding position on error using shift+f1
            ss$ = block(rest$)
              i = Len(rest$)
              If here$ = vbNullString Or basestack.LoadOnly Then
                If Lang = 1 Then
                s$ = vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=group(" + w$ + ")"
                       rest$ = w$ + "{" + vbCrLf + "group " + w$ + "  {" + ss$ + "}" + vbCrLf + s$ + rest$
                  Else
                  s$ = "Αν Τμήμα(" + w$ + "." + w$ + ") Τότε Κάλεσε! " + w$ + "." + w$ + vbCrLf + "=Ομάδα(" + w$ + ")"
                        rest$ = w$ + "{" + vbCrLf + "ομάδα " + w$ + "  {" + ss$ + "}" + vbCrLf + s$ + rest$
                  End If
              Else
              If Lang = 1 Then
              s$ = vbCrLf + "if module(" + w$ + "." + w$ + ") then call! " + w$ + "." + w$ + vbCrLf + "=group(" + w$ + ")"
                     rest$ = w$ + "{'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i) + "' " + CStr(Len(s$) + 2) + vbCrLf + "group " + w$ + "  {" + ss$ + "}" + vbCrLf + s$ + rest$
                Else
                s$ = "Αν Τμήμα(" + w$ + "." + w$ + ") Τότε Κάλεσε! " + w$ + "." + w$ + vbCrLf + "=Ομάδα(" + w$ + ")"
                      rest$ = w$ + "{'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i) + "' " + CStr(Len(s$) + 2) + vbCrLf + "ομάδα " + w$ + "  {" + ss$ + "}" + vbCrLf + s$ + rest$
                End If
                End If
                ProcClass = MyFunction(1, basestack, rest$, Lang)
         Else
                If Not GetVar(basestack, basestack.GroupName & what$, i) Then
                        i = globalvar(basestack.GroupName & what$, CLng(0))
                        Set var(i) = New Group
                Else
                        If Typename(var(i)) <> "Group" Then Set var(i) = New Group
                End If
        End If
Case 3
w2$ = Left$(w$, Len(w$) - 1)
        If FastSymbol(rest$, "{") Then
                ss$ = block(rest$)
                
                
                i = Len(rest$)
                If here$ = vbNullString Or basestack.LoadOnly Then
                If Lang = 1 Then
               s$ = "if module(" + w2$ + "." + w2$ + ") then call! " + w2$ + "." + w2$ + vbCrLf + "=group$(" + w2$ + ")"
                        rest$ = w$ + "{" + vbCrLf + "group " + w$ + "  {" + ss$ & "}" + vbCrLf + s$ + rest$
               Else
                s$ = "Αν Τμήμα(" + w2$ + "." + w2$ + ") Τότε Κάλεσε! " + w2$ + "." + w2$ + vbCrLf + "=Ομάδα$(" + w2$ + ")"
                      rest$ = w$ + "{" + vbCrLf + "ομάδα " + w$ + "  {" + ss$ & "}" + vbCrLf + s$ + rest$
                End If
                Else
               If Lang = 1 Then
               s$ = "if module(" + w2$ + "." + w2$ + ") then call! " + w2$ + "." + w2$ + vbCrLf + "=group$(" + w2$ + ")"
                        rest$ = w$ + "{'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i) + "' " + CStr(Len(s$) + 2) + vbCrLf + "group " + w$ + "  {" + ss$ & "}" + vbCrLf + s$ + rest$
               Else
                s$ = "Αν Τμήμα(" + w2$ + "." + w2$ + ") Τότε Κάλεσε! " + w2$ + "." + w2$ + vbCrLf + "=Ομάδα$(" + w2$ + ")"
                      rest$ = w$ + "{'11001EDIT " & GetModuleName(basestack, ohere$) & ",-" & CStr(i) + "' " + CStr(Len(s$) + 2) + vbCrLf + "ομάδα " + w$ + "  {" + ss$ & "}" + vbCrLf + s$ + rest$
                End If
                End If
                ProcClass = MyFunction(1, basestack, rest$, Lang)
         Else
                If Not GetVar(basestack, basestack.GroupName & what$, i) Then
                        i = globalvar(basestack.GroupName & what$, CLng(0))
                        Set var(i) = New Group
                Else
                        If Typename(var(i)) <> "Group" Then Set var(i) = New Group
                End If
        End If

Case Else
        MyEr what$ & " without name", what$ & "χωρίς όνομα"
        ProcClass = False
End Select
If super Then

' make a variable

If Right$(w$, 1) = "$" Then
'Dim s As String
If IsStrExp(basestack, w$ + "()", s) Then
GoTo conthere
End If
ElseIf IsExp(basestack, w$ + "()", r) Then
conthere:
If basestack.lastobj Is Nothing Then
' error
Else
                sb2used = subs
                    subHash.ReduceHash snames, sbf()
                     If UBound(sbf()) / 3 > sb2used And UBound(sbf()) > 499 Then
                               ReDim Preserve sbf(UBound(sbf()) / 2 + 1) As modfun
                       End If
                       
If TypeOf basestack.lastobj Is Group Then
' make a pointet to group
Set SuperGroup = basestack.lastobj
Set basestack.lastobj = Nothing

Dim mm As Variant

If y1 Then
        i = globalvar(w$, mm, , True)
        Set var(i) = New Group
        
        Set var(i).SuperClassList = SuperGroup
        var(i).IamSuperClass = True
Else
        i = globalvar(w$, mm)
         Set var(i) = New Group
        Set var(i).SuperClassList = SuperGroup
        var(i).IamSuperClass = True

End If

Else
' something wrong

End If
End If
End If
End If

End Function
Function ProcDef(basestack As basetask, rest$, Lang As Long) As Boolean
Dim i As Long, what$, y1 As Long, ss$, s$, p, ps$
ProcDef = True
y1 = IsLabel(basestack, rest$, what$)
If y1 >= 5 Then
s$ = BlockParam(rest$)
rest$ = Mid$(rest$, Len(s$) + 1)
If FastSymbol(rest$, ")", True) Then
If FastSymbol(rest$, "=", True) Then
ss$ = vbNullString
Do
i = 1
aheadstatus rest$, False, i
ss$ = ss$ + Left$(rest$, i - 1)
rest$ = Mid$(rest$, i)
If Not FastSymbol(rest$, ",") Then Exit Do
ss$ = ss$ + ", "
Loop
If Trim$(s$) = vbNullString Then
ProcDef = MyFunction(0, basestack, Left$(what$, Len(what$) - 1) + " { =" + ss$ + "}", 1)
Else
ProcDef = MyFunction(0, basestack, Left$(what$, Len(what$) - 1) + " {  @read " + s$ + vbCrLf + "=" + ss$ + "}", 1)
End If
Exit Function
End If
End If
ElseIf y1 > 0 Then
'MyEr "Need name for function with parenthesis", "Θέλω όνομα συνάρτησης με παρενθέσεις"
If here$ = "" Or basestack.IamThread Then MyEr "Def make Variables only in Modules and Functions", "Η Κάνε φτιάχνει μεταβλητές μόνο σε Τμήματα και Συναρτήσεις": ProcDef = False: Exit Function
Dim that As Variant, oldthat As Variant, ByPass As Boolean, lcl As Boolean, notdef As Boolean, notdefone As Boolean
lcl = IsLabelSymbolNew(what$, "ΤΟΠΙΚΑ", "LOCAL", Lang)
If lcl Then y1 = IsLabel(basestack, rest$, what$)
If y1 < 5 Then
    If y1 = 3 Then
        that = vbNullString
        GoTo jumpnow
    ElseIf IsLabelSymbolNew(what$, "ΑΡΙΘΜΟ", "DECIMAL", Lang) Then
    that = CDec(0)
    ElseIf IsLabelSymbolNew(what$, "ΔΙΠΛΟ", "DOUBLE", Lang) Then
    that = CDbl(0)
    ElseIf IsLabelSymbolNew(what$, "ΑΠΛΟ", "SINGLE", Lang) Then
    that = CSng(0)
    ElseIf IsLabelSymbolNew(what$, "ΛΟΓΙΚΟ", "BOOLEAN", Lang) Then
    that = CBool(0)
    ElseIf IsLabelSymbolNew(what$, "ΜΑΚΡΥ", "LONG", Lang) Then
    that = CLng(0)
    ElseIf IsLabelSymbolNew(what$, "ΑΚΕΡΑΙΟ", "INTEGER", Lang) Then
    that = CInt(0)
    ElseIf IsLabelSymbolNew(what$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang) Then
    that = CCur(0)
    ElseIf IsLabelSymbolNew(what$, "ΓΡΑΜΜΑ", "STRING", Lang) Then
    that = vbNullString
    Else
    ByPass = True
    that = CDbl(0)
    GoTo jumpnow
    End If
    ByPass = True
    notdefone = True
    notdef = True
    y1 = IsLabel(basestack, rest$, what$)
jumpnow:
    oldthat = that
    Do While y1 < 5
    
    If ByPass Then
        notdef = True
        If IsLabelSymbolNew(rest$, "ΩΣ", "AS", Lang) Then
        If IsLabelSymbolNew(rest$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
        that = CDec(0)
        ElseIf IsLabelSymbolNew(rest$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
        that = CDbl(0)
        ElseIf IsLabelSymbolNew(rest$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
        that = CSng(0)
        ElseIf IsLabelSymbolNew(rest$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
        that = CBool(0)
        ElseIf IsLabelSymbolNew(rest$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
        that = CLng(0)
        ElseIf IsLabelSymbolNew(rest$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
        that = CInt(0)
        ElseIf IsLabelSymbolNew(rest$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
        that = CCur(0)
        ElseIf IsLabelSymbolNew(rest$, "ΓΡΑΜΜΑ", "STRING", Lang, , , , False) Then
        that = vbNullString
       Else
       
        that = oldthat
        End If
     ElseIf y1 = 3 Then
    
        that = vbNullString
        Else
         notdef = notdefone
    End If
    ElseIf y1 <> 3 Then
    If VarType(that) = vbEmpty Then
    that = 0#
    End If
    End If
    If VarType(that) = vbString Then
    If y1 = 1 Then what$ = what$ + "$"
    End If
    
    If Not lcl Then If GetlocalVar(what$, i) Then MyEr "Variable " + what$ + " already defined", "Υπάρχει ήδη η μεταβλητή " + what$: ProcDef = False: Exit Function
    i = AllocVar()
    varhash.ItemCreator here$ + "." + what$, i, , , True
    p = that
    If FastSymbol(rest$, "=") Then
    If IsNumeric(p) Then
    If Not IsNumberD2(rest$, p, notdef, True) Then missNumber: Exit Function
    On Error Resume Next
    that = oldthat
    If Err.Number > 0 Then
        If Err.Number = 6 Then
            Overflow
            ProcDef = False
            Exit Function
        End If
    End If
    Else
    If Not ISSTRINGA(rest$, ps$) Then missNumber: Exit Function
        p = ps$
    End If
    End If
    var(i) = p
    If Not FastSymbol(rest$, ",") Then Exit Do
    y1 = IsLabel(basestack, rest$, what$)
    Loop
End If
If y1 > 4 Then MyEr "Not arrays with def", "Όχι πίνακες με την Κάνε": ProcDef = False: Exit Function
Else
SyntaxError
ProcDef = False
Exit Function
End If

End Function
Function ProcLoad(basestack As basetask, rest$, Lang As Long) As Boolean
Dim x1 As Long, s$, w$, ss$, par As Boolean, vvl As Variant, Key$, par1 As Boolean, NoRun As Boolean
par1 = Not IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", Lang)
If par1 Then par1 = Not IsLabelSymbolNew(rest$, "ΝΕΑ", "NEW", Lang)  ' PLURAL FOR GREEK
NoRun = IsLabelSymbolNew(rest$, "ΤΜΗΜΑΤΑ", "MODULES", Lang)
ProcLoad = True
Do
x1 = Abs(IsLabelFileName(basestack, rest$, s$, , w$))
If x1 = 1 Then
s$ = w$
Else
rest$ = s$ + rest$
x1 = IsStrExp(basestack, rest$, s$)
End If
If x1 <> 0 Then
   
    If par1 Then
        If loadcatalog.ExistKey(mcd + ExtractNameOnly(s$) & ".gsb") Then
            w$ = mcd + ExtractNameOnly(s$) & ".gsb"
            ss$ = loadcatalog.Value
            If loadcatalog.ExistKey(w$ + Chr(1)) Then Switches loadcatalog.Value
            par1 = False
            GoTo jumphere
        ElseIf loadcatalog.ExistKey(mcd + ExtractNameOnly(w$) & ".gsb") Then
            w$ = mcd + ExtractNameOnly(w$) & ".gsb"
            ss$ = loadcatalog.Value
            If loadcatalog.ExistKey(w$ + Chr(1)) Then Switches loadcatalog.Value
            par1 = False
            GoTo jumphere
        End If
    End If
    par1 = True
    If ExtractType(s$) <> "gsb" Then
        Key$ = mcd + ExtractNameOnly(s$) & ".gsb"
        s$ = CFname(mcd + ExtractNameOnly(s$) & ".gsb")
        If s$ = vbNullString Then
        Key$ = mcd + ExtractNameOnly(w$) & ".gsb"
        s$ = CFname(mcd + ExtractNameOnly(w$) & ".gsb")
        End If
    Else
        ss$ = s$
        If ExtractPath$(s$) = vbNullString Then
            s$ = ExtractName(s$)
            ss$ = Trim$(Mid$(ss$, Len(s$) + 1))
            s$ = mcd + s$
        Else
            s$ = ExtractPath(s$) + ExtractName(s$)
            ss$ = Trim$(Mid$(ss$, Len(s$) + 1))
        
        End If
        If CFname(s$) = vbNullString Then
        s$ = w$
        ss$ = s$
        If ExtractPath$(s$) = vbNullString Then
            s$ = ExtractName(s$)
            ss$ = Trim$(Mid$(ss$, Len(s$) + 1))
            s$ = mcd + s$
        Else
            s$ = ExtractPath(s$) + ExtractName(s$)
            ss$ = Trim$(Mid$(ss$, Len(s$) + 1))
        
        End If
        If CFname(s$) = vbNullString Then
            MyEr "No such file", "Δεν υπάρχει τέτοιο αρχείο"
            ProcLoad = False
            Exit Function
        End If
        End If
        If par1 Then
        If loadcatalog.ExistKey(Key$ + Chr$(1)) Then
            loadcatalog.Value = ss$
        Else
            loadcatalog.AddKey Key$ + Chr$(1), ss$
        End If
        End If
        Switches ss$
    End If
    If ExtractNameOnly(s$) = vbNullString Or CFname(s$) = "" Then
        MyEr "No such file", "Δεν υπάρχει τέτοιο αρχείο"
        ProcLoad = False
        Exit Function
    End If
    Dim oldclid As Long
    oldclid = cLid
    cLid = 1032
    ss$ = ReadUnicodeOrANSI(s$, True)
    cLid = oldclid
    If ss$ <> "" Then
   If par1 Then
        If loadcatalog.ExistKey(Key$) Then
            loadcatalog.Value = ss$
        Else
               loadcatalog.AddKey Key$, ss$
        End If
    End If
    End If
jumphere:
    If ss$ <> "" Then
    If Err.Number = 0 And Not (basestack.IamChild Or basestack.IamAnEvent) Then
        LASTPROG$ = s$
        loadcatalog.Remove Key$: loadcatalog.Remove Key$ + Chr(1)
    End If
    If FastSymbol(rest$, ",") Then
        If IsStrExp(basestack, rest$, w$) Then
                ss$ = mycoder.decryptline(ss$, w$, (Len(ss$) / 2) Mod 33)
                If Abs(IsLabel(basestack, ss$, w$)) Then
                        If Not (Left$(ss$, 3) = ":" & vbCrLf) Then ProcLoad = False: Exit Function
                        If lckfrm = 0 And Not NORUN1 Then lckfrm = sb2used + 1
                        GoTo skipme2
                End If
        End If
End If
par = False

Do While MaybeIsSymbol(ss$, "\'[*")
SetNextLine ss$
par = True
Loop
ss$ = Replace(ss$, Chr$(9), "      ")

If ss$ <> "" Then
If par Then GoTo skipme
If (AscW(ss$) > 127 And myUcase(Left$(ss$, 5)) <> "ΚΛΑΣΗ" And myUcase(Left$(ss$, 5)) <> "ΤΜΗΜΑ" And myUcase(Left$(ss$, 9)) <> "ΣΥΝΑΡΤΗΣΗ") Or (((AscW(ss$) And &H4000) = &H4000)) Then
    ss$ = mycoder.must(ss$)
    If NORUN1 Then
        Clipboard.Clear
        SetTextData CF_UNICODETEXT, ss$
        basestack.LoadOnly = True
    End If

    If IsLabelA1("", ss$, w$) Then
        If Not (Left$(ss$, 3) = ":" & vbCrLf) Then ProcLoad = False: Exit Function
        'lock that module
        If lckfrm = 0 And Not NORUN1 Then lckfrm = sb2used + 1
    Else
        MOUT = True
    End If
Else
skipme:
    While FastSymbol(ss$, vbCrLf, , 2)
    
      ''  SleepWait 20
    Wend
    If Abs(IsLabel(basestack, ss$, w$)) Then
        If Not (Left$(ss$, 3) = ":" & vbCrLf) Then
        ss$ = w$ & " " & ss$
        End If
    End If
End If
skipme2:
vvl = CStr(vvl) + vbCrLf + ss$ & vbCrLf

End If
End If
End If
Loop Until MOUT Or Not IsSymbol(rest$, "&&", 2)
basestack.NoRun = NoRun
ProcLoad = interpret(basestack, CStr(vvl), Len(here$) > 0)
basestack.NoRun = False


End Function
Function MyDocument(basestack As basetask, rest$, Lang As Long) As Boolean
Dim ss$, s$, what$, x1 As Long, i As Long, it As Long, pppp As mArray
MyDocument = True
ss$ = vbNullString
Do
    x1 = Abs(IsLabel(basestack, rest$, what$))
        If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
    If x1 = 3 Or x1 = 6 Then
        If x1 = 3 Then
        
                
                
            If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(basestack.GroupName & what$, i) Then
            GoTo there0
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            GoTo there0
            Else
            i = globalvar(basestack.GroupName & what$, s$)  ' MAKE ONE  '
             GoTo makeitnow
            End If
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            
there0:
                s$ = var(i)
                MakeitObject var(i)
                CheckVar var(i), s$
                GoTo there1
            Else
        
                i = globalvar(basestack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow:
                    MakeitObject var(i)
there1:
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                            CheckVar var(i), s$
                        Else
                            MissStringExpr
                            MyDocument = False
                        End If
                    Else
                    ' DO NOTHING
                    End If
                End If
            End If
        Else
            ' ARRAYf
            If neoGetArray(basestack, what$, pppp, here$ <> "") Then   ' basestack.GroupName &
                If Not NeoGetArrayItem(pppp, basestack, what$, it, rest$) Then MyDocument = False: Exit Function
                x1 = 0
                If Not MyIsObject(pppp.item(it)) Then
                    s$ = pppp.item(it)
                    Set pppp.item(it) = New Document
                    If s$ <> "" Then pppp.item(it).textDoc = s$
                    If FastSymbol(rest$, "=") Then
                        If IsStrExp(basestack, rest$, s$) Then
                            CheckVar pppp.item(it), s$
                        Else
                            MissStringExpr
                        MyDocument = False
                        End If
                    End If
                Else
                If FastSymbol(rest$, "=") Then
                    If IsStrExp(basestack, rest$, s$) Then
                        CheckVar pppp.item(it), s$
                    Else
                        MissStringExpr
                        MyDocument = False
                    End If
                Else
                    Exit Do
                   End If
                End If
                MyDocument = True
            Else
            MyErMacro rest$, "array has no dimension", "ο πίνακας δεν έχει οριστεί"
             MyDocument = False
             Exit Function
            End If
          
            End If
    Else
    SyntaxError
    MyDocument = False
    
    End If
    Loop Until Not FastSymbol(rest$, ",")

End Function
Function CheckTwoVal(a, b, c)
CheckTwoVal = a = b Or a = c
End Function
Function MyLong(basestack As basetask, rest$, Lang As Long) As Boolean
Dim s$, what$, i As Long, p As Variant
MyLong = True

     Do While CheckTwoVal(Abs(IsLabel(basestack, rest$, what$)), 1, 4)
     If basestack.priveflag Then what$ = ChrW(&HFFBF) + what$
     If Not FastSymbol(rest$, "<") Then  ' get local var first
            If GetlocalVar(basestack.GroupName & what$, i) Then
            p = var(i)
            GoTo there01
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
             p = var(i)
            GoTo there01
            Else
            i = globalvar(basestack.GroupName & what$, s$)     ' MAKE ONE  '

             GoTo makeitnow1
            End If
            ElseIf GetVar(basestack, basestack.GroupName & what$, i) Then
            
there01:
                
                MakeitObjectLong var(i)
                On Error Resume Next
                Err.Clear
                CheckVarLong var(i), CLng(Int(p))
                If Err > 0 Then
                If Err.Number = 6 Then MyEr "overflowlong Long", "Υπερχείλιση  μακρύ"
                Err.Clear
                MyLong = False
                Exit Function
                End If
                GoTo there12
            Else
        
                i = globalvar(basestack.GroupName & what$, s$) ' MAKE ONE
                If i <> 0 Then
makeitnow1:
                    MakeitObjectLong var(i)
there12:
                    If FastSymbol(rest$, "=") Then
                        If IsExp(basestack, rest$, p) Then
                          On Error Resume Next
                            Err.Clear
                            CheckVarLong var(i), CLng(Int(p))
                            If Err > 0 Then
                            If Err.Number = 6 Then MyEr "overflowlong Long", "Υπερχείλιση  μακρύ"
                            Err.Clear
                            MyLong = False
                            Exit Function
                            End If
                        Else
                            MissNumExpr
                            MyLong = False
                        End If
                    Else
                    ' DO NOTHING
                    End If
                End If
            End If
     
     If Not FastSymbol(rest$, ",") Then Exit Do
     Loop
End Function
Function MyLink(basestack As basetask, rest$, Lang As Long) As Boolean
MyLink = True
Dim myobject As mStiva, ohere$, s$, ss$, x1 As Long, it As Long, Rest1$
ohere$ = here$
Set myobject = basestack.soros
Set basestack.Sorosref = New mStiva
s$ = vbNullString
Do
    If IsLabelSymbolNew(rest$, "ΙΣΧΝΗ", "WEAK", Lang) Then
        If IsStrExp(basestack, rest$, ss$) Then
            If GetSub(ss$, x1) Then
                basestack.soros.DataStr "{" + sbf(x1).sb + "}": x1 = 1: GoTo contlink2
            Else
                basestack.soros.DataStr ss$: x1 = 1: GoTo contlink2
            End If
        End If
        MissStringExpr
        MyLink = False
        Exit Function
    ElseIf IsLabelSymbolNew(rest$, "ΓΟΝΙΚΟ", "PARENT", Lang) Then
    
        If basestack.UseGroupname <> "" Then
            ss$ = Mid$(basestack.UseGroupname, 1, Len(basestack.UseGroupname) - 1)
            
            If GetVar(basestack, ss$, x1) Then
            ss$ = Left$(ss$, Len(ss$) - Len(var(x1).GroupName))
            Dim sss$, sss1$, bck$
           
            Do
            sss$ = GetNextLine(rest$)
            bck$ = sss$
            If sss$ = vbNullString Then x1 = 0: Exit Do
            sss1$ = "&" + ss$ + "." + sss$
            sss$ = "&" + ss$ + "." + ChrW(&HFFBF) + sss$
            basestack.NoError = True
            s$ = vbNullString
            If IsStrExp(basestack, sss1$, s$) Then
                If GetSub(s$, x1) Then
                    basestack.soros.DataStr "{" + sbf(x1).sb + "}": x1 = 1
                Else
                    basestack.soros.DataStr s$: x1 = 1
                End If
                rest$ = sss1$ + rest$
            ElseIf IsStrExp(basestack, sss$, s$) Then
           
                If GetSub(s$, x1) Then
                    basestack.soros.DataStr "{" + sbf(x1).sb + "}": x1 = 1
                Else
                    basestack.soros.DataStr s$: x1 = 1
                End If
                rest$ = sss$ + rest$
            Else
                basestack.NoError = 0
                rest$ = bck$ + rest$
                MyEr "No such variable", "Δεν υπάρχει τέτοια μεταβλητή"
                MyLink = False
                Exit Function
            End If
        
            Loop Until Not FastSymbol(rest$, ",")
        If x1 = 1 Then GoTo contlink2
        basestack.NoError = 0
        MyEr "Parent group problem", "Πρόβλημα γονικής ομάδας"
        MyLink = False
        Exit Function
            End If
    Else

            MyEr "No parent found", "Δεν βρήκα γονικό"
         MyLink = False
        Exit Function
            End If
    End If
        
         If Len(rest$) < 129 Then
        it = IsLabelDot(ohere$, rest$, ss$)
    Else
        Rest1$ = Left$(rest$, 128)
        it = IsLabelDot(ohere$, Rest1$, ss$)
        If Len(Rest1$) = 0 Then
            it = IsLabelDot(ohere$, rest$, ss$)
        Else
            rest$ = Mid$(rest$, 129 - Len(Rest1$))
        End If
    End If
   
        
        
        
    If it = 2 Then
         If Len(rest$) < 129 Then
        it = IsLabelDot(ohere$, rest$, ss$)
    Else
        Rest1$ = Left$(rest$, 128)
        it = IsLabelDot(ohere$, Rest1$, ss$)
        If Len(Rest1$) = 0 Then
            it = IsLabelDot(ohere$, rest$, ss$)
        Else
            rest$ = Mid$(rest$, 129 - Len(Rest1$))
        End If
    End If
    End If
    If it = 0 Then IsStrExp basestack, rest$, ss$  'Then x1 = 1: basestack.soros.DataStr ss$: GoTo contlink2
    If ss$ <> "" Then
        If Left$(ss$, 1) = "&" Then ss$ = Mid$(ss$, 2)
            If it < 0 Then IsLabel basestack, (ss$), ss$
            If it > 4 Then
                ss$ = ss$ + ")"
                If Not FastSymbol(rest$, ")") Then it = 0
            End If
            x1 = 1
            aheadstatus rest$, False, x1
            basestack.NoError = True
             ss$ = "&" + ss$
            bck$ = ss$
            If IsStrExp(basestack, ss$, s$) Then
                 basestack.soros.DataStr s$
                 GoTo contLoop
            Else
     
            If it > 4 Then
                  it = rinstr(bck$, ".")
                bck$ = Left$(bck$, it) + ChrW(&HFFBF) + Mid$(bck$, it + 1)
       
               If IsStrExp(basestack, bck$, s$) Then
                If basestack.UseGroupname = vbNullString Then
            MyLink = False
            MyEr "Can't make reference, it's hidden", "Δεν μπορώ να φτιάξω αναφορά, είναι κρυμμένο"
            Exit Function
            End If
                 basestack.soros.DataStr s$
                 GoTo contLoop
                 End If
                
            Else
            it = rinstr(bck$, ".")
            
            
                ss$ = Left$(bck$, it) + ChrW(&HFFBF) + Mid$(bck$, it + 1)
                
            End If
            If IsStrExp(basestack, ss$, s$) Then
            
            If basestack.UseGroupname = vbNullString Then
            MyLink = False
            MyEr "Can't make reference, it's hidden", "Δεν μπορώ να φτιάξω αναφορά, είναι κρυμμένο"
            Exit Function
            End If
            End If
            End If
            basestack.NoError = False
            basestack.soros.DataStr s$
            

    End If
contLoop:
Loop While FastSymbol(rest$, ",")
contlink2:
basestack.NoError = False
If basestack.soros.Total = 0 Then
    MyEr "Nothing to link", "Τίποτα για να ενώσω"
    
ElseIf IsLabelSymbolNew(rest$, "ΤΟΠΙΚΑ", "LOCAL", Lang) Then
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
    MyLink = MyRead(8, basestack, rest$, Lang)
ElseIf IsLabelSymbolNew(rest$, "ΣΤΗ", "TO", Lang, True) Then
    MyLink = MyRead(8, basestack, rest$, Lang)
End If
Else
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
    MyLink = MyRead(2, basestack, rest$, Lang)
ElseIf IsLabelSymbolNew(rest$, "ΣΤΗ", "TO", Lang, True) Then
    MyLink = MyRead(2, basestack, rest$, Lang)
End If
End If
exitlink:
Set basestack.Sorosref = myobject
Set myobject = Nothing
End Function

Function MyError(basestack As basetask, rest$, Lang As Long) As Boolean
Dim p As Variant, x1 As Long, s$, ss$, what$
x1 = LastErNum
If IsExp(basestack, rest$, p) Then
If p = 0 Then
NERR = True
MyError = False
Exit Function
ElseIf p = -1 Then
NERR = False
MyError = False
Exit Function
Else
If p = -2 Then
 ISSTRINGA rest$, s$
 ISSTRINGA rest$, ss$
MyEr s, ss$
If basestack.IamThread Then
On Error Resume Next
basestack.Parent.ThrowThreads
NERR = False
MyError = False
Exit Function
End If
MyError = False
Exit Function

Else
MyEr "ERROR " & Trim$(Str$(p)), "ΛΑΘΟΣ " & Trim$(Str$(p))
LastErNum = p
End If
End If
ElseIf IsStrExp(basestack, rest$, s$) Then
MyEr what$ & " " & s$, what$ & " " & s$
Else
LastErNum = 0 ': LastErNum1 = 0
LastErNameGR = vbNullString
LastErName = vbNullString

MyError = True
Exit Function
End If

MyError = False

End Function


Function MyDim(basestack As basetask, rest$, Lang As Long, Optional dNew As Boolean) As Boolean
Dim par As Boolean, pppp As mArray, it As Long
Dim p As Variant, w$, s$, x As Variant, i As Long, F As Long, Reverse As Boolean, ss$, uselocalbase As Boolean, usethisbase As Long
Dim oldbase As Long, common As Boolean, Rest1$
MyDim = True
Reverse = IsLabelSymbolNew(rest$, "OLE", "OLE", Lang)
If dNew Then
par = True
Else
par = IsLabelSymbolNew(rest$, "ΝΕΟ", "NEW", Lang)
End If
common = IsLabelSymbolNew(rest$, "ΚΟΙΝΟΣ", "COMMON", Lang)
If Not common Then common = IsLabelSymbolNew(rest$, "ΚΟΙΝΟΙ", "COMMON", Lang)
uselocalbase = IsLabelSymbolNew(rest$, "ΒΑΣΗ", "BASE", Lang)
If uselocalbase Then
If FastSymbol(rest$, "1") Then
    oldbase = ArrBase
    ArrBase = 1
ElseIf FastSymbol(rest$, "0") Then
    oldbase = ArrBase
    ArrBase = 0
End If
If Not par Then
If IsLabelSymbolNew(rest$, "ΣΤΟ", "TO", Lang) Then
Do
usethisbase = ArrBase

    If Len(rest$) < 129 Then
        it = Abs(IsLabelDIM(basestack, rest$, w$))
    Else
        Rest1$ = Left$(rest$, 128)
        it = Abs(IsLabelDIM(basestack, Rest1$, w$))
        If Len(Rest1$) = 0 Then
            it = Abs(IsLabelDIM(basestack, rest$, w$))
        Else
            rest$ = Mid$(rest$, 129 - Len(Rest1$))
        End If
    End If
    If basestack.priveflag Then
    w$ = ChrW(&HFFBF) + w$
    End If
    If Not IsSymbol(rest$, ")") Then GoTo ex1
    If neoGetArray(basestack, w$, pppp, here$ <> "") Then
        If Not pppp.Arr Then Set pppp = Nothing: GoTo ex1
        If pppp.IHaveClass And pppp.GroupRef Is Nothing Then Set pppp = Nothing: GoTo ex1
        pppp.SerialItem 0, -usethisbase, 12
        pppp.common = common
   End If
   Loop Until Not FastSymbol(rest$, ",")
   GoTo ex1
End If
End If
If Not FastSymbol(rest$, ",") Then MyDim = True: GoTo ex1
End If
' for security
usethisbase = ArrBase
Do
ArrBase = usethisbase
    If Len(rest$) < 129 Then
        it = Abs(IsLabelDIM(basestack, rest$, w$))
    Else
        Rest1$ = Left$(rest$, 128)
        it = Abs(IsLabelDIM(basestack, Rest1$, w$))
        If Len(Rest1$) = 0 Then
            it = Abs(IsLabelDIM(basestack, rest$, w$))
        Else
            rest$ = Mid$(rest$, 129 - Len(Rest1$))
        End If
    End If

    If basestack.priveflag Then
    w$ = ChrW(&HFFBF) + w$
    ElseIf basestack.UseGroupname <> "" Then
    If it = 6 Then
        If strfunid.Find(w$, i) Then
            If i > 0 Then strfunid.ItemCreator w$, -i
        End If
    ElseIf it = 5 Then
        If funid.Find(w$, i) Then
            If i > 0 Then funid.ItemCreator w$, -i
        End If
    End If
    End If
    If MaybeIsSymbol(rest$, ")") Then rest$ = "0" + rest$

    ''*********************
    If neoGetArray(basestack, w$, pppp, True) And Not par Then ' here$ <> ""
    If Not pppp.Arr Then
    MyEr "Name conflict with Inventory object", "Υπάρχει τέτοιο όνομα σε χρήση σε Κατάσταση"
    
    Set pppp = Nothing: GoTo ex1
    End If
    
    If pppp.IHaveClass And pppp.GroupRef Is Nothing Then Set pppp = Nothing: GoTo ex1
    pppp.common = common
   ' If reverse Then pppp.RevOrder = True
   If uselocalbase Then pppp.myarrbase = -ArrBase
    Select Case it
    Case 5, 6, 7
   GlobalArrResize pppp, basestack, w$, rest$, i
   p = i
    If i < 0 Then it = 0
    
    Case Else
    it = 0
    End Select
   Else
    Select Case it
    Case 5, 6, 7
    F = -1
    GlobalArr basestack, w$, rest$, i, F, , Reverse
    var(F).common = common
    
    p = i
    If i < 0 Then it = 0
    
    Case Else
    it = 0
    End Select
    End If
    
    Select Case it
    Case 5
    x = 0
    If FastSymbol(rest$, "=") Then
        If IsExp(basestack, rest$, x) Then
        If neoGetArray(basestack, w$, pppp) Then
        pppp.common = common
                     If Not basestack.lastobj Is Nothing Then
                            If Typename(basestack.lastobj) = "Group" Then
                            If basestack.lastobj.IamSuperClass Then

                            pppp.CopyGroupObj basestack.lastobj.SuperClassList, pppp.GroupRef
                                Set pppp.GroupRef = basestack.lastobj.SuperClassList
                                Set pppp.GroupRef.SuperClassList = basestack.lastobj.SuperClassList
                            Else
                                Set pppp.GroupRef = basestack.lastobj
                                End If
                                 pppp.IHaveClass = True
                                  Set basestack.lastobj = Nothing
                                 pppp.SerialItem 0, 0, 3
                            ElseIf Typename(basestack.lastobj) = "lambda" Then
                                    pppp.FillLambda basestack
                            ElseIf Typename(basestack.lastobj) = "mHandler" Then
                                  If basestack.lastobj.t1 = 4 Then pppp.Fillobj basestack Else Set basestack.lastobj = Nothing
                            Else
                            Set basestack.lastobj = Nothing
                     
                            End If
                            
                    Else
                            pppp.SerialItem x, 0, 3
                    End If
            Else
            it = 0
        End If
        Else
                MissNumExpr
                MyDim = False
                GoTo ex1
                
        End If
    ElseIf FastSymbol(rest$, "<<", , 2) Then
         F = 1
         s$ = aheadstatus(rest$, True, F)
         If F > 0 Then
                s$ = Left$(rest$, F - 1)
                rest$ = Mid$(rest$, F)
                If neoGetArray(basestack, w$, pppp) Then
                pppp.common = common
                        For i = 0 To pppp.UpperMonoLimit
                        If IsExp(basestack, (s$), x) Then
                                        If Not basestack.lastobj Is Nothing Then
                                                 If Typename(basestack.lastobj) = "Group" Then
                                                     Set pppp.GroupRef = Nothing
                                                     pppp.IHaveClass = False
                                                     If basestack.lastobj.IamSuperClass Then
                                                    Dim myobj As Object
                                          pppp.CopyGroupObj basestack.lastobj.SuperClassList, myobj
                        
                                              Set myobj.SuperClassList = basestack.lastobj.SuperClassList
                                              Set pppp.item(i) = myobj
                                              Set myobj = Nothing
                                             
                                               Else
                                                  
                                                       Set pppp.item(i) = basestack.lastobj
                                                      End If
                                                   
                                                      ' Stop
                                        ElseIf Typename(basestack.lastobj) = "mHandler" Then
                                        Set pppp.item(i) = basestack.lastobj
                                        ElseIf Typename(basestack.lastobj) = "mStiva" Then
                                        Set pppp.item(i) = basestack.lastobj
                                        ElseIf Typename(basestack.lastobj) = myArray Then
                                        Set pppp.item(i) = basestack.lastobj
                                                    Else
                                                        Set basestack.lastobj = Nothing
                                                        MyEr "object not supported", "Το αντικείμενο δεν υποστηρίζεται"
                                                        MyDim = False
                                                        GoTo ex1
                                                        Exit For
                                                     End If
                                                     
                                        Else
                                                pppp.item(i) = x
                                        End If
                                        
                        Else
                          Set basestack.lastobj = Nothing
                            MyDim = False
                            MissNumExpr
                            GoTo ex1
                            Exit For
                        End If
                        Next i
                          Set basestack.lastobj = Nothing
            Else
            it = 0
                End If
          End If
     
    
     End If
    Case 7
    x = 0
    If FastSymbol(rest$, "=") Then
    If IsExp(basestack, rest$, x) Then
   If neoGetArray(basestack, w$, pppp) Then ''basestack.GroupName &
   pppp.common = common
    If Typename(basestack.lastobj) = "lambda" Then
                                pppp.FillLambda basestack
                             
   Else
    pppp.SerialItem Int(x), 0, 3
    End If
    End If
    Else
                MissNumExpr
                MyDim = False
                GoTo ex1
    End If
   ElseIf FastSymbol(rest$, "<<", , 2) Then
         F = 1
         s$ = aheadstatus(rest$, True, F)
         If F > 0 Then
                s$ = Left$(rest$, F - 1)
                rest$ = Mid$(rest$, F)
                If neoGetArray(basestack, w$, pppp) Then
                pppp.common = common
                        For i = 0 To pppp.UpperMonoLimit
                        If IsExp(basestack, (s$), x) Then
                            If Typename(basestack.lastobj) = "lambda" Then
                                    Set pppp.item(i) = basestack.lastobj
                            ElseIf basestack.lastobj Is Nothing Then
                                    pppp.item(i) = Int(x)
                            Else
                                                     Set basestack.lastobj = Nothing
                                                        MyEr "Only Lambda objects here", "Μόνο λάμδα αντικείμενα εδώ"
                                                        MyDim = False
                                                        GoTo ex1
                                                        Exit For
                            End If
                        Else
                            Set basestack.lastobj = Nothing
                            MyDim = False
                                            MissNumExpr
                            GoTo ex1
                       
                        End If
                        Next i
                        Set basestack.lastobj = Nothing
            Else
            MissNumExpr
            GoTo ex1
                        it = 0
            End If
          End If
     End If
    Case 6
        s$ = vbNullString
    If FastSymbol(rest$, "=") Then
    If IsStrExp(basestack, rest$, s$) Then
   If neoGetArray(basestack, w$, pppp) Then '' basestack.GroupName &
   pppp.common = common
   If Typename(basestack.lastobj) = "lambda" Then
                                pppp.FillLambda basestack
    ElseIf Typename(basestack.lastobj) = "Group" Then
                                   If basestack.lastobj.IamSuperClass Then
                              pppp.CopyGroupObj basestack.lastobj.SuperClassList, pppp.GroupRef
                                Set pppp.GroupRef = basestack.lastobj.SuperClassList
                                Set pppp.GroupRef.SuperClassList = basestack.lastobj.SuperClassList
                            Else
                                Set pppp.GroupRef = basestack.lastobj
                                End If
                                 pppp.IHaveClass = True
                                  Set basestack.lastobj = Nothing
                                 pppp.SerialItem 0, 0, 3
                                         
   Else
    pppp.SerialItem s$, 0, 3
       End If
    End If
    Else
    MissStringExpr
    MyDim = False
    GoTo ex1
    End If
   ElseIf FastSymbol(rest$, "<<", , 2) Then
         F = 1
         s$ = aheadstatus(rest$, True, F)
         If F > 0 Then
                s$ = Left$(rest$, F - 1)
                rest$ = Mid$(rest$, F)
                If neoGetArray(basestack, w$, pppp) Then
                pppp.common = common
                        For i = 0 To pppp.UpperMonoLimit
                        If IsStrExp(basestack, (s$), ss$) Then
                            If Typename(basestack.lastobj) = "Group" Then
                                    Set pppp.GroupRef = Nothing
                                    pppp.IHaveClass = False
                                    Set pppp.item(i) = basestack.lastobj
                            ElseIf Typename(basestack.lastobj) = "lambda" Then
                                    Set pppp.item(i) = basestack.lastobj
                            ElseIf Typename(basestack.lastobj) = "mHandler" Then
                                        Set pppp.item(i) = basestack.lastobj
                                        ElseIf Typename(basestack.lastobj) = "mStiva" Then
                                        Set pppp.item(i) = basestack.lastobj
                                        ElseIf Typename(basestack.lastobj) = myArray Then
                                        Set pppp.item(i) = basestack.lastobj
                                    
                            ElseIf basestack.lastobj Is Nothing Then
                                    pppp.item(i) = ss$
                            Else
                                                     Set basestack.lastobj = Nothing
                                                        MyEr "object not supported", "Το αντικείμενο δεν υποστηρίζεται"
                                                        MyDim = False
                                                        GoTo ex1
                                                        Exit For
                            End If
                        Else
                            Set basestack.lastobj = Nothing
                            MyDim = False
                            MissStringExpr
                            GoTo ex1
                            Exit For
                        End If
                        Next i
                        Set basestack.lastobj = Nothing
            Else
                it = 0
                MyDim = False
                MissStringExpr
                GoTo ex1
            End If
          End If
     End If
    End Select
    If it = 0 Then
      MyEr "Array dimensions missing ", "Ο πίνακας δεν έχει διαστάσεις "

    rest$ = basestack.GroupName & w$ & rest$
    MyDim = False
    GoTo ex1
    End If
    If Not pppp Is Nothing Then
    If basestack.finalFlag Then pppp.final = True
    ElseIf F > 0 Then
    var(F).final = basestack.finalFlag
    End If
Loop Until Not FastSymbol(rest$, ",")
ex1:
If uselocalbase Then
ArrBase = oldbase
End If
Set basestack.lastpointer = Nothing
End Function
Function MyNew(basestack As basetask, rest$, Lang As Long) As Boolean
MyNew = True
If (basestack.Process Is Nothing) And (basestack.Parent Is Nothing) Then
Set basestack.StaticCollection = Nothing 'New FastCollection
basestack.IamAnEvent = False
abt = False
Set loadcatalog = New FastCollection
LASTPROG$ = vbNullString
Randomize Timer
Set comhash = New sbHash
allcommands comhash
Set numid = New idHash
Set funid = New idHash
Set strid = New idHash
Set strfunid = New idHash
NumberId numid, funid
StringId strid, strfunid
NoOptimum = False
If Lang = 0 Then
sHelp "Μ2000 [ΒΟΗΘΕΙΑ]", "Γράψε ΤΕΛΟΣ για να βγεις από το πρόγραμμα" & vbCrLf & "Δες τα ΟΛΑ (κάνε κλικ στο ΟΛΑ)" & vbCrLf & "George Karras 2018", (ScrInfo(Console).Width - 1) * 3 / 5, (ScrInfo(Console).Height - 1) * 1 / 7
Else
sHelp "Μ2000 [HELP]", "Write END for exit from this program" & vbCrLf & "See ALL commands  (click on ALL)" & vbCrLf & "George Karras 2018", (ScrInfo(Console).Width - 1) * 3 / 5, (ScrInfo(Console).Height - 1) * 1 / 7
End If
NERR = False
lckfrm = 0
subHash.ReduceHash 0, sbf()
sb2used = 0
ReDim sbf(50) As modfun
TaskMaster.Dispose

CloseAllConnections
CleanupLibHandles
' This is the INPUT END
If Not NOEDIT Then
NOEDIT = True
Else
If QRY Then QRY = False
End If
' restore DB.Provider for User
JetPrefixUser = JetPrefixHelp
JetPostfixUser = JetPostfixHelp
' SET ARRAY BASE TO ZERO
ArrBase = 0
End If

End Function
Function MyScan(basestack As basetask, rest$) As Boolean
Dim p As Variant, y As Double, s$
ClearJoyAll
PollJoypadk
If GetForegroundWindow <> Form1.hWND Or Not Targets Then
If IsExp(basestack, rest$, p) Then

End If
MyScan = True
MyDoEvents0 basestack.Owner
If FKey > 0 Then
If FK$(FKey) <> "" Then
    s$ = FK$(FKey)
    MyScan = interpret(basestack1, s$)
FKey = 0
End If
End If


 Exit Function
End If
If basestack.Owner.Visible = False Then basestack.Owner.Visible = True
basestack.Owner.SetFocus
NoAction = False

nomore = True
If IsExp(basestack, rest$, p) Then
y = Timer + p

Do ' TOO
MyDoEvents
Loop Until NoAction Or Timer > y Or NOEXECUTION
    'End If
Else
Do ' TOO
 MyDoEvents
If FKey > 0 Then
If FK$(FKey) <> "" Then
rest$ = FK$(FKey) + rest$
FKey = 0
Exit Do
End If
End If
Loop Until NoAction Or NOEXECUTION
End If
nomore = False ' TOO

End Function

Function MySeek(basestack As basetask, rest$) As Boolean
Dim x1 As Long, x As Variant
MySeek = True
IsSymbol3 rest$, "#"   ' OPTIONAL   ...SEEK #I, 10020  ΒΥΤΕ
If IsExp(basestack, rest$, x) Then
x1 = CLng(MyMod(Abs(x), 512))
If FLEN(x1) = 0 Then
MySeek = False
MyEr "not valid file number", "λάθος αριθμός αρχείου"
Exit Function
End If
If FLEN(x1) <> 1 Then
MySeek = False
MyEr "not valid file type", "λάθος ΤΥΠΟΣ αρχείου"
Exit Function
End If
If Not FastSymbol(rest$, ",") Then
MissNumExpr
Else
If IsExp(basestack, rest$, x) Then
Seek #x1, x
Else
''''MySeek = False  'I HAVE TO LOOK THAT
MissNumExpr
End If
End If
End If

End Function
Function MyClose(basestack As basetask, rest$, Lang As Long) As Boolean
Dim par As Boolean, p As Variant, ss$
MyClose = True
If Not IsLabelSymbolNew(rest$, "ΒΑΣΗ", "BASE", Lang) Then
    par = False
    Do
        IsSymbol3 rest$, "#" ' optional
        If IsExp(basestack, rest$, p) Then
            If p < 0 Then
            Else
            
            p = CLng(MyMod(Abs(p), 512))
            If FKIND(p) <> FnoUse Then
            Close p
            FLEN(p) = 0
            FKIND(p) = FnoUse
            End If
            End If
        Else
            If par Then
                MyClose = False
            Else
                closeAll
            End If
        Exit Do
        End If
        par = True
    Loop Until Not FastSymbol(rest$, ",")
Else
Do
If IsStrExp(basestack, rest$, ss$) Then
On Error Resume Next
If (ss$ Like "*.mdb") Or (ss$ Like "*:\*") Then ss$ = mylcasefILE(ss$)

 RemoveOneConn ss$
End If
Loop Until Not FastSymbol(rest$, ",")
End If

End Function
Function MyVol(basestack As basetask, rest$) As Boolean
Dim p As Variant
If IsExp(basestack, rest$, p) Then
    vol = CLng(MyMod(Abs(p), 101))
    If AVIRUN Then
        MediaPlayer1.setLeftVolume vol * 10
        MediaPlayer1.setRightVolume vol * 10
    Else
        MediaPlayer1.SetMasterVolume vol
    End If
End If
MyVol = True
End Function
Function MyHelp(basestack As basetask, rest$, Lang As Long) As Boolean
Dim s$
If Not basestack.IamChild Or Not mHelp Or Not basestack.IamAnEvent Then
mHelp = False
abt = False
lastAboutHTitle = vbNullString
If Abs(IsLabel(basestack, rest$, s$)) > 0 Then
    vH_title$ = vbNullString
    fHelp basestack, s$, AscW(s$ + Mid$(" Σ", Abs(pagio$ = "GREEK") + 1)) < 128
ElseIf Not ISSTRINGA(rest$, s$) Then
    nhelp basestack, Lang <> 1
Else
    fHelp basestack, s$, Lang = 1
End If
End If
MyHelp = True
End Function
Function MyClipboard(basestack As basetask, rest$) As Boolean
Dim s$, photo As cDIBSection
    If IsStrExp(basestack, rest$, s$) Then
        If (Left$(s$, 4) = "cDIB" And Len(s$) > 12) Then         ' MAGIC LETTERS cDIB choose the bitmap
            Set photo = New cDIBSection
            If Not cDib(s$, photo) Then  ' copy from string to cDIBSection
                Set photo = Nothing
                MissCdibStr
                Exit Function
            Else
                photo.GetDpi 96, 96
                photo.CopyToClipboard
                Set photo = Nothing
            End If
        Else
        Clipboard.Clear
              ' Clipboard.SetText s$, vbCFText  ' set as ansi text
           ' SetTextDataLong 16, GetLCIDFromKeyboard  '' this simulate the fault in VB6
           SetTextData CF_UNICODETEXT, s$   'set as unicode text
        End If
    End If
    MyClipboard = True
End Function
Function MyDelay(basestack As basetask, rest$) As Boolean
Dim p As Variant
If IsExp(basestack, rest$, p) Then
mywait basestack, p
Else
mywait basestack, 0
End If
MyDelay = True

End Function
Private Function MyMod(r1, po) As Variant
MyMod = r1 - Fix(r1 / po) * po
End Function
Function AddInventory(bstack As basetask, rest$, Optional ret2logical As Boolean = False) As Boolean
Dim p As Variant, s$, pppp As mArray, lastindex As Long
If Not bstack.lastobj Is Nothing Then
If Typename(bstack.lastobj) = "mHandler" Then
Dim aa As mHandler
Set aa = bstack.lastobj
Set bstack.lastobj = Nothing
If Not aa.objref Is Nothing Then
If TypeOf aa.objref Is FastCollection Then
Dim bb As FastCollection
Set bb = aa.objref
If bb.StructLen > 0 Then
MyEr "Structure members are ReadOnly", "Τα μέλη της δομής είναι μόνο για ανάγνωση"
Exit Function
End If

Dim ah As String
FastSymbol rest$, ","
again:
AddInventory = True
ah = aheadstatus(rest$, False) + " "
If InStr(ah, "l") Then
If ret2logical Then ret2logical = False: Exit Function
MyEr "No logical expression", "Όχι λογική έκφραση"
AddInventory = False
Else
If Left$(ah, 1) = "N" Then
    If Not IsExp(bstack, rest$, p) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
        AddInventory = False
        GoTo there
    End If
    If bb.ExistKey0(p) Then
        MyEr "Key exist, must be unique", "Το κλειδί υπάρχει, πρέπει να είναι μοναδικό"
        AddInventory = False
        GoTo there
    End If
    bb.AddKey p
ElseIf Left$(ah, 1) = "S" Then
    If Not IsStrExp(bstack, rest$, s$) Then
        AddInventory = False
        GoTo there
    End If
    If Not bstack.lastobj Is Nothing Then
        MyEr "No Object Allowed for Key", "Δεν επιτρέπεται αντικείμενο για κλειδί"
        AddInventory = False
        GoTo there
    End If
    If bb.ExistKey0(s$) Then
        MyEr "Key exist, must be unique", "Το κλειδί υπάρχει, πρέπει να είναι μοναδικό"
        AddInventory = False
        GoTo there
    End If
    bb.AddKey s$

Else
        MyEr "No Key found", "Δεν βρέθηκε κλειδί"
        AddInventory = False
        GoTo there

End If
lastindex = bb.index
If FastSymbol(rest$, ":=", , 2) Then
ah = aheadstatus(rest$, False) + " "
If Left$(ah, 1) = "N" Or InStr(ah, "l") > 0 Then
    If Not IsExp(bstack, rest$, p) Then
        AddInventory = False
        GoTo there
    End If
    bb.index = lastindex
    If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
        Set pppp = New mArray
        bstack.lastobj.CopyArray pppp
        Set bb.ValueObj = pppp
        Set pppp = Nothing
        
    Else
      Set bb.ValueObj = bstack.lastobj
    End If
        Set bstack.lastobj = Nothing
    Else
        bb.Value = p
    End If
    
ElseIf Left$(ah, 1) = "S" Then
    If Not IsStrExp(bstack, rest$, s$) Then
        AddInventory = False
        GoTo there
    End If
    bb.index = lastindex
    If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
        Set pppp = New mArray
        bstack.lastobj.CopyArray pppp
        Set bb.ValueObj = pppp
        Set pppp = Nothing
    Else
    
        Set bb.ValueObj = bstack.lastobj
    End If
        Set bstack.lastobj = Nothing
    Else
        bb.Value = s$
    End If

Else
        MyEr "No Data found", "Δεν βρέθηκαν στοιχεία"
        AddInventory = False
        GoTo there

End If


End If


End If
If FastSymbol(rest$, ",") Then GoTo again
there:
Set bb = Nothing
Set aa = Nothing

Exit Function
ElseIf TypeOf aa.objref Is mArray Then
While IsSymbol(rest$, ",")
If Not IsExp(bstack, rest$, p) Then
    MyEr "Expected Array", "Περίμενα Πίνακα"
    Set aa = Nothing
    Set bstack.lastobj = Nothing
    Exit Function
End If
Dim myobject As Object
Set myobject = bstack.lastobj
Set bstack.lastobj = Nothing
If CheckIsmArray(myobject) Then
Set pppp = myobject
pppp.AppendArray aa.objref
Else
    MyEr "Expected Array", "Περίμενα Πίνακα"
    Set aa = Nothing
    Set bstack.lastobj = Nothing
    Exit Function
End If
Wend
Set aa = Nothing
AddInventory = True
Exit Function
End If
End If
End If
MyEr "Wrong type of object (not Inventory or pointer to Array)", "Λάθος τύπος αντικειμένου (όχι Κατάσταση ή δείκτης σε Πίνακα)"
Set aa = Nothing
End If
Set bstack.lastobj = Nothing
End Function
Function Appfields(basestack As basetask, rest$) As Boolean
Dim s$, p As Variant

If IsExp(basestack, rest$, p) Then
Appfields = AddInventory(basestack, rest$)
ElseIf IsStrExp(basestack, rest$, s$) Then
Appfields = True
append_table basestack, s$, rest$, False
Else
SyntaxError
Appfields = False
End If
Exit Function
End Function
Function rValue(bstack As basetask, ob As Object) As Variant
Dim v$
 v$ = Typename(ob)
    If v$ Like "Gui*" Then
        Set bstack.lastobj = ob
        rValue = 0
    ElseIf v$ Like "Pro*" Then
   If IsObject(ob.Value) Then
       Set bstack.lastobj = ob.Value
        rValue = 0
   Else
        rValue = ob.Value
        End If
    ElseIf v$ Like "Gr*" Then
        rValue = 0
        Set bstack.lastobj = ob
       
    ElseIf v$ Like "mE*" Then
        CopyEvent ob, bstack
        rValue = 0
    ElseIf v$ = "lambda" Then
    
    CopyLambda ob, bstack
    rValue = 0
    ElseIf v$ = "mHandler" Then
    CopyHandler ob, bstack
    rValue = 0
    ElseIf v$ = myArray Then
    Set bstack.lastobj = CopyArray(ob)
    rValue = 0
    Else
    Set bstack.lastobj = Nothing
    rValue = 0
    End If
    
End Function
Sub refreshGui()
   Dim x As Form
                    For Each x In Forms
             
                    If Typename$(x) = "GuiM2000" Then
                    If x.enabled Then x.Refresh
                    End If
                    Next
                    Set x = Nothing
End Sub
Function ExecCode(basestack As basetask, rest$) As Boolean ' experimental
' ver .001
Dim p As Variant, mm As MemBlock, w2 As Long
    If IsExp(basestack, rest$, p) Then
        If Not basestack.lastobj Is Nothing Then
          If Not TypeOf basestack.lastobj Is mHandler Then
            Set basestack.lastobj = Nothing
            Exit Function
            End If
            With basestack.lastobj
                  If Not TypeOf .objref Is MemBlock Then
                      Set basestack.lastobj = Nothing
                      Exit Function
                  ElseIf .objref.NoRun Then
                       Set basestack.lastobj = Nothing
                       Exit Function
                  End If
            End With
            Set mm = basestack.lastobj.objref
            If mm.Status = 0 Then
            w2 = mm.GetPtr(0)
            If FastSymbol(rest$, ",") Then
            If Not IsExp(basestack, rest$, p) Then
                Set basestack.lastobj = Nothing
                Set mm = Nothing
                MissPar
                Exit Function
            End If
            If p < 0 Or p >= mm.SizeByte Then
                Set basestack.lastobj = Nothing
                Set mm = Nothing
                MyEr "Offset out of buffer", "Διεύθυνση εκτός διάρθρωσης"
                Exit Function
            End If

            SetUpForExecution w2, mm.SizeByte
            w2 = cUlng(uintnew(w2) + p)
            End If
            Set basestack.lastobj = Nothing
            Dim what As Long
            what = CallWindowProc(w2, 0&, 0&, 0&, 0&)
            If what <> 0 Then MyEr "Error " & what, "Λάθος " & what
            ReleaseExecution w2, mm.SizeByte
            ExecCode = what = 0
            Set mm = Nothing
            End If
            End If
        
    End If
End Function
Sub MouseShow(Yes As Boolean)
Dim k As Long, b1 As Boolean
If Yes Then
k = ShowCursor(True)
k1 = k = -1
If k < 0 Then
k = ShowCursor(True)
Do While k < 0
If k = -1 And k1 Then Exit Sub ' no mouse found
k = ShowCursor(True)
Loop
End If
Else

k = ShowCursor(False)
Do While k >= 0
k = ShowCursor(False)
Loop
End If
End Sub

Function GetAnewEvent() As Variant

Dim aa As New ComShinkEvent, bb As New mHandler
'Set aa.Callback = Form1
Set bb.objref = aa
 bb.t1 = 3
Set GetAnewEvent = bb
End Function
Public Function CallEventFromCOM(evCom As ComShinkEvent, aString$, what$, NumVar As Long, vrs(), exclude As Boolean) As Boolean
Dim tr As Boolean, extr As Boolean, olescok As Boolean
Dim F$, F1$, klm As Long
'olescok = escok
'escok = False
CallEventFromCOM = True
F1$ = evCom.modulename$
F$ = UCase(F1$ + "_" + aString$ + "()") ' No greek
'Debug.Print f$
If Not subHash.Find(F$, klm) Then exclude = True: Exit Function
extr = extreme
extreme = True
tr = trace
trace = False
Dim n$, bb As mStiva, oldbstack As mStiva, nowtotal As Long
Dim bstack As basetask
Set bstack = New basetask
Set bstack.Owner = Form1.DIS
Set bstack.StaticCollection = EventStaticCollection
bstack.IamAnEvent = True
Dim i As Long
i = evCom.VarIndex
F1$ = evCom.modulename$
Set oldbstack = bstack.soros
Dim j As Long, k As Long, s1$, s2$
Dim ohere$
ohere$ = here$
here$ = vbNullString

If evCom.Attached Then
Set bb = New mStiva
Set bstack.Sorosref = bb
            PushStage bstack, False
            
            For k = 1 To NumVar
            Select Case VarType(vrs(k))
            Case vbString
            globalvar "EV" + CStr(i + k) + "$", vrs(k)
            bb.DataStr "EV" + CStr(i + k) + "$"
            Case Is >= vbArray
            ' make it normal
            globalvar "EV" + CStr(i + k) + "(", RetM2000array(vrs(k))
            bb.DataStr "EV" + CStr(i + k)
            Case Else
            globalvar "EV" + CStr(i + k), vrs(k)
            bb.DataStr "EV" + CStr(i + k)
            End Select
            
            
            Next k
            '''bb.DataObj evCom
            '' last is the second name, the class name??
            bb.DataStr what$
     
            bb.DataObj MakeitObjectGeneric(evCom.VarIndex)
  
            'f$ = aString$
            
           '' WE ARE GOING TO OUR MODULE
           
            here$ = evCom.modulenameonly

            If FastCallModule(bstack, klm) <> 1 Then
            
            
            
                PopStage bstack
                bb.Flush
                GoTo conthere
            End If
                  here$ = vbNullString
                  If NumVar > 0 Then
       For k = LBound(vrs()) To UBound(vrs()) - 1
       Select Case VarType(vrs(k))
       Case vbString
            GetlocalVar "EV" + CStr(i + k) + "$", j
            vrs(k) = var(j)
       Case Is >= vbArray
            GetlocalVar "EV" + CStr(i + k) + "(", j
            RetComArray var(j), vrs(k)
       
        Case Else
            GetlocalVar "EV" + CStr(i + k), j
             vrs(k) = var(j)
            End Select
           
            Next k
            End If
            PopStage bstack

            bb.Flush

End If

conthere:
Set bstack.Sorosref = oldbstack
here$ = ohere$
Set oldbstack = Nothing
Set bb = Nothing
extreme = extr
trace = tr

'escok = olescok
End Function
Sub RetComArray(varFrom As Variant, varTo As Variant)
Dim ar As mArray, v()
Set ar = varFrom
ar.CopyBackSerialize v()
varTo = v()
End Sub
Function RetM2000array(var As Variant) As Variant
Dim ar As New mArray, v(), manydim As Long, probe As Long, probelow As Long
Dim j As Long
v() = var
On Error GoTo ma100
For j = 1 To 60
    probe = UBound(v, j)
    If Err Then Exit For
Next j
manydim = j - 1
On Error Resume Next
For j = manydim To 1 Step -1
    
    probe = UBound(v, j)
    If Err Then Exit For
    probelow = LBound(v, j)
    ar.PushDim probe - probelow + 1
Next j
ar.PushEnd
ar.RevOrder = True
ar.CopySerialize v()
ma100:
Set RetM2000array = ar

End Function
Function FastCallModule(bstack As basetask, mod_id As Long) As Long
Dim i As Long, frm$
 If myexit(bstack) Then FastCallModule = 0: Exit Function
 frm$ = Mid$(sbf(mod_id).sb, 1)
 FastCallModule = Execute(bstack, frm$, False, False)
 
 
End Function

Function MakeATypeLib(v As Variant, Optional usetypelib As Boolean = False) As FastCollection
    Dim obj             As Object, vv As FastCollection
    ' create the requested object
    
    Set obj = v
    If usetypelib Then
            ' find typelib and load it
    Set MakeATypeLib = New FastCollection
    Else
    Call GetAllMembers(vv, obj)
    Set MakeATypeLib = vv
    Set vv = Nothing
    End If
    Set obj = Nothing
End Function

Function FindPrevOriginal(bstack As basetask) As Long
Dim curparent As basetask, cur As basetask
'If bstack.IamThread Then
'FindPrevOriginal = bstack.Parent.OriginalCode
'Exit Function
'End If
Set cur = bstack
Set curparent = cur.Parent
If curparent Is Nothing Then FindPrevOriginal = cur.OriginalCode: Exit Function
If curparent.OriginalCode = 0 Then FindPrevOriginal = cur.OriginalCode: Exit Function
Do While curparent.OriginalCode = cur.OriginalCode And curparent.OriginalCode <> 0
Set cur = curparent
Set curparent = cur.Parent
If curparent Is Nothing Then FindPrevOriginal = cur.OriginalCode: Exit Function
Loop
FindPrevOriginal = curparent.OriginalCode
End Function
Function iter(bstack As basetask, rest$, Lang As Long) As Boolean
' each( array or inventory, start: 1 by default, or -1 for end of list,  end: -1 to end (optional), or we can set it)
    Dim pppp As mArray, w1 As Long, s$, num As Long, st As Variant, en As Variant
    
    w1 = Abs(IsLabel(bstack, rest$, s$))
    If w1 > 4 Then
    If neoGetArray(bstack, s$, pppp) Then
        If pppp.Arr Then
            If FastSymbol(rest$, ")") Then
            If Not IsSymbol(rest$, ",") Then
            ' READ KEYWORDS
                st = 1: en = -1
                If IsLabelSymbolNew(rest$, "ΑΡΧΗ", "START", Lang) Then
                    st = 1
                ElseIf IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", Lang, , , , False) Then
                ElseIf IsExp(bstack, rest$, st) Then
                    st = Int(st)
                Else
                    st = 1
                End If
                If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", Lang, , , , False) Then
                    If IsLabelSymbolNew(rest$, "ΑΡΧΗ", "START", Lang, , , , False) Then
                        en = 1
                    ElseIf IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", Lang, , , , False) Then
                        en = -1
                    ElseIf IsExp(bstack, rest$, en) Then
                        en = Int(en)
                    Else
                        MyEr "To where?", "Έως που;"
                        Exit Function
                    End If
                Else
                    en = -1
                End If
            Else
                If Not IsExp(bstack, rest$, st) Then st = 1
                If Not IsSymbol(rest$, ",") Then
                    en = -1
                ElseIf Not IsExp(bstack, rest$, en) Then
                    MissNumExpr
                    Exit Function
                End If
            End If
            Set bstack.lastobj = New mHandler
           Set bstack.lastobj.objref = pppp
            PlaceIteratorData bstack, var(0), st, en
            iter = True
            Exit Function
            End If
            
        End If
        End If
    ElseIf GetVar(bstack, s$, w1) Then
        If Typename(var(w1)) = "mHandler" Then
conthere111:
         
       If Not IsSymbol(rest$, ",") Then
                st = 1: en = -1
        If IsLabelSymbolNew(rest$, "ΑΡΧΗ", "START", Lang, , , , False) Then
                    st = 1
                ElseIf IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", Lang, , , , False) Then
                    st = -1
                ElseIf IsExp(bstack, rest$, st) Then
                    st = Int(st)
                Else
                    st = 1
                End If
                If IsLabelSymbolNew(rest$, "ΕΩΣ", "TO", Lang, , , , False) Then
                
                    If IsLabelSymbolNew(rest$, "ΑΡΧΗ", "START", Lang, , , , False) Then
                        en = 1
                    ElseIf IsLabelSymbolNew(rest$, "ΤΕΛΟΣ", "END", Lang, , , , False) Then
                        en = -1
                    ElseIf IsExp(bstack, rest$, en) Then
                        en = Int(en)
                    Else
                        MyEr "To where?", "Έως που;"
                        Exit Function
                    End If
                Else
                    en = -1
                End If
            Else
                If Not IsExp(bstack, rest$, st) Then st = 1
                If Not IsSymbol(rest$, ",") Then
                    en = -1
                ElseIf Not IsExp(bstack, rest$, en) Then
                    MissNumExpr
                    Exit Function
                End If
                Set bstack.lastobj = New mHandler
         bstack.lastobj.t1 = var(w1).t1
                GoTo con12345
            End If
            
        If Typename(var(w1)) <> "mHandler" Then
        On Error GoTo there1
          If Typename(var(w1).objref) <> myArray Then
           
           Set bstack.lastobj = Nothing
           MyEr "Not proper object for iterator", "Δεν είναι σωστό αντικείμενο για επανάληψη"
           Exit Function
           End If
          End If
there1:
          Err.Clear
          
           Set bstack.lastobj = New mHandler
con12345:
            PlaceIteratorData bstack, var(w1), st, en
            iter = True
        End If
    End If


End Function
Function ClearLabels()
If sb2used > 0 Then
Dim i As Long
For i = 1 To sb2used
Set sbf(i).subs = Nothing
Next i
End If
End Function
Function MyIsNumeric(v As Variant) As Boolean
Dim n As Integer
GetMem2 VarPtr(v), n
MyIsNumeric = (n < 8) Or (n = 11) Or (n = 17) Or (n = 14)
End Function
Function MyIsObject(v As Variant) As Boolean
Dim n As Integer
GetMem2 VarPtr(v), n
MyIsObject = n = 9
End Function
Function MyVal(v As Variant) As Variant
On Error GoTo there1245
MyVal = v
Exit Function
there1245:
On Error GoTo there1246
MyVal = val(v)
there1246:
End Function

Function DriveSerial1(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
    Dim s$
    If IsStrExp(bstack, a$, s$) Then
    r = SG * DriveSerial(Left$(s$, 3))
  
    
    
    DriveSerial1 = FastSymbol(a$, ")", True)
    Else
         MissParam a$
    End If
End Function
Function ThisPointer(bstack As basetask, w3 As Long) As Boolean ' return var(r)
Dim s1$
    Set bstack.lastobj = Nothing
     If bstack.UseGroupname <> "" Then
     s1$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
     If GetVar(bstack, s1$, w3) Then
          ThisPointer = True
     ElseIf GetVar(bstack, bstack.fHere + "." + s1$, w3) Then
          ThisPointer = True
          ElseIf GetVar(bstack, s1$, w3, True) Then
          ThisPointer = True
    End If
    Else
there:
    's1$ = "."
    s1$ = ""
    If bstack.GetDotNew(s1$, 1) Then
    If Len(s1$) = 0 Then Exit Function
    s1$ = Left$(s1$, Len(s1$) - 1)
        If GetVar(bstack, s1$, w3) Then
            ThisPointer = True
    End If
    End If
    End If
    
    
    

End Function

Function This1(bstack As basetask, original$, r As Variant) As Boolean  ' return a copy
Dim s1$, w3 As Long
    Set bstack.lastobj = Nothing
     If bstack.UseGroupname <> "" Then
     s1$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
     If GetVar(bstack, s1$, w3) Then
          Set bstack.lastobj = CopyGroupObj(var(w3))
     ElseIf GetVar(bstack, bstack.fHere + "." + s1$, w3) Then
          Set bstack.lastobj = CopyGroupObj(var(w3))
          ElseIf GetVar(bstack, s1$, w3, True) Then
           Set bstack.lastobj = CopyGroupObj(var(w3))
          
    End If
    Else
there:
    s1$ = ""
    If bstack.GetDotNew(s1$, 1) Then
    If Len(s1$) = 0 Then
        If GetVar(bstack, original$, w3) Then
            If MyIsObject(var(w3)) Then
            Set bstack.lastobj = var(w3)
            r = 0
            Else
            r = var(w3)
            End If
            This1 = True
        Else
        MyEr "Not Defined variable " + original$, "Δεν έχει οριστεί μεταβλητή " + original$
        This1 = False
         End If
    Exit Function
    Else
    s1$ = Left$(s1$, Len(s1$) - 1)
        If GetVar(bstack, s1$, w3) Then
        If MyIsObject(var(w3)) Then
            If TypeOf var(w3) Is Group Then
                Set bstack.lastobj = CopyGroupObj(var(w3))
            Else
                Set bstack.lastobj = var(w3)
            End If
            r = 0
            Else
            r = var(w3)
            End If
            This1 = True
           Exit Function
        
    End If
    End If
    End If
    End If
    
     r = 0
    This1 = True

End Function
Function StackItem(bstack As basetask, a$, SG, r) As Boolean
Dim p As Variant, w3 As Long, anything As Object
w3 = 1
If IsExp(bstack, a$, p) Then
If bstack.lastobj Is Nothing Then
    Set anything = bstack.soros
    w3 = Abs(CLng(Fix(p)))
ElseIf Not CheckStackObj(bstack, anything, w3) Then
    MyEr "Not a stack object", "Δεν είναι αντικείμενο σωρού"
    Exit Function
ElseIf FastSymbol(a$, ",") Then
If IsExp(bstack, a$, p) Then
    w3 = Abs(CLng(Fix(p)))
End If
End If
    
backitem:
    If anything.Total < w3 Then
    
            MyErMacro a$, "Stack item not found at position " & CStr(w3), "Δεν υπάρχει τιμή σωρού στη θέση " & CStr(w3)
  
        StackItem = False: Exit Function

    ElseIf anything.StackItemType(w3) = "N" Then
    
    r = anything.StackItem(w3)
    If SG < 0 Then r = -r
    
    StackItem = FastSymbol(a$, ")", True)
    Exit Function
    ElseIf anything.StackItemType(w3) = "L" Then
    
    r = anything.StackItem(w3)
    If SG < 0 Then r = -r
    
    StackItem = FastSymbol(a$, ")", True)
    Exit Function
    ElseIf anything.StackItemType(w3) = "*" Then
    r = 0
    
    Set bstack.lastobj = anything.StackPickRef(w3).ObjectRef
    
    StackItem = FastSymbol(a$, ")", True)
    Exit Function
    'Else
    'MyErMacro a$, "Stack item isn't a proper object " & CStr(W3), "Η τιμή του σωρού δεν έχει κατάλληλο αντικείμενο " & CStr(W3)
    'End If
    Else
     
            MyErMacro a$, "Stack item isn't number at position " & CStr(w3), "Η τιμή του σωρού δεν είναι αριθμός στη θέση " & CStr(w3)
  
    StackItem = False
    End If
    Exit Function

Else
w3 = 1
Set anything = bstack.soros
GoTo backitem
End If
End Function
Public Function LambdaList(bstack As basetask) As String
On Error Resume Next
LambdaList = var(-bstack.OriginalCode).code$
End Function
Sub PrepareLabel(bstack As basetask)

   If Not bstack.IamLambda Then
  Dim mmm$


If SecureNames Then
mmm$ = sbf(bstack.OriginalCode).goodname
Else
mmm$ = here$
End If
 mmm$ = CleanStr(mmm$, ChrW(-65))
    If InStr(mmm$, "].") > 0 Then
        mmm$ = Mid$(mmm$, InStr(mmm$, "].") + 2)
    End If
   ' If AscW(MMM$) = 8191 Then MMM$ = Mid$(MMM$, 8)
    If bstack.fHere <> "" And InStr(bstack.fHere, "(") > 0 Then mmm$ = bstack.fHere + "." + mmm$
    End If
    If InStr(mmm$, ChrW(8191)) > 0 Then
    DropLeft ChrW(8191), mmm$
    If InStr(mmm$, ChrW(8191)) > 0 Then
    DropLeft ChrW(8191), mmm$
    End If
    If InStr(mmm$, ".") > 0 Then
    DropLeft ".", mmm$
    GoTo conthere
    Else
    If Right$(mmm$, 2) = "()" Then
        mmm$ = Left$(mmm$, Len(mmm$) - 2)
    End If
    
     If pagio$ = "GREEK" Then
         Form2.Label1prompt(0) = "Τελεστής "
     Else
            Form2.Label1prompt(0) = "Operator "
     End If
     End If
    Else
conthere:
    If bstack.IamThread Then
  If pagio$ = "GREEK" Then
  Form2.Label1prompt(0) = "ΝΗΜΑ(" + CStr(bstack.Process.Id) + "): "
  Else
  Form2.Label1prompt(0) = "THREAD(" + CStr(bstack.Process.Id) + "): "
  End If
  
    Else
    If pagio$ = "GREEK" Then
        If bstack.fHere <> "" Or Right$(mmm$, 2) = "()" Then
        If bstack.IamLambda Then
        If Right$(here$, 3) = "$()" Then
            Form2.label1(0) = "ΛΑΜΔΑ$()"
            Else
            Form2.label1(0) = "ΛΑΜΔΑ()"
            End If
            Exit Sub
        Else
            Form2.Label1prompt(0) = "Συνάρ.: "
        End If
        Else
            Form2.Label1prompt(0) = "Τμήμα: "
        End If
  Else
        If bstack.fHere <> "" Or Right$(mmm$, 2) = "()" Then
         If bstack.IamLambda Then
         If Right$(here$, 3) = "$()" Then
            Form2.label1(0) = "LAMBDA$()"
            Else
            Form2.label1(0) = "LAMBDA()"
            End If
            Exit Sub
         Else
        Form2.Label1prompt(0) = "Func.: "
        End If
  Else
  Form2.Label1prompt(0) = "Module: "
  End If
  End If
 End If
    
    
    
    End If
    
    Form2.label1(0) = GetName$(mmm$)
     
     
    
    
  
End Sub

Public Function TraceThis(bstack As basetask, di As Object, b$, w$, SBB$) As Boolean
    TraceThis = True
    PrepareLabel bstack
    Form2.label1(1) = w$
    Form2.label1(2) = GetStrUntil(vbCrLf, b$ & vbCrLf, False)
    If WaitShow = 0 Or Len(b$) < WaitShow Then
        WaitShow = 0
        If bstack.OriginalCode < 0 Then
            SBB$ = GetNextLine((var(-bstack.OriginalCode).code$))
        Else
            SBB$ = GetNextLine((sbf(Abs(bstack.OriginalCode)).sb))
        End If
        If Left$(SBB$, 10) = "'11001EDIT" Then
            TestShowSub = Mid$(sbf(Abs(bstack.OriginalCode)).sb, Len(SBB$) + 3)
            If TestShowSub = vbNullString Then
                TestShowSub = Mid$(sbf(FindPrevOriginal(bstack)).sb, Len(SBB$) + 3)
            End If
            If InStr(TestShowSub, b$) = 0 Then
                WaitShow = Len(b$)
            End If
        Else
            If bstack.OriginalCode <> 0 Then
                If bstack.OriginalCode < 0 Then
                    TestShowSub = var(-bstack.OriginalCode).code$
                Else
                    TestShowSub = sbf(Abs(bstack.OriginalCode)).sb
                End If
            Else
                If bstack.IamThread Then
                    If bstack.Process Is Nothing Then
                    Else
                        TestShowSub = bstack.Process.CodeData
                    End If
                Else
                    TestShowSub = b$
                End If
            End If
        End If
    End If
    If bstack.addlen Then
        If Len(TestShowSub) - bstack.addlen > 0 Then
            TestShowStart = rinstr(Left$(TestShowSub, Len(TestShowSub) - bstack.addlen), Mid$(b$, 2)) - 1
        Else
            TestShowStart = 1
        End If
    Else
        TestShowStart = rinstr(TestShowSub, b$)
    End If
    If TestShowStart <= 0 Then
        TestShowStart = rinstr(TestShowSub, Mid$(b$, 2)) - 1
    End If
    bypassST = False
    Set Form2.Process = bstack
    stackshow bstack
    If Not Form1.Visible Then
        Form1.Show , Form5   'OK
    End If

    If STbyST Then
        STbyST = False
        If Not STEXIT Then
            If Not STq Then
                Form2.gList4.ListIndex = 0
            End If
        End If
        If Not TaskMaster Is Nothing Then
            If TaskMaster.QueueCount > 0 And TaskMaster.Processing Then TaskMaster.StopProcess
        End If
        Do
            BLOCKkey = False
            If di.Visible Then di.Refresh
            ProcTask2 bstack
        Loop Until STbyST Or STq Or STEXIT Or bypassST Or NOEXECUTION Or myexit(bstack) Or Not Form2.Visible
        If Not TaskMaster Is Nothing Then
           If TaskMaster.QueueCount > 0 And Not TaskMaster.Processing Then TaskMaster.StartProcess
        End If
        If Not STEXIT Then
            If Not STq Then
                Form2.gList4.ListIndex = 0
            End If
        End If
        STq = False
        If STEXIT Then
            NOEXECUTION = True
            trace = False
            STEXIT = False
            TraceThis = False
            Exit Function
        End If
    Else
If tracecounter > 0 Then If Not IsWine Then MyDoEvents1 Form2, True

    End If
    If STEXIT Then
        trace = False
        STEXIT = False
        TraceThis = False
        Exit Function
    End If
End Function

Private Function exeSelect(ExecuteLong, once, bstack As basetask, b$, v As Long, Lang As Long) As Boolean
Dim ok As Boolean, x1 As Long, y1 As Long, sp As Variant, st As Variant, sw$, slct As Long, ss$
Dim x2 As Long, y2 As Long, p As Variant, w$, DUM As Boolean, i As Long
        exeSelect = True
        x1 = 0 ' mode numbers using p, sp and st
                ' x1=2 using sw$ w$ ss$

            If IsLabelSymbolNew(b$, "ΜΕ", "CASE", Lang) Then
            
                        If IsExp(bstack, b$, sp) Then
                        x1 = 1
                        ElseIf IsStrExp(bstack, b$, sw$) Then
                        x1 = 2
                        End If
                    If x1 > 0 Then ' SELECT CASE NUMBER or STRING
                        SetNextLine b$
                    slct = 1
                       If NocharsInLine(b$) Then
                       ExpectedCaseorElseorEnd
                        ExecuteLong = 0
                            Exit Function
                            End If
                        Do
                        If NocharsInLine(b$) Then
               
                            Exit Do
                        End If
                                If IsLabelSymbolNew(b$, "ΜΕ", "CASE", Lang) Then  ' WE HAVE CASE
                                           If ok Then
                                ExpectedEndSelect
                                ExecuteLong = 0
                                Exit Function
                  
                                    End If
                                If slct > 0 Then         ' WE ARE IN SEARCH
                                Do
                                ' εδώ κοιτάμε τα CASE
                                x2 = 0
                                If x1 = 1 Then
                                If IsExp(bstack, b$, p) Then x2 = 1
                                Else
                                If IsStrExp(bstack, b$, w$) Then x2 = 2
                                End If
                                       If x2 > 0 Then 'WE HAVE NUMBER OR STRING
                                            If IsLabelSymbolNew(b$, "ΕΩΣ", "TO", Lang) Then   ' range ?
                                            y1 = 0
                                               If x1 = 1 Then
                                                    If IsExp(bstack, b$, st) Then y1 = 1

                                                Else
                                                    If IsStrExp(bstack, b$, ss$) Then y1 = 2
                                                End If
                                                If y1 > 0 Then
                                                y2 = 0
                                                   If x1 = 1 Then
                                                    If (sp >= p And sp <= st) Then y2 = 1

                                                Else
                                                    If sw$ >= w$ And sw$ <= ss$ Then y2 = 2
                                                End If
                                                    If y2 > 0 Or slct = -1 Then 'slct=-1 from break
                                                   If slct = 1 Then slct = 0   ' slct=0 we found
                                                   ' start ExecuteLong command or block
                                    
                                          '  Stop
                                            End If
                                                Else
                                                    MyEr "Wrong expression type in To clause in Case", "Λάθος τύπος έκφρασης στην Έως στην Με"
                                                    ExecuteLong = 0
                                                    Exit Function
                                                End If
                                            Else
                                            ' NO WE HAVE ONE VALUE...X1 MASTER, X2 ONE VALUE  Y2 FOR LAST CHECK
                                                y2 = 0
                                                If x1 = 1 Then
                                                    If sp = p Then y2 = 1
                                                Else
                                                    If w$ = sw$ Then y2 = 2
                                                End If
                                                If y2 > 0 Or slct = -1 Then ' ONE VALUE
                                                     If slct = 1 Then slct = 0
                                                End If
                                            End If
                                        Else
                                            If x1 = 1 Then
                                                b$ = Str$(sp) & " " & b$
                                            Else
                                                ' HERE............................IS A PROBLEM IF SW$ HAS <3 ASCII CODE
                                                b$ = Sput(sw$) + b$
                                            End If
                                        If IsExp(bstack, b$, p) Then
                                            If p <> 0 Or slct = -1 Then
                                             If slct = 1 Then slct = 0
                                             ' start ExecuteLong command or block
                                             End If
                                        Else
                                        MyEr "Expected logic half expression in Case", "Περίμενα λογική μισή έκφραση στην Με"
                                        ExecuteLong = 0
                                        Exit Function
                                        End If
                                        End If
                                        If slct = 0 Then
                                            If Left$(b$, 4) = vbCrLf + vbCrLf Then
                                                                ExpectedCaseorElseorEnd
                                                                b$ = Mid$(b$, 3)
                                                                v = Len(b$)
                                                                
                                                                ExecuteLong = 0: Exit Function
                                                                End If
                                                    SetNextLine b$
                                                         v = Len(b$)
                                                        If FastSymbol(b$, "{") Then  ' block
                                                          v = Len(b$)
                                                          ss$ = block(b$)
                                                            DUM = False
                                                            i = 1
                                                            ' #3 call a block
                                                            Call executeblock(i, bstack, ss$, False, DUM)
                                                           
                                                            
                                                            'b$ = ss$ & b$
                                                            If i = 1 Then
                                                            FastSymbol b$, "}"
                                                            If Not MaybeIsSymbol(b$, "'\") Then
                                                            If Not Left$(b$, 2) = vbCrLf Then
                                                                ExpectedCommentsOnly
                                                                ExecuteLong = 0: Exit Function
                                                            End If
                                                            End If
                                                            Else
                                                            b$ = ss$ & b$
                                                            If i = 0 Then
                                                                ExecuteLong = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                If DUM = True And b$ <> "" Then
                                                                slct = -1
                                                                Else
                                                                GoTo ContGoto
                                                                End If
                                                            ElseIf i = 3 Then
                                                               If DUM = True And b$ <> "" Then slct = 0
                                                            End If
                                                            End If
                                                        Else   ' or line
                                                            DUM = True
                                                        
                                                            i = 1
                                                            
                                                            While IsLabelSymbolNew(b$, "ΜΕ", "CASE", Lang)
                                                           SetNextLine b$
                                                         v = Len(b$)
                                                            Wend
                                                            ' #4 call one command
                                                            Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Or Left$(b$, 4) = vbCrLf + vbCrLf Then
                                                             If Left$(b$, 4) = vbCrLf + vbCrLf Then ExpectedCaseorElseorEnd
                                                                b$ = Mid$(b$, 3)
                                                                v = Len(b$)
                                                                
                                                                ExecuteLong = 0: Exit Function
                                                            ElseIf i = 1 And b$ = vbNullString Then 'this is an exit ΟΚ3
                                                           '' B$ = ss$
                                                            ExecuteLong = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                                       
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            ExecuteLong = 2
                                                                            once = False
                                                                             Exit Function
                                                                          Else
                                                                        ExecuteLong = i
                                                                         once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                           ''     If DUM = True And B$ <> "" Then slct = 0: B$ = GetNextLine(ss$) 'ok
                                                                If DUM = True And b$ <> "" Then slct = 0  '': B$ = GetNextLine(ss$) 'ok
                                                            End If
                                                       'ΟΚ
                                                        End If
                                                        Exit Do
                                        End If
                                    Loop While FastSymbol(b$, ",")
                                    
                                     End If
                                SetNextLine b$
                                                                     If Left$(b$, 2) = vbCrLf Then
                                                                     ExpectedCaseorElseorEnd
                                                                v = Len(b$)
                                                                ExecuteLong = 0
                                                                Exit Function
                                                                End If
                                ' drop case
                                
                                If IsLabelSymbolNew(b$, "ΜΕ", "CASE", Lang, , , True) Then
         
                                ElseIf IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang, , , True) Then
       
                                ElseIf IsLabelSymbolNew(b$, "ΤΕΛΟΣ", "END", Lang, , , True) Then
                             
                                Else
                                    v = Len(b$)
                                    If FastSymbol(b$, "{") Then
                                           If slct >= 0 Then
                                                    ss$ = block(b$) + "}"
                                                    b$ = NLtrim$(Mid$(b$, 2))
                                            Else
                                                    v = Len(b$)
                                                    ss$ = block(b$)
                                                    DUM = False
                                                    i = 1
                                                    ' #7 call block inside Case (Break) ok
                                                            Call executeblock(i, bstack, ss$, False, DUM)
                                                            If i = 1 Then
                                                            FastSymbol b$, "}"
                                                            If Not MaybeIsSymbol(b$, "'\") Then
                                                            If Not Left$(b$, 2) = vbCrLf Then
                                                                ExpectedCommentsOnly
                                                                ExecuteLong = 0: Exit Function
                                                            End If
                                                            End If
                                                                    Else
                                                            b$ = ss$ & b$
                                                            If i = 0 Then
                                                               
                                                                ExecuteLong = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                    If DUM = True And b$ <> "" Then
                                                                    slct = -1
                                                                    Else
                                                                    GoTo ContGoto
                                                                    End If
                                                           
                                                             ElseIf i = 3 Then
                                                                    If DUM = True And b$ <> "" Then slct = 0
        
                                                             End If
                                                            End If
                                            End If
                                     
                                        SetNextLine b$
                                      ElseIf slct < 0 Then
                                                        DUM = True
                                                   
                                                            i = 1
                                                            ' #8 call one command inside Case (Break) ok
                                                            Call executeblock(i, bstack, b$, True, DUM)
                        
                                                            If i = 0 Then   ' where is exit
                                                                b$ = Space$(v)
                                                                ExecuteLong = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                    
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            ExecuteLong = 2
                                                                            once = False
                                                                             Exit Function
                                                                          Else
                                                                            ExecuteLong = i
                                                                            once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0: b$ = GetNextLine(ss$)
                                                            End If
        
                                    SetNextLine b$
                                    Else
                                    SetNextLine b$
                                
                                        End If
                                    
                                End If
                                
                                ElseIf IsLabelSymbolNew(b$, "ΑΛΛΙΩΣ", "ELSE", Lang) Then
                                           If ok Then
                                ExpectedEndSelect
                                ExecuteLong = 0
                                Exit Function
                                Else
                                    ok = True
                                    End If
                                    SetNextLine b$
                                    v = Len(b$)
                                    If FastSymbol(b$, "{") Then
                                    v = Len(b$)
                                        ss$ = block(b$)
                                        b$ = NLtrim$(Mid$(b$, 2))
                                        If slct > 0 Then
                                                    v = Len(b$)
                                                    DUM = False
                                                    i = 1
                                                    ' #9 call block inside Else
                                                       Call executeblock(i, bstack, ss$, False, DUM)
                                                       If i = 1 Then
                                                            FastSymbol b$, "}"
                                                            If Not MaybeIsSymbol(b$, "'\") Then
                                                            If Not Left$(b$, 2) = vbCrLf Then
                                                                ExpectedCommentsOnly
                                                                ExecuteLong = 0: Exit Function
                                                            End If
                                                            End If
                                                            Else
                                                              b$ = ss$ & b$
                                                                 If i = 0 Then
                                                        
                                                        ExecuteLong = 0: Exit Function
                                                            ElseIf i = 2 Then
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                        GoTo ContGoto
                                                                          Else
                                                                            once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                                If DUM = True And b$ <> "" Then slct = 0: b$ = GetNextLine(ss$)
                                                            End If
                                                            End If
                                        End If
                                    Else
                                    If slct > 0 Then
                                                                       DUM = True
                                             
                                                            i = 1
                                                            ' #10 call one command inside ELSE
                                                            Call executeblock(i, bstack, b$, True, DUM)
                                                            If i = 0 Then
                                                                b$ = Space$(v)
                                                                ExecuteLong = 0: Exit Function
                                                            ElseIf i = 1 And b$ = vbNullString Then 'this is an exit
                                             
                                                            ExecuteLong = 1
                                                            Exit Function
                                                            ElseIf i = 2 Then
                                                              
                                                                          If DUM = True And b$ <> "" Then
                                                                            slct = -1
                                                                          ElseIf b$ <> "" Then
                                                                            ExecuteLong = 2
                                                                            once = False
                                                                             Exit Function
                                                                          Else
                                                                          ExecuteLong = i
                                                                            once = True
                                                                            Exit Function
                                                                        End If
                                                            ElseIf i = 3 Then
                                                    If DUM = True And b$ <> "" Then slct = 0
                                              End If
                                    End If
                                End If
                                SetNextLine b$
                                slct = 0
                        ElseIf IsLabelSymbolNew(b$, "ΤΕΛΟΣ", "END", Lang) Then
                            If IsLabelSymbolNew(b$, "ΕΠΙΛΟΓΗΣ", "SELECT", Lang) Then
                                slct = 0
                                Exit Do
                            Else
                                ExpectedEndSelect
                                ExecuteLong = 0
                                Exit Function
                            End If
                        Else
                           ' SetNextLine b$
                            v = Len(b$)
                             b$ = Space$(v)
                             If ok Then
                             ExpectedEndSelect2
                             Else
                             ExpectedCaseorElseorEnd2
                             End If
                            ExecuteLong = 0
                            Exit Function
                        End If
  
                        Loop
                        If slct > 0 Then
                        b$ = Space$(v)
                        ExecuteLong = 0: Exit Function
                        End If
                        
                    '-----------ENDIF ---------------
                       Else
                        ExecuteLong = 0
                        Exit Function
                    End If
        Else
           ExecuteLong = 0
           Exit Function
        End If
     exeSelect = False
     Exit Function
ContGoto:
        If myexit(bstack) Then ExecuteLong = 1: Exit Function
        If MyTrim$(b$) = vbNullString Or FastSymbol(b$, ":") Then
                ExecuteLong = 0
                MissingLabel
                Exit Function
        Else
        ' GET OUT FOR NEXT
    
        
        i = Abs(IsLabelOnly(b$, w$))

                If i = 1 Then
                
                once = False
                b$ = w$
                ExecuteLong = 2
                Exit Function
                ElseIf i = 0 Then
                If IsNumberLabel(b$, w$) Then
                      once = False
                b$ = w$
                ExecuteLong = 2
                Exit Function
                Else
                 b$ = w$ & b$
                End If
                Else
                b$ = w$ & b$
                
                End If
              End If
End Function
Private Function CompareStr2(a$, b$) As Long
On Error GoTo comperr
If cLid = 0 Then
CompareStr2 = StrComp(a$, b$, vbTextCompare)
Else
CompareStr2 = -2 + CompareString(cLid, &H1000, StrPtr(a$), Len(a$), StrPtr(b$), Len(b$))
End If
Exit Function
comperr:
CompareStr2 = -2 + CompareString(0, 0, StrPtr(a$), Len(a$), StrPtr(b$), Len(b$))

End Function
Private Function CompareStr3(a As Variant, b As Variant) As Long
On Error GoTo comperr
If Not mTextCompare Then
CompareStr3 = StrComp(a, b)
ElseIf cLid = 0 Then
CompareStr3 = StrComp(a, b, vbTextCompare)
Else
CompareStr3 = -2 + CompareString(cLid, &H1000, StrPtr(a), Len(a), StrPtr(b), Len(b))
End If
Exit Function
comperr:
Err.Clear


If mTextCompare Then
If MyIsObject(a) Or MyIsObject(b) Then
Else
CompareStr3 = -2 + CompareString(0, 0, StrPtr(a), Len(a), StrPtr(b), Len(b))

Exit Function
End If
End If
MyEr "Not string found", "Δεν βρήκα αλφαριθμητικό"
End Function

Function CheckTwo(v1&, v2&) As Boolean
Dim one As Group, two As Group
If Typename(var(v1&)) <> "Group" Then
    Dim a1 As Variant, b1 As Variant
    If Typename(var(v1&)) = "mHandler" Then
        Dim a As Object
        Set a = var(v1&)
        CheckLastHandler a
        If a.indirect >= 0 And a.indirect <= var2used Then
            Set a = var(a.indirect)
        End If
        Set a1 = a
    Else
    If MyIsObject(var(v1&)) Then
        Set a1 = var(v1&)
    Else
        a1 = var(v1&)
    End If
    
    End If
    If Typename(var(v2&)) = "mHandler" Then
        Dim b As Object
        Set b = var(v2&)
        CheckLastHandler b
        If b.indirect >= 0 And b.indirect <= var2used Then
            Set b = var(b.indirect)
        End If
        Set b1 = b
    Else
    If MyIsObject(var(v2&)) Then
        Set b1 = var(v2&)
    Else
        b1 = var(v2&)
    End If
    End If
    
    CheckTwo = Typename(a1) = Typename(b1)

ElseIf Typename(var(v2&)) = "Group" Then
Set one = var(v1&)
If one.IamApointer Then
Set one = one.link
End If
Set two = var(v2&)
If two.IamApointer Then
Set two = two.link
End If
If one.IamSuperClass Then
If two.IamSuperClass Then
    CheckTwo = False ' no two superclass as the same, (maybe they have the same kind of members)
    ' because superclass may have unique members, but also have unique values
Else
' check if second is kind of superclass
    CheckTwo = one.SuperClassList Is two.SuperClassList
End If
Else ' check first if has the same superclass
If one.SuperClassList Is two.SuperClassList Then
If two.IamSuperClass Then
    ' so v1& as V2& if v2& is a superclass (same as before)
    CheckTwo = True
Else
' so now we have to check lists
Dim mS As mStiva, ms2 As mStiva
Set mS = one.PrepareSorosToCompare(var())
Set ms2 = two.PrepareSorosToCompare(var())
' check ms2 against ms
' every time we found one in ms2 we remove it from both
Dim i As Long, j As Long
again:
For i = 1 To ms2.Total
For j = 1 To mS.Total
If mS.StackItem(j) = ms2.StackItem(i) Then
If i > 1 Then ms2.MakeTopItem i
If j > 1 Then mS.MakeTopItem j
    mS.drop 1
    ms2.drop 1
GoTo again
End If
Next j
Next i
CheckTwo = ms2.Total = 0

End If
End If

End If

End If

End Function

Function ProcessIf(flag As Variant, bstack As basetask, rest$, r As Variant) As Boolean

Dim mode As Boolean
mode = flag < 1
If bstack.lastobj Is Nothing Then
flag = Int(Abs(flag > 0) * (flag - 1) - (flag <= 0) * (flag + 1) + 1)
Else
flag = 1
End If
Dim nowpos As Double, w1 As Long, s$
nowpos = 1
ProcessIf = True
 If Not FastSymbol(rest$, "->", True, 2) Then Exit Function
Do
    If flag = nowpos Then
        If MaybeIsSymbol(rest$, ",)") Then
            If mode Then
            r = flag = 1
            Else
            r = 0
            End If
        Else
            If Not IsExp(bstack, rest$, r) Then
                MissNumExpr
                ProcessIf = False
                Exit Function
            End If
        End If
        ProcessIf = True
    Else
        If Not MaybeIsSymbol(rest$, ",)") Then
        w1 = 1
        s$ = aheadstatus(rest$, True, w1)
        If s$ = vbNullString Then Exit Do
        Mid$(rest$, 1, w1 - 1) = Space$(w1 - 1)
        End If
    End If
    If Not FastSymbol(rest$, ",") Then Exit Do
    nowpos = nowpos + 1
    If mode Then If nowpos > 2 Then MyEr "To many expressions", "Πολλές εκφράσεις"
Loop
If nowpos = 1 Then MyEr "Need two expressions", "Χρειάζομαι δυο εκφράσεις"
If Not FastSymbol(rest$, ")") Then ProcessIf = False
End Function
Function ProcessIfStr(ByVal flag As Double, bstack As basetask, rest$, ss As String) As Boolean
Dim mode As Boolean
mode = flag < 1
flag = Int(Abs(flag > 0) * (flag - 1) - (flag <= 0) * (flag + 1) + 1)
Dim nowpos As Double, w1 As Long, s$
nowpos = 1
ProcessIfStr = True
 If Not FastSymbol(rest$, "->", True, 2) Then Exit Function
Do
    If flag = nowpos Then
        If MaybeIsSymbol(rest$, ",)") Then
            ss = vbNullString
        Else
            If Not IsStrExp(bstack, rest$, ss) Then
                MissStringExpr
                ProcessIfStr = False
                Exit Function
            End If
        End If
        ProcessIfStr = True
    Else
        If Not MaybeIsSymbol(rest$, ",)") Then
        w1 = 1
        s$ = aheadstatus(rest$, True, w1)
        If s$ = vbNullString Then Exit Do
        Mid$(rest$, 1, w1 - 1) = Space$(w1 - 1)
        End If
    End If
    If Not FastSymbol(rest$, ",") Then Exit Do
    nowpos = nowpos + 1
    If mode Then If nowpos > 2 Then MyEr "To many expressions", "Πολλές εκφράσεις"
Loop
If nowpos = 1 Then MyEr "Need two xpressions", "Χρειάζομαι δυο εκφράσεις"
If Not FastSymbol(rest$, ")") Then ProcessIfStr = False
End Function
Function GETarrayFROMstr(a$, b$) As mHandler
Dim pppp As mArray, aa() As String
aa = Split(a$, b$)
Set pppp = New mArray
If UBound(aa) = -1 Then

Else
Dim i As Long
pppp.PushDim UBound(aa) + 1
pppp.PushEnd
For i = 0 To UBound(aa)
pppp.item(i) = aa(i)
Next i
End If
Set GETarrayFROMstr = New mHandler
GETarrayFROMstr.t1 = 3
Set GETarrayFROMstr.objref = pppp

End Function
Function CheckThis(bstack As basetask, w$, b$, v As Long, Lang As Long, i As Long) As Long
Dim bb$
If Len(w$) > 3 Then
    If Lang = 1 Then
        If Left$(w$, 1) = "T" Then
            If Left$(w$, 4) = "THIS" Then
                If Len(w$) = 4 Then
                    bb$ = ""
                    If bstack.GetDotNew(bb$, 1) < 0 Then
                        If Len(bb$) = 0 Then CheckThis = -1: Exit Function
                        w$ = Left$(bb$, Len(bb$) - 1) + Mid$(w$, 5)
                        If GetGlobalVar(w$, v) Then GoTo found
                    End If
                ElseIf Mid$(w$, 5, 1) = "." Then
                    If bstack.UseGroupname <> "" Then
                        bb$ = bstack.UseGroupname + Mid$(w$, 6)
                        If varhash.Find(bb$, v) Then GoTo found
                        bb$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(w$, 6)
                        If varhash.Find(bb$, v) Then GoTo found
                        
                    Else
                        bb$ = ""
                        If bstack.GetDotNew(bb$, 1) < 0 Then
                            If Len(bb$) = 0 Then CheckThis = -1: Exit Function
                            w$ = Left$(bb$, Len(bb$) - 1) + Mid$(w$, 5)
                            If GetGlobalVar(w$, v) Then GoTo found
                        End If
                    End If
                End If
            End If
        End If
    Else
        If Left$(w$, 1) = "Α" Then
            If Left$(w$, 4) = "ΑΥΤΟ" Then
                If Len(w$) = 4 Then
                    bb$ = ""
                    If bstack.GetDotNew(bb$, 1) < 0 Then
                        If Len(bb$) = 0 Then CheckThis = -1: Exit Function
                        If Len(w$) = 4 Then
                        If GetGlobalVar(Left$(bb$, Len(bb$) - 1), v) Then GoTo found
                        Else
                        w$ = Left$(bb$, Len(bb$) - 1) + Mid$(w$, 5)
                        End If
                        If GetGlobalVar(w$, v) Then GoTo found
                    End If
                ElseIf Mid$(w$, 5, 1) = "." Then
                     If bstack.UseGroupname <> "" Then
                        bb$ = bstack.UseGroupname + Mid$(w$, 6)
                        If varhash.Find(bb$, v) Then GoTo found
                        bb$ = bstack.UseGroupname + ChrW(&HFFBF) + Mid$(w$, 6)
                        If varhash.Find(bb$, v) Then GoTo found
                    Else
                        bb$ = ""
                        If bstack.GetDotNew(bb$, 1) < 0 Then
                            If Len(bb$) = 0 Then CheckThis = -1: Exit Function
                            w$ = Left$(bb$, Len(bb$) - 1) + Mid$(w$, 5)
                            If GetGlobalVar(w$, v) Then GoTo found
                        End If
                    End If
                End If
            End If
        End If
    End If
End If
Exit Function
found:
CheckThis = 1
If FastSymbol(b$, "=") Then Exit Function
If FastSymbol(b$, "<=", , 2) Then Exit Function
If FastSymbol(b$, "->", , 2) Then CheckThis = 3: Exit Function
CheckThis = 2
End Function
Function myHwnd(bstack As basetask) As Double
If Typename(bstack.Owner) = "GuiM2000" Then
myHwnd = bstack.Owner.hWND
Else
If ttl Then
myHwnd = Form3.hWND
Else
myHwnd = bstack.Owner.hWND
End If
End If
End Function
Sub targetsMyExec(MyExec As Long, b$, bb$, v As Long, di As Object, w$, bstack As basetask, VarStat As Boolean, temphere$)
Dim x1 As Long, y1 As Long, x2 As Long, y2 As Long, SBB$, nd&, p As Variant

If Abs(IsLabel(bstack, b$, w$)) = 1 Then
                    If Not GetVar(bstack, w$, v) Then
                     v = globalvar(w$, 0#, , VarStat, temphere$)

                               
                    End If
                Else
                    MyExec = 0
                    Exit Sub
                End If
                If Not FastSymbol(b$, ",") Then
                    MyExec = 0
                    Exit Sub
                ElseIf IsStrExp(bstack, b$, bb$) Then
                If NocharsInLine(bb$) Then MyExec = 0: Exit Sub
                With players(GetCode(di))
               '' SetTextSZ di, Sz
               '' LCT di, yPos, xPos
                x1 = 1
                y1 = 1
                x2 = -1
                y2 = -1
                nd& = 0
                SBB$ = vbNullString
                On Error GoTo err123
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x1 = Abs(p) Mod (.mx + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y1 = Abs(p) Mod (.My + 1)
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then x2 = CLng(Fix(p))
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then y2 = CLng(Fix(p))
                If FastSymbol(b$, ",") Then If IsExp(bstack, b$, p) Then nd& = Abs(p)
                If FastSymbol(b$, ",") Then If Not IsStrExp(bstack, b$, SBB$) Then MyExec = 0: Exit Sub
err123:
                        If Err.Number = 6 Then
                                Overflow
                                MyExec = 0
                                Exit Sub
                                End If
                Targets = False
                MyDoEvents1 Form1
       
                ReDim Preserve q(UBound(q()) + 1)
                q(UBound(q()) - 1) = BoxTarget(bstack, x1, y1, x2, y2, SBB$, nd&, bb$, .Xt, .Yt, .uMineLineSpace)
                End With
                var(v) = UBound(q()) - 1
                Targets = True
                ElseIf IsExp(bstack, b$, p) Then
                  q(var(v)).Enable = Not (p = 0)
                  RTarget bstack, q(var(v))
                Else
                  MyExec = 0
                  Exit Sub
                End If
End Sub
Function GetName(ByVal part$) As String
again:
If InStr(part$, ChrW(&H1FFF)) > 0 Then
If InStr(part$, ".") > 0 Then
    part$ = Mid$(part$, InStr(part$, ".") + 1)
    GoTo again
End If
End If
If part$ = "" Then Exit Function
If InStr(part$, "].") > 0 Then
part$ = Mid$(part$, InStr(part$, "].") + 2)
If InStr(part$, ChrW(&H1FFF)) > 0 Then
If InStr(part$, ".") > 0 Then
    part$ = Mid$(part$, InStr(part$, ".") + 1)
    GoTo again
End If
End If
ElseIf iRVAL22(part$) > 0 Then
If InStr(part$, "][") = 0 Then
GetName = "" 'part$
Exit Function
Else
part$ = sbf(iRVAL22(part$)).goodname
End If
GoTo again
End If

GetName = part$

End Function
Sub FeedArray(pppp As mArray, v As Long, fromthis As Object, Optional convert As Boolean = False)
Dim mm As mStiva, myobject As Object, p As Variant
Set mm = fromthis
Do While Not mm.IsEmpty
If v >= pppp.count Then Exit Do
If mm.PopType = ">" Then
mm.drop 1
pppp.item(v) = CLng(0)
v = v + 1
ElseIf mm.StackItemTypeIsObject(1) Then
        pppp.item(v) = -1
        Set myobject = mm.PopObj
            
        If Typename$(myobject) = "Group" Then
              If myobject.IamFloatGroup Then
                     Set pppp.item(v) = myobject
              Else
                           BadGroupHandle
                           Set myobject = Nothing
                           Exit Sub
              End If
         ElseIf Typename$(myobject) = "lambda" Then
                  Set pppp.item(v) = myobject
          ElseIf Typename$(myobject) = myArray Then
              If myobject.Arr Then
                      Set pppp.item(v) = CopyArray(myobject)
                  Else
                      Set pppp.item(v) = myobject
                  End If
         ElseIf Typename$(myobject) = "mHandler" Then
               If myobject.indirect > -0 Then
                   Set pppp.item(v) = myobject
               Else
                   p = myobject.t1
                   If CheckDeepAny(myobject) Then
                       If TypeOf myobject Is mHandler Then
                           Set pppp.item(v) = myobject
                       Else
                           Set pppp.item(v) = New mHandler
                           pppp.item(v).t1 = p
                           Set pppp.item(v).objref = myobject
                       End If
                       
                   End If
              End If
          ElseIf Typename$(myobject) = "PropReference" Then
                  Set pppp.item(v) = myobject
          End If
          Set myobject = Nothing
        '  mm.drop 1
Else
If Typename$(pppp.item(v)) = doc Then
    If mm.PopType = "S" Then
        CheckVar pppp.item(v), mm.PopStr
    Else
    ' ERROR
        Set pppp.item(v) = New Document
        mm.drop 1
    End If
ElseIf Not mm.PopType = "S" Then
If convert Then
pppp.item(v) = MyRound(mm.StackItem(1), 0)
mm.drop 1
Else
pppp.item(v) = mm.StackItem(1)
mm.drop 1
End If
Else
pppp.item(v) = mm.StackItem(1)
mm.drop 1
End If


End If
v = v + 1
Loop
Set fromthis = Nothing

End Sub
Function CurrentStackSize() As Double
'If IsWine Then Exit Function
On Error GoTo 1000
Dim endaddress As Long
ua = startaddress
UB = VarPtr(endaddress)
CurrentStackSize = uintnew(ua) - uintnew(UB) - 300 ' - (1 - m_bInIDE) * 93
Exit Function
1000
Err.Raise 8000
End Function
Function ClaimStack() As Long
If IsWine Then Exit Function
Static once11 As Boolean
ClaimStack = findstack
If once11 Then Exit Function
once11 = True
repeatme
ClaimStack = findstack
End Function
Function repeatme()
On Error GoTo there
findstack = CurrentStackSize()
On Error GoTo there
repeatme
there:
End Function
Function GetModuleName(b As basetask, where$) As String
If SecureNames Then
If b.OriginalCode < 0 Then
    If var2used <= -b.OriginalCode Then Exit Function
    GetModuleName = GetName(var(-b.OriginalCode).name)
Else
    GetModuleName = GetName(sbf(b.OriginalCode).goodname)
    End If
Else
    GetModuleName = GetName(StripRVAL(where$))
End If
End Function
Private Function compareStr4(a$, b$) As Long   ' here is not byval as in fastcollection
Dim i As Long, j As Long, a1$, b1$, p1 As Variant, p2 As Variant, n$, k As Long, k1 As Long
If CompareString(cLid, &H1000, StrPtr(a$), Len(a$), StrPtr(b$), Len(b$)) = 2 Then Exit Function
n$ = "[-0-9.]"
k = Sgn(Len(a$) - Len(b$))
k1 = k
again:
j = IIf(Len(a$) >= Len(b$), Len(b$), Len(a$))

For i = 1 To j

    If Mid$(a$, i, 1) Like n$ Then
    a1$ = Mid$(a$, i)
    b1$ = Mid$(b$, i)
        IsNumberD2 a1$, p1
       
        If IsNumberD2(b1$, p2) Then
            compareStr4 = Sgn(MyRound(p1, 8) - MyRound(p2, 8))
            If compareStr4 = 0 Then
                If Len(a1$) * Len(b1$) <> 0 Then
                    If Len(n$) > 6 Then n$ = "[-0-9]"
                    k = Sgn(Len(a1$) - Len(b1$))
                     
                    a$ = a1$
                    b$ = b1$
                   
                    GoTo again
                End If
                If Len(a1$) + Len(b1$) = 0 Then
                    compareStr4 = k
                Else
                    compareStr4 = Sgn(Len(a1$) - Len(b1$))
                End If
                Exit Function
             End If
            Exit Function
        Else
        a$ = Mid$(a$, i)
    b$ = Mid$(b$, i)
    IsNumberD2 a$, p1
       
          If Len(a$) > 0 Then
       
            Select Case CompareString(cLid, &H1000, StrPtr(a$), Len(a$), StrPtr(b$), Len(b$))
                Case 1, 3
                compareStr4 = -1
                Case 2
                If k > 0 Then
                compareStr4 = -1
                Else
                compareStr4 = 1
                End If
            End Select
        Else
        compareStr4 = -1
        End If
        End If
        Exit Function
    ElseIf Mid$(b$, i, 1) Like n$ Then
    a$ = Mid$(a$, i)
    b$ = Mid$(b$, i)
    IsNumberD2 b$, p1
    If Len(b$) > 0 Then
       
            Select Case CompareString(cLid, &H1000, StrPtr(a$), Len(a$), StrPtr(b$), Len(b$))
                Case 3
                compareStr4 = 1
                Case 1, 2
                If k < 0 Then
                compareStr4 = 1
                Else
                compareStr4 = -1
                End If
                
                
            End Select
        Else
        compareStr4 = 1
        End If
        Exit Function
    End If
    compareStr4 = -2 + CompareString(cLid, 0, StrPtr(a$) + i * 2 - 2, 1, StrPtr(b$) + i * 2 - 2, 1)
    If compareStr4 <> 0 Then
    Exit Function
    End If
Next i
compareStr4 = Sgn(Len(a$) - Len(b$))
If compareStr4 = 0 Then compareStr4 = k1
End Function


Private Sub checkbreak(bstack As basetask, b$, once As Boolean)
Static jump As Long
If jump Then jump = jump - 1: Exit Sub
jump = 50
If Not bstack.IamAnEvent Then
If Not KeyPressedLong(&H13) = 1 Then Exit Sub
If Form1.mybreak1() Then
    
        Modalid = 0
        If Not TaskMaster Is Nothing Then TaskMaster.Dispose
        NOEXECUTION = False
        MOUT = False
        
        b$ = "@Start : error {}"
        
        once = False
        k1 = 0
        MyDoEvents0 bstack.Owner
        MyEr "", ""
        End If
    
End If
End Sub
Private Sub ClearStr(a$)
Dim i As Long, j As Long
                While FastSymbol(a$, vbCrLf, , 2)
                i = 1
                While FastOperator(a$, vbCrLf, i, 2)
                Wend
                j = Len(a$)
                If j = 0 Then Exit Sub
                i = MyTrimL(a$)
                If i > j Then Exit Sub
                Wend
End Sub
Private Function IsRandom(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
If FastSymbol(a$, "!") Then
If IsExp(bstack, a$, r) Then
'' CHOOSE SEED AND SAVEIT TO BASESTACK
On Error Resume Next
simplestack1 = rndbase
RandomizeIt rndbase, CLng(Int(r))

If Err Then
Err.Clear
r = 0
End If

Else
rndbase = simplestack1
End If
     
ElseIf IsExp(bstack, a$, r) Then
    r = Int(r)
    
        If FastSymbol(a$, ",") Then
        Dim p As Variant
        If Not IsExp(bstack, a$, p) Then IsRandom = False: Exit Function
        p = MyRound(p)
        Dim PP As Variant
        If p > r Then PP = p: p = r: r = PP
        Else
        p = 0
        
        End If
    
    r = Int((r - p + 1) * RndM(rndbase) + p)
    If SG < 0 Then r = -r
     On Error GoTo 0
    IsRandom = True
    Else
      RandomizeIt rndbase, timeGetTime
     r = SG * True
      
    End If
    IsRandom = FastSymbol(a$, ")", True)

End Function
Private Function IsArrayFun(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, w1 As Long, pppp As mArray, anything As Object, p As Variant
If IsStrExp(bstack, a$, s$) Then
        If bstack.lastobj Is Nothing Then
            If Right$("!!" & s$, 2) = "()" Then
                Mid$(s$, Len(s$), 1) = " "
                s$ = RTrim$(s$)
             Else
                w1 = InStr("!" & s$, "(") - 1
                If w1 > 0 And w1 <= Len(s$) Then
                    s$ = Left$(s$, w1)
                ElseIf neoGetArray(bstack, s$, pppp) Then
                GoTo check123678
                Else
                s$ = s$ + "("
                End If
            End If
            If neoGetArray(bstack, s$, pppp) Then
check123678:
                If Not pppp.Arr Then NotArray: Exit Function
                If FastSymbol(a$, ",") Then
                    IsArrayFun = NeoGetArrayItem(pppp, bstack, s$, w1, a$)
                Else
                    IsArrayFun = FastSymbol(a$, ")", True)
                    w1 = 0
                   ' w1 = pppp.index
                End If
checkIterator:
                If Not pppp.IsEmpty Then
                    If MyIsObject(pppp.item(w1)) Then
                        Set bstack.lastobj = pppp.item(w1)
                        r = 0
                    Else
                        Set bstack.lastobj = Nothing
                        
                        r = pppp.itemnumeric(w1)
                        If SG < 0 Then r = -r
                    End If
                Else
                    
                    EmptyArray
                End If
            Else
                 Set bstack.lastobj = Nothing
                NotArray
            End If

                 Exit Function
            
        ElseIf TypeOf bstack.lastobj Is mArray Then
                Set pppp = bstack.lastobj
                GoTo check123678
        Else
            Set bstack.lastobj = Nothing
            SyntaxError
        End If
    ElseIf IsExp(bstack, a$, p) Then
        If Not bstack.lastobj Is Nothing Then
            If TypeOf bstack.lastobj Is mHandler Then
                If bstack.lastobj.indirect >= 0 Then
                    Set pppp = var(bstack.lastobj.indirect)
                    If bstack.lastobj.UseIterator Then
                    pppp.index = bstack.lastobj.index_cursor
                    End If
                    GoTo check123678
                ElseIf TypeOf bstack.lastobj.objref Is mArray Then
                    Set pppp = bstack.lastobj.objref
                    If bstack.lastobj.UseIterator Then
                    pppp.index = bstack.lastobj.index_cursor
                    End If
                    If bstack.lastobj.UseIterator Then
                    If Not pppp.Arr Then NotArray: Exit Function
                    If FastSymbol(a$, ",") Then
                        Set bstack.lastobj = Nothing
                        IsArrayFun = IsExp(bstack, a$, r)
                        IsArrayFun = FastSymbol(a$, ")", True)
                        w1 = r
                    Else
                        IsArrayFun = FastSymbol(a$, ")", True)
                        w1 = pppp.index
                    End If
                    If Not IsArrayFun Then Exit Function
                    GoTo checkIterator
                    Else
                    GoTo check123678
                    End If
                ElseIf TypeOf bstack.lastobj.objref Is mStiva Then
                    Set anything = bstack.lastobj.objref
                    Set bstack.lastobj = Nothing
                    If FastSymbol(a$, ",") Then
                    If IsExp(bstack, a$, p) Then
                    Set bstack.lastobj = anything.ExportArray(CLng(MyRound(p)))
                    End If
                    Else
                        Set bstack.lastobj = anything.ExportArray(anything.count)
                        
                    End If
                    Set anything = Nothing
                    IsArrayFun = FastSymbol(a$, ")", True)
                    Exit Function
                Else
                     Set bstack.lastobj = Nothing
                    NotArray
                End If
            ElseIf TypeOf bstack.lastobj Is mArray Then
                Set pppp = bstack.lastobj
                GoTo check123678
            End If
        End If
    Else
        Set bstack.lastobj = New mArray
        IsArrayFun = FastSymbol(a$, ")", True)
    End If
End Function
Private Function IsDimension(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, pppp As mArray, w1 As Long, p As Variant, anything As Object, PP As Variant
If Abs(IsLabel(bstack, a$, s$)) > 4 Then

If neoGetArray(bstack, s$, pppp) Then
If pppp.Arr Then
a$ = s$ + a$
'Set bstack.lastobj = Nothing
If IsExp(bstack, a$, p) Then

ElseIf IsStrExp(bstack, a$, s$) Then
End If
getback:
If Not bstack.lastobj Is Nothing Then
If TypeOf bstack.lastobj Is mHandler Then
Set anything = bstack.lastobj
If CheckIsmArray(anything) Then Set bstack.lastobj = anything
Set anything = Nothing
End If
If Not (TypeOf bstack.lastobj Is mArray) Then NeedAnArray a$: Exit Function
Set pppp = bstack.lastobj
Set bstack.lastobj = Nothing
Else

IsDimension = False
End If
Else
   If NeoGetArrayItem(pppp, bstack, s$, w1, a$) Then
    Set pppp = pppp.GroupRef.objref.ValueObj
  End If
End If
Else
      NeedAnArray a$: Exit Function
End If

 If pppp.Arr Then  '

    If FastSymbol(a$, ",") Then
        If IsExp(bstack, a$, p) Then
            If p < 1 Then
                If Not FastSymbol(a$, ",") Then
                    pppp.GetDnum (0), PP, r
                    r = SG * -r
                ElseIf IsExp(bstack, a$, r) Then
                    r = CLng(r) - 1
                    pppp.SerialItem PP, (r), 5
                    If r >= 0 And r < PP Then
                        pppp.GetDnum (r), PP, r
                        r = SG * -r
                    Else
                        CantReadDimension a$, s$
                        Exit Function
                   End If
                Else
                    missNumber
                    Exit Function
                End If
            Else
                'pppp.SerialItem PP, CLng(Fix(p) - 1), 6
                pppp.SerialItem PP, (r), 5
                p = p - 1
                If p >= 0 And p < PP Then
                    If FastSymbol(a$, ",") Then
                        If IsExp(bstack, a$, r) Then
                            If r = 0 Then
                                pppp.GetDnum CLng(Fix(p)), PP, r
                                r = SG * -r
                            Else
                                pppp.GetDnum CLng(Fix(p)), PP, r
                                r = PP - r - 1
                            End If
                        End If
                    Else
                        pppp.GetDnum CLng(Fix(p)), PP, r
                        r = SG * PP
                    End If
                Else
                    CantReadDimension a$, s$
                    Exit Function
                End If
            
            End If
                IsDimension = FastSymbol(a$, ")", True)
        Else
            CantReadDimension a$, s$
        End If
        
      Else ' dimensions
      p = 0
      pppp.SerialItem PP, CLng(Fix(p)), 5
         r = SG * PP
              
              IsDimension = FastSymbol(a$, ")", True)
      End If
      Exit Function
      Else
       
       End If
ElseIf GetVar(bstack, s$, w1) Then
If IsExp(bstack, (s$), p) Then
    Set anything = bstack.lastobj
    If CheckIsmArray(anything) Then
        Set bstack.lastobj = anything
        Set anything = Nothing
    Else
    Set anything = Nothing

    End If
GoTo getback

End If
 Else
 
 End If
If IsStrExp(bstack, a$, s$) Then
    s$ = s$ & "("
    If neoGetArray(bstack, s$, pppp) Then
    
      If Not pppp.Arr Then
    
  If NeoGetArrayItem(pppp, bstack, s$, w1, a$, , False) Then
  Set pppp = pppp.GroupRef.objref.ValueObj
  End If
  
   
  End If
  If Not pppp.Arr Then NeedAnArray a$: Exit Function
        If FastSymbol(a$, ",") Then
          If IsExp(bstack, a$, p) Then
            If p < 1 Then
                r = SG * -pppp.myarrbase
            Else
                p = Fix(p)
                pppp.SerialItem PP, CLng(p - 1), 6
                r = SG * PP
            End If
            
            IsDimension = FastSymbol(a$, ")", True)
          Else
            CantReadDimension a$, s$
            End If
        Else ' dimensions
            p = 0
            pppp.SerialItem PP, CLng(p), 5
            r = SG * PP
            
            IsDimension = FastSymbol(a$, ")", True)
        End If
        Else
        CantFindArray a$, s$
    End If
Else
        CantFindArray a$, s$
End If
End Function


Private Function IsStackObj(v$, bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim anything As Object, anything2 As Object, p As Variant
    Set anything = New mHandler
    anything.t1 = 3
    Set anything.objref = New mStiva
    If FastSymbol(a$, ":=", , 2) Then
        
        Set anything2 = bstack.soros
        Set bstack.Sorosref = anything.objref
        MyData bstack, a$
        Set bstack.Sorosref = anything2
        Set anything2 = Nothing
    ElseIf IsLabelSymbolNew(a$, "ΚΑΤΩ", "DOWN", Abs(AscW(v$) = 83)) Then
        If IsExp(bstack, a$, p) Then
                If Not bstack.lastobj Is Nothing Then
                Set anything2 = bstack.lastobj
                FastSymbol a$, ","
                If IsExp(bstack, a$, p) Then
                If Not bstack.lastobj Is Nothing Then SyntaxError: Exit Function
                anything.objref.SplitStackBottom anything2, CLng(Fix(p))
                End If
                End If
        End If
    ElseIf IsLabelSymbolNew(a$, "ΑΝΩ", "UP", Abs(AscW(v$) = 83)) Then
            If IsExp(bstack, a$, p) Then
                If Not bstack.lastobj Is Nothing Then
                Set anything2 = bstack.lastobj
                FastSymbol a$, ","
                If IsExp(bstack, a$, p) Then
                If Not bstack.lastobj Is Nothing Then SyntaxError: Exit Function
                anything.objref.SplitStackTop anything2, CLng(Fix(p))
                End If
                End If
        End If
    End If
    Set bstack.lastobj = anything
    r = 0
    IsStackObj = True

End Function
Private Function IsStack(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim anything As Object, pppp As mArray, p As Variant, anything2 As Object
If IsExp(bstack, a$, r) Then
    If CheckStackObj(bstack, anything) Then
            If TypeOf anything Is mArray Then
                Set pppp = anything
                Set anything = New mStiva
                anything.MergeBottomCopyArray pppp
               
                
                 Set bstack.lastobj = New mHandler
            bstack.lastobj.t1 = 3
            Set bstack.lastobj.objref = anything
            Set anything = Nothing
                IsStack = FastSymbol(a$, ")", True)
                Exit Function
            End If
            If Not TypeOf anything Is mStiva Then GoTo stack12948
            If FastSymbol(a$, ",") Then
stack99981:
                If IsExp(bstack, a$, p) Then
                    If p <> 0 Then
                        Set anything = anything.CopyMe2(CLng(Fix(p)))
                    Else
                        If Not bstack.lastobj Is Nothing Then
                            If CheckStackObj(bstack, anything2) Then
                                    Set anything = anything.MergeFromOther(anything2.CopyMe())
                                    If FastSymbol(a$, ",") Then GoTo stack99981
                                    
                                Else
                                    GoTo stack129481
                                End If
                        Else
stack129481:
                         NoStackObjectToMerge
                        End If
                        
                    End If
                Else
                MissParam a$
                Exit Function
                End If
            Else
                Set anything = anything.CopyMe()
            End If
            Set bstack.lastobj = New mHandler
            bstack.lastobj.t1 = 3
            Set bstack.lastobj.objref = anything
            Set anything = Nothing
        Else
stack12948:
        MyEr "Not a stack object", "Δεν βρήκα αντικείμενο σωρού"
        End If
        IsStack = FastSymbol(a$, ")", True)
        Exit Function
Else
        MissParam a$
End If
End Function
Private Function IsCeil(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim PP As Variant
    If IsExp(bstack, a$, r) Then
    ''On Error Resume Next
    If FastSymbol(a$, ")") Then
            r = IIf(Fix(r) = r, r, Int(r) + 1)
            If SG < 0 Then r = -r
            IsCeil = True
    Else
            MissParam a$
    End If
    End If
 
 End Function
Private Function IsFloor(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim PP As Variant
    If IsExp(bstack, a$, r) Then
    ''On Error Resume Next
    If FastSymbol(a$, ")") Then
            r = Int(r)
            If SG < 0 Then r = -r
            IsFloor = True
    Else
            MissParam a$
    End If
    End If
 
 End Function
Private Function IsRound(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim PP As Variant, i As Integer
    If IsExp(bstack, a$, r) Then
    On Error Resume Next
    If FastSymbol(a$, ")") Then
            
            r = MyRound(r, 13)
           If SG < 0 Then r = -r
            IsRound = True
    ElseIf FastSymbol(a$, ",", True) Then
        If IsExp(bstack, a$, PP) Then
        
          r = MyRound(r, PP)
         If SG < 0 Then r = -r
          If Err.Number > 0 Then Err.Clear
     IsRound = FastSymbol(a$, ")", True)
     End If
    Else
                MissParam a$
    End If
    End If
End Function
Private Function IsInt(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
    If IsExp(bstack, a$, r) Then
    On Error Resume Next
    r = Int(r)
    If SG < 0 Then r = -r
    If Err.Number > 0 Then
    
    MyErMacro a$, "long conversion failed", "Η μετατροπή σε ακέραιο απέτυχε"
    Exit Function
    End If
    On Error GoTo 0
    IsInt = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    
    
    End If
 
End Function
Private Function IsEof(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim VR As Double
    IsSymbol3 a$, "#"  ' drop it
    If IsExp(bstack, a$, r) Then
        VR = r Mod 512
        If FLEN(VR) = 0 Then
        wrongfilenumber a$
         
    Else
    r = CBool(LOF(VR) < Seek(VR))
    If SG < 0 Then r = -CLng(r)
  IsEof = FastSymbol(a$, ")", True)
  End If
  
    Else
                    
                MissParam a$
    End If
    
End Function
Private Function IsSeek(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
    Dim VR As Double
    IsSymbol3 a$, "#"  ' drop it
    If IsExp(bstack, a$, r) Then
    VR = r Mod 512
    
    If FLEN(VR) = 0 Then
    wrongfilenumber a$

    ElseIf FLEN(VR) <> 1 Then
     MyErMacro a$, "not valid file TYPE", "λάθος ΤΥΠΟΣ αρχείου"

    Else
    r = SG * Seek(VR)
    
  IsSeek = FastSymbol(a$, ")", True)
  End If
  
    Else
                   
                MissParam a$
    End If
End Function
Private Function IsUint(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
If IsExp(bstack, a$, r) Then
 If VarPtr(r) = vbInteger Then
     On Error Resume Next
    
        r = SG * UINT(r)
     
        On Error GoTo 0
Else
    On Error Resume Next
        If r > 2147483647# Then
         MyErMacro a$, "Overflow long, expect lower than (2147483648)", "Υπερχείλιση ακεραίου, περιμένω μικρότερο από (2147483648)"
          
        Exit Function
    ElseIf r < -2147483648# Then
        MyErMacro a$, "Overflow long, expect greater than (-2147483649)", "Υπερχείλιση ακεραίου, περιμένω μεγαλύτερο από (-2147483649)"
         IsUint = False
        Exit Function
    End If
    
    r = SG * uintnew(r)
    If Err.Number > 0 Then
        MyErMacro a$, "Sign to Unsign long failed", "Η μετατροπή ακεραίου με πρόσημο σε ακέραιο χωρίς πρόσημο απέτυχε"
        IsUint = False
        Exit Function
    End If
    On Error GoTo 0
End If
    IsUint = FastSymbol(a$, ")", True)
    Exit Function
       Else
                    
                MissParam a$
    End If
End Function
Private Function IsSint(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim p As Variant, rB As Byte, ri As Integer, dn As Long, rd As Double
p = 4
 If IsExp(bstack, a$, r) Then
 If Not bstack.lastobj Is Nothing Then
 If Not TypeOf bstack.lastobj Is mHandler Then: Exit Function
 With bstack.lastobj
    If .t1 <> 2 Then GoTo err1256
    If Not TypeOf .objref Is MemBlock Then GoTo err1256
    If Not FastSymbol(a$, ",") Then GoTo err1256
    If Not IsExp(bstack, a$, p) Then GoTo err1256

            Select Case .objref.ItemSize
            Case 1
                If .objref.ValidArea2(p, 1) Then
                GetMem1 .objref.GetPtr(p), rB
                r = SG * cUbyte(CDbl(rB))
                Else
                    GoTo err1256
                End If
            Case 2
                If .objref.ValidArea2(p, 2) Then
                GetMem2 .objref.GetPtr(p), ri
                r = SG * cUint(CDbl(UINT(CLng(ri))))
                Else
                    GoTo err1256
                End If
            Case 8
                If .objref.ValidArea2(p, 8) Then
                GetMem8 .objref.GetPtr(p), rd
                r = SG * rd
                Else
                    GoTo err1256
                End If
            Case 4
                If .objref.ValidArea2(p, 4) Then
                GetMem4 .objref.GetPtr(p), dn
                r = SG * dn
                
            Else
err1256:
                Set bstack.lastobj = Nothing
                MyErMacro a$, "Wrong Size-Position for reading buffer", "Λάθος Μέγεθος-θέση, για διάβασμα Διάρθρωσης"
                
                Exit Function
                End If
            End Select
            
 End With
 Set bstack.lastobj = Nothing
    
  IsSint = FastSymbol(a$, ")", True)
    Exit Function
 End If
 If FastSymbol(a$, ",") Then
 If IsExp(bstack, a$, p) Then
 If p = 4 Then GoTo contsint1
 
 On Error Resume Next
    If r < 0 Then
    
      MyErMacro a$, "Unsign Integer can't be negative", "Ο χωρίς πρόσημο ακέραιος δεν μπορεί να είναι αρνητικός"
   
    Exit Function
    End If
    If p = 2 Then
    r = SG * cUint(r)
    Else
    r = SG * cUbyte(r)
    End If
    If Err.Number > 0 Then
    
      MyErMacro a$, "Unsign Integer to sign failed", "Η μετατροπή χωρίς πρόσημου ακέραιο σε ακέραιο με πρόσημο, απέτυχε"
    IsSint = False
    Exit Function
    
    End If
    On Error GoTo 0
  IsSint = FastSymbol(a$, ")", True)
    Exit Function
    
 End If
 Else
contsint1:
    On Error Resume Next
    If r < 0 Then
        Unsignlongnegative a$
    Exit Function
    End If
    r = SG * signlong(r)
    If Err.Number > 0 Then
    Unsignlongfailed a$

    IsSint = False
    Exit Function
    End If
    End If
    On Error GoTo 0
  IsSint = FastSymbol(a$, ")", True)
    Exit Function
      Else
                    
                MissParam a$
    End If
End Function
Private Function IsUsgn(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
If IsExp(bstack, a$, r) Then
 
    On Error Resume Next
    If r > uintnew(-1) Then r = uintnew(-1)
    r = Fix(r)
    If r < 0 Then r = 0
    
    If SG < 0 Then r = -r
    On Error GoTo 0
IsUsgn = FastSymbol(a$, ")", True)
    Exit Function
       Else
                    
                MissParam a$
    End If
End Function
Private Function IsLOWORD(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
If IsExp(bstack, a$, r) Then
    On Error Resume Next
    
    r = SG * Int((r - Int(r / 65536#) * 65536#))
    If Err.Number > 0 Then
    
    WrongArgument a$
        Exit Function
    
    End If
    On Error GoTo 0
    
   IsLOWORD = FastSymbol(a$, ")", True)
        Else
                
                MissParam a$
 End If
End Function
Private Function IsHIWORD(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
  If IsExp(bstack, a$, r) Then
    On Error Resume Next
    
    r = SG * Int(Int(r / 256) / 256)
    If Err.Number > 0 Then
    
    WrongArgument a$
  
    IsHIWORD = False
    Exit Function
    End If
    On Error GoTo 0
    
IsHIWORD = FastSymbol(a$, ")", True)
      Else
                
                MissParam a$
    
    End If
End Function
Private Function IsLen(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim anything As Object, p As Variant, s$
    If IsExp(bstack, a$, p) Then
len1234:
        If Typename(bstack.lastobj) = "mHandler" Then
        While Typename$(bstack.lastobj.objref) = "mHandler"
        Set bstack.lastobj = bstack.lastobj.objref
        Wend
            With bstack.lastobj
                If .indirect < 0 Then
                
                    If .t1 = 1 Then
                            If .objref.StructLen > 0 Then
                                r = SG * .objref.StructLen
                            Else
                                r = SG * .objref.count
                            End If
                            
                            IsLen = FastSymbol(a$, ")", True)
                            
                            Set bstack.lastobj = Nothing
                        Exit Function
                    ElseIf .t1 = 2 Then
                        r = SG * .objref.SizeByte()
                        
                        IsLen = FastSymbol(a$, ")", True)
                        Set bstack.lastobj = Nothing
                        Exit Function
                    ElseIf .t1 = 3 Then
                   ' if CheckDeepAny
                   Set anything = bstack.lastobj
                   If CheckDeepAny(anything) Then
                     If Typename(anything) = "mHandler" Then
                     r = SG * anything.objref.count
                     Else
                     
                     r = SG * anything.count
                     End If
                     Else
                     r = 0
                     End If
                            IsLen = FastSymbol(a$, ")", True)
                        Set bstack.lastobj = Nothing
                        Exit Function
                    ElseIf .t1 = 0 Then
                    r = 0
                            IsLen = FastSymbol(a$, ")", True)
                        Set bstack.lastobj = Nothing
                        Exit Function
                    ElseIf .t1 = 4 Then
                    r = SG * bstack.lastobj.index_start
                    IsLen = FastSymbol(a$, ")", True)
                        Set bstack.lastobj = Nothing
                        Exit Function
                    End If
                Else
                    r = SG * -1

                End If
            End With
        ElseIf Typename(bstack.lastobj) = myArray Then
                r = SG * bstack.lastobj.count
                IsLen = FastSymbol(a$, ")", True)
                Set bstack.lastobj = Nothing
                Exit Function
        Else
                r = SG * -1
                
        
        End If
        
        MissParam a$
    ElseIf IsStrExp(bstack, a$, s$) Then
        If bstack.lastobj Is Nothing Then
        
        r = SG * CDbl(Len(s$) - (LenB(s$) Mod 2 = 1) / 2#)
        Else
        GoTo len1234
        End If
        IsLen = FastSymbol(a$, ")", True)
    Else
        
        MissParam a$
    End If

End Function
Private Function IsLenDisp(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim p As Variant, s$

    If IsExp(bstack, a$, p) Then
    If Typename(bstack.lastobj) = "mHandler" Then
    ' check this please
    With bstack.lastobj
    If .indirect < 0 Then
    If TypeOf .objref Is FastCollection Then
        r = SG * .objref.count
        Set bstack.lastobj = Nothing
        IsLenDisp = FastSymbol(a$, ")", True)
        Exit Function
    ElseIf TypeOf .objref Is MemBlock Then
        r = SG * .objref.items
        Set bstack.lastobj = Nothing
        IsLenDisp = FastSymbol(a$, ")", True)
        Exit Function
    End If
    Else
     r = SG * -1
     IsLenDisp = FastSymbol(a$, ")", True)
        Exit Function
    ' length of object???
    End If
    End With
    End If
    
    MissParam a$
    ElseIf IsStrExp(bstack, a$, s$) Then
    r = SG * RealLen(s$)
    
    
    IsLenDisp = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    End If

End Function
Private Function IsDocLen(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, s$, w2 As Long, pppp As mArray
w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).SizeCRLF
                Else
                    r = SG * Len(var(w1))
                End If
                
                IsDocLen = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).SizeCRLF
                      Else
                      r = SG * Len(pppp.item(w2))
                      End If
                Else
                
                End If
                    
                IsDocLen = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    End If
End Function
Private Function IsDocWords(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, s$, w2 As Long, pppp As mArray
w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).WordCount
                Else
                MissFuncParammeterdOCVar a$
               End If
                
                IsDocWords = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).WordCount
                      Else
                       MissFuncParammeterdOCVar a$
                
                      End If
                Else
                
                End If
                    
                IsDocWords = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    End If
End Function
Private Function IsDocUniqueWords(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, s$, w2 As Long, pppp As mArray
w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).UniqueWords
                Else
                MissFuncParammeterdOCVar a$
               End If
                
                IsDocUniqueWords = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).UniqueWords
                      Else
                       MissFuncParammeterdOCVar a$
                
                      End If
                Else
                
                End If
                    
                IsDocUniqueWords = FastSymbol(a$, ")", True)
    Else
                    
                MissParam a$
    End If
End Function

Private Function IsCompMinMax(ByVal dn As Long, bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, w1 As Long, w2 As Long, s1$, dd As Long, w3 As Long, pppp As mArray, pppp1 As mArray
    w1 = Abs(IsLabel(bstack, a$, s$))
    If w1 = 1 Or w1 = 4 Then dd = 1  'WE NEED NUMBERS
    If w1 = 5 Or w1 = 7 Then dd = 2 'WE NEED NUMBERS
    If w1 = 0 Then MissingnumVar:: Exit Function
    If (w1 = 3 Or w1 = 6) And dd > 0 Then SyntaxError:: Exit Function
    If dd = 1 Then
        If GetVar(bstack, s$, w1) Then
                If Not FastSymbol(a$, ",") Then MissingnumVar:: Exit Function
                w3 = Abs(IsLabel(bstack, a$, s1$))
            If w3 = 1 Or w3 = 4 Then
                If GetVar(bstack, s1$, w2) Then
                Select Case dn
                Case 1
                    If var(w1) < var(w2) Then
                    
                        r = var(w1)
                        If SG < 0 Then r = -r
                    Else
                        r = var(w2)
                        If SG < 0 Then r = -r
                    End If
                Case 2
                    If var(w1) > var(w2) Then
                        r = var(w1)
                        If SG < 0 Then r = -r
                    Else
                        r = var(w2)
                        If SG < 0 Then r = -r
                    End If
                Case Else
                    If var(w1) = 0 Then
                    If var(w2) = 0 Then
                    r = 0
                    Else
                    r = Sgn(0 - MyRound(var(w2), 10))
                    If SG < 0 Then r = -r
                    End If
                    Else
                    If MyRound((var(w2) - var(w1)) / var(w1), 10) = 0 Then
                    r = 0
                    ElseIf var(w1) > var(w2) Then
                    r = SG
                    Else
                        r = -SG
                    End If
                    End If
                
                
                  
                End Select
                    
                    IsCompMinMax = FastSymbol(a$, ")", True)
                Exit Function
                Else
                    Nosuchvariable s1$
                    
                    Exit Function
                End If
            ElseIf w3 = 5 Or w3 = 7 Then
                If neoGetArray(bstack, s1$, pppp) Then
                    If Not NeoGetArrayItem(pppp, bstack, s1$, w2, a$) Then Exit Function
                    Select Case dn
                Case 1
                    If var(w1) < pppp.itemnumeric(w2) Then
                        r = var(w1)
                        If SG < 0 Then r = -r
                    Else
                        r = pppp.itemnumeric(w2)
                        If SG < 0 Then r = -r
                    End If
                Case 2
                    If var(w1) > pppp.itemnumeric(w2) Then
                        r = var(w1)
                        If SG < 0 Then r = -r
                    Else
                        r = pppp.itemnumeric(w2)
                        If SG < 0 Then r = -r
                    End If
              Case Else
                   If var(w1) = 0 Then
                            If pppp.itemnumeric(w2) = 0 Then
                            r = 0
                            Else
                            r = Sgn(0 - MyRound(pppp.itemnumeric(w2), 10))
                            If SG < 0 Then r = -r
                            End If
                    Else
                            r = Sgn(MyRound(((var(w1) - pppp.itemnumeric(w2)) / var(w1)), 10))
                            If SG < 0 Then r = -r
                    End If
              
                
                    End Select
                    
                    IsCompMinMax = FastSymbol(a$, ")", True)
                Else
                    Nosuchvariable s1$
                    
                    Exit Function
                End If
            Else
                MissingnumVar
                
                Exit Function
            End If
        Else
            Nosuchvariable s$
            
            Exit Function
        End If
        
    ElseIf dd = 2 Then
        If neoGetArray(bstack, s$, pppp) Then
            If Not NeoGetArrayItem(pppp, bstack, s$, w1, a$) Then Exit Function
            If Not FastSymbol(a$, ",") Then MissingnumVar:: Exit Function
                w3 = Abs(IsLabel(bstack, a$, s1$))
            If w3 = 1 Or w3 = 4 Then
                    If GetVar(bstack, s1$, w2) Then
                    Select Case dn
                    Case 1
                        If pppp.itemnumeric(w1) < var(w2) Then
                            r = pppp.itemnumeric(w1)
                            If SG < 0 Then r = -r
                        Else
                            r = var(w2)
                            If SG < 0 Then r = -r
                        End If
                    Case 2
                        If pppp.itemnumeric(w1) > var(w2) Then
                            r = pppp.itemnumeric(w1)
                            If SG < 0 Then r = -r
                        Else
                            r = var(w2)
                            If SG < 0 Then r = -r
                        End If
                    Case Else
                    
                    
                      If pppp.itemnumeric(w1) = 0 Then
                            If var(w2) = 0 Then
                            r = 0
                            Else
                            r = Sgn(0 - MyRound(var(w2), 10))
                            If SG < 0 Then r = -r
                            End If
                    Else
                            r = Sgn(MyRound(((pppp.item(w1) - var(w2)) / pppp.item(w1)), 10))
                            If SG < 0 Then r = -r
                    End If
                        
                    End Select
                        
                        IsCompMinMax = FastSymbol(a$, ")", True)
                    Else
                        MissingnumVar
                        
                        Exit Function
                    End If
            ElseIf w3 = 5 Or w3 = 7 Then
                    If neoGetArray(bstack, s1$, pppp) Then
                        If Not NeoGetArrayItem(pppp, bstack, s1$, w2, a$) Then Exit Function
                    Select Case dn
                    Case 1
                        If pppp.itemnumeric(w1) < pppp.itemnumeric(w2) Then
                            r = pppp.itemnumeric(w1)
                            If SG < 0 Then r = -r
                        Else
                            r = pppp.itemnumeric(w2)
                            If SG < 0 Then r = -r
                        End If
                    Case 2
                        If pppp.itemnumeric(w1) > var(w2) Then
                            r = pppp.itemnumeric(w1)
                            If SG < 0 Then r = -r
                        Else
                            r = pppp.itemnumeric(w2)
                            If SG < 0 Then r = -r
                        End If
                    Case Else
                        If pppp.itemnumeric(w1) = 0 Then
                            If pppp.itemnumeric(w2) = 0 Then
                            r = 0
                            Else
                            r = Sgn(0 - MyRound(pppp.itemnumeric(w2), 10))
                            If SG < 0 Then r = -r
                            End If
                    Else
                            r = Sgn(MyRound(((pppp.itemnumeric(w1) - pppp.itemnumeric(w2)) / pppp.itemnumeric(w1)), 10))
                            If SG < 0 Then r = -r
                    End If
                    End Select
                        
                        IsCompMinMax = FastSymbol(a$, ")", True)
                    Else
                        MissingnumVar
                        
                        Exit Function
                    End If
            Else
                MissingnumVar
                
                Exit Function
            End If
        Else
            MissingnumVar
            
            Exit Function
        End If
    ElseIf w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
            If Not FastSymbol(a$, ",") Then MissingnumVar:: Exit Function
                w3 = Abs(IsLabel(bstack, a$, s1$))
                If w3 = 6 Then
                    If Not neoGetArray(bstack, s1$, pppp) Then MissingStrVar::   Exit Function
                    If Not NeoGetArrayItem(pppp, bstack, s1$, w2, a$) Then Exit Function

                    r = CompareStr3(var(w1), CStr(pppp.item(w2)))    'StrComp(var(w1), CStr(pppp.item(w2)))
                    If SG < 0 Then r = -r

                ElseIf w3 = 3 Then
                    If Not GetVar(bstack, s1$, w2) Then: Exit Function

                    r = CompareStr3(var(w1), var(w2))  ' StrComp(var(w1), var(w2))
                    If SG < 0 Then r = -r
                            Else
                
                MissFuncParameterStringVarMacro a$
                Exit Function
                End If
                
                IsCompMinMax = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
            End If
    ElseIf w1 = 6 Then
            If neoGetArray(bstack, s$, pppp) Then
                If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                If Not FastSymbol(a$, ",") Then MissingnumVar:: Exit Function
                w3 = Abs(IsLabel(bstack, a$, s1$))
                If w3 = 6 Then
                    If Not neoGetArray(bstack, s1$, pppp1) Then MissingStrVar::   Exit Function
                    If Not NeoGetArrayItem(pppp1, bstack, s1$, w3, a$) Then Exit Function

                    r = CompareStr3(pppp.item(w2), pppp1.item(w3))
                    If SG < 0 Then r = -r
 
                ElseIf w3 = 3 Then
                    If Not GetVar(bstack, s1$, w3) Then: Exit Function

                    r = CompareStr3(pppp.item(w2), var(w3))
                    If SG < 0 Then r = -r
                Else
                
                MissFuncParameterStringVarMacro a$
                Exit Function
                End If
                
                IsCompMinMax = FastSymbol(a$, ")", True)
            Else
                
                MissParam a$
            End If
    Else
                 
                MissParam a$
    End If

End Function
Private Function IsEval(v$, bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim p As Variant, anything As Object, w3 As Long, w2 As Long, w1 As Long, PP As Variant, rB As Byte, ri As Integer, dn As Long, s$, ss$
Dim db As Double, pppp As mArray, IsGroupOnly As Group, ReadAsSingle As Boolean, ds As Single

w1 = 1
s$ = aheadstatus(a$, False, w1)
s$ = Left$(a$, w1)
ss$ = s$
    If CheckGroupOrPointer(bstack, s$, IsGroupOnly, pppp, w2) Then
    
            If Not IsGroupOnly Is Nothing Then
               
                If Not pppp Is Nothing And w2 <> -2 Then
                    a$ = Mid$(a$, w1 + 1 - Len(s$))
                    If IsGroupOnly.HasParameters Then
                        If Mid$(a$, 1, 1) <> "," Then
                       
                        IsEval = SpeedGroup(bstack, pppp, "VAL", "", a$, w2) = 1
                        r = bstack.LastValue
                        If MaybeIsSymbol(a$, ",") And Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                        Exit Function
                        Else
                        Mid$(a$, 1, 1) = "("
                        IsEval = SpeedGroup(bstack, pppp, "VAL", "", a$, w2) = 1
                        r = bstack.LastValue
                       ' If MaybeIsSymbol(a$, ",") And Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                        'IsEval = FastSymbol(a$, ")", True) And IsEval
                        End If

                    Else
                        IsEval = SpeedGroup(bstack, pppp, "VAL", "", a$, w2) = 1
                        r = bstack.LastValue
                        If Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                        If MaybeIsSymbol(a$, ",") And Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                        IsEval = FastSymbol(a$, ")", True) And IsEval
                    End If
                    
                Else
                    If IsGroupOnly.HasParameters Then
                    
                    If Mid$(a$, w1 - 1, 1) <> ")" Then
                        If Mid$(a$, w1, 1) = "," Then Mid$(a$, w1, 1) = "("
                        IsEval = IsNumber(bstack, a$, r)
                        Exit Function
                        Else
                        IsEval = IsNumber(bstack, a$, r)
                        If Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                         End If
                    Else
                        IsEval = IsNumber(bstack, a$, r)
                         If Typename(bstack.lastobj) = "mHandler" Then GoTo handlehandlers
                        IsEval = FastSymbol(a$, ")", True) And IsEval
                        
                    End If
                End If
                If SG < 0 Then r = -r
             '   If Not bstack.lastobj Is Nothing Then GoTo conthere
                Exit Function
            Else
            a$ = Mid$(a$, w1 + 1 - Len(s$))
            GoTo getgroup
            End If
    ElseIf IsExp(bstack, ss$, p) Then
    If Len(ss$) > 0 Then Mid$(a$, w1 + 1 - Len(ss$), Len(ss$)) = ss$
    Mid$(a$, 1, w1 + 1 - Len(ss$)) = Space$(w1 - Len(ss$))
handlehandlers:
        w1 = 0
        s$ = ""
        If Typename(bstack.lastobj) = "mHandler" Then
            Set anything = bstack.lastobj
        If bstack.lastobj.IamEnum Then
        r = bstack.lastobj.index_cursor
        If SG < 0 Then r = -r
        Set bstack.lastobj = Nothing
         IsEval = FastSymbol(a$, ")", True)
        Exit Function
        ElseIf Not CheckLastHandlerOrIterator(anything, w3) Then
        InternalError
        IsEval = False
        Exit Function
        End If
            With anything
                If .t1 = 1 Then
                        If FastSymbol(a$, ",") Then
                        If IsExp(bstack, a$, PP) Then
                            w3 = CLng(Int(PP))
                            If w3 < 0 Or w3 >= .objref.count Then
                            indexout a$
                            Exit Function
                            End If
                        w1 = True
                        End If
                        End If
                    On Error GoTo there12
                    If w3 >= 0 Then
                        .objref.index = w3
                        .objref.Done = True
                    End If
                    If .objref.Done Then
                        If w1 Then
                        r = .objref.KeyToNumber
                        If SG < 0 Then r = -r
                        Set bstack.lastobj = Nothing
                        ElseIf FastSymbol(a$, "!") Then
                            r = .objref.index
                            If SG < 0 Then r = -r
                            Set bstack.lastobj = Nothing
                        Else
                            If .objref.IsObj Then
                                r = rValue(bstack, .objref.ValueObj)
                                If SG < 0 Then r = -r
                            Else
                                r = MyVal(.objref.Value)
                                If SG < 0 Then r = -r
                                Set bstack.lastobj = Nothing
                            End If
                        End If
                        
                        IsEval = FastSymbol(a$, ")", True)
                    End If
there12:
                    On Error GoTo 0
                    Set anything = Nothing
                    Exit Function
                ElseIf .t1 = 2 Then
                    ' p is offset for items not bytes
                    If FastSymbol(a$, ",") Then
                        If IsExp(bstack, a$, p) Then
                        
                            w1 = Abs(Asc(v$) < 128)
                            If IsLabelSymbolNew(a$, "ΩΣ", "AS", w1, , , , False) Then
                                If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", w1, , , , False) Then
                                    PP = 1
                                ElseIf IsLabelSymbolNew(a$, "ΑΚΕΡΑΙΟΣ", "INTEGER", w1, , , , False) Then
                                    PP = 2
                                ElseIf IsLabelSymbolNew(a$, "ΜΑΚΡΥΣ", "LONG", w1, , , , False) Then
                                    PP = 4
                                ElseIf IsLabelSymbolNew(a$, "ΔΙΠΛΟΣ", "DOUBLE", w1, , , , False) Then
                                    PP = 8
                                ElseIf IsLabelSymbolNew(a$, "ΑΠΛΟΣ", "SINGLE", w1, , , , False) Then
                                    PP = 4
                                    ReadAsSingle = True
                                Else
                                    SyntaxError
                                    
                                    Exit Function
                                End If
                                ' use another itemsize
                                ' p is byte offset
                                w2 = .objref.GetBytePtr(p)
absolute:
                                If .objref.ValidArea(w2, PP) Then
                                PP = Abs(PP)
                                    Select Case PP
                                    Case 1
                                        GetMem1 w2, rB
                                        r = SG * CDbl(rB)
                                    Case 2
                                        GetMem2 w2, ri
                                        r = SG * CDbl(UINT(CLng(ri)))
                                    Case 4
                                        If ReadAsSingle Then
                                            GetMemS w2, ds
                                            If SG = 1 Then
                                                r = ds
                                            Else
                                                r = -ds
                                            End If
                                        Else
                                            GetMem4 w2, dn
                                            r = SG * CDbl(uintnew(CDbl(dn)))
                                        End If
                                        
                                    Case 8
                                        GetMem8 w2, db
                                        r = SG * db
                                    Case 16
                                    
                                    End Select
                                Else
                                    GoTo errortext
                                End If
                            
                            Else
firstpram:
                                Set anything = .objref
                                With anything
         
                                 PP = .ItemSize
                                 ReadAsSingle = .WhatAreBasicItem = vbSingle
                                 If FastSymbol(a$, "!") Then
                                     If IsLabelOnly(a$, s$) Then
                                                If .structref Is Nothing Then
                                                MyEr "No structure exist for buffer", "Δεν υπάρχει δομή για την διάρθρωση"
                                                IsEval = False
                                                Exit Function
                                                End If
                                                If .structref.Find(myUcase(s$, True)) Then
                                                       PP = Abs(.structref.sValue)
                                                       If PP = 4 Then
                                                       If .structref.KeyTypeValue = vbSingle Then
                                                        ReadAsSingle = True
                                                       End If
                                                       End If
                                                       If FastSymbol(a$, "!") Then
                                                           If Not IsExp(bstack, a$, r) Then
                                                                    GoTo errortext1
                                                           ElseIf r >= 0 Then
                                                           
                                                                    w2 = cUlng(uintnew(.GetPtr(p)) + .structref.Value + Int(r) * PP)
                                                                    GoTo absolute
                                                           Else
                                                                    NegativeIindex a$
                                                                   GoTo errortext1
                                                           End If
                                                       Else
                                                           w2 = cUlng(uintnew(.GetPtr(p)) + .structref.Value)
                                                           GoTo absolute
                                                       End If
                                                 Else
                                                    unknownoffset a$, s$
                                                    GoTo errortext1
                                                 End If
                                    End If
                                End If
                                Select Case PP
                                Case 1
                                    If .ValidArea2(p, 1) Then
                                        GetMem1 .GetPtr(p), rB
                                        r = SG * CDbl(rB)
                                    Else
                                        GoTo errortext
                                    End If
                                Case 2
                                    If .ValidArea2(p, 2) Then
                                        GetMem2 .GetPtr(p), ri
                                        r = SG * CDbl(UINT(CLng(ri)))
                                    Else
                                        GoTo errortext
                                    End If
                                Case 8
                                    If .ValidArea2(p, 8) Then
                                        GetMem8 .GetPtr(p), db
                                        r = SG * db
                                    Else
                                        GoTo errortext
                                    End If
                                Case 4
                                    If .ValidArea2(p, 4) Then
                                        If ReadAsSingle Then
                                           GetMemS .GetPtr(p), ds
                                            If SG = 1 Then
                                                r = ds
                                            Else
                                                r = -ds
                                            End If
                                        Else
                                            GetMem4 .GetPtr(p), dn
                                            r = SG * CDbl(uintnew(CDbl(dn)))
                                        End If
                                    Else
errortext:
                                         wrongsizeOrposition a$
errortext1:
                                        Set anything = Nothing
                                        
                                        
                                        Exit Function
                                    End If
                                End Select
                                
               
                                End With
                            End If
                                           IsEval = FastSymbol(a$, ")", True)
                                
                                Set anything = Nothing
                                Exit Function
                        End If
                    Else
                    p = 0
                    GoTo firstpram
                    End If
               ElseIf .t1 = 3 Then
                If CheckDeepAny(anything) Then
                If TypeOf anything Is mStiva Then
                
                End If
                End If
                GoTo there1234459
               ElseIf .t1 = 4 Then
               Dim aa As mHandler
               Set aa = New mHandler
               If w3 = -1 Then
               aa.index_cursor = anything.index_cursor
               Set aa.objref = anything.objref
               aa.index_start = anything.index_start
               Else
               aa.index_cursor = anything.objref.Value
               Set aa.objref = anything.objref
               aa.index_start = anything.objref.index
              
               End If
               aa.t1 = 4
               If SG < 0 Then r = -r
               Set bstack.lastobj = aa
                IsEval = FastSymbol(a$, ")", True)
                       Exit Function
               Else
there1234459:
                    ' eval for objects???
                    r = 0
                       IsEval = FastSymbol(a$, ")", True)
                       Exit Function
               End If
               Set anything = Nothing
            End With
        ElseIf Not bstack.lastpointer Is Nothing Then
getgroup:
            If Not bstack.lastpointer.IamApointer Then Set bstack.lastpointer = bstack.lastobj
            If bstack.lastpointer.link.IamFloatGroup Then
              Set pppp = New mArray
            pppp.PushDim 1
            pppp.PushEnd
            pppp.Arr = True
            Set pppp.item(0) = bstack.lastpointer
            Set bstack.lastpointer = Nothing
            If pppp.item(0).link.HasParameters Then
            FastSymbol a$, ","
            IsEval = SpeedGroup(bstack, pppp, "VAL", "", a$, 0) = 1
            r = bstack.LastValue
             Exit Function
            Else
            FastSymbol a$, ","
            IsEval = SpeedGroup(bstack, pppp, "VAL", "", a$, 0) = 1
            r = bstack.LastValue
            GoTo conthere
            End If
                Exit Function
            Else
            'Set bstack.lastpointer = bstack.lastobj
            If MaybeIsSymbol(a$, ",") Then
            Mid$(a$, 1, 1) = Chr(0)
            If IsNumber(bstack, a$, r) Then
            If SG < 0 Then r = -r
                       IsEval = True
                       
                       Exit Function
                       End If
            Else
            If IsNumber(bstack, Chr$(0) + "'", r) Then
                GoTo conthere
            End If
            End If
          End If
        
        End If
        MissParam a$
    ElseIf IsStrExp(bstack, ss$, s$) Then
    If Len(ss$) > 0 Then Mid$(a$, w1 + 1 - Len(ss$), Len(ss$)) = ss$
    Mid$(a$, 1, w1 + 1 - Len(ss$)) = Space$(w1 - Len(ss$))
    If FastSymbol(a$, ".") Then
    If MaybeIsSymbol(a$, ")") Then
        
            If Not IsExp(bstack, s$, r) Then
          
            wrongweakref a$
        Else
            If SG < 0 Then r = -r
            
            IsEval = FastSymbol(a$, ")", True)
        End If
            
        Else
        a$ = s$ + "." + a$
        
        If Not IsExp(bstack, a$, r) Then
          
            wrongweakref a$
        Else
        If SG < 0 Then r = -r
            
            IsEval = FastSymbol(a$, ")", True)
        End If
        End If
    Else
    
            If Not IsExp(bstack, s$, r) Then
            
            wrongexprinstring a$
            Else
conthere:
            If SG < 0 Then r = -r
            IsEval = FastSymbol(a$, ")", True)
            End If
    End If
    Else
        MissParam a$
    End If
End Function
Private Function IsPoint(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, s$, w2 As Long, pppp As mArray
Dim r2 As Variant, r3 As Variant, r4 As Variant
w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) <> "String" Then MissString: Exit Function
                    If Left$(var(w1), 4) = "cDIB" And Len(var(w1)) > 12 Then
                    If FastSymbol(a$, ",") Then
                        If Not IsExp(bstack, a$, r2) Then: MissParam a$: Exit Function
                        If FastSymbol(a$, ",") Then
                            If Not IsExp(bstack, a$, r3) Then: MissParam a$: Exit Function
                            If FastSymbol(a$, ",") Then
                                If Not IsExp(bstack, a$, r4) Then: MissParam a$: Exit Function
                                    r = SetDIBPixel(var(w1), r2, r3, mycolor(r4))
                                Else
                                    r = GetDIBPixel(var(w1), r2, r3)
                                End If
                                If SG < 0 Then r = -r
                                IsPoint = FastSymbol(a$, ")", True)
                            Else
                                MissParam a$: Exit Function
                            End If
                        Else
                            MissParam a$: Exit Function
                        End If
                    Else
                    noImage a$
                    Exit Function
        End If
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
            If neoGetArray(bstack, s$, pppp) Then
                If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                If Not pppp.IsStringItem(w2) Then MissString: Exit Function
                Dim sV As Variant
                pppp.SwapItem w2, sV
          
                If Left$(sV, 4) = "cDIB" And Len(sV) > 12 Then
                    If FastSymbol(a$, ",") Then
                        If Not IsExp(bstack, a$, r2) Then: MissParam a$: pppp.SwapItem w2, sV: Exit Function
                        If FastSymbol(a$, ",") Then
                            If Not IsExp(bstack, a$, r3) Then: MissParam a$: pppp.SwapItem w2, sV: Exit Function
                            If FastSymbol(a$, ",") Then
                                If Not IsExp(bstack, a$, r4) Then: MissParam a$: pppp.SwapItem w2, sV: Exit Function
                                r = SetDIBPixel(sV, r2, r3, mycolor(r4))
                            Else
                                r = GetDIBPixel(sV, r2, r3)
                            End If
                            If SG < 0 Then r = -r
                            pppp.SwapItem w2, sV
                            IsPoint = FastSymbol(a$, ")", True)
                        Else
                            pppp.SwapItem w2, sV
                            MissParam a$: Exit Function
                        End If
                    Else
                        pppp.SwapItem w2, sV
                        MissParam a$: Exit Function
                    End If
                Else
                    pppp.SwapItem w2, sV
                    noImage a$
                End If
    
        Else
            MissParam a$
        End If
End If





End Function
Private Function IsCtime(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim par As Boolean, r2 As Variant, r3 As Variant, r4 As Variant
If IsExp(bstack, a$, r) Then
  
    r = Abs(r)
    par = True
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r2)
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r3) And par
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r4) And par
    End If
    End If
    End If
    
       If Not par Then
     MissParam a$
     Exit Function
                End If
                On Error Resume Next
    r = CDbl(TimeSerial(Hour(CDate(r)) + r2, Minute(CDate(r)) + r3, Second(CDate(r)) + r4) + Int(Abs(r)))
    If SG < 0 Then r = -r
                If Err.Number > 0 Then
    WrongArgument a$
    Err.Clear
    Exit Function
    End If
    On Error GoTo 0
     IsCtime = FastSymbol(a$, ")", True)
      Else
   
     MissParam a$
    End If
End Function
Private Function IsCdate(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim PP As Variant, par As Boolean, r2 As Variant, r3 As Variant, r4 As Variant
   If IsExp(bstack, a$, r) Then
    PP = Abs(r) - Fix(Abs(r))
    r = Abs(r Mod 2958466)
    par = True
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r2)
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r3) And par
    If FastSymbol(a$, ",") Then
    par = IsExp(bstack, a$, r4) And par
    
    End If
    End If
    End If
    
    If Not par Then
     MissParam a$
     Exit Function
                End If
                On Error Resume Next
     r = CDbl(DateSerial(Year(r) + r2, Month(r) + r3, Day(r) + r4) + PP)
     If SG < 0 Then r = -r
              If Err.Number > 0 Then
    WrongArgument a$
    Err.Clear
    Exit Function
    End If
    On Error GoTo 0
 IsCdate = FastSymbol(a$, ")", True)
   Else
   
     MissParam a$
    
    End If
    
End Function
Private Function IsTimeVal(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$
    If IsStrExp(bstack, a$, s$) Then
    On Error Resume Next
    
    r = CDbl(CDate(TimeValue(s$)))
    If SG < 0 Then r = -r
         If Err.Number > 0 Then
    
    WrongArgument a$
    Err.Clear
    Exit Function
    End If
        On Error GoTo 0
    
    IsTimeVal = FastSymbol(a$, ")", True)
    Else
     
                MissParam a$
    End If

End Function
Private Function IsDataVal(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
 Dim s$
    If IsStrExp(bstack, a$, s$) Then
    On Error Resume Next
    r = CDbl(DateValue(s$))
    If SG < 0 Then r = -r
     If Err.Number > 0 Then
    
    WrongArgument a$
    Err.Clear
    Exit Function
    End If
    On Error GoTo 0
    
    IsDataVal = FastSymbol(a$, ")", True)
      Else
     
                MissParam a$
    End If

End Function
Private Function IsVal(bstack As basetask, a$, r As Variant, SG As Variant, Eng As Boolean) As Boolean
Dim s$, ex$, dd As Long, PP As Variant, Lang As Long
    If Eng Then Lang = 1
   If IsStrExp(bstack, a$, s$) Then
    On Error Resume Next
    If FastSymbol(a$, ",") Then
      If IsStrExp(bstack, a$, ex$) Then
      If Len(ex$) <> 1 Then
      dd = AscW(NowDec$)
      Else
          dd = AscW(ex$)
          End If
       If InStr(s$, ".") > 0 And dd <> 46 Then
        s$ = Replace(s$, ".", "*", 1, 1)
        End If
        s$ = Replace(s$, ChrW(dd), ".", 1, 1)
        dd = 46
    ElseIf IsExp(bstack, a$, PP) Then
        PP = Fix(PP)
        dd = AscW(GetlocaleString2(14, CLng(PP)))
        If InStr(s$, ".") > 0 And dd <> 46 Then
        s$ = Replace(s$, ".", "*", 1, 1)
        End If
        s$ = Replace(s$, ChrW(dd), ".", 1, 1)
        dd = 46
    Else
    
    expecteddecimal a$
    Err.Clear
    Exit Function
      End If
    Else
    dd = AscW(GetDeflocaleString(14))
    End If
    If MaybeIsSymbol(s$, "ΑαΨψTtFf") Then
    If CDbl(PP) = 0 Then
    If Fast3NoSpace(s$, "ΑΛΗΘΕΣ", 6, "ΑΛΗΘΗΣ", 6, "TRUE", 4, 6) Then
        r = CBool(True)
        If SG < 0 Then r = -r
    ElseIf Fast3NoSpace(s$, "ΨΕΥΔΕΣ", 6, "ΨΕΥΔΗΣ", 6, "FALSE", 5, 5) Then
       r = CBool(False)
        If SG < 0 Then r = -r
    Else
    r = 0
   End If
    Else
        If PP = 1023 Then
                 If Fast3NoSpace(s$, "ΑΛΗΘΕΣ", 6, "ΑΛΗΘΗΣ", 6, vbNullString, 0, 6) Then
                     r = CBool(True)
                     If SG < 0 Then r = -r
                 ElseIf Fast3NoSpace(s$, "ΨΕΥΔΕΣ", 6, vbNullString, 0, vbNullString, 0, 5) Then
                    r = CBool(False)
                     If SG < 0 Then r = -r
                 Else
                 r = 0
                End If
        Else
             If Fast3NoSpace(s$, "TRUE", 4, vbNullString, 0, vbNullString, 0, 4) Then
                 r = CBool(True)
                 If SG < 0 Then r = -r
             ElseIf Fast3NoSpace(s$, "FALSE", 5, vbNullString, 0, vbNullString, 0, 5) Then
                r = CBool(False)
                 If SG < 0 Then r = -r
             Else
             r = 0
            End If
     End If
     End If
    ElseIf dd = 46 Then
    r = val(s$)
    If SG < 0 Then r = -r
    
    Else
    r = val(Replace(s$, ChrW(dd), "."))
    If SG < 0 Then r = -r
    End If
    If Err.Number > 0 Then
    Err.Clear
    WrongArgument a$
    Exit Function
    End If
    On Error GoTo a100
    If FastSymbol(a$, ",") Then
    
    Dim mm As mStiva
   Set mm = New mStiva
    Dim oldm As mStiva
    Set oldm = bstack.soros
    Set bstack.Sorosref = mm
    mm.PushVal ValidNumberOnlyClean(s$, r, Len(ex$) > 1)
    FastSymbol a$, "&"
    If Not MyRead(1, bstack, a$, Lang) Then
    IsVal = False
    Set bstack.Sorosref = oldm
    Exit Function
    End If
    Set bstack.Sorosref = oldm
    End If
    IsVal = FastSymbol(a$, ")", True)
    ElseIf IsExp(bstack, a$, r) Then
    If FastSymbol(a$, "->", False, 2) Then
    If FastSymbol(a$, "0@", , 2) Then
        On Error GoTo a500
        r = CDec(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    ElseIf FastSymbol(a$, "0#", , 2) Then
        On Error GoTo a400
        r = CCur(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    ElseIf FastSymbol(a$, "0&", , 2) Then
        On Error GoTo a100
        r = CLng(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    ElseIf FastSymbol(a$, "0~", , 2) Then
        On Error GoTo a200
        r = CSng(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    ElseIf FastSymbol(a$, "0") Then
        On Error GoTo a300
        r = CDbl(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    Else
    
        If IsLabelSymbolNew(a$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
            On Error GoTo a500
            r = CDec(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
        ElseIf IsLabelSymbolNew(a$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
            On Error GoTo a300
            r = CDbl(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
        ElseIf IsLabelSymbolNew(a$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
            r = CSng(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
        ElseIf IsLabelSymbolNew(a$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
            r = CBool(SG * r)
            IsVal = FastSymbol(a$, ")", True)
        ElseIf IsLabelSymbolNew(a$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
            On Error GoTo a100
            r = CLng(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
         ElseIf IsLabelSymbolNew(a$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
            On Error GoTo a150
            r = CInt(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
        ElseIf IsLabelSymbolNew(a$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
            On Error GoTo a400
            r = CCur(r)
            If SG < 0 Then r = -r
            IsVal = FastSymbol(a$, ")", True)
        Else
    
        CantFind "0@ 0# 0& 0~ 0% 0"
        End If
    End If
    Else
        On Error GoTo a300
        r = CDbl(r)
        If SG < 0 Then r = -r
        IsVal = FastSymbol(a$, ")", True)
    End If
    
    Else
                MissParam a$
    End If
 Exit Function
a100:
 IsVal = False
 If Err.Number = 6 Then
 
   OverflowLong
 Else
    MyEr Err.Description, Err.Description
 End If
 Err.Clear
 Exit Function
a150:
 IsVal = False
 If Err.Number = 6 Then
 
   OverflowLong True
 Else
    MyEr Err.Description, Err.Description
 End If
 Err.Clear
 Exit Function
 
a200:
 IsVal = False
 If Err.Number = 6 Then
 
    MyEr "Overflow single", "υπερχείλιση απλού"
 Else
    MyEr Err.Description, Err.Description
 End If
Err.Clear
Exit Function
a300:
 IsVal = False
 If Err.Number = 6 Then
 
    MyEr "Overflow double", "υπερχείλιση διπλού"
 Else
    MyEr Err.Description, Err.Description
 End If
Err.Clear
Exit Function
a400:
 IsVal = False
 If Err.Number = 6 Then
 
    MyEr "Overflow Currency", "υπερχείλιση Λογιστικού"
 Else
    MyEr Err.Description, Err.Description
 End If
Err.Clear
Exit Function
a500:
 IsVal = False
 If Err.Number = 6 Then
 
    MyEr "Overflow Decimal", "υπερχείλιση Δεκαδικού"
 Else
    MyEr Err.Description, Err.Description
 End If
Err.Clear

End Function
Private Function IsRinstr(bstack As basetask, a$, r As Variant, SG As Variant, Lang As Long) As Boolean
Dim s$, s1$, par As Boolean
    If IsStrExp(bstack, a$, s$) Then
        If FastSymbol(a$, ",") Then
        
            If IsStrExp(bstack, a$, s1$) Then
                If FastSymbol(a$, ",") Then
                    If Not IsExp(bstack, a$, r) Then
                        MissParam a$
                        Exit Function
                    End If
                    par = True
                End If
           
             If IsLabelSymbolNew(a$, "ΩΣ", "AS", Lang, , , , False) Then
        If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", Lang, , , , False) Then
                 If par Then
                 If r < 0 Then r = LenB(s$) + r + 1
                If r < 0 Then r = 1
                r = LenB(s$) - r + 1
                If r < 0 Then r = 1
                If r > LenB(s$) Then r = LenB(s$)
        Else
        r = LenB(s$)
        End If
           r = SG * rinstrb(s$, s1$, r)
        Else
           SyntaxError
            Exit Function
        End If
        Else
        If par Then
        If r < 0 Then r = Len(s$) + r + 1
                If r < 0 Then r = 1
                r = Len(s$) - r + 1
                If r < 0 Then r = 1
                If r > Len(s$) Then r = Len(s$)
        Else
        r = Len(s$)
        End If
     r = SG * InStrRev(s$, s1$, r)
    End If
            
            
            IsRinstr = FastSymbol(a$, ")", True)
    Else
        MissParam a$
    End If
        Else
            MissParam a$
    End If
        Else
            MissParam a$
    End If

End Function
Private Function IsInstr(bstack As basetask, a$, r As Variant, SG As Variant, Lang As Long) As Boolean
Dim s$, s1$
    If IsStrExp(bstack, a$, s$) Then
    If FastSymbol(a$, ",") Then
    If IsStrExp(bstack, a$, s1$) Then
        If FastSymbol(a$, ",") Then
        If Not IsExp(bstack, a$, r) Then
          
                MissParam a$
         Exit Function
        End If
        Else
        r = 1
        End If
      If IsLabelSymbolNew(a$, "ΩΣ", "AS", Lang, , , , False) Then
        If IsLabelSymbolNew(a$, "ΨΗΦΙΟ", "BYTE", Lang, , , , False) Then
           
           r = InStrB(r, s$, s1$)
        Else
           SyntaxError
            Exit Function
        End If
        Else
    r = InStr(r, s$, s1$)
    End If
    If SG < 0 Then r = -r
    
    IsInstr = FastSymbol(a$, ")", True)
    Else
            MissParam a$
    End If
        Else
            MissParam a$
    End If
        Else
            MissParam a$
    End If
    
End Function
Private Function IsRecords(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim VR As Long
    If IsExp(bstack, a$, r) Then
        VR = r Mod 512
        If FLEN(VR) = 0 Then
            wrongfilenumber a$
            
        Else
            r = SG * LOF(VR) / FLEN(VR)
            
            IsRecords = FastSymbol(a$, ")", True)
        End If
    Else
        
        MissParam a$
    End If
End Function
Private Function IsGroupCount(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, w2 As Long, pppp As mArray
Select Case IsLabel(bstack, a$, s$)
Case 1
            If GetVar(bstack, s$, w2) Then
                If Typename(var(w2)) = "Group" Then
                    If var(w2).IamApointer Then
                    
                    Else
                    r = var(w2).PrepareSoros(var(), "").Total
                    If SG < 0 Then r = -r
                    End If
                Else
                
                MissingGroup
                Exit Function
                End If
                
                IsGroupCount = FastSymbol(a$, ")", True)
                Exit Function
            Else
            
            Nosuchvariable s$
            End If
    Case 5
    If Not neoGetArray(bstack, s$, pppp) Then Exit Function
            If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
            If pppp.Arr Then
                If Typename(pppp.item(w2)) = "Group" Then
                r = 0
                Else
                MissingGroup
                Exit Function
                End If
            Else
            
                If Typename(pppp.GroupRef) = "mHandler" Then
                    
                    Set bstack.lastobj = pppp.GroupRef.objref
                    With bstack.lastobj
                        If pppp.GroupRef.t1 = 1 Then
                            If .IsObj Then
                                If Typename(.ValueObj) = "mHandler" Then
                                    Select Case .ValueObj.t1
                                        Case 1
                                        Case 2
                                        Case 3
                                        Case Else
                                            If Typename(.ValueObj.objref) = "Group" Then
                                            
                                            End If
                                    End Select
                                End If
                            Else
                                If Typename(.Value) = "Group" Then
                                
                                End If
                            End If
                        End If
                    End With
                    Set bstack.lastobj = Nothing
                Else
                    If Typename(pppp.GroupRef) = "Group" Then
                            End If
                End If
                    
        End If
                     
            
            IsGroupCount = FastSymbol(a$, ")")

    Case Else
       
        MissingGroup
End Select
End Function
Private Function IsCollide(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim r2 As Variant
If IsExp(bstack, a$, r) Then
r = Fix(r)
If FastSymbol(a$, ",") Then
    If Not IsExp(bstack, a$, r2) Then: MissParam a$: IsCollide = False: Exit Function
    r2 = Fix(r2)
    If FastSymbol(a$, ",") Then
    r = SG * CollideArea(CLng(r), CLng(r2), bstack, a$)
    Else
    r = SG * CollidePlayers(CLng(r), CLng(r2))
    End If
Else
r = SG * CollidePlayers(CLng(r), CLng(100))
End If
   
    IsCollide = FastSymbol(a$, ")", True)
End If
End Function
Private Function IsParagr(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, PP As Variant, dn As Long, w1 As Long, w2 As Long, pppp As mArray
    w1 = Abs(IsLabel(bstack, a$, s$))
                  
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
        
                       If IsExp(bstack, a$, PP) Then
                                dn = CLng(Fix(PP))
                              r = SG * var(w1).ParagraphFromOrder(dn)           ''
                                 
                            
                                 Else
                                       MissNumExpr
                                        
                                        IsParagr = False
                                        Exit Function
                                 End If
         
               Else
                    MissingDoc
                                        
                                        IsParagr = False
                                        Exit Function
                End If
                
                IsParagr = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                                If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
                            If IsExp(bstack, s$, PP) Then
                                dn = CLng(Fix(PP))
                                 r = SG * pppp.item(w2).ParagraphFromOrder(dn)
                                 Else
                                        MissNumExpr
                                        
                                        IsParagr = False
                                        Exit Function
                                 End If
                  Else
                    MissingDoc
                                        
                                        IsParagr = False
                                        Exit Function
                End If
                    
                IsParagr = FastSymbol(a$, ")", True)
    Else
                    
                MissFuncParameterStringVarMacro a$
    End If
End Function
Private Function IsParIndex(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$, w1 As Long, w2 As Long, dn As Long, pppp As mArray
    w1 = Abs(IsLabel(bstack, a$, s$))
                  
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
                         w2 = Abs(IsLabel(bstack, a$, s$)) ' ONLY AN ARITHMETIC VAR.
    
                        If w2 = 1 Or w2 = 4 Then
                                If GetVar(bstack, s$, w2) Then
                                dn = var(w2)
                              r = SG * var(w1).ParagraphOrder(dn)           ''
                                 
                            
                                 Else
                                        Nosuchvariable s$
                                        
                                        IsParIndex = False
                                        Exit Function
                                 End If
                         
                        Else
                                        MissingnumVar
                                        
                                        IsParIndex = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        
                                        IsParIndex = False
                                        Exit Function
                End If
                
                IsParIndex = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                                If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
                         w1 = Abs(IsLabel(bstack, a$, s$)) ' ONLY AN ARITHMETIC VAR..
                        If w1 = 1 Or w1 = 2 Then
                                If GetVar(bstack, s$, w1) Then
                                dn = var(w1)
                                 r = SG * pppp.item(w2).ParagraphOrder(dn)
                                 Else
                                        Nosuchvariable s$
                                        
                                        IsParIndex = False
                                        Exit Function
                                 End If
                         
                        Else
                                        Nosuchvariable s$
                                        
                                        IsParIndex = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        
                                        IsParIndex = False
                                        Exit Function
                End If
                    
                IsParIndex = FastSymbol(a$, ")", True)
    Else
                    
                MissFuncParameterStringVarMacro a$
    End If

End Function
Private Function IsForwBack(ByVal dd As Long, bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, w2 As Long, s$, dn As Long, pppp As mArray


w1 = Abs(IsLabel(bstack, a$, s$))
        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                        If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
                         w2 = Abs(IsLabel(bstack, a$, s$)) ' ONLY AN ARITHMETIC VAR..
                        If w2 = 1 Or w2 = 4 Then
                                If GetVar(bstack, s$, w2) Then
                                dn = var(w2)
                                If dd = 1 Then
                                var(w1).BackStep dn
                                var(w1).BackMove = True
                                Else
                                var(w1).BackMove = False
                                var(w1).Advance dn
                                End If
                                 r = SG * Not var(w1).IsEmpty
                                 '    r = SG * var(w1).ParagraphOrder(dn)          ''
                                 
                                 var(w2) = dn
                                 Else
                                        Nosuchvariable s$
                                        
                                        IsForwBack = False
                                        Exit Function
                                 End If
                         
                        Else
                                        MissingnumVar
                                        
                                        IsForwBack = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        
                                        IsForwBack = False
                                        Exit Function
                End If
                
                IsForwBack = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                                If Not FastSymbol(a$, ",") Then: MissParam a$: Exit Function
                         w1 = Abs(IsLabel(bstack, a$, s$)) ' ONLY AN ARITHMETIC VAR..
                         If w1 = 1 Or w1 = 2 Then
                                If GetVar(bstack, s$, w1) Then
                                dn = var(w1)
                                 If dd = 1 Then
                                pppp.item(w2).BackStep dn
                                pppp.item(w2).BackMove = True
                                Else
                              pppp.item(w2).BackMove = False
                                 pppp.item(w2).Advance dn
                                End If
                                r = SG * Not pppp.item(w2).IsEmpty
                                '' r = SG * pppp.item(w2).ParagraphOrder(dn)
                                
                                 var(w1) = dn
                                 Else
                                        Nosuchvariable s$
                                        
                                        IsForwBack = False
                                        Exit Function
                                 End If
                         
                        Else
                                        Nosuchvariable s$
                                        
                                        IsForwBack = False
                                        Exit Function

                        End If
                Else
                    MissingDoc
                                        
                                        IsForwBack = False
                                        Exit Function
                End If
                    
                IsForwBack = FastSymbol(a$, ")", True)
    Else
                    
                MissFuncParameterStringVarMacro a$
    End If
End Function
Private Function IsDocPar(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, w2 As Long, s$, pppp As mArray
w1 = Abs(IsLabel(bstack, a$, s$))

        If w1 = 3 Then
            If GetVar(bstack, s$, w1) Then
                If Typename(var(w1)) = doc Then
                    r = SG * var(w1).DocParagraphs
                Else
                    r = 0
                End If
                
                IsDocPar = FastSymbol(a$, ")", True)
            Else
                    
                    MissFuncParameterStringVarMacro a$
                    
            End If
        ElseIf w1 = 6 Then
                If neoGetArray(bstack, s$, pppp) Then
                 If Not NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then Exit Function
                    If Typename(pppp.item(w2)) = doc Then
                      r = SG * pppp.item(w2).DocParagraphs
                      Else
                      r = 0
                      End If
                Else
                
                End If
                    
                IsDocPar = FastSymbol(a$, ")", True)
    Else
                    
                MissFuncParameterStringVarMacro a$
    End If
End Function
Private Function IsMaxData(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim p As Variant
If IsExp(bstack, a$, r) Then
  
  Do While FastSymbol(a$, ",")
  If Not IsExp(bstack, a$, p) Then: MissNumExpr: Exit Function
  If p > r Then r = p
  
  Loop

    If SG < 0 Then r = -r
    IsMaxData = FastSymbol(a$, ")", True)
        Else
            MissNumExpr
        End If
End Function
Private Function IsMinData(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim p As Variant
If IsExp(bstack, a$, r) Then
  
  Do While FastSymbol(a$, ",")
  If Not IsExp(bstack, a$, p) Then: MissNumExpr: Exit Function
  If p < r Then r = p
  
  Loop
  If SG < 0 Then r = -r
    
    IsMinData = FastSymbol(a$, ")", True)
        Else
        MissNumExpr
        End If
End Function
Private Function IsProperty(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim w1 As Long, s$
w1 = Abs(IsLabel(bstack, a$, s$))
If w1 = 1 Then
If Not GetVar(bstack, s$, w1) Then GoTo jmp147811
If Not Typename(var(w1)) = "PropReference" Then GoTo jmp147811
    Set bstack.lastobj = var(w1)
    r = 0
    IsProperty = FastSymbol(a$, ")", True)
    Exit Function
Else
jmp147811:
MyErMacro a$, "Expected a property name", "Περίμενα όνομα ιδιότητας"
End If

End Function

Private Function IsGroup(bstack As basetask, a$, r As Variant) As Boolean
Dim w1 As Long, s$, ohere$, w2 As Long, mygroup As Object
w1 = Abs(IsLabel(bstack, a$, s$))
If w1 = 1 Or w1 = 3 Then
If Not GetVar(bstack, s$, w1) Then GoTo jmp1478
If Not Typename(var(w1)) = "Group" Then GoTo jmp1478
If var(w1).IamApointer Then
    If var(w1).link.IamFloatGroup Then
        'bstack.soros.CopyGroupObj var(w1).Link, bstack.lastobj
      Set bstack.lastobj = var(w1).link
      Set bstack.lastpointer = Nothing
    Else  ' need to make a copy group using
        ohere$ = here$
        here$ = var(w1).lasthere
        If GetVar(bstack, var(w1).GroupName, w2, , , True) Then
        
        CopyGroup2 var(w2), bstack
        End If
        here$ = ohere$
    End If
Else
    CopyGroup2 var(w1), bstack
    End If
    r = 0
    
    IsGroup = FastSymbol(a$, ")", True)
    Exit Function
ElseIf w1 > 4 Then
If Not GetVar(bstack, s$, w1) Then GoTo jmp1478
Dim p
If ProcessArray(bstack, a$, s$ + ")", var(w1), p) Then
If Typename(p) = "Group" Then
 Set mygroup = p
If mygroup.IamApointer Then
    If mygroup.link.IamFloatGroup Then
        'bstack.soros.CopyGroupObj mygroup.Link, bstack.lastobj
        Set bstack.lastobj = CopyGroupObj(mygroup.link)
    Else  ' need to make a copy group using
        ohere$ = here$
        here$ = mygroup.lasthere
       
        If GetVar(bstack, mygroup.GroupName, w2, , , True) Then
        
        CopyGroup2 mygroup.link, bstack
        End If
        here$ = ohere$
    End If

Else
     'bstack.soros.CopyGroupObj mygroup, bstack.lastobj
     Set bstack.lastobj = CopyGroupObj(mygroup)
    End If
    IsGroup = FastSymbol(a$, ")", True)
    Exit Function
End If
    
End If

Else
jmp1478:
MyErMacro a$, "Expected a group name", "Περίμενα όνομα ομάδας"
End If
Exit Function
End Function
Private Function GetPointer(bstack As basetask, a$) As Boolean
Dim w1 As Long, s$, pppp As mArray, w2 As Long, p, nbstack As basetask, myobj As Object, i As Long

w1 = Abs(IsLabel(bstack, a$, s$))
If w1 = 1 Or w1 = 3 Then
cont11:
If Not GetVar(bstack, s$, w1) Then GoTo jmp1478
If Not Typename(var(w1)) = "Group" Then GoTo jmp1478
If var(w1).IamApointer Then
        Set bstack.lastobj = var(w1)
        Set bstack.lastpointer = var(w1)
Else
                        If var(w1).IamSuperClass Then
                        PushStage bstack, False
                    
                            i = globalvar("_1", 0, , True)
                            Set myobj = var(w1)
                            UnFloatGroup bstack, "_1", i, myobj, True
                            
                        Set p = CopyGroupObj(var(i))
                        PopStage bstack
                            MakeGroupPointer bstack, p
                        Else
                            MakeGroupPointer bstack, var(w1)
                        End If



    
End If
    GetPointer = True
    Exit Function
ElseIf w1 > 4 Then
If Not GetVar(bstack, s$, w1) Then


If GetSub(s$ + ")", w2) Then
                    Set nbstack = New basetask
                    nbstack.reflimit = varhash.count
                    Set nbstack.Parent = bstack
                    If bstack.IamThread Then Set nbstack.Process = bstack.Process
                    Set nbstack.Owner = bstack.Owner
                    nbstack.OriginalCode = w2
                    nbstack.UseGroupname = sbf(w2).sbgroup
                    If GoFunc(nbstack, s$ + ")", a$, p) Then
                        If Not nbstack.StaticCollection Is Nothing Then
                            bstack.SetVarobJ "%_" + nbstack.StaticInUse, nbstack.StaticCollection
                        End If
                        Set p = bstack.lastobj
                        If Not p Is Nothing Then
                        If Typename(p) = "Group" Then
                        If p.IamApointer Then
                        Set bstack.lastpointer = p
                        Else
                        If p.IamSuperClass Then
                        PushStage bstack, False
                    
                            i = globalvar("_1", 0, , True)
                            Set myobj = p
                            UnFloatGroup bstack, "_1", i, myobj, True
                            
                        Set p = CopyGroupObj(var(i))
                        PopStage bstack
                        End If
                        MakeGroupPointer bstack, p
                        End If
                        GetPointer = True
                        Exit Function
                        End If
                        End If
                        End If
ElseIf neoGetArray(bstack, s$, pppp) Then
    If Not pppp.Arr Then
    If NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then
    GoTo conthere
    End If
    End If
End If
                        Set nbstack = Nothing
                        GoTo jmp1478
                        'Set bstack.lastobj = nBstack.lastobj

End If
If GetArrayReference(bstack, a$, s$ + ")", var(w1), pppp, w2) Then
conthere:
If Typename(pppp.item(w2)) = "Group" Then
    Set p = pppp.item(w2)
    If p.IamApointer Then
        Set bstack.lastobj = p
        Set bstack.lastpointer = p
    Else
        MakeGroupPointer bstack, p
        Set pppp.item(w2) = bstack.lastpointer  ' this is my idea
    End If
    GetPointer = True
    Exit Function
End If
End If

Else
If IsExp(bstack, a$, p) Then
If Not bstack.lastpointer Is Nothing Then
Set bstack.lastobj = bstack.lastpointer
Set bstack.lastpointer = Nothing
End If
    If bstack.lastobj Is Nothing Then
    If p = 0 Then
        Set p = New Group
        p.BeginFloat 2
        p.GroupName = "Null"
        MakeGroupPointer bstack, p
        GetPointer = True
        Exit Function
    Else
    GoTo jmp1478
    End If
    Else
    If TypeOf bstack.lastobj Is Group Then
        Set p = bstack.lastobj
        

                        If p.IamSuperClass Then
                        PushStage bstack, False
                    
                            i = globalvar("_1", 0, , True)
                            Set myobj = p
                            UnFloatGroup bstack, "_1", i, myobj, True
                            
                        Set p = CopyGroupObj(var(i))
                        PopStage bstack
                        End If
        
        
        MakeGroupPointer bstack, p
        GetPointer = True
        Exit Function
    End If
    End If

End If
jmp1478:
If s$ = "THIS" Or s$ = "ΑΥΤΟ" Then
 
 If bstack.UseGroupname <> "" Then
 s$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - 1)
If GetVar(bstack, s$, w1) Then
s$ = here$
If (Len(bstack.UseGroupname) - Len(var(w1).GroupName) - 1) > 0 Then
here$ = Left$(bstack.UseGroupname, Len(bstack.UseGroupname) - Len(var(w1).GroupName) - 1)
Else
here$ = "" ' Left$(bstack.Parent.UseGroupname, Len(bstack.Parent.UseGroupname) - 1)
End If
MakeGroupPointer bstack, var(w1)
here$ = s$
    GetPointer = True
    Exit Function
End If
 End If
Else
MyErMacro a$, "Expected a group name", "Περίμενα όνομα ομάδας"
End If
End If
Exit Function
End Function
Private Function CheckGroupOrPointer(bstack As basetask, a$, IsGroupOnly As Group, pppp As mArray, w2 As Long) As Boolean
Dim w1 As Long, s$, p

w1 = Abs(IsLabel(bstack, a$, s$))
If w1 = 1 Or w1 = 3 Then
        If Not GetVar(bstack, s$, w1) Then Exit Function
        If Not Typename(var(w1)) = "Group" Then Exit Function
        If var(w1).IamApointer Then
                Set bstack.lastobj = var(w1)
                Set bstack.lastpointer = var(w1)
                Else
                Set IsGroupOnly = var(w1)
        End If
        CheckGroupOrPointer = True
        Exit Function
ElseIf w1 > 4 Then
    If Not GetVar(bstack, s$, w1) Then
        
        If neoGetArray(bstack, s$, pppp) Then
            If Not pppp.Arr Then
                If NeoGetArrayItem(pppp, bstack, s$, w2, a$) Then GoTo conthere
            End If
        End If
        Exit Function
    End If
If GetArrayReference(bstack, a$, s$ + ")", var(w1), pppp, w2) Then
conthere:
        If Typename(pppp.item(w2)) = "Group" Then
            Set p = pppp.item(w2)
            If p.IamApointer Then
                Set bstack.lastobj = p
                Set bstack.lastpointer = p
              Else
              Set IsGroupOnly = p
            End If
            CheckGroupOrPointer = True
            Exit Function
        End If
    End If
Else
    If IsExp(bstack, a$, p) Then
        If bstack.lastobj Is Nothing Then
            Exit Function
        Else
            If TypeOf bstack.lastobj Is Group Then
                If Not bstack.lastobj.IamApointer Then
                    Set IsGroupOnly = bstack.lastobj
                    Set bstack.lastobj = Nothing
                End If
                CheckGroupOrPointer = True
            End If
        End If
    End If
End If
End Function

Private Function IsChrCode(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$
   If IsStrExp(bstack, a$, s$) Then
    If s$ = vbNullString Then
        r = -1
    Else
        r = SG * AscW(s$)
    End If
    IsChrCode = FastSymbol(a$, ")", True)
    Else
        MissParam a$
    End If
End Function
Private Function IsAsc(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$
    If IsStrExp(bstack, a$, s$) Then
    If s$ = vbNullString Then
    r = -1
    Else
    'cLid
    
    r = SG * Asc(StrConv(StrConv(s$, vbFromUnicode, cLid), vbUnicode))
    End If
        IsAsc = FastSymbol(a$, ")", True)
    Else
        MissParam a$
    End If

End Function
Private Function IsCons(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim anything As Object, pppp As mArray, s$

    If IsExp(bstack, a$, r) Then
        Set anything = bstack.lastobj
        If CheckIsmArray(anything) Then
a13410:

            Set pppp = anything
            If FastSymbol(a$, ",") Then
againcons:
                If IsExp(bstack, a$, r) Then
                    Set anything = bstack.lastobj
                    If CheckIsmArray(anything) Then
a13415:
                        pppp.processAppend anything
                       
                        Set pppp = Nothing
                        Set bstack.lastobj = anything
                        r = 0


                    Else
                        Set pppp = Nothing
                        Set anything = Nothing
                        NotArray
                        Exit Function
                    End If
                ElseIf IsStrExp(bstack, a$, s$) Then
                    Set anything = bstack.lastobj
                    If CheckIsmArray(anything) Then GoTo a13415
                Else
                        Set pppp = Nothing
                        Set anything = Nothing
                        Set bstack.lastobj = anything
                        NotArray
                        Exit Function
                End If
            Else
            Dim pppp1 As New mArray
            Set pppp = anything
            pppp.CopyArray pppp1
                Set bstack.lastobj = pppp1
                Set pppp = Nothing
                Set anything = Nothing
                 IsCons = FastSymbol(a$, ")", True)
                Exit Function
            End If
        Else
            Set anything = Nothing
            Set bstack.lastobj = anything
            NotArray
            Exit Function
        End If
        If FastSymbol(a$, ",") Then Set pppp = anything: GoTo againcons
        Set anything = Nothing
        
        IsCons = FastSymbol(a$, ")", True)
    ElseIf IsStrExp(bstack, a$, s$) Then
            Set anything = bstack.lastobj
            If CheckIsmArray(anything) Then GoTo a13410
    Else
        MissParam a$
    End If
End Function
Private Function IsCar(bstack As basetask, a$, r As Variant) As Boolean
Dim anything As Object, pppp As mArray, s$
    If IsExp(bstack, a$, r) Then
car1023:
        Set anything = bstack.lastobj
        If CheckIsmArray(anything) Then
            Set pppp = anything
            pppp.Car anything
            If TypeOf anything Is mArray Then
                Set pppp = anything
                Set anything = New mHandler
                anything.t1 = 3
                Set anything.objref = pppp
            End If
            Set bstack.lastobj = anything
            Set pppp = Nothing
            Set anything = Nothing
            
        Else
            NotArray
            Exit Function
        End If
        Set anything = Nothing
        IsCar = FastSymbol(a$, ")", True)
    ElseIf IsStrExp(bstack, a$, s$) Then
        GoTo car1023
    Else
        MissParam a$
    End If

End Function
Private Function IsCdr(bstack As basetask, a$, r As Variant) As Boolean
Dim anything As Object, pppp As mArray, s$
    If IsExp(bstack, a$, r) Then
cdr1022:
        Set anything = bstack.lastobj
        If CheckIsmArray(anything) Then
            Set pppp = anything
            pppp.Cdr anything
            Set pppp = anything
            Set anything = New mHandler
            anything.t1 = 3
            Set anything.objref = pppp
            Set bstack.lastobj = anything
            Set pppp = Nothing
            Set anything = Nothing
            
        ElseIf IsStrExp(bstack, a$, s$) Then
        GoTo cdr1022
        Else
            NotArray
            Exit Function
        End If
        IsCdr = FastSymbol(a$, ")", True)
    Else
        MissParam a$
    End If

End Function
Private Function IsTest(bstack As basetask, a$, r As Variant, SG As Variant) As Boolean
Dim s$
If IsExp(bstack, a$, r) Then
    If trace Then
        bypassST = r = 0
        STbyST = Not bypassST
         STq = False
        IsTest = FastSymbol(a$, ")", True)
    Else
        r = 0
    End If
    ElseIf IsStrExp(bstack, a$, s$) Then
    If trace Then
    If s$ = vbNullString Then s$ = Chr$(1)
    r = SG * (Mid$(Form2.gList2.HeadLine, 10) Like s$)
        bypassST = r <> 0
    Else
    r = 0
    End If
    IsTest = FastSymbol(a$, ")", True)
    
    Else
    
                MissParam a$
    End If
End Function
' if ExecuteVar=0 then continue
' if ExecuteVar=1 then Exit do (after exit)
' if ExecuteVar=2 then GoTo autogosub (after exit)
' if ExecuteVar=3 then goto loopagain  (after exit)
' if ExecuteVar=4 then GoTo contVarNew (after exit)
' if ExecuteVar=5 then GoTo again3 (after exit)
' if ExecuteVar=6 then GoTo parsecommand (after exit)
' if ExecuteVar=7 then GoTo loopcontinue (after exit)
'if ExecuteVar=8 then  goto exitfunc
Private Function ExecuteVar(Exec1 As Long, ByVal jumpto As Long, bstack As basetask, w$, b$, v As Long, Lang As Long, VarStat As Boolean, NewStat As Boolean, nchr As Integer, ss$, sss As Long, temphere$) As Long
Dim i As Long, p As Variant, myobject As Object, ok As Boolean, sw$, sp As Variant, usetype As Boolean
Dim pppp As mArray, lasttype As Boolean, pppp1 As mArray
' VARSTAT MEANS GLOBAL FOR NEW VARIABLES

On jumpto GoTo Case1, Case2, Case3, Case4, case5, Case6, Case7
Exit Function
Case1:
    Select Case CheckThis(bstack, w$, b$, v, Lang, i)
    Case 0
    Case 1
    GoTo assignvalue
    Case 2
    GoTo somethingelse
    Case 3
    GoTo assignpointer
    Case -1
    Exec1 = 0: ExecuteVar = 8: Exit Function
    End Select
    i = MyTrimL(b$)

If VarStat Then
     ' MAKE A GLOBAL SO ONLY = ALLOWED
     
          If FastOperator2(b$, "=", i) Then
              GoTo jumpiflocal
          Else
              p = CDbl(0)
              If IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
  
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                            If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                        If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
            Else
               If FastSymbol(b$, "->", , 2) Then
               v = globalvar(w$, p, , VarStat, temphere$)
               GoTo assignpointer
               End If
    End If
              v = globalvar(w$, p, , VarStat, temphere$)
            
              ExecuteVar = 7: Exit Function
          End If
            
ElseIf NewStat Then
    ' MAKE A NEW ONE SO ONLY = ALLOWED
        If FastOperator2(b$, "=", i) Then
            GoTo jumpiflocal
        Else
            p = CDbl(0)
            If IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
  
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                            If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                        If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p, True) Then missNumber: Exit Function
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
     
    End If

            v = globalvar(w$, p, , VarStat, temphere$)
            ExecuteVar = 7: Exit Function
        End If
        
ElseIf nchr > 31 Then
If Left$(b$, 1) = "_" Then
        If nchr <> 61 Then
            SyntaxError
            Exit Function
        End If
        If GetVar(bstack, w$, v, True, , , , usetype) Then
        w$ = varhash.lastkey
            Mid$(b$, 1, 1) = " "
            
            GoTo assignvalue
        ElseIf GetlocalVar(w$, v) Then
            If TypeOf var(v) Is Group Then
            If Not var(v).IamRef Then
            w$ = varhash.lastkey
            End If
            Else
            
            w$ = varhash.lastkey
            End If
            
            Mid$(b$, 1, 1) = " "
            GoTo assignvalue
        Else
        Mid$(b$, 1, 1) = "="
        If AscW(Left$(w$, 1)) = &H1FFF Then
        
            If here$ = vbNullString Then
                If varhash.Find(w$, v) Then
                GoTo fromthis
                End If
            Else
                If varhash.Find(here$ + "." + w$, v) Then
                GoTo fromthis
                End If
            End If
        Else
            UnknownVariable w$
        End If
            Exec1 = 0: ExecuteVar = 8
            Exit Function
        End If
ElseIf MaybeIsSymbol(b$, "/*-+=~^&|<") Then
        If Mid$(b$, i, 2) = "<=" Then
        ' LOOK GLOBAL
        If GetVar(bstack, w$, v, True, , , , usetype) Then
        w$ = varhash.lastkey
            Mid$(b$, i, 2) = "  "
            
            GoTo assignvalue
        ElseIf GetlocalVar(w$, v) Then
            If TypeOf var(v) Is Group Then
            If Not var(v).IamRef Then
            w$ = varhash.lastkey
            End If
            Else
            
            w$ = varhash.lastkey
            End If
            
            Mid$(b$, i, 2) = "  "
            GoTo assignvalue
        Else
        Mid$(b$, i, 1) = " "
        i = i + 1
        If AscW(Left$(w$, 1)) = &H1FFF Then
        
            If here$ = vbNullString Then
                If varhash.Find(w$, v) Then
                GoTo fromthis
                End If
            Else
                If varhash.Find(here$ + "." + w$, v) Then
                GoTo fromthis
                End If
            End If
        Else
            UnknownVariable w$
        End If
            Exec1 = 0: ExecuteVar = 8
            Exit Function
        End If
        ' do something here
        ElseIf varhash.Find2(here$ & "." & myUcase(w$), v, usetype) Then
    '   If TypeOf var(v) Is Group Then w$ = varhash.lastkey
        ' CHECK VAR
fromthis:            If FastOperator(b$, "=", i) Then

assignvalue:
                If MyIsNumeric(var(v)) Then
assignvalue2:
                    
                    If IsExp(bstack, b$, p) Then
assignvalue3:
                        If bstack.lastobj Is Nothing Then
                            If usetype Then
                            If AssignTypeNumeric(p, VarType(var(v))) Then
                                var(v) = p
                            Else
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                            End If
                            Else
                            If VarType(var(v)) = vbLong Then
                                On Error Resume Next
                                    var(v) = CLng(Int(p))
                                    If Err.Number > 0 Then OverflowLong: Exec1 = 0: ExecuteVar = 8: Exit Function
                                    On Error GoTo 0
                            ElseIf VarType(var(v)) = vbInteger Then
                                On Error Resume Next
                                    var(v) = CInt(Int(p))
                                    If Err.Number > 0 Then OverflowLong True: Exec1 = 0: ExecuteVar = 8: Exit Function
                                    On Error GoTo 0
                            Else
                                var(v) = p
                            End If
                        End If
                        Else
checkobject:
                        Set myobject = bstack.lastobj
                            If TypeOf bstack.lastobj Is Group Then ' oh is a group
                                Set bstack.lastobj = Nothing
                                If myobject.IamApointer Then
                                Set var(v) = myobject
                                Else
                                 UnFloatGroup bstack, w$, v, myobject, VarStat, , Typename(var(v)) = "Empty" ' global??
                                 If Len(bstack.UseGroupname) <> 0 Then var(v).IamRef = True
                                 End If
                                Set myobject = Nothing
                            ElseIf CheckIsmArray(myobject) Then
                                    Set var(v) = New mHandler
                                    var(v).t1 = 3
                                    Set var(v).objref = myobject
                                    If TypeOf bstack.lastobj Is mHandler Then
                                    With bstack.lastobj
                                        If .UseIterator Then
                                            var(v).UseIterator = True
                                            var(v).index_start = .index_start
                                            var(v).index_End = .index_End
                                            var(v).index_cursor = .index_cursor
                                        End If
                                        End With
                                    End If
                            ElseIf TypeOf myobject Is mHandler Then
                                
                                If myobject.indirect > -1 Then
                                     Set var(v) = var(myobject.indirect)
                                Else
                                    Set var(v) = myobject
                                End If
                                 With bstack.lastobj
                                        If .UseIterator Then
                                            var(v).UseIterator = True
                                            var(v).index_start = .index_start
                                            var(v).index_End = .index_End
                                            var(v).index_cursor = .index_cursor
                                        End If
                                    End With
                                
                                
                                Set bstack.lastobj = Nothing
                            ElseIf TypeOf myobject Is lambda Then
                                If here$ = vbNullString Or VarStat Or NewStat Then
                                        GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                Else
                                        GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & Str(v)
                                End If
                                Set var(v) = myobject
                                Set bstack.lastobj = Nothing
                            ElseIf TypeOf myobject Is mEvent Then
                            Set var(v) = myobject
                            CopyEvent var(v), bstack
                            Set var(v) = bstack.lastobj
                            Else
                                Set myobject = Nothing
                                Set bstack.lastobj = Nothing
                                If VarType(var(v)) = vbLong Then
                                    NoObjectpAssignTolong
                                ElseIf VarType(var(v)) = vbInteger Then
                                    NoObjectpAssignToInteger
                                Else
                                    NoObjectAssign
                                    If var(v) = vbEmpty Then var(v) = CDbl(0)
                                End If
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                            End If
                            Set bstack.lastpointer = Nothing
                            Set bstack.lastobj = Nothing
                            Set myobject = Nothing
                        End If
                    ElseIf IsStrExp(bstack, b$, ss$) Then
                    If bstack.lastobj Is Nothing Then
                    If ss$ = vbNullString Then
                    var(v) = CDbl(0)
                    Else
                If IsNumberCheck(ss$, p) Then
                
                     If usetype Then
                            If AssignTypeNumeric(p, VarType(var(v))) Then
                                var(v) = p
                            Else
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                            End If
                            Else
                            If VarType(var(v)) = vbLong Then
                                On Error Resume Next
                                    var(v) = CLng(Int(p))
                                    If Err.Number > 0 Then OverflowLong: Exec1 = 0: ExecuteVar = 8: Exit Function
                                    On Error GoTo 0
                            ElseIf VarType(var(v)) = vbInteger Then
                                On Error Resume Next
                                    var(v) = CInt(Int(p))
                                    If Err.Number > 0 Then OverflowLong True: Exec1 = 0: ExecuteVar = 8: Exit Function
                                    On Error GoTo 0
                            Else
                                var(v) = p
                            End If
                            End If
                    End If
                    End If
                    Else
                    GoTo checkobject
                    End If
                    Else
                    ' if is string then what???
                        If var(v) = vbEmpty Then var(v) = CDbl(0)
                        NoValueForVar w$
                        Exec1 = 0: ExecuteVar = 8
                        Exit Function
                    End If
                    ExecuteVar = 7: Exit Function
                Else
assigngroup:
                    If var(v) Is Nothing Then
                        AssigntoNothing  ' Use Declare
                        Exec1 = 0: ExecuteVar = 8
                        Exit Function
                    ElseIf TypeOf var(v) Is Group Then
                        If IsExp(bstack, b$, p) Then
                        
                            'If Not TypeOf var(v) Is Group Then
                            'GoTo assignvalue3
                            'Else
                            If var(v).HasSet Then
                                Set myobject = bstack.soros
                                Set bstack.Sorosref = New mStiva
                                If bstack.lastobj Is Nothing Then
                                    bstack.soros.PushVal p
                                Else
                                If TypeOf bstack.lastobj Is VarItem Then
                                bstack.soros.DataOptional
                                Else
                                bstack.soros.DataObj bstack.lastobj
                                End If
                                    Set bstack.lastobj = Nothing
                                End If
                                NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ":=()", ok
                                Set bstack.Sorosref = myobject
                                Set myobject = Nothing
                            ElseIf bstack.lastobj Is Nothing Then
                                NeedAGroupInRightExpression
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            ElseIf TypeOf bstack.lastobj Is Group Then
                                Set myobject = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                ss$ = bstack.GroupName
                                If var(v).HasValue Or var(v).HasSet Then
                                PropCantChange
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                                Else
                                If Len(var(v).GroupName) > Len(w$) Then
                                    If var(v).IamRef Then ' Or bstack.UseGroupname <> ""
                                
                                     sw$ = here$
                                      here$ = vbNullString
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
                                    here = sw$
                                    Else
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
                                    End If
                                Else
                                    bstack.GroupName = Left$(w$, Len(w$) - Len(var(v).GroupName) + 1)
                                    If Len(var(v).GroupName) > 0 Then
                                        w$ = Left$(var(v).GroupName, Len(var(v).GroupName) - 1)
                                        sw$ = here$
                                        here$ = vbNullString
                                        UnFloatGroupReWriteVars bstack, w$, v, myobject
                                        here = sw$
                                    ElseIf var(v).IamApointer And myobject.IamApointer Then
                                        Set var(v) = myobject
                                    Else
                                        Set myobject = Nothing
                                        bstack.GroupName = ss$
                                        If var(v).IamApointer Then
                                            MyEr "Use -> to get a pointer to group", "Χρησιμοποίησε το -> για να πάρεις δείκτη σε ομάδα"
                                        Else
                                            GroupWrongUse
                                        End If
                                        Exec1 = 0: ExecuteVar = 8
                                        Exit Function
                                    End If
                                End If
                                End If
                                Set myobject = Nothing
                                bstack.GroupName = ss$
                                Set bstack.lastpointer = Nothing
                            Else
                                WrongObject
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            End If
                            ExecuteVar = 7: Exit Function
                        Else
noexpression:
                        If Left$(b$, 1) = ">" Then
noexpression1:
                        If var(v).IamApointer Then
                            If var(v).link.IamFloatGroup Then
                            ExecuteVar = 10
                            
                            Mid$(b$, 1, i) = String$(i, ChrW(3)) + ChrW(7)
                            Else
                            
                            
                            
                            ' a=>x++   -
                            ExecuteVar = 9
                            Mid$(b$, 1, i) = Chr$(0) + String$(i - 1, ChrW(7))  '
                            End If
                            Set bstack.lastpointer = var(v)
                            
                            
                                Exit Function
                                
                        Else
                        MyEr "No pointer in " + w$, "Δεν υπάρχει δείκτης στην " + w$
                        
                        
                        End If
                        End If
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                            MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            End If
                            Exit Function
                        
                    ElseIf TypeOf var(v) Is PropReference Then
                    If IsExp(bstack, b$, p) Then
                                If FastSymbol(b$, "@") Then
                                    If IsExp(bstack, b$, sp) Then
                                        var(v).index = p: sp = 0
                                    ElseIf IsStrExp(bstack, b$, ss$) Then
                                        var(v).index = ss$: ss$ = vbNullString
                                    End If
                                    var(v).UseIndex = True
                                End If
                            var(v).Value = p
                    Else
                    GoTo noexpression
                    End If
                    ExecuteVar = 7: Exit Function
                    ElseIf TypeOf var(v) Is lambda Then
                        ' exist and take something else
                        If IsExp(bstack, b$, p) Then
                            If bstack.lastobj Is Nothing Then
                                Expected "lambda", "λάμδα"
                            ElseIf TypeOf bstack.lastobj Is lambda Then
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                ExecuteVar = 7: Exit Function
                            Else
                                Expected "lambda", "λάμδα"
                            End If
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function

                        Else
                            MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
                        End If
                    ElseIf TypeOf var(v) Is mHandler Then  ' CHECK IF IT IS A HANDLER
                        If IsExp(bstack, b$, p) Then
                            If var(v).ReadOnly Then
                                ReadOnly
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                            End If
jumpbackhere:
                            If bstack.lastobj Is Nothing Then
                            If var(v).t1 = 4 Then
                            Set myobject = var(v).objref.SearchValue(p, ok)
                            If ok Then
                            Set var(v) = myobject
                            Else
                            WrongType
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                            End If
                            Else
                                MissingObjReturn
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                                End If
                            ElseIf Typename(bstack.lastobj) = "mHandler" Then
                            
                                Set myobject = New mHandler
                                bstack.lastobj.CopyTo myobject
                                If bstack.lastobj.indirect > -0 Then
                                CheckDeepAny myobject
                                bstack.lastobj.indirect = -1
                                Set bstack.lastobj.objref = myobject
                                Set var(v) = bstack.lastobj
                                Set myobject = New mHandler
                                bstack.lastobj.CopyTo myobject
                                ElseIf myobject.t1 = 4 Then
                                If Not var(v).objref Is myobject.objref Then
                                WrongType
                                Set bstack.lastobj = Nothing
                                 Exec1 = 0: ExecuteVar = 8: Exit Function
                                End If
                                End If
                                Set var(v) = myobject
                                
                            ElseIf Typename(bstack.lastobj) = myArray Then
                                Set myobject = New mHandler
                                myobject.t1 = 3
                                Set myobject.objref = bstack.lastobj
                                Set var(v) = myobject
                                
                            Else
                                
                                Set myobject = var(v)
                                myobject.t1 = 0
                                Set myobject.objref = bstack.lastobj
                                
                            End If
                            Set myobject = Nothing
                        Else
                            MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
                        End If
                        Set bstack.lastobj = Nothing
                        Set myobject = Nothing
                      ElseIf TypeOf var(v) Is Constant Then
          If Typename(var(v).Value) = "Empty" Then
          If IsExp(bstack, b$, p) Then
          If bstack.lastobj Is Nothing Then
                var(v).DefineOnce p
          Else
                NoObjectAssign
                              MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
          End If
            Else
                            MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
          End If
          Else
                      If InStr(ss$, ".") = 0 Then
                      CantAssignValue
                      Else
                      NoOperatorForThatObject "="
                      End If
                        End If
                      ElseIf TypeOf var(v) Is mEvent Then
                      If IsExp(bstack, b$, p) Then
                      If Typename$(bstack.lastobj) = "mEvent" Then
                            Set var(v) = bstack.lastobj
                            CopyEvent var(v), bstack
                            Set var(v) = bstack.lastobj
                            Set bstack.lastobj = Nothing
                            End If
                        Else
                            MissNumExpr
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
                        End If
                    Else
                        GoTo somethingelse
                    End If
                End If
            Else
                ' or do something else
                
somethingelse:
                i = MyTrimL(b$)
                If InStr("/*-+=~^&|<>", Mid$(b$, i, 1)) > 0 Then
                    If InStr("/*-+=~^&|<>!", Mid$(b$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(b$, i, 2)
                        If ss$ = "=&" Then
                        ss$ = "= "
                        Mid$(b$, i, 1) = " "
                        Else
                        Mid$(b$, i, 2) = "  "
                        End If
                    Else
                        ss$ = Mid$(b$, i, 1)
                        Mid$(b$, i, 1) = " "
                    End If
                Else
                    ExecuteVar = 6: Exit Function
                End If
                
                If MyIsNumeric(var(v)) Then
                On Error GoTo LONGERR
                lasttype = VarType(var(v)) = vbInteger
                If lasttype Then
                   Select Case ss$
                    Case "="
                        v = globalvar(w$, CInt(Int(p)), , VarStat, temphere$)
                        GoTo assignvalue2
                    Case "+="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CInt(Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "-="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CInt(-Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "*="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CInt(Int(p) * var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "/="
                        If IsExp(bstack, b$, p) Then
                            If Int(p) = 0 Then
                                DevZero
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            End If
                            var(v) = CInt(var(v) \ Int(p))
                        Else
                            GoTo noexpression
                        End If
                    Case "-!"
                        var(v) = CInt(-var(v))
                    Case "++"
                        var(v) = CInt(1 + var(v))
                    Case "--"
                        var(v) = CInt(var(v) - 1)
                    Case "~"
                        var(v) = CInt(Not CBool(var(v)))
                        
                    Case Else
                    ExecuteVar = 6: Exit Function
                End Select
                GoTo checksyntax
                ElseIf VarType(var(v)) = vbLong Then
       
                   Select Case ss$
                    Case "="
                        v = globalvar(w$, CLng(Int(p)), , VarStat, temphere$)
                        GoTo assignvalue2
                    Case "+="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "-="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(-Int(p) + var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "*="
                        If IsExp(bstack, b$, p) Then
                            var(v) = CLng(Int(p) * var(v))
                        Else
                            GoTo noexpression
                        End If
                    Case "/="
                        If IsExp(bstack, b$, p) Then
                            If Int(p) = 0 Then
                                DevZero
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            End If
                            var(v) = CLng(var(v) \ Int(p))
                        Else
                            GoTo noexpression
                        End If
                    Case "-!"
                        var(v) = CLng(-var(v))
                    Case "++"
                        var(v) = CLng(1 + var(v))
                    Case "--"
                        var(v) = CLng(var(v) - 1)
                    Case "~"
                        var(v) = CLng(Not CBool(var(v)))
                        
                    Case Else
                    ExecuteVar = 6: Exit Function
                End Select
checksyntax:
                        If NocharsInLine(b$) Then ExecuteVar = 8: Exit Function
                        If MaybeIsSymbol(b$, vbCr + ":'\}") Then ExecuteVar = 7: Exit Function
                        SyntaxError
                        Exec1 = 0: ExecuteVar = 8
                        Exit Function
                On Error GoTo 0
                Else
                
                On Error Resume Next
                AssignTypeNumeric sp, VarType(var(v))
                Select Case ss$
                    Case "="
                        v = globalvar(w$, p, , VarStat, temphere$)
                        GoTo assignvalue2
                    Case "+="
                        If IsExp(bstack, b$, p) Then

                            var(v) = p + var(v)
                            
                            If Err.Number = 6 Then
                            Err.Clear
                            var(v) = CDbl(p) + CDbl(var(v))
                            End If
                            
                        Else
                            GoTo noexpression
                        End If
                    Case "-="
                        If IsExp(bstack, b$, p) Then
                            var(v) = -p + var(v)
                            If Err.Number = 6 Then
                            Err.Clear
                            var(v) = CDbl(-p) + CDbl(var(v))
                            End If
                        Else
                            GoTo noexpression
                        End If
                    Case "*="
                        If IsExp(bstack, b$, p) Then
                            p = p * var(v)
                            var(v) = p
                            If Err.Number = 6 Then
                            Err.Clear
                            var(v) = CDbl(p) * CDbl(var(v))
                            End If
                        Else
                            GoTo noexpression
                        End If
                    Case "/="
                        If IsExp(bstack, b$, p) Then
                            If p = CDbl(0) Then
                                DevZero
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            End If
                            var(v) = var(v) / p
                            
                            If Err.Number = 6 Then
                            Err.Clear
                            var(v) = CDbl(var(v)) / CDbl(p)
                            End If
                        Else
                            GoTo noexpression
                        End If
                    Case "-!"
                        var(v) = -var(v)
                    Case "++"
                        var(v) = 1 + var(v)
                    Case "--"
                        var(v) = var(v) - 1
                    Case "~"
                    Select Case VarType(var(v))
                    Case vbBoolean
                        var(v) = Not CBool(var(v))
                    Case vbCurrency
                        var(v) = CCur(Not CBool(var(v)))
                    Case vbDecimal
                        var(v) = CDec(Not CBool(var(v)))
                    Case Else
                        var(v) = CDbl(Not CBool(var(v)))
                        End Select
                    Case "->"
                    GoTo assignpointer
                    Case Else
                    
                    ExecuteVar = 6: Exit Function

                End Select
                AssignTypeNumeric var(v), VarType(sp)
                If VarType(var(v)) = vbDouble Then var(v) = MyRound(var(v), 13)
                On Error GoTo 0
                GoTo checksyntax
                End If
                ElseIf TypeOf var(v) Is Group Then
                If ss$ = "->" Then
                 GoTo assignpointer
                End If
                If var(v).IamApointer Then
                If var(v).link.IamFloatGroup Then
                    MyPush bstack, b$
                    Set bstack.lastobj = var(v).link
                    ProcessOper bstack, myobject, ss$, (0), 1
                    If Not bstack.lastobj Is Nothing Then
                    Set var(v).LinkRef = bstack.lastobj
                    Set bstack.lastobj = Nothing
                    ExecuteVar = 7: Exit Function
                    Else
                    GoTo here1234
                    End If
                    Else
                    w$ = var(v).lasthere + "." + var(v).GroupName
                End If
                End If
                Set myobject = bstack.soros
comeoper:
                Set bstack.Sorosref = New mStiva
                    If IsExp(bstack, b$, p) Then
                        If bstack.lastobj Is Nothing Then
                            bstack.soros.PushVal p
                        Else
                    If TypeOf bstack.lastobj Is VarItem Then
                    bstack.soros.DataOptional
                    Else
                    bstack.soros.DataObj bstack.lastobj
                    End If
                            Set bstack.lastobj = Nothing
                        End If
                    End If

                    NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ss$ + "()", ok
                     Set bstack.Sorosref = myobject
                 Set myobject = Nothing
                    If Not ok Then
here1234:
                        If LastErNum = 0 Then
                            MisOperatror (ss$)
                        End If
                        Exec1 = 0: ExecuteVar = 8
                        Exit Function
                    End If
                Else
                    Set myobject = var(v)
                    
                    If CheckIsmArray(myobject) Then
                        If IsExp(bstack, b$, p) Then
                            If Not bstack.lastobj Is Nothing Then
                            If TypeOf bstack.lastobj Is mArray Then
                            Set var(v) = New mHandler
                            var(v).t1 = 3
                            Set var(v).objref = bstack.lastobj
                            Else
                                Set myobject = bstack.lastobj
                                If CheckIsmArray(myobject) Then
                                    Set var(v) = New mHandler
                                    var(v).t1 = 3
                                    Set var(v).objref = myobject
                                Else
                                NotArray
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                                End If
                                End If
                            Else
                                myobject.Compute2 p, ss$
                            End If
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                        Else
                            myobject.Compute3 ss$
                            Set myobject = Nothing
                            Set bstack.lastobj = Nothing
                        End If
                    ElseIf TypeOf myobject Is mHandler Then
                        If myobject.t1 = 4 Then
                        If myobject.ReadOnly Then
                                ReadOnly
                                Exec1 = 0: ExecuteVar = 8: Exit Function
                        ElseIf ss$ = "++" Then
                        If myobject.index_start < myobject.objref.count Then
                            myobject.index_start = myobject.index_start + 1
                            myobject.objref.index = myobject.index_start
                            myobject.index_cursor = myobject.objref.Value
                        End If
                        ElseIf ss$ = "--" Then
                    If myobject.index_start > 0 Then
                            myobject.index_start = myobject.index_start - 1
                            myobject.objref.index = myobject.index_start
                            myobject.index_cursor = myobject.objref.Value
                        End If
                        Else
                        NoOperatorForThatObject ss$
                    Exec1 = 0: ExecuteVar = 8
                    Exit Function
                        End If
                        Else
                        NoOperatorForThatObject ss$
                    Exec1 = 0: ExecuteVar = 8
                    Exit Function
                        End If
                    Else
                    NoOperatorForThatObject ss$
                    Exec1 = 0: ExecuteVar = 8
                    Exit Function
                    End If
                End If
            End If
            ExecuteVar = 7: Exit Function
            

        ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
                If FastOperator(b$, "=", i) Then
                
                    If IsExp(bstack, b$, p) Then
checkobject1:
                        Set myobject = bstack.lastobj
                        If CheckIsmArray(myobject) Then
                           ' Set bstack.lastobj = New mHandler
                            'bstack.lastobj.t1 = 3
                            Set bstack.lastobj = myobject
                            bstack.SetVarobJ w$, bstack.lastobj
                        ElseIf CheckLastHandler(myobject) Then
                            If myobject.t1 = 2 Then
                                bstack.SetVarobJ w$, myobject
                            ElseIf myobject.t1 = 1 Then
                                Set bstack.lastobj = New mHandler
                                bstack.lastobj.t1 = 1
                                Set bstack.lastobj.objref = myobject
                                bstack.SetVarobJ w$, bstack.lastobj
                            ElseIf myobject.t1 = 3 Then
                                bstack.SetVarobJ w$, myobject

                            Else
                               GoTo aproblem1
                            End If
                        
                        Else
                            bstack.SetVar w$, p
                        End If
                        Set myobject = Nothing
                        Set bstack.lastobj = Nothing
                        ExecuteVar = 7: Exit Function
                    ElseIf IsStrExp(bstack, b$, ss$) Then
                            If ss$ = vbNullString Then
                            p = CDbl(0)
                            Else
                            p = val(ss$)
                            End If
                            GoTo checkobject1
                    Else
                        GoTo aproblem1
                    End If
                Else
                    If InStr("/*-+~", Mid$(b$, i, 1)) > 0 Then
                        If InStr("=+-!", Mid$(b$, i + 1, 1)) > 0 Then
                            ss$ = Mid$(b$, i, 2)
                            Mid$(b$, i, 2) = "  "
                        Else
                            ss$ = Mid$(b$, i, 1)
                            Mid$(b$, i, 1) = " "
                        End If
                    End If
                    If Right$(ss$, 1) = "=" Then
                    If IsExp(bstack, b$, p) Then
                 If Not bstack.AlterVar(w$, p, ss$, False) Then Exec1 = 0: ExecuteVar = 8: Exit Function
                 Else
                 GoTo aproblem1
                 End If
                 Else
                 If Not bstack.AlterVar(w$, p, ss$, False) Then Exec1 = 0: ExecuteVar = 8: Exit Function
                 End If
                ExecuteVar = 7: Exit Function
                End If
                
                
            End If
            If FastOperator(b$, "=", i) Then ' MAKE A NEW ONE IF FOUND =
                v = globalvar(w$, p, , VarStat, temphere$)
                GoTo assignvalue
            ElseIf GetVar(bstack, w$, v, True) Then
                    GoTo somethingelse
            End If
        ElseIf FastOperator(b$, "=", i) Then ' MAKE A NEW ONE IF FOUND =
jumpiflocal:
            If FastOperator(b$, ">", i) Then
            If GetVar(bstack, w$, v, True) Then
            If Not var(v) Is Nothing Then
            If TypeOf var(v) Is Group Then
                GoTo noexpression1
                End If
            End If
            End If
            MyEr "Only for Group Pointers", "Μόνο για δείκτες ομάδων"
            Exec1 = 0: ExecuteVar = 8: Exit Function
            ElseIf AscW(w$) = &H1FFF Then
            If GetVar(bstack, w$, v, True) Then GoTo assignvalue
            If GetlocalVar(w$, v) Then GoTo assignvalue
            Else
            v = globalvar(w$, p, , VarStat, temphere$)
            
            GoTo assignvalue
            End If
        ElseIf FastOperator(b$, "->", i, 2) Then ' MAKE A NEW ONE IF FOUND =
            If AscW(w$) = &H1FFF Then
            If GetVar(bstack, w$, v, True) Then GoTo assignpointer
            If GetlocalVar(w$, v) Then GoTo assignpointer
            Else
            If GetVar(bstack, w$, v, True, , , , , ok) Then
            If ok Then
            v = globalvar(w$, p, , VarStat, temphere$)
            End If
            Else
            v = globalvar(w$, p, , VarStat, temphere$)
            End If
            GoTo assignpointer
            End If
        ElseIf GetVar(bstack, w$, v, True) Then
        ' CHECK FOR GLOBAL
            GoTo somethingelse
        End If
    End If
End If
'***********************
Exit Function
assignpointer:
                    If GetPointer(bstack, b$) Then
                    If MyIsObject(var(v)) Then
                    If var(v).IamApointer Then
                    Set var(v) = bstack.lastpointer
                    ElseIf var(v).soros.count > 0 Or var(v).FuncList <> vbNullString Then
                    MyEr "Can't assign pointer to named group", "Δεν μπορώ να βάλω δείκτη σε επώνυμη ομάδα"
                    Set bstack.lastpointer = Nothing
                        Set bstack.lastobj = Nothing  '???
                     Exec1 = 0: ExecuteVar = 8: Exit Function
                    Else
                     Set var(v) = bstack.lastpointer
                     End If
                     Else
                     Set var(v) = bstack.lastpointer
                     End If
                     Set bstack.lastpointer = Nothing
                        Set bstack.lastobj = Nothing  '???
                        
                    Else
                     MyEr "No Pointer Found", "Δεν βρήκα δείκτη"
                       Set bstack.lastobj = Nothing
                     Exec1 = 0: ExecuteVar = 8: Exit Function
                    End If
                    
                    ExecuteVar = 7: Exit Function
'***********************
'' Case 2
'' no case 2 here
Case3:
If Left$(w$, 1) = "." Then

 ss$ = w$
IsLabel bstack, ss$, w$
Else
Select Case CheckThis(bstack, w$, b$, v, Lang, i)
Case 0
Case 1
GoTo assignvaluestr1
Case -1
Exec1 = 0: ExecuteVar = 8: Exit Function
End Select
End If

        ss$ = vbNullString
        If Left$(b$, 1) = "_" Then
        If nchr <> 61 Then
            SyntaxError
            Exit Function
        End If
        ss$ = "g"
        Mid$(b$, 1, 1) = " "
        GoTo again12345
        ElseIf FastSymbol(b$, ".") Then
        If GetVar(bstack, w$, v) Then  'GetlocalVar(w$, V) Then
             If MaybeIsSymbol(b$, "-+*/<~") Then
             b$ = var(v) + b$
             ElseIf MaybeIsSymbol(b$, "=") Then
             If Right$(var(v), 1) = ")" Then
              b$ = var(v) + b$
             Else
              b$ = var(v) + "<" + b$
              End If
             Else
             ' maybe is a
             b$ = var(v) + "." + b$
             IsLabelDot temphere$, b$, w$
              If MaybeIsSymbol(b$, "=") Then
              b$ = w$ + "<" + b$
              ElseIf MaybeIsSymbol(b$, "-+*/<~") Then
               b$ = w$ + b$
              Else
               b$ = w$ + " " + b$
              End If
             End If
              ExecuteVar = 5: Exit Function
        Else
                UnKnownWeak w
        End If
        End If
        i = MyTrimL(b$)
        If i > Len(b$) Then
        
        ElseIf InStr("/*-+=~^&|<>", Mid$(b$, i, 1)) > 0 Then
        
                    If InStr("/*-+=~^&|<>!", Mid$(b$, i + 1, 1)) > 0 Then
                        ss$ = Mid$(b$, i, 2)
                        If ss$ = "=&" Then
                        ss$ = "="
                        Mid$(b$, i, 1) = " "
                        Else
                        Mid$(b$, i, 2) = "  "
                        End If
                        If ss$ = "<=" Then ss$ = "g"
                        
                    Else
                        ss$ = Mid$(b$, i, 1)
                        Mid$(b$, i, 1) = " "
                    End If
                    
         End If
         

If ss$ <> "" Then
    If ss$ = "=" Then
    If VarStat Then
            If IsStrExp(bstack, b$, ss$) Then
                    globalvar w$, ss$, , VarStat, temphere$
            Else
                    NoValueForVar w$
                    Exec1 = 0: ExecuteVar = 8
                    Exit Function
         End If
    Else
            If NewStat Then
                    If IsStrExp(bstack, b$, ss$) Then globalvar w$, ss$, , VarStat, temphere$
            Else
            If AscW(w$) = &H1FFF Then
            If GetVar(bstack, w$, v, True) Then GoTo assignvaluestr1
            If GetlocalVar(w$, v) Then GoTo assignvaluestr1
            ElseIf GetlocalVar(w$, v) Then
assignvaluestr1:
  ''                 If TypeOf var(v) Is Group Then w$ = varhash.lastkey  ' don't know yet
                     If IsStrExp(bstack, b$, ss$) Then
                  If Typename(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, sw$) Then
                        var(v).index = sw$: sw$ = vbNullString
                        End If
                         var(v).UseIndex = True
                        End If
                         var(v).Value = ss$
                  ElseIf Typename$(bstack.lastobj) = "lambda" Then
                                If Typename(var(v)) = "lambda" Then
                                                Set var(v) = bstack.lastobj
                                 Else
                               If here$ = vbNullString Or VarStat Or NewStat Then
                                   GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                               Else
                                     GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & Str(v)
                                End If
                                               Set var(v) = bstack.lastobj
                                        End If
                                         
                                            Set bstack.lastobj = Nothing
                  ElseIf Typename$(var(v)) = "Group" Then

                  If var(v).HasSet Then
                                Set myobject = bstack.soros
                                Set bstack.Sorosref = New mStiva
                                If bstack.lastobj Is Nothing Then
                                    bstack.soros.PushStr ss$
                                Else
                                    If TypeOf bstack.lastobj Is VarItem Then
                                    bstack.soros.DataOptional
                                    Else
                                    bstack.soros.DataObj bstack.lastobj
                                    End If
                                    Set bstack.lastobj = Nothing
                                End If
                                NeoCall2 ObjPtr(bstack), Left$(w$, Len(w$) - 1) + "." + ChrW(&H1FFF) + ":=()", ok
                            Set bstack.Sorosref = myobject
                                Set myobject = Nothing
                   Else
                  
                             If bstack.lastobj Is Nothing Then
                                NeedAGroupInRightExpression
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                            ElseIf TypeOf bstack.lastobj Is Group Then
                            Set myobject = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                ss$ = bstack.GroupName
                                If var(v).HasValue Or var(v).HasSet Then
                                PropCantChange
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
                                Else
                                w$ = Left$(w$, Len(w$) - 1)
                                If Len(var(v).GroupName) > Len(w$) Then
                                    UnFloatGroupReWriteVars bstack, w$, v, myobject
                                Else
                                    bstack.GroupName = Left$(w$, Len(w$) - Len(var(v).GroupName) + 1)
                                    If Len(var(v).GroupName) > 0 Then
                                        w$ = Left$(var(v).GroupName, Len(var(v).GroupName) - 1)
                                        UnFloatGroupReWriteVars bstack, w$, v, myobject
                                    Else
                                        GroupWrongUse
                                        Exec1 = 0: ExecuteVar = 8
                                        Exit Function
                                    End If
                                End If
                                End If
                                Set myobject = Nothing
                                bstack.GroupName = ss$
                            Else
                              GroupCantSetValue
                            End If
                   
                        
                   End If
                  Else
                                  If CheckVarOnlyNo(var(v), ss$) Then
                                  If Typename(var(v)) = "Constant" Then
                                  If Typename(var(v).Value) = "Empty" Then
                                    If bstack.lastobj Is Nothing Then
                                          var(v).DefineOnce ss$
                                          ExecuteVar = 7: Exit Function
                                    Else
                                          NoObjectAssign
                                                        MissNumExpr
                                                      Exec1 = 0: ExecuteVar = 8
                                                      Exit Function
                                    End If
                       
                                Else
                            CantAssignValue
                            End If
                                  Else
                                    ExpectedObj Typename(var(v))
                                    End If
                                    Exec1 = 0: ExecuteVar = 8: Exit Function
                                  End If
                End If
                End If
                ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
           If IsStrExp(bstack, b$, ss$) Then bstack.SetVar w$, ss$ Else GoTo aproblem1
            
            ElseIf IsStrExp(bstack, b$, ss$) Then
            GoTo cont184575
            End If
            ElseIf IsStrExp(bstack, b$, ss$) Then
cont184575:
            If bstack.lastobj Is Nothing Then
   
              globalvar w$, ss$, , VarStat, temphere$
   
            Else
            If Typename$(bstack.lastobj) = "lambda" Then
                  If NewStat Then
                                            NoNewLambda
                                            Exit Function
                                        Else
                                        i = 0
                                            If Not GetVar(bstack, w$, i, True) Then i = globalvar(w$, p, , VarStat, temphere$)
                                            If here$ = vbNullString Or VarStat Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & Str(i)
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & Str(i)
                                            End If
                                        End If
                                        Set myobject = bstack.lastobj
                                        Set bstack.lastobj = Nothing
                                        If i <> 0 Then
                                        
                                          Set var(i) = myobject
                                                Set myobject = Nothing
                                           
                                            
                                        End If
            ElseIf Typename$(bstack.lastobj) = "Group" Then
            
            
            If Not ProcGroup(100 + VarStat, bstack, w$, Lang) Then
            Exec1 = 0: ExecuteVar = 8
            Exit Function
            End If
            
           
            End If
            End If
            Else
                       NoValueForVar w$
                        Exec1 = 0: ExecuteVar = 8
                        Exit Function
            End If
            End If
    End If
    Else    ' g
again12345:
          If GetVar(bstack, w$, v, ss$ = "g") Then
          sw$ = ss$
          w$ = varhash.lastkey
               If IsStrExp(bstack, b$, ss$) Then
                 If Typename(var(v)) = "PropReference" Then
                        If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                            ElseIf IsStrExp(bstack, b$, sw$) Then
                            var(v).index = sw$: sw$ = vbNullString
                            End If
                             var(v).UseIndex = True
                        End If
                        var(v).Value = ss$
                  ElseIf Typename(var(v)) = "Constant" Then
                  If Typename(var(v).Value) = "Empty" Then
                  var(v).DefineOnce ss$
                  Else
                     NoOperatorForThatObject sw$
                  End If
                
                   ElseIf Not bstack.lastobj Is Nothing Then
                            If TypeOf bstack.lastobj Is lambda Then
                             Set var(v) = bstack.lastobj
                             GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                             Set bstack.lastobj = Nothing
                   
                    Else
                        NoValueForVar w$
                    End If
                    ElseIf Typename$(var(v)) = "Group" Then
                           If sw$ = "g" Then
                           sw$ = ":="
                           If Not var(v).HasSet Then GroupCantSetValue: Exec1 = 0: ExecuteVar = 8: Exit Function
                           End If
                           Set myobject = bstack.soros
                            Set bstack.Sorosref = New mStiva
                           If bstack.lastobj Is Nothing Then
                                bstack.soros.PushStr ss$
                            Else
                                If TypeOf bstack.lastobj Is VarItem Then
                                bstack.soros.DataOptional
                                Else
                                bstack.soros.DataObj bstack.lastobj
                                End If
                                Set bstack.lastobj = Nothing
                            End If
a325674:
                            
                            NeoCall2 ObjPtr(bstack), Left$(w$, Len(w$) - 1) + "." + ChrW(&H1FFF) + sw$ + "()", ok
                             Set bstack.Sorosref = myobject
                            Set myobject = Nothing
                            If Not ok Then GoTo here1234
                                
                Else
                If sw$ = "" Or sw$ = "g" Or sw$ = "+=" Then
               CheckVar var(v), ss$, sw$ = "+="
               Else
                            NoValueForVar w$
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
               End If
               
               End If
               Else
               ' check
               If Typename$(var(v)) = "Group" Then
               Set myobject = bstack.soros
                Set bstack.Sorosref = New mStiva
               GoTo a325674
               End If
               NoValueForVar w$
               End If
            Else
            If ss$ = "g" Then ss$ = vbNullString:   GoTo again12345
            Nosuchvariable w$
          End If
    End If
Else
        If VarStat Or NewStat Then
            
            globalvar w$, ss$, , VarStat, temphere$
           ' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
          
                    sss = Len(b$)
                ExecuteVar = 4: Exit Function
                
        End If

                 NoValueForVar w$
                    Exec1 = 0: ExecuteVar = 8
             
End If
Exit Function
Case4:
If Left$(w$, 1) = "." Then
 ss$ = w$
IsLabel bstack, ss$, w$
Else
Select Case CheckThis(bstack, w$, b$, v, Lang, i)
Case 1
GoTo assignvalue100
Case -1
Exec1 = 0: ExecuteVar = 8: Exit Function
End Select

End If
        If Left$(b$, 1) = "_" Then
        If nchr <> 61 Then
            SyntaxError
            Exit Function
        End If
        ss$ = "g"
        Mid$(b$, 1, 1) = " "
        GoTo again1234567
        ElseIf MaybeIsSymbol(b$, "=-+*/<~") Then
    If FastSymbol(b$, "=") Then
    
    If VarStat Then
    
    If IsExp(bstack, b$, p) Then
                                       
                globalvar w$, p, , VarStat, temphere$
                Else
                      If LastErNum <> -2 Then
                     NoValueForVar w$
                    Exec1 = 0: ExecuteVar = 8
                     Exit Function
                     End If
            
            End If
    Else
        If AscW(w$) = &H1FFF Then
        If GetVar(bstack, w$, v, True) Then GoTo assignvalue100
        If varhash.Find2(here$ & "." & myUcase(w$), v, usetype) Then GoTo assignvalue100
        ElseIf varhash.Find2(here$ & "." & myUcase(w$), v, usetype) Then
assignvalue100:
                If IsExp(bstack, b$, p) Then
                If Typename(var(v)) = "PropReference" Then
                  If FastSymbol(b$, "@") Then
                            If IsExp(bstack, b$, sp) Then
                            var(v).index = p: sp = 0
                        ElseIf IsStrExp(bstack, b$, ss$) Then
                        var(v).index = ss$: ss$ = vbNullString
                        End If
                         var(v).UseIndex = True
                        End If
                        var(v).Value = MyRound(p)
                ElseIf Not bstack.lastobj Is Nothing Then
                        If TypeOf bstack.lastobj Is lambda Then
                            If Typename(var(v)) = "lambda" Then
                                 Set var(v) = bstack.lastobj
                            Else
                                GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                Set var(v) = bstack.lastobj
                            End If
                            Set bstack.lastobj = Nothing
                        Else
                            
                            ExpectedObj Typename(var(v))
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
                            End If
               ElseIf MyIsObject(var(v)) Then
                        If TypeOf var(v) Is Constant Then
                              If Typename(var(v).Value) = "Empty" Then
                                    If bstack.lastobj Is Nothing Then
                                          var(v).DefineOnce MyRound(p)
                                          ExecuteVar = 7: Exit Function
                                    Else
                                          NoObjectAssign
                                                        MissNumExpr
                                                      Exec1 = 0: ExecuteVar = 8
                                                      Exit Function
                                    End If
                       
                                Else
                            CantAssignValue
                            End If
                        Else
                           ExpectedObj Typename(var(v))
                           
                        End If
                        Exec1 = 0: ExecuteVar = 8
                                    Exit Function
                Else
                        p = MyRound(p)
                        If usetype Then
                                   If AssignTypeNumeric(p, VarType(var(v))) Then
                                       var(v) = p
                                   Else
                                       Exec1 = 0: ExecuteVar = 8: Exit Function
                                   End If
                       Else
                     var(v) = p
                     End If
                End If
 
                If Err.Number = 6 Then Exec1 = 0: ExecuteVar = 1: Exit Function
                On Error GoTo 0
                End If
            ElseIf Not bstack.StaticCollection Is Nothing Then
            If bstack.ExistVar(w$) Then
            If IsExp(bstack, b$, p) Then bstack.SetVar w$, MyRound(p) Else GoTo aproblem1
            
            ElseIf IsExp(bstack, b$, p) Then
            GoTo abc2345
            End If
            
            ElseIf IsExp(bstack, b$, p) Then
abc2345:
            If Not bstack.lastobj Is Nothing Then
            If TypeOf bstack.lastobj Is lambda Then
                            v = globalvar(w$, p, , VarStat, temphere$)
                            If NewStat Then  '' ???
                                            NoNewLambda
                                            Exit Function
                                        Else
                                               If here$ = vbNullString Or VarStat Then
                                                GlobalSub w$ + "()", "CALL EXTERN " & Str(v)
                                            Else
                                                GlobalSub here$ & "." & bstack.GroupName & w$ + "()", "CALL EXTERN " & Str(v)
                                            End If
                                        End If
                                Set var(v) = bstack.lastobj
                                Set bstack.lastobj = Nothing
                                Else
                                     NoValueForVar w$
                            Exec1 = 0: ExecuteVar = 8
                            Exit Function
                                End If
           Else
            p = MyRound(p)
            
            globalvar w$, p, , VarStat, temphere$
    End If
          
                Else
                      If LastErNum <> -2 Then
aproblem1:
                     NoValueForVar w$
                    Exec1 = 0: ExecuteVar = 8
                     Exit Function
                     End If
            
            End If
    End If
    Else
        ss$ = vbNullString
        If FastSymbol(b$, "+=", , 2) Then
        ss$ = "+"
        ElseIf FastSymbol(b$, "/=", , 2) Then
        ss$ = "/"
        ElseIf FastSymbol(b$, "-=", , 2) Then
        ss$ = "-"
        ElseIf FastSymbol(b$, "*=", , 2) Then
        ss$ = "*"
        ElseIf IsOperator0(b$, "++", 2) Then
        ss$ = "++"
        ElseIf IsOperator0(b$, "--", 2) Then
        ss$ = "--"
        ElseIf IsOperator0(b$, "-!", 2) Then
        ss$ = "-!"
        ElseIf IsOperator0(b$, "~") Then
        ss$ = "!!"
        ElseIf FastSymbol(b$, "<=", , 2) Then
        ss$ = "g"
        End If
again1234567:
        If GetVar(bstack, w$, v, ss$ = "g") Then
        'NOT YET FOR PropReference
      If MyIsObject(var(v)) Then
            If Typename(var(v)) = "PropReference" Then
                    Exec1 = 0: ExecuteVar = 8: Exit Function
            End If
            If TypeOf var(v) Is Constant Then
                NoOperatorForThatObject ss$
                Exec1 = 0: ExecuteVar = 8
                Exit Function
            End If
            
      End If
            If Len(ss$) = 1 Then
                        If IsExp(bstack, b$, p) Then
                        AssignTypeNumeric sp, VarType(var(v))
                                On Error Resume Next
                                Select Case ss$
                                Case "=", "g"
                                    var(v) = MyRound(p)
                                Case "+"
                                    var(v) = MyRound(p) + var(v)
                                Case "*"
                                    var(v) = MyRound(MyRound(p) * var(v))
                                Case "-"
                                    var(v) = var(v) - MyRound(p)
                                Case "/"
                                    If MyRound(p) = 0 Then Exec1 = 0: ExecuteVar = 1: Exit Function
                                    var(v) = MyRound(var(v) / MyRound(p))
                                    
         
                   
                                End Select
                                If Err.Number = 6 Then Exec1 = 0: ExecuteVar = 1: Exit Function
                                On Error GoTo 0
                                AssignTypeNumeric var(v), VarType(sp)
                                GoTo checksyntax
                        Else
                                Exec1 = 0: ExecuteVar = 1: Exit Function
                        End If
            Else
                If ss$ = "++" Then
                    var(v) = 1 + var(v)
                ElseIf ss$ = "--" Then
                    var(v) = var(v) - 1
                ElseIf ss$ = "-!" Then
                    var(v) = -var(v)
                Else
                Select Case VarType(var(v))
                    Case vbBoolean
                        var(v) = Not CBool(var(v))
                    Case vbCurrency
                        var(v) = CCur(Not CBool(var(v)))
                    Case vbDecimal
                        var(v) = CDec(Not CBool(var(v)))
                    Case Else
                        var(v) = CDbl(Not CBool(var(v)))
                        End Select
                End If
  
            End If
            GoTo checksyntax
     Else
        If v = -1 Then
         If Len(ss$) = 1 Then If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
                    
             If Not bstack.AlterVar(w$, p, ss$, True) Then Exec1 = 0: ExecuteVar = 8: Exit Function
            
     ExecuteVar = 7: Exit Function
    Else
        If ss$ = "g" Then ss$ = "=":   GoTo again1234567
       NoValueForVar w$
       Exec1 = 0: ExecuteVar = 8: Exit Function
       End If
      End If
   
    End If
Else
    If VarStat Or NewStat Then
              p = CDbl(0)
              If IsLabelSymbolNew(b$, "ΩΣ", "AS", Lang) Then
  
               If IsLabelSymbolNew(b$, "ΑΡΙΘΜΟΣ", "DECIMAL", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                    p = CDec(p)
            ElseIf IsLabelSymbolNew(b$, "ΔΙΠΛΟΣ", "DOUBLE", Lang, , , , False) Then
                            If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CDbl(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΠΛΟΣ", "SINGLE", Lang, , , , False) Then
                        If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CSng(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΚΟΣ", "BOOLEAN", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CBool(p)
            ElseIf IsLabelSymbolNew(b$, "ΜΑΚΡΥΣ", "LONG", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CLng(p)
            ElseIf IsLabelSymbolNew(b$, "ΑΚΕΡΑΙΟΣ", "INTEGER", Lang, , , , False) Then
                    If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CInt(p)
            ElseIf IsLabelSymbolNew(b$, "ΛΟΓΙΣΤΙΚΟ", "CURRENCY", Lang, , , , False) Then
                If FastSymbol(b$, "=") Then If Not IsNumberD2(b$, p) Then missNumber: Exit Function
                p = CCur(p)
            Else
            MyEr "No type found", "δεν βρήκα τύπο"
            Exit Function
            End If
     
    End If
    
    p = Int(p)
        globalvar w$, p, , VarStat, temphere$
       ' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): ExecuteVar = 4: Exit Function
    Else
        NoValueForVar w$
        Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
End If
Exit Function
    

case5:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
 If funid.Find(w$, i) Then
    If i > 0 Then funid.ItemCreator w$, -i
      End If
If VarStat Or NewStat Then

MakeArray bstack, w$, 5, b$, pppp, NewStat, VarStat

' If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): ExecuteVar = 4: Exit Function
End If

If neoGetArray(bstack, w$, pppp, , , , True) Then
againarray:
If Not pppp.Arr Then
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then GoTo errorarr
ElseIf FastSymbol(b$, ")") Then
'need to found an expression
If FastSymbol(b$, "=") Then
    If IsExp(bstack, b$, p) Then
        If Not bstack.lastobj Is Nothing Then
        If TypeOf bstack.lastobj Is mHandler Then
             If bstack.lastobj.indirect >= 0 Then
             ' no copy..just a reference
                Set bstack.lastobj = var(bstack.lastobj.indirect)
             Else
                Set bstack.lastobj = bstack.lastobj.objref
    
             End If
            If TypeOf bstack.lastobj Is mArray Then
                    Set pppp1 = bstack.lastobj
                     pppp1.CopyArray pppp
                     pppp.final = False
             Else
                        NotArray
             End If
        Else
        Set pppp1 = bstack.lastobj
         pppp1.CopyArray pppp
          pppp.final = False
         
        End If
            Set bstack.lastobj = Nothing
            ExecuteVar = 7: Exit Function
            Else
            Set myobject = New mArray: myobject.PushDim (1): myobject.PushEnd
            myobject.SerialItem 0, 2, 9
            myobject.Arr = True
            If bstack.lastobj Is Nothing Then
                myobject.item(0) = p
            Else
                Set myobject.item(0) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            myobject.CopyArray pppp
            ExecuteVar = 7: Exit Function
        End If
    Else
        SyntaxError
        
    End If
    Exec1 = 0: ExecuteVar = 8
    Exit Function
End If

ElseIf Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then
''MyEr "Error too", "Λάθος"
errorarr:
If LastErNum = -2 Then

Execute bstack, b$, True
Exec1 = 0: ExecuteVar = 8: Exit Function
Else
Exec1 = 0: ExecuteVar = 8
ExecuteVar = 1
Exit Function
End If
End If
'On Error Resume Next

If MaybeIsSymbol(b$, ":+-*/~") Or v = -2 Then
here66678:
With pppp
If pppp.final Then CantAssignValue: Exec1 = 0: ExecuteVar = 8: Exit Function

If MyIsObject(.item(v)) Then

If v = -2 Then

Set myobject = .item(v)

If myobject.HasParametersSet Then


If myobject.HasSet Then

    w$ = Left$(w$, Len(w$) - 1)
    Set myobject = bstack.soros
    Set bstack.Sorosref = New mStiva
    PushParamGeneral bstack, b$
 '   PushParamStraight bstack, b$
    If Not FastSymbol(b$, ")", True) Then
            Set bstack.Sorosref = myobject
            Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
    If FastSymbol(b$, "=") Then
            If IsExp(bstack, b$, p) Then
                If bstack.lastobj Is Nothing Then
                    bstack.soros.DataVal p
                Else
                    If TypeOf bstack.lastobj Is VarItem Then
                    bstack.soros.DataOptional
                    Else
                    bstack.soros.DataObj bstack.lastobj
                    End If
                    Set bstack.lastobj = Nothing
                End If
                NeoCall2 ObjPtr(bstack), w$ + "." + ChrW(&H1FFF) + ":=()", ok
                Set bstack.Sorosref = myobject
                Set myobject = Nothing
                ExecuteVar = 7: Exit Function
            Else
                Set bstack.Sorosref = myobject
                 Set myobject = Nothing
                GoTo noexpression
            End If
    End If
    Set bstack.Sorosref = myobject
    SyntaxError
    Exec1 = 0: ExecuteVar = 8
    Exit Function
                               
Else
' ????
End If
 Else
a1297654:
  i = MyTrimL(b$)
       If MaybeIsSymbol(Mid$(b$, i + 1, 1), "/*-+=~^&|<>?") Then
            ss$ = Mid$(b$, i, 2)
            Mid$(b$, 1, i + 1) = Space(i + 1)
        Else
            ss$ = Mid$(b$, i, 1)
            Mid$(b$, 1, i) = Space(i)
        End If
        Set myobject = Nothing
If ss$ = "->" Then

If GetPointer(bstack, b$) Then
Set .item(v) = bstack.lastpointer
Set bstack.lastpointer = Nothing
Set bstack.lastobj = Nothing
ExecuteVar = 7: Exit Function

End If
Else

If .item(v).IamApointer Then
If .item(v).link.IamFloatGroup Then
MyPush bstack, b$
Set bstack.lastobj = .item(v).link
Else
w$ = .item(v).lasthere + "." + .item(v).GroupName
Set bstack.lastobj = Nothing
Set bstack.lastpointer = Nothing
GoTo comeoper
End If
Else
MyPush bstack, b$
Set bstack.lastobj = .item(v)
End If

    ProcessOper bstack, myobject, ss$, (0), 1
        If Not bstack.lastobj Is Nothing Then
            If TypeOf bstack.lastobj Is Group Then
            If .item(v).IamApointer Then
            Set .item(v).LinkRef = bstack.lastobj
            Else
            Set .item(v) = bstack.lastobj
            End If
            Set bstack.lastobj = Nothing
            ExecuteVar = 7: Exit Function
            End If
        End If
End If
End If
Else
Set myobject = .item(v)
If TypeOf myobject Is Group Then GoTo a1297654
Set myobject = Nothing
End If
End If

AssignTypeNumeric sp, VarType(.item(v))
If IsOperator0(b$, "++", 2) Then
.item(v) = .itemnumeric(v) + 1
ExecuteVar = 7: Exit Function
ElseIf IsOperator0(b$, "--", 2) Then
.item(v) = .itemnumeric(v) - 1
ExecuteVar = 7: Exit Function
ElseIf FastSymbol(b$, "+=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = .itemnumeric(v) + p
ElseIf FastSymbol(b$, "-=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = .itemnumeric(v) - p
ElseIf FastSymbol(b$, "*=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = .itemnumeric(v) * p
ElseIf FastSymbol(b$, "/=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
If p = CDbl(0) Then
 DevZero
 Else
 .item(v) = .itemnumeric(v) / p
End If
ElseIf IsOperator0(b$, "-!", 2) Then
.item(v) = -.itemnumeric(v)
ExecuteVar = 7: Exit Function
ElseIf IsOperator0(b$, "~") Then
    Select Case VarType(.itemnumeric(v))
            Case vbBoolean
                .item(v) = Not CBool(.itemnumeric(v))
            Case vbInteger
                .item(v) = CInt(Not CBool(.itemnumeric(v)))
            Case vbLong
                .item(v) = CLng(Not CBool(.itemnumeric(v)))
            Case vbCurrency
                .item(v) = CCur(Not CBool(.itemnumeric(v)))
            Case vbDecimal
                .item(v) = CDec(Not CBool(.itemnumeric(v)))
            Case Else
                .item(v) = CDbl(Not CBool(.itemnumeric(v)))
        End Select
ExecuteVar = 7: Exit Function
ElseIf FastSymbol(b$, ":=", , 2) Then
' new on rev 20
     Set myobject = bstack.soros
        Set bstack.Sorosref = New mStiva
        MyData bstack, b$
        Set bstack.lastobj = bstack.soros
        Set bstack.Sorosref = myobject
        Set myobject = bstack.lastobj
        Set bstack.lastobj = Nothing
        FeedArray pppp, v, myobject
        
      ExecuteVar = 7: Exit Function
ElseIf FastSymbol(b$, "->", , 2) Then
    If Not GetPointer(bstack, b$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
    If Typename(bstack.lastobj) = "Group" Then
        If Typename(.item(v)) <> "Group" Then
        
        If bstack.lastpointer Is Nothing Then
                Set .item(v) = bstack.lastobj
        Else
                Set .item(v) = bstack.lastpointer
        End If
        
        Else
        If .item(v).IamApointer Then
            If bstack.lastpointer Is Nothing Then
                MyEr "Expected pointer", "Περίμενα δείκτη"
                   Exec1 = 0: ExecuteVar = 8: Exit Function
            Else
                Set .item(v) = bstack.lastpointer
            End If
        End If
        End If
        Set bstack.lastobj = Nothing
        Set bstack.lastpointer = Nothing
          ExecuteVar = 7: Exit Function
    End If
   Exec1 = 0: ExecuteVar = 8: Exit Function
End If



   

p = .itemnumeric(v)
AssignTypeNumeric p, VarType(sp)
.item(v) = MyRound(p, 28)

End With
ExecuteVar = 7: Exit Function

End If
If IsOperatorNoRemove(b$, ".") Then

    If Typename(pppp.item(v)) = "Group" Then
        If pppp.item(v).IamApointer Then
        
    
        
    If pppp.item(v).link.IamFloatGroup Then
               
             Mid$(b$, 1, 1) = ChrW(7)
   Exec1 = SpeedGroup(bstack, pppp, "", w$, b$, v)
                            Exit Function
    Else
                Set bstack.lastpointer = pppp.item(v)
                Mid$(b$, 1, 1) = Chr(0)
                        ExecuteVar = 9
                            Exit Function
    End If
    
    
        Else
        
       Mid$(b$, 1, 1) = ChrW(7)
    
        Exec1 = SpeedGroup(bstack, pppp, "", w$, b$, v)
        End If
        If Exec1 = 0 Then ExecuteVar = 8: Exit Function
        ExecuteVar = 7: Exit Function
    End If
ElseIf IsOperator(b$, "(") Then


    If Typename(pppp.item(v)) = myArray Then
        Set pppp = pppp.item(v)
        GoTo againarray
    ElseIf Typename(pppp.item(v)) = "Group" Then
again12568:
    Set myobject = bstack.soros
    Set bstack.Sorosref = New mStiva
    PushParamStraight bstack, b$
    If Not FastSymbol(b$, ")", True) Then
            Set bstack.Sorosref = myobject
            Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
    If Not FastSymbol(b$, "=", True) Then
        sss = 0
        ExecuteVar = 3: Exit Function
    End If
    If Not IsExp(bstack, b$, p) Then
        If LastErNum = -2 Then
        Execute bstack, b$, True
        Else
        MissNumExpr
        End If
        Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
   '
                        If bstack.lastobj Is Nothing Then
                    bstack.soros.DataVal p
                Else
                    bstack.soros.DataObj bstack.lastobj
                    Set bstack.lastobj = Nothing
                End If
            Exec1 = SpeedGroup(bstack, pppp, "@READ2", "", b$, v)


    ExecuteVar = 7: Exit Function
    
    End If
ElseIf Not FastSymbol(b$, "=", True) Then
sss = 0
ExecuteVar = 3: Exit Function

End If
If Left$(b$, 1) = ">" Then
     If MyIsObject(pppp.item(v)) Then
     If TypeOf pppp.item(v) Is Group Then
            If pppp.item(v).IamApointer Then
                            
            Set bstack.lastpointer = pppp.item(v)
            If bstack.lastpointer.link.IamFloatGroup Then
             Mid$(b$, 1, 1) = " "
             If MaybeIsSymbol2(b$, "=", i) Then
                Mid$(b$, i - 1, 2) = "  "
                If IsExp(bstack, b$, p) Then GoTo here12500
                Exec1 = 0: ExecuteVar = 8: Exit Function
            Else
                If FastSymbol(b$, "(") Then
                
      '          b$ = NLtrim(b$)
                
                    GoTo again12568
                   
            End If
            End If
            Mid$(b$, 1, 1) = ChrW(7)
            ExecuteVar = 10
            Else
            Mid$(b$, 1, 1) = " "
            
            If MaybeIsSymbol2(b$, "=", i) Then
            Mid$(b$, i - 1, 2) = "  "
            w$ = pppp.item(v).lasthere + "." + pppp.item(v).GroupName
            If GetVar(bstack, w$, v, True) Then GoTo assigngroup
            Else
            If FastSymbol(b$, "(") Then
            
            w$ = pppp.item(v).lasthere + "." + pppp.item(v).GroupName + "("
            If neoGetArray(bstack, w$, pppp, , True, , True) Then
        
            GoTo againarray
            End If
            Else
            Mid$(b$, 1, 1) = ChrW(0)
            End If
            
            
            End If
            ExecuteVar = 9
            End If
                Exit Function
                End If
        End If
     End If
     
     MyEr "Wrong use of => operator", "Κακή χρήση του τελεστή =>"
     Exec1 = 0: ExecuteVar = 8: Exit Function
ElseIf Not IsExp(bstack, b$, p) Then
If LastErNum = -2 Then
Execute bstack, b$, True
Else
MissNumExpr
End If
Exec1 = 0: ExecuteVar = 8: Exit Function
End If
again12569:
     If Not bstack.lastobj Is Nothing Then
     If Typename(bstack.lastobj) = "Group" Then
     If bstack.lastobj.IamApointer Then
     Set pppp.item(v) = bstack.lastobj
     Set bstack.lastobj = Nothing
     Set bstack.lastpointer = Nothing
     ExecuteVar = 7: Exit Function
     End If
     End If
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then
   
            Set pppp.item(v) = bstack.lastobj
            
            Set pppp.item(v).LinkRef = myobject
            With pppp.item(v)
                 .HasStrValue = myobject.HasStrValue
                .HasValue = myobject.HasValue
                .HasSet = myobject.HasSet
                .HasParameters = myobject.HasParameters
                .HasParametersSet = myobject.HasParametersSet
                Set .SuperClassList = myobject.SuperClassList
                If .Events Is Nothing Then
                Set .Events = myobject.Events
                End If
                .highpriorityoper = myobject.highpriorityoper
                .HasUnary = myobject.HasUnary
            End With
     Else
            If Typename(bstack.lastobj) = "mHandler" Then
                          Set pppp.item(v) = bstack.lastobj
            Else
                   If Not bstack.lastobj Is Nothing Then
                          If TypeOf bstack.lastobj Is mArray Then
                                 If bstack.lastobj.Arr Then
                                         Set pppp.item(v) = CopyArray(bstack.lastobj)

                                 Else
  
   
                                            Set pppp.item(v) = bstack.lastobj
                                         
                                 End If
                          Else
                          
                                  Set pppp.item(v) = bstack.lastobj
                               
                                  If TypeOf bstack.lastobj Is Group Then

                                      If Not myobject Is Nothing Then
                                       If pppp.item(v).LinkRef Is Nothing Then
                                            Set pppp.item(v).LinkRef = myobject
                                      End If
                                      End If
                                  End If
                                  
                          End If
                   Else
                  
                          Set pppp.item(v) = bstack.lastobj
                          If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                   End If
            End If
        End If
     
     Set bstack.lastobj = Nothing
     Else
     If pppp.Arr Then
     If Typename(pppp.item(v)) = "Group" Then
here12500:
    If pppp.item(v).IamApointer Then
      If pppp.item(v).link.HasSet Then GoTo here65654
     
     End If
      If pppp.item(v).HasSet Then
here65654:
        bstack.soros.PushVal p
            Exec1 = SpeedGroup(bstack, pppp, "@READ", w$, b$, v)
        Else
        If p = CDbl(0) Then
        pppp.item(v) = CLng(0)  ' release pointer
        Else
     GroupCantSetValue
     End If
        End If
     Else
        pppp.item(v) = p
     End If
     ElseIf Typename(pppp.GroupRef) Like "Pro*" Then
     pppp.GroupRef.Value = p
     ElseIf Typename(pppp.item(v)) = "Group" Then
      If pppp.item(v).HasSet Then
        bstack.soros.PushVal p
            Exec1 = SpeedGroup(bstack, pppp, "@READ", w$, b$, v)
        Else
     GroupCantSetValue
        End If
    ElseIf Typename(pppp.item(v)) = "PropReference" Then
        pppp.item(v).Value = p
    ElseIf Not pppp.Arr Then
        NoAssignThere
     End If
     
     
    End If
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
    v = v + 1

    If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
    If Not bstack.lastobj Is Nothing Then
     Set myobject = pppp.GroupRef
     If pppp.IHaveClass Then
         Set pppp.item(v) = bstack.lastobj
            
            With pppp.item(v)
                 .HasStrValue = myobject.HasStrValue
                .HasValue = myobject.HasValue
                .HasSet = myobject.HasSet
                .HasParameters = myobject.HasParameters
                .HasParametersSet = myobject.HasParametersSet
                    Set .SuperClassList = myobject.SuperClassList
                Set .Events = myobject.Events
                .highpriorityoper = myobject.highpriorityoper
                .HasUnary = myobject.HasUnary
            End With
        
        
     Else
        Set pppp.item(v) = bstack.lastobj
    End If
   If Not myobject Is Nothing Then
    If Typename(pppp.item(v)) = "Group" Then Set pppp.item(v).LinkRef = myobject
   End If
    Set bstack.lastobj = Nothing
     Else
pppp.item(v) = p
End If
Else
Exit Do
End If
Loop
Else
If LastErNum <> 0 Then Exec1 = 0: ExecuteVar = 8: Exit Function
If GetSub(w$ + ")", i) Then
Else
b$ = ss$ + b$
ExecuteVar = 2  ' GoTo autogosub
Exit Function
    
End If
End If
Exit Function
Case6:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
If VarStat Or NewStat Then
 If strfunid.Find(w$, i) Then
    If i > 0 Then strfunid.ItemCreator w$, -i
      End If
MakeArray bstack, w$, 6, b$, pppp, NewStat, VarStat
 If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): ExecuteVar = 4: Exit Function
End If
If neoGetArray(bstack, w$, pppp) Then
    If Not pppp.Arr Then
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
GoTo there12567
ElseIf FastSymbol(b$, ")") Then
    'need to found an expression - HEREHERE
        If FastSymbol(b$, "=") Then
            If IsStrExp(bstack, b$, w$) Then
                If Not bstack.lastobj Is Nothing Then
                    If TypeOf bstack.lastobj Is mHandler Then
            
                        bstack.lastobj.objref.CopyArray pppp
                        pppp.final = False
                   
                    Else
          
                        bstack.lastobj.CopyArray pppp
                        pppp.final = False
     
                    End If
                    Set bstack.lastobj = Nothing
                    ExecuteVar = 7: Exit Function
                End If
            ElseIf IsExp(bstack, b$, p) Then
        If Not bstack.lastobj Is Nothing Then
        If TypeOf bstack.lastobj Is mHandler Then
         If bstack.lastobj.indirect >= 0 Then
         Set bstack.lastobj = var(bstack.lastobj.indirect)
         Else
         Set bstack.lastobj = bstack.lastobj.objref
         End If
        If TypeOf bstack.lastobj Is mArray Then
         bstack.lastobj.CopyArray pppp
         pppp.final = False
         Else
         NotArray
         End If
        Else
            bstack.lastobj.CopyArray pppp
        End If
            Set bstack.lastobj = Nothing
            ExecuteVar = 7: Exit Function
            Else
            Set myobject = New mArray: myobject.PushDim (1): myobject.PushEnd
            myobject.SerialItem 0, 2, 9
            myobject.Arr = True
            If bstack.lastobj Is Nothing Then
                myobject.item(0) = vbNullString
            Else
                Set myobject.item(0) = bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            myobject.CopyArray pppp
            ExecuteVar = 7: Exit Function
        End If
    Else
                SyntaxError
            End If
            Exec1 = 0: ExecuteVar = 8
            Exit Function
        End If
  
        
        End If
If v = -2 Then GoTo checkpar
againstrarr:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
'On Error Resume Next
' WHY BEFORE WAS : If Typename(pppp.item(v)) = myArray And Not pppp.Arr Then
there12567:
If pppp.Arr Then
If Typename(pppp.item(v)) = myArray Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againstrarr
End If
End If
End If
If v = -2 Then
checkpar:
w$ = Left$(w$, Len(w$) - 1)
Set myobject = bstack.soros
Set bstack.Sorosref = New mStiva
PushParamGeneral bstack, b$
'PushParamStraight bstack, b$
    If Not FastSymbol(b$, ")", True) Then
            Set bstack.Sorosref = myobject
            Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
    If FastSymbol(b$, "=") Then
        If IsStrExp(bstack, b$, ss$) Then
       ' bstack.soros.MakeTopItemBack bstack.soros.Total - v + 1
                                If bstack.lastobj Is Nothing Then
                                    bstack.soros.DataStr ss$
                                Else
                                    If TypeOf bstack.lastobj Is VarItem Then
                                    bstack.soros.DataOptional
                                    Else
                                    bstack.soros.DataObj bstack.lastobj
                                    End If
                                    Set bstack.lastobj = Nothing
                                End If
                                
                                NeoCall2 ObjPtr(bstack), Left$(w$, Len(w$) - 1) + "." + ChrW(&H1FFF) + ":=()", ok
                                Set bstack.Sorosref = myobject
                                Set myobject = Nothing
                                ExecuteVar = 7: Exit Function
                                
                                
                                End If
                                
                                
                                End If
                                Set bstack.Sorosref = myobject
                                Set myobject = Nothing
                                SyntaxError
                                Exec1 = 0: ExecuteVar = 8
                                Exit Function
ElseIf Not FastSymbol(b$, "=") Then
  If FastSymbol(b$, ":=", , 2) Then
  
       Set myobject = bstack.soros
        Set bstack.Sorosref = New mStiva
        MyData bstack, b$
        Set bstack.lastobj = bstack.soros
        Set bstack.Sorosref = myobject
        Set myobject = bstack.lastobj
        Set bstack.lastobj = Nothing
        FeedArray pppp, v, myobject
        
      ExecuteVar = 7: Exit Function
  
        
    ElseIf IsOperator(b$, "(") Then
        If Typename(pppp.item(v)) = myArray Then
            Set pppp = pppp.item(v)
            GoTo againstrarr
        Else ' only group here
   
            Set myobject = bstack.soros
            Set bstack.Sorosref = New mStiva
            PushParamStraight bstack, b$
            If Not FastSymbol(b$, ")", True) Then
                    Set bstack.Sorosref = myobject
                    Exec1 = 0: ExecuteVar = 8: Exit Function
            End If
            If Not FastSymbol(b$, "=", True) Then
                sss = 0
                ExecuteVar = 3: Exit Function
            End If
            If Not IsStrExp(bstack, b$, ss$) Then
                If LastErNum = -2 Then
                Execute bstack, b$, True
                Else
                MissNumExpr
                End If
                Exec1 = 0: ExecuteVar = 8: Exit Function
            End If
   '
            If bstack.lastobj Is Nothing Then
                bstack.soros.DataStr ss$
            Else
                bstack.soros.DataObj bstack.lastobj
                Set bstack.lastobj = Nothing
            End If
            Exec1 = SpeedGroup(bstack, pppp, "@READ2", "", b$, v)
            ExecuteVar = 7: Exit Function
        End If
   ElseIf FastSymbol(b$, "->", , 2) Then
    If Not GetPointer(bstack, b$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
    With pppp
    If Typename(bstack.lastobj) = "Group" Then
        If Typename(.item(v)) <> "Group" Then
        
        If bstack.lastpointer Is Nothing Then
                Set .item(v) = bstack.lastobj
        Else
                Set .item(v) = bstack.lastpointer
        End If
        
        Else
        If .item(v).IamApointer Then
            If bstack.lastpointer Is Nothing Then
                MyEr "Expected pointer", "Περίμενα δείκτη"
                   Exec1 = 0: ExecuteVar = 8: Exit Function
            Else
                Set .item(v) = bstack.lastpointer
            End If
        End If
        End If
        
        Set bstack.lastobj = Nothing
        Set bstack.lastpointer = Nothing
          ExecuteVar = 7: Exit Function
    End If
    End With
   Exec1 = 0: ExecuteVar = 8: Exit Function
   ElseIf FastSymbol(b$, "+=", , 2) Then
   If IsStrExp(bstack, b$, ss$) Then
    
          CheckVar pppp.item(v), ss$, True
    
        
  Exit Function
  Else
  Exec1 = 0: ExecuteVar = 8: Exit Function
  End If
    Else
        Exec1 = 0: ExecuteVar = 8: Exit Function
    End If
Else
    If Not IsStrExp(bstack, b$, ss$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
    If Not MyIsObject(pppp.item(v)) Then
    If pppp.Arr Then
    If pppp.count = 0 Then

    pppp.GroupRef.Value = ss$
    ElseIf bstack.lastobj Is Nothing Then
        pppp.item(v) = ss$
    
    Else
    If Typename(bstack.lastobj) = myArray Then
    If bstack.lastobj.Arr Then
        Set pppp.item(v) = CopyArray(bstack.lastobj)
    Else
        Set pppp.item(v) = bstack.lastobj.GroupRef
    End If
    Else
  
        Set pppp.item(v) = bstack.lastobj
        End If
        Set bstack.lastobj = Nothing
        End If
        Else
        pppp.GroupRef.Value = ss$
        End If
    ElseIf Typename(pppp.item(v)) = "Group" Then
        If pppp.item(v).HasSet Then
        bstack.soros.PushStr ss$
            Exec1 = SpeedGroup(bstack, pppp, "@READ", w$, b$, v)
        Else
        GroupCantSetValue
        End If
    ElseIf Typename(pppp.item(v)) = "PropReference" Then
    pppp.item(v).Value = ss$
    Else
        CheckVar pppp.item(v), ss$
    End If
        Do While FastSymbol(b$, ",")
        If pppp.UpperMonoLimit > v Then
        v = v + 1
        If Not IsStrExp(bstack, b$, ss$) Then MissStringExpr: Exec1 = 0: ExecuteVar = 8: Exit Function
        
        If Not MyIsObject(pppp.item(v)) Then
          pppp.item(v) = ss$
          Else
                CheckVar pppp.item(v), ss$
        End If
        Else
        Exit Do
        End If
        Loop
End If
Else
Exec1 = 0: ExecuteVar = 8
End If
Exit Function
Case7:
If AscW(w$) = 46 Then
IsLabel bstack, (w$), w$
End If
If VarStat Or NewStat Then
MakeArray bstack, w$, 7, b$, pppp, NewStat, VarStat
 'If Not MaybeIsSymbol(b$, ",") Then b$ = " :" + b$
        sss = Len(b$): ExecuteVar = 4: Exit Function
End If
If neoGetArray(bstack, w$, pppp) Then
    If FastSymbol(b$, ")") Then
    'need to found an expression
        If FastSymbol(b$, "=") Then
            If IsExp(bstack, b$, p) Then
                If Not bstack.lastobj Is Nothing Then
                    bstack.lastobj.CopyArray pppp
                    Set bstack.lastobj = Nothing
                    ExecuteVar = 7: Exit Function
                End If
            Else
                SyntaxError
            End If
            Exec1 = 0: ExecuteVar = 8
            Exit Function
        End If
        End If
againintarr:
If Not NeoGetArrayItem(pppp, bstack, w$, v, b$) Then Exec1 = 0: ExecuteVar = 8: Exit Function
'On Error Resume Next
If Typename(pppp.item(v)) = myArray And pppp.Arr Then
If FastSymbol(b$, "(") Then
Set pppp = pppp.item(v)
GoTo againintarr
End If
End If
If MaybeIsSymbol(b$, "+-*/~") Then
On Error Resume Next
With pppp
If IsOperator0(b$, "++", 2) Then
.item(v) = .itemnumeric(v) + 1
ElseIf IsOperator0(b$, "--", 2) Then
.item(v) = .itemnumeric(v) - 1
ElseIf FastSymbol(b$, "+=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = .itemnumeric(v) + MyRound(p)
ElseIf FastSymbol(b$, "-=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = .itemnumeric(v) - MyRound(p)
ElseIf FastSymbol(b$, "*=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
.item(v) = MyRound(.itemnumeric(v) * MyRound(p))
ElseIf FastSymbol(b$, "/=", , 2) Then
If Not IsExp(bstack, b$, p) Then Exec1 = 0: ExecuteVar = 8: Exit Function
If MyRound(p) = 0 Then
 DevZero
 Else
 .item(v) = MyRound(.itemnumeric(v) / MyRound(p))
End If
ElseIf IsOperator0(b$, "-!", 2) Then
.item(v) = -.itemnumeric(v)
ElseIf IsOperator0(b$, "~") Then
        Select Case VarType(.itemnumeric(v))
            Case vbBoolean
                .item(v) = Not CBool(.itemnumeric(v))
            Case vbInteger
                .item(v) = CInt(Not CBool(.itemnumeric(v)))
            Case vbLong
                .item(v) = CLng(Not CBool(.itemnumeric(v)))
            Case vbCurrency
                .item(v) = CCur(Not CBool(.itemnumeric(v)))
            Case vbDecimal
                .item(v) = CDec(Not CBool(.itemnumeric(v)))
            Case Else
                .item(v) = CDbl(Not CBool(.itemnumeric(v)))
        End Select

End If
End With
On Error GoTo 0
ExecuteVar = 7: Exit Function
End If
If Not FastSymbol(b$, "=") Then
  If FastSymbol(b$, ":=", , 2) Then
  
       Set myobject = bstack.soros
        Set bstack.Sorosref = New mStiva
        MyData bstack, b$
        Set bstack.lastobj = bstack.soros
        Set bstack.Sorosref = myobject
        Set myobject = bstack.lastobj
        Set bstack.lastobj = Nothing
        FeedArray pppp, v, myobject, True
        
      ExecuteVar = 7: Exit Function
End If
Exec1 = 0: ExecuteVar = 8: Exit Function
End If
If Not IsExp(bstack, b$, p) Then MissNumExpr: Exec1 = 0: ExecuteVar = 8: Exit Function
If Not bstack.lastobj Is Nothing Then
    If TypeOf bstack.lastobj Is mArray Then
                                 If bstack.lastobj.Arr Then
                                         Set pppp.item(v) = CopyArray(bstack.lastobj)

                                 Else
  
   
                                            Set pppp.item(v) = bstack.lastobj
                                            If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                                 End If
                          Else
                          
                                  Set pppp.item(v) = bstack.lastobj
                                  If TypeOf bstack.lastobj Is Group Then Set pppp.item(v).LinkRef = myobject
                          End If
Else
p = MyRound(p)
If Err.Number > 0 Then Exec1 = 0: ExecuteVar = 8: Exit Function
pppp.item(v) = p
Do While FastSymbol(b$, ",")
If pppp.UpperMonoLimit > v Then
v = v + 1
If Not IsExp(bstack, b$, p) Then MissNumExpr: Exec1 = 0: ExecuteVar = 8: Exit Function
If Not bstack.lastobj Is Nothing Then
    MissNumExpr
    Set bstack.lastobj = Nothing
    Exec1 = 0: ExecuteVar = 8
Exit Function
End If
pppp.item(v) = MyRound(p)
Else
Exit Do
End If
Loop
End If
Else
Exec1 = 0: ExecuteVar = 8: Exit Function
End If
        Exit Function
LONGERR:
    If Err.Number = 6 Then
            Exec1 = 0: ExecuteVar = 8
            OverflowLong lasttype
    ElseIf Err.Number = 450 Then
            Exec1 = 0: ExecuteVar = 8
            WrongOperator
            End If

Case2:
End Function

Sub CopyPointerRef(basestack As basetask, thisobj As Object)
            Dim ohere$, w2 As Long
                            
                                    ohere$ = here$
                                        here$ = thisobj.lasthere
                                        If GetVar(basestack, thisobj.GroupName, w2, , , True) Then
                                        
                                        CopyGroup2 var(w2), basestack
                                        End If
                                    here$ = ohere$
End Sub
Sub CallClear(bstack As basetask, what$, z1 As Variant, Optional MinusOne As Long = 0)
Dim myobject As Object, ok As Boolean, z As Group
Set z = z1

   If z.IamApointer Then
   ' compiled has minus one reference ??
   'MsgBox z.refcount1 - MinusOne
   If z.refcount1 - MinusOne > 1 Then Exit Sub
   If z.link Is Nothing Then
   
                    ElseIf z.link.IamFloatGroup Then
                    If MinusOne < 0 Then
                    If z.LinkGroup.refcount1 - 1 = 0 Then Exit Sub
                    Else
                    If z.LinkGroup.refcount1 = 0 Then Exit Sub
                    End If
                        Set bstack.lastobj = z.link
                        ProcessOper bstack, myobject, "_%", (0), 1
                        If Not bstack.lastobj Is Nothing Then
                           Set z.LinkRef = bstack.lastobj
                           Set bstack.lastobj = Nothing
                        End If
                        GoTo conthere
                    Else
                       ' what$ = z.lasthere + "." + z.GroupName
                    End If
                
                ElseIf z.IamFloatGroup Then
                Set bstack.lastobj = z
                ProcessOper bstack, myobject, "_%", (0), 1
                
                 Set bstack.lastobj = Nothing
                Else
                
                Set myobject = bstack.soros
                Set bstack.Sorosref = New mStiva
                    NeoCall2 ObjPtr(bstack), what$ + "." + ChrW(&H1FFF) + "_%()", ok
                     Set bstack.Sorosref = myobject
                 Set myobject = Nothing
                 End If
conthere:
End Sub
Sub SwapStrings(a$, b$)
Dim i As Long, j As Long
GetMem4 VarPtr(a$), i
GetMem4 VarPtr(b$), j
PutMem4 VarPtr(a$), j
PutMem4 VarPtr(b$), i
End Sub

Function CallLambdaASAP(bstack As basetask, a$, r, Optional forstring As Boolean = False) As Long
Dim w2 As Long, w1 As Long, nbstack As basetask
PushStage bstack, False
w2 = var2used
If forstring Then
w1 = globalvar("A_" + CStr(w2) + "$", 0#)
 Set var(w1) = bstack.lastobj
 Set bstack.lastobj = Nothing
  If here$ = vbNullString Then
            GlobalSub "A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & Str(w1)
        Else
            GlobalSub here$ & "." & bstack.GroupName & "A_" + CStr(Abs(w2)) + "$()", "CALL EXTERN " & Str(w1)
    End If
 Set nbstack = New basetask
    nbstack.reflimit = varhash.count
    Set nbstack.Parent = bstack
    If bstack.IamThread Then Set nbstack.Process = bstack.Process
    Set nbstack.Owner = bstack.Owner
    nbstack.OriginalCode = 0
    nbstack.UseGroupname = ""
 CallLambdaASAP = GoFunc(nbstack, "A_" + CStr(Abs(w2)) + "$()", a$, r)

Else
w1 = globalvar("A_" + CStr(w2), 0#)
 Set var(w1) = bstack.lastobj
 Set bstack.lastobj = Nothing
  If here$ = vbNullString Then
            GlobalSub "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & Str(w1)
        Else
            GlobalSub here$ & "." & bstack.GroupName & "A_" + CStr(Abs(w2)) + "()", "CALL EXTERN " & Str(w1)
    End If
     Set nbstack = New basetask
    nbstack.reflimit = varhash.count
    Set nbstack.Parent = bstack
    If bstack.IamThread Then Set nbstack.Process = bstack.Process
    Set nbstack.Owner = bstack.Owner
    nbstack.OriginalCode = 0
    nbstack.UseGroupname = ""
 CallLambdaASAP = GoFunc(nbstack, "A_" + CStr(Abs(w2)) + "()", a$, r)
End If


                 
PopStage bstack
End Function

